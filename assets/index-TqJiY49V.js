var xU=Object.defineProperty;var wU=(t,e,r)=>e in t?xU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var de=(t,e,r)=>wU(t,typeof e!="symbol"?e+"":e,r);function TU(t,e){for(var r=0;r<e.length;r++){const n=e[r];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();var Ub=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nw={exports:{}},dy={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O3;function SU(){if(O3)return dy;O3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function r(n,i,o){var c=null;if(o!==void 0&&(c=""+o),i.key!==void 0&&(c=""+i.key),"key"in i){o={};for(var s in i)s!=="key"&&(o[s]=i[s])}else o=i;return i=o.ref,{$$typeof:t,type:n,key:c,ref:i!==void 0?i:null,props:o}}return dy.Fragment=e,dy.jsx=r,dy.jsxs=r,dy}var k3;function AU(){return k3||(k3=1,nw.exports=SU()),nw.exports}var xt=AU(),iw={exports:{}},Vr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D3;function EU(){if(D3)return Vr;D3=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),M=Symbol.iterator;function I(Te){return Te===null||typeof Te!="object"?null:(Te=M&&Te[M]||Te["@@iterator"],typeof Te=="function"?Te:null)}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z=Object.assign,V={};function U(Te,ft,vt){this.props=Te,this.context=ft,this.refs=V,this.updater=vt||k}U.prototype.isReactComponent={},U.prototype.setState=function(Te,ft){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,ft,"setState")},U.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function K(){}K.prototype=U.prototype;function J(Te,ft,vt){this.props=Te,this.context=ft,this.refs=V,this.updater=vt||k}var Z=J.prototype=new K;Z.constructor=J,z(Z,U.prototype),Z.isPureReactComponent=!0;var re=Array.isArray,W={H:null,A:null,T:null,S:null,V:null},Y=Object.prototype.hasOwnProperty;function ue(Te,ft,vt,Ct,Yt,Ge){return vt=Ge.ref,{$$typeof:t,type:Te,key:ft,ref:vt!==void 0?vt:null,props:Ge}}function be(Te,ft){return ue(Te.type,ft,void 0,void 0,void 0,Te.props)}function Ce(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===t}function Ye(Te){var ft={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(vt){return ft[vt]})}var Me=/\/+/g;function Ue(Te,ft){return typeof Te=="object"&&Te!==null&&Te.key!=null?Ye(""+Te.key):ft.toString(36)}function Qe(){}function Ze(Te){switch(Te.status){case"fulfilled":return Te.value;case"rejected":throw Te.reason;default:switch(typeof Te.status=="string"?Te.then(Qe,Qe):(Te.status="pending",Te.then(function(ft){Te.status==="pending"&&(Te.status="fulfilled",Te.value=ft)},function(ft){Te.status==="pending"&&(Te.status="rejected",Te.reason=ft)})),Te.status){case"fulfilled":return Te.value;case"rejected":throw Te.reason}}throw Te}function ct(Te,ft,vt,Ct,Yt){var Ge=typeof Te;(Ge==="undefined"||Ge==="boolean")&&(Te=null);var Pt=!1;if(Te===null)Pt=!0;else switch(Ge){case"bigint":case"string":case"number":Pt=!0;break;case"object":switch(Te.$$typeof){case t:case e:Pt=!0;break;case w:return Pt=Te._init,ct(Pt(Te._payload),ft,vt,Ct,Yt)}}if(Pt)return Yt=Yt(Te),Pt=Ct===""?"."+Ue(Te,0):Ct,re(Yt)?(vt="",Pt!=null&&(vt=Pt.replace(Me,"$&/")+"/"),ct(Yt,ft,vt,"",function(zt){return zt})):Yt!=null&&(Ce(Yt)&&(Yt=be(Yt,vt+(Yt.key==null||Te&&Te.key===Yt.key?"":(""+Yt.key).replace(Me,"$&/")+"/")+Pt)),ft.push(Yt)),1;Pt=0;var tr=Ct===""?".":Ct+":";if(re(Te))for(var Ft=0;Ft<Te.length;Ft++)Ct=Te[Ft],Ge=tr+Ue(Ct,Ft),Pt+=ct(Ct,ft,vt,Ge,Yt);else if(Ft=I(Te),typeof Ft=="function")for(Te=Ft.call(Te),Ft=0;!(Ct=Te.next()).done;)Ct=Ct.value,Ge=tr+Ue(Ct,Ft++),Pt+=ct(Ct,ft,vt,Ge,Yt);else if(Ge==="object"){if(typeof Te.then=="function")return ct(Ze(Te),ft,vt,Ct,Yt);throw ft=String(Te),Error("Objects are not valid as a React child (found: "+(ft==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":ft)+"). If you meant to render a collection of children, use an array instead.")}return Pt}function Ie(Te,ft,vt){if(Te==null)return Te;var Ct=[],Yt=0;return ct(Te,Ct,"","",function(Ge){return ft.call(vt,Ge,Yt++)}),Ct}function et(Te){if(Te._status===-1){var ft=Te._result;ft=ft(),ft.then(function(vt){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=vt)},function(vt){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=vt)}),Te._status===-1&&(Te._status=0,Te._result=ft)}if(Te._status===1)return Te._result.default;throw Te._result}var ot=typeof reportError=="function"?reportError:function(Te){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ft=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Te=="object"&&Te!==null&&typeof Te.message=="string"?String(Te.message):String(Te),error:Te});if(!window.dispatchEvent(ft))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Te);return}console.error(Te)};function Bt(){}return Vr.Children={map:Ie,forEach:function(Te,ft,vt){Ie(Te,function(){ft.apply(this,arguments)},vt)},count:function(Te){var ft=0;return Ie(Te,function(){ft++}),ft},toArray:function(Te){return Ie(Te,function(ft){return ft})||[]},only:function(Te){if(!Ce(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},Vr.Component=U,Vr.Fragment=r,Vr.Profiler=i,Vr.PureComponent=J,Vr.StrictMode=n,Vr.Suspense=m,Vr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=W,Vr.__COMPILER_RUNTIME={__proto__:null,c:function(Te){return W.H.useMemoCache(Te)}},Vr.cache=function(Te){return function(){return Te.apply(null,arguments)}},Vr.cloneElement=function(Te,ft,vt){if(Te==null)throw Error("The argument must be a React element, but you passed "+Te+".");var Ct=z({},Te.props),Yt=Te.key,Ge=void 0;if(ft!=null)for(Pt in ft.ref!==void 0&&(Ge=void 0),ft.key!==void 0&&(Yt=""+ft.key),ft)!Y.call(ft,Pt)||Pt==="key"||Pt==="__self"||Pt==="__source"||Pt==="ref"&&ft.ref===void 0||(Ct[Pt]=ft[Pt]);var Pt=arguments.length-2;if(Pt===1)Ct.children=vt;else if(1<Pt){for(var tr=Array(Pt),Ft=0;Ft<Pt;Ft++)tr[Ft]=arguments[Ft+2];Ct.children=tr}return ue(Te.type,Yt,void 0,void 0,Ge,Ct)},Vr.createContext=function(Te){return Te={$$typeof:c,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null},Te.Provider=Te,Te.Consumer={$$typeof:o,_context:Te},Te},Vr.createElement=function(Te,ft,vt){var Ct,Yt={},Ge=null;if(ft!=null)for(Ct in ft.key!==void 0&&(Ge=""+ft.key),ft)Y.call(ft,Ct)&&Ct!=="key"&&Ct!=="__self"&&Ct!=="__source"&&(Yt[Ct]=ft[Ct]);var Pt=arguments.length-2;if(Pt===1)Yt.children=vt;else if(1<Pt){for(var tr=Array(Pt),Ft=0;Ft<Pt;Ft++)tr[Ft]=arguments[Ft+2];Yt.children=tr}if(Te&&Te.defaultProps)for(Ct in Pt=Te.defaultProps,Pt)Yt[Ct]===void 0&&(Yt[Ct]=Pt[Ct]);return ue(Te,Ge,void 0,void 0,null,Yt)},Vr.createRef=function(){return{current:null}},Vr.forwardRef=function(Te){return{$$typeof:s,render:Te}},Vr.isValidElement=Ce,Vr.lazy=function(Te){return{$$typeof:w,_payload:{_status:-1,_result:Te},_init:et}},Vr.memo=function(Te,ft){return{$$typeof:v,type:Te,compare:ft===void 0?null:ft}},Vr.startTransition=function(Te){var ft=W.T,vt={};W.T=vt;try{var Ct=Te(),Yt=W.S;Yt!==null&&Yt(vt,Ct),typeof Ct=="object"&&Ct!==null&&typeof Ct.then=="function"&&Ct.then(Bt,ot)}catch(Ge){ot(Ge)}finally{W.T=ft}},Vr.unstable_useCacheRefresh=function(){return W.H.useCacheRefresh()},Vr.use=function(Te){return W.H.use(Te)},Vr.useActionState=function(Te,ft,vt){return W.H.useActionState(Te,ft,vt)},Vr.useCallback=function(Te,ft){return W.H.useCallback(Te,ft)},Vr.useContext=function(Te){return W.H.useContext(Te)},Vr.useDebugValue=function(){},Vr.useDeferredValue=function(Te,ft){return W.H.useDeferredValue(Te,ft)},Vr.useEffect=function(Te,ft,vt){var Ct=W.H;if(typeof vt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Ct.useEffect(Te,ft)},Vr.useId=function(){return W.H.useId()},Vr.useImperativeHandle=function(Te,ft,vt){return W.H.useImperativeHandle(Te,ft,vt)},Vr.useInsertionEffect=function(Te,ft){return W.H.useInsertionEffect(Te,ft)},Vr.useLayoutEffect=function(Te,ft){return W.H.useLayoutEffect(Te,ft)},Vr.useMemo=function(Te,ft){return W.H.useMemo(Te,ft)},Vr.useOptimistic=function(Te,ft){return W.H.useOptimistic(Te,ft)},Vr.useReducer=function(Te,ft,vt){return W.H.useReducer(Te,ft,vt)},Vr.useRef=function(Te){return W.H.useRef(Te)},Vr.useState=function(Te){return W.H.useState(Te)},Vr.useSyncExternalStore=function(Te,ft,vt){return W.H.useSyncExternalStore(Te,ft,vt)},Vr.useTransition=function(){return W.H.useTransition()},Vr.version="19.1.0",Vr}var N3;function YM(){return N3||(N3=1,iw.exports=EU()),iw.exports}var it=YM();const He=Yn(it);var aw={exports:{}},py={},sw={exports:{}},ow={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B3;function MU(){return B3||(B3=1,function(t){function e(Ie,et){var ot=Ie.length;Ie.push(et);e:for(;0<ot;){var Bt=ot-1>>>1,Te=Ie[Bt];if(0<i(Te,et))Ie[Bt]=et,Ie[ot]=Te,ot=Bt;else break e}}function r(Ie){return Ie.length===0?null:Ie[0]}function n(Ie){if(Ie.length===0)return null;var et=Ie[0],ot=Ie.pop();if(ot!==et){Ie[0]=ot;e:for(var Bt=0,Te=Ie.length,ft=Te>>>1;Bt<ft;){var vt=2*(Bt+1)-1,Ct=Ie[vt],Yt=vt+1,Ge=Ie[Yt];if(0>i(Ct,ot))Yt<Te&&0>i(Ge,Ct)?(Ie[Bt]=Ge,Ie[Yt]=ot,Bt=Yt):(Ie[Bt]=Ct,Ie[vt]=ot,Bt=vt);else if(Yt<Te&&0>i(Ge,ot))Ie[Bt]=Ge,Ie[Yt]=ot,Bt=Yt;else break e}}return et}function i(Ie,et){var ot=Ie.sortIndex-et.sortIndex;return ot!==0?ot:Ie.id-et.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var c=Date,s=c.now();t.unstable_now=function(){return c.now()-s}}var m=[],v=[],w=1,M=null,I=3,k=!1,z=!1,V=!1,U=!1,K=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,Z=typeof setImmediate<"u"?setImmediate:null;function re(Ie){for(var et=r(v);et!==null;){if(et.callback===null)n(v);else if(et.startTime<=Ie)n(v),et.sortIndex=et.expirationTime,e(m,et);else break;et=r(v)}}function W(Ie){if(V=!1,re(Ie),!z)if(r(m)!==null)z=!0,Y||(Y=!0,Ue());else{var et=r(v);et!==null&&ct(W,et.startTime-Ie)}}var Y=!1,ue=-1,be=5,Ce=-1;function Ye(){return U?!0:!(t.unstable_now()-Ce<be)}function Me(){if(U=!1,Y){var Ie=t.unstable_now();Ce=Ie;var et=!0;try{e:{z=!1,V&&(V=!1,J(ue),ue=-1),k=!0;var ot=I;try{t:{for(re(Ie),M=r(m);M!==null&&!(M.expirationTime>Ie&&Ye());){var Bt=M.callback;if(typeof Bt=="function"){M.callback=null,I=M.priorityLevel;var Te=Bt(M.expirationTime<=Ie);if(Ie=t.unstable_now(),typeof Te=="function"){M.callback=Te,re(Ie),et=!0;break t}M===r(m)&&n(m),re(Ie)}else n(m);M=r(m)}if(M!==null)et=!0;else{var ft=r(v);ft!==null&&ct(W,ft.startTime-Ie),et=!1}}break e}finally{M=null,I=ot,k=!1}et=void 0}}finally{et?Ue():Y=!1}}}var Ue;if(typeof Z=="function")Ue=function(){Z(Me)};else if(typeof MessageChannel<"u"){var Qe=new MessageChannel,Ze=Qe.port2;Qe.port1.onmessage=Me,Ue=function(){Ze.postMessage(null)}}else Ue=function(){K(Me,0)};function ct(Ie,et){ue=K(function(){Ie(t.unstable_now())},et)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ie){Ie.callback=null},t.unstable_forceFrameRate=function(Ie){0>Ie||125<Ie?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):be=0<Ie?Math.floor(1e3/Ie):5},t.unstable_getCurrentPriorityLevel=function(){return I},t.unstable_next=function(Ie){switch(I){case 1:case 2:case 3:var et=3;break;default:et=I}var ot=I;I=et;try{return Ie()}finally{I=ot}},t.unstable_requestPaint=function(){U=!0},t.unstable_runWithPriority=function(Ie,et){switch(Ie){case 1:case 2:case 3:case 4:case 5:break;default:Ie=3}var ot=I;I=Ie;try{return et()}finally{I=ot}},t.unstable_scheduleCallback=function(Ie,et,ot){var Bt=t.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?Bt+ot:Bt):ot=Bt,Ie){case 1:var Te=-1;break;case 2:Te=250;break;case 5:Te=1073741823;break;case 4:Te=1e4;break;default:Te=5e3}return Te=ot+Te,Ie={id:w++,callback:et,priorityLevel:Ie,startTime:ot,expirationTime:Te,sortIndex:-1},ot>Bt?(Ie.sortIndex=ot,e(v,Ie),r(m)===null&&Ie===r(v)&&(V?(J(ue),ue=-1):V=!0,ct(W,ot-Bt))):(Ie.sortIndex=Te,e(m,Ie),z||k||(z=!0,Y||(Y=!0,Ue()))),Ie},t.unstable_shouldYield=Ye,t.unstable_wrapCallback=function(Ie){var et=I;return function(){var ot=I;I=et;try{return Ie.apply(this,arguments)}finally{I=ot}}}}(ow)),ow}var L3;function PU(){return L3||(L3=1,sw.exports=MU()),sw.exports}var lw={exports:{}},Ss={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F3;function CU(){if(F3)return Ss;F3=1;var t=YM();function e(m){var v="https://react.dev/errors/"+m;if(1<arguments.length){v+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)v+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+m+"; visit "+v+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(){}var n={d:{f:r,r:function(){throw Error(e(522))},D:r,C:r,L:r,m:r,X:r,S:r,M:r},p:0,findDOMNode:null},i=Symbol.for("react.portal");function o(m,v,w){var M=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:M==null?null:""+M,children:m,containerInfo:v,implementation:w}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(m,v){if(m==="font")return"";if(typeof v=="string")return v==="use-credentials"?v:""}return Ss.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Ss.createPortal=function(m,v){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)throw Error(e(299));return o(m,v,null,w)},Ss.flushSync=function(m){var v=c.T,w=n.p;try{if(c.T=null,n.p=2,m)return m()}finally{c.T=v,n.p=w,n.d.f()}},Ss.preconnect=function(m,v){typeof m=="string"&&(v?(v=v.crossOrigin,v=typeof v=="string"?v==="use-credentials"?v:"":void 0):v=null,n.d.C(m,v))},Ss.prefetchDNS=function(m){typeof m=="string"&&n.d.D(m)},Ss.preinit=function(m,v){if(typeof m=="string"&&v&&typeof v.as=="string"){var w=v.as,M=s(w,v.crossOrigin),I=typeof v.integrity=="string"?v.integrity:void 0,k=typeof v.fetchPriority=="string"?v.fetchPriority:void 0;w==="style"?n.d.S(m,typeof v.precedence=="string"?v.precedence:void 0,{crossOrigin:M,integrity:I,fetchPriority:k}):w==="script"&&n.d.X(m,{crossOrigin:M,integrity:I,fetchPriority:k,nonce:typeof v.nonce=="string"?v.nonce:void 0})}},Ss.preinitModule=function(m,v){if(typeof m=="string")if(typeof v=="object"&&v!==null){if(v.as==null||v.as==="script"){var w=s(v.as,v.crossOrigin);n.d.M(m,{crossOrigin:w,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0})}}else v==null&&n.d.M(m)},Ss.preload=function(m,v){if(typeof m=="string"&&typeof v=="object"&&v!==null&&typeof v.as=="string"){var w=v.as,M=s(w,v.crossOrigin);n.d.L(m,w,{crossOrigin:M,integrity:typeof v.integrity=="string"?v.integrity:void 0,nonce:typeof v.nonce=="string"?v.nonce:void 0,type:typeof v.type=="string"?v.type:void 0,fetchPriority:typeof v.fetchPriority=="string"?v.fetchPriority:void 0,referrerPolicy:typeof v.referrerPolicy=="string"?v.referrerPolicy:void 0,imageSrcSet:typeof v.imageSrcSet=="string"?v.imageSrcSet:void 0,imageSizes:typeof v.imageSizes=="string"?v.imageSizes:void 0,media:typeof v.media=="string"?v.media:void 0})}},Ss.preloadModule=function(m,v){if(typeof m=="string")if(v){var w=s(v.as,v.crossOrigin);n.d.m(m,{as:typeof v.as=="string"&&v.as!=="script"?v.as:void 0,crossOrigin:w,integrity:typeof v.integrity=="string"?v.integrity:void 0})}else n.d.m(m)},Ss.requestFormReset=function(m){n.d.r(m)},Ss.unstable_batchedUpdates=function(m,v){return m(v)},Ss.useFormState=function(m,v,w){return c.H.useFormState(m,v,w)},Ss.useFormStatus=function(){return c.H.useHostTransitionStatus()},Ss.version="19.1.0",Ss}var z3;function UB(){if(z3)return lw.exports;z3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),lw.exports=CU(),lw.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j3;function RU(){if(j3)return py;j3=1;var t=PU(),e=YM(),r=UB();function n(u){var p="https://react.dev/errors/"+u;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+u+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function o(u){var p=u,y=u;if(u.alternate)for(;p.return;)p=p.return;else{u=p;do p=u,(p.flags&4098)!==0&&(y=p.return),u=p.return;while(u)}return p.tag===3?y:null}function c(u){if(u.tag===13){var p=u.memoizedState;if(p===null&&(u=u.alternate,u!==null&&(p=u.memoizedState)),p!==null)return p.dehydrated}return null}function s(u){if(o(u)!==u)throw Error(n(188))}function m(u){var p=u.alternate;if(!p){if(p=o(u),p===null)throw Error(n(188));return p!==u?null:u}for(var y=u,S=p;;){var O=y.return;if(O===null)break;var L=O.alternate;if(L===null){if(S=O.return,S!==null){y=S;continue}break}if(O.child===L.child){for(L=O.child;L;){if(L===y)return s(O),u;if(L===S)return s(O),p;L=L.sibling}throw Error(n(188))}if(y.return!==S.return)y=O,S=L;else{for(var ne=!1,he=O.child;he;){if(he===y){ne=!0,y=O,S=L;break}if(he===S){ne=!0,S=O,y=L;break}he=he.sibling}if(!ne){for(he=L.child;he;){if(he===y){ne=!0,y=L,S=O;break}if(he===S){ne=!0,S=L,y=O;break}he=he.sibling}if(!ne)throw Error(n(189))}}if(y.alternate!==S)throw Error(n(190))}if(y.tag!==3)throw Error(n(188));return y.stateNode.current===y?u:p}function v(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u;for(u=u.child;u!==null;){if(p=v(u),p!==null)return p;u=u.sibling}return null}var w=Object.assign,M=Symbol.for("react.element"),I=Symbol.for("react.transitional.element"),k=Symbol.for("react.portal"),z=Symbol.for("react.fragment"),V=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),K=Symbol.for("react.provider"),J=Symbol.for("react.consumer"),Z=Symbol.for("react.context"),re=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),Y=Symbol.for("react.suspense_list"),ue=Symbol.for("react.memo"),be=Symbol.for("react.lazy"),Ce=Symbol.for("react.activity"),Ye=Symbol.for("react.memo_cache_sentinel"),Me=Symbol.iterator;function Ue(u){return u===null||typeof u!="object"?null:(u=Me&&u[Me]||u["@@iterator"],typeof u=="function"?u:null)}var Qe=Symbol.for("react.client.reference");function Ze(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===Qe?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case z:return"Fragment";case U:return"Profiler";case V:return"StrictMode";case W:return"Suspense";case Y:return"SuspenseList";case Ce:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case k:return"Portal";case Z:return(u.displayName||"Context")+".Provider";case J:return(u._context.displayName||"Context")+".Consumer";case re:var p=u.render;return u=u.displayName,u||(u=p.displayName||p.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case ue:return p=u.displayName||null,p!==null?p:Ze(u.type)||"Memo";case be:p=u._payload,u=u._init;try{return Ze(u(p))}catch{}}return null}var ct=Array.isArray,Ie=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,et=r.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ot={pending:!1,data:null,method:null,action:null},Bt=[],Te=-1;function ft(u){return{current:u}}function vt(u){0>Te||(u.current=Bt[Te],Bt[Te]=null,Te--)}function Ct(u,p){Te++,Bt[Te]=u.current,u.current=p}var Yt=ft(null),Ge=ft(null),Pt=ft(null),tr=ft(null);function Ft(u,p){switch(Ct(Pt,p),Ct(Ge,u),Ct(Yt,null),p.nodeType){case 9:case 11:u=(u=p.documentElement)&&(u=u.namespaceURI)?ly(u):0;break;default:if(u=p.tagName,p=p.namespaceURI)p=ly(p),u=wp(p,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}vt(Yt),Ct(Yt,u)}function zt(){vt(Yt),vt(Ge),vt(Pt)}function Gt(u){u.memoizedState!==null&&Ct(tr,u);var p=Yt.current,y=wp(p,u.type);p!==y&&(Ct(Ge,u),Ct(Yt,y))}function Zt(u){Ge.current===u&&(vt(Yt),vt(Ge)),tr.current===u&&(vt(tr),qt._currentValue=ot)}var mt=Object.prototype.hasOwnProperty,hr=t.unstable_scheduleCallback,Vt=t.unstable_cancelCallback,ar=t.unstable_shouldYield,rr=t.unstable_requestPaint,fr=t.unstable_now,En=t.unstable_getCurrentPriorityLevel,aa=t.unstable_ImmediatePriority,li=t.unstable_UserBlockingPriority,Kn=t.unstable_NormalPriority,Ei=t.unstable_LowPriority,Mi=t.unstable_IdlePriority,el=t.log,_o=t.unstable_setDisableYieldValue,Ys=null,Pi=null;function Xi(u){if(typeof el=="function"&&_o(u),Pi&&typeof Pi.setStrictMode=="function")try{Pi.setStrictMode(Ys,u)}catch{}}var Ci=Math.clz32?Math.clz32:Ks,yo=Math.log,tl=Math.LN2;function Ks(u){return u>>>=0,u===0?32:31-(yo(u)/tl|0)|0}var Gi=256,ms=4194304;function Ve(u){var p=u&42;if(p!==0)return p;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function le(u,p,y){var S=u.pendingLanes;if(S===0)return 0;var O=0,L=u.suspendedLanes,ne=u.pingedLanes;u=u.warmLanes;var he=S&134217727;return he!==0?(S=he&~L,S!==0?O=Ve(S):(ne&=he,ne!==0?O=Ve(ne):y||(y=he&~u,y!==0&&(O=Ve(y))))):(he=S&~L,he!==0?O=Ve(he):ne!==0?O=Ve(ne):y||(y=S&~u,y!==0&&(O=Ve(y)))),O===0?0:p!==0&&p!==O&&(p&L)===0&&(L=O&-O,y=p&-p,L>=y||L===32&&(y&4194048)!==0)?p:O}function ce(u,p){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&p)===0}function ge(u,p){switch(u){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pe(){var u=Gi;return Gi<<=1,(Gi&4194048)===0&&(Gi=256),u}function fe(){var u=ms;return ms<<=1,(ms&62914560)===0&&(ms=4194304),u}function $e(u){for(var p=[],y=0;31>y;y++)p.push(u);return p}function at(u,p){u.pendingLanes|=p,p!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Ne(u,p,y,S,O,L){var ne=u.pendingLanes;u.pendingLanes=y,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=y,u.entangledLanes&=y,u.errorRecoveryDisabledLanes&=y,u.shellSuspendCounter=0;var he=u.entanglements,De=u.expirationTimes,pt=u.hiddenUpdates;for(y=ne&~y;0<y;){var Dt=31-Ci(y),Ut=1<<Dt;he[Dt]=0,De[Dt]=-1;var ht=pt[Dt];if(ht!==null)for(pt[Dt]=null,Dt=0;Dt<ht.length;Dt++){var yt=ht[Dt];yt!==null&&(yt.lane&=-536870913)}y&=~Ut}S!==0&&gt(u,S,0),L!==0&&O===0&&u.tag!==0&&(u.suspendedLanes|=L&~(ne&~p))}function gt(u,p,y){u.pendingLanes|=p,u.suspendedLanes&=~p;var S=31-Ci(p);u.entangledLanes|=p,u.entanglements[S]=u.entanglements[S]|1073741824|y&4194090}function bt(u,p){var y=u.entangledLanes|=p;for(u=u.entanglements;y;){var S=31-Ci(y),O=1<<S;O&p|u[S]&p&&(u[S]|=p),y&=~O}}function Ke(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function It(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function Xt(){var u=et.p;return u!==0?u:(u=window.event,u===void 0?32:Ui(u.type))}function Kt(u,p){var y=et.p;try{return et.p=u,p()}finally{et.p=y}}var dr=Math.random().toString(36).slice(2),_r="__reactFiber$"+dr,_t="__reactProps$"+dr,vr="__reactContainer$"+dr,jr="__reactEvents$"+dr,rn="__reactListeners$"+dr,qr="__reactHandles$"+dr,Mt="__reactResources$"+dr,er="__reactMarker$"+dr;function yr(u){delete u[_r],delete u[_t],delete u[jr],delete u[rn],delete u[qr]}function mi(u){var p=u[_r];if(p)return p;for(var y=u.parentNode;y;){if(p=y[vr]||y[_r]){if(y=p.alternate,p.child!==null||y!==null&&y.child!==null)for(u=rg(u);u!==null;){if(y=u[_r])return y;u=rg(u)}return p}u=y,y=u.parentNode}return null}function ci(u){if(u=u[_r]||u[vr]){var p=u.tag;if(p===5||p===6||p===13||p===26||p===27||p===3)return u}return null}function on(u){var p=u.tag;if(p===5||p===26||p===27||p===6)return u.stateNode;throw Error(n(33))}function wr(u){var p=u[Mt];return p||(p=u[Mt]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function ni(u){u[er]=!0}var rl=new Set,Lu={};function Ba(u,p){vo(u,p),vo(u+"Capture",p)}function vo(u,p){for(Lu[u]=p,u=0;u<p.length;u++)rl.add(p[u])}var Ni=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gn={},Ri={};function Fu(u){return mt.call(Ri,u)?!0:mt.call(gn,u)?!1:Ni.test(u)?Ri[u]=!0:(gn[u]=!0,!1)}function Yl(u,p,y){if(Fu(p))if(y===null)u.removeAttribute(p);else{switch(typeof y){case"undefined":case"function":case"symbol":u.removeAttribute(p);return;case"boolean":var S=p.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){u.removeAttribute(p);return}}u.setAttribute(p,""+y)}}function La(u,p,y){if(y===null)u.removeAttribute(p);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(p);return}u.setAttribute(p,""+y)}}function Ta(u,p,y,S){if(S===null)u.removeAttribute(y);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(y);return}u.setAttributeNS(p,y,""+S)}}var ef,Sd;function nl(u){if(ef===void 0)try{throw Error()}catch(y){var p=y.stack.trim().match(/\n( *(at )?)/);ef=p&&p[1]||"",Sd=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ef+u+Sd}var il=!1;function zu(u,p){if(!u||il)return"";il=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(p){var Ut=function(){throw Error()};if(Object.defineProperty(Ut.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ut,[])}catch(yt){var ht=yt}Reflect.construct(u,[],Ut)}else{try{Ut.call()}catch(yt){ht=yt}u.call(Ut.prototype)}}else{try{throw Error()}catch(yt){ht=yt}(Ut=u())&&typeof Ut.catch=="function"&&Ut.catch(function(){})}}catch(yt){if(yt&&ht&&typeof yt.stack=="string")return[yt.stack,ht.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var O=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");O&&O.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var L=S.DetermineComponentFrameRoot(),ne=L[0],he=L[1];if(ne&&he){var De=ne.split(`
`),pt=he.split(`
`);for(O=S=0;S<De.length&&!De[S].includes("DetermineComponentFrameRoot");)S++;for(;O<pt.length&&!pt[O].includes("DetermineComponentFrameRoot");)O++;if(S===De.length||O===pt.length)for(S=De.length-1,O=pt.length-1;1<=S&&0<=O&&De[S]!==pt[O];)O--;for(;1<=S&&0<=O;S--,O--)if(De[S]!==pt[O]){if(S!==1||O!==1)do if(S--,O--,0>O||De[S]!==pt[O]){var Dt=`
`+De[S].replace(" at new "," at ");return u.displayName&&Dt.includes("<anonymous>")&&(Dt=Dt.replace("<anonymous>",u.displayName)),Dt}while(1<=S&&0<=O);break}}}finally{il=!1,Error.prepareStackTrace=y}return(y=u?u.displayName||u.name:"")?nl(y):""}function x_(u){switch(u.tag){case 26:case 27:case 5:return nl(u.type);case 16:return nl("Lazy");case 13:return nl("Suspense");case 19:return nl("SuspenseList");case 0:case 15:return zu(u.type,!1);case 11:return zu(u.type.render,!1);case 1:return zu(u.type,!0);case 31:return nl("Activity");default:return""}}function lm(u){try{var p="";do p+=x_(u),u=u.return;while(u);return p}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function gs(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function Ad(u){var p=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function cm(u){var p=Ad(u)?"checked":"value",y=Object.getOwnPropertyDescriptor(u.constructor.prototype,p),S=""+u[p];if(!u.hasOwnProperty(p)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var O=y.get,L=y.set;return Object.defineProperty(u,p,{configurable:!0,get:function(){return O.call(this)},set:function(ne){S=""+ne,L.call(this,ne)}}),Object.defineProperty(u,p,{enumerable:y.enumerable}),{getValue:function(){return S},setValue:function(ne){S=""+ne},stopTracking:function(){u._valueTracker=null,delete u[p]}}}}function Zc(u){u._valueTracker||(u._valueTracker=cm(u))}function tf(u){if(!u)return!1;var p=u._valueTracker;if(!p)return!0;var y=p.getValue(),S="";return u&&(S=Ad(u)?u.checked?"true":"false":u.value),u=S,u!==y?(p.setValue(u),!0):!1}function Xc(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var Kl=/[\n"\\]/g;function Fa(u){return u.replace(Kl,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function Gc(u,p,y,S,O,L,ne,he){u.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?u.type=ne:u.removeAttribute("type"),p!=null?ne==="number"?(p===0&&u.value===""||u.value!=p)&&(u.value=""+gs(p)):u.value!==""+gs(p)&&(u.value=""+gs(p)):ne!=="submit"&&ne!=="reset"||u.removeAttribute("value"),p!=null?al(u,ne,gs(p)):y!=null?al(u,ne,gs(y)):S!=null&&u.removeAttribute("value"),O==null&&L!=null&&(u.defaultChecked=!!L),O!=null&&(u.checked=O&&typeof O!="function"&&typeof O!="symbol"),he!=null&&typeof he!="function"&&typeof he!="symbol"&&typeof he!="boolean"?u.name=""+gs(he):u.removeAttribute("name")}function Ql(u,p,y,S,O,L,ne,he){if(L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(u.type=L),p!=null||y!=null){if(!(L!=="submit"&&L!=="reset"||p!=null))return;y=y!=null?""+gs(y):"",p=p!=null?""+gs(p):y,he||p===u.value||(u.value=p),u.defaultValue=p}S=S??O,S=typeof S!="function"&&typeof S!="symbol"&&!!S,u.checked=he?u.checked:!!S,u.defaultChecked=!!S,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(u.name=ne)}function al(u,p,y){p==="number"&&Xc(u.ownerDocument)===u||u.defaultValue===""+y||(u.defaultValue=""+y)}function Jl(u,p,y,S){if(u=u.options,p){p={};for(var O=0;O<y.length;O++)p["$"+y[O]]=!0;for(y=0;y<u.length;y++)O=p.hasOwnProperty("$"+u[y].value),u[y].selected!==O&&(u[y].selected=O),O&&S&&(u[y].defaultSelected=!0)}else{for(y=""+gs(y),p=null,O=0;O<u.length;O++){if(u[O].value===y){u[O].selected=!0,S&&(u[O].defaultSelected=!0);return}p!==null||u[O].disabled||(p=u[O])}p!==null&&(p.selected=!0)}}function um(u,p,y){if(p!=null&&(p=""+gs(p),p!==u.value&&(u.value=p),y==null)){u.defaultValue!==p&&(u.defaultValue=p);return}u.defaultValue=y!=null?""+gs(y):""}function Qs(u,p,y,S){if(p==null){if(S!=null){if(y!=null)throw Error(n(92));if(ct(S)){if(1<S.length)throw Error(n(93));S=S[0]}y=S}y==null&&(y=""),p=y}y=gs(p),u.defaultValue=y,S=u.textContent,S===y&&S!==""&&S!==null&&(u.value=S)}function Os(u,p){if(p){var y=u.firstChild;if(y&&y===u.lastChild&&y.nodeType===3){y.nodeValue=p;return}}u.textContent=p}var kr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ur(u,p,y){var S=p.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?S?u.setProperty(p,""):p==="float"?u.cssFloat="":u[p]="":S?u.setProperty(p,y):typeof y!="number"||y===0||kr.has(p)?p==="float"?u.cssFloat=y:u[p]=(""+y).trim():u[p]=y+"px"}function ec(u,p,y){if(p!=null&&typeof p!="object")throw Error(n(62));if(u=u.style,y!=null){for(var S in y)!y.hasOwnProperty(S)||p!=null&&p.hasOwnProperty(S)||(S.indexOf("--")===0?u.setProperty(S,""):S==="float"?u.cssFloat="":u[S]="");for(var O in p)S=p[O],p.hasOwnProperty(O)&&y[O]!==S&&Ur(u,O,S)}else for(var L in p)p.hasOwnProperty(L)&&Ur(u,L,p[L])}function _s(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var za=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),sa=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mn(u){return sa.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}var tc=null;function Ii(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var Bi=null,gi=null;function bo(u){var p=ci(u);if(p&&(u=p.stateNode)){var y=u[_t]||null;e:switch(u=p.stateNode,p.type){case"input":if(Gc(u,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),p=y.name,y.type==="radio"&&p!=null){for(y=u;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Fa(""+p)+'"][type="radio"]'),p=0;p<y.length;p++){var S=y[p];if(S!==u&&S.form===u.form){var O=S[_t]||null;if(!O)throw Error(n(90));Gc(S,O.value,O.defaultValue,O.defaultValue,O.checked,O.defaultChecked,O.type,O.name)}}for(p=0;p<y.length;p++)S=y[p],S.form===u.form&&tf(S)}break e;case"textarea":um(u,y.value,y.defaultValue);break e;case"select":p=y.value,p!=null&&Jl(u,!!y.multiple,p,!1)}}}var rc=!1;function jn(u,p,y){if(rc)return u(p,y);rc=!0;try{var S=u(p);return S}finally{if(rc=!1,(Bi!==null||gi!==null)&&(Um(),Bi&&(p=Bi,u=gi,gi=Bi=null,bo(p),u)))for(p=0;p<u.length;p++)bo(u[p])}}function ja(u,p){var y=u.stateNode;if(y===null)return null;var S=y[_t]||null;if(S===null)return null;y=S[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(u=u.type,S=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!S;break e;default:u=!1}if(u)return null;if(y&&typeof y!="function")throw Error(n(231,p,typeof y));return y}var oa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nc=!1;if(oa)try{var la={};Object.defineProperty(la,"passive",{get:function(){nc=!0}}),window.addEventListener("test",la,la),window.removeEventListener("test",la,la)}catch{nc=!1}var ys=null,Gr=null,Yc=null;function Hr(){if(Yc)return Yc;var u,p=Gr,y=p.length,S,O="value"in ys?ys.value:ys.textContent,L=O.length;for(u=0;u<y&&p[u]===O[u];u++);var ne=y-u;for(S=1;S<=ne&&p[y-S]===O[L-S];S++);return Yc=O.slice(u,1<S?1-S:void 0)}function Ar(u){var p=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&p===13&&(u=13)):u=p,u===10&&(u=13),32<=u||u===13?u:0}function xo(){return!0}function $r(){return!1}function Li(u){function p(y,S,O,L,ne){this._reactName=y,this._targetInst=O,this.type=S,this.nativeEvent=L,this.target=ne,this.currentTarget=null;for(var he in u)u.hasOwnProperty(he)&&(y=u[he],this[he]=y?y(L):L[he]);return this.isDefaultPrevented=(L.defaultPrevented!=null?L.defaultPrevented:L.returnValue===!1)?xo:$r,this.isPropagationStopped=$r,this}return w(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=xo)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=xo)},persist:function(){},isPersistent:xo}),p}var Yi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wo=Li(Yi),sl=w({},Yi,{view:0,detail:0}),rf=Li(sl),ol,ic,To,ju=w({},sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jc,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==To&&(To&&u.type==="mousemove"?(ol=u.screenX-To.screenX,ic=u.screenY-To.screenY):ic=ol=0,To=u),ol)},movementY:function(u){return"movementY"in u?u.movementY:ic}}),Uu=Li(ju),Kc=w({},ju,{dataTransfer:0}),ca=Li(Kc),nf=w({},sl,{relatedTarget:0}),ua=Li(nf),Qc=w({},Yi,{animationName:0,elapsedTime:0,pseudoElement:0}),_n=Li(Qc),$u=w({},Yi,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),af=Li($u),Ed=w({},Yi,{data:0}),ac=Li(Ed),sf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Md={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},w_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function of(u){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(u):(u=w_[u])?!!p[u]:!1}function Jc(){return of}var ks=w({},sl,{key:function(u){if(u.key){var p=sf[u.key]||u.key;if(p!=="Unidentified")return p}return u.type==="keypress"?(u=Ar(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?Md[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jc,charCode:function(u){return u.type==="keypress"?Ar(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?Ar(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),Vu=Li(ks),eu=w({},ju,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qu=Li(eu),Hu=w({},sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jc}),Pd=Li(Hu),Js=w({},Yi,{propertyName:0,elapsedTime:0,pseudoElement:0}),T_=Li(Js),Cd=w({},ju,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),ll=Li(Cd),Wu=w({},Yi,{newState:0,oldState:0}),hm=Li(Wu),Zu=[9,13,27,32],Rd=oa&&"CompositionEvent"in window,Ds=null;oa&&"documentMode"in document&&(Ds=document.documentMode);var S_=oa&&"TextEvent"in window&&!Ds,Id=oa&&(!Rd||Ds&&8<Ds&&11>=Ds),fm=" ",Od=!1;function lf(u,p){switch(u){case"keyup":return Zu.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cf(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var cl=!1;function kd(u,p){switch(u){case"compositionend":return cf(p);case"keypress":return p.which!==32?null:(Od=!0,fm);case"textInput":return u=p.data,u===fm&&Od?null:u;default:return null}}function dm(u,p){if(cl)return u==="compositionend"||!Rd&&lf(u,p)?(u=Hr(),Yc=Gr=ys=null,cl=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return Id&&p.locale!=="ko"?null:p.data;default:return null}}var sc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dd(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p==="input"?!!sc[u.type]:p==="textarea"}function Xu(u,p,y,S){Bi?gi?gi.push(S):gi=[S]:Bi=S,p=bp(p,"onChange"),0<p.length&&(y=new wo("onChange","change",null,y,S),u.push({event:y,listeners:p}))}var So=null,Gu=null;function uf(u){Gm(u,0)}function Yu(u){var p=on(u);if(tf(p))return u}function Nd(u,p){if(u==="change")return p}var Bd=!1;if(oa){var hf;if(oa){var Ku="oninput"in document;if(!Ku){var Qu=document.createElement("div");Qu.setAttribute("oninput","return;"),Ku=typeof Qu.oninput=="function"}hf=Ku}else hf=!1;Bd=hf&&(!document.documentMode||9<document.documentMode)}function Ld(){So&&(So.detachEvent("onpropertychange",Ju),Gu=So=null)}function Ju(u){if(u.propertyName==="value"&&Yu(Gu)){var p=[];Xu(p,Gu,u,Ii(u)),jn(uf,p)}}function Ao(u,p,y){u==="focusin"?(Ld(),So=p,Gu=y,So.attachEvent("onpropertychange",Ju)):u==="focusout"&&Ld()}function ff(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return Yu(Gu)}function Fd(u,p){if(u==="click")return Yu(p)}function zd(u,p){if(u==="input"||u==="change")return Yu(p)}function pm(u,p){return u===p&&(u!==0||1/u===1/p)||u!==u&&p!==p}var Sa=typeof Object.is=="function"?Object.is:pm;function Dr(u,p){if(Sa(u,p))return!0;if(typeof u!="object"||u===null||typeof p!="object"||p===null)return!1;var y=Object.keys(u),S=Object.keys(p);if(y.length!==S.length)return!1;for(S=0;S<y.length;S++){var O=y[S];if(!mt.call(p,O)||!Sa(u[O],p[O]))return!1}return!0}function df(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function mm(u,p){var y=df(u);u=0;for(var S;y;){if(y.nodeType===3){if(S=u+y.textContent.length,u<=p&&S>=p)return{node:y,offset:p-u};u=S}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=df(y)}}function gm(u,p){return u&&p?u===p?!0:u&&u.nodeType===3?!1:p&&p.nodeType===3?gm(u,p.parentNode):"contains"in u?u.contains(p):u.compareDocumentPosition?!!(u.compareDocumentPosition(p)&16):!1:!1}function _m(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var p=Xc(u.document);p instanceof u.HTMLIFrameElement;){try{var y=typeof p.contentWindow.location.href=="string"}catch{y=!1}if(y)u=p.contentWindow;else break;p=Xc(u.document)}return p}function jd(u){var p=u&&u.nodeName&&u.nodeName.toLowerCase();return p&&(p==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||p==="textarea"||u.contentEditable==="true")}var ym=oa&&"documentMode"in document&&11>=document.documentMode,tu=null,pf=null,ul=null,ru=!1;function eh(u,p,y){var S=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;ru||tu==null||tu!==Xc(S)||(S=tu,"selectionStart"in S&&jd(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),ul&&Dr(ul,S)||(ul=S,S=bp(pf,"onSelect"),0<S.length&&(p=new wo("onSelect","select",null,p,y),u.push({event:p,listeners:S}),p.target=tu)))}function Eo(u,p){var y={};return y[u.toLowerCase()]=p.toLowerCase(),y["Webkit"+u]="webkit"+p,y["Moz"+u]="moz"+p,y}var vs={animationend:Eo("Animation","AnimationEnd"),animationiteration:Eo("Animation","AnimationIteration"),animationstart:Eo("Animation","AnimationStart"),transitionrun:Eo("Transition","TransitionRun"),transitionstart:Eo("Transition","TransitionStart"),transitioncancel:Eo("Transition","TransitionCancel"),transitionend:Eo("Transition","TransitionEnd")},hl={},ts={};oa&&(ts=document.createElement("div").style,"AnimationEvent"in window||(delete vs.animationend.animation,delete vs.animationiteration.animation,delete vs.animationstart.animation),"TransitionEvent"in window||delete vs.transitionend.transition);function fl(u){if(hl[u])return hl[u];if(!vs[u])return u;var p=vs[u],y;for(y in p)if(p.hasOwnProperty(y)&&y in ts)return hl[u]=p[y];return u}var Ud=fl("animationend"),mf=fl("animationiteration"),dl=fl("animationstart"),gf=fl("transitionrun"),_f=fl("transitionstart"),th=fl("transitioncancel"),rh=fl("transitionend"),$d=new Map,pl="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");pl.push("scrollEnd");function ha(u,p){$d.set(u,p),Ba(p,[u])}var Vd=new WeakMap;function Ua(u,p){if(typeof u=="object"&&u!==null){var y=Vd.get(u);return y!==void 0?y:(p={value:u,source:p,stack:lm(p)},Vd.set(u,p),p)}return{value:u,source:p,stack:lm(p)}}var Mr=[],Mo=0,qd=0;function oc(){for(var u=Mo,p=qd=Mo=0;p<u;){var y=Mr[p];Mr[p++]=null;var S=Mr[p];Mr[p++]=null;var O=Mr[p];Mr[p++]=null;var L=Mr[p];if(Mr[p++]=null,S!==null&&O!==null){var ne=S.pending;ne===null?O.next=O:(O.next=ne.next,ne.next=O),S.pending=O}L!==0&&yf(y,O,L)}}function ml(u,p,y,S){Mr[Mo++]=u,Mr[Mo++]=p,Mr[Mo++]=y,Mr[Mo++]=S,qd|=S,u.lanes|=S,u=u.alternate,u!==null&&(u.lanes|=S)}function Hd(u,p,y,S){return ml(u,p,y,S),vf(u)}function nu(u,p){return ml(u,null,null,p),vf(u)}function yf(u,p,y){u.lanes|=y;var S=u.alternate;S!==null&&(S.lanes|=y);for(var O=!1,L=u.return;L!==null;)L.childLanes|=y,S=L.alternate,S!==null&&(S.childLanes|=y),L.tag===22&&(u=L.stateNode,u===null||u._visibility&1||(O=!0)),u=L,L=L.return;return u.tag===3?(L=u.stateNode,O&&p!==null&&(O=31-Ci(y),u=L.hiddenUpdates,S=u[O],S===null?u[O]=[p]:S.push(p),p.lane=y|536870912),L):null}function vf(u){if(50<Th)throw Th=0,zm=null,Error(n(185));for(var p=u.return;p!==null;)u=p,p=u.return;return u.tag===3?u.stateNode:null}var gl={};function lc(u,p,y,S){this.tag=u,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ki(u,p,y,S){return new lc(u,p,y,S)}function nh(u){return u=u.prototype,!(!u||!u.isReactComponent)}function Ns(u,p){var y=u.alternate;return y===null?(y=Ki(u.tag,p,u.key,u.mode),y.elementType=u.elementType,y.type=u.type,y.stateNode=u.stateNode,y.alternate=u,u.alternate=y):(y.pendingProps=p,y.type=u.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=u.flags&65011712,y.childLanes=u.childLanes,y.lanes=u.lanes,y.child=u.child,y.memoizedProps=u.memoizedProps,y.memoizedState=u.memoizedState,y.updateQueue=u.updateQueue,p=u.dependencies,y.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},y.sibling=u.sibling,y.index=u.index,y.ref=u.ref,y.refCleanup=u.refCleanup,y}function Wd(u,p){u.flags&=65011714;var y=u.alternate;return y===null?(u.childLanes=0,u.lanes=p,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=y.childLanes,u.lanes=y.lanes,u.child=y.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=y.memoizedProps,u.memoizedState=y.memoizedState,u.updateQueue=y.updateQueue,u.type=y.type,p=y.dependencies,u.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),u}function cc(u,p,y,S,O,L){var ne=0;if(S=u,typeof u=="function")nh(u)&&(ne=1);else if(typeof u=="string")ne=Ee(u,y,Yt.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case Ce:return u=Ki(31,y,p,O),u.elementType=Ce,u.lanes=L,u;case z:return eo(y.children,O,L,p);case V:ne=8,O|=24;break;case U:return u=Ki(12,y,p,O|2),u.elementType=U,u.lanes=L,u;case W:return u=Ki(13,y,p,O),u.elementType=W,u.lanes=L,u;case Y:return u=Ki(19,y,p,O),u.elementType=Y,u.lanes=L,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case K:case Z:ne=10;break e;case J:ne=9;break e;case re:ne=11;break e;case ue:ne=14;break e;case be:ne=16,S=null;break e}ne=29,y=Error(n(130,u===null?"null":typeof u,"")),S=null}return p=Ki(ne,y,p,O),p.elementType=u,p.type=S,p.lanes=L,p}function eo(u,p,y,S){return u=Ki(7,u,S,p),u.lanes=y,u}function iu(u,p,y){return u=Ki(6,u,null,p),u.lanes=y,u}function bf(u,p,y){return p=Ki(4,u.children!==null?u.children:[],u.key,p),p.lanes=y,p.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},p}var _l=[],au=0,su=null,yl=0,Aa=[],$a=0,to=null,Va=1,rs="";function ro(u,p){_l[au++]=yl,_l[au++]=su,su=u,yl=p}function Zd(u,p,y){Aa[$a++]=Va,Aa[$a++]=rs,Aa[$a++]=to,to=u;var S=Va;u=rs;var O=32-Ci(S)-1;S&=~(1<<O),y+=1;var L=32-Ci(p)+O;if(30<L){var ne=O-O%5;L=(S&(1<<ne)-1).toString(32),S>>=ne,O-=ne,Va=1<<32-Ci(p)+O|y<<O|S,rs=L+u}else Va=1<<L|y<<O|S,rs=u}function Un(u){u.return!==null&&(ro(u,1),Zd(u,1,0))}function Po(u){for(;u===su;)su=_l[--au],_l[au]=null,yl=_l[--au],_l[au]=null;for(;u===to;)to=Aa[--$a],Aa[$a]=null,rs=Aa[--$a],Aa[$a]=null,Va=Aa[--$a],Aa[$a]=null}var Pn=null,$n=null,Yr=!1,Co=null,fa=!1,no=Error(n(519));function Ro(u){var p=Error(n(418,""));throw Ea(Ua(p,u)),no}function xf(u){var p=u.stateNode,y=u.type,S=u.memoizedProps;switch(p[_r]=u,p[_t]=S,y){case"dialog":Zr("cancel",p),Zr("close",p);break;case"iframe":case"object":case"embed":Zr("load",p);break;case"video":case"audio":for(y=0;y<Rc.length;y++)Zr(Rc[y],p);break;case"source":Zr("error",p);break;case"img":case"image":case"link":Zr("error",p),Zr("load",p);break;case"details":Zr("toggle",p);break;case"input":Zr("invalid",p),Ql(p,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0),Zc(p);break;case"select":Zr("invalid",p);break;case"textarea":Zr("invalid",p),Qs(p,S.value,S.defaultValue,S.children),Zc(p)}y=S.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||p.textContent===""+y||S.suppressHydrationWarning===!0||sy(p.textContent,y)?(S.popover!=null&&(Zr("beforetoggle",p),Zr("toggle",p)),S.onScroll!=null&&Zr("scroll",p),S.onScrollEnd!=null&&Zr("scrollend",p),S.onClick!=null&&(p.onclick=xp),p=!0):p=!1,p||Ro(u)}function wf(u){for(Pn=u.return;Pn;)switch(Pn.tag){case 5:case 13:fa=!1;return;case 27:case 3:fa=!0;return;default:Pn=Pn.return}}function ou(u){if(u!==Pn)return!1;if(!Yr)return wf(u),Yr=!0,!1;var p=u.tag,y;if((y=p!==3&&p!==27)&&((y=p===5)&&(y=u.type,y=!(y!=="form"&&y!=="button")||Xf(u.type,u.memoizedProps)),y=!y),y&&$n&&Ro(u),wf(u),p===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(n(317));e:{for(u=u.nextSibling,p=0;u;){if(u.nodeType===8)if(y=u.data,y==="/$"){if(p===0){$n=Vo(u.nextSibling);break e}p--}else y!=="$"&&y!=="$!"&&y!=="$?"||p++;u=u.nextSibling}$n=null}}else p===27?(p=$n,Dl(u.type)?(u=tg,tg=null,$n=u):$n=p):$n=Pn?Vo(u.stateNode.nextSibling):null;return!0}function uc(){$n=Pn=null,Yr=!1}function Tf(){var u=Co;return u!==null&&(cs===null?cs=u:cs.push.apply(cs,u),Co=null),u}function Ea(u){Co===null?Co=[u]:Co.push(u)}var Sf=ft(null),vl=null,io=null;function Io(u,p,y){Ct(Sf,p._currentValue),p._currentValue=y}function ao(u){u._currentValue=Sf.current,vt(Sf)}function Af(u,p,y){for(;u!==null;){var S=u.alternate;if((u.childLanes&p)!==p?(u.childLanes|=p,S!==null&&(S.childLanes|=p)):S!==null&&(S.childLanes&p)!==p&&(S.childLanes|=p),u===y)break;u=u.return}}function bl(u,p,y,S){var O=u.child;for(O!==null&&(O.return=u);O!==null;){var L=O.dependencies;if(L!==null){var ne=O.child;L=L.firstContext;e:for(;L!==null;){var he=L;L=O;for(var De=0;De<p.length;De++)if(he.context===p[De]){L.lanes|=y,he=L.alternate,he!==null&&(he.lanes|=y),Af(L.return,y,u),S||(ne=null);break e}L=he.next}}else if(O.tag===18){if(ne=O.return,ne===null)throw Error(n(341));ne.lanes|=y,L=ne.alternate,L!==null&&(L.lanes|=y),Af(ne,y,u),ne=null}else ne=O.child;if(ne!==null)ne.return=O;else for(ne=O;ne!==null;){if(ne===u){ne=null;break}if(O=ne.sibling,O!==null){O.return=ne.return,ne=O;break}ne=ne.return}O=ne}}function bs(u,p,y,S){u=null;for(var O=p,L=!1;O!==null;){if(!L){if((O.flags&524288)!==0)L=!0;else if((O.flags&262144)!==0)break}if(O.tag===10){var ne=O.alternate;if(ne===null)throw Error(n(387));if(ne=ne.memoizedProps,ne!==null){var he=O.type;Sa(O.pendingProps.value,ne.value)||(u!==null?u.push(he):u=[he])}}else if(O===tr.current){if(ne=O.alternate,ne===null)throw Error(n(387));ne.memoizedState.memoizedState!==O.memoizedState.memoizedState&&(u!==null?u.push(qt):u=[qt])}O=O.return}u!==null&&bl(p,u,y,S),p.flags|=262144}function Qi(u){for(u=u.firstContext;u!==null;){if(!Sa(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function ui(u){vl=u,io=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function Cn(u){return Bs(vl,u)}function ih(u,p){return vl===null&&ui(u),Bs(u,p)}function Bs(u,p){var y=p._currentValue;if(p={context:p,memoizedValue:y,next:null},io===null){if(u===null)throw Error(n(308));io=p,u.dependencies={lanes:0,firstContext:p},u.flags|=524288}else io=io.next=p;return y}var so=typeof AbortController<"u"?AbortController:function(){var u=[],p=this.signal={aborted:!1,addEventListener:function(y,S){u.push(S)}};this.abort=function(){p.aborted=!0,u.forEach(function(y){return y()})}},vm=t.unstable_scheduleCallback,Xd=t.unstable_NormalPriority,Oi={$$typeof:Z,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ah(){return{controller:new so,data:new Map,refCount:0}}function lu(u){u.refCount--,u.refCount===0&&vm(Xd,function(){u.controller.abort()})}var ns=null,Ls=0,Jt=0,hc=null;function Gd(u,p){if(ns===null){var y=ns=[];Ls=0,Jt=kl(),hc={status:"pending",value:void 0,then:function(S){y.push(S)}}}return Ls++,p.then(cu,cu),p}function cu(){if(--Ls===0&&ns!==null){hc!==null&&(hc.status="fulfilled");var u=ns;ns=null,Jt=0,hc=null;for(var p=0;p<u.length;p++)(0,u[p])()}}function sh(u,p){var y=[],S={status:"pending",value:null,reason:null,then:function(O){y.push(O)}};return u.then(function(){S.status="fulfilled",S.value=p;for(var O=0;O<y.length;O++)(0,y[O])(p)},function(O){for(S.status="rejected",S.reason=O,O=0;O<y.length;O++)(0,y[O])(void 0)}),S}var xl=Ie.S;Ie.S=function(u,p){typeof p=="object"&&p!==null&&typeof p.then=="function"&&Gd(u,p),xl!==null&&xl(u,p)};var Fs=ft(null);function Nr(){var u=Fs.current;return u!==null?u:Ln.pooledCache}function fc(u,p){p===null?Ct(Fs,Fs.current):Ct(Fs,p.pool)}function Yd(){var u=Nr();return u===null?null:{parent:Oi._currentValue,pool:u}}var wl=Error(n(460)),Ef=Error(n(474)),oh=Error(n(542)),Mf={then:function(){}};function lh(u){return u=u.status,u==="fulfilled"||u==="rejected"}function ch(){}function Kd(u,p,y){switch(y=u[y],y===void 0?u.push(p):y!==p&&(p.then(ch,ch),p=y),p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,bm(u),u;default:if(typeof p.status=="string")p.then(ch,ch);else{if(u=Ln,u!==null&&100<u.shellSuspendCounter)throw Error(n(482));u=p,u.status="pending",u.then(function(S){if(p.status==="pending"){var O=p;O.status="fulfilled",O.value=S}},function(S){if(p.status==="pending"){var O=p;O.status="rejected",O.reason=S}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw u=p.reason,bm(u),u}throw dc=p,wl}}var dc=null;function Qd(){if(dc===null)throw Error(n(459));var u=dc;return dc=null,u}function bm(u){if(u===wl||u===oh)throw Error(n(483))}var Ma=!1;function cn(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function pc(u,p){u=u.updateQueue,p.updateQueue===u&&(p.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function zs(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function oo(u,p,y){var S=u.updateQueue;if(S===null)return null;if(S=S.shared,(ln&2)!==0){var O=S.pending;return O===null?p.next=p:(p.next=O.next,O.next=p),S.pending=p,p=vf(u),yf(u,null,y),p}return ml(u,S,p,y),vf(u)}function Oo(u,p,y){if(p=p.updateQueue,p!==null&&(p=p.shared,(y&4194048)!==0)){var S=p.lanes;S&=u.pendingLanes,y|=S,p.lanes=y,bt(u,y)}}function Pf(u,p){var y=u.updateQueue,S=u.alternate;if(S!==null&&(S=S.updateQueue,y===S)){var O=null,L=null;if(y=y.firstBaseUpdate,y!==null){do{var ne={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};L===null?O=L=ne:L=L.next=ne,y=y.next}while(y!==null);L===null?O=L=p:L=L.next=p}else O=L=p;y={baseState:S.baseState,firstBaseUpdate:O,lastBaseUpdate:L,shared:S.shared,callbacks:S.callbacks},u.updateQueue=y;return}u=y.lastBaseUpdate,u===null?y.firstBaseUpdate=p:u.next=p,y.lastBaseUpdate=p}var uh=!1;function qa(){if(uh){var u=hc;if(u!==null)throw u}}function Tl(u,p,y,S){uh=!1;var O=u.updateQueue;Ma=!1;var L=O.firstBaseUpdate,ne=O.lastBaseUpdate,he=O.shared.pending;if(he!==null){O.shared.pending=null;var De=he,pt=De.next;De.next=null,ne===null?L=pt:ne.next=pt,ne=De;var Dt=u.alternate;Dt!==null&&(Dt=Dt.updateQueue,he=Dt.lastBaseUpdate,he!==ne&&(he===null?Dt.firstBaseUpdate=pt:he.next=pt,Dt.lastBaseUpdate=De))}if(L!==null){var Ut=O.baseState;ne=0,Dt=pt=De=null,he=L;do{var ht=he.lane&-536870913,yt=ht!==he.lane;if(yt?(Qr&ht)===ht:(S&ht)===ht){ht!==0&&ht===Jt&&(uh=!0),Dt!==null&&(Dt=Dt.next={lane:0,tag:he.tag,payload:he.payload,callback:null,next:null});e:{var Er=u,Sr=he;ht=p;var kn=y;switch(Sr.tag){case 1:if(Er=Sr.payload,typeof Er=="function"){Ut=Er.call(kn,Ut,ht);break e}Ut=Er;break e;case 3:Er.flags=Er.flags&-65537|128;case 0:if(Er=Sr.payload,ht=typeof Er=="function"?Er.call(kn,Ut,ht):Er,ht==null)break e;Ut=w({},Ut,ht);break e;case 2:Ma=!0}}ht=he.callback,ht!==null&&(u.flags|=64,yt&&(u.flags|=8192),yt=O.callbacks,yt===null?O.callbacks=[ht]:yt.push(ht))}else yt={lane:ht,tag:he.tag,payload:he.payload,callback:he.callback,next:null},Dt===null?(pt=Dt=yt,De=Ut):Dt=Dt.next=yt,ne|=ht;if(he=he.next,he===null){if(he=O.shared.pending,he===null)break;yt=he,he=yt.next,yt.next=null,O.lastBaseUpdate=yt,O.shared.pending=null}}while(!0);Dt===null&&(De=Ut),O.baseState=De,O.firstBaseUpdate=pt,O.lastBaseUpdate=Dt,L===null&&(O.shared.lanes=0),Pc|=ne,u.lanes=ne,u.memoizedState=Ut}}function ur(u,p){if(typeof u!="function")throw Error(n(191,u));u.call(p)}function xr(u,p){var y=u.callbacks;if(y!==null)for(u.callbacks=null,u=0;u<y.length;u++)ur(y[u],p)}var lo=ft(null),uu=ft(0);function Cf(u,p){u=Mc,Ct(uu,u),Ct(lo,p),Mc=u|p.baseLanes}function da(){Ct(uu,Mc),Ct(lo,lo.current)}function Rf(){Mc=uu.current,vt(lo),vt(uu)}var Ji=0,Or=null,Jr=null,Br=null,Vn=!1,Sl=!1,js=!1,mc=0,is=0,ko=null,hh=0;function Rn(){throw Error(n(321))}function gc(u,p){if(p===null)return!1;for(var y=0;y<p.length&&y<u.length;y++)if(!Sa(u[y],p[y]))return!1;return!0}function fh(u,p,y,S,O,L){return Ji=L,Or=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Ie.H=u===null||u.memoizedState===null?ep:Ml,js=!1,L=y(S,O),js=!1,Sl&&(L=Al(p,y,S,O)),_c(u),L}function _c(u){Ie.H=hn;var p=Jr!==null&&Jr.next!==null;if(Ji=0,Br=Jr=Or=null,Vn=!1,is=0,ko=null,p)throw Error(n(300));u===null||vi||(u=u.dependencies,u!==null&&Qi(u)&&(vi=!0))}function Al(u,p,y,S){Or=u;var O=0;do{if(Sl&&(ko=null),is=0,Sl=!1,25<=O)throw Error(n(301));if(O+=1,Br=Jr=null,u.updateQueue!=null){var L=u.updateQueue;L.lastEffect=null,L.events=null,L.stores=null,L.memoCache!=null&&(L.memoCache.index=0)}Ie.H=A_,L=p(y,S)}while(Sl);return L}function Jd(){var u=Ie.H,p=u.useState()[0];return p=typeof p.then=="function"?T(p):p,u=u.useState()[0],(Jr!==null?Jr.memoizedState:null)!==u&&(Or.flags|=1024),p}function hu(){var u=mc!==0;return mc=0,u}function Do(u,p,y){p.updateQueue=u.updateQueue,p.flags&=-2053,u.lanes&=~y}function dh(u){if(Vn){for(u=u.memoizedState;u!==null;){var p=u.queue;p!==null&&(p.pending=null),u=u.next}Vn=!1}Ji=0,Br=Jr=Or=null,Sl=!1,is=mc=0,ko=null}function ea(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Br===null?Or.memoizedState=Br=u:Br=Br.next=u,Br}function Qn(){if(Jr===null){var u=Or.alternate;u=u!==null?u.memoizedState:null}else u=Jr.next;var p=Br===null?Or.memoizedState:Br.next;if(p!==null)Br=p,Jr=u;else{if(u===null)throw Or.alternate===null?Error(n(467)):Error(n(310));Jr=u,u={memoizedState:Jr.memoizedState,baseState:Jr.baseState,baseQueue:Jr.baseQueue,queue:Jr.queue,next:null},Br===null?Or.memoizedState=Br=u:Br=Br.next=u}return Br}function ph(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function T(u){var p=is;return is+=1,ko===null&&(ko=[]),u=Kd(ko,u,p),p=Or,(Br===null?p.memoizedState:Br.next)===null&&(p=p.alternate,Ie.H=p===null||p.memoizedState===null?ep:Ml),u}function a(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return T(u);if(u.$$typeof===Z)return Cn(u)}throw Error(n(438,String(u)))}function h(u){var p=null,y=Or.updateQueue;if(y!==null&&(p=y.memoCache),p==null){var S=Or.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(p={data:S.data.map(function(O){return O.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),y===null&&(y=ph(),Or.updateQueue=y),y.memoCache=p,y=p.data[p.index],y===void 0)for(y=p.data[p.index]=Array(u),S=0;S<u;S++)y[S]=Ye;return p.index++,y}function _(u,p){return typeof p=="function"?p(u):p}function b(u){var p=Qn();return A(p,Jr,u)}function A(u,p,y){var S=u.queue;if(S===null)throw Error(n(311));S.lastRenderedReducer=y;var O=u.baseQueue,L=S.pending;if(L!==null){if(O!==null){var ne=O.next;O.next=L.next,L.next=ne}p.baseQueue=O=L,S.pending=null}if(L=u.baseState,O===null)u.memoizedState=L;else{p=O.next;var he=ne=null,De=null,pt=p,Dt=!1;do{var Ut=pt.lane&-536870913;if(Ut!==pt.lane?(Qr&Ut)===Ut:(Ji&Ut)===Ut){var ht=pt.revertLane;if(ht===0)De!==null&&(De=De.next={lane:0,revertLane:0,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null}),Ut===Jt&&(Dt=!0);else if((Ji&ht)===ht){pt=pt.next,ht===Jt&&(Dt=!0);continue}else Ut={lane:0,revertLane:pt.revertLane,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null},De===null?(he=De=Ut,ne=L):De=De.next=Ut,Or.lanes|=ht,Pc|=ht;Ut=pt.action,js&&y(L,Ut),L=pt.hasEagerState?pt.eagerState:y(L,Ut)}else ht={lane:Ut,revertLane:pt.revertLane,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null},De===null?(he=De=ht,ne=L):De=De.next=ht,Or.lanes|=Ut,Pc|=Ut;pt=pt.next}while(pt!==null&&pt!==p);if(De===null?ne=L:De.next=he,!Sa(L,u.memoizedState)&&(vi=!0,Dt&&(y=hc,y!==null)))throw y;u.memoizedState=L,u.baseState=ne,u.baseQueue=De,S.lastRenderedState=L}return O===null&&(S.lanes=0),[u.memoizedState,S.dispatch]}function C(u){var p=Qn(),y=p.queue;if(y===null)throw Error(n(311));y.lastRenderedReducer=u;var S=y.dispatch,O=y.pending,L=p.memoizedState;if(O!==null){y.pending=null;var ne=O=O.next;do L=u(L,ne.action),ne=ne.next;while(ne!==O);Sa(L,p.memoizedState)||(vi=!0),p.memoizedState=L,p.baseQueue===null&&(p.baseState=L),y.lastRenderedState=L}return[L,S]}function D(u,p,y){var S=Or,O=Qn(),L=Yr;if(L){if(y===void 0)throw Error(n(407));y=y()}else y=p();var ne=!Sa((Jr||O).memoizedState,y);ne&&(O.memoizedState=y,vi=!0),O=O.queue;var he=q.bind(null,S,O,u);if(Rt(2048,8,he,[u]),O.getSnapshot!==p||ne||Br!==null&&Br.memoizedState.tag&1){if(S.flags|=2048,St(9,Tt(),j.bind(null,S,O,y,p),null),Ln===null)throw Error(n(349));L||(Ji&124)!==0||B(S,p,y)}return y}function B(u,p,y){u.flags|=16384,u={getSnapshot:p,value:y},p=Or.updateQueue,p===null?(p=ph(),Or.updateQueue=p,p.stores=[u]):(y=p.stores,y===null?p.stores=[u]:y.push(u))}function j(u,p,y,S){p.value=y,p.getSnapshot=S,X(p)&&G(u)}function q(u,p,y){return y(function(){X(p)&&G(u)})}function X(u){var p=u.getSnapshot;u=u.value;try{var y=p();return!Sa(u,y)}catch{return!0}}function G(u){var p=nu(u,2);p!==null&&Pa(p,u,2)}function ae(u){var p=ea();if(typeof u=="function"){var y=u;if(u=y(),js){Xi(!0);try{y()}finally{Xi(!1)}}}return p.memoizedState=p.baseState=u,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:u},p}function se(u,p,y,S){return u.baseState=y,A(u,Jr,typeof S=="function"?S:_)}function ve(u,p,y,S,O){if(yn(u))throw Error(n(485));if(u=p.action,u!==null){var L={payload:O,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){L.listeners.push(ne)}};Ie.T!==null?y(!0):L.isTransition=!1,S(L),y=p.pending,y===null?(L.next=p.pending=L,_e(p,L)):(L.next=y.next,p.pending=y.next=L)}}function _e(u,p){var y=p.action,S=p.payload,O=u.state;if(p.isTransition){var L=Ie.T,ne={};Ie.T=ne;try{var he=y(O,S),De=Ie.S;De!==null&&De(ne,he),xe(u,p,he)}catch(pt){Oe(u,p,pt)}finally{Ie.T=L}}else try{L=y(O,S),xe(u,p,L)}catch(pt){Oe(u,p,pt)}}function xe(u,p,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(S){Ae(u,p,S)},function(S){return Oe(u,p,S)}):Ae(u,p,y)}function Ae(u,p,y){p.status="fulfilled",p.value=y,ke(p),u.state=y,p=u.pending,p!==null&&(y=p.next,y===p?u.pending=null:(y=y.next,p.next=y,_e(u,y)))}function Oe(u,p,y){var S=u.pending;if(u.pending=null,S!==null){S=S.next;do p.status="rejected",p.reason=y,ke(p),p=p.next;while(p!==S)}u.action=null}function ke(u){u=u.listeners;for(var p=0;p<u.length;p++)(0,u[p])()}function Be(u,p){return p}function je(u,p){if(Yr){var y=Ln.formState;if(y!==null){e:{var S=Or;if(Yr){if($n){t:{for(var O=$n,L=fa;O.nodeType!==8;){if(!L){O=null;break t}if(O=Vo(O.nextSibling),O===null){O=null;break t}}L=O.data,O=L==="F!"||L==="F"?O:null}if(O){$n=Vo(O.nextSibling),S=O.data==="F!";break e}}Ro(S)}S=!1}S&&(p=y[0])}}return y=ea(),y.memoizedState=y.baseState=p,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Be,lastRenderedState:p},y.queue=S,y=Bo.bind(null,Or,S),S.dispatch=y,S=ae(!1),L=Vs.bind(null,Or,!1,S.queue),S=ea(),O={state:p,dispatch:null,action:u,pending:null},S.queue=O,y=ve.bind(null,Or,O,L,y),O.dispatch=y,S.memoizedState=u,[p,y,!1]}function Le(u){var p=Qn();return nt(p,Jr,u)}function nt(u,p,y){if(p=A(u,p,Be)[0],u=b(_)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var S=T(p)}catch(ne){throw ne===wl?oh:ne}else S=p;p=Qn();var O=p.queue,L=O.dispatch;return y!==p.memoizedState&&(Or.flags|=2048,St(9,Tt(),lt.bind(null,O,y),null)),[S,L,u]}function lt(u,p){u.action=p}function At(u){var p=Qn(),y=Jr;if(y!==null)return nt(p,y,u);Qn(),p=p.memoizedState,y=Qn();var S=y.queue.dispatch;return y.memoizedState=u,[p,S,!1]}function St(u,p,y,S){return u={tag:u,create:y,deps:S,inst:p,next:null},p=Or.updateQueue,p===null&&(p=ph(),Or.updateQueue=p),y=p.lastEffect,y===null?p.lastEffect=u.next=u:(S=y.next,y.next=u,u.next=S,p.lastEffect=u),u}function Tt(){return{destroy:void 0,resource:void 0}}function Wt(){return Qn().memoizedState}function Ht(u,p,y,S){var O=ea();S=S===void 0?null:S,Or.flags|=u,O.memoizedState=St(1|p,Tt(),y,S)}function Rt(u,p,y,S){var O=Qn();S=S===void 0?null:S;var L=O.memoizedState.inst;Jr!==null&&S!==null&&gc(S,Jr.memoizedState.deps)?O.memoizedState=St(p,L,y,S):(Or.flags|=u,O.memoizedState=St(1|p,L,y,S))}function lr(u,p){Ht(8390656,8,u,p)}function Ir(u,p){Rt(2048,8,u,p)}function Tr(u,p){return Rt(4,2,u,p)}function In(u,p){return Rt(4,4,u,p)}function en(u,p){if(typeof p=="function"){u=u();var y=p(u);return function(){typeof y=="function"?y():p(null)}}if(p!=null)return u=u(),p.current=u,function(){p.current=null}}function On(u,p,y){y=y!=null?y.concat([u]):null,Rt(4,4,en.bind(null,p,u),y)}function un(){}function nn(u,p){var y=Qn();p=p===void 0?null:p;var S=y.memoizedState;return p!==null&&gc(p,S[1])?S[0]:(y.memoizedState=[u,p],u)}function Kr(u,p){var y=Qn();p=p===void 0?null:p;var S=y.memoizedState;if(p!==null&&gc(p,S[1]))return S[0];if(S=u(),js){Xi(!0);try{u()}finally{Xi(!1)}}return y.memoizedState=[S,p],S}function _i(u,p,y){return y===void 0||(Ji&1073741824)!==0?u.memoizedState=p:(u.memoizedState=y,u=pp(),Or.lanes|=u,Pc|=u,y)}function yi(u,p,y,S){return Sa(y,p)?y:lo.current!==null?(u=_i(u,y,S),Sa(u,p)||(vi=!0),u):(Ji&42)===0?(vi=!0,u.memoizedState=y):(u=pp(),Or.lanes|=u,Pc|=u,p)}function Fi(u,p,y,S,O){var L=et.p;et.p=L!==0&&8>L?L:8;var ne=Ie.T,he={};Ie.T=he,Vs(u,!1,p,y);try{var De=O(),pt=Ie.S;if(pt!==null&&pt(he,De),De!==null&&typeof De=="object"&&typeof De.then=="function"){var Dt=sh(De,S);ss(u,p,Dt,ji(u))}else ss(u,p,S,ji(u))}catch(Ut){ss(u,p,{then:function(){},status:"rejected",reason:Ut},ji())}finally{et.p=L,Ie.T=ne}}function pa(){}function xs(u,p,y,S){if(u.tag!==5)throw Error(n(476));var O=No(u).queue;Fi(u,O,p,ot,y===null?pa:function(){return co(u),y(S)})}function No(u){var p=u.memoizedState;if(p!==null)return p;p={memoizedState:ot,baseState:ot,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:ot},next:null};var y={};return p.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:y},next:null},u.memoizedState=p,u=u.alternate,u!==null&&(u.memoizedState=p),p}function co(u){var p=No(u).next.queue;ss(u,p,{},ji())}function Us(){return Cn(qt)}function $s(){return Qn().memoizedState}function El(){return Qn().memoizedState}function yc(u){for(var p=u.return;p!==null;){switch(p.tag){case 24:case 3:var y=ji();u=zs(y);var S=oo(p,u,y);S!==null&&(Pa(S,p,y),Oo(S,p,y)),p={cache:ah()},u.payload=p;return}p=p.return}}function as(u,p,y){var S=ji();y={lane:S,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},yn(u)?vn(p,y):(y=Hd(u,p,y,S),y!==null&&(Pa(y,u,S),Jn(y,p,S)))}function Bo(u,p,y){var S=ji();ss(u,p,y,S)}function ss(u,p,y,S){var O={lane:S,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(yn(u))vn(p,O);else{var L=u.alternate;if(u.lanes===0&&(L===null||L.lanes===0)&&(L=p.lastRenderedReducer,L!==null))try{var ne=p.lastRenderedState,he=L(ne,y);if(O.hasEagerState=!0,O.eagerState=he,Sa(he,ne))return ml(u,p,O,0),Ln===null&&oc(),!1}catch{}finally{}if(y=Hd(u,p,O,S),y!==null)return Pa(y,u,S),Jn(y,p,S),!0}return!1}function Vs(u,p,y,S){if(S={lane:2,revertLane:kl(),action:S,hasEagerState:!1,eagerState:null,next:null},yn(u)){if(p)throw Error(n(479))}else p=Hd(u,y,S,2),p!==null&&Pa(p,u,2)}function yn(u){var p=u.alternate;return u===Or||p!==null&&p===Or}function vn(u,p){Sl=Vn=!0;var y=u.pending;y===null?p.next=p:(p.next=y.next,y.next=p),u.pending=p}function Jn(u,p,y){if((y&4194048)!==0){var S=p.lanes;S&=u.pendingLanes,y|=S,p.lanes=y,bt(u,y)}}var hn={readContext:Cn,use:a,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useLayoutEffect:Rn,useInsertionEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useSyncExternalStore:Rn,useId:Rn,useHostTransitionStatus:Rn,useFormState:Rn,useActionState:Rn,useOptimistic:Rn,useMemoCache:Rn,useCacheRefresh:Rn},ep={readContext:Cn,use:a,useCallback:function(u,p){return ea().memoizedState=[u,p===void 0?null:p],u},useContext:Cn,useEffect:lr,useImperativeHandle:function(u,p,y){y=y!=null?y.concat([u]):null,Ht(4194308,4,en.bind(null,p,u),y)},useLayoutEffect:function(u,p){return Ht(4194308,4,u,p)},useInsertionEffect:function(u,p){Ht(4,2,u,p)},useMemo:function(u,p){var y=ea();p=p===void 0?null:p;var S=u();if(js){Xi(!0);try{u()}finally{Xi(!1)}}return y.memoizedState=[S,p],S},useReducer:function(u,p,y){var S=ea();if(y!==void 0){var O=y(p);if(js){Xi(!0);try{y(p)}finally{Xi(!1)}}}else O=p;return S.memoizedState=S.baseState=O,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:O},S.queue=u,u=u.dispatch=as.bind(null,Or,u),[S.memoizedState,u]},useRef:function(u){var p=ea();return u={current:u},p.memoizedState=u},useState:function(u){u=ae(u);var p=u.queue,y=Bo.bind(null,Or,p);return p.dispatch=y,[u.memoizedState,y]},useDebugValue:un,useDeferredValue:function(u,p){var y=ea();return _i(y,u,p)},useTransition:function(){var u=ae(!1);return u=Fi.bind(null,Or,u.queue,!0,!1),ea().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,p,y){var S=Or,O=ea();if(Yr){if(y===void 0)throw Error(n(407));y=y()}else{if(y=p(),Ln===null)throw Error(n(349));(Qr&124)!==0||B(S,p,y)}O.memoizedState=y;var L={value:y,getSnapshot:p};return O.queue=L,lr(q.bind(null,S,L,u),[u]),S.flags|=2048,St(9,Tt(),j.bind(null,S,L,y,p),null),y},useId:function(){var u=ea(),p=Ln.identifierPrefix;if(Yr){var y=rs,S=Va;y=(S&~(1<<32-Ci(S)-1)).toString(32)+y,p="«"+p+"R"+y,y=mc++,0<y&&(p+="H"+y.toString(32)),p+="»"}else y=hh++,p="«"+p+"r"+y.toString(32)+"»";return u.memoizedState=p},useHostTransitionStatus:Us,useFormState:je,useActionState:je,useOptimistic:function(u){var p=ea();p.memoizedState=p.baseState=u;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=y,p=Vs.bind(null,Or,!0,y),y.dispatch=p,[u,p]},useMemoCache:h,useCacheRefresh:function(){return ea().memoizedState=yc.bind(null,Or)}},Ml={readContext:Cn,use:a,useCallback:nn,useContext:Cn,useEffect:Ir,useImperativeHandle:On,useInsertionEffect:Tr,useLayoutEffect:In,useMemo:Kr,useReducer:b,useRef:Wt,useState:function(){return b(_)},useDebugValue:un,useDeferredValue:function(u,p){var y=Qn();return yi(y,Jr.memoizedState,u,p)},useTransition:function(){var u=b(_)[0],p=Qn().memoizedState;return[typeof u=="boolean"?u:T(u),p]},useSyncExternalStore:D,useId:$s,useHostTransitionStatus:Us,useFormState:Le,useActionState:Le,useOptimistic:function(u,p){var y=Qn();return se(y,Jr,u,p)},useMemoCache:h,useCacheRefresh:El},A_={readContext:Cn,use:a,useCallback:nn,useContext:Cn,useEffect:Ir,useImperativeHandle:On,useInsertionEffect:Tr,useLayoutEffect:In,useMemo:Kr,useReducer:C,useRef:Wt,useState:function(){return C(_)},useDebugValue:un,useDeferredValue:function(u,p){var y=Qn();return Jr===null?_i(y,u,p):yi(y,Jr.memoizedState,u,p)},useTransition:function(){var u=C(_)[0],p=Qn().memoizedState;return[typeof u=="boolean"?u:T(u),p]},useSyncExternalStore:D,useId:$s,useHostTransitionStatus:Us,useFormState:At,useActionState:At,useOptimistic:function(u,p){var y=Qn();return Jr!==null?se(y,Jr,u,p):(y.baseState=u,[u,y.queue.dispatch])},useMemoCache:h,useCacheRefresh:El},vc=null,bc=0;function mh(u){var p=bc;return bc+=1,vc===null&&(vc=[]),Kd(vc,u,p)}function ta(u,p){p=p.props.ref,u.ref=p!==void 0?p:null}function qs(u,p){throw p.$$typeof===M?Error(n(525)):(u=Object.prototype.toString.call(p),Error(n(31,u==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":u)))}function If(u){var p=u._init;return p(u._payload)}function tp(u){function p(Je,ze){if(u){var tt=Je.deletions;tt===null?(Je.deletions=[ze],Je.flags|=16):tt.push(ze)}}function y(Je,ze){if(!u)return null;for(;ze!==null;)p(Je,ze),ze=ze.sibling;return null}function S(Je){for(var ze=new Map;Je!==null;)Je.key!==null?ze.set(Je.key,Je):ze.set(Je.index,Je),Je=Je.sibling;return ze}function O(Je,ze){return Je=Ns(Je,ze),Je.index=0,Je.sibling=null,Je}function L(Je,ze,tt){return Je.index=tt,u?(tt=Je.alternate,tt!==null?(tt=tt.index,tt<ze?(Je.flags|=67108866,ze):tt):(Je.flags|=67108866,ze)):(Je.flags|=1048576,ze)}function ne(Je){return u&&Je.alternate===null&&(Je.flags|=67108866),Je}function he(Je,ze,tt,Ot){return ze===null||ze.tag!==6?(ze=iu(tt,Je.mode,Ot),ze.return=Je,ze):(ze=O(ze,tt),ze.return=Je,ze)}function De(Je,ze,tt,Ot){var or=tt.type;return or===z?Dt(Je,ze,tt.props.children,Ot,tt.key):ze!==null&&(ze.elementType===or||typeof or=="object"&&or!==null&&or.$$typeof===be&&If(or)===ze.type)?(ze=O(ze,tt.props),ta(ze,tt),ze.return=Je,ze):(ze=cc(tt.type,tt.key,tt.props,null,Je.mode,Ot),ta(ze,tt),ze.return=Je,ze)}function pt(Je,ze,tt,Ot){return ze===null||ze.tag!==4||ze.stateNode.containerInfo!==tt.containerInfo||ze.stateNode.implementation!==tt.implementation?(ze=bf(tt,Je.mode,Ot),ze.return=Je,ze):(ze=O(ze,tt.children||[]),ze.return=Je,ze)}function Dt(Je,ze,tt,Ot,or){return ze===null||ze.tag!==7?(ze=eo(tt,Je.mode,Ot,or),ze.return=Je,ze):(ze=O(ze,tt),ze.return=Je,ze)}function Ut(Je,ze,tt){if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return ze=iu(""+ze,Je.mode,tt),ze.return=Je,ze;if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case I:return tt=cc(ze.type,ze.key,ze.props,null,Je.mode,tt),ta(tt,ze),tt.return=Je,tt;case k:return ze=bf(ze,Je.mode,tt),ze.return=Je,ze;case be:var Ot=ze._init;return ze=Ot(ze._payload),Ut(Je,ze,tt)}if(ct(ze)||Ue(ze))return ze=eo(ze,Je.mode,tt,null),ze.return=Je,ze;if(typeof ze.then=="function")return Ut(Je,mh(ze),tt);if(ze.$$typeof===Z)return Ut(Je,ih(Je,ze),tt);qs(Je,ze)}return null}function ht(Je,ze,tt,Ot){var or=ze!==null?ze.key:null;if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return or!==null?null:he(Je,ze,""+tt,Ot);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case I:return tt.key===or?De(Je,ze,tt,Ot):null;case k:return tt.key===or?pt(Je,ze,tt,Ot):null;case be:return or=tt._init,tt=or(tt._payload),ht(Je,ze,tt,Ot)}if(ct(tt)||Ue(tt))return or!==null?null:Dt(Je,ze,tt,Ot,null);if(typeof tt.then=="function")return ht(Je,ze,mh(tt),Ot);if(tt.$$typeof===Z)return ht(Je,ze,ih(Je,tt),Ot);qs(Je,tt)}return null}function yt(Je,ze,tt,Ot,or){if(typeof Ot=="string"&&Ot!==""||typeof Ot=="number"||typeof Ot=="bigint")return Je=Je.get(tt)||null,he(ze,Je,""+Ot,or);if(typeof Ot=="object"&&Ot!==null){switch(Ot.$$typeof){case I:return Je=Je.get(Ot.key===null?tt:Ot.key)||null,De(ze,Je,Ot,or);case k:return Je=Je.get(Ot.key===null?tt:Ot.key)||null,pt(ze,Je,Ot,or);case be:var Lr=Ot._init;return Ot=Lr(Ot._payload),yt(Je,ze,tt,Ot,or)}if(ct(Ot)||Ue(Ot))return Je=Je.get(tt)||null,Dt(ze,Je,Ot,or,null);if(typeof Ot.then=="function")return yt(Je,ze,tt,mh(Ot),or);if(Ot.$$typeof===Z)return yt(Je,ze,tt,ih(ze,Ot),or);qs(ze,Ot)}return null}function Er(Je,ze,tt,Ot){for(var or=null,Lr=null,pr=ze,Pr=ze=0,Ka=null;pr!==null&&Pr<tt.length;Pr++){pr.index>Pr?(Ka=pr,pr=null):Ka=pr.sibling;var dn=ht(Je,pr,tt[Pr],Ot);if(dn===null){pr===null&&(pr=Ka);break}u&&pr&&dn.alternate===null&&p(Je,pr),ze=L(dn,ze,Pr),Lr===null?or=dn:Lr.sibling=dn,Lr=dn,pr=Ka}if(Pr===tt.length)return y(Je,pr),Yr&&ro(Je,Pr),or;if(pr===null){for(;Pr<tt.length;Pr++)pr=Ut(Je,tt[Pr],Ot),pr!==null&&(ze=L(pr,ze,Pr),Lr===null?or=pr:Lr.sibling=pr,Lr=pr);return Yr&&ro(Je,Pr),or}for(pr=S(pr);Pr<tt.length;Pr++)Ka=yt(pr,Je,Pr,tt[Pr],Ot),Ka!==null&&(u&&Ka.alternate!==null&&pr.delete(Ka.key===null?Pr:Ka.key),ze=L(Ka,ze,Pr),Lr===null?or=Ka:Lr.sibling=Ka,Lr=Ka);return u&&pr.forEach(function(Jf){return p(Je,Jf)}),Yr&&ro(Je,Pr),or}function Sr(Je,ze,tt,Ot){if(tt==null)throw Error(n(151));for(var or=null,Lr=null,pr=ze,Pr=ze=0,Ka=null,dn=tt.next();pr!==null&&!dn.done;Pr++,dn=tt.next()){pr.index>Pr?(Ka=pr,pr=null):Ka=pr.sibling;var Jf=ht(Je,pr,dn.value,Ot);if(Jf===null){pr===null&&(pr=Ka);break}u&&pr&&Jf.alternate===null&&p(Je,pr),ze=L(Jf,ze,Pr),Lr===null?or=Jf:Lr.sibling=Jf,Lr=Jf,pr=Ka}if(dn.done)return y(Je,pr),Yr&&ro(Je,Pr),or;if(pr===null){for(;!dn.done;Pr++,dn=tt.next())dn=Ut(Je,dn.value,Ot),dn!==null&&(ze=L(dn,ze,Pr),Lr===null?or=dn:Lr.sibling=dn,Lr=dn);return Yr&&ro(Je,Pr),or}for(pr=S(pr);!dn.done;Pr++,dn=tt.next())dn=yt(pr,Je,Pr,dn.value,Ot),dn!==null&&(u&&dn.alternate!==null&&pr.delete(dn.key===null?Pr:dn.key),ze=L(dn,ze,Pr),Lr===null?or=dn:Lr.sibling=dn,Lr=dn);return u&&pr.forEach(function(bU){return p(Je,bU)}),Yr&&ro(Je,Pr),or}function kn(Je,ze,tt,Ot){if(typeof tt=="object"&&tt!==null&&tt.type===z&&tt.key===null&&(tt=tt.props.children),typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case I:e:{for(var or=tt.key;ze!==null;){if(ze.key===or){if(or=tt.type,or===z){if(ze.tag===7){y(Je,ze.sibling),Ot=O(ze,tt.props.children),Ot.return=Je,Je=Ot;break e}}else if(ze.elementType===or||typeof or=="object"&&or!==null&&or.$$typeof===be&&If(or)===ze.type){y(Je,ze.sibling),Ot=O(ze,tt.props),ta(Ot,tt),Ot.return=Je,Je=Ot;break e}y(Je,ze);break}else p(Je,ze);ze=ze.sibling}tt.type===z?(Ot=eo(tt.props.children,Je.mode,Ot,tt.key),Ot.return=Je,Je=Ot):(Ot=cc(tt.type,tt.key,tt.props,null,Je.mode,Ot),ta(Ot,tt),Ot.return=Je,Je=Ot)}return ne(Je);case k:e:{for(or=tt.key;ze!==null;){if(ze.key===or)if(ze.tag===4&&ze.stateNode.containerInfo===tt.containerInfo&&ze.stateNode.implementation===tt.implementation){y(Je,ze.sibling),Ot=O(ze,tt.children||[]),Ot.return=Je,Je=Ot;break e}else{y(Je,ze);break}else p(Je,ze);ze=ze.sibling}Ot=bf(tt,Je.mode,Ot),Ot.return=Je,Je=Ot}return ne(Je);case be:return or=tt._init,tt=or(tt._payload),kn(Je,ze,tt,Ot)}if(ct(tt))return Er(Je,ze,tt,Ot);if(Ue(tt)){if(or=Ue(tt),typeof or!="function")throw Error(n(150));return tt=or.call(tt),Sr(Je,ze,tt,Ot)}if(typeof tt.then=="function")return kn(Je,ze,mh(tt),Ot);if(tt.$$typeof===Z)return kn(Je,ze,ih(Je,tt),Ot);qs(Je,tt)}return typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint"?(tt=""+tt,ze!==null&&ze.tag===6?(y(Je,ze.sibling),Ot=O(ze,tt),Ot.return=Je,Je=Ot):(y(Je,ze),Ot=iu(tt,Je.mode,Ot),Ot.return=Je,Je=Ot),ne(Je)):y(Je,ze)}return function(Je,ze,tt,Ot){try{bc=0;var or=kn(Je,ze,tt,Ot);return vc=null,or}catch(pr){if(pr===wl||pr===oh)throw pr;var Lr=Ki(29,pr,null,Je.mode);return Lr.lanes=Ot,Lr.return=Je,Lr}finally{}}}var uo=tp(!0),Of=tp(!1),Ha=ft(null),Lo=null;function fu(u){var p=u.alternate;Ct(zi,zi.current&1),Ct(Ha,u),Lo===null&&(p===null||lo.current!==null||p.memoizedState!==null)&&(Lo=u)}function xm(u){if(u.tag===22){if(Ct(zi,zi.current),Ct(Ha,u),Lo===null){var p=u.alternate;p!==null&&p.memoizedState!==null&&(Lo=u)}}else du()}function du(){Ct(zi,zi.current),Ct(Ha,Ha.current)}function Fo(u){vt(Ha),Lo===u&&(Lo=null),vt(zi)}var zi=ft(0);function rp(u){for(var p=u;p!==null;){if(p.tag===13){var y=p.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||eg(y)))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}function xc(u,p,y,S){p=u.memoizedState,y=y(S,p),y=y==null?p:w({},p,y),u.memoizedState=y,u.lanes===0&&(u.updateQueue.baseState=y)}var E_={enqueueSetState:function(u,p,y){u=u._reactInternals;var S=ji(),O=zs(S);O.payload=p,y!=null&&(O.callback=y),p=oo(u,O,S),p!==null&&(Pa(p,u,S),Oo(p,u,S))},enqueueReplaceState:function(u,p,y){u=u._reactInternals;var S=ji(),O=zs(S);O.tag=1,O.payload=p,y!=null&&(O.callback=y),p=oo(u,O,S),p!==null&&(Pa(p,u,S),Oo(p,u,S))},enqueueForceUpdate:function(u,p){u=u._reactInternals;var y=ji(),S=zs(y);S.tag=2,p!=null&&(S.callback=p),p=oo(u,S,y),p!==null&&(Pa(p,u,y),Oo(p,u,y))}};function kf(u,p,y,S,O,L,ne){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(S,L,ne):p.prototype&&p.prototype.isPureReactComponent?!Dr(y,S)||!Dr(O,L):!0}function np(u,p,y,S){u=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(y,S),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(y,S),p.state!==u&&E_.enqueueReplaceState(p,p.state,null)}function Pl(u,p){var y=p;if("ref"in p){y={};for(var S in p)S!=="ref"&&(y[S]=p[S])}if(u=u.defaultProps){y===p&&(y=w({},y));for(var O in u)y[O]===void 0&&(y[O]=u[O])}return y}var ip=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)};function M_(u){ip(u)}function tb(u){console.error(u)}function rb(u){ip(u)}function ap(u,p){try{var y=u.onUncaughtError;y(p.value,{componentStack:p.stack})}catch(S){setTimeout(function(){throw S})}}function P_(u,p,y){try{var S=u.onCaughtError;S(y.value,{componentStack:y.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(O){setTimeout(function(){throw O})}}function wm(u,p,y){return y=zs(y),y.tag=3,y.payload={element:null},y.callback=function(){ap(u,p)},y}function nb(u){return u=zs(u),u.tag=3,u}function Tm(u,p,y,S){var O=y.type.getDerivedStateFromError;if(typeof O=="function"){var L=S.value;u.payload=function(){return O(L)},u.callback=function(){P_(p,y,S)}}var ne=y.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(u.callback=function(){P_(p,y,S),typeof O!="function"&&(Il===null?Il=new Set([this]):Il.add(this));var he=S.stack;this.componentDidCatch(S.value,{componentStack:he!==null?he:""})})}function ib(u,p,y,S,O){if(y.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(p=y.alternate,p!==null&&bs(p,y,O,!0),y=Ha.current,y!==null){switch(y.tag){case 13:return Lo===null?gp():y.alternate===null&&xi===0&&(xi=3),y.flags&=-257,y.flags|=65536,y.lanes=O,S===Mf?y.flags|=16384:(p=y.updateQueue,p===null?y.updateQueue=new Set([S]):p.add(S),yp(u,S,O)),!1;case 22:return y.flags|=65536,S===Mf?y.flags|=16384:(p=y.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([S])},y.updateQueue=p):(y=p.retryQueue,y===null?p.retryQueue=new Set([S]):y.add(S)),yp(u,S,O)),!1}throw Error(n(435,y.tag))}return yp(u,S,O),gp(),!1}if(Yr)return p=Ha.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=O,S!==no&&(u=Error(n(422),{cause:S}),Ea(Ua(u,y)))):(S!==no&&(p=Error(n(423),{cause:S}),Ea(Ua(p,y))),u=u.current.alternate,u.flags|=65536,O&=-O,u.lanes|=O,S=Ua(S,y),O=wm(u.stateNode,S,O),Pf(u,O),xi!==4&&(xi=2)),!1;var L=Error(n(520),{cause:S});if(L=Ua(L,y),wh===null?wh=[L]:wh.push(L),xi!==4&&(xi=2),p===null)return!0;S=Ua(S,y),y=p;do{switch(y.tag){case 3:return y.flags|=65536,u=O&-O,y.lanes|=u,u=wm(y.stateNode,S,u),Pf(y,u),!1;case 1:if(p=y.type,L=y.stateNode,(y.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(Il===null||!Il.has(L))))return y.flags|=65536,O&=-O,y.lanes|=O,O=nb(O),Tm(O,u,y,S),Pf(y,O),!1}y=y.return}while(y!==null);return!1}var Sm=Error(n(461)),vi=!1;function bn(u,p,y,S){p.child=u===null?Of(p,null,y,S):uo(p,u.child,y,S)}function C_(u,p,y,S,O){y=y.render;var L=p.ref;if("ref"in S){var ne={};for(var he in S)he!=="ref"&&(ne[he]=S[he])}else ne=S;return ui(p),S=fh(u,p,y,ne,L,O),he=hu(),u!==null&&!vi?(Do(u,p,O),zo(u,p,O)):(Yr&&he&&Un(p),p.flags|=1,bn(u,p,S,O),p.child)}function Am(u,p,y,S,O){if(u===null){var L=y.type;return typeof L=="function"&&!nh(L)&&L.defaultProps===void 0&&y.compare===null?(p.tag=15,p.type=L,ab(u,p,L,S,O)):(u=cc(y.type,null,S,p,p.mode,O),u.ref=p.ref,u.return=p,p.child=u)}if(L=u.child,!N_(u,O)){var ne=L.memoizedProps;if(y=y.compare,y=y!==null?y:Dr,y(ne,S)&&u.ref===p.ref)return zo(u,p,O)}return p.flags|=1,u=Ns(L,S),u.ref=p.ref,u.return=p,p.child=u}function ab(u,p,y,S,O){if(u!==null){var L=u.memoizedProps;if(Dr(L,S)&&u.ref===p.ref)if(vi=!1,p.pendingProps=S=L,N_(u,O))(u.flags&131072)!==0&&(vi=!0);else return p.lanes=u.lanes,zo(u,p,O)}return I_(u,p,y,S,O)}function R_(u,p,y){var S=p.pendingProps,O=S.children,L=u!==null?u.memoizedState:null;if(S.mode==="hidden"){if((p.flags&128)!==0){if(S=L!==null?L.baseLanes|y:y,u!==null){for(O=p.child=u.child,L=0;O!==null;)L=L|O.lanes|O.childLanes,O=O.sibling;p.childLanes=L&~S}else p.childLanes=0,p.child=null;return sb(u,p,S,y)}if((y&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},u!==null&&fc(p,L!==null?L.cachePool:null),L!==null?Cf(p,L):da(),xm(p);else return p.lanes=p.childLanes=536870912,sb(u,p,L!==null?L.baseLanes|y:y,y)}else L!==null?(fc(p,L.cachePool),Cf(p,L),du(),p.memoizedState=null):(u!==null&&fc(p,null),da(),du());return bn(u,p,O,y),p.child}function sb(u,p,y,S){var O=Nr();return O=O===null?null:{parent:Oi._currentValue,pool:O},p.memoizedState={baseLanes:y,cachePool:O},u!==null&&fc(p,null),da(),xm(p),u!==null&&bs(u,p,S,!0),null}function Em(u,p){var y=p.ref;if(y===null)u!==null&&u.ref!==null&&(p.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(n(284));(u===null||u.ref!==y)&&(p.flags|=4194816)}}function I_(u,p,y,S,O){return ui(p),y=fh(u,p,y,S,void 0,O),S=hu(),u!==null&&!vi?(Do(u,p,O),zo(u,p,O)):(Yr&&S&&Un(p),p.flags|=1,bn(u,p,y,O),p.child)}function ob(u,p,y,S,O,L){return ui(p),p.updateQueue=null,y=Al(p,S,y,O),_c(u),S=hu(),u!==null&&!vi?(Do(u,p,L),zo(u,p,L)):(Yr&&S&&Un(p),p.flags|=1,bn(u,p,y,L),p.child)}function Mm(u,p,y,S,O){if(ui(p),p.stateNode===null){var L=gl,ne=y.contextType;typeof ne=="object"&&ne!==null&&(L=Cn(ne)),L=new y(S,L),p.memoizedState=L.state!==null&&L.state!==void 0?L.state:null,L.updater=E_,p.stateNode=L,L._reactInternals=p,L=p.stateNode,L.props=S,L.state=p.memoizedState,L.refs={},cn(p),ne=y.contextType,L.context=typeof ne=="object"&&ne!==null?Cn(ne):gl,L.state=p.memoizedState,ne=y.getDerivedStateFromProps,typeof ne=="function"&&(xc(p,y,ne,S),L.state=p.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof L.getSnapshotBeforeUpdate=="function"||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(ne=L.state,typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount(),ne!==L.state&&E_.enqueueReplaceState(L,L.state,null),Tl(p,S,L,O),qa(),L.state=p.memoizedState),typeof L.componentDidMount=="function"&&(p.flags|=4194308),S=!0}else if(u===null){L=p.stateNode;var he=p.memoizedProps,De=Pl(y,he);L.props=De;var pt=L.context,Dt=y.contextType;ne=gl,typeof Dt=="object"&&Dt!==null&&(ne=Cn(Dt));var Ut=y.getDerivedStateFromProps;Dt=typeof Ut=="function"||typeof L.getSnapshotBeforeUpdate=="function",he=p.pendingProps!==he,Dt||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(he||pt!==ne)&&np(p,L,S,ne),Ma=!1;var ht=p.memoizedState;L.state=ht,Tl(p,S,L,O),qa(),pt=p.memoizedState,he||ht!==pt||Ma?(typeof Ut=="function"&&(xc(p,y,Ut,S),pt=p.memoizedState),(De=Ma||kf(p,y,De,S,ht,pt,ne))?(Dt||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(p.flags|=4194308)):(typeof L.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=S,p.memoizedState=pt),L.props=S,L.state=pt,L.context=ne,S=De):(typeof L.componentDidMount=="function"&&(p.flags|=4194308),S=!1)}else{L=p.stateNode,pc(u,p),ne=p.memoizedProps,Dt=Pl(y,ne),L.props=Dt,Ut=p.pendingProps,ht=L.context,pt=y.contextType,De=gl,typeof pt=="object"&&pt!==null&&(De=Cn(pt)),he=y.getDerivedStateFromProps,(pt=typeof he=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(ne!==Ut||ht!==De)&&np(p,L,S,De),Ma=!1,ht=p.memoizedState,L.state=ht,Tl(p,S,L,O),qa();var yt=p.memoizedState;ne!==Ut||ht!==yt||Ma||u!==null&&u.dependencies!==null&&Qi(u.dependencies)?(typeof he=="function"&&(xc(p,y,he,S),yt=p.memoizedState),(Dt=Ma||kf(p,y,Dt,S,ht,yt,De)||u!==null&&u.dependencies!==null&&Qi(u.dependencies))?(pt||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(S,yt,De),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(S,yt,De)),typeof L.componentDidUpdate=="function"&&(p.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof L.componentDidUpdate!="function"||ne===u.memoizedProps&&ht===u.memoizedState||(p.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||ne===u.memoizedProps&&ht===u.memoizedState||(p.flags|=1024),p.memoizedProps=S,p.memoizedState=yt),L.props=S,L.state=yt,L.context=De,S=Dt):(typeof L.componentDidUpdate!="function"||ne===u.memoizedProps&&ht===u.memoizedState||(p.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||ne===u.memoizedProps&&ht===u.memoizedState||(p.flags|=1024),S=!1)}return L=S,Em(u,p),S=(p.flags&128)!==0,L||S?(L=p.stateNode,y=S&&typeof y.getDerivedStateFromError!="function"?null:L.render(),p.flags|=1,u!==null&&S?(p.child=uo(p,u.child,null,O),p.child=uo(p,null,y,O)):bn(u,p,y,O),p.memoizedState=L.state,u=p.child):u=zo(u,p,O),u}function Pm(u,p,y,S){return uc(),p.flags|=256,bn(u,p,y,S),p.child}var Cm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wc(u){return{baseLanes:u,cachePool:Yd()}}function gh(u,p,y){return u=u!==null?u.childLanes&~y:0,p&&(u|=Xa),u}function lb(u,p,y){var S=p.pendingProps,O=!1,L=(p.flags&128)!==0,ne;if((ne=L)||(ne=u!==null&&u.memoizedState===null?!1:(zi.current&2)!==0),ne&&(O=!0,p.flags&=-129),ne=(p.flags&32)!==0,p.flags&=-33,u===null){if(Yr){if(O?fu(p):du(),Yr){var he=$n,De;if(De=he){e:{for(De=he,he=fa;De.nodeType!==8;){if(!he){he=null;break e}if(De=Vo(De.nextSibling),De===null){he=null;break e}}he=De}he!==null?(p.memoizedState={dehydrated:he,treeContext:to!==null?{id:Va,overflow:rs}:null,retryLane:536870912,hydrationErrors:null},De=Ki(18,null,null,0),De.stateNode=he,De.return=p,p.child=De,Pn=p,$n=null,De=!0):De=!1}De||Ro(p)}if(he=p.memoizedState,he!==null&&(he=he.dehydrated,he!==null))return eg(he)?p.lanes=32:p.lanes=536870912,null;Fo(p)}return he=S.children,S=S.fallback,O?(du(),O=p.mode,he=Rm({mode:"hidden",children:he},O),S=eo(S,O,y,null),he.return=p,S.return=p,he.sibling=S,p.child=he,O=p.child,O.memoizedState=wc(y),O.childLanes=gh(u,ne,y),p.memoizedState=Cm,S):(fu(p),O_(p,he))}if(De=u.memoizedState,De!==null&&(he=De.dehydrated,he!==null)){if(L)p.flags&256?(fu(p),p.flags&=-257,p=k_(u,p,y)):p.memoizedState!==null?(du(),p.child=u.child,p.flags|=128,p=null):(du(),O=S.fallback,he=p.mode,S=Rm({mode:"visible",children:S.children},he),O=eo(O,he,y,null),O.flags|=2,S.return=p,O.return=p,S.sibling=O,p.child=S,uo(p,u.child,null,y),S=p.child,S.memoizedState=wc(y),S.childLanes=gh(u,ne,y),p.memoizedState=Cm,p=O);else if(fu(p),eg(he)){if(ne=he.nextSibling&&he.nextSibling.dataset,ne)var pt=ne.dgst;ne=pt,S=Error(n(419)),S.stack="",S.digest=ne,Ea({value:S,source:null,stack:null}),p=k_(u,p,y)}else if(vi||bs(u,p,y,!1),ne=(y&u.childLanes)!==0,vi||ne){if(ne=Ln,ne!==null&&(S=y&-y,S=(S&42)!==0?1:Ke(S),S=(S&(ne.suspendedLanes|y))!==0?0:S,S!==0&&S!==De.retryLane))throw De.retryLane=S,nu(u,S),Pa(ne,u,S),Sm;he.data==="$?"||gp(),p=k_(u,p,y)}else he.data==="$?"?(p.flags|=192,p.child=u.child,p=null):(u=De.treeContext,$n=Vo(he.nextSibling),Pn=p,Yr=!0,Co=null,fa=!1,u!==null&&(Aa[$a++]=Va,Aa[$a++]=rs,Aa[$a++]=to,Va=u.id,rs=u.overflow,to=p),p=O_(p,S.children),p.flags|=4096);return p}return O?(du(),O=S.fallback,he=p.mode,De=u.child,pt=De.sibling,S=Ns(De,{mode:"hidden",children:S.children}),S.subtreeFlags=De.subtreeFlags&65011712,pt!==null?O=Ns(pt,O):(O=eo(O,he,y,null),O.flags|=2),O.return=p,S.return=p,S.sibling=O,p.child=S,S=O,O=p.child,he=u.child.memoizedState,he===null?he=wc(y):(De=he.cachePool,De!==null?(pt=Oi._currentValue,De=De.parent!==pt?{parent:pt,pool:pt}:De):De=Yd(),he={baseLanes:he.baseLanes|y,cachePool:De}),O.memoizedState=he,O.childLanes=gh(u,ne,y),p.memoizedState=Cm,S):(fu(p),y=u.child,u=y.sibling,y=Ns(y,{mode:"visible",children:S.children}),y.return=p,y.sibling=null,u!==null&&(ne=p.deletions,ne===null?(p.deletions=[u],p.flags|=16):ne.push(u)),p.child=y,p.memoizedState=null,y)}function O_(u,p){return p=Rm({mode:"visible",children:p},u.mode),p.return=u,u.child=p}function Rm(u,p){return u=Ki(22,u,null,p),u.lanes=0,u.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},u}function k_(u,p,y){return uo(p,u.child,null,y),u=O_(p,p.pendingProps.children),u.flags|=2,p.memoizedState=null,u}function cb(u,p,y){u.lanes|=p;var S=u.alternate;S!==null&&(S.lanes|=p),Af(u.return,p,y)}function D_(u,p,y,S,O){var L=u.memoizedState;L===null?u.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:S,tail:y,tailMode:O}:(L.isBackwards=p,L.rendering=null,L.renderingStartTime=0,L.last=S,L.tail=y,L.tailMode=O)}function ub(u,p,y){var S=p.pendingProps,O=S.revealOrder,L=S.tail;if(bn(u,p,S.children,y),S=zi.current,(S&2)!==0)S=S&1|2,p.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=p.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&cb(u,y,p);else if(u.tag===19)cb(u,y,p);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===p)break e;for(;u.sibling===null;){if(u.return===null||u.return===p)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}S&=1}switch(Ct(zi,S),O){case"forwards":for(y=p.child,O=null;y!==null;)u=y.alternate,u!==null&&rp(u)===null&&(O=y),y=y.sibling;y=O,y===null?(O=p.child,p.child=null):(O=y.sibling,y.sibling=null),D_(p,!1,O,y,L);break;case"backwards":for(y=null,O=p.child,p.child=null;O!==null;){if(u=O.alternate,u!==null&&rp(u)===null){p.child=O;break}u=O.sibling,O.sibling=y,y=O,O=u}D_(p,!0,y,null,L);break;case"together":D_(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function zo(u,p,y){if(u!==null&&(p.dependencies=u.dependencies),Pc|=p.lanes,(y&p.childLanes)===0)if(u!==null){if(bs(u,p,y,!1),(y&p.childLanes)===0)return null}else return null;if(u!==null&&p.child!==u.child)throw Error(n(153));if(p.child!==null){for(u=p.child,y=Ns(u,u.pendingProps),p.child=y,y.return=p;u.sibling!==null;)u=u.sibling,y=y.sibling=Ns(u,u.pendingProps),y.return=p;y.sibling=null}return p.child}function N_(u,p){return(u.lanes&p)!==0?!0:(u=u.dependencies,!!(u!==null&&Qi(u)))}function hb(u,p,y){switch(p.tag){case 3:Ft(p,p.stateNode.containerInfo),Io(p,Oi,u.memoizedState.cache),uc();break;case 27:case 5:Gt(p);break;case 4:Ft(p,p.stateNode.containerInfo);break;case 10:Io(p,p.type,p.memoizedProps.value);break;case 13:var S=p.memoizedState;if(S!==null)return S.dehydrated!==null?(fu(p),p.flags|=128,null):(y&p.child.childLanes)!==0?lb(u,p,y):(fu(p),u=zo(u,p,y),u!==null?u.sibling:null);fu(p);break;case 19:var O=(u.flags&128)!==0;if(S=(y&p.childLanes)!==0,S||(bs(u,p,y,!1),S=(y&p.childLanes)!==0),O){if(S)return ub(u,p,y);p.flags|=128}if(O=p.memoizedState,O!==null&&(O.rendering=null,O.tail=null,O.lastEffect=null),Ct(zi,zi.current),S)break;return null;case 22:case 23:return p.lanes=0,R_(u,p,y);case 24:Io(p,Oi,u.memoizedState.cache)}return zo(u,p,y)}function Df(u,p,y){if(u!==null)if(u.memoizedProps!==p.pendingProps)vi=!0;else{if(!N_(u,y)&&(p.flags&128)===0)return vi=!1,hb(u,p,y);vi=(u.flags&131072)!==0}else vi=!1,Yr&&(p.flags&1048576)!==0&&Zd(p,yl,p.index);switch(p.lanes=0,p.tag){case 16:e:{u=p.pendingProps;var S=p.elementType,O=S._init;if(S=O(S._payload),p.type=S,typeof S=="function")nh(S)?(u=Pl(S,u),p.tag=1,p=Mm(null,p,S,u,y)):(p.tag=0,p=I_(null,p,S,u,y));else{if(S!=null){if(O=S.$$typeof,O===re){p.tag=11,p=C_(null,p,S,u,y);break e}else if(O===ue){p.tag=14,p=Am(null,p,S,u,y);break e}}throw p=Ze(S)||S,Error(n(306,p,""))}}return p;case 0:return I_(u,p,p.type,p.pendingProps,y);case 1:return S=p.type,O=Pl(S,p.pendingProps),Mm(u,p,S,O,y);case 3:e:{if(Ft(p,p.stateNode.containerInfo),u===null)throw Error(n(387));S=p.pendingProps;var L=p.memoizedState;O=L.element,pc(u,p),Tl(p,S,null,y);var ne=p.memoizedState;if(S=ne.cache,Io(p,Oi,S),S!==L.cache&&bl(p,[Oi],y,!0),qa(),S=ne.element,L.isDehydrated)if(L={element:S,isDehydrated:!1,cache:ne.cache},p.updateQueue.baseState=L,p.memoizedState=L,p.flags&256){p=Pm(u,p,S,y);break e}else if(S!==O){O=Ua(Error(n(424)),p),Ea(O),p=Pm(u,p,S,y);break e}else{switch(u=p.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for($n=Vo(u.firstChild),Pn=p,Yr=!0,Co=null,fa=!0,y=Of(p,null,S,y),p.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(uc(),S===O){p=zo(u,p,y);break e}bn(u,p,S,y)}p=p.child}return p;case 26:return Em(u,p),u===null?(y=E(p.type,null,p.pendingProps,null))?p.memoizedState=y:Yr||(y=p.type,u=p.pendingProps,S=Rh(Pt.current).createElement(y),S[_r]=p,S[_t]=u,Ca(S,y,u),ni(S),p.stateNode=S):p.memoizedState=E(p.type,u.memoizedProps,p.pendingProps,u.memoizedState),null;case 27:return Gt(p),u===null&&Yr&&(S=p.stateNode=ng(p.type,p.pendingProps,Pt.current),Pn=p,fa=!0,O=$n,Dl(p.type)?(tg=O,$n=Vo(S.firstChild)):$n=O),bn(u,p,p.pendingProps.children,y),Em(u,p),u===null&&(p.flags|=4194304),p.child;case 5:return u===null&&Yr&&((O=S=$n)&&(S=uy(S,p.type,p.pendingProps,fa),S!==null?(p.stateNode=S,Pn=p,$n=Vo(S.firstChild),fa=!1,O=!0):O=!1),O||Ro(p)),Gt(p),O=p.type,L=p.pendingProps,ne=u!==null?u.memoizedProps:null,S=L.children,Xf(O,L)?S=null:ne!==null&&Xf(O,ne)&&(p.flags|=32),p.memoizedState!==null&&(O=fh(u,p,Jd,null,null,y),qt._currentValue=O),Em(u,p),bn(u,p,S,y),p.child;case 6:return u===null&&Yr&&((u=y=$n)&&(y=tw(y,p.pendingProps,fa),y!==null?(p.stateNode=y,Pn=p,$n=null,u=!0):u=!1),u||Ro(p)),null;case 13:return lb(u,p,y);case 4:return Ft(p,p.stateNode.containerInfo),S=p.pendingProps,u===null?p.child=uo(p,null,S,y):bn(u,p,S,y),p.child;case 11:return C_(u,p,p.type,p.pendingProps,y);case 7:return bn(u,p,p.pendingProps,y),p.child;case 8:return bn(u,p,p.pendingProps.children,y),p.child;case 12:return bn(u,p,p.pendingProps.children,y),p.child;case 10:return S=p.pendingProps,Io(p,p.type,S.value),bn(u,p,S.children,y),p.child;case 9:return O=p.type._context,S=p.pendingProps.children,ui(p),O=Cn(O),S=S(O),p.flags|=1,bn(u,p,S,y),p.child;case 14:return Am(u,p,p.type,p.pendingProps,y);case 15:return ab(u,p,p.type,p.pendingProps,y);case 19:return ub(u,p,y);case 31:return S=p.pendingProps,y=p.mode,S={mode:S.mode,children:S.children},u===null?(y=Rm(S,y),y.ref=p.ref,p.child=y,y.return=p,p=y):(y=Ns(u.child,S),y.ref=p.ref,p.child=y,y.return=p,p=y),p;case 22:return R_(u,p,y);case 24:return ui(p),S=Cn(Oi),u===null?(O=Nr(),O===null&&(O=Ln,L=ah(),O.pooledCache=L,L.refCount++,L!==null&&(O.pooledCacheLanes|=y),O=L),p.memoizedState={parent:S,cache:O},cn(p),Io(p,Oi,O)):((u.lanes&y)!==0&&(pc(u,p),Tl(p,null,null,y),qa()),O=u.memoizedState,L=p.memoizedState,O.parent!==S?(O={parent:S,cache:S},p.memoizedState=O,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=O),Io(p,Oi,S)):(S=L.cache,Io(p,Oi,S),S!==O.cache&&bl(p,[Oi],y,!0))),bn(u,p,p.pendingProps.children,y),p.child;case 29:throw p.pendingProps}throw Error(n(156,p.tag))}function Tc(u){u.flags|=4}function ii(u,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!ee(p)){if(p=Ha.current,p!==null&&((Qr&4194048)===Qr?Lo!==null:(Qr&62914560)!==Qr&&(Qr&536870912)===0||p!==Lo))throw dc=Mf,Ef;u.flags|=8192}}function Sc(u,p){p!==null&&(u.flags|=4),u.flags&16384&&(p=u.tag!==22?fe():536870912,u.lanes|=p,xh|=p)}function Nf(u,p){if(!Yr)switch(u.tailMode){case"hidden":p=u.tail;for(var y=null;p!==null;)p.alternate!==null&&(y=p),p=p.sibling;y===null?u.tail=null:y.sibling=null;break;case"collapsed":y=u.tail;for(var S=null;y!==null;)y.alternate!==null&&(S=y),y=y.sibling;S===null?p||u.tail===null?u.tail=null:u.tail.sibling=null:S.sibling=null}}function qn(u){var p=u.alternate!==null&&u.alternate.child===u.child,y=0,S=0;if(p)for(var O=u.child;O!==null;)y|=O.lanes|O.childLanes,S|=O.subtreeFlags&65011712,S|=O.flags&65011712,O.return=u,O=O.sibling;else for(O=u.child;O!==null;)y|=O.lanes|O.childLanes,S|=O.subtreeFlags,S|=O.flags,O.return=u,O=O.sibling;return u.subtreeFlags|=S,u.childLanes=y,p}function Im(u,p,y){var S=p.pendingProps;switch(Po(p),p.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qn(p),null;case 1:return qn(p),null;case 3:return y=p.stateNode,S=null,u!==null&&(S=u.memoizedState.cache),p.memoizedState.cache!==S&&(p.flags|=2048),ao(Oi),zt(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(u===null||u.child===null)&&(ou(p)?Tc(p):u===null||u.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Tf())),qn(p),null;case 26:return y=p.memoizedState,u===null?(Tc(p),y!==null?(qn(p),ii(p,y)):(qn(p),p.flags&=-16777217)):y?y!==u.memoizedState?(Tc(p),qn(p),ii(p,y)):(qn(p),p.flags&=-16777217):(u.memoizedProps!==S&&Tc(p),qn(p),p.flags&=-16777217),null;case 27:Zt(p),y=Pt.current;var O=p.type;if(u!==null&&p.stateNode!=null)u.memoizedProps!==S&&Tc(p);else{if(!S){if(p.stateNode===null)throw Error(n(166));return qn(p),null}u=Yt.current,ou(p)?xf(p):(u=ng(O,S,y),p.stateNode=u,Tc(p))}return qn(p),null;case 5:if(Zt(p),y=p.type,u!==null&&p.stateNode!=null)u.memoizedProps!==S&&Tc(p);else{if(!S){if(p.stateNode===null)throw Error(n(166));return qn(p),null}if(u=Yt.current,ou(p))xf(p);else{switch(O=Rh(Pt.current),u){case 1:u=O.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:u=O.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":u=O.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":u=O.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":u=O.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof S.is=="string"?O.createElement("select",{is:S.is}):O.createElement("select"),S.multiple?u.multiple=!0:S.size&&(u.size=S.size);break;default:u=typeof S.is=="string"?O.createElement(y,{is:S.is}):O.createElement(y)}}u[_r]=p,u[_t]=S;e:for(O=p.child;O!==null;){if(O.tag===5||O.tag===6)u.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===p)break e;for(;O.sibling===null;){if(O.return===null||O.return===p)break e;O=O.return}O.sibling.return=O.return,O=O.sibling}p.stateNode=u;e:switch(Ca(u,y,S),y){case"button":case"input":case"select":case"textarea":u=!!S.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&Tc(p)}}return qn(p),p.flags&=-16777217,null;case 6:if(u&&p.stateNode!=null)u.memoizedProps!==S&&Tc(p);else{if(typeof S!="string"&&p.stateNode===null)throw Error(n(166));if(u=Pt.current,ou(p)){if(u=p.stateNode,y=p.memoizedProps,S=null,O=Pn,O!==null)switch(O.tag){case 27:case 5:S=O.memoizedProps}u[_r]=p,u=!!(u.nodeValue===y||S!==null&&S.suppressHydrationWarning===!0||sy(u.nodeValue,y)),u||Ro(p)}else u=Rh(u).createTextNode(S),u[_r]=p,p.stateNode=u}return qn(p),null;case 13:if(S=p.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(O=ou(p),S!==null&&S.dehydrated!==null){if(u===null){if(!O)throw Error(n(318));if(O=p.memoizedState,O=O!==null?O.dehydrated:null,!O)throw Error(n(317));O[_r]=p}else uc(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;qn(p),O=!1}else O=Tf(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=O),O=!0;if(!O)return p.flags&256?(Fo(p),p):(Fo(p),null)}if(Fo(p),(p.flags&128)!==0)return p.lanes=y,p;if(y=S!==null,u=u!==null&&u.memoizedState!==null,y){S=p.child,O=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(O=S.alternate.memoizedState.cachePool.pool);var L=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(L=S.memoizedState.cachePool.pool),L!==O&&(S.flags|=2048)}return y!==u&&y&&(p.child.flags|=8192),Sc(p,p.updateQueue),qn(p),null;case 4:return zt(),u===null&&Ym(p.stateNode.containerInfo),qn(p),null;case 10:return ao(p.type),qn(p),null;case 19:if(vt(zi),O=p.memoizedState,O===null)return qn(p),null;if(S=(p.flags&128)!==0,L=O.rendering,L===null)if(S)Nf(O,!1);else{if(xi!==0||u!==null&&(u.flags&128)!==0)for(u=p.child;u!==null;){if(L=rp(u),L!==null){for(p.flags|=128,Nf(O,!1),u=L.updateQueue,p.updateQueue=u,Sc(p,u),p.subtreeFlags=0,u=y,y=p.child;y!==null;)Wd(y,u),y=y.sibling;return Ct(zi,zi.current&1|2),p.child}u=u.sibling}O.tail!==null&&fr()>Lm&&(p.flags|=128,S=!0,Nf(O,!1),p.lanes=4194304)}else{if(!S)if(u=rp(L),u!==null){if(p.flags|=128,S=!0,u=u.updateQueue,p.updateQueue=u,Sc(p,u),Nf(O,!0),O.tail===null&&O.tailMode==="hidden"&&!L.alternate&&!Yr)return qn(p),null}else 2*fr()-O.renderingStartTime>Lm&&y!==536870912&&(p.flags|=128,S=!0,Nf(O,!1),p.lanes=4194304);O.isBackwards?(L.sibling=p.child,p.child=L):(u=O.last,u!==null?u.sibling=L:p.child=L,O.last=L)}return O.tail!==null?(p=O.tail,O.rendering=p,O.tail=p.sibling,O.renderingStartTime=fr(),p.sibling=null,u=zi.current,Ct(zi,S?u&1|2:u&1),p):(qn(p),null);case 22:case 23:return Fo(p),Rf(),S=p.memoizedState!==null,u!==null?u.memoizedState!==null!==S&&(p.flags|=8192):S&&(p.flags|=8192),S?(y&536870912)!==0&&(p.flags&128)===0&&(qn(p),p.subtreeFlags&6&&(p.flags|=8192)):qn(p),y=p.updateQueue,y!==null&&Sc(p,y.retryQueue),y=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),S=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(S=p.memoizedState.cachePool.pool),S!==y&&(p.flags|=2048),u!==null&&vt(Fs),null;case 24:return y=null,u!==null&&(y=u.memoizedState.cache),p.memoizedState.cache!==y&&(p.flags|=2048),ao(Oi),qn(p),null;case 25:return null;case 30:return null}throw Error(n(156,p.tag))}function sp(u,p){switch(Po(p),p.tag){case 1:return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 3:return ao(Oi),zt(),u=p.flags,(u&65536)!==0&&(u&128)===0?(p.flags=u&-65537|128,p):null;case 26:case 27:case 5:return Zt(p),null;case 13:if(Fo(p),u=p.memoizedState,u!==null&&u.dehydrated!==null){if(p.alternate===null)throw Error(n(340));uc()}return u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 19:return vt(zi),null;case 4:return zt(),null;case 10:return ao(p.type),null;case 22:case 23:return Fo(p),Rf(),u!==null&&vt(Fs),u=p.flags,u&65536?(p.flags=u&-65537|128,p):null;case 24:return ao(Oi),null;case 25:return null;default:return null}}function B_(u,p){switch(Po(p),p.tag){case 3:ao(Oi),zt();break;case 26:case 27:case 5:Zt(p);break;case 4:zt();break;case 13:Fo(p);break;case 19:vt(zi);break;case 10:ao(p.type);break;case 22:case 23:Fo(p),Rf(),u!==null&&vt(Fs);break;case 24:ao(Oi)}}function Bf(u,p){try{var y=p.updateQueue,S=y!==null?y.lastEffect:null;if(S!==null){var O=S.next;y=O;do{if((y.tag&u)===u){S=void 0;var L=y.create,ne=y.inst;S=L(),ne.destroy=S}y=y.next}while(y!==O)}}catch(he){fn(p,p.return,he)}}function ho(u,p,y){try{var S=p.updateQueue,O=S!==null?S.lastEffect:null;if(O!==null){var L=O.next;S=L;do{if((S.tag&u)===u){var ne=S.inst,he=ne.destroy;if(he!==void 0){ne.destroy=void 0,O=p;var De=y,pt=he;try{pt()}catch(Dt){fn(O,De,Dt)}}}S=S.next}while(S!==L)}}catch(Dt){fn(p,p.return,Dt)}}function Om(u){var p=u.updateQueue;if(p!==null){var y=u.stateNode;try{xr(p,y)}catch(S){fn(u,u.return,S)}}}function _h(u,p,y){y.props=Pl(u.type,u.memoizedProps),y.state=u.memoizedState;try{y.componentWillUnmount()}catch(S){fn(u,p,S)}}function pu(u,p){try{var y=u.ref;if(y!==null){switch(u.tag){case 26:case 27:case 5:var S=u.stateNode;break;case 30:S=u.stateNode;break;default:S=u.stateNode}typeof y=="function"?u.refCleanup=y(S):y.current=S}}catch(O){fn(u,p,O)}}function os(u,p){var y=u.ref,S=u.refCleanup;if(y!==null)if(typeof S=="function")try{S()}catch(O){fn(u,p,O)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(O){fn(u,p,O)}else y.current=null}function Lf(u){var p=u.type,y=u.memoizedProps,S=u.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":y.autoFocus&&S.focus();break e;case"img":y.src?S.src=y.src:y.srcSet&&(S.srcset=y.srcSet)}}catch(O){fn(u,u.return,O)}}function L_(u,p,y){try{var S=u.stateNode;Bb(S,u.type,y,p),S[_t]=p}catch(O){fn(u,u.return,O)}}function F_(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Dl(u.type)||u.tag===4}function Ac(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||F_(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Dl(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function z_(u,p,y){var S=u.tag;if(S===5||S===6)u=u.stateNode,p?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(u,p):(p=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,p.appendChild(u),y=y._reactRootContainer,y!=null||p.onclick!==null||(p.onclick=xp));else if(S!==4&&(S===27&&Dl(u.type)&&(y=u.stateNode,p=null),u=u.child,u!==null))for(z_(u,p,y),u=u.sibling;u!==null;)z_(u,p,y),u=u.sibling}function op(u,p,y){var S=u.tag;if(S===5||S===6)u=u.stateNode,p?y.insertBefore(u,p):y.appendChild(u);else if(S!==4&&(S===27&&Dl(u.type)&&(y=u.stateNode),u=u.child,u!==null))for(op(u,p,y),u=u.sibling;u!==null;)op(u,p,y),u=u.sibling}function Ff(u){var p=u.stateNode,y=u.memoizedProps;try{for(var S=u.type,O=p.attributes;O.length;)p.removeAttributeNode(O[0]);Ca(p,S,y),p[_r]=u,p[_t]=y}catch(L){fn(u,u.return,L)}}var jo=!1,bi=!1,km=!1,fb=typeof WeakSet=="function"?WeakSet:Set,ma=null;function Z1(u,p){if(u=u.containerInfo,Ch=ai,u=_m(u),jd(u)){if("selectionStart"in u)var y={start:u.selectionStart,end:u.selectionEnd};else e:{y=(y=u.ownerDocument)&&y.defaultView||window;var S=y.getSelection&&y.getSelection();if(S&&S.rangeCount!==0){y=S.anchorNode;var O=S.anchorOffset,L=S.focusNode;S=S.focusOffset;try{y.nodeType,L.nodeType}catch{y=null;break e}var ne=0,he=-1,De=-1,pt=0,Dt=0,Ut=u,ht=null;t:for(;;){for(var yt;Ut!==y||O!==0&&Ut.nodeType!==3||(he=ne+O),Ut!==L||S!==0&&Ut.nodeType!==3||(De=ne+S),Ut.nodeType===3&&(ne+=Ut.nodeValue.length),(yt=Ut.firstChild)!==null;)ht=Ut,Ut=yt;for(;;){if(Ut===u)break t;if(ht===y&&++pt===O&&(he=ne),ht===L&&++Dt===S&&(De=ne),(yt=Ut.nextSibling)!==null)break;Ut=ht,ht=Ut.parentNode}Ut=yt}y=he===-1||De===-1?null:{start:he,end:De}}else y=null}y=y||{start:0,end:0}}else y=null;for(Qm={focusedElem:u,selectionRange:y},ai=!1,ma=p;ma!==null;)if(p=ma,u=p.child,(p.subtreeFlags&1024)!==0&&u!==null)u.return=p,ma=u;else for(;ma!==null;){switch(p=ma,L=p.alternate,u=p.flags,p.tag){case 0:break;case 11:case 15:break;case 1:if((u&1024)!==0&&L!==null){u=void 0,y=p,O=L.memoizedProps,L=L.memoizedState,S=y.stateNode;try{var Er=Pl(y.type,O,y.elementType===y.type);u=S.getSnapshotBeforeUpdate(Er,L),S.__reactInternalSnapshotBeforeUpdate=u}catch(Sr){fn(y,y.return,Sr)}}break;case 3:if((u&1024)!==0){if(u=p.stateNode.containerInfo,y=u.nodeType,y===9)Jm(u);else if(y===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":Jm(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(n(163))}if(u=p.sibling,u!==null){u.return=p.return,ma=u;break}ma=p.return}}function db(u,p,y){var S=y.flags;switch(y.tag){case 0:case 11:case 15:mu(u,y),S&4&&Bf(5,y);break;case 1:if(mu(u,y),S&4)if(u=y.stateNode,p===null)try{u.componentDidMount()}catch(ne){fn(y,y.return,ne)}else{var O=Pl(y.type,p.memoizedProps);p=p.memoizedState;try{u.componentDidUpdate(O,p,u.__reactInternalSnapshotBeforeUpdate)}catch(ne){fn(y,y.return,ne)}}S&64&&Om(y),S&512&&pu(y,y.return);break;case 3:if(mu(u,y),S&64&&(u=y.updateQueue,u!==null)){if(p=null,y.child!==null)switch(y.child.tag){case 27:case 5:p=y.child.stateNode;break;case 1:p=y.child.stateNode}try{xr(u,p)}catch(ne){fn(y,y.return,ne)}}break;case 27:p===null&&S&4&&Ff(y);case 26:case 5:mu(u,y),p===null&&S&4&&Lf(y),S&512&&pu(y,y.return);break;case 12:mu(u,y);break;case 13:mu(u,y),S&4&&Dm(u,y),S&64&&(u=y.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(y=J_.bind(null,y),Fb(u,y))));break;case 22:if(S=y.memoizedState!==null||jo,!S){p=p!==null&&p.memoizedState!==null||bi,O=jo;var L=bi;jo=S,(bi=p)&&!L?po(u,y,(y.subtreeFlags&8772)!==0):mu(u,y),jo=O,bi=L}break;case 30:break;default:mu(u,y)}}function pb(u){var p=u.alternate;p!==null&&(u.alternate=null,pb(p)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(p=u.stateNode,p!==null&&yr(p)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var Hn=null,ls=!1;function Uo(u,p,y){for(y=y.child;y!==null;)j_(u,p,y),y=y.sibling}function j_(u,p,y){if(Pi&&typeof Pi.onCommitFiberUnmount=="function")try{Pi.onCommitFiberUnmount(Ys,y)}catch{}switch(y.tag){case 26:bi||os(y,p),Uo(u,p,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:bi||os(y,p);var S=Hn,O=ls;Dl(y.type)&&(Hn=y.stateNode,ls=!1),Uo(u,p,y),Yf(y.stateNode),Hn=S,ls=O;break;case 5:bi||os(y,p);case 6:if(S=Hn,O=ls,Hn=null,Uo(u,p,y),Hn=S,ls=O,Hn!==null)if(ls)try{(Hn.nodeType===9?Hn.body:Hn.nodeName==="HTML"?Hn.ownerDocument.body:Hn).removeChild(y.stateNode)}catch(L){fn(y,p,L)}else try{Hn.removeChild(y.stateNode)}catch(L){fn(y,p,L)}break;case 18:Hn!==null&&(ls?(u=Hn,cy(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,y.stateNode),Bl(u)):cy(Hn,y.stateNode));break;case 4:S=Hn,O=ls,Hn=y.stateNode.containerInfo,ls=!0,Uo(u,p,y),Hn=S,ls=O;break;case 0:case 11:case 14:case 15:bi||ho(2,y,p),bi||ho(4,y,p),Uo(u,p,y);break;case 1:bi||(os(y,p),S=y.stateNode,typeof S.componentWillUnmount=="function"&&_h(y,p,S)),Uo(u,p,y);break;case 21:Uo(u,p,y);break;case 22:bi=(S=bi)||y.memoizedState!==null,Uo(u,p,y),bi=S;break;default:Uo(u,p,y)}}function Dm(u,p){if(p.memoizedState===null&&(u=p.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{Bl(u)}catch(y){fn(p,p.return,y)}}function mb(u){switch(u.tag){case 13:case 19:var p=u.stateNode;return p===null&&(p=u.stateNode=new fb),p;case 22:return u=u.stateNode,p=u._retryCache,p===null&&(p=u._retryCache=new fb),p;default:throw Error(n(435,u.tag))}}function Nm(u,p){var y=mb(u);p.forEach(function(S){var O=Hf.bind(null,u,S);y.has(S)||(y.add(S),S.then(O,O))})}function Wa(u,p){var y=p.deletions;if(y!==null)for(var S=0;S<y.length;S++){var O=y[S],L=u,ne=p,he=ne;e:for(;he!==null;){switch(he.tag){case 27:if(Dl(he.type)){Hn=he.stateNode,ls=!1;break e}break;case 5:Hn=he.stateNode,ls=!1;break e;case 3:case 4:Hn=he.stateNode.containerInfo,ls=!0;break e}he=he.return}if(Hn===null)throw Error(n(160));j_(L,ne,O),Hn=null,ls=!1,L=O.alternate,L!==null&&(L.return=null),O.return=null}if(p.subtreeFlags&13878)for(p=p.child;p!==null;)U_(p,u),p=p.sibling}var fo=null;function U_(u,p){var y=u.alternate,S=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:Wa(p,u),ws(u),S&4&&(ho(3,u,u.return),Bf(3,u),ho(5,u,u.return));break;case 1:Wa(p,u),ws(u),S&512&&(bi||y===null||os(y,y.return)),S&64&&jo&&(u=u.updateQueue,u!==null&&(S=u.callbacks,S!==null&&(y=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=y===null?S:y.concat(S))));break;case 26:var O=fo;if(Wa(p,u),ws(u),S&512&&(bi||y===null||os(y,y.return)),S&4){var L=y!==null?y.memoizedState:null;if(S=u.memoizedState,y===null)if(S===null)if(u.stateNode===null){e:{S=u.type,y=u.memoizedProps,O=O.ownerDocument||O;t:switch(S){case"title":L=O.getElementsByTagName("title")[0],(!L||L[er]||L[_r]||L.namespaceURI==="http://www.w3.org/2000/svg"||L.hasAttribute("itemprop"))&&(L=O.createElement(S),O.head.insertBefore(L,O.querySelector("head > title"))),Ca(L,S,y),L[_r]=u,ni(L),S=L;break e;case"link":var ne=we("link","href",O).get(S+(y.href||""));if(ne){for(var he=0;he<ne.length;he++)if(L=ne[he],L.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&L.getAttribute("rel")===(y.rel==null?null:y.rel)&&L.getAttribute("title")===(y.title==null?null:y.title)&&L.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){ne.splice(he,1);break t}}L=O.createElement(S),Ca(L,S,y),O.head.appendChild(L);break;case"meta":if(ne=we("meta","content",O).get(S+(y.content||""))){for(he=0;he<ne.length;he++)if(L=ne[he],L.getAttribute("content")===(y.content==null?null:""+y.content)&&L.getAttribute("name")===(y.name==null?null:y.name)&&L.getAttribute("property")===(y.property==null?null:y.property)&&L.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&L.getAttribute("charset")===(y.charSet==null?null:y.charSet)){ne.splice(he,1);break t}}L=O.createElement(S),Ca(L,S,y),O.head.appendChild(L);break;default:throw Error(n(468,S))}L[_r]=u,ni(L),S=L}u.stateNode=S}else Fe(O,u.type,u.stateNode);else u.stateNode=Q(O,S,u.memoizedProps);else L!==S?(L===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):L.count--,S===null?Fe(O,u.type,u.stateNode):Q(O,S,u.memoizedProps)):S===null&&u.stateNode!==null&&L_(u,u.memoizedProps,y.memoizedProps)}break;case 27:Wa(p,u),ws(u),S&512&&(bi||y===null||os(y,y.return)),y!==null&&S&4&&L_(u,u.memoizedProps,y.memoizedProps);break;case 5:if(Wa(p,u),ws(u),S&512&&(bi||y===null||os(y,y.return)),u.flags&32){O=u.stateNode;try{Os(O,"")}catch(yt){fn(u,u.return,yt)}}S&4&&u.stateNode!=null&&(O=u.memoizedProps,L_(u,O,y!==null?y.memoizedProps:O)),S&1024&&(km=!0);break;case 6:if(Wa(p,u),ws(u),S&4){if(u.stateNode===null)throw Error(n(162));S=u.memoizedProps,y=u.stateNode;try{y.nodeValue=S}catch(yt){fn(u,u.return,yt)}}break;case 3:if(me=null,O=fo,fo=Tp(p.containerInfo),Wa(p,u),fo=O,ws(u),S&4&&y!==null&&y.memoizedState.isDehydrated)try{Bl(p.containerInfo)}catch(yt){fn(u,u.return,yt)}km&&(km=!1,zf(u));break;case 4:S=fo,fo=Tp(u.stateNode.containerInfo),Wa(p,u),ws(u),fo=S;break;case 12:Wa(p,u),ws(u);break;case 13:Wa(p,u),ws(u),u.child.flags&8192&&u.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(fp=fr()),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,Nm(u,S)));break;case 22:O=u.memoizedState!==null;var De=y!==null&&y.memoizedState!==null,pt=jo,Dt=bi;if(jo=pt||O,bi=Dt||De,Wa(p,u),bi=Dt,jo=pt,ws(u),S&8192)e:for(p=u.stateNode,p._visibility=O?p._visibility&-2:p._visibility|1,O&&(y===null||De||jo||bi||Ec(u)),y=null,p=u;;){if(p.tag===5||p.tag===26){if(y===null){De=y=p;try{if(L=De.stateNode,O)ne=L.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{he=De.stateNode;var Ut=De.memoizedProps.style,ht=Ut!=null&&Ut.hasOwnProperty("display")?Ut.display:null;he.style.display=ht==null||typeof ht=="boolean"?"":(""+ht).trim()}}catch(yt){fn(De,De.return,yt)}}}else if(p.tag===6){if(y===null){De=p;try{De.stateNode.nodeValue=O?"":De.memoizedProps}catch(yt){fn(De,De.return,yt)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===u)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===u)break e;for(;p.sibling===null;){if(p.return===null||p.return===u)break e;y===p&&(y=null),p=p.return}y===p&&(y=null),p.sibling.return=p.return,p=p.sibling}S&4&&(S=u.updateQueue,S!==null&&(y=S.retryQueue,y!==null&&(S.retryQueue=null,Nm(u,y))));break;case 19:Wa(p,u),ws(u),S&4&&(S=u.updateQueue,S!==null&&(u.updateQueue=null,Nm(u,S)));break;case 30:break;case 21:break;default:Wa(p,u),ws(u)}}function ws(u){var p=u.flags;if(p&2){try{for(var y,S=u.return;S!==null;){if(F_(S)){y=S;break}S=S.return}if(y==null)throw Error(n(160));switch(y.tag){case 27:var O=y.stateNode,L=Ac(u);op(u,L,O);break;case 5:var ne=y.stateNode;y.flags&32&&(Os(ne,""),y.flags&=-33);var he=Ac(u);op(u,he,ne);break;case 3:case 4:var De=y.stateNode.containerInfo,pt=Ac(u);z_(u,pt,De);break;default:throw Error(n(161))}}catch(Dt){fn(u,u.return,Dt)}u.flags&=-3}p&4096&&(u.flags&=-4097)}function zf(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var p=u;zf(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),u=u.sibling}}function mu(u,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)db(u,p.alternate,p),p=p.sibling}function Ec(u){for(u=u.child;u!==null;){var p=u;switch(p.tag){case 0:case 11:case 14:case 15:ho(4,p,p.return),Ec(p);break;case 1:os(p,p.return);var y=p.stateNode;typeof y.componentWillUnmount=="function"&&_h(p,p.return,y),Ec(p);break;case 27:Yf(p.stateNode);case 26:case 5:os(p,p.return),Ec(p);break;case 22:p.memoizedState===null&&Ec(p);break;case 30:Ec(p);break;default:Ec(p)}u=u.sibling}}function po(u,p,y){for(y=y&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var S=p.alternate,O=u,L=p,ne=L.flags;switch(L.tag){case 0:case 11:case 15:po(O,L,y),Bf(4,L);break;case 1:if(po(O,L,y),S=L,O=S.stateNode,typeof O.componentDidMount=="function")try{O.componentDidMount()}catch(pt){fn(S,S.return,pt)}if(S=L,O=S.updateQueue,O!==null){var he=S.stateNode;try{var De=O.shared.hiddenCallbacks;if(De!==null)for(O.shared.hiddenCallbacks=null,O=0;O<De.length;O++)ur(De[O],he)}catch(pt){fn(S,S.return,pt)}}y&&ne&64&&Om(L),pu(L,L.return);break;case 27:Ff(L);case 26:case 5:po(O,L,y),y&&S===null&&ne&4&&Lf(L),pu(L,L.return);break;case 12:po(O,L,y);break;case 13:po(O,L,y),y&&ne&4&&Dm(O,L);break;case 22:L.memoizedState===null&&po(O,L,y),pu(L,L.return);break;case 30:break;default:po(O,L,y)}p=p.sibling}}function lp(u,p){var y=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),u=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(u=p.memoizedState.cachePool.pool),u!==y&&(u!=null&&u.refCount++,y!=null&&lu(y))}function $_(u,p){u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&lu(u))}function Cl(u,p,y,S){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)V_(u,p,y,S),p=p.sibling}function V_(u,p,y,S){var O=p.flags;switch(p.tag){case 0:case 11:case 15:Cl(u,p,y,S),O&2048&&Bf(9,p);break;case 1:Cl(u,p,y,S);break;case 3:Cl(u,p,y,S),O&2048&&(u=null,p.alternate!==null&&(u=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==u&&(p.refCount++,u!=null&&lu(u)));break;case 12:if(O&2048){Cl(u,p,y,S),u=p.stateNode;try{var L=p.memoizedProps,ne=L.id,he=L.onPostCommit;typeof he=="function"&&he(ne,p.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(De){fn(p,p.return,De)}}else Cl(u,p,y,S);break;case 13:Cl(u,p,y,S);break;case 23:break;case 22:L=p.stateNode,ne=p.alternate,p.memoizedState!==null?L._visibility&2?Cl(u,p,y,S):cp(u,p):L._visibility&2?Cl(u,p,y,S):(L._visibility|=2,yh(u,p,y,S,(p.subtreeFlags&10256)!==0)),O&2048&&lp(ne,p);break;case 24:Cl(u,p,y,S),O&2048&&$_(p.alternate,p);break;default:Cl(u,p,y,S)}}function yh(u,p,y,S,O){for(O=O&&(p.subtreeFlags&10256)!==0,p=p.child;p!==null;){var L=u,ne=p,he=y,De=S,pt=ne.flags;switch(ne.tag){case 0:case 11:case 15:yh(L,ne,he,De,O),Bf(8,ne);break;case 23:break;case 22:var Dt=ne.stateNode;ne.memoizedState!==null?Dt._visibility&2?yh(L,ne,he,De,O):cp(L,ne):(Dt._visibility|=2,yh(L,ne,he,De,O)),O&&pt&2048&&lp(ne.alternate,ne);break;case 24:yh(L,ne,he,De,O),O&&pt&2048&&$_(ne.alternate,ne);break;default:yh(L,ne,he,De,O)}p=p.sibling}}function cp(u,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var y=u,S=p,O=S.flags;switch(S.tag){case 22:cp(y,S),O&2048&&lp(S.alternate,S);break;case 24:cp(y,S),O&2048&&$_(S.alternate,S);break;default:cp(y,S)}p=p.sibling}}var up=8192;function Rl(u){if(u.subtreeFlags&up)for(u=u.child;u!==null;)q_(u),u=u.sibling}function q_(u){switch(u.tag){case 26:Rl(u),u.flags&up&&u.memoizedState!==null&&st(fo,u.memoizedState,u.memoizedProps);break;case 5:Rl(u);break;case 3:case 4:var p=fo;fo=Tp(u.stateNode.containerInfo),Rl(u),fo=p;break;case 22:u.memoizedState===null&&(p=u.alternate,p!==null&&p.memoizedState!==null?(p=up,up=16777216,Rl(u),up=p):Rl(u));break;default:Rl(u)}}function gb(u){var p=u.alternate;if(p!==null&&(u=p.child,u!==null)){p.child=null;do p=u.sibling,u.sibling=null,u=p;while(u!==null)}}function hp(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var y=0;y<p.length;y++){var S=p[y];ma=S,yb(S,u)}gb(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)_b(u),u=u.sibling}function _b(u){switch(u.tag){case 0:case 11:case 15:hp(u),u.flags&2048&&ho(9,u,u.return);break;case 3:hp(u);break;case 12:hp(u);break;case 22:var p=u.stateNode;u.memoizedState!==null&&p._visibility&2&&(u.return===null||u.return.tag!==13)?(p._visibility&=-3,Bm(u)):hp(u);break;default:hp(u)}}function Bm(u){var p=u.deletions;if((u.flags&16)!==0){if(p!==null)for(var y=0;y<p.length;y++){var S=p[y];ma=S,yb(S,u)}gb(u)}for(u=u.child;u!==null;){switch(p=u,p.tag){case 0:case 11:case 15:ho(8,p,p.return),Bm(p);break;case 22:y=p.stateNode,y._visibility&2&&(y._visibility&=-3,Bm(p));break;default:Bm(p)}u=u.sibling}}function yb(u,p){for(;ma!==null;){var y=ma;switch(y.tag){case 0:case 11:case 15:ho(8,y,p);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var S=y.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:lu(y.memoizedState.cache)}if(S=y.child,S!==null)S.return=y,ma=S;else e:for(y=u;ma!==null;){S=ma;var O=S.sibling,L=S.return;if(pb(S),S===y){ma=null;break e}if(O!==null){O.return=L,ma=O;break e}ma=L}}}var X1={getCacheForType:function(u){var p=Cn(Oi),y=p.data.get(u);return y===void 0&&(y=u(),p.data.set(u,y)),y}},vb=typeof WeakMap=="function"?WeakMap:Map,ln=0,Ln=null,Wr=null,Qr=0,xn=0,Za=null,gu=!1,vh=!1,H_=!1,Mc=0,xi=0,Pc=0,bh=0,W_=0,Xa=0,xh=0,wh=null,cs=null,hi=!1,fp=0,Lm=1/0,dp=null,Il=null,ra=0,_u=null,jf=null,Uf=0,Z_=0,Fm=null,Ga=null,Th=0,zm=null;function ji(){if((ln&2)!==0&&Qr!==0)return Qr&-Qr;if(Ie.T!==null){var u=Jt;return u!==0?u:kl()}return Xt()}function pp(){Xa===0&&(Xa=(Qr&536870912)===0||Yr?Pe():536870912);var u=Ha.current;return u!==null&&(u.flags|=32),Xa}function Pa(u,p,y){(u===Ln&&(xn===2||xn===9)||u.cancelPendingCommit!==null)&&(Ah(u,0),yu(u,Qr,Xa,!1)),at(u,y),((ln&2)===0||u!==Ln)&&(u===Ln&&((ln&2)===0&&(bh|=y),xi===4&&yu(u,Qr,Xa,!1)),Ol(u))}function Sh(u,p,y){if((ln&6)!==0)throw Error(n(327));var S=!y&&(p&124)===0&&(p&u.expiredLanes)===0||ce(u,p),O=S?xb(u,p):_p(u,p,!0),L=S;do{if(O===0){vh&&!S&&yu(u,p,0,!1);break}else{if(y=u.current.alternate,L&&!jm(y)){O=_p(u,p,!1),L=!1;continue}if(O===2){if(L=p,u.errorRecoveryDisabledLanes&L)var ne=0;else ne=u.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){p=ne;e:{var he=u;O=wh;var De=he.current.memoizedState.isDehydrated;if(De&&(Ah(he,ne).flags|=256),ne=_p(he,ne,!1),ne!==2){if(H_&&!De){he.errorRecoveryDisabledLanes|=L,bh|=L,O=4;break e}L=cs,cs=O,L!==null&&(cs===null?cs=L:cs.push.apply(cs,L))}O=ne}if(L=!1,O!==2)continue}}if(O===1){Ah(u,0),yu(u,p,0,!0);break}e:{switch(S=u,L=O,L){case 0:case 1:throw Error(n(345));case 4:if((p&4194048)!==p)break;case 6:yu(S,p,Xa,!gu);break e;case 2:cs=null;break;case 3:case 5:break;default:throw Error(n(329))}if((p&62914560)===p&&(O=fp+300-fr(),10<O)){if(yu(S,p,Xa,!gu),le(S,0,!0)!==0)break e;S.timeoutHandle=Lb(mp.bind(null,S,y,cs,dp,hi,p,Xa,bh,xh,gu,L,2,-0,0),O);break e}mp(S,y,cs,dp,hi,p,Xa,bh,xh,gu,L,0,-0,0)}}break}while(!0);Ol(u)}function mp(u,p,y,S,O,L,ne,he,De,pt,Dt,Ut,ht,yt){if(u.timeoutHandle=-1,Ut=p.subtreeFlags,(Ut&8192||(Ut&16785408)===16785408)&&(pe={stylesheets:null,count:0,unsuspend:Re},q_(p),Ut=Nt(),Ut!==null)){u.cancelPendingCommit=Ut(K_.bind(null,u,p,L,y,S,O,ne,he,De,Dt,1,ht,yt)),yu(u,L,ne,!pt);return}K_(u,p,L,y,S,O,ne,he,De)}function jm(u){for(var p=u;;){var y=p.tag;if((y===0||y===11||y===15)&&p.flags&16384&&(y=p.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var S=0;S<y.length;S++){var O=y[S],L=O.getSnapshot;O=O.value;try{if(!Sa(L(),O))return!1}catch{return!1}}if(y=p.child,p.subtreeFlags&16384&&y!==null)y.return=p,p=y;else{if(p===u)break;for(;p.sibling===null;){if(p.return===null||p.return===u)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function yu(u,p,y,S){p&=~W_,p&=~bh,u.suspendedLanes|=p,u.pingedLanes&=~p,S&&(u.warmLanes|=p),S=u.expirationTimes;for(var O=p;0<O;){var L=31-Ci(O),ne=1<<L;S[L]=-1,O&=~ne}y!==0&&gt(u,y,p)}function Um(){return(ln&6)===0?(Wf(0),!1):!0}function $m(){if(Wr!==null){if(xn===0)var u=Wr.return;else u=Wr,io=vl=null,dh(u),vc=null,bc=0,u=Wr;for(;u!==null;)B_(u.alternate,u),u=u.return;Wr=null}}function Ah(u,p){var y=u.timeoutHandle;y!==-1&&(u.timeoutHandle=-1,ew(y)),y=u.cancelPendingCommit,y!==null&&(u.cancelPendingCommit=null,y()),$m(),Ln=u,Wr=y=Ns(u.current,null),Qr=p,xn=0,Za=null,gu=!1,vh=ce(u,p),H_=!1,xh=Xa=W_=bh=Pc=xi=0,cs=wh=null,hi=!1,(p&8)!==0&&(p|=p&32);var S=u.entangledLanes;if(S!==0)for(u=u.entanglements,S&=p;0<S;){var O=31-Ci(S),L=1<<O;p|=u[O],S&=~L}return Mc=p,oc(),y}function bb(u,p){Or=null,Ie.H=hn,p===wl||p===oh?(p=Qd(),xn=3):p===Ef?(p=Qd(),xn=4):xn=p===Sm?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,Za=p,Wr===null&&(xi=1,ap(u,Ua(p,u.current)))}function X_(){var u=Ie.H;return Ie.H=hn,u===null?hn:u}function G_(){var u=Ie.A;return Ie.A=X1,u}function gp(){xi=4,gu||(Qr&4194048)!==Qr&&Ha.current!==null||(vh=!0),(Pc&134217727)===0&&(bh&134217727)===0||Ln===null||yu(Ln,Qr,Xa,!1)}function _p(u,p,y){var S=ln;ln|=2;var O=X_(),L=G_();(Ln!==u||Qr!==p)&&(dp=null,Ah(u,p)),p=!1;var ne=xi;e:do try{if(xn!==0&&Wr!==null){var he=Wr,De=Za;switch(xn){case 8:$m(),ne=6;break e;case 3:case 2:case 9:case 6:Ha.current===null&&(p=!0);var pt=xn;if(xn=0,Za=null,$f(u,he,De,pt),y&&vh){ne=0;break e}break;default:pt=xn,xn=0,Za=null,$f(u,he,De,pt)}}G1(),ne=xi;break}catch(Dt){bb(u,Dt)}while(!0);return p&&u.shellSuspendCounter++,io=vl=null,ln=S,Ie.H=O,Ie.A=L,Wr===null&&(Ln=null,Qr=0,oc()),ne}function G1(){for(;Wr!==null;)wb(Wr)}function xb(u,p){var y=ln;ln|=2;var S=X_(),O=G_();Ln!==u||Qr!==p?(dp=null,Lm=fr()+500,Ah(u,p)):vh=ce(u,p);e:do try{if(xn!==0&&Wr!==null){p=Wr;var L=Za;t:switch(xn){case 1:xn=0,Za=null,$f(u,p,L,1);break;case 2:case 9:if(lh(L)){xn=0,Za=null,Tb(p);break}p=function(){xn!==2&&xn!==9||Ln!==u||(xn=7),Ol(u)},L.then(p,p);break e;case 3:xn=7;break e;case 4:xn=5;break e;case 7:lh(L)?(xn=0,Za=null,Tb(p)):(xn=0,Za=null,$f(u,p,L,7));break;case 5:var ne=null;switch(Wr.tag){case 26:ne=Wr.memoizedState;case 5:case 27:var he=Wr;if(!ne||ee(ne)){xn=0,Za=null;var De=he.sibling;if(De!==null)Wr=De;else{var pt=he.return;pt!==null?(Wr=pt,Vm(pt)):Wr=null}break t}}xn=0,Za=null,$f(u,p,L,5);break;case 6:xn=0,Za=null,$f(u,p,L,6);break;case 8:$m(),xi=6;break e;default:throw Error(n(462))}}Y1();break}catch(Dt){bb(u,Dt)}while(!0);return io=vl=null,Ie.H=S,Ie.A=O,ln=y,Wr!==null?0:(Ln=null,Qr=0,oc(),xi)}function Y1(){for(;Wr!==null&&!ar();)wb(Wr)}function wb(u){var p=Df(u.alternate,u,Mc);u.memoizedProps=u.pendingProps,p===null?Vm(u):Wr=p}function Tb(u){var p=u,y=p.alternate;switch(p.tag){case 15:case 0:p=ob(y,p,p.pendingProps,p.type,void 0,Qr);break;case 11:p=ob(y,p,p.pendingProps,p.type.render,p.ref,Qr);break;case 5:dh(p);default:B_(y,p),p=Wr=Wd(p,Mc),p=Df(y,p,Mc)}u.memoizedProps=u.pendingProps,p===null?Vm(u):Wr=p}function $f(u,p,y,S){io=vl=null,dh(p),vc=null,bc=0;var O=p.return;try{if(ib(u,O,p,y,Qr)){xi=1,ap(u,Ua(y,u.current)),Wr=null;return}}catch(L){if(O!==null)throw Wr=O,L;xi=1,ap(u,Ua(y,u.current)),Wr=null;return}p.flags&32768?(Yr||S===1?u=!0:vh||(Qr&536870912)!==0?u=!1:(gu=u=!0,(S===2||S===9||S===3||S===6)&&(S=Ha.current,S!==null&&S.tag===13&&(S.flags|=16384))),Y_(p,u)):Vm(p)}function Vm(u){var p=u;do{if((p.flags&32768)!==0){Y_(p,gu);return}u=p.return;var y=Im(p.alternate,p,Mc);if(y!==null){Wr=y;return}if(p=p.sibling,p!==null){Wr=p;return}Wr=p=u}while(p!==null);xi===0&&(xi=5)}function Y_(u,p){do{var y=sp(u.alternate,u);if(y!==null){y.flags&=32767,Wr=y;return}if(y=u.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!p&&(u=u.sibling,u!==null)){Wr=u;return}Wr=u=y}while(u!==null);xi=6,Wr=null}function K_(u,p,y,S,O,L,ne,he,De){u.cancelPendingCommit=null;do qf();while(ra!==0);if((ln&6)!==0)throw Error(n(327));if(p!==null){if(p===u.current)throw Error(n(177));if(L=p.lanes|p.childLanes,L|=qd,Ne(u,y,L,ne,he,De),u===Ln&&(Wr=Ln=null,Qr=0),jf=p,_u=u,Uf=y,Z_=L,Fm=O,Ga=S,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,Eb(Kn,function(){return Sb(),null})):(u.callbackNode=null,u.callbackPriority=0),S=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||S){S=Ie.T,Ie.T=null,O=et.p,et.p=2,ne=ln,ln|=4;try{Z1(u,p,y)}finally{ln=ne,et.p=O,Ie.T=S}}ra=1,Vf(),$o(),Cc()}}function Vf(){if(ra===1){ra=0;var u=_u,p=jf,y=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||y){y=Ie.T,Ie.T=null;var S=et.p;et.p=2;var O=ln;ln|=4;try{U_(p,u);var L=Qm,ne=_m(u.containerInfo),he=L.focusedElem,De=L.selectionRange;if(ne!==he&&he&&he.ownerDocument&&gm(he.ownerDocument.documentElement,he)){if(De!==null&&jd(he)){var pt=De.start,Dt=De.end;if(Dt===void 0&&(Dt=pt),"selectionStart"in he)he.selectionStart=pt,he.selectionEnd=Math.min(Dt,he.value.length);else{var Ut=he.ownerDocument||document,ht=Ut&&Ut.defaultView||window;if(ht.getSelection){var yt=ht.getSelection(),Er=he.textContent.length,Sr=Math.min(De.start,Er),kn=De.end===void 0?Sr:Math.min(De.end,Er);!yt.extend&&Sr>kn&&(ne=kn,kn=Sr,Sr=ne);var Je=mm(he,Sr),ze=mm(he,kn);if(Je&&ze&&(yt.rangeCount!==1||yt.anchorNode!==Je.node||yt.anchorOffset!==Je.offset||yt.focusNode!==ze.node||yt.focusOffset!==ze.offset)){var tt=Ut.createRange();tt.setStart(Je.node,Je.offset),yt.removeAllRanges(),Sr>kn?(yt.addRange(tt),yt.extend(ze.node,ze.offset)):(tt.setEnd(ze.node,ze.offset),yt.addRange(tt))}}}}for(Ut=[],yt=he;yt=yt.parentNode;)yt.nodeType===1&&Ut.push({element:yt,left:yt.scrollLeft,top:yt.scrollTop});for(typeof he.focus=="function"&&he.focus(),he=0;he<Ut.length;he++){var Ot=Ut[he];Ot.element.scrollLeft=Ot.left,Ot.element.scrollTop=Ot.top}}ai=!!Ch,Qm=Ch=null}finally{ln=O,et.p=S,Ie.T=y}}u.current=p,ra=2}}function $o(){if(ra===2){ra=0;var u=_u,p=jf,y=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||y){y=Ie.T,Ie.T=null;var S=et.p;et.p=2;var O=ln;ln|=4;try{db(u,p.alternate,p)}finally{ln=O,et.p=S,Ie.T=y}}ra=3}}function Cc(){if(ra===4||ra===3){ra=0,rr();var u=_u,p=jf,y=Uf,S=Ga;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?ra=5:(ra=0,jf=_u=null,Q_(u,u.pendingLanes));var O=u.pendingLanes;if(O===0&&(Il=null),It(y),p=p.stateNode,Pi&&typeof Pi.onCommitFiberRoot=="function")try{Pi.onCommitFiberRoot(Ys,p,void 0,(p.current.flags&128)===128)}catch{}if(S!==null){p=Ie.T,O=et.p,et.p=2,Ie.T=null;try{for(var L=u.onRecoverableError,ne=0;ne<S.length;ne++){var he=S[ne];L(he.value,{componentStack:he.stack})}}finally{Ie.T=p,et.p=O}}(Uf&3)!==0&&qf(),Ol(u),O=u.pendingLanes,(y&4194090)!==0&&(O&42)!==0?u===zm?Th++:(Th=0,zm=u):Th=0,Wf(0)}}function Q_(u,p){(u.pooledCacheLanes&=p)===0&&(p=u.pooledCache,p!=null&&(u.pooledCache=null,lu(p)))}function qf(u){return Vf(),$o(),Cc(),Sb()}function Sb(){if(ra!==5)return!1;var u=_u,p=Z_;Z_=0;var y=It(Uf),S=Ie.T,O=et.p;try{et.p=32>y?32:y,Ie.T=null,y=Fm,Fm=null;var L=_u,ne=Uf;if(ra=0,jf=_u=null,Uf=0,(ln&6)!==0)throw Error(n(331));var he=ln;if(ln|=4,_b(L.current),V_(L,L.current,ne,y),ln=he,Wf(0,!1),Pi&&typeof Pi.onPostCommitFiberRoot=="function")try{Pi.onPostCommitFiberRoot(Ys,L)}catch{}return!0}finally{et.p=O,Ie.T=S,Q_(u,p)}}function Ab(u,p,y){p=Ua(y,p),p=wm(u.stateNode,p,2),u=oo(u,p,2),u!==null&&(at(u,2),Ol(u))}function fn(u,p,y){if(u.tag===3)Ab(u,u,y);else for(;p!==null;){if(p.tag===3){Ab(p,u,y);break}else if(p.tag===1){var S=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Il===null||!Il.has(S))){u=Ua(y,u),y=nb(2),S=oo(p,y,2),S!==null&&(Tm(y,S,p,u),at(S,2),Ol(S));break}}p=p.return}}function yp(u,p,y){var S=u.pingCache;if(S===null){S=u.pingCache=new vb;var O=new Set;S.set(p,O)}else O=S.get(p),O===void 0&&(O=new Set,S.set(p,O));O.has(y)||(H_=!0,O.add(y),u=K1.bind(null,u,p,y),p.then(u,u))}function K1(u,p,y){var S=u.pingCache;S!==null&&S.delete(p),u.pingedLanes|=u.suspendedLanes&y,u.warmLanes&=~y,Ln===u&&(Qr&y)===y&&(xi===4||xi===3&&(Qr&62914560)===Qr&&300>fr()-fp?(ln&2)===0&&Ah(u,0):W_|=y,xh===Qr&&(xh=0)),Ol(u)}function qm(u,p){p===0&&(p=fe()),u=nu(u,p),u!==null&&(at(u,p),Ol(u))}function J_(u){var p=u.memoizedState,y=0;p!==null&&(y=p.retryLane),qm(u,y)}function Hf(u,p){var y=0;switch(u.tag){case 13:var S=u.stateNode,O=u.memoizedState;O!==null&&(y=O.retryLane);break;case 19:S=u.stateNode;break;case 22:S=u.stateNode._retryCache;break;default:throw Error(n(314))}S!==null&&S.delete(p),qm(u,y)}function Eb(u,p){return hr(u,p)}var vp=null,vu=null,Hm=!1,Eh=!1,Wm=!1,Mh=0;function Ol(u){u!==vu&&u.next===null&&(vu===null?vp=vu=u:vu=vu.next=u),Eh=!0,Hm||(Hm=!0,ey())}function Wf(u,p){if(!Wm&&Eh){Wm=!0;do for(var y=!1,S=vp;S!==null;){if(u!==0){var O=S.pendingLanes;if(O===0)var L=0;else{var ne=S.suspendedLanes,he=S.pingedLanes;L=(1<<31-Ci(42|u)+1)-1,L&=O&~(ne&~he),L=L&201326741?L&201326741|1:L?L|2:0}L!==0&&(y=!0,Rb(S,L))}else L=Qr,L=le(S,S===Ln?L:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(L&3)===0||ce(S,L)||(y=!0,Rb(S,L));S=S.next}while(y);Wm=!1}}function Q1(){Mb()}function Mb(){Eh=Hm=!1;var u=0;Mh!==0&&(J1()&&(u=Mh),Mh=0);for(var p=fr(),y=null,S=vp;S!==null;){var O=S.next,L=Pb(S,p);L===0?(S.next=null,y===null?vp=O:y.next=O,O===null&&(vu=y)):(y=S,(u!==0||(L&3)!==0)&&(Eh=!0)),S=O}Wf(u)}function Pb(u,p){for(var y=u.suspendedLanes,S=u.pingedLanes,O=u.expirationTimes,L=u.pendingLanes&-62914561;0<L;){var ne=31-Ci(L),he=1<<ne,De=O[ne];De===-1?((he&y)===0||(he&S)!==0)&&(O[ne]=ge(he,p)):De<=p&&(u.expiredLanes|=he),L&=~he}if(p=Ln,y=Qr,y=le(u,u===p?y:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),S=u.callbackNode,y===0||u===p&&(xn===2||xn===9)||u.cancelPendingCommit!==null)return S!==null&&S!==null&&Vt(S),u.callbackNode=null,u.callbackPriority=0;if((y&3)===0||ce(u,y)){if(p=y&-y,p===u.callbackPriority)return p;switch(S!==null&&Vt(S),It(y)){case 2:case 8:y=li;break;case 32:y=Kn;break;case 268435456:y=Mi;break;default:y=Kn}return S=Cb.bind(null,u),y=hr(y,S),u.callbackPriority=p,u.callbackNode=y,p}return S!==null&&S!==null&&Vt(S),u.callbackPriority=2,u.callbackNode=null,2}function Cb(u,p){if(ra!==0&&ra!==5)return u.callbackNode=null,u.callbackPriority=0,null;var y=u.callbackNode;if(qf()&&u.callbackNode!==y)return null;var S=Qr;return S=le(u,u===Ln?S:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),S===0?null:(Sh(u,S,p),Pb(u,fr()),u.callbackNode!=null&&u.callbackNode===y?Cb.bind(null,u):null)}function Rb(u,p){if(qf())return null;Sh(u,p,!0)}function ey(){ga(function(){(ln&6)!==0?hr(aa,Q1):Mb()})}function kl(){return Mh===0&&(Mh=Pe()),Mh}function ty(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:Mn(""+u)}function ry(u,p){var y=p.ownerDocument.createElement("input");return y.name=p.name,y.value=p.value,u.id&&y.setAttribute("form",u.id),p.parentNode.insertBefore(y,p),u=new FormData(u),y.parentNode.removeChild(y),u}function Ib(u,p,y,S,O){if(p==="submit"&&y&&y.stateNode===O){var L=ty((O[_t]||null).action),ne=S.submitter;ne&&(p=(p=ne[_t]||null)?ty(p.formAction):ne.getAttribute("formAction"),p!==null&&(L=p,ne=null));var he=new wo("action","action",null,S,O);u.push({event:he,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(Mh!==0){var De=ne?ry(O,ne):new FormData(O);xs(y,{pending:!0,data:De,method:O.method,action:L},null,De)}}else typeof L=="function"&&(he.preventDefault(),De=ne?ry(O,ne):new FormData(O),xs(y,{pending:!0,data:De,method:O.method,action:L},L,De))},currentTarget:O}]})}}for(var Zm=0;Zm<pl.length;Zm++){var Xm=pl[Zm],ny=Xm.toLowerCase(),Ob=Xm[0].toUpperCase()+Xm.slice(1);ha(ny,"on"+Ob)}ha(Ud,"onAnimationEnd"),ha(mf,"onAnimationIteration"),ha(dl,"onAnimationStart"),ha("dblclick","onDoubleClick"),ha("focusin","onFocus"),ha("focusout","onBlur"),ha(gf,"onTransitionRun"),ha(_f,"onTransitionStart"),ha(th,"onTransitionCancel"),ha(rh,"onTransitionEnd"),vo("onMouseEnter",["mouseout","mouseover"]),vo("onMouseLeave",["mouseout","mouseover"]),vo("onPointerEnter",["pointerout","pointerover"]),vo("onPointerLeave",["pointerout","pointerover"]),Ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ba("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rc));function Gm(u,p){p=(p&4)!==0;for(var y=0;y<u.length;y++){var S=u[y],O=S.event;S=S.listeners;e:{var L=void 0;if(p)for(var ne=S.length-1;0<=ne;ne--){var he=S[ne],De=he.instance,pt=he.currentTarget;if(he=he.listener,De!==L&&O.isPropagationStopped())break e;L=he,O.currentTarget=pt;try{L(O)}catch(Dt){ip(Dt)}O.currentTarget=null,L=De}else for(ne=0;ne<S.length;ne++){if(he=S[ne],De=he.instance,pt=he.currentTarget,he=he.listener,De!==L&&O.isPropagationStopped())break e;L=he,O.currentTarget=pt;try{L(O)}catch(Dt){ip(Dt)}O.currentTarget=null,L=De}}}}function Zr(u,p){var y=p[jr];y===void 0&&(y=p[jr]=new Set);var S=u+"__bubble";y.has(S)||(iy(p,u,2,!1),y.add(S))}function us(u,p,y){var S=0;p&&(S|=4),iy(y,u,S,p)}var Ic="_reactListening"+Math.random().toString(36).slice(2);function Ym(u){if(!u[Ic]){u[Ic]=!0,rl.forEach(function(y){y!=="selectionchange"&&(kb.has(y)||us(y,!1,u),us(y,!0,u))});var p=u.nodeType===9?u:u.ownerDocument;p===null||p[Ic]||(p[Ic]=!0,us("selectionchange",!1,p))}}function iy(u,p,y,S){switch(Ui(p)){case 2:var O=_a;break;case 8:O=Hs;break;default:O=Ra}y=O.bind(null,p,y,u),O=void 0,!nc||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(O=!0),S?O!==void 0?u.addEventListener(p,y,{capture:!0,passive:O}):u.addEventListener(p,y,!0):O!==void 0?u.addEventListener(p,y,{passive:O}):u.addEventListener(p,y,!1)}function Km(u,p,y,S,O){var L=S;if((p&1)===0&&(p&2)===0&&S!==null)e:for(;;){if(S===null)return;var ne=S.tag;if(ne===3||ne===4){var he=S.stateNode.containerInfo;if(he===O)break;if(ne===4)for(ne=S.return;ne!==null;){var De=ne.tag;if((De===3||De===4)&&ne.stateNode.containerInfo===O)return;ne=ne.return}for(;he!==null;){if(ne=mi(he),ne===null)return;if(De=ne.tag,De===5||De===6||De===26||De===27){S=L=ne;continue e}he=he.parentNode}}S=S.return}jn(function(){var pt=L,Dt=Ii(y),Ut=[];e:{var ht=$d.get(u);if(ht!==void 0){var yt=wo,Er=u;switch(u){case"keypress":if(Ar(y)===0)break e;case"keydown":case"keyup":yt=Vu;break;case"focusin":Er="focus",yt=ua;break;case"focusout":Er="blur",yt=ua;break;case"beforeblur":case"afterblur":yt=ua;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yt=Uu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yt=ca;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yt=Pd;break;case Ud:case mf:case dl:yt=_n;break;case rh:yt=T_;break;case"scroll":case"scrollend":yt=rf;break;case"wheel":yt=ll;break;case"copy":case"cut":case"paste":yt=af;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yt=qu;break;case"toggle":case"beforetoggle":yt=hm}var Sr=(p&4)!==0,kn=!Sr&&(u==="scroll"||u==="scrollend"),Je=Sr?ht!==null?ht+"Capture":null:ht;Sr=[];for(var ze=pt,tt;ze!==null;){var Ot=ze;if(tt=Ot.stateNode,Ot=Ot.tag,Ot!==5&&Ot!==26&&Ot!==27||tt===null||Je===null||(Ot=ja(ze,Je),Ot!=null&&Sr.push(Zf(ze,Ot,tt))),kn)break;ze=ze.return}0<Sr.length&&(ht=new yt(ht,Er,null,y,Dt),Ut.push({event:ht,listeners:Sr}))}}if((p&7)===0){e:{if(ht=u==="mouseover"||u==="pointerover",yt=u==="mouseout"||u==="pointerout",ht&&y!==tc&&(Er=y.relatedTarget||y.fromElement)&&(mi(Er)||Er[vr]))break e;if((yt||ht)&&(ht=Dt.window===Dt?Dt:(ht=Dt.ownerDocument)?ht.defaultView||ht.parentWindow:window,yt?(Er=y.relatedTarget||y.toElement,yt=pt,Er=Er?mi(Er):null,Er!==null&&(kn=o(Er),Sr=Er.tag,Er!==kn||Sr!==5&&Sr!==27&&Sr!==6)&&(Er=null)):(yt=null,Er=pt),yt!==Er)){if(Sr=Uu,Ot="onMouseLeave",Je="onMouseEnter",ze="mouse",(u==="pointerout"||u==="pointerover")&&(Sr=qu,Ot="onPointerLeave",Je="onPointerEnter",ze="pointer"),kn=yt==null?ht:on(yt),tt=Er==null?ht:on(Er),ht=new Sr(Ot,ze+"leave",yt,y,Dt),ht.target=kn,ht.relatedTarget=tt,Ot=null,mi(Dt)===pt&&(Sr=new Sr(Je,ze+"enter",Er,y,Dt),Sr.target=tt,Sr.relatedTarget=kn,Ot=Sr),kn=Ot,yt&&Er)t:{for(Sr=yt,Je=Er,ze=0,tt=Sr;tt;tt=Ph(tt))ze++;for(tt=0,Ot=Je;Ot;Ot=Ph(Ot))tt++;for(;0<ze-tt;)Sr=Ph(Sr),ze--;for(;0<tt-ze;)Je=Ph(Je),tt--;for(;ze--;){if(Sr===Je||Je!==null&&Sr===Je.alternate)break t;Sr=Ph(Sr),Je=Ph(Je)}Sr=null}else Sr=null;yt!==null&&Db(Ut,ht,yt,Sr,!1),Er!==null&&kn!==null&&Db(Ut,kn,Er,Sr,!0)}}e:{if(ht=pt?on(pt):window,yt=ht.nodeName&&ht.nodeName.toLowerCase(),yt==="select"||yt==="input"&&ht.type==="file")var or=Nd;else if(Dd(ht))if(Bd)or=zd;else{or=ff;var Lr=Ao}else yt=ht.nodeName,!yt||yt.toLowerCase()!=="input"||ht.type!=="checkbox"&&ht.type!=="radio"?pt&&_s(pt.elementType)&&(or=Nd):or=Fd;if(or&&(or=or(u,pt))){Xu(Ut,or,y,Dt);break e}Lr&&Lr(u,ht,pt),u==="focusout"&&pt&&ht.type==="number"&&pt.memoizedProps.value!=null&&al(ht,"number",ht.value)}switch(Lr=pt?on(pt):window,u){case"focusin":(Dd(Lr)||Lr.contentEditable==="true")&&(tu=Lr,pf=pt,ul=null);break;case"focusout":ul=pf=tu=null;break;case"mousedown":ru=!0;break;case"contextmenu":case"mouseup":case"dragend":ru=!1,eh(Ut,y,Dt);break;case"selectionchange":if(ym)break;case"keydown":case"keyup":eh(Ut,y,Dt)}var pr;if(Rd)e:{switch(u){case"compositionstart":var Pr="onCompositionStart";break e;case"compositionend":Pr="onCompositionEnd";break e;case"compositionupdate":Pr="onCompositionUpdate";break e}Pr=void 0}else cl?lf(u,y)&&(Pr="onCompositionEnd"):u==="keydown"&&y.keyCode===229&&(Pr="onCompositionStart");Pr&&(Id&&y.locale!=="ko"&&(cl||Pr!=="onCompositionStart"?Pr==="onCompositionEnd"&&cl&&(pr=Hr()):(ys=Dt,Gr="value"in ys?ys.value:ys.textContent,cl=!0)),Lr=bp(pt,Pr),0<Lr.length&&(Pr=new ac(Pr,u,null,y,Dt),Ut.push({event:Pr,listeners:Lr}),pr?Pr.data=pr:(pr=cf(y),pr!==null&&(Pr.data=pr)))),(pr=S_?kd(u,y):dm(u,y))&&(Pr=bp(pt,"onBeforeInput"),0<Pr.length&&(Lr=new ac("onBeforeInput","beforeinput",null,y,Dt),Ut.push({event:Lr,listeners:Pr}),Lr.data=pr)),Ib(Ut,u,pt,y,Dt)}Gm(Ut,p)})}function Zf(u,p,y){return{instance:u,listener:p,currentTarget:y}}function bp(u,p){for(var y=p+"Capture",S=[];u!==null;){var O=u,L=O.stateNode;if(O=O.tag,O!==5&&O!==26&&O!==27||L===null||(O=ja(u,y),O!=null&&S.unshift(Zf(u,O,L)),O=ja(u,p),O!=null&&S.push(Zf(u,O,L))),u.tag===3)return S;u=u.return}return[]}function Ph(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function Db(u,p,y,S,O){for(var L=p._reactName,ne=[];y!==null&&y!==S;){var he=y,De=he.alternate,pt=he.stateNode;if(he=he.tag,De!==null&&De===S)break;he!==5&&he!==26&&he!==27||pt===null||(De=pt,O?(pt=ja(y,L),pt!=null&&ne.unshift(Zf(y,pt,De))):O||(pt=ja(y,L),pt!=null&&ne.push(Zf(y,pt,De)))),y=y.return}ne.length!==0&&u.push({event:p,listeners:ne})}var Nb=/\r\n?/g,bu=/\u0000|\uFFFD/g;function ay(u){return(typeof u=="string"?u:""+u).replace(Nb,`
`).replace(bu,"")}function sy(u,p){return p=ay(p),ay(u)===p}function xp(){}function wn(u,p,y,S,O,L){switch(y){case"children":typeof S=="string"?p==="body"||p==="textarea"&&S===""||Os(u,S):(typeof S=="number"||typeof S=="bigint")&&p!=="body"&&Os(u,""+S);break;case"className":La(u,"class",S);break;case"tabIndex":La(u,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":La(u,y,S);break;case"style":ec(u,S,L);break;case"data":if(p!=="object"){La(u,"data",S);break}case"src":case"href":if(S===""&&(p!=="a"||y!=="href")){u.removeAttribute(y);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){u.removeAttribute(y);break}S=Mn(""+S),u.setAttribute(y,S);break;case"action":case"formAction":if(typeof S=="function"){u.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof L=="function"&&(y==="formAction"?(p!=="input"&&wn(u,p,"name",O.name,O,null),wn(u,p,"formEncType",O.formEncType,O,null),wn(u,p,"formMethod",O.formMethod,O,null),wn(u,p,"formTarget",O.formTarget,O,null)):(wn(u,p,"encType",O.encType,O,null),wn(u,p,"method",O.method,O,null),wn(u,p,"target",O.target,O,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){u.removeAttribute(y);break}S=Mn(""+S),u.setAttribute(y,S);break;case"onClick":S!=null&&(u.onclick=xp);break;case"onScroll":S!=null&&Zr("scroll",u);break;case"onScrollEnd":S!=null&&Zr("scrollend",u);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(y=S.__html,y!=null){if(O.children!=null)throw Error(n(60));u.innerHTML=y}}break;case"multiple":u.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":u.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){u.removeAttribute("xlink:href");break}y=Mn(""+S),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(y,""+S):u.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(y,""):u.removeAttribute(y);break;case"capture":case"download":S===!0?u.setAttribute(y,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?u.setAttribute(y,S):u.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?u.setAttribute(y,S):u.removeAttribute(y);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?u.removeAttribute(y):u.setAttribute(y,S);break;case"popover":Zr("beforetoggle",u),Zr("toggle",u),Yl(u,"popover",S);break;case"xlinkActuate":Ta(u,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":Ta(u,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":Ta(u,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":Ta(u,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":Ta(u,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":Ta(u,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":Ta(u,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":Ta(u,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":Ta(u,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":Yl(u,"is",S);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=za.get(y)||y,Yl(u,y,S))}}function oy(u,p,y,S,O,L){switch(y){case"style":ec(u,S,L);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(n(61));if(y=S.__html,y!=null){if(O.children!=null)throw Error(n(60));u.innerHTML=y}}break;case"children":typeof S=="string"?Os(u,S):(typeof S=="number"||typeof S=="bigint")&&Os(u,""+S);break;case"onScroll":S!=null&&Zr("scroll",u);break;case"onScrollEnd":S!=null&&Zr("scrollend",u);break;case"onClick":S!=null&&(u.onclick=xp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Lu.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(O=y.endsWith("Capture"),p=y.slice(2,O?y.length-7:void 0),L=u[_t]||null,L=L!=null?L[y]:null,typeof L=="function"&&u.removeEventListener(p,L,O),typeof S=="function")){typeof L!="function"&&L!==null&&(y in u?u[y]=null:u.hasAttribute(y)&&u.removeAttribute(y)),u.addEventListener(p,S,O);break e}y in u?u[y]=S:S===!0?u.setAttribute(y,""):Yl(u,y,S)}}}function Ca(u,p,y){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Zr("error",u),Zr("load",u);var S=!1,O=!1,L;for(L in y)if(y.hasOwnProperty(L)){var ne=y[L];if(ne!=null)switch(L){case"src":S=!0;break;case"srcSet":O=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:wn(u,p,L,ne,y,null)}}O&&wn(u,p,"srcSet",y.srcSet,y,null),S&&wn(u,p,"src",y.src,y,null);return;case"input":Zr("invalid",u);var he=L=ne=O=null,De=null,pt=null;for(S in y)if(y.hasOwnProperty(S)){var Dt=y[S];if(Dt!=null)switch(S){case"name":O=Dt;break;case"type":ne=Dt;break;case"checked":De=Dt;break;case"defaultChecked":pt=Dt;break;case"value":L=Dt;break;case"defaultValue":he=Dt;break;case"children":case"dangerouslySetInnerHTML":if(Dt!=null)throw Error(n(137,p));break;default:wn(u,p,S,Dt,y,null)}}Ql(u,L,he,De,pt,ne,O,!1),Zc(u);return;case"select":Zr("invalid",u),S=ne=L=null;for(O in y)if(y.hasOwnProperty(O)&&(he=y[O],he!=null))switch(O){case"value":L=he;break;case"defaultValue":ne=he;break;case"multiple":S=he;default:wn(u,p,O,he,y,null)}p=L,y=ne,u.multiple=!!S,p!=null?Jl(u,!!S,p,!1):y!=null&&Jl(u,!!S,y,!0);return;case"textarea":Zr("invalid",u),L=O=S=null;for(ne in y)if(y.hasOwnProperty(ne)&&(he=y[ne],he!=null))switch(ne){case"value":S=he;break;case"defaultValue":O=he;break;case"children":L=he;break;case"dangerouslySetInnerHTML":if(he!=null)throw Error(n(91));break;default:wn(u,p,ne,he,y,null)}Qs(u,S,O,L),Zc(u);return;case"option":for(De in y)if(y.hasOwnProperty(De)&&(S=y[De],S!=null))switch(De){case"selected":u.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:wn(u,p,De,S,y,null)}return;case"dialog":Zr("beforetoggle",u),Zr("toggle",u),Zr("cancel",u),Zr("close",u);break;case"iframe":case"object":Zr("load",u);break;case"video":case"audio":for(S=0;S<Rc.length;S++)Zr(Rc[S],u);break;case"image":Zr("error",u),Zr("load",u);break;case"details":Zr("toggle",u);break;case"embed":case"source":case"link":Zr("error",u),Zr("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(pt in y)if(y.hasOwnProperty(pt)&&(S=y[pt],S!=null))switch(pt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:wn(u,p,pt,S,y,null)}return;default:if(_s(p)){for(Dt in y)y.hasOwnProperty(Dt)&&(S=y[Dt],S!==void 0&&oy(u,p,Dt,S,y,void 0));return}}for(he in y)y.hasOwnProperty(he)&&(S=y[he],S!=null&&wn(u,p,he,S,y,null))}function Bb(u,p,y,S){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var O=null,L=null,ne=null,he=null,De=null,pt=null,Dt=null;for(yt in y){var Ut=y[yt];if(y.hasOwnProperty(yt)&&Ut!=null)switch(yt){case"checked":break;case"value":break;case"defaultValue":De=Ut;default:S.hasOwnProperty(yt)||wn(u,p,yt,null,S,Ut)}}for(var ht in S){var yt=S[ht];if(Ut=y[ht],S.hasOwnProperty(ht)&&(yt!=null||Ut!=null))switch(ht){case"type":L=yt;break;case"name":O=yt;break;case"checked":pt=yt;break;case"defaultChecked":Dt=yt;break;case"value":ne=yt;break;case"defaultValue":he=yt;break;case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(n(137,p));break;default:yt!==Ut&&wn(u,p,ht,yt,S,Ut)}}Gc(u,ne,he,De,pt,Dt,L,O);return;case"select":yt=ne=he=ht=null;for(L in y)if(De=y[L],y.hasOwnProperty(L)&&De!=null)switch(L){case"value":break;case"multiple":yt=De;default:S.hasOwnProperty(L)||wn(u,p,L,null,S,De)}for(O in S)if(L=S[O],De=y[O],S.hasOwnProperty(O)&&(L!=null||De!=null))switch(O){case"value":ht=L;break;case"defaultValue":he=L;break;case"multiple":ne=L;default:L!==De&&wn(u,p,O,L,S,De)}p=he,y=ne,S=yt,ht!=null?Jl(u,!!y,ht,!1):!!S!=!!y&&(p!=null?Jl(u,!!y,p,!0):Jl(u,!!y,y?[]:"",!1));return;case"textarea":yt=ht=null;for(he in y)if(O=y[he],y.hasOwnProperty(he)&&O!=null&&!S.hasOwnProperty(he))switch(he){case"value":break;case"children":break;default:wn(u,p,he,null,S,O)}for(ne in S)if(O=S[ne],L=y[ne],S.hasOwnProperty(ne)&&(O!=null||L!=null))switch(ne){case"value":ht=O;break;case"defaultValue":yt=O;break;case"children":break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(n(91));break;default:O!==L&&wn(u,p,ne,O,S,L)}um(u,ht,yt);return;case"option":for(var Er in y)if(ht=y[Er],y.hasOwnProperty(Er)&&ht!=null&&!S.hasOwnProperty(Er))switch(Er){case"selected":u.selected=!1;break;default:wn(u,p,Er,null,S,ht)}for(De in S)if(ht=S[De],yt=y[De],S.hasOwnProperty(De)&&ht!==yt&&(ht!=null||yt!=null))switch(De){case"selected":u.selected=ht&&typeof ht!="function"&&typeof ht!="symbol";break;default:wn(u,p,De,ht,S,yt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Sr in y)ht=y[Sr],y.hasOwnProperty(Sr)&&ht!=null&&!S.hasOwnProperty(Sr)&&wn(u,p,Sr,null,S,ht);for(pt in S)if(ht=S[pt],yt=y[pt],S.hasOwnProperty(pt)&&ht!==yt&&(ht!=null||yt!=null))switch(pt){case"children":case"dangerouslySetInnerHTML":if(ht!=null)throw Error(n(137,p));break;default:wn(u,p,pt,ht,S,yt)}return;default:if(_s(p)){for(var kn in y)ht=y[kn],y.hasOwnProperty(kn)&&ht!==void 0&&!S.hasOwnProperty(kn)&&oy(u,p,kn,void 0,S,ht);for(Dt in S)ht=S[Dt],yt=y[Dt],!S.hasOwnProperty(Dt)||ht===yt||ht===void 0&&yt===void 0||oy(u,p,Dt,ht,S,yt);return}}for(var Je in y)ht=y[Je],y.hasOwnProperty(Je)&&ht!=null&&!S.hasOwnProperty(Je)&&wn(u,p,Je,null,S,ht);for(Ut in S)ht=S[Ut],yt=y[Ut],!S.hasOwnProperty(Ut)||ht===yt||ht==null&&yt==null||wn(u,p,Ut,ht,S,yt)}var Ch=null,Qm=null;function Rh(u){return u.nodeType===9?u:u.ownerDocument}function ly(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function wp(u,p){if(u===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&p==="foreignObject"?0:u}function Xf(u,p){return u==="textarea"||u==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var Gf=null;function J1(){var u=window.event;return u&&u.type==="popstate"?u===Gf?!1:(Gf=u,!0):(Gf=null,!1)}var Lb=typeof setTimeout=="function"?setTimeout:void 0,ew=typeof clearTimeout=="function"?clearTimeout:void 0,Ih=typeof Promise=="function"?Promise:void 0,ga=typeof queueMicrotask=="function"?queueMicrotask:typeof Ih<"u"?function(u){return Ih.resolve(null).then(u).catch(xu)}:Lb;function xu(u){setTimeout(function(){throw u})}function Dl(u){return u==="head"}function cy(u,p){var y=p,S=0,O=0;do{var L=y.nextSibling;if(u.removeChild(y),L&&L.nodeType===8)if(y=L.data,y==="/$"){if(0<S&&8>S){y=S;var ne=u.ownerDocument;if(y&1&&Yf(ne.documentElement),y&2&&Yf(ne.body),y&4)for(y=ne.head,Yf(y),ne=y.firstChild;ne;){var he=ne.nextSibling,De=ne.nodeName;ne[er]||De==="SCRIPT"||De==="STYLE"||De==="LINK"&&ne.rel.toLowerCase()==="stylesheet"||y.removeChild(ne),ne=he}}if(O===0){u.removeChild(L),Bl(p);return}O--}else y==="$"||y==="$?"||y==="$!"?O++:S=y.charCodeAt(0)-48;else S=0;y=L}while(y);Bl(p)}function Jm(u){var p=u.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var y=p;switch(p=p.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":Jm(y),yr(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}u.removeChild(y)}}function uy(u,p,y,S){for(;u.nodeType===1;){var O=y;if(u.nodeName.toLowerCase()!==p.toLowerCase()){if(!S&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(S){if(!u[er])switch(p){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(L=u.getAttribute("rel"),L==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(L!==O.rel||u.getAttribute("href")!==(O.href==null||O.href===""?null:O.href)||u.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin)||u.getAttribute("title")!==(O.title==null?null:O.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(L=u.getAttribute("src"),(L!==(O.src==null?null:O.src)||u.getAttribute("type")!==(O.type==null?null:O.type)||u.getAttribute("crossorigin")!==(O.crossOrigin==null?null:O.crossOrigin))&&L&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(p==="input"&&u.type==="hidden"){var L=O.name==null?null:""+O.name;if(O.type==="hidden"&&u.getAttribute("name")===L)return u}else return u;if(u=Vo(u.nextSibling),u===null)break}return null}function tw(u,p,y){if(p==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!y||(u=Vo(u.nextSibling),u===null))return null;return u}function eg(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState==="complete"}function Fb(u,p){var y=u.ownerDocument;if(u.data!=="$?"||y.readyState==="complete")p();else{var S=function(){p(),y.removeEventListener("DOMContentLoaded",S)};y.addEventListener("DOMContentLoaded",S),u._reactRetry=S}}function Vo(u){for(;u!=null;u=u.nextSibling){var p=u.nodeType;if(p===1||p===3)break;if(p===8){if(p=u.data,p==="$"||p==="$!"||p==="$?"||p==="F!"||p==="F")break;if(p==="/$")return null}}return u}var tg=null;function rg(u){u=u.previousSibling;for(var p=0;u;){if(u.nodeType===8){var y=u.data;if(y==="$"||y==="$!"||y==="$?"){if(p===0)return u;p--}else y==="/$"&&p++}u=u.previousSibling}return null}function ng(u,p,y){switch(p=Rh(y),u){case"html":if(u=p.documentElement,!u)throw Error(n(452));return u;case"head":if(u=p.head,!u)throw Error(n(453));return u;case"body":if(u=p.body,!u)throw Error(n(454));return u;default:throw Error(n(451))}}function Yf(u){for(var p=u.attributes;p.length;)u.removeAttributeNode(p[0]);yr(u)}var Ya=new Map,ig=new Set;function Tp(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var qo=et.d;et.d={f:ag,r:Sp,D:hy,C:rw,L:f,m:l,X:g,S:d,M:x};function ag(){var u=qo.f(),p=Um();return u||p}function Sp(u){var p=ci(u);p!==null&&p.tag===5&&p.type==="form"?co(p):qo.r(u)}var wu=typeof document>"u"?null:document;function sg(u,p,y){var S=wu;if(S&&typeof p=="string"&&p){var O=Fa(p);O='link[rel="'+u+'"][href="'+O+'"]',typeof y=="string"&&(O+='[crossorigin="'+y+'"]'),ig.has(O)||(ig.add(O),u={rel:u,crossOrigin:y,href:p},S.querySelector(O)===null&&(p=S.createElement("link"),Ca(p,"link",u),ni(p),S.head.appendChild(p)))}}function hy(u){qo.D(u),sg("dns-prefetch",u,null)}function rw(u,p){qo.C(u,p),sg("preconnect",u,p)}function f(u,p,y){qo.L(u,p,y);var S=wu;if(S&&u&&p){var O='link[rel="preload"][as="'+Fa(p)+'"]';p==="image"&&y&&y.imageSrcSet?(O+='[imagesrcset="'+Fa(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(O+='[imagesizes="'+Fa(y.imageSizes)+'"]')):O+='[href="'+Fa(u)+'"]';var L=O;switch(p){case"style":L=P(u);break;case"script":L=$(u)}Ya.has(L)||(u=w({rel:"preload",href:p==="image"&&y&&y.imageSrcSet?void 0:u,as:p},y),Ya.set(L,u),S.querySelector(O)!==null||p==="style"&&S.querySelector(R(L))||p==="script"&&S.querySelector(H(L))||(p=S.createElement("link"),Ca(p,"link",u),ni(p),S.head.appendChild(p)))}}function l(u,p){qo.m(u,p);var y=wu;if(y&&u){var S=p&&typeof p.as=="string"?p.as:"script",O='link[rel="modulepreload"][as="'+Fa(S)+'"][href="'+Fa(u)+'"]',L=O;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":L=$(u)}if(!Ya.has(L)&&(u=w({rel:"modulepreload",href:u},p),Ya.set(L,u),y.querySelector(O)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(H(L)))return}S=y.createElement("link"),Ca(S,"link",u),ni(S),y.head.appendChild(S)}}}function d(u,p,y){qo.S(u,p,y);var S=wu;if(S&&u){var O=wr(S).hoistableStyles,L=P(u);p=p||"default";var ne=O.get(L);if(!ne){var he={loading:0,preload:null};if(ne=S.querySelector(R(L)))he.loading=5;else{u=w({rel:"stylesheet",href:u,"data-precedence":p},y),(y=Ya.get(L))&&ie(u,y);var De=ne=S.createElement("link");ni(De),Ca(De,"link",u),De._p=new Promise(function(pt,Dt){De.onload=pt,De.onerror=Dt}),De.addEventListener("load",function(){he.loading|=1}),De.addEventListener("error",function(){he.loading|=2}),he.loading|=4,te(ne,p,S)}ne={type:"stylesheet",instance:ne,count:1,state:he},O.set(L,ne)}}}function g(u,p){qo.X(u,p);var y=wu;if(y&&u){var S=wr(y).hoistableScripts,O=$(u),L=S.get(O);L||(L=y.querySelector(H(O)),L||(u=w({src:u,async:!0},p),(p=Ya.get(O))&&oe(u,p),L=y.createElement("script"),ni(L),Ca(L,"link",u),y.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},S.set(O,L))}}function x(u,p){qo.M(u,p);var y=wu;if(y&&u){var S=wr(y).hoistableScripts,O=$(u),L=S.get(O);L||(L=y.querySelector(H(O)),L||(u=w({src:u,async:!0,type:"module"},p),(p=Ya.get(O))&&oe(u,p),L=y.createElement("script"),ni(L),Ca(L,"link",u),y.head.appendChild(L)),L={type:"script",instance:L,count:1,state:null},S.set(O,L))}}function E(u,p,y,S){var O=(O=Pt.current)?Tp(O):null;if(!O)throw Error(n(446));switch(u){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(p=P(y.href),y=wr(O).hoistableStyles,S=y.get(p),S||(S={type:"style",instance:null,count:0,state:null},y.set(p,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){u=P(y.href);var L=wr(O).hoistableStyles,ne=L.get(u);if(ne||(O=O.ownerDocument||O,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},L.set(u,ne),(L=O.querySelector(R(u)))&&!L._p&&(ne.instance=L,ne.state.loading=5),Ya.has(u)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},Ya.set(u,y),L||F(O,u,y,ne.state))),p&&S===null)throw Error(n(528,""));return ne}if(p&&S!==null)throw Error(n(529,""));return null;case"script":return p=y.async,y=y.src,typeof y=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=$(y),y=wr(O).hoistableScripts,S=y.get(p),S||(S={type:"script",instance:null,count:0,state:null},y.set(p,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,u))}}function P(u){return'href="'+Fa(u)+'"'}function R(u){return'link[rel="stylesheet"]['+u+"]"}function N(u){return w({},u,{"data-precedence":u.precedence,precedence:null})}function F(u,p,y,S){u.querySelector('link[rel="preload"][as="style"]['+p+"]")?S.loading=1:(p=u.createElement("link"),S.preload=p,p.addEventListener("load",function(){return S.loading|=1}),p.addEventListener("error",function(){return S.loading|=2}),Ca(p,"link",y),ni(p),u.head.appendChild(p))}function $(u){return'[src="'+Fa(u)+'"]'}function H(u){return"script[async]"+u}function Q(u,p,y){if(p.count++,p.instance===null)switch(p.type){case"style":var S=u.querySelector('style[data-href~="'+Fa(y.href)+'"]');if(S)return p.instance=S,ni(S),S;var O=w({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return S=(u.ownerDocument||u).createElement("style"),ni(S),Ca(S,"style",O),te(S,y.precedence,u),p.instance=S;case"stylesheet":O=P(y.href);var L=u.querySelector(R(O));if(L)return p.state.loading|=4,p.instance=L,ni(L),L;S=N(y),(O=Ya.get(O))&&ie(S,O),L=(u.ownerDocument||u).createElement("link"),ni(L);var ne=L;return ne._p=new Promise(function(he,De){ne.onload=he,ne.onerror=De}),Ca(L,"link",S),p.state.loading|=4,te(L,y.precedence,u),p.instance=L;case"script":return L=$(y.src),(O=u.querySelector(H(L)))?(p.instance=O,ni(O),O):(S=y,(O=Ya.get(L))&&(S=w({},y),oe(S,O)),u=u.ownerDocument||u,O=u.createElement("script"),ni(O),Ca(O,"link",S),u.head.appendChild(O),p.instance=O);case"void":return null;default:throw Error(n(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(S=p.instance,p.state.loading|=4,te(S,y.precedence,u));return p.instance}function te(u,p,y){for(var S=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),O=S.length?S[S.length-1]:null,L=O,ne=0;ne<S.length;ne++){var he=S[ne];if(he.dataset.precedence===p)L=he;else if(L!==O)break}L?L.parentNode.insertBefore(u,L.nextSibling):(p=y.nodeType===9?y.head:y,p.insertBefore(u,p.firstChild))}function ie(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.title==null&&(u.title=p.title)}function oe(u,p){u.crossOrigin==null&&(u.crossOrigin=p.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=p.referrerPolicy),u.integrity==null&&(u.integrity=p.integrity)}var me=null;function we(u,p,y){if(me===null){var S=new Map,O=me=new Map;O.set(y,S)}else O=me,S=O.get(y),S||(S=new Map,O.set(y,S));if(S.has(u))return S;for(S.set(u,null),y=y.getElementsByTagName(u),O=0;O<y.length;O++){var L=y[O];if(!(L[er]||L[_r]||u==="link"&&L.getAttribute("rel")==="stylesheet")&&L.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=L.getAttribute(p)||"";ne=u+ne;var he=S.get(ne);he?he.push(L):S.set(ne,[L])}}return S}function Fe(u,p,y){u=u.ownerDocument||u,u.head.insertBefore(y,p==="title"?u.querySelector("head > title"):null)}function Ee(u,p,y){if(y===1||p.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return u=p.disabled,typeof p.precedence=="string"&&u==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function ee(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}var pe=null;function Re(){}function st(u,p,y){if(pe===null)throw Error(n(475));var S=pe;if(p.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var O=P(y.href),L=u.querySelector(R(O));if(L){u=L._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(S.count++,S=dt.bind(S),u.then(S,S)),p.state.loading|=4,p.instance=L,ni(L);return}L=u.ownerDocument||u,y=N(y),(O=Ya.get(O))&&ie(y,O),L=L.createElement("link"),ni(L);var ne=L;ne._p=new Promise(function(he,De){ne.onload=he,ne.onerror=De}),Ca(L,"link",y),p.instance=L}S.stylesheets===null&&(S.stylesheets=new Map),S.stylesheets.set(p,u),(u=p.state.preload)&&(p.state.loading&3)===0&&(S.count++,p=dt.bind(S),u.addEventListener("load",p),u.addEventListener("error",p))}}function Nt(){if(pe===null)throw Error(n(475));var u=pe;return u.stylesheets&&u.count===0&&$t(u,u.stylesheets),0<u.count?function(p){var y=setTimeout(function(){if(u.stylesheets&&$t(u,u.stylesheets),u.unsuspend){var S=u.unsuspend;u.unsuspend=null,S()}},6e4);return u.unsuspend=p,function(){u.unsuspend=null,clearTimeout(y)}}:null}function dt(){if(this.count--,this.count===0){if(this.stylesheets)$t(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var wt=null;function $t(u,p){u.stylesheets=null,u.unsuspend!==null&&(u.count++,wt=new Map,p.forEach(Lt,u),wt=null,dt.call(u))}function Lt(u,p){if(!(p.state.loading&4)){var y=wt.get(u);if(y)var S=y.get(null);else{y=new Map,wt.set(u,y);for(var O=u.querySelectorAll("link[data-precedence],style[data-precedence]"),L=0;L<O.length;L++){var ne=O[L];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(y.set(ne.dataset.precedence,ne),S=ne)}S&&y.set(null,S)}O=p.instance,ne=O.getAttribute("data-precedence"),L=y.get(ne)||S,L===S&&y.set(null,O),y.set(ne,O),this.count++,S=dt.bind(this),O.addEventListener("load",S),O.addEventListener("error",S),L?L.parentNode.insertBefore(O,L.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(O,u.firstChild)),p.state.loading|=4}}var qt={$$typeof:Z,Provider:null,Consumer:null,_currentValue:ot,_currentValue2:ot,_threadCount:0};function Et(u,p,y,S,O,L,ne,he){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$e(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$e(0),this.hiddenUpdates=$e(null),this.identifierPrefix=S,this.onUncaughtError=O,this.onCaughtError=L,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function ir(u,p,y,S,O,L,ne,he,De,pt,Dt,Ut){return u=new Et(u,p,y,ne,he,De,pt,Ut),p=1,L===!0&&(p|=24),L=Ki(3,null,null,p),u.current=L,L.stateNode=u,p=ah(),p.refCount++,u.pooledCache=p,p.refCount++,L.memoizedState={element:S,isDehydrated:y,cache:p},cn(L),u}function br(u){return u?(u=gl,u):gl}function mr(u,p,y,S,O,L){O=br(O),S.context===null?S.context=O:S.pendingContext=O,S=zs(p),S.payload={element:y},L=L===void 0?null:L,L!==null&&(S.callback=L),y=oo(u,S,p),y!==null&&(Pa(y,u,p),Oo(y,u,p))}function cr(u,p){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var y=u.retryLane;u.retryLane=y!==0&&y<p?y:p}}function Fr(u,p){cr(u,p),(u=u.alternate)&&cr(u,p)}function Wn(u){if(u.tag===13){var p=nu(u,67108864);p!==null&&Pa(p,u,67108864),Fr(u,67108864)}}var ai=!0;function _a(u,p,y,S){var O=Ie.T;Ie.T=null;var L=et.p;try{et.p=2,Ra(u,p,y,S)}finally{et.p=L,Ie.T=O}}function Hs(u,p,y,S){var O=Ie.T;Ie.T=null;var L=et.p;try{et.p=8,Ra(u,p,y,S)}finally{et.p=L,Ie.T=O}}function Ra(u,p,y,S){if(ai){var O=ki(S);if(O===null)Km(u,p,S,Tn,y),di(u,S);else if(Ho(O,u,p,y,S))S.stopPropagation();else if(di(u,S),p&4&&-1<Vi.indexOf(u)){for(;O!==null;){var L=ci(O);if(L!==null)switch(L.tag){case 3:if(L=L.stateNode,L.current.memoizedState.isDehydrated){var ne=Ve(L.pendingLanes);if(ne!==0){var he=L;for(he.pendingLanes|=2,he.entangledLanes|=2;ne;){var De=1<<31-Ci(ne);he.entanglements[1]|=De,ne&=~De}Ol(L),(ln&6)===0&&(Lm=fr()+500,Wf(0))}}break;case 13:he=nu(L,2),he!==null&&Pa(he,L,2),Um(),Fr(L,2)}if(L=ki(S),L===null&&Km(u,p,S,Tn,y),L===O)break;O=L}O!==null&&S.stopPropagation()}else Km(u,p,S,null,y)}}function ki(u){return u=Ii(u),wi(u)}var Tn=null;function wi(u){if(Tn=null,u=mi(u),u!==null){var p=o(u);if(p===null)u=null;else{var y=p.tag;if(y===13){if(u=c(p),u!==null)return u;u=null}else if(y===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;u=null}else p!==u&&(u=null)}}return Tn=u,null}function Ui(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(En()){case aa:return 2;case li:return 8;case Kn:case Ei:return 32;case Mi:return 268435456;default:return 32}default:return 32}}var Di=!1,fi=null,$i=null,Fn=null,na=new Map,ei=new Map,zn=[],Vi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function di(u,p){switch(u){case"focusin":case"focusout":fi=null;break;case"dragenter":case"dragleave":$i=null;break;case"mouseover":case"mouseout":Fn=null;break;case"pointerover":case"pointerout":na.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":ei.delete(p.pointerId)}}function sn(u,p,y,S,O,L){return u===null||u.nativeEvent!==L?(u={blockedOn:p,domEventName:y,eventSystemFlags:S,nativeEvent:L,targetContainers:[O]},p!==null&&(p=ci(p),p!==null&&Wn(p)),u):(u.eventSystemFlags|=S,p=u.targetContainers,O!==null&&p.indexOf(O)===-1&&p.push(O),u)}function Ho(u,p,y,S,O){switch(p){case"focusin":return fi=sn(fi,u,p,y,S,O),!0;case"dragenter":return $i=sn($i,u,p,y,S,O),!0;case"mouseover":return Fn=sn(Fn,u,p,y,S,O),!0;case"pointerover":var L=O.pointerId;return na.set(L,sn(na.get(L)||null,u,p,y,S,O)),!0;case"gotpointercapture":return L=O.pointerId,ei.set(L,sn(ei.get(L)||null,u,p,y,S,O)),!0}return!1}function Oh(u){var p=mi(u.target);if(p!==null){var y=o(p);if(y!==null){if(p=y.tag,p===13){if(p=c(y),p!==null){u.blockedOn=p,Kt(u.priority,function(){if(y.tag===13){var S=ji();S=Ke(S);var O=nu(y,S);O!==null&&Pa(O,y,S),Fr(y,S)}});return}}else if(p===3&&y.stateNode.current.memoizedState.isDehydrated){u.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}u.blockedOn=null}function Ts(u){if(u.blockedOn!==null)return!1;for(var p=u.targetContainers;0<p.length;){var y=ki(u.nativeEvent);if(y===null){y=u.nativeEvent;var S=new y.constructor(y.type,y);tc=S,y.target.dispatchEvent(S),tc=null}else return p=ci(y),p!==null&&Wn(p),u.blockedOn=y,!1;p.shift()}return!0}function zb(u,p,y){Ts(u)&&y.delete(p)}function Kf(){Di=!1,fi!==null&&Ts(fi)&&(fi=null),$i!==null&&Ts($i)&&($i=null),Fn!==null&&Ts(Fn)&&(Fn=null),na.forEach(zb),ei.forEach(zb)}function Nl(u,p){u.blockedOn===p&&(u.blockedOn=null,Di||(Di=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Kf)))}var Oc=null;function kh(u){Oc!==u&&(Oc=u,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Oc===u&&(Oc=null);for(var p=0;p<u.length;p+=3){var y=u[p],S=u[p+1],O=u[p+2];if(typeof S!="function"){if(wi(S||y)===null)continue;break}var L=ci(y);L!==null&&(u.splice(p,3),p-=3,xs(L,{pending:!0,data:O,method:y.method,action:S},S,O))}}))}function Bl(u){function p(De){return Nl(De,u)}fi!==null&&Nl(fi,u),$i!==null&&Nl($i,u),Fn!==null&&Nl(Fn,u),na.forEach(p),ei.forEach(p);for(var y=0;y<zn.length;y++){var S=zn[y];S.blockedOn===u&&(S.blockedOn=null)}for(;0<zn.length&&(y=zn[0],y.blockedOn===null);)Oh(y),y.blockedOn===null&&zn.shift();if(y=(u.ownerDocument||u).$$reactFormReplay,y!=null)for(S=0;S<y.length;S+=3){var O=y[S],L=y[S+1],ne=O[_t]||null;if(typeof L=="function")ne||kh(y);else if(ne){var he=null;if(L&&L.hasAttribute("formAction")){if(O=L,ne=L[_t]||null)he=ne.formAction;else if(wi(O)!==null)continue}else he=ne.action;typeof he=="function"?y[S+1]=he:(y.splice(S,3),S-=3),kh(y)}}}function og(u){this._internalRoot=u}Ap.prototype.render=og.prototype.render=function(u){var p=this._internalRoot;if(p===null)throw Error(n(409));var y=p.current,S=ji();mr(y,S,u,p,null,null)},Ap.prototype.unmount=og.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var p=u.containerInfo;mr(u.current,2,null,u,null,null),Um(),p[vr]=null}};function Ap(u){this._internalRoot=u}Ap.prototype.unstable_scheduleHydration=function(u){if(u){var p=Xt();u={blockedOn:null,target:u,priority:p};for(var y=0;y<zn.length&&p!==0&&p<zn[y].priority;y++);zn.splice(y,0,u),y===0&&Oh(u)}};var fy=e.version;if(fy!=="19.1.0")throw Error(n(527,fy,"19.1.0"));et.findDOMNode=function(u){var p=u._reactInternals;if(p===void 0)throw typeof u.render=="function"?Error(n(188)):(u=Object.keys(u).join(","),Error(n(268,u)));return u=m(p),u=u!==null?v(u):null,u=u===null?null:u.stateNode,u};var jb={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Ie,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qf.isDisabled&&Qf.supportsFiber)try{Ys=Qf.inject(jb),Pi=Qf}catch{}}return py.createRoot=function(u,p){if(!i(u))throw Error(n(299));var y=!1,S="",O=M_,L=tb,ne=rb,he=null;return p!=null&&(p.unstable_strictMode===!0&&(y=!0),p.identifierPrefix!==void 0&&(S=p.identifierPrefix),p.onUncaughtError!==void 0&&(O=p.onUncaughtError),p.onCaughtError!==void 0&&(L=p.onCaughtError),p.onRecoverableError!==void 0&&(ne=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(he=p.unstable_transitionCallbacks)),p=ir(u,1,!1,null,null,y,S,O,L,ne,he,null),u[vr]=p.current,Ym(u),new og(p)},py.hydrateRoot=function(u,p,y){if(!i(u))throw Error(n(299));var S=!1,O="",L=M_,ne=tb,he=rb,De=null,pt=null;return y!=null&&(y.unstable_strictMode===!0&&(S=!0),y.identifierPrefix!==void 0&&(O=y.identifierPrefix),y.onUncaughtError!==void 0&&(L=y.onUncaughtError),y.onCaughtError!==void 0&&(ne=y.onCaughtError),y.onRecoverableError!==void 0&&(he=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(De=y.unstable_transitionCallbacks),y.formState!==void 0&&(pt=y.formState)),p=ir(u,1,!0,p,y??null,S,O,L,ne,he,De,pt),p.context=br(null),y=p.current,S=ji(),S=Ke(S),O=zs(S),O.callback=null,oo(y,O,S),y=S,p.current.lanes=y,at(p,y),Ol(p),u[vr]=p.current,Ym(u),new Ap(p)},py.version="19.1.0",py}var U3;function IU(){if(U3)return aw.exports;U3=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),aw.exports=RU(),aw.exports}var OU=IU();const kU="modulepreload",DU=function(t){return"/eco-migration-app/"+t},$3={},NU=function(e,r,n){let i=Promise.resolve();if(r&&r.length>0){let c=function(v){return Promise.all(v.map(w=>Promise.resolve(w).then(M=>({status:"fulfilled",value:M}),M=>({status:"rejected",reason:M}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),m=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=c(r.map(v=>{if(v=DU(v),v in $3)return;$3[v]=!0;const w=v.endsWith(".css"),M=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${M}`))return;const I=document.createElement("link");if(I.rel=w?"stylesheet":kU,w||(I.as="script"),I.crossOrigin="",I.href=v,m&&I.setAttribute("nonce",m),document.head.appendChild(I),w)return new Promise((k,z)=>{I.addEventListener("load",k),I.addEventListener("error",()=>z(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(c){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=c,window.dispatchEvent(s),!s.defaultPrevented)throw c}return i.then(c=>{for(const s of c||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})},BU=it.createContext(null);function LU(t,e){const r=Array.isArray(t)?t[0]:t?t.x:0,n=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return r===i&&n===o}function Eu(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Eu(t[r],e[r]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const i of r)if(!e.hasOwnProperty(i)||!Eu(t[i],e[i]))return!1;return!0}return!1}function V3(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function q3(t,e){const r=e.viewState||e,n={};if("longitude"in r&&"latitude"in r&&(r.longitude!==t.center.lng||r.latitude!==t.center.lat)){const i=t.center.constructor;n.center=new i(r.longitude,r.latitude)}return"zoom"in r&&r.zoom!==t.zoom&&(n.zoom=r.zoom),"bearing"in r&&r.bearing!==t.bearing&&(n.bearing=r.bearing),"pitch"in r&&r.pitch!==t.pitch&&(n.pitch=r.pitch),r.padding&&t.padding&&!Eu(r.padding,t.padding)&&(n.padding=r.padding),n}const FU=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function H3(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const n of t.layers)e[n.id]=n;const r=t.layers.map(n=>{let i=null;"interactive"in n&&(i=Object.assign({},n),delete i.interactive);const o=e[n.ref];if(o){i=i||Object.assign({},n),delete i.ref;for(const c of FU)c in o&&(i[c]=o[c])}return i||n});return{...t,layers:r}}const W3={version:8,sources:{},layers:[]},Z3={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},X3={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},G3={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},zU=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],jU=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Dg{constructor(e,r,n){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=i=>{const o=this.props[G3[i.type]];o?o(i):i.type==="error"&&console.error(i.error)},this._onCameraEvent=i=>{if(this._internalUpdate)return;i.viewState=this._propsedCameraUpdate||V3(this._map.transform);const o=this.props[X3[i.type]];o&&o(i)},this._onCameraUpdate=i=>this._internalUpdate?i:(this._propsedCameraUpdate=V3(i),q3(i,this.props)),this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const o=this.props[Z3[i.type]];o&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),o(i),delete i.features)},this._MapClass=e,this.props=r,this._initialize(n)}get map(){return this._map}setProps(e){const r=this.props;this.props=e;const n=this._updateSettings(e,r),i=this._updateSize(e),o=this._updateViewState(e);this._updateStyle(e,r),this._updateStyleComponents(e),this._updateHandlers(e,r),(n||i||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,r){const n=Dg.savedMaps.pop();if(!n)return null;const i=n.map,o=i.getContainer();for(r.className=o.className;o.childNodes.length>0;)r.appendChild(o.childNodes[0]);i._container=r;const c=i._resizeObserver;c&&(c.disconnect(),c.observe(r)),n.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:s}=e;return s&&(s.bounds?i.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):n._updateViewState(s)),i.isStyleLoaded()?i.fire("load"):i.once("style.load",()=>i.fire("load")),i._update(),n}_initialize(e){const{props:r}=this,{mapStyle:n=W3}=r,i={...r,...r.initialViewState,container:e,style:H3(n)},o=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),r.gl){const s=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=s,r.gl)}const c=new this._MapClass(i);o.padding&&c.setPadding(o.padding),r.cursor&&(c.getCanvas().style.cursor=r.cursor),c.transformCameraUpdate=this._onCameraUpdate,c.on("style.load",()=>{var s;this._styleComponents={light:c.getLight(),sky:c.getSky(),projection:(s=c.getProjection)==null?void 0:s.call(c),terrain:c.getTerrain()},this._updateStyleComponents(this.props)}),c.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const s in Z3)c.on(s,this._onPointerEvent);for(const s in X3)c.on(s,this._onCameraEvent);for(const s in G3)c.on(s,this._onEvent);this._map=c}recycle(){const r=this.map.getContainer().querySelector("[mapboxgl-children]");r==null||r.remove(),Dg.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:r}=e;if(r){const n=this._map;if(r.width!==n.transform.width||r.height!==n.transform.height)return n.resize(),!0}return!1}_updateViewState(e){const r=this._map,n=r.transform;if(!r.isMoving()){const o=q3(n,e);if(Object.keys(o).length>0)return this._internalUpdate=!0,r.jumpTo(o),this._internalUpdate=!1,!0}return!1}_updateSettings(e,r){const n=this._map;let i=!1;for(const o of zU)if(o in e&&!Eu(e[o],r[o])){i=!0;const c=n[`set${o[0].toUpperCase()}${o.slice(1)}`];c==null||c.call(n,e[o])}return i}_updateStyle(e,r){if(e.cursor!==r.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==r.mapStyle){const{mapStyle:n=W3,styleDiffing:i=!0}=e,o={diff:i};"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(H3(n),o)}}_updateStyleComponents({light:e,projection:r,sky:n,terrain:i}){var s,m;const o=this._map,c=this._styleComponents;o.style._loaded&&(e&&!Eu(e,c.light)&&(c.light=e,o.setLight(e)),r&&!Eu(r,c.projection)&&r!==((s=c.projection)==null?void 0:s.type)&&(c.projection=typeof r=="string"?{type:r}:r,(m=o.setProjection)==null||m.call(o,c.projection)),n&&!Eu(n,c.sky)&&(c.sky=n,o.setSky(n)),i!==void 0&&!Eu(i,c.terrain)&&(!i||o.getSource(i.source))&&(c.terrain=i,o.setTerrain(i)))}_updateHandlers(e,r){const n=this._map;for(const i of jU){const o=e[i]??!0,c=r[i]??!0;Eu(o,c)||(o?n[i].enable(o):n[i].disable())}}_queryRenderedFeatures(e){const r=this._map,{interactiveLayerIds:n=[]}=this.props;try{return r.queryRenderedFeatures(e,{layers:n.filter(r.getLayer.bind(r))})}catch{return[]}}_updateHover(e){var i;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const o=e.type,c=((i=this._hoveredFeatures)==null?void 0:i.length)>0,s=this._queryRenderedFeatures(e.point),m=s.length>0;!m&&c&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=s,m&&!c&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=o}else this._hoveredFeatures=null}}Dg.savedMaps=[];const UU=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function $U(t){if(!t)return null;const e=t.map,r={getMap:()=>e};for(const n of VU(e))!(n in r)&&!UU.includes(n)&&(r[n]=e[n].bind(e));return r}function VU(t){const e=new Set;let r=t;for(;r;){for(const n of Object.getOwnPropertyNames(r))n[0]!=="_"&&typeof t[n]=="function"&&n!=="fire"&&n!=="setEventedParent"&&e.add(n);r=Object.getPrototypeOf(r)}return Array.from(e)}const qU=typeof document<"u"?it.useLayoutEffect:it.useEffect;function HU(t,e){const{RTLTextPlugin:r,maxParallelImageRequests:n,workerCount:i,workerUrl:o}=e;if(r&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:c,lazy:s=!0}=typeof r=="string"?{pluginUrl:r}:r;t.setRTLTextPlugin(c,m=>{m&&console.error(m)},s)}n!==void 0&&t.setMaxParallelImageRequests(n),i!==void 0&&t.setWorkerCount(i),o!==void 0&&t.setWorkerUrl(o)}const o1=it.createContext(null);function WU(t,e){const r=it.useContext(BU),[n,i]=it.useState(null),o=it.useRef(),{current:c}=it.useRef({mapLib:null,map:null});it.useEffect(()=>{const v=t.mapLib;let w=!0,M;return Promise.resolve(v||NU(()=>Promise.resolve().then(()=>i5),void 0)).then(I=>{if(!w)return;if(!I)throw new Error("Invalid mapLib");const k="Map"in I?I:I.default;if(!k.Map)throw new Error("Invalid mapLib");HU(k,t),t.reuseMaps&&(M=Dg.reuse(t,o.current)),M||(M=new Dg(k.Map,t,o.current)),c.map=$U(M),c.mapLib=k,i(M),r==null||r.onMapMount(c.map,t.id)}).catch(I=>{const{onError:k}=t;k?k({type:"error",target:null,originalEvent:null,error:I}):console.error(I)}),()=>{w=!1,M&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?M.recycle():M.destroy())}},[]),qU(()=>{n&&n.setProps(t)}),it.useImperativeHandle(e,()=>c.map,[n]);const s=it.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),m={height:"100%"};return it.createElement("div",{id:t.id,ref:o,style:s},n&&it.createElement(o1.Provider,{value:c},it.createElement("div",{"mapboxgl-children":"",style:m},t.children)))}const ZU=it.forwardRef(WU);var $B=UB();const XU=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Yh(t,e){if(!t||!e)return;const r=t.style;for(const n in e){const i=e[n];Number.isFinite(i)&&!XU.test(n)?r[n]=`${i}px`:r[n]=i}}function VB(t,e){if(t===e)return null;const r=Y3(t),n=Y3(e),i=[];for(const o of n)r.has(o)||i.push(o);for(const o of r)n.has(o)||i.push(o);return i.length===0?null:i}function Y3(t){return new Set(t?t.trim().split(/\s+/):[])}it.memo(it.forwardRef((t,e)=>{const{map:r,mapLib:n}=it.useContext(o1),i=it.useRef({props:t}),o=it.useMemo(()=>{let K=!1;it.Children.forEach(t.children,re=>{re&&(K=!0)});const J={...t,element:K?document.createElement("div"):void 0},Z=new n.Marker(J);return Z.setLngLat([t.longitude,t.latitude]),Z.getElement().addEventListener("click",re=>{var W,Y;(Y=(W=i.current.props).onClick)==null||Y.call(W,{type:"click",target:Z,originalEvent:re})}),Z.on("dragstart",re=>{var Y,ue;const W=re;W.lngLat=o.getLngLat(),(ue=(Y=i.current.props).onDragStart)==null||ue.call(Y,W)}),Z.on("drag",re=>{var Y,ue;const W=re;W.lngLat=o.getLngLat(),(ue=(Y=i.current.props).onDrag)==null||ue.call(Y,W)}),Z.on("dragend",re=>{var Y,ue;const W=re;W.lngLat=o.getLngLat(),(ue=(Y=i.current.props).onDragEnd)==null||ue.call(Y,W)}),Z},[]);it.useEffect(()=>(o.addTo(r.getMap()),()=>{o.remove()}),[]);const{longitude:c,latitude:s,offset:m,style:v,draggable:w=!1,popup:M=null,rotation:I=0,rotationAlignment:k="auto",pitchAlignment:z="auto"}=t;it.useEffect(()=>{Yh(o.getElement(),v)},[v]),it.useImperativeHandle(e,()=>o,[]);const V=i.current.props;(o.getLngLat().lng!==c||o.getLngLat().lat!==s)&&o.setLngLat([c,s]),m&&!LU(o.getOffset(),m)&&o.setOffset(m),o.isDraggable()!==w&&o.setDraggable(w),o.getRotation()!==I&&o.setRotation(I),o.getRotationAlignment()!==k&&o.setRotationAlignment(k),o.getPitchAlignment()!==z&&o.setPitchAlignment(z),o.getPopup()!==M&&o.setPopup(M);const U=VB(V.className,t.className);if(U)for(const K of U)o.toggleClassName(K);return i.current.props=t,$B.createPortal(t.children,o.getElement())}));it.memo(it.forwardRef((t,e)=>{const{map:r,mapLib:n}=it.useContext(o1),i=it.useMemo(()=>document.createElement("div"),[]),o=it.useRef({props:t}),c=it.useMemo(()=>{const s={...t},m=new n.Popup(s);return m.setLngLat([t.longitude,t.latitude]),m.once("open",v=>{var w,M;(M=(w=o.current.props).onOpen)==null||M.call(w,v)}),m},[]);if(it.useEffect(()=>{const s=m=>{var v,w;(w=(v=o.current.props).onClose)==null||w.call(v,m)};return c.on("close",s),c.setDOMContent(i).addTo(r.getMap()),()=>{c.off("close",s),c.isOpen()&&c.remove()}},[]),it.useEffect(()=>{Yh(c.getElement(),t.style)},[t.style]),it.useImperativeHandle(e,()=>c,[]),c.isOpen()){const s=o.current.props;(c.getLngLat().lng!==t.longitude||c.getLngLat().lat!==t.latitude)&&c.setLngLat([t.longitude,t.latitude]),t.offset&&!Eu(s.offset,t.offset)&&c.setOffset(t.offset),(s.anchor!==t.anchor||s.maxWidth!==t.maxWidth)&&(c.options.anchor=t.anchor,c.setMaxWidth(t.maxWidth));const m=VB(s.className,t.className);if(m)for(const v of m)c.toggleClassName(v);o.current.props=t}return $B.createPortal(t.children,i)}));function em(t,e,r,n){const i=it.useContext(o1),o=it.useMemo(()=>t(i),[]);return it.useEffect(()=>{const c=e,s=null,m=typeof e=="function"?e:null,{map:v}=i;return v.hasControl(o)||(v.addControl(o,c==null?void 0:c.position),s&&s(i)),()=>{m&&m(i),v.hasControl(o)&&v.removeControl(o)}},[]),o}function GU(t){const e=em(({mapLib:r})=>new r.AttributionControl(t),{position:t.position});return it.useEffect(()=>{Yh(e._container,t.style)},[t.style]),null}it.memo(GU);function YU(t){const e=em(({mapLib:r})=>new r.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return it.useEffect(()=>{Yh(e._controlContainer,t.style)},[t.style]),null}it.memo(YU);function KU(t,e){const r=it.useRef({props:t}),n=em(({mapLib:i})=>{const o=new i.GeolocateControl(t),c=o._setupUI;return o._setupUI=()=>{o._container.hasChildNodes()||c()},o.on("geolocate",s=>{var m,v;(v=(m=r.current.props).onGeolocate)==null||v.call(m,s)}),o.on("error",s=>{var m,v;(v=(m=r.current.props).onError)==null||v.call(m,s)}),o.on("outofmaxbounds",s=>{var m,v;(v=(m=r.current.props).onOutOfMaxBounds)==null||v.call(m,s)}),o.on("trackuserlocationstart",s=>{var m,v;(v=(m=r.current.props).onTrackUserLocationStart)==null||v.call(m,s)}),o.on("trackuserlocationend",s=>{var m,v;(v=(m=r.current.props).onTrackUserLocationEnd)==null||v.call(m,s)}),o},{position:t.position});return r.current.props=t,it.useImperativeHandle(e,()=>n,[]),it.useEffect(()=>{Yh(n._container,t.style)},[t.style]),null}it.memo(it.forwardRef(KU));function QU(t){const e=em(({mapLib:r})=>new r.NavigationControl(t),{position:t.position});return it.useEffect(()=>{Yh(e._container,t.style)},[t.style]),null}it.memo(QU);function JU(t){const e=em(({mapLib:o})=>new o.ScaleControl(t),{position:t.position}),r=it.useRef(t),n=r.current;r.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==n.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==n.unit&&e.setUnit(t.unit),it.useEffect(()=>{Yh(e._container,i)},[i]),null}it.memo(JU);function e5(t){const e=em(({mapLib:r})=>new r.TerrainControl(t),{position:t.position});return it.useEffect(()=>{Yh(e._container,t.style)},[t.style]),null}it.memo(e5);function t5(t){const e=em(({mapLib:r})=>new r.LogoControl(t),{position:t.position});return it.useEffect(()=>{Yh(e._container,t.style)},[t.style]),null}it.memo(t5);var m0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.4.0/LICENSE.txt
 */var r5=m0.exports,K3;function n5(){return K3||(K3=1,function(t,e){(function(r,n){t.exports=n()})(r5,function(){var r={},n={};function i(c,s,m){if(n[c]=m,c==="index"){var v="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",w={};return n.shared(w),n.index(r,w),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),r}}i("shared",["exports"],function(c){function s(f,l,d,g){return new(d||(d=Promise))(function(x,E){function P(F){try{N(g.next(F))}catch($){E($)}}function R(F){try{N(g.throw(F))}catch($){E($)}}function N(F){var $;F.done?x(F.value):($=F.value,$ instanceof d?$:new d(function(H){H($)})).then(P,R)}N((g=g.apply(f,l||[])).next())})}function m(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var v,w;function M(){if(w)return v;function f(l,d){this.x=l,this.y=d}return w=1,v=f,f.prototype={clone:function(){return new f(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,d){return this.clone()._rotateAround(l,d)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var d=l.x-this.x,g=l.y-this.y;return d*d+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,d){return Math.atan2(this.x*d-this.y*l,this.x*l+this.y*d)},_matMult:function(l){var d=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=d,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var d=Math.cos(l),g=Math.sin(l),x=g*this.x+d*this.y;return this.x=d*this.x-g*this.y,this.y=x,this},_rotateAround:function(l,d){var g=Math.cos(l),x=Math.sin(l),E=d.y+x*(this.x-d.x)+g*(this.y-d.y);return this.x=d.x+g*(this.x-d.x)-x*(this.y-d.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},f.convert=function(l){return l instanceof f?l:Array.isArray(l)?new f(l[0],l[1]):l},v}typeof SuppressedError=="function"&&SuppressedError;var I,k,z=m(M()),V=function(){if(k)return I;function f(l,d,g,x){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(x-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=g,this.p2y=x}return k=1,I=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,d){if(d===void 0&&(d=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,x=0;x<8;x++){var E=this.sampleCurveX(g)-l;if(Math.abs(E)<d)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=E/P}var R=0,N=1;for(g=l,x=0;x<20&&(E=this.sampleCurveX(g),!(Math.abs(E-l)<d));x++)l>E?R=g:N=g,g=.5*(N-R)+R;return g},solve:function(l,d){return this.sampleCurveY(this.solveCurveX(l,d))}},I}(),U=m(V);let K,J;function Z(){return K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K}function re(){if(J==null&&(J=!1,Z())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let g=0;g<5*5;g++){const x=4*g;l.fillStyle=`rgb(${x},${x+1},${x+2})`,l.fillRect(g%5,Math.floor(g/5),1,1)}const d=l.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&d[g]!==g){J=!0;break}}}return J||!1}var W=1e-6,Y=typeof Float32Array<"u"?Float32Array:Array;function ue(){var f=new Y(9);return Y!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}function be(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Ce(){var f=new Y(3);return Y!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function Ye(f){return Math.hypot(f[0],f[1],f[2])}function Me(f,l,d){var g=new Y(3);return g[0]=f,g[1]=l,g[2]=d,g}Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)});var Ue,Qe=Ye;function Ze(f,l,d){var g=l[0],x=l[1],E=l[2],P=l[3];return f[0]=d[0]*g+d[4]*x+d[8]*E+d[12]*P,f[1]=d[1]*g+d[5]*x+d[9]*E+d[13]*P,f[2]=d[2]*g+d[6]*x+d[10]*E+d[14]*P,f[3]=d[3]*g+d[7]*x+d[11]*E+d[15]*P,f}function ct(){var f=new Y(4);return Y!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f[3]=1,f}function Ie(){var f=new Y(2);return Y!=Float32Array&&(f[0]=0,f[1]=0),f}function et(f,l){var d=new Y(2);return d[0]=f,d[1]=l,d}Ce(),Ue=new Y(4),Y!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0,Ue[3]=0),Ce(),Me(1,0,0),Me(0,1,0),ct(),ct(),ue(),Ie();const ot=8192;function Bt(f,l,d){return l*(ot/(f.tileSize*Math.pow(2,d-f.tileID.overscaledZ)))}function Te(f,l){return(f%l+l)%l}function ft(f,l,d){return f*(1-d)+l*d}function vt(f){if(f<=0)return 0;if(f>=1)return 1;const l=f*f,d=l*f;return 4*(f<.5?d:3*(f-l)+d-.75)}function Ct(f,l,d,g){const x=new U(f,l,d,g);return E=>x.solve(E)}const Yt=Ct(.25,.1,.25,1);function Ge(f,l,d){return Math.min(d,Math.max(l,f))}function Pt(f,l,d){const g=d-l,x=((f-l)%g+g)%g+l;return x===l?d:x}function tr(f,...l){for(const d of l)for(const g in d)f[g]=d[g];return f}let Ft=1;function zt(f,l,d){const g={};for(const x in f)g[x]=l.call(this,f[x],x,f);return g}function Gt(f,l,d){const g={};for(const x in f)l.call(this,f[x],x,f)&&(g[x]=f[x]);return g}function Zt(f){return Array.isArray(f)?f.map(Zt):typeof f=="object"&&f?zt(f,Zt):f}const mt={};function hr(f){mt[f]||(typeof console<"u"&&console.warn(f),mt[f]=!0)}function Vt(f,l,d){return(d.y-f.y)*(l.x-f.x)>(l.y-f.y)*(d.x-f.x)}function ar(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let rr=null;function fr(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const En="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function aa(f,l,d,g,x){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const E=new VideoFrame(f,{timestamp:0});try{const P=E==null?void 0:E.format;if(!P||!P.startsWith("BGR")&&!P.startsWith("RGB"))throw new Error(`Unrecognized format ${P}`);const R=P.startsWith("BGR"),N=new Uint8ClampedArray(g*x*4);if(yield E.copyTo(N,function(F,$,H,Q,te){const ie=4*Math.max(1,0),oe=(Math.max(0,H)-H)*Q*4+ie,me=4*Q,we=Math.max(0,$),Fe=Math.max(0,H);return{rect:{x:we,y:Fe,width:Math.min(F.width,$+Q)-we,height:Math.min(F.height,H+te)-Fe},layout:[{offset:oe,stride:me}]}}(f,l,d,g,x)),R)for(let F=0;F<N.length;F+=4){const $=N[F];N[F]=N[F+2],N[F+2]=$}return N}finally{E.close()}})}let li,Kn;function Ei(f,l,d,g){return f.addEventListener(l,d,g),{unsubscribe:()=>{f.removeEventListener(l,d,g)}}}function Mi(f){return f/Math.PI*180}const el={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},_o={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ys="AbortError";function Pi(){return new Error(Ys)}const Xi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ci(f){return Xi.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const yo="global-dispatcher";class tl extends Error{constructor(l,d,g,x){super(`AJAXError: ${d} (${l}): ${g}`),this.status=l,this.statusText=d,this.url=g,this.body=x}}const Ks=()=>ar(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Gi=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const g=Ci(f.url);if(g)return g(f,l);if(ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:yo},l)}if(!(/^file:/.test(d=f.url)||/^file:/.test(Ks())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,x){return s(this,void 0,void 0,function*(){const E=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:Ks(),signal:x.signal});let P,R;g.type!=="json"||E.headers.has("Accept")||E.headers.set("Accept","application/json");try{P=yield fetch(E)}catch(F){throw new tl(0,F.message,g.url,new Blob)}if(!P.ok){const F=yield P.blob();throw new tl(P.status,P.statusText,g.url,F)}R=g.type==="arrayBuffer"||g.type==="image"?P.arrayBuffer():g.type==="json"?P.json():P.text();const N=yield R;if(x.signal.aborted)throw Pi();return{data:N,cacheControl:P.headers.get("Cache-Control"),expires:P.headers.get("Expires")}})}(f,l);if(ar(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:yo},l)}var d;return function(g,x){return new Promise((E,P)=>{var R;const N=new XMLHttpRequest;N.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(N.responseType="arraybuffer");for(const F in g.headers)N.setRequestHeader(F,g.headers[F]);g.type==="json"&&(N.responseType="text",!((R=g.headers)===null||R===void 0)&&R.Accept||N.setRequestHeader("Accept","application/json")),N.withCredentials=g.credentials==="include",N.onerror=()=>{P(new Error(N.statusText))},N.onload=()=>{if(!x.signal.aborted)if((N.status>=200&&N.status<300||N.status===0)&&N.response!==null){let F=N.response;if(g.type==="json")try{F=JSON.parse(N.response)}catch($){return void P($)}E({data:F,cacheControl:N.getResponseHeader("Cache-Control"),expires:N.getResponseHeader("Expires")})}else{const F=new Blob([N.response],{type:N.getResponseHeader("Content-Type")});P(new tl(N.status,N.statusText,g.url,F))}},x.signal.addEventListener("abort",()=>{N.abort(),P(Pi())}),N.send(g.body)})}(f,l)};function ms(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const l=new URL(f),d=window.location;return l.protocol===d.protocol&&l.host===d.host}function Ve(f,l,d){d[f]&&d[f].indexOf(l)!==-1||(d[f]=d[f]||[],d[f].push(l))}function le(f,l,d){if(d&&d[f]){const g=d[f].indexOf(l);g!==-1&&d[f].splice(g,1)}}class ce{constructor(l,d={}){tr(this,d),this.type=l}}class ge extends ce{constructor(l,d={}){super("error",tr({error:l},d))}}class Pe{on(l,d){return this._listeners=this._listeners||{},Ve(l,d,this._listeners),{unsubscribe:()=>{this.off(l,d)}}}off(l,d){return le(l,d,this._listeners),le(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},Ve(l,d,this._oneTimeListeners),this):new Promise(g=>this.once(l,g))}fire(l,d){typeof l=="string"&&(l=new ce(l,d||{}));const g=l.type;if(this.listens(g)){l.target=this;const x=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const R of x)R.call(this,l);const E=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const R of E)le(g,R,this._oneTimeListeners),R.call(this,l);const P=this._eventedParent;P&&(tr(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(l))}else l instanceof ge&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $e=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function at(f,l){const d={};for(const g in f)g!=="ref"&&(d[g]=f[g]);return $e.forEach(g=>{g in l&&(d[g]=l[g])}),d}function Ne(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let d=0;d<f.length;d++)if(!Ne(f[d],l[d]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(const d in f)if(!Ne(f[d],l[d]))return!1;return!0}return f===l}function gt(f,l){f.push(l)}function bt(f,l,d){gt(d,{command:"addSource",args:[f,l[f]]})}function Ke(f,l,d){gt(l,{command:"removeSource",args:[f]}),d[f]=!0}function It(f,l,d,g){Ke(f,d,g),bt(f,l,d)}function Xt(f,l,d){let g;for(g in f[d])if(Object.prototype.hasOwnProperty.call(f[d],g)&&g!=="data"&&!Ne(f[d][g],l[d][g]))return!1;for(g in l[d])if(Object.prototype.hasOwnProperty.call(l[d],g)&&g!=="data"&&!Ne(f[d][g],l[d][g]))return!1;return!0}function Kt(f,l,d,g,x,E){f=f||{},l=l||{};for(const P in f)Object.prototype.hasOwnProperty.call(f,P)&&(Ne(f[P],l[P])||d.push({command:E,args:[g,P,l[P],x]}));for(const P in l)Object.prototype.hasOwnProperty.call(l,P)&&!Object.prototype.hasOwnProperty.call(f,P)&&(Ne(f[P],l[P])||d.push({command:E,args:[g,P,l[P],x]}))}function dr(f){return f.id}function _r(f,l){return f[l.id]=l,f}class _t{constructor(l,d,g,x){this.message=(l?`${l}: `:"")+g,x&&(this.identifier=x),d!=null&&d.__line__&&(this.line=d.__line__)}}function vr(f,...l){for(const d of l)for(const g in d)f[g]=d[g];return f}class jr extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}class rn{constructor(l,d=[]){this.parent=l,this.bindings={};for(const[g,x]of d)this.bindings[g]=x}concat(l){return new rn(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const qr={kind:"null"},Mt={kind:"number"},er={kind:"string"},yr={kind:"boolean"},mi={kind:"color"},ci={kind:"projectionDefinition"},on={kind:"object"},wr={kind:"value"},ni={kind:"collator"},rl={kind:"formatted"},Lu={kind:"padding"},Ba={kind:"resolvedImage"},vo={kind:"variableAnchorOffsetCollection"};function Ni(f,l){return{kind:"array",itemType:f,N:l}}function gn(f){if(f.kind==="array"){const l=gn(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}const Ri=[qr,Mt,er,yr,mi,ci,rl,on,Ni(wr),Lu,Ba,vo];function Fu(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Fu(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(const d of Ri)if(!Fu(d,l))return null}}return`Expected ${gn(f)} but found ${gn(l)} instead.`}function Yl(f,l){return l.some(d=>d.kind===f.kind)}function La(f,l){return l.some(d=>d==="null"?f===null:d==="array"?Array.isArray(f):d==="object"?f&&!Array.isArray(f)&&typeof f=="object":d===typeof f)}function Ta(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}const ef=.96422,Sd=.82521,nl=4/29,il=6/29,zu=3*il*il,x_=il*il*il,lm=Math.PI/180,gs=180/Math.PI;function Ad(f){return(f%=360)<0&&(f+=360),f}function cm([f,l,d,g]){let x,E;const P=tf((.2225045*(f=Zc(f))+.7168786*(l=Zc(l))+.0606169*(d=Zc(d)))/1);f===l&&l===d?x=E=P:(x=tf((.4360747*f+.3850649*l+.1430804*d)/ef),E=tf((.0139322*f+.0971045*l+.7141733*d)/Sd));const R=116*P-16;return[R<0?0:R,500*(x-P),200*(P-E),g]}function Zc(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function tf(f){return f>x_?Math.pow(f,1/3):f/zu+nl}function Xc([f,l,d,g]){let x=(f+16)/116,E=isNaN(l)?x:x+l/500,P=isNaN(d)?x:x-d/200;return x=1*Fa(x),E=ef*Fa(E),P=Sd*Fa(P),[Kl(3.1338561*E-1.6168667*x-.4906146*P),Kl(-.9787684*E+1.9161415*x+.033454*P),Kl(.0719453*E-.2289914*x+1.4052427*P),g]}function Kl(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function Fa(f){return f>il?f*f*f:zu*(f-nl)}function Gc(f){return parseInt(f.padEnd(2,f),16)/255}function Ql(f,l){return al(l?f/100:f,0,1)}function al(f,l,d){return Math.min(Math.max(l,f),d)}function Jl(f){return!f.some(Number.isNaN)}const um={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Qs(f,l,d){return f+d*(l-f)}function Os(f,l,d){return f.map((g,x)=>Qs(g,l[x],d))}class kr{constructor(l,d,g,x=1,E=!0){this.r=l,this.g=d,this.b=g,this.a=x,E||(this.r*=x,this.g*=x,this.b*=x,x||this.overwriteGetter("rgb",[l,d,g,x]))}static parse(l){if(l instanceof kr)return l;if(typeof l!="string")return;const d=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const x=um[g];if(x){const[P,R,N]=x;return[P/255,R/255,N/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const P=g.length<6?1:2;let R=1;return[Gc(g.slice(R,R+=P)),Gc(g.slice(R,R+=P)),Gc(g.slice(R,R+=P)),Gc(g.slice(R,R+P)||"ff")]}if(g.startsWith("rgb")){const P=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){const[R,N,F,$,H,Q,te,ie,oe,me,we,Fe]=P,Ee=[$||" ",te||" ",me].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const ee=[F,Q,oe].join(""),pe=ee==="%%%"?100:ee===""?255:0;if(pe){const Re=[al(+N/pe,0,1),al(+H/pe,0,1),al(+ie/pe,0,1),we?Ql(+we,Fe):1];if(Jl(Re))return Re}}return}}const E=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[P,R,N,F,$,H,Q,te,ie]=E,oe=[N||" ",$||" ",Q].join("");if(oe==="  "||oe==="  /"||oe===",,"||oe===",,,"){const me=[+R,al(+F,0,100),al(+H,0,100),te?Ql(+te,ie):1];if(Jl(me))return function([we,Fe,Ee,ee]){function pe(Re){const st=(Re+we/30)%12,Nt=Fe*Math.min(Ee,1-Ee);return Ee-Nt*Math.max(-1,Math.min(st-3,9-st,1))}return we=Ad(we),Fe/=100,Ee/=100,[pe(0),pe(8),pe(4),ee]}(me)}}}(l);return d?new kr(...d,!1):void 0}get rgb(){const{r:l,g:d,b:g,a:x}=this,E=x||1/0;return this.overwriteGetter("rgb",[l/E,d/E,g/E,x])}get hcl(){return this.overwriteGetter("hcl",function(l){const[d,g,x,E]=cm(l),P=Math.sqrt(g*g+x*x);return[Math.round(1e4*P)?Ad(Math.atan2(x,g)*gs):NaN,P,d,E]}(this.rgb))}get lab(){return this.overwriteGetter("lab",cm(this.rgb))}overwriteGetter(l,d){return Object.defineProperty(this,l,{value:d}),d}toString(){const[l,d,g,x]=this.rgb;return`rgba(${[l,d,g].map(E=>Math.round(255*E)).join(",")},${x})`}static interpolate(l,d,g,x="rgb"){switch(x){case"rgb":{const[E,P,R,N]=Os(l.rgb,d.rgb,g);return new kr(E,P,R,N,!1)}case"hcl":{const[E,P,R,N]=l.hcl,[F,$,H,Q]=d.hcl;let te,ie;if(isNaN(E)||isNaN(F))isNaN(E)?isNaN(F)?te=NaN:(te=F,R!==1&&R!==0||(ie=$)):(te=E,H!==1&&H!==0||(ie=P));else{let Ee=F-E;F>E&&Ee>180?Ee-=360:F<E&&E-F>180&&(Ee+=360),te=E+g*Ee}const[oe,me,we,Fe]=function([Ee,ee,pe,Re]){return Ee=isNaN(Ee)?0:Ee*lm,Xc([pe,Math.cos(Ee)*ee,Math.sin(Ee)*ee,Re])}([te,ie??Qs(P,$,g),Qs(R,H,g),Qs(N,Q,g)]);return new kr(oe,me,we,Fe,!1)}case"lab":{const[E,P,R,N]=Xc(Os(l.lab,d.lab,g));return new kr(E,P,R,N,!1)}}}}kr.black=new kr(0,0,0,1),kr.white=new kr(1,1,1,1),kr.transparent=new kr(0,0,0,0),kr.red=new kr(1,0,0,1);class Ur{constructor(l,d,g){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ec=["bottom","center","top"];class _s{constructor(l,d,g,x,E,P){this.text=l,this.image=d,this.scale=g,this.fontStack=x,this.textColor=E,this.verticalAlign=P}}class za{constructor(l){this.sections=l}static fromString(l){return new za([new _s(l,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof za?l:za.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class sa{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof sa)return l;if(typeof l=="number")return new sa([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const d of l)if(typeof d!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new sa(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,d,g){return new sa(Os(l.values,d.values,g))}}class Mn{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const tc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ii{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Ii)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let d=0;d<l.length;d+=2){const g=l[d],x=l[d+1];if(typeof g!="string"||!tc.has(g)||!Array.isArray(x)||x.length!==2||typeof x[0]!="number"||typeof x[1]!="number")return}return new Ii(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,d,g){const x=l.values,E=d.values;if(x.length!==E.length)throw new Mn(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${d.toString()}`);const P=[];for(let R=0;R<x.length;R+=2){if(x[R]!==E[R])throw new Mn(`Cannot interpolate values containing mismatched anchors. from[${R}]: ${x[R]}, to[${R}]: ${E[R]}`);P.push(x[R]);const[N,F]=x[R+1],[$,H]=E[R+1];P.push([Qs(N,$,g),Qs(F,H,g)])}return new Ii(P)}}class Bi{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Bi({name:l,available:!1}):null}}class gi{constructor(l,d,g){this.from=l,this.to=d,this.transition=g}static interpolate(l,d,g){return new gi(l,d,g)}static parse(l){return l instanceof gi?l:Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"?new gi(l[0],l[1],l[2]):typeof l=="object"&&typeof l.from=="string"&&typeof l.to=="string"&&typeof l.transition=="number"?new gi(l.from,l.to,l.transition):typeof l=="string"?new gi(l,l,1):void 0}}function bo(f,l,d,g){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[f,l,d,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[f,l,d,g]:[f,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rc(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof gi||f instanceof kr||f instanceof Ur||f instanceof za||f instanceof sa||f instanceof Ii||f instanceof Bi)return!0;if(Array.isArray(f)){for(const l of f)if(!rc(l))return!1;return!0}if(typeof f=="object"){for(const l in f)if(!rc(f[l]))return!1;return!0}return!1}function jn(f){if(f===null)return qr;if(typeof f=="string")return er;if(typeof f=="boolean")return yr;if(typeof f=="number")return Mt;if(f instanceof kr)return mi;if(f instanceof gi)return ci;if(f instanceof Ur)return ni;if(f instanceof za)return rl;if(f instanceof sa)return Lu;if(f instanceof Ii)return vo;if(f instanceof Bi)return Ba;if(Array.isArray(f)){const l=f.length;let d;for(const g of f){const x=jn(g);if(d){if(d===x)continue;d=wr;break}d=x}return Ni(d||wr,l)}return on}function ja(f){const l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof kr||f instanceof gi||f instanceof za||f instanceof sa||f instanceof Ii||f instanceof Bi?f.toString():JSON.stringify(f)}class oa{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!rc(l[1]))return d.error("invalid value");const g=l[1];let x=jn(g);const E=d.expectedType;return x.kind!=="array"||x.N!==0||!E||E.kind!=="array"||typeof E.N=="number"&&E.N!==0||(x=E),new oa(x,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const nc={string:er,number:Mt,boolean:yr,object:on};class la{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g,x=1;const E=l[0];if(E==="array"){let R,N;if(l.length>2){const F=l[1];if(typeof F!="string"||!(F in nc)||F==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);R=nc[F],x++}else R=wr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);N=l[2],x++}g=Ni(R,N)}else{if(!nc[E])throw new Error(`Types doesn't contain name = ${E}`);g=nc[E]}const P=[];for(;x<l.length;x++){const R=d.parse(l[x],x,wr);if(!R)return null;P.push(R)}return new la(g,P)}evaluate(l){for(let d=0;d<this.args.length;d++){const g=this.args[d].evaluate(l);if(!Fu(this.type,jn(g)))return g;if(d===this.args.length-1)throw new Mn(`Expected value to be of type ${gn(this.type)}, but found ${gn(jn(g))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const ys={"to-boolean":yr,"to-color":mi,"to-number":Mt,"to-string":er};class Gr{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const g=l[0];if(!ys[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&l.length!==2)return d.error("Expected one argument.");const x=ys[g],E=[];for(let P=1;P<l.length;P++){const R=d.parse(l[P],P,wr);if(!R)return null;E.push(R)}return new Gr(x,E)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let d,g;for(const x of this.args){if(d=x.evaluate(l),g=null,d instanceof kr)return d;if(typeof d=="string"){const E=l.parseColor(d);if(E)return E}else if(Array.isArray(d)&&(g=d.length<3||d.length>4?`Invalid rgba value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:bo(d[0],d[1],d[2],d[3]),!g))return new kr(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new Mn(g||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const g of this.args){d=g.evaluate(l);const x=sa.parse(d);if(x)return x}throw new Mn(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const g of this.args){d=g.evaluate(l);const x=Ii.parse(d);if(x)return x}throw new Mn(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const g of this.args){if(d=g.evaluate(l),d===null)return 0;const x=Number(d);if(!isNaN(x))return x}throw new Mn(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return za.fromString(ja(this.args[0].evaluate(l)));case"resolvedImage":return Bi.fromString(ja(this.args[0].evaluate(l)));case"projectionDefinition":return this.args[0].evaluate(l);default:return ja(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const Yc=["Unknown","Point","LineString","Polygon"];class Hr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let d=this._parseColorCache[l];return d||(d=this._parseColorCache[l]=kr.parse(l)),d}}class Ar{constructor(l,d,g=[],x,E=new rn,P=[]){this.registry=l,this.path=g,this.key=g.map(R=>`[${R}]`).join(""),this.scope=E,this.errors=P,this.expectedType=x,this._isConstant=d}parse(l,d,g,x,E={}){return d?this.concat(d,g,x)._parse(l,E):this._parse(l,E)}_parse(l,d){function g(x,E,P){return P==="assert"?new la(E,[x]):P==="coerce"?new Gr(E,[x]):x}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const x=l[0];if(typeof x!="string")return this.error(`Expression name must be a string, but found ${typeof x} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const E=this.registry[x];if(E){let P=E.parse(l,this);if(!P)return null;if(this.expectedType){const R=this.expectedType,N=P.type;if(R.kind!=="string"&&R.kind!=="number"&&R.kind!=="boolean"&&R.kind!=="object"&&R.kind!=="array"||N.kind!=="value")if(R.kind!=="projectionDefinition"||N.kind!=="string"&&N.kind!=="array")if(R.kind!=="color"&&R.kind!=="formatted"&&R.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string")if(R.kind!=="padding"||N.kind!=="value"&&N.kind!=="number"&&N.kind!=="array")if(R.kind!=="variableAnchorOffsetCollection"||N.kind!=="value"&&N.kind!=="array"){if(this.checkSubtype(R,N))return null}else P=g(P,R,d.typeAnnotation||"coerce");else P=g(P,R,d.typeAnnotation||"coerce");else P=g(P,R,d.typeAnnotation||"coerce");else P=g(P,R,d.typeAnnotation||"coerce");else P=g(P,R,d.typeAnnotation||"assert")}if(!(P instanceof oa)&&P.type.kind!=="resolvedImage"&&this._isConstant(P)){const R=new Hr;try{P=new oa(P.type,P.evaluate(R))}catch(N){return this.error(N.message),null}}return P}return this.error(`Unknown expression "${x}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,g){const x=typeof l=="number"?this.path.concat(l):this.path,E=g?this.scope.concat(g):this.scope;return new Ar(this.registry,this._isConstant,x,d||null,E,this.errors)}error(l,...d){const g=`${this.key}${d.map(x=>`[${x}]`).join("")}`;this.errors.push(new jr(g,l))}checkSubtype(l,d){const g=Fu(l,d);return g&&this.error(g),g}}class xo{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const g=[];for(let E=1;E<l.length-1;E+=2){const P=l[E];if(typeof P!="string")return d.error(`Expected string, but found ${typeof P} instead.`,E);if(/[^a-zA-Z0-9_]/.test(P))return d.error("Variable names must contain only alphanumeric characters or '_'.",E);const R=d.parse(l[E+1],E+1);if(!R)return null;g.push([P,R])}const x=d.parse(l[l.length-1],l.length-1,d.expectedType,g);return x?new xo(g,x):null}outputDefined(){return this.result.outputDefined()}}class $r{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const g=l[1];return d.scope.has(g)?new $r(g,d.scope.get(g)):d.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Li{constructor(l,d,g){this.type=l,this.index=d,this.input=g}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const g=d.parse(l[1],1,Mt),x=d.parse(l[2],2,Ni(d.expectedType||wr));return g&&x?new Li(x.type.itemType,g,x):null}evaluate(l){const d=this.index.evaluate(l),g=this.input.evaluate(l);if(d<0)throw new Mn(`Array index out of bounds: ${d} < 0.`);if(d>=g.length)throw new Mn(`Array index out of bounds: ${d} > ${g.length-1}.`);if(d!==Math.floor(d))throw new Mn(`Array index must be an integer, but found ${d} instead.`);return g[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Yi{constructor(l,d){this.type=yr,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const g=d.parse(l[1],1,wr),x=d.parse(l[2],2,wr);return g&&x?Yl(g.type,[yr,er,Mt,qr,wr])?new Yi(g,x):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${gn(g.type)} instead`):null}evaluate(l){const d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!g)return!1;if(!La(d,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${gn(jn(d))} instead.`);if(!La(g,["string","array"]))throw new Mn(`Expected second argument to be of type array or string, but found ${gn(jn(g))} instead.`);return g.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class wo{constructor(l,d,g){this.type=Mt,this.needle=l,this.haystack=d,this.fromIndex=g}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const g=d.parse(l[1],1,wr),x=d.parse(l[2],2,wr);if(!g||!x)return null;if(!Yl(g.type,[yr,er,Mt,qr,wr]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${gn(g.type)} instead`);if(l.length===4){const E=d.parse(l[3],3,Mt);return E?new wo(g,x,E):null}return new wo(g,x)}evaluate(l){const d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!La(d,["boolean","string","number","null"]))throw new Mn(`Expected first argument to be of type boolean, string, number or null, but found ${gn(jn(d))} instead.`);let x;if(this.fromIndex&&(x=this.fromIndex.evaluate(l)),La(g,["string"])){const E=g.indexOf(d,x);return E===-1?-1:[...g.slice(0,E)].length}if(La(g,["array"]))return g.indexOf(d,x);throw new Mn(`Expected second argument to be of type array or string, but found ${gn(jn(g))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class sl{constructor(l,d,g,x,E,P){this.inputType=l,this.type=d,this.input=g,this.cases=x,this.outputs=E,this.otherwise=P}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let g,x;d.expectedType&&d.expectedType.kind!=="value"&&(x=d.expectedType);const E={},P=[];for(let F=2;F<l.length-1;F+=2){let $=l[F];const H=l[F+1];Array.isArray($)||($=[$]);const Q=d.concat(F);if($.length===0)return Q.error("Expected at least one branch label.");for(const ie of $){if(typeof ie!="number"&&typeof ie!="string")return Q.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return Q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return Q.error("Numeric branch labels must be integer values.");if(g){if(Q.checkSubtype(g,jn(ie)))return null}else g=jn(ie);if(E[String(ie)]!==void 0)return Q.error("Branch labels must be unique.");E[String(ie)]=P.length}const te=d.parse(H,F,x);if(!te)return null;x=x||te.type,P.push(te)}const R=d.parse(l[1],1,wr);if(!R)return null;const N=d.parse(l[l.length-1],l.length-1,x);return N?R.type.kind!=="value"&&d.concat(1).checkSubtype(g,R.type)?null:new sl(g,x,R,E,P,N):null}evaluate(l){const d=this.input.evaluate(l);return(jn(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class rf{constructor(l,d,g){this.type=l,this.branches=d,this.otherwise=g}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let g;d.expectedType&&d.expectedType.kind!=="value"&&(g=d.expectedType);const x=[];for(let P=1;P<l.length-1;P+=2){const R=d.parse(l[P],P,yr);if(!R)return null;const N=d.parse(l[P+1],P+1,g);if(!N)return null;x.push([R,N]),g=g||N.type}const E=d.parse(l[l.length-1],l.length-1,g);if(!E)return null;if(!g)throw new Error("Can't infer output type");return new rf(g,x,E)}evaluate(l){for(const[d,g]of this.branches)if(d.evaluate(l))return g.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[d,g]of this.branches)l(d),l(g);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class ol{constructor(l,d,g,x){this.type=l,this.input=d,this.beginIndex=g,this.endIndex=x}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const g=d.parse(l[1],1,wr),x=d.parse(l[2],2,Mt);if(!g||!x)return null;if(!Yl(g.type,[Ni(wr),er,wr]))return d.error(`Expected first argument to be of type array or string, but found ${gn(g.type)} instead`);if(l.length===4){const E=d.parse(l[3],3,Mt);return E?new ol(g.type,g,x,E):null}return new ol(g.type,g,x)}evaluate(l){const d=this.input.evaluate(l),g=this.beginIndex.evaluate(l);let x;if(this.endIndex&&(x=this.endIndex.evaluate(l)),La(d,["string"]))return[...d].slice(g,x).join("");if(La(d,["array"]))return d.slice(g,x);throw new Mn(`Expected first argument to be of type array or string, but found ${gn(jn(d))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function ic(f,l){const d=f.length-1;let g,x,E=0,P=d,R=0;for(;E<=P;)if(R=Math.floor((E+P)/2),g=f[R],x=f[R+1],g<=l){if(R===d||l<x)return R;E=R+1}else{if(!(g>l))throw new Mn("Input is not a number.");P=R-1}return 0}class To{constructor(l,d,g){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(const[x,E]of g)this.labels.push(x),this.outputs.push(E)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");const g=d.parse(l[1],1,Mt);if(!g)return null;const x=[];let E=null;d.expectedType&&d.expectedType.kind!=="value"&&(E=d.expectedType);for(let P=1;P<l.length;P+=2){const R=P===1?-1/0:l[P],N=l[P+1],F=P,$=P+1;if(typeof R!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(x.length&&x[x.length-1][0]>=R)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const H=d.parse(N,$,E);if(!H)return null;E=E||H.type,x.push([R,H])}return new To(E,g,x)}evaluate(l){const d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);const x=this.input.evaluate(l);if(x<=d[0])return g[0].evaluate(l);const E=d.length;return x>=d[E-1]?g[E-1].evaluate(l):g[ic(d,x)].evaluate(l)}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function ju(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Uu,Kc,ca=function(){if(Kc)return Uu;function f(l,d,g,x){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(x-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=g,this.p2y=x}return Kc=1,Uu=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,d){if(d===void 0&&(d=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,x=0;x<8;x++){var E=this.sampleCurveX(g)-l;if(Math.abs(E)<d)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=E/P}var R=0,N=1;for(g=l,x=0;x<20&&(E=this.sampleCurveX(g),!(Math.abs(E-l)<d));x++)l>E?R=g:N=g,g=.5*(N-R)+R;return g},solve:function(l,d){return this.sampleCurveY(this.solveCurveX(l,d))}},Uu}(),nf=ju(ca);class ua{constructor(l,d,g,x,E){this.type=l,this.operator=d,this.interpolation=g,this.input=x,this.labels=[],this.outputs=[];for(const[P,R]of E)this.labels.push(P),this.outputs.push(R)}static interpolationFactor(l,d,g,x){let E=0;if(l.name==="exponential")E=Qc(d,l.base,g,x);else if(l.name==="linear")E=Qc(d,1,g,x);else if(l.name==="cubic-bezier"){const P=l.controlPoints;E=new nf(P[0],P[1],P[2],P[3]).solve(Qc(d,1,g,x))}return E}static parse(l,d){let[g,x,E,...P]=l;if(!Array.isArray(x)||x.length===0)return d.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){const F=x[1];if(typeof F!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:F}}else{if(x[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(x[0])}`,1,0);{const F=x.slice(1);if(F.length!==4||F.some($=>typeof $!="number"||$<0||$>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:F}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(E=d.parse(E,2,Mt),!E)return null;const R=[];let N=null;g==="interpolate-hcl"||g==="interpolate-lab"?N=mi:d.expectedType&&d.expectedType.kind!=="value"&&(N=d.expectedType);for(let F=0;F<P.length;F+=2){const $=P[F],H=P[F+1],Q=F+3,te=F+4;if(typeof $!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Q);if(R.length&&R[R.length-1][0]>=$)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Q);const ie=d.parse(H,te,N);if(!ie)return null;N=N||ie.type,R.push([$,ie])}return Ta(N,Mt)||Ta(N,ci)||Ta(N,mi)||Ta(N,Lu)||Ta(N,vo)||Ta(N,Ni(Mt))?new ua(N,g,x,E,R):d.error(`Type ${gn(N)} is not interpolatable.`)}evaluate(l){const d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);const x=this.input.evaluate(l);if(x<=d[0])return g[0].evaluate(l);const E=d.length;if(x>=d[E-1])return g[E-1].evaluate(l);const P=ic(d,x),R=ua.interpolationFactor(this.interpolation,x,d[P],d[P+1]),N=g[P].evaluate(l),F=g[P+1].evaluate(l);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Qs(N,F,R);case"color":return kr.interpolate(N,F,R);case"padding":return sa.interpolate(N,F,R);case"variableAnchorOffsetCollection":return Ii.interpolate(N,F,R);case"array":return Os(N,F,R);case"projectionDefinition":return gi.interpolate(N,F,R)}case"interpolate-hcl":return kr.interpolate(N,F,R,"hcl");case"interpolate-lab":return kr.interpolate(N,F,R,"lab")}}eachChild(l){l(this.input);for(const d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Qc(f,l,d,g){const x=g-d,E=f-d;return x===0?0:l===1?E/x:(Math.pow(l,E)-1)/(Math.pow(l,x)-1)}const _n={color:kr.interpolate,number:Qs,padding:sa.interpolate,variableAnchorOffsetCollection:Ii.interpolate,array:Os};class $u{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=null;const x=d.expectedType;x&&x.kind!=="value"&&(g=x);const E=[];for(const R of l.slice(1)){const N=d.parse(R,1+E.length,g,void 0,{typeAnnotation:"omit"});if(!N)return null;g=g||N.type,E.push(N)}if(!g)throw new Error("No output type");const P=x&&E.some(R=>Fu(x,R.type));return new $u(P?wr:g,E)}evaluate(l){let d,g=null,x=0;for(const E of this.args)if(x++,g=E.evaluate(l),g&&g instanceof Bi&&!g.available&&(d||(d=g.name),g=null,x===this.args.length&&(g=d)),g!==null)break;return g}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function af(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Ed(f,l,d,g){return g.compare(l,d)===0}function ac(f,l,d){const g=f!=="=="&&f!=="!=";return class qB{constructor(E,P,R){this.type=yr,this.lhs=E,this.rhs=P,this.collator=R,this.hasUntypedArgument=E.type.kind==="value"||P.type.kind==="value"}static parse(E,P){if(E.length!==3&&E.length!==4)return P.error("Expected two or three arguments.");const R=E[0];let N=P.parse(E[1],1,wr);if(!N)return null;if(!af(R,N.type))return P.concat(1).error(`"${R}" comparisons are not supported for type '${gn(N.type)}'.`);let F=P.parse(E[2],2,wr);if(!F)return null;if(!af(R,F.type))return P.concat(2).error(`"${R}" comparisons are not supported for type '${gn(F.type)}'.`);if(N.type.kind!==F.type.kind&&N.type.kind!=="value"&&F.type.kind!=="value")return P.error(`Cannot compare types '${gn(N.type)}' and '${gn(F.type)}'.`);g&&(N.type.kind==="value"&&F.type.kind!=="value"?N=new la(F.type,[N]):N.type.kind!=="value"&&F.type.kind==="value"&&(F=new la(N.type,[F])));let $=null;if(E.length===4){if(N.type.kind!=="string"&&F.type.kind!=="string"&&N.type.kind!=="value"&&F.type.kind!=="value")return P.error("Cannot use collator to compare non-string types.");if($=P.parse(E[3],3,ni),!$)return null}return new qB(N,F,$)}evaluate(E){const P=this.lhs.evaluate(E),R=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){const N=jn(P),F=jn(R);if(N.kind!==F.kind||N.kind!=="string"&&N.kind!=="number")throw new Mn(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${N.kind}, ${F.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const N=jn(P),F=jn(R);if(N.kind!=="string"||F.kind!=="string")return l(E,P,R)}return this.collator?d(E,P,R,this.collator.evaluate(E)):l(E,P,R)}eachChild(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)}outputDefined(){return!0}}}const sf=ac("==",function(f,l,d){return l===d},Ed),Md=ac("!=",function(f,l,d){return l!==d},function(f,l,d,g){return!Ed(0,l,d,g)}),w_=ac("<",function(f,l,d){return l<d},function(f,l,d,g){return g.compare(l,d)<0}),of=ac(">",function(f,l,d){return l>d},function(f,l,d,g){return g.compare(l,d)>0}),Jc=ac("<=",function(f,l,d){return l<=d},function(f,l,d,g){return g.compare(l,d)<=0}),ks=ac(">=",function(f,l,d){return l>=d},function(f,l,d,g){return g.compare(l,d)>=0});class Vu{constructor(l,d,g){this.type=ni,this.locale=g,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");const g=l[1];if(typeof g!="object"||Array.isArray(g))return d.error("Collator options argument must be an object.");const x=d.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,yr);if(!x)return null;const E=d.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,yr);if(!E)return null;let P=null;return g.locale&&(P=d.parse(g.locale,1,er),!P)?null:new Vu(x,E,P)}evaluate(l){return new Ur(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class eu{constructor(l,d,g,x,E){this.type=er,this.number=l,this.locale=d,this.currency=g,this.minFractionDigits=x,this.maxFractionDigits=E}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");const g=d.parse(l[1],1,Mt);if(!g)return null;const x=l[2];if(typeof x!="object"||Array.isArray(x))return d.error("NumberFormat options argument must be an object.");let E=null;if(x.locale&&(E=d.parse(x.locale,1,er),!E))return null;let P=null;if(x.currency&&(P=d.parse(x.currency,1,er),!P))return null;let R=null;if(x["min-fraction-digits"]&&(R=d.parse(x["min-fraction-digits"],1,Mt),!R))return null;let N=null;return x["max-fraction-digits"]&&(N=d.parse(x["max-fraction-digits"],1,Mt),!N)?null:new eu(g,E,P,R,N)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class qu{constructor(l){this.type=rl,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");const g=l[1];if(!Array.isArray(g)&&typeof g=="object")return d.error("First argument must be an image or text section.");const x=[];let E=!1;for(let P=1;P<=l.length-1;++P){const R=l[P];if(E&&typeof R=="object"&&!Array.isArray(R)){E=!1;let N=null;if(R["font-scale"]&&(N=d.parse(R["font-scale"],1,Mt),!N))return null;let F=null;if(R["text-font"]&&(F=d.parse(R["text-font"],1,Ni(er)),!F))return null;let $=null;if(R["text-color"]&&($=d.parse(R["text-color"],1,mi),!$))return null;let H=null;if(R["vertical-align"]){if(typeof R["vertical-align"]=="string"&&!ec.includes(R["vertical-align"]))return d.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${R["vertical-align"]}' instead.`);if(H=d.parse(R["vertical-align"],1,er),!H)return null}const Q=x[x.length-1];Q.scale=N,Q.font=F,Q.textColor=$,Q.verticalAlign=H}else{const N=d.parse(l[P],1,wr);if(!N)return null;const F=N.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");E=!0,x.push({content:N,scale:null,font:null,textColor:null,verticalAlign:null})}}return new qu(x)}evaluate(l){return new za(this.sections.map(d=>{const g=d.content.evaluate(l);return jn(g)===Ba?new _s("",g,null,null,null,d.verticalAlign?d.verticalAlign.evaluate(l):null):new _s(ja(g),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null,d.verticalAlign?d.verticalAlign.evaluate(l):null)}))}eachChild(l){for(const d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor),d.verticalAlign&&l(d.verticalAlign)}outputDefined(){return!1}}class Hu{constructor(l){this.type=Ba,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");const g=d.parse(l[1],1,er);return g?new Hu(g):d.error("No image name provided.")}evaluate(l){const d=this.input.evaluate(l),g=Bi.fromString(d);return g&&l.availableImages&&(g.available=l.availableImages.indexOf(d)>-1),g}eachChild(l){l(this.input)}outputDefined(){return!1}}class Pd{constructor(l){this.type=Mt,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);const g=d.parse(l[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${gn(g.type)} instead.`):new Pd(g):null}evaluate(l){const d=this.input.evaluate(l);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new Mn(`Expected value to be of type string or array, but found ${gn(jn(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Js=8192;function T_(f,l){const d=(180+f[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,x=Math.pow(2,l.z);return[Math.round(d*x*Js),Math.round(g*x*Js)]}function Cd(f,l){const d=Math.pow(2,l.z);return[(x=(f[0]/Js+l.x)/d,360*x-180),(g=(f[1]/Js+l.y)/d,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,x}function ll(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function Wu(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function hm(f,l,d){const g=f[0]-l[0],x=f[1]-l[1],E=f[0]-d[0],P=f[1]-d[1];return g*P-E*x==0&&g*E<=0&&x*P<=0}function Zu(f,l,d,g){return(x=[g[0]-d[0],g[1]-d[1]])[0]*(E=[l[0]-f[0],l[1]-f[1]])[1]-x[1]*E[0]!=0&&!(!Od(f,l,d,g)||!Od(d,g,f,l));var x,E}function Rd(f,l,d){for(const g of d)for(let x=0;x<g.length-1;++x)if(Zu(f,l,g[x],g[x+1]))return!0;return!1}function Ds(f,l,d=!1){let g=!1;for(const R of l)for(let N=0;N<R.length-1;N++){if(hm(f,R[N],R[N+1]))return d;(E=R[N])[1]>(x=f)[1]!=(P=R[N+1])[1]>x[1]&&x[0]<(P[0]-E[0])*(x[1]-E[1])/(P[1]-E[1])+E[0]&&(g=!g)}var x,E,P;return g}function S_(f,l){for(const d of l)if(Ds(f,d))return!0;return!1}function Id(f,l){for(const d of f)if(!Ds(d,l))return!1;for(let d=0;d<f.length-1;++d)if(Rd(f[d],f[d+1],l))return!1;return!0}function fm(f,l){for(const d of l)if(Id(f,d))return!0;return!1}function Od(f,l,d,g){const x=g[0]-d[0],E=g[1]-d[1],P=(f[0]-d[0])*E-x*(f[1]-d[1]),R=(l[0]-d[0])*E-x*(l[1]-d[1]);return P>0&&R<0||P<0&&R>0}function lf(f,l,d){const g=[];for(let x=0;x<f.length;x++){const E=[];for(let P=0;P<f[x].length;P++){const R=T_(f[x][P],d);ll(l,R),E.push(R)}g.push(E)}return g}function cf(f,l,d){const g=[];for(let x=0;x<f.length;x++){const E=lf(f[x],l,d);g.push(E)}return g}function cl(f,l,d,g){if(f[0]<d[0]||f[0]>d[2]){const x=.5*g;let E=f[0]-d[0]>x?-g:d[0]-f[0]>x?g:0;E===0&&(E=f[0]-d[2]>x?-g:d[2]-f[0]>x?g:0),f[0]+=E}ll(l,f)}function kd(f,l,d,g){const x=Math.pow(2,g.z)*Js,E=[g.x*Js,g.y*Js],P=[];for(const R of f)for(const N of R){const F=[N.x+E[0],N.y+E[1]];cl(F,l,d,x),P.push(F)}return P}function dm(f,l,d,g){const x=Math.pow(2,g.z)*Js,E=[g.x*Js,g.y*Js],P=[];for(const N of f){const F=[];for(const $ of N){const H=[$.x+E[0],$.y+E[1]];ll(l,H),F.push(H)}P.push(F)}if(l[2]-l[0]<=x/2){(R=l)[0]=R[1]=1/0,R[2]=R[3]=-1/0;for(const N of P)for(const F of N)cl(F,l,d,x)}var R;return P}class sc{constructor(l,d){this.type=yr,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(rc(l[1])){const g=l[1];if(g.type==="FeatureCollection"){const x=[];for(const E of g.features){const{type:P,coordinates:R}=E.geometry;P==="Polygon"&&x.push(R),P==="MultiPolygon"&&x.push(...R)}if(x.length)return new sc(g,{type:"MultiPolygon",coordinates:x})}else if(g.type==="Feature"){const x=g.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new sc(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new sc(g,g)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){const x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],P=d.canonicalID();if(g.type==="Polygon"){const R=lf(g.coordinates,E,P),N=kd(d.geometry(),x,E,P);if(!Wu(x,E))return!1;for(const F of N)if(!Ds(F,R))return!1}if(g.type==="MultiPolygon"){const R=cf(g.coordinates,E,P),N=kd(d.geometry(),x,E,P);if(!Wu(x,E))return!1;for(const F of N)if(!S_(F,R))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){const x=[1/0,1/0,-1/0,-1/0],E=[1/0,1/0,-1/0,-1/0],P=d.canonicalID();if(g.type==="Polygon"){const R=lf(g.coordinates,E,P),N=dm(d.geometry(),x,E,P);if(!Wu(x,E))return!1;for(const F of N)if(!Id(F,R))return!1}if(g.type==="MultiPolygon"){const R=cf(g.coordinates,E,P),N=dm(d.geometry(),x,E,P);if(!Wu(x,E))return!1;for(const F of N)if(!fm(F,R))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dd=class{constructor(f=[],l=(d,g)=>d<g?-1:d>g?1:0){if(this.data=f,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;const f=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:l,compare:d}=this,g=l[f];for(;f>0;){const x=f-1>>1,E=l[x];if(d(g,E)>=0)break;l[f]=E,f=x}l[f]=g}_down(f){const{data:l,compare:d}=this,g=this.length>>1,x=l[f];for(;f<g;){let E=1+(f<<1);const P=E+1;if(P<this.length&&d(l[P],l[E])<0&&(E=P),d(l[E],x)>=0)break;l[f]=l[E],f=E}l[f]=x}};function Xu(f,l,d=0,g=f.length-1,x=Gu){for(;g>d;){if(g-d>600){const N=g-d+1,F=l-d+1,$=Math.log(N),H=.5*Math.exp(2*$/3),Q=.5*Math.sqrt($*H*(N-H)/N)*(F-N/2<0?-1:1);Xu(f,l,Math.max(d,Math.floor(l-F*H/N+Q)),Math.min(g,Math.floor(l+(N-F)*H/N+Q)),x)}const E=f[l];let P=d,R=g;for(So(f,d,l),x(f[g],E)>0&&So(f,d,g);P<R;){for(So(f,P,R),P++,R--;x(f[P],E)<0;)P++;for(;x(f[R],E)>0;)R--}x(f[d],E)===0?So(f,d,R):(R++,So(f,R,g)),R<=l&&(d=R+1),l<=R&&(g=R-1)}}function So(f,l,d){const g=f[l];f[l]=f[d],f[d]=g}function Gu(f,l){return f<l?-1:f>l?1:0}function uf(f,l){if(f.length<=1)return[f];const d=[];let g,x;for(const E of f){const P=Nd(E);P!==0&&(E.area=Math.abs(P),x===void 0&&(x=P<0),x===P<0?(g&&d.push(g),g=[E]):g.push(E))}if(g&&d.push(g),l>1)for(let E=0;E<d.length;E++)d[E].length<=l||(Xu(d[E],l,1,d[E].length-1,Yu),d[E]=d[E].slice(0,l));return d}function Yu(f,l){return l.area-f.area}function Nd(f){let l=0;for(let d,g,x=0,E=f.length,P=E-1;x<E;P=x++)d=f[x],g=f[P],l+=(g.x-d.x)*(d.y+g.y);return l}const Bd=1/298.257223563,hf=Bd*(2-Bd),Ku=Math.PI/180;class Qu{constructor(l){const d=6378.137*Ku*1e3,g=Math.cos(l*Ku),x=1/(1-hf*(1-g*g)),E=Math.sqrt(x);this.kx=d*E*g,this.ky=d*E*x*(1-hf)}distance(l,d){const g=this.wrap(l[0]-d[0])*this.kx,x=(l[1]-d[1])*this.ky;return Math.sqrt(g*g+x*x)}pointOnLine(l,d){let g,x,E,P,R=1/0;for(let N=0;N<l.length-1;N++){let F=l[N][0],$=l[N][1],H=this.wrap(l[N+1][0]-F)*this.kx,Q=(l[N+1][1]-$)*this.ky,te=0;H===0&&Q===0||(te=(this.wrap(d[0]-F)*this.kx*H+(d[1]-$)*this.ky*Q)/(H*H+Q*Q),te>1?(F=l[N+1][0],$=l[N+1][1]):te>0&&(F+=H/this.kx*te,$+=Q/this.ky*te)),H=this.wrap(d[0]-F)*this.kx,Q=(d[1]-$)*this.ky;const ie=H*H+Q*Q;ie<R&&(R=ie,g=F,x=$,E=N,P=te)}return{point:[g,x],index:E,t:Math.max(0,Math.min(1,P))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function Ld(f,l){return l[0]-f[0]}function Ju(f){return f[1]-f[0]+1}function Ao(f,l){return f[1]>=f[0]&&f[1]<l}function ff(f,l){if(f[0]>f[1])return[null,null];const d=Ju(f);if(l){if(d===2)return[f,null];const x=Math.floor(d/2);return[[f[0],f[0]+x],[f[0]+x,f[1]]]}if(d===1)return[f,null];const g=Math.floor(d/2)-1;return[[f[0],f[0]+g],[f[0]+g+1,f[1]]]}function Fd(f,l){if(!Ao(l,f.length))return[1/0,1/0,-1/0,-1/0];const d=[1/0,1/0,-1/0,-1/0];for(let g=l[0];g<=l[1];++g)ll(d,f[g]);return d}function zd(f){const l=[1/0,1/0,-1/0,-1/0];for(const d of f)for(const g of d)ll(l,g);return l}function pm(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function Sa(f,l,d){if(!pm(f)||!pm(l))return NaN;let g=0,x=0;return f[2]<l[0]&&(g=l[0]-f[2]),f[0]>l[2]&&(g=f[0]-l[2]),f[1]>l[3]&&(x=f[1]-l[3]),f[3]<l[1]&&(x=l[1]-f[3]),d.distance([0,0],[g,x])}function Dr(f,l,d){const g=d.pointOnLine(l,f);return d.distance(f,g.point)}function df(f,l,d,g,x){const E=Math.min(Dr(f,[d,g],x),Dr(l,[d,g],x)),P=Math.min(Dr(d,[f,l],x),Dr(g,[f,l],x));return Math.min(E,P)}function mm(f,l,d,g,x){if(!Ao(l,f.length)||!Ao(g,d.length))return 1/0;let E=1/0;for(let P=l[0];P<l[1];++P){const R=f[P],N=f[P+1];for(let F=g[0];F<g[1];++F){const $=d[F],H=d[F+1];if(Zu(R,N,$,H))return 0;E=Math.min(E,df(R,N,$,H,x))}}return E}function gm(f,l,d,g,x){if(!Ao(l,f.length)||!Ao(g,d.length))return NaN;let E=1/0;for(let P=l[0];P<=l[1];++P)for(let R=g[0];R<=g[1];++R)if(E=Math.min(E,x.distance(f[P],d[R])),E===0)return E;return E}function _m(f,l,d){if(Ds(f,l,!0))return 0;let g=1/0;for(const x of l){const E=x[0],P=x[x.length-1];if(E!==P&&(g=Math.min(g,Dr(f,[P,E],d)),g===0))return g;const R=d.pointOnLine(x,f);if(g=Math.min(g,d.distance(f,R.point)),g===0)return g}return g}function jd(f,l,d,g){if(!Ao(l,f.length))return NaN;for(let E=l[0];E<=l[1];++E)if(Ds(f[E],d,!0))return 0;let x=1/0;for(let E=l[0];E<l[1];++E){const P=f[E],R=f[E+1];for(const N of d)for(let F=0,$=N.length,H=$-1;F<$;H=F++){const Q=N[H],te=N[F];if(Zu(P,R,Q,te))return 0;x=Math.min(x,df(P,R,Q,te,g))}}return x}function ym(f,l){for(const d of f)for(const g of d)if(Ds(g,l,!0))return!0;return!1}function tu(f,l,d,g=1/0){const x=zd(f),E=zd(l);if(g!==1/0&&Sa(x,E,d)>=g)return g;if(Wu(x,E)){if(ym(f,l))return 0}else if(ym(l,f))return 0;let P=1/0;for(const R of f)for(let N=0,F=R.length,$=F-1;N<F;$=N++){const H=R[$],Q=R[N];for(const te of l)for(let ie=0,oe=te.length,me=oe-1;ie<oe;me=ie++){const we=te[me],Fe=te[ie];if(Zu(H,Q,we,Fe))return 0;P=Math.min(P,df(H,Q,we,Fe,d))}}return P}function pf(f,l,d,g,x,E){if(!E)return;const P=Sa(Fd(g,E),x,d);P<l&&f.push([P,E,[0,0]])}function ul(f,l,d,g,x,E,P){if(!E||!P)return;const R=Sa(Fd(g,E),Fd(x,P),d);R<l&&f.push([R,E,P])}function ru(f,l,d,g,x=1/0){let E=Math.min(g.distance(f[0],d[0][0]),x);if(E===0)return E;const P=new Dd([[0,[0,f.length-1],[0,0]]],Ld),R=zd(d);for(;P.length>0;){const N=P.pop();if(N[0]>=E)continue;const F=N[1],$=l?50:100;if(Ju(F)<=$){if(!Ao(F,f.length))return NaN;if(l){const H=jd(f,F,d,g);if(isNaN(H)||H===0)return H;E=Math.min(E,H)}else for(let H=F[0];H<=F[1];++H){const Q=_m(f[H],d,g);if(E=Math.min(E,Q),E===0)return 0}}else{const H=ff(F,l);pf(P,E,g,f,R,H[0]),pf(P,E,g,f,R,H[1])}}return E}function eh(f,l,d,g,x,E=1/0){let P=Math.min(E,x.distance(f[0],d[0]));if(P===0)return P;const R=new Dd([[0,[0,f.length-1],[0,d.length-1]]],Ld);for(;R.length>0;){const N=R.pop();if(N[0]>=P)continue;const F=N[1],$=N[2],H=l?50:100,Q=g?50:100;if(Ju(F)<=H&&Ju($)<=Q){if(!Ao(F,f.length)&&Ao($,d.length))return NaN;let te;if(l&&g)te=mm(f,F,d,$,x),P=Math.min(P,te);else if(l&&!g){const ie=f.slice(F[0],F[1]+1);for(let oe=$[0];oe<=$[1];++oe)if(te=Dr(d[oe],ie,x),P=Math.min(P,te),P===0)return P}else if(!l&&g){const ie=d.slice($[0],$[1]+1);for(let oe=F[0];oe<=F[1];++oe)if(te=Dr(f[oe],ie,x),P=Math.min(P,te),P===0)return P}else te=gm(f,F,d,$,x),P=Math.min(P,te)}else{const te=ff(F,l),ie=ff($,g);ul(R,P,x,f,d,te[0],ie[0]),ul(R,P,x,f,d,te[0],ie[1]),ul(R,P,x,f,d,te[1],ie[0]),ul(R,P,x,f,d,te[1],ie[1])}}return P}function Eo(f){return f.type==="MultiPolygon"?f.coordinates.map(l=>({type:"Polygon",coordinates:l})):f.type==="MultiLineString"?f.coordinates.map(l=>({type:"LineString",coordinates:l})):f.type==="MultiPoint"?f.coordinates.map(l=>({type:"Point",coordinates:l})):[f]}class vs{constructor(l,d){this.type=Mt,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(rc(l[1])){const g=l[1];if(g.type==="FeatureCollection")return new vs(g,g.features.map(x=>Eo(x.geometry)).flat());if(g.type==="Feature")return new vs(g,Eo(g.geometry));if("type"in g&&"coordinates"in g)return new vs(g,Eo(g))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){const x=d.geometry(),E=x.flat().map(N=>Cd([N.x,N.y],d.canonical));if(x.length===0)return NaN;const P=new Qu(E[0][1]);let R=1/0;for(const N of g){switch(N.type){case"Point":R=Math.min(R,eh(E,!1,[N.coordinates],!1,P,R));break;case"LineString":R=Math.min(R,eh(E,!1,N.coordinates,!0,P,R));break;case"Polygon":R=Math.min(R,ru(E,!1,N.coordinates,P,R))}if(R===0)return R}return R}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){const x=d.geometry(),E=x.flat().map(N=>Cd([N.x,N.y],d.canonical));if(x.length===0)return NaN;const P=new Qu(E[0][1]);let R=1/0;for(const N of g){switch(N.type){case"Point":R=Math.min(R,eh(E,!0,[N.coordinates],!1,P,R));break;case"LineString":R=Math.min(R,eh(E,!0,N.coordinates,!0,P,R));break;case"Polygon":R=Math.min(R,ru(E,!0,N.coordinates,P,R))}if(R===0)return R}return R}(l,this.geometries);if(l.geometryType()==="Polygon")return function(d,g){const x=d.geometry();if(x.length===0||x[0].length===0)return NaN;const E=uf(x,0).map(N=>N.map(F=>F.map($=>Cd([$.x,$.y],d.canonical)))),P=new Qu(E[0][0][0][1]);let R=1/0;for(const N of g)for(const F of E){switch(N.type){case"Point":R=Math.min(R,ru([N.coordinates],!1,F,P,R));break;case"LineString":R=Math.min(R,ru(N.coordinates,!0,F,P,R));break;case"Polygon":R=Math.min(R,tu(F,N.coordinates,P,R))}if(R===0)return R}return R}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const hl={"==":sf,"!=":Md,">":of,"<":w_,">=":ks,"<=":Jc,array:la,at:Li,boolean:la,case:rf,coalesce:$u,collator:Vu,format:qu,image:Hu,in:Yi,"index-of":wo,interpolate:ua,"interpolate-hcl":ua,"interpolate-lab":ua,length:Pd,let:xo,literal:oa,match:sl,number:la,"number-format":eu,object:la,slice:ol,step:To,string:la,"to-boolean":Gr,"to-color":Gr,"to-number":Gr,"to-string":Gr,var:$r,within:sc,distance:vs};class ts{constructor(l,d,g,x){this.name=l,this.type=d,this._evaluate=g,this.args=x}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,d){const g=l[0],x=ts.definitions[g];if(!x)return d.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const E=Array.isArray(x)?x[0]:x.type,P=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,R=P.filter(([F])=>!Array.isArray(F)||F.length===l.length-1);let N=null;for(const[F,$]of R){N=new Ar(d.registry,gf,d.path,null,d.scope);const H=[];let Q=!1;for(let te=1;te<l.length;te++){const ie=l[te],oe=Array.isArray(F)?F[te-1]:F.type,me=N.parse(ie,1+H.length,oe);if(!me){Q=!0;break}H.push(me)}if(!Q)if(Array.isArray(F)&&F.length!==H.length)N.error(`Expected ${F.length} arguments, but found ${H.length} instead.`);else{for(let te=0;te<H.length;te++){const ie=Array.isArray(F)?F[te]:F.type,oe=H[te];N.concat(te+1).checkSubtype(ie,oe.type)}if(N.errors.length===0)return new ts(g,E,$,H)}}if(R.length===1)d.errors.push(...N.errors);else{const F=(R.length?R:P).map(([H])=>{return Q=H,Array.isArray(Q)?`(${Q.map(gn).join(", ")})`:`(${gn(Q.type)}...)`;var Q}).join(" | "),$=[];for(let H=1;H<l.length;H++){const Q=d.parse(l[H],1+$.length);if(!Q)return null;$.push(gn(Q.type))}d.error(`Expected arguments of type ${F}, but found (${$.join(", ")}) instead.`)}return null}static register(l,d){ts.definitions=d;for(const g in d)l[g]=ts}}function fl(f,[l,d,g,x]){l=l.evaluate(f),d=d.evaluate(f),g=g.evaluate(f);const E=x?x.evaluate(f):1,P=bo(l,d,g,E);if(P)throw new Mn(P);return new kr(l/255,d/255,g/255,E,!1)}function Ud(f,l){return f in l}function mf(f,l){const d=l[f];return d===void 0?null:d}function dl(f){return{type:f}}function gf(f){if(f instanceof $r)return gf(f.boundExpression);if(f instanceof ts&&f.name==="error"||f instanceof Vu||f instanceof sc||f instanceof vs)return!1;const l=f instanceof Gr||f instanceof la;let d=!0;return f.eachChild(g=>{d=l?d&&gf(g):d&&g instanceof oa}),!!d&&_f(f)&&rh(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _f(f){if(f instanceof ts&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof sc||f instanceof vs)return!1;let l=!0;return f.eachChild(d=>{l&&!_f(d)&&(l=!1)}),l}function th(f){if(f instanceof ts&&f.name==="feature-state")return!1;let l=!0;return f.eachChild(d=>{l&&!th(d)&&(l=!1)}),l}function rh(f,l){if(f instanceof ts&&l.indexOf(f.name)>=0)return!1;let d=!0;return f.eachChild(g=>{d&&!rh(g,l)&&(d=!1)}),d}function $d(f){return{result:"success",value:f}}function pl(f){return{result:"error",value:f}}function ha(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function Vd(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function Ua(f){return!!f.expression&&f.expression.interpolated}function Mr(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function Mo(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function qd(f){return f}function oc(f,l){const d=l.type==="color",g=f.stops&&typeof f.stops[0][0]=="object",x=g||!(g||f.property!==void 0),E=f.type||(Ua(l)?"exponential":"interval");if(d||l.type==="padding"){const $=d?kr.parse:sa.parse;(f=vr({},f)).stops&&(f.stops=f.stops.map(H=>[H[0],$(H[1])])),f.default=$(f.default?f.default:l.default)}if(f.colorSpace&&(P=f.colorSpace)!=="rgb"&&P!=="hcl"&&P!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var P;let R,N,F;if(E==="exponential")R=yf;else if(E==="interval")R=nu;else if(E==="categorical"){R=Hd,N=Object.create(null);for(const $ of f.stops)N[$[0]]=$[1];F=typeof f.stops[0][0]}else{if(E!=="identity")throw new Error(`Unknown function type "${E}"`);R=vf}if(g){const $={},H=[];for(let ie=0;ie<f.stops.length;ie++){const oe=f.stops[ie],me=oe[0].zoom;$[me]===void 0&&($[me]={zoom:me,type:f.type,property:f.property,default:f.default,stops:[]},H.push(me)),$[me].stops.push([oe[0].value,oe[1]])}const Q=[];for(const ie of H)Q.push([$[ie].zoom,oc($[ie],l)]);const te={name:"linear"};return{kind:"composite",interpolationType:te,interpolationFactor:ua.interpolationFactor.bind(void 0,te),zoomStops:Q.map(ie=>ie[0]),evaluate:({zoom:ie},oe)=>yf({stops:Q,base:f.base},l,ie).evaluate(ie,oe)}}if(x){const $=E==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:ua.interpolationFactor.bind(void 0,$),zoomStops:f.stops.map(H=>H[0]),evaluate:({zoom:H})=>R(f,l,H,N,F)}}return{kind:"source",evaluate($,H){const Q=H&&H.properties?H.properties[f.property]:void 0;return Q===void 0?ml(f.default,l.default):R(f,l,Q,N,F)}}}function ml(f,l,d){return f!==void 0?f:l!==void 0?l:d!==void 0?d:void 0}function Hd(f,l,d,g,x){return ml(typeof d===x?g[d]:void 0,f.default,l.default)}function nu(f,l,d){if(Mr(d)!=="number")return ml(f.default,l.default);const g=f.stops.length;if(g===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[g-1][0])return f.stops[g-1][1];const x=ic(f.stops.map(E=>E[0]),d);return f.stops[x][1]}function yf(f,l,d){const g=f.base!==void 0?f.base:1;if(Mr(d)!=="number")return ml(f.default,l.default);const x=f.stops.length;if(x===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[x-1][0])return f.stops[x-1][1];const E=ic(f.stops.map($=>$[0]),d),P=function($,H,Q,te){const ie=te-Q,oe=$-Q;return ie===0?0:H===1?oe/ie:(Math.pow(H,oe)-1)/(Math.pow(H,ie)-1)}(d,g,f.stops[E][0],f.stops[E+1][0]),R=f.stops[E][1],N=f.stops[E+1][1],F=_n[l.type]||qd;return typeof R.evaluate=="function"?{evaluate(...$){const H=R.evaluate.apply(void 0,$),Q=N.evaluate.apply(void 0,$);if(H!==void 0&&Q!==void 0)return F(H,Q,P,f.colorSpace)}}:F(R,N,P,f.colorSpace)}function vf(f,l,d){switch(l.type){case"color":d=kr.parse(d);break;case"formatted":d=za.fromString(d.toString());break;case"resolvedImage":d=Bi.fromString(d.toString());break;case"padding":d=sa.parse(d);break;default:Mr(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0)}return ml(d,f.default,l.default)}ts.register(hl,{error:[{kind:"error"},[er],(f,[l])=>{throw new Mn(l.evaluate(f))}],typeof:[er,[wr],(f,[l])=>gn(jn(l.evaluate(f)))],"to-rgba":[Ni(Mt,4),[mi],(f,[l])=>{const[d,g,x,E]=l.evaluate(f).rgb;return[255*d,255*g,255*x,E]}],rgb:[mi,[Mt,Mt,Mt],fl],rgba:[mi,[Mt,Mt,Mt,Mt],fl],has:{type:yr,overloads:[[[er],(f,[l])=>Ud(l.evaluate(f),f.properties())],[[er,on],(f,[l,d])=>Ud(l.evaluate(f),d.evaluate(f))]]},get:{type:wr,overloads:[[[er],(f,[l])=>mf(l.evaluate(f),f.properties())],[[er,on],(f,[l,d])=>mf(l.evaluate(f),d.evaluate(f))]]},"feature-state":[wr,[er],(f,[l])=>mf(l.evaluate(f),f.featureState||{})],properties:[on,[],f=>f.properties()],"geometry-type":[er,[],f=>f.geometryType()],id:[wr,[],f=>f.id()],zoom:[Mt,[],f=>f.globals.zoom],"heatmap-density":[Mt,[],f=>f.globals.heatmapDensity||0],"line-progress":[Mt,[],f=>f.globals.lineProgress||0],accumulated:[wr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Mt,dl(Mt),(f,l)=>{let d=0;for(const g of l)d+=g.evaluate(f);return d}],"*":[Mt,dl(Mt),(f,l)=>{let d=1;for(const g of l)d*=g.evaluate(f);return d}],"-":{type:Mt,overloads:[[[Mt,Mt],(f,[l,d])=>l.evaluate(f)-d.evaluate(f)],[[Mt],(f,[l])=>-l.evaluate(f)]]},"/":[Mt,[Mt,Mt],(f,[l,d])=>l.evaluate(f)/d.evaluate(f)],"%":[Mt,[Mt,Mt],(f,[l,d])=>l.evaluate(f)%d.evaluate(f)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(f,[l,d])=>Math.pow(l.evaluate(f),d.evaluate(f))],sqrt:[Mt,[Mt],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[Mt,[Mt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[Mt,[Mt],(f,[l])=>Math.log(l.evaluate(f))],log2:[Mt,[Mt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[Mt,[Mt],(f,[l])=>Math.sin(l.evaluate(f))],cos:[Mt,[Mt],(f,[l])=>Math.cos(l.evaluate(f))],tan:[Mt,[Mt],(f,[l])=>Math.tan(l.evaluate(f))],asin:[Mt,[Mt],(f,[l])=>Math.asin(l.evaluate(f))],acos:[Mt,[Mt],(f,[l])=>Math.acos(l.evaluate(f))],atan:[Mt,[Mt],(f,[l])=>Math.atan(l.evaluate(f))],min:[Mt,dl(Mt),(f,l)=>Math.min(...l.map(d=>d.evaluate(f)))],max:[Mt,dl(Mt),(f,l)=>Math.max(...l.map(d=>d.evaluate(f)))],abs:[Mt,[Mt],(f,[l])=>Math.abs(l.evaluate(f))],round:[Mt,[Mt],(f,[l])=>{const d=l.evaluate(f);return d<0?-Math.round(-d):Math.round(d)}],floor:[Mt,[Mt],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[Mt,[Mt],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[yr,[er,wr],(f,[l,d])=>f.properties()[l.value]===d.value],"filter-id-==":[yr,[wr],(f,[l])=>f.id()===l.value],"filter-type-==":[yr,[er],(f,[l])=>f.geometryType()===l.value],"filter-<":[yr,[er,wr],(f,[l,d])=>{const g=f.properties()[l.value],x=d.value;return typeof g==typeof x&&g<x}],"filter-id-<":[yr,[wr],(f,[l])=>{const d=f.id(),g=l.value;return typeof d==typeof g&&d<g}],"filter->":[yr,[er,wr],(f,[l,d])=>{const g=f.properties()[l.value],x=d.value;return typeof g==typeof x&&g>x}],"filter-id->":[yr,[wr],(f,[l])=>{const d=f.id(),g=l.value;return typeof d==typeof g&&d>g}],"filter-<=":[yr,[er,wr],(f,[l,d])=>{const g=f.properties()[l.value],x=d.value;return typeof g==typeof x&&g<=x}],"filter-id-<=":[yr,[wr],(f,[l])=>{const d=f.id(),g=l.value;return typeof d==typeof g&&d<=g}],"filter->=":[yr,[er,wr],(f,[l,d])=>{const g=f.properties()[l.value],x=d.value;return typeof g==typeof x&&g>=x}],"filter-id->=":[yr,[wr],(f,[l])=>{const d=f.id(),g=l.value;return typeof d==typeof g&&d>=g}],"filter-has":[yr,[wr],(f,[l])=>l.value in f.properties()],"filter-has-id":[yr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[yr,[Ni(er)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[yr,[Ni(wr)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[yr,[er,Ni(wr)],(f,[l,d])=>d.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[yr,[er,Ni(wr)],(f,[l,d])=>function(g,x,E,P){for(;E<=P;){const R=E+P>>1;if(x[R]===g)return!0;x[R]>g?P=R-1:E=R+1}return!1}(f.properties()[l.value],d.value,0,d.value.length-1)],all:{type:yr,overloads:[[[yr,yr],(f,[l,d])=>l.evaluate(f)&&d.evaluate(f)],[dl(yr),(f,l)=>{for(const d of l)if(!d.evaluate(f))return!1;return!0}]]},any:{type:yr,overloads:[[[yr,yr],(f,[l,d])=>l.evaluate(f)||d.evaluate(f)],[dl(yr),(f,l)=>{for(const d of l)if(d.evaluate(f))return!0;return!1}]]},"!":[yr,[yr],(f,[l])=>!l.evaluate(f)],"is-supported-script":[yr,[er],(f,[l])=>{const d=f.globals&&f.globals.isSupportedScript;return!d||d(l.evaluate(f))}],upcase:[er,[er],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[er,[er],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[er,dl(wr),(f,l)=>l.map(d=>ja(d.evaluate(f))).join("")],"resolved-locale":[er,[ni],(f,[l])=>l.evaluate(f).resolvedLocale()]});class gl{constructor(l,d){var g;this.expression=l,this._warningHistory={},this._evaluator=new Hr,this._defaultValue=d?(g=d).type==="color"&&Mo(g.default)?new kr(0,0,0,0):g.type==="color"?kr.parse(g.default)||null:g.type==="padding"?sa.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Ii.parse(g.default)||null:g.type==="projectionDefinition"?gi.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,g,x,E,P){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=g,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=P,this.expression.evaluate(this._evaluator)}evaluate(l,d,g,x,E,P){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=g||null,this._evaluator.canonical=x,this._evaluator.availableImages=E||null,this._evaluator.formattedSection=P||null;try{const R=this.expression.evaluate(this._evaluator);if(R==null||typeof R=="number"&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Mn(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function lc(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in hl}function Ki(f,l){const d=new Ar(hl,gf,[],l?function(x){const E={color:mi,string:er,number:Mt,enum:er,boolean:yr,formatted:rl,padding:Lu,projectionDefinition:ci,resolvedImage:Ba,variableAnchorOffsetCollection:vo};return x.type==="array"?Ni(E[x.value]||wr,x.length):E[x.type]}(l):void 0),g=d.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?$d(new gl(g,l)):pl(d.errors)}class nh{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!th(d.expression)}evaluateWithoutErrorHandling(l,d,g,x,E,P){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,x,E,P)}evaluate(l,d,g,x,E,P){return this._styleExpression.evaluate(l,d,g,x,E,P)}}class Ns{constructor(l,d,g,x){this.kind=l,this.zoomStops=g,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!th(d.expression),this.interpolationType=x}evaluateWithoutErrorHandling(l,d,g,x,E,P){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,x,E,P)}evaluate(l,d,g,x,E,P){return this._styleExpression.evaluate(l,d,g,x,E,P)}interpolationFactor(l,d,g){return this.interpolationType?ua.interpolationFactor(this.interpolationType,l,d,g):0}}function Wd(f,l){const d=Ki(f,l);if(d.result==="error")return d;const g=d.value.expression,x=_f(g);if(!x&&!ha(l))return pl([new jr("","data expressions not supported")]);const E=rh(g,["zoom"]);if(!E&&!Vd(l))return pl([new jr("","zoom expressions not supported")]);const P=eo(g);return P||E?P instanceof jr?pl([P]):P instanceof ua&&!Ua(l)?pl([new jr("",'"interpolate" expressions cannot be used with this property')]):$d(P?new Ns(x?"camera":"composite",d.value,P.labels,P instanceof ua?P.interpolation:void 0):new nh(x?"constant":"source",d.value)):pl([new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class cc{constructor(l,d){this._parameters=l,this._specification=d,vr(this,oc(this._parameters,this._specification))}static deserialize(l){return new cc(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function eo(f){let l=null;if(f instanceof xo)l=eo(f.result);else if(f instanceof $u){for(const d of f.args)if(l=eo(d),l)break}else(f instanceof To||f instanceof ua)&&f.input instanceof ts&&f.input.name==="zoom"&&(l=f);return l instanceof jr||f.eachChild(d=>{const g=eo(d);g instanceof jr?l=g:!l&&g?l=new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&g&&l!==g&&(l=new jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function iu(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const l of f.slice(1))if(!iu(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const bf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _l(f){if(f==null)return{filter:()=>!0,needGeometry:!1};iu(f)||(f=yl(f));const l=Ki(f,bf);if(l.result==="error")throw new Error(l.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,g,x)=>l.value.evaluate(d,g,{},x),needGeometry:su(f)}}function au(f,l){return f<l?-1:f>l?1:0}function su(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let l=1;l<f.length;l++)if(su(f[l]))return!0;return!1}function yl(f){if(!f)return!0;const l=f[0];return f.length<=1?l!=="any":l==="=="?Aa(f[1],f[2],"=="):l==="!="?Va(Aa(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Aa(f[1],f[2],l):l==="any"?(d=f.slice(1),["any"].concat(d.map(yl))):l==="all"?["all"].concat(f.slice(1).map(yl)):l==="none"?["all"].concat(f.slice(1).map(yl).map(Va)):l==="in"?$a(f[1],f.slice(2)):l==="!in"?Va($a(f[1],f.slice(2))):l==="has"?to(f[1]):l!=="!has"||Va(to(f[1]));var d}function Aa(f,l,d){switch(f){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,f,l]}}function $a(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",f,["literal",l.sort(au)]]:["filter-in-small",f,["literal",l]]}}function to(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function Va(f){return["!",f]}function rs(f){const l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let x="[";for(const E of f)x+=`${rs(E)},`;return`${x}]`}const d=Object.keys(f).sort();let g="{";for(let x=0;x<d.length;x++)g+=`${JSON.stringify(d[x])}:${rs(f[d[x]])},`;return`${g}}`}function ro(f){let l="";for(const d of $e)l+=`/${rs(f[d])}`;return l}function Zd(f){const l=f.value;return l?[new _t(f.key,l,"constants have been deprecated as of v8")]:[]}function Un(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function Po(f){if(Array.isArray(f))return f.map(Po);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const l={};for(const d in f)l[d]=Po(f[d]);return l}return Un(f)}function Pn(f){const l=f.key,d=f.value,g=f.valueSpec||{},x=f.objectElementValidators||{},E=f.style,P=f.styleSpec,R=f.validateSpec;let N=[];const F=Mr(d);if(F!=="object")return[new _t(l,d,`object expected, ${F} found`)];for(const $ in d){const H=$.split(".")[0],Q=g[H]||g["*"];let te;if(x[H])te=x[H];else if(g[H])te=R;else if(x["*"])te=x["*"];else{if(!g["*"]){N.push(new _t(l,d[$],`unknown property "${$}"`));continue}te=R}N=N.concat(te({key:(l&&`${l}.`)+$,value:d[$],valueSpec:Q,style:E,styleSpec:P,object:d,objectKey:$,validateSpec:R},d))}for(const $ in g)x[$]||g[$].required&&g[$].default===void 0&&d[$]===void 0&&N.push(new _t(l,d,`missing required property "${$}"`));return N}function $n(f){const l=f.value,d=f.valueSpec,g=f.style,x=f.styleSpec,E=f.key,P=f.arrayElementValidator||f.validateSpec;if(Mr(l)!=="array")return[new _t(E,l,`array expected, ${Mr(l)} found`)];if(d.length&&l.length!==d.length)return[new _t(E,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new _t(E,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let R={type:d.value,values:d.values};x.$version<7&&(R.function=d.function),Mr(d.value)==="object"&&(R=d.value);let N=[];for(let F=0;F<l.length;F++)N=N.concat(P({array:l,arrayIndex:F,value:l[F],valueSpec:R,validateSpec:f.validateSpec,style:g,styleSpec:x,key:`${E}[${F}]`}));return N}function Yr(f){const l=f.key,d=f.value,g=f.valueSpec;let x=Mr(d);return x==="number"&&d!=d&&(x="NaN"),x!=="number"?[new _t(l,d,`number expected, ${x} found`)]:"minimum"in g&&d<g.minimum?[new _t(l,d,`${d} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&d>g.maximum?[new _t(l,d,`${d} is greater than the maximum value ${g.maximum}`)]:[]}function Co(f){const l=f.valueSpec,d=Un(f.value.type);let g,x,E,P={};const R=d!=="categorical"&&f.value.property===void 0,N=!R,F=Mr(f.value.stops)==="array"&&Mr(f.value.stops[0])==="array"&&Mr(f.value.stops[0][0])==="object",$=Pn({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(te){if(d==="identity")return[new _t(te.key,te.value,'identity function may not have a "stops" property')];let ie=[];const oe=te.value;return ie=ie.concat($n({key:te.key,value:oe,valueSpec:te.valueSpec,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:H})),Mr(oe)==="array"&&oe.length===0&&ie.push(new _t(te.key,oe,"array must have at least one stop")),ie},default:function(te){return te.validateSpec({key:te.key,value:te.value,valueSpec:l,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec})}}});return d==="identity"&&R&&$.push(new _t(f.key,f.value,'missing required property "property"')),d==="identity"||f.value.stops||$.push(new _t(f.key,f.value,'missing required property "stops"')),d==="exponential"&&f.valueSpec.expression&&!Ua(f.valueSpec)&&$.push(new _t(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(N&&!ha(f.valueSpec)?$.push(new _t(f.key,f.value,"property functions not supported")):R&&!Vd(f.valueSpec)&&$.push(new _t(f.key,f.value,"zoom functions not supported"))),d!=="categorical"&&!F||f.value.property!==void 0||$.push(new _t(f.key,f.value,'"property" property is required')),$;function H(te){let ie=[];const oe=te.value,me=te.key;if(Mr(oe)!=="array")return[new _t(me,oe,`array expected, ${Mr(oe)} found`)];if(oe.length!==2)return[new _t(me,oe,`array length 2 expected, length ${oe.length} found`)];if(F){if(Mr(oe[0])!=="object")return[new _t(me,oe,`object expected, ${Mr(oe[0])} found`)];if(oe[0].zoom===void 0)return[new _t(me,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new _t(me,oe,"object stop key must have value")];if(E&&E>Un(oe[0].zoom))return[new _t(me,oe[0].zoom,"stop zoom values must appear in ascending order")];Un(oe[0].zoom)!==E&&(E=Un(oe[0].zoom),x=void 0,P={}),ie=ie.concat(Pn({key:`${me}[0]`,value:oe[0],valueSpec:{zoom:{}},validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:Yr,value:Q}}))}else ie=ie.concat(Q({key:`${me}[0]`,value:oe[0],validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec},oe));return lc(Po(oe[1]))?ie.concat([new _t(`${me}[1]`,oe[1],"expressions are not allowed in function stops.")]):ie.concat(te.validateSpec({key:`${me}[1]`,value:oe[1],valueSpec:l,validateSpec:te.validateSpec,style:te.style,styleSpec:te.styleSpec}))}function Q(te,ie){const oe=Mr(te.value),me=Un(te.value),we=te.value!==null?te.value:ie;if(g){if(oe!==g)return[new _t(te.key,we,`${oe} stop domain type must match previous stop domain type ${g}`)]}else g=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new _t(te.key,we,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&d!=="categorical"){let Fe=`number expected, ${oe} found`;return ha(l)&&d===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(te.key,we,Fe)]}return d!=="categorical"||oe!=="number"||isFinite(me)&&Math.floor(me)===me?d!=="categorical"&&oe==="number"&&x!==void 0&&me<x?[new _t(te.key,we,"stop domain values must appear in ascending order")]:(x=me,d==="categorical"&&me in P?[new _t(te.key,we,"stop domain values must be unique")]:(P[me]=!0,[])):[new _t(te.key,we,`integer expected, found ${me}`)]}}function fa(f){const l=(f.expressionContext==="property"?Wd:Ki)(Po(f.value),f.valueSpec);if(l.result==="error")return l.value.map(g=>new _t(`${f.key}${g.key}`,f.value,g.message));const d=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!d.outputDefined())return[new _t(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!th(d))return[new _t(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!th(d))return[new _t(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!rh(d,["zoom","feature-state"]))return[new _t(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!_f(d))return[new _t(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function no(f){const l=f.key,d=f.value,g=f.valueSpec,x=[];return Array.isArray(g.values)?g.values.indexOf(Un(d))===-1&&x.push(new _t(l,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(Un(d))===-1&&x.push(new _t(l,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),x}function Ro(f){return iu(Po(f.value))?fa(vr({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xf(f)}function xf(f){const l=f.value,d=f.key;if(Mr(l)!=="array")return[new _t(d,l,`array expected, ${Mr(l)} found`)];const g=f.styleSpec;let x,E=[];if(l.length<1)return[new _t(d,l,"filter array must have at least 1 element")];switch(E=E.concat(no({key:`${d}[0]`,value:l[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),Un(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Un(l[1])==="$type"&&E.push(new _t(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&E.push(new _t(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(x=Mr(l[1]),x!=="string"&&E.push(new _t(`${d}[1]`,l[1],`string expected, ${x} found`)));for(let P=2;P<l.length;P++)x=Mr(l[P]),Un(l[1])==="$type"?E=E.concat(no({key:`${d}[${P}]`,value:l[P],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&E.push(new _t(`${d}[${P}]`,l[P],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let P=1;P<l.length;P++)E=E.concat(xf({key:`${d}[${P}]`,value:l[P],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=Mr(l[1]),l.length!==2?E.push(new _t(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):x!=="string"&&E.push(new _t(`${d}[1]`,l[1],`string expected, ${x} found`))}return E}function wf(f,l){const d=f.key,g=f.validateSpec,x=f.style,E=f.styleSpec,P=f.value,R=f.objectKey,N=E[`${l}_${f.layerType}`];if(!N)return[];const F=R.match(/^(.*)-transition$/);if(l==="paint"&&F&&N[F[1]]&&N[F[1]].transition)return g({key:d,value:P,valueSpec:E.transition,style:x,styleSpec:E});const $=f.valueSpec||N[R];if(!$)return[new _t(d,P,`unknown property "${R}"`)];let H;if(Mr(P)==="string"&&ha($)&&!$.tokens&&(H=/^{([^}]+)}$/.exec(P)))return[new _t(d,P,`"${R}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const Q=[];return f.layerType==="symbol"&&(R==="text-field"&&x&&!x.glyphs&&Q.push(new _t(d,P,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&Mo(Po(P))&&Un(P.type)==="identity"&&Q.push(new _t(d,P,'"text-font" does not support identity functions'))),Q.concat(g({key:f.key,value:P,valueSpec:$,style:x,styleSpec:E,expressionContext:"property",propertyType:l,propertyKey:R}))}function ou(f){return wf(f,"paint")}function uc(f){return wf(f,"layout")}function Tf(f){let l=[];const d=f.value,g=f.key,x=f.style,E=f.styleSpec;d.type||d.ref||l.push(new _t(g,d,'either "type" or "ref" is required'));let P=Un(d.type);const R=Un(d.ref);if(d.id){const N=Un(d.id);for(let F=0;F<f.arrayIndex;F++){const $=x.layers[F];Un($.id)===N&&l.push(new _t(g,d.id,`duplicate layer id "${d.id}", previously used at line ${$.id.__line__}`))}}if("ref"in d){let N;["type","source","source-layer","filter","layout"].forEach(F=>{F in d&&l.push(new _t(g,d[F],`"${F}" is prohibited for ref layers`))}),x.layers.forEach(F=>{Un(F.id)===R&&(N=F)}),N?N.ref?l.push(new _t(g,d.ref,"ref cannot reference another ref layer")):P=Un(N.type):l.push(new _t(g,d.ref,`ref layer "${R}" not found`))}else if(P!=="background")if(d.source){const N=x.sources&&x.sources[d.source],F=N&&Un(N.type);N?F==="vector"&&P==="raster"?l.push(new _t(g,d.source,`layer "${d.id}" requires a raster source`)):F!=="raster-dem"&&P==="hillshade"?l.push(new _t(g,d.source,`layer "${d.id}" requires a raster-dem source`)):F==="raster"&&P!=="raster"?l.push(new _t(g,d.source,`layer "${d.id}" requires a vector source`)):F!=="vector"||d["source-layer"]?F==="raster-dem"&&P!=="hillshade"?l.push(new _t(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!d.paint||!d.paint["line-gradient"]||F==="geojson"&&N.lineMetrics||l.push(new _t(g,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new _t(g,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new _t(g,d.source,`source "${d.source}" not found`))}else l.push(new _t(g,d,'missing required property "source"'));return l=l.concat(Pn({key:g,value:d,valueSpec:E.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${g}.type`,value:d.type,valueSpec:E.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:d,objectKey:"type"}),filter:Ro,layout:N=>Pn({layer:d,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,validateSpec:N.validateSpec,objectElementValidators:{"*":F=>uc(vr({layerType:P},F))}}),paint:N=>Pn({layer:d,key:N.key,value:N.value,style:N.style,styleSpec:N.styleSpec,validateSpec:N.validateSpec,objectElementValidators:{"*":F=>ou(vr({layerType:P},F))}})}})),l}function Ea(f){const l=f.value,d=f.key,g=Mr(l);return g!=="string"?[new _t(d,l,`string expected, ${g} found`)]:[]}const Sf={promoteId:function({key:f,value:l}){if(Mr(l)==="string")return Ea({key:f,value:l});{const d=[];for(const g in l)d.push(...Ea({key:`${f}.${g}`,value:l[g]}));return d}}};function vl(f){const l=f.value,d=f.key,g=f.styleSpec,x=f.style,E=f.validateSpec;if(!l.type)return[new _t(d,l,'"type" is required')];const P=Un(l.type);let R;switch(P){case"vector":case"raster":return R=Pn({key:d,value:l,valueSpec:g[`source_${P.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:Sf,validateSpec:E}),R;case"raster-dem":return R=function(N){var F;const $=(F=N.sourceName)!==null&&F!==void 0?F:"",H=N.value,Q=N.styleSpec,te=Q.source_raster_dem,ie=N.style;let oe=[];const me=Mr(H);if(H===void 0)return oe;if(me!=="object")return oe.push(new _t("source_raster_dem",H,`object expected, ${me} found`)),oe;const we=Un(H.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],Ee=N.value.encoding?`"${N.value.encoding}"`:"Default";for(const ee in H)!we&&Fe.includes(ee)?oe.push(new _t(ee,H[ee],`In "${$}": "${ee}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):te[ee]?oe=oe.concat(N.validateSpec({key:ee,value:H[ee],valueSpec:te[ee],validateSpec:N.validateSpec,style:ie,styleSpec:Q})):oe.push(new _t(ee,H[ee],`unknown property "${ee}"`));return oe}({sourceName:d,value:l,style:f.style,styleSpec:g,validateSpec:E}),R;case"geojson":if(R=Pn({key:d,value:l,valueSpec:g.source_geojson,style:x,styleSpec:g,validateSpec:E,objectElementValidators:Sf}),l.cluster)for(const N in l.clusterProperties){const[F,$]=l.clusterProperties[N],H=typeof F=="string"?[F,["accumulated"],["get",N]]:F;R.push(...fa({key:`${d}.${N}.map`,value:$,expressionContext:"cluster-map"})),R.push(...fa({key:`${d}.${N}.reduce`,value:H,expressionContext:"cluster-reduce"}))}return R;case"video":return Pn({key:d,value:l,valueSpec:g.source_video,style:x,validateSpec:E,styleSpec:g});case"image":return Pn({key:d,value:l,valueSpec:g.source_image,style:x,validateSpec:E,styleSpec:g});case"canvas":return[new _t(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return no({key:`${d}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function io(f){const l=f.value,d=f.styleSpec,g=d.light,x=f.style;let E=[];const P=Mr(l);if(l===void 0)return E;if(P!=="object")return E=E.concat([new _t("light",l,`object expected, ${P} found`)]),E;for(const R in l){const N=R.match(/^(.*)-transition$/);E=E.concat(N&&g[N[1]]&&g[N[1]].transition?f.validateSpec({key:R,value:l[R],valueSpec:d.transition,validateSpec:f.validateSpec,style:x,styleSpec:d}):g[R]?f.validateSpec({key:R,value:l[R],valueSpec:g[R],validateSpec:f.validateSpec,style:x,styleSpec:d}):[new _t(R,l[R],`unknown property "${R}"`)])}return E}function Io(f){const l=f.value,d=f.styleSpec,g=d.sky,x=f.style,E=Mr(l);if(l===void 0)return[];if(E!=="object")return[new _t("sky",l,`object expected, ${E} found`)];let P=[];for(const R in l)P=P.concat(g[R]?f.validateSpec({key:R,value:l[R],valueSpec:g[R],style:x,styleSpec:d}):[new _t(R,l[R],`unknown property "${R}"`)]);return P}function ao(f){const l=f.value,d=f.styleSpec,g=d.terrain,x=f.style;let E=[];const P=Mr(l);if(l===void 0)return E;if(P!=="object")return E=E.concat([new _t("terrain",l,`object expected, ${P} found`)]),E;for(const R in l)E=E.concat(g[R]?f.validateSpec({key:R,value:l[R],valueSpec:g[R],validateSpec:f.validateSpec,style:x,styleSpec:d}):[new _t(R,l[R],`unknown property "${R}"`)]);return E}function Af(f){let l=[];const d=f.value,g=f.key;if(Array.isArray(d)){const x=[],E=[];for(const P in d)d[P].id&&x.includes(d[P].id)&&l.push(new _t(g,d,`all the sprites' ids must be unique, but ${d[P].id} is duplicated`)),x.push(d[P].id),d[P].url&&E.includes(d[P].url)&&l.push(new _t(g,d,`all the sprites' URLs must be unique, but ${d[P].url} is duplicated`)),E.push(d[P].url),l=l.concat(Pn({key:`${g}[${P}]`,value:d[P],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return Ea({key:g,value:d})}const bl={"*":()=>[],array:$n,boolean:function(f){const l=f.value,d=f.key,g=Mr(l);return g!=="boolean"?[new _t(d,l,`boolean expected, ${g} found`)]:[]},number:Yr,color:function(f){const l=f.key,d=f.value,g=Mr(d);return g!=="string"?[new _t(l,d,`color expected, ${g} found`)]:kr.parse(String(d))?[]:[new _t(l,d,`color expected, "${d}" found`)]},constants:Zd,enum:no,filter:Ro,function:Co,layer:Tf,object:Pn,source:vl,light:io,sky:Io,terrain:ao,projection:function(f){const l=f.value,d=f.styleSpec,g=d.projection,x=f.style,E=Mr(l);if(l===void 0)return[];if(E!=="object")return[new _t("projection",l,`object expected, ${E} found`)];let P=[];for(const R in l)P=P.concat(g[R]?f.validateSpec({key:R,value:l[R],valueSpec:g[R],style:x,styleSpec:d}):[new _t(R,l[R],`unknown property "${R}"`)]);return P},projectionDefinition:function(f){const l=f.key;let d=f.value;d=d instanceof String?d.valueOf():d;const g=Mr(d);return g!=="array"||function(x){return Array.isArray(x)&&x.length===3&&typeof x[0]=="string"&&typeof x[1]=="string"&&typeof x[2]=="number"}(d)||function(x){return!!["interpolate","step","literal"].includes(x[0])}(d)?["array","string"].includes(g)?[]:[new _t(l,d,`projection expected, invalid type "${g}" found`)]:[new _t(l,d,`projection expected, invalid array ${JSON.stringify(d)} found`)]},string:Ea,formatted:function(f){return Ea(f).length===0?[]:fa(f)},resolvedImage:function(f){return Ea(f).length===0?[]:fa(f)},padding:function(f){const l=f.key,d=f.value;if(Mr(d)==="array"){if(d.length<1||d.length>4)return[new _t(l,d,`padding requires 1 to 4 values; ${d.length} values found`)];const g={type:"number"};let x=[];for(let E=0;E<d.length;E++)x=x.concat(f.validateSpec({key:`${l}[${E}]`,value:d[E],validateSpec:f.validateSpec,valueSpec:g}));return x}return Yr({key:l,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const l=f.key,d=f.value,g=Mr(d),x=f.styleSpec;if(g!=="array"||d.length<1||d.length%2!=0)return[new _t(l,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let E=[];for(let P=0;P<d.length;P+=2)E=E.concat(no({key:`${l}[${P}]`,value:d[P],valueSpec:x.layout_symbol["text-anchor"]})),E=E.concat($n({key:`${l}[${P+1}]`,value:d[P+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:x}));return E},sprite:Af};function bs(f){const l=f.value,d=f.valueSpec,g=f.styleSpec;return f.validateSpec=bs,d.expression&&Mo(Un(l))?Co(f):d.expression&&lc(Po(l))?fa(f):d.type&&bl[d.type]?bl[d.type](f):Pn(vr({},f,{valueSpec:d.type?g[d.type]:d}))}function Qi(f){const l=f.value,d=f.key,g=Ea(f);return g.length||(l.indexOf("{fontstack}")===-1&&g.push(new _t(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&g.push(new _t(d,l,'"glyphs" url must include a "{range}" token'))),g}function ui(f,l=fe){let d=[];return d=d.concat(bs({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:bs,objectElementValidators:{glyphs:Qi,"*":()=>[]}})),f.constants&&(d=d.concat(Zd({key:"constants",value:f.constants}))),ih(d)}function Cn(f){return function(l){return f({...l,validateSpec:bs})}}function ih(f){return[].concat(f).sort((l,d)=>l.line-d.line)}function Bs(f){return function(...l){return ih(f.apply(this,l))}}ui.source=Bs(Cn(vl)),ui.sprite=Bs(Cn(Af)),ui.glyphs=Bs(Cn(Qi)),ui.light=Bs(Cn(io)),ui.sky=Bs(Cn(Io)),ui.terrain=Bs(Cn(ao)),ui.layer=Bs(Cn(Tf)),ui.filter=Bs(Cn(Ro)),ui.paintProperty=Bs(Cn(ou)),ui.layoutProperty=Bs(Cn(uc));const so=ui,vm=so.light,Xd=so.sky,Oi=so.paintProperty,ah=so.layoutProperty;function lu(f,l){let d=!1;if(l&&l.length)for(const g of l)f.fire(new ge(new Error(g.message))),d=!0;return d}class ns{constructor(l,d,g){const x=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const P=new Int32Array(this.arrayBuffer);l=P[0],this.d=(d=P[1])+2*(g=P[2]);for(let N=0;N<this.d*this.d;N++){const F=P[3+N],$=P[3+N+1];x.push(F===$?null:P.subarray(F,$))}const R=P[3+x.length+1];this.keys=P.subarray(P[3+x.length],R),this.bboxes=P.subarray(R),this.insert=this._insertReadonly}else{this.d=d+2*g;for(let P=0;P<this.d*this.d;P++)x.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=g,this.scale=d/l,this.uid=0;const E=g/d*l;this.min=-E,this.max=l+E}insert(l,d,g,x,E){this._forEachCell(d,g,x,E,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(E)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,d,g,x,E,P){this.cells[E].push(P)}query(l,d,g,x,E){const P=this.min,R=this.max;if(l<=P&&d<=P&&R<=g&&R<=x&&!E)return Array.prototype.slice.call(this.keys);{const N=[];return this._forEachCell(l,d,g,x,this._queryCell,N,{},E),N}}_queryCell(l,d,g,x,E,P,R,N){const F=this.cells[E];if(F!==null){const $=this.keys,H=this.bboxes;for(let Q=0;Q<F.length;Q++){const te=F[Q];if(R[te]===void 0){const ie=4*te;(N?N(H[ie+0],H[ie+1],H[ie+2],H[ie+3]):l<=H[ie+2]&&d<=H[ie+3]&&g>=H[ie+0]&&x>=H[ie+1])?(R[te]=!0,P.push($[te])):R[te]=!1}}}}_forEachCell(l,d,g,x,E,P,R,N){const F=this._convertToCellCoord(l),$=this._convertToCellCoord(d),H=this._convertToCellCoord(g),Q=this._convertToCellCoord(x);for(let te=F;te<=H;te++)for(let ie=$;ie<=Q;ie++){const oe=this.d*ie+te;if((!N||N(this._convertFromCellCoord(te),this._convertFromCellCoord(ie),this._convertFromCellCoord(te+1),this._convertFromCellCoord(ie+1)))&&E.call(this,l,d,g,x,oe,P,R,N))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,d=3+this.cells.length+1+1;let g=0;for(let P=0;P<this.cells.length;P++)g+=this.cells[P].length;const x=new Int32Array(d+g+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;let E=d;for(let P=0;P<l.length;P++){const R=l[P];x[3+P]=E,x.set(R,E),E+=R.length}return x[3+l.length]=E,x.set(this.keys,E),E+=this.keys.length,x[3+l.length+1]=E,x.set(this.bboxes,E),E+=this.bboxes.length,x.buffer}static serialize(l,d){const g=l.toArrayBuffer();return d&&d.push(g),{buffer:g}}static deserialize(l){return new ns(l.buffer)}}const Ls={};function Jt(f,l,d={}){if(Ls[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),Ls[f]={klass:l,omit:d.omit||[],shallow:d.shallow||[]}}Jt("Object",Object),Jt("TransferableGridIndex",ns),Jt("Color",kr),Jt("Error",Error),Jt("AJAXError",tl),Jt("ResolvedImage",Bi),Jt("StylePropertyFunction",cc),Jt("StyleExpression",gl,{omit:["_evaluator"]}),Jt("ZoomDependentExpression",Ns),Jt("ZoomConstantExpression",nh),Jt("CompoundExpression",ts,{omit:["_evaluate"]});for(const f in hl)hl[f]._classRegistryKey||Jt(`Expression_${f}`,hl[f]);function hc(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function Gd(f){return f.$name||f.constructor._classRegistryKey}function cu(f){return!function(l){if(l===null||typeof l!="object")return!1;const d=Gd(l);return!(!d||d==="Object")}(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||hc(f)||fr(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function sh(f,l){if(cu(f))return(hc(f)||fr(f))&&l&&l.push(f),ArrayBuffer.isView(f)&&l&&l.push(f.buffer),f instanceof ImageData&&l&&l.push(f.data.buffer),f;if(Array.isArray(f)){const E=[];for(const P of f)E.push(sh(P,l));return E}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);const d=Gd(f);if(!d)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!Ls[d])throw new Error(`${d} is not registered.`);const{klass:g}=Ls[d],x=g.serialize?g.serialize(f,l):{};if(g.serialize){if(l&&x===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const E in f){if(!f.hasOwnProperty(E)||Ls[d].omit.indexOf(E)>=0)continue;const P=f[E];x[E]=Ls[d].shallow.indexOf(E)>=0?P:sh(P,l)}f instanceof Error&&(x.message=f.message)}if(x.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(x.$name=d),x}function xl(f){if(cu(f))return f;if(Array.isArray(f))return f.map(xl);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);const l=Gd(f)||"Object";if(!Ls[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:d}=Ls[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(f);const g=Object.create(d.prototype);for(const x of Object.keys(f)){if(x==="$name")continue;const E=f[x];g[x]=Ls[l].shallow.indexOf(x)>=0?E:xl(E)}return g}class Fs{constructor(){this.first=!0}update(l,d){const g=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=d),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=g,!0))}}const Nr={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Hangul Syllables":f=>f>=44032&&f<=55215,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function fc(f){for(const l of f)if(lh(l.charCodeAt(0)))return!0;return!1}function Yd(f){for(const l of f)if(!oh(l.charCodeAt(0)))return!1;return!0}function wl(f){const l=f.map(d=>{try{return new RegExp(`\\p{sc=${d}}`,"u").source}catch{return null}}).filter(d=>d);return new RegExp(l.join("|"),"u")}const Ef=wl(["Arab","Dupl","Mong","Ougr","Syrc"]);function oh(f){return!Ef.test(String.fromCodePoint(f))}const Mf=wl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function lh(f){return!(f!==746&&f!==747&&(f<4352||!(Nr["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Nr["CJK Compatibility"](f)||Nr["CJK Strokes"](f)||!(!Nr["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Nr["Enclosed CJK Letters and Months"](f)||Nr["Ideographic Description Characters"](f)||Nr.Kanbun(f)||Nr.Katakana(f)&&f!==12540||!(!Nr["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Nr["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Nr["Vertical Forms"](f)||Nr["Yijing Hexagram Symbols"](f)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(f))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(f))||Mf.test(String.fromCodePoint(f)))))}function ch(f){return!(lh(f)||function(l){return!!(Nr["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Nr["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Nr["Letterlike Symbols"](l)||Nr["Number Forms"](l)||Nr["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Nr["Control Pictures"](l)&&l!==9251||Nr["Optical Character Recognition"](l)||Nr["Enclosed Alphanumerics"](l)||Nr["Geometric Shapes"](l)||Nr["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Nr["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Nr["CJK Symbols and Punctuation"](l)||Nr.Katakana(l)||Nr["Private Use Area"](l)||Nr["CJK Compatibility Forms"](l)||Nr["Small Form Variants"](l)||Nr["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(f))}const Kd=wl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function dc(f){return Kd.test(String.fromCodePoint(f))}function Qd(f,l){return!(!l&&dc(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Nr.Khmer(f))}function bm(f){for(const l of f)if(dc(l.charCodeAt(0)))return!0;return!1}const Ma=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){if(Ma.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(f,l){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(f.pluginStatus!=="loading")return this.setState(f),f;const d=f.pluginURL,g=new Promise(E=>{this.loadScriptResolve=E});l(d);const x=new Promise(E=>setTimeout(()=>E(),this.TIMEOUT));if(yield Promise.race([g,x]),this.isParsed()){const E={pluginStatus:"loaded",pluginURL:d};return this.setState(E),E}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${d}`)})}};class cn{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fs,this.transition={})}isSupportedScript(l){return function(d,g){for(const x of d)if(!Qd(x.charCodeAt(0),g))return!1;return!0}(l,Ma.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,d=l-Math.floor(l),g=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*d}}}class pc{constructor(l,d){this.property=l,this.value=d,this.expression=function(g,x){if(Mo(g))return new cc(g,x);if(lc(g)){const E=Wd(g,x);if(E.result==="error")throw new Error(E.value.map(P=>`${P.key}: ${P.message}`).join(", "));return E.value}{let E=g;return x.type==="color"&&typeof g=="string"?E=kr.parse(g):x.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?x.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?E=Ii.parse(g):x.type==="projectionDefinition"&&typeof g=="string"&&(E=gi.parse(g)):E=sa.parse(g),{kind:"constant",evaluate:()=>E}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,g){return this.property.possiblyEvaluate(this,l,d,g)}}class zs{constructor(l){this.property=l,this.value=new pc(l,void 0)}transitioned(l,d){return new Oo(this.property,this.value,d,tr({},l.transition,this.transition),l.now)}untransitioned(){return new Oo(this.property,this.value,null,{},0)}}class oo{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Zt(this._values[l].value.value)}setValue(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new zs(this._values[l].property)),this._values[l].value=new pc(this._values[l].property,d===null?void 0:Zt(d))}getTransition(l){return Zt(this._values[l].transition)}setTransition(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new zs(this._values[l].property)),this._values[l].transition=Zt(d)||void 0}serialize(){const l={};for(const d of Object.keys(this._values)){const g=this.getValue(d);g!==void 0&&(l[d]=g);const x=this.getTransition(d);x!==void 0&&(l[`${d}-transition`]=x)}return l}transitioned(l,d){const g=new Pf(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].transitioned(l,d._values[x]);return g}untransitioned(){const l=new Pf(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class Oo{constructor(l,d,g,x,E){this.property=l,this.value=d,this.begin=E+x.delay||0,this.end=this.begin+x.duration||0,l.specification.transition&&(x.delay||x.duration)&&(this.prior=g)}possiblyEvaluate(l,d,g){const x=l.now||0,E=this.value.possiblyEvaluate(l,d,g),P=this.prior;if(P){if(x>this.end)return this.prior=null,E;if(this.value.isDataDriven())return this.prior=null,E;if(x<this.begin)return P.possiblyEvaluate(l,d,g);{const R=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(P.possiblyEvaluate(l,d,g),E,vt(R))}}return E}}class Pf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,g){const x=new Tl(this._properties);for(const E of Object.keys(this._values))x._values[E]=this._values[E].possiblyEvaluate(l,d,g);return x}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class uh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return Zt(this._values[l].value)}setValue(l,d){this._values[l]=new pc(this._values[l].property,d===null?void 0:Zt(d))}serialize(){const l={};for(const d of Object.keys(this._values)){const g=this.getValue(d);g!==void 0&&(l[d]=g)}return l}possiblyEvaluate(l,d,g){const x=new Tl(this._properties);for(const E of Object.keys(this._values))x._values[E]=this._values[E].possiblyEvaluate(l,d,g);return x}}class qa{constructor(l,d,g){this.property=l,this.value=d,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,g,x){return this.property.evaluate(this.value,this.parameters,l,d,g,x)}}class Tl{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class ur{constructor(l){this.specification=l}possiblyEvaluate(l,d){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(d)}interpolate(l,d,g){const x=_n[this.specification.type];return x?x(l,d,g):l}}class xr{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,g,x){return new qa(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},g,x)}:l.expression,d)}interpolate(l,d,g){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new qa(this,{kind:"constant",value:void 0},l.parameters);const x=_n[this.specification.type];if(x){const E=x(l.value.value,d.value.value,g);return new qa(this,{kind:"constant",value:E},l.parameters)}return l}evaluate(l,d,g,x,E,P){return l.kind==="constant"?l.value:l.evaluate(d,g,x,E,P)}}class lo extends xr{possiblyEvaluate(l,d,g,x){if(l.value===void 0)return new qa(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){const E=l.expression.evaluate(d,null,{},g,x),P=l.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,R=this._calculate(P,P,P,d);return new qa(this,{kind:"constant",value:R},d)}if(l.expression.kind==="camera"){const E=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new qa(this,{kind:"constant",value:E},d)}return new qa(this,l.expression,d)}evaluate(l,d,g,x,E,P){if(l.kind==="source"){const R=l.evaluate(d,g,x,E,P);return this._calculate(R,R,R,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},g,x),l.evaluate({zoom:Math.floor(d.zoom)},g,x),l.evaluate({zoom:Math.floor(d.zoom)+1},g,x),d):l.value}_calculate(l,d,g,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class uu{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,x){if(l.value!==void 0){if(l.expression.kind==="constant"){const E=l.expression.evaluate(d,null,{},g,x);return this._calculate(E,E,E,d)}return this._calculate(l.expression.evaluate(new cn(Math.floor(d.zoom-1),d)),l.expression.evaluate(new cn(Math.floor(d.zoom),d)),l.expression.evaluate(new cn(Math.floor(d.zoom+1),d)),d)}}_calculate(l,d,g,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class Cf{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,x){return!!l.expression.evaluate(d,null,{},g,x)}interpolate(){return!1}}class da{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in l){const g=l[d];g.specification.overridable&&this.overridableProperties.push(d);const x=this.defaultPropertyValues[d]=new pc(g,void 0),E=this.defaultTransitionablePropertyValues[d]=new zs(g);this.defaultTransitioningPropertyValues[d]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=x.possiblyEvaluate({})}}}Jt("DataDrivenProperty",xr),Jt("DataConstantProperty",ur),Jt("CrossFadedDataDrivenProperty",lo),Jt("CrossFadedProperty",uu),Jt("ColorRampProperty",Cf);const Rf="-transition";class Ji extends Pe{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new uh(d.layout)),d.paint)){this._transitionablePaint=new oo(d.paint);for(const g in l.paint)this.setPaintProperty(g,l.paint[g],{validate:!1});for(const g in l.layout)this.setLayoutProperty(g,l.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tl(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,g={}){d!=null&&this._validate(ah,`layers.${this.id}.layout.${l}`,l,d,g)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return l.endsWith(Rf)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,g={}){if(d!=null&&this._validate(Oi,`layers.${this.id}.paint.${l}`,l,d,g))return!1;if(l.endsWith(Rf))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{const x=this._transitionablePaint._values[l],E=x.property.specification["property-type"]==="cross-faded-data-driven",P=x.value.isDataDriven(),R=x.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);const N=this._transitionablePaint._values[l].value;return N.isDataDriven()||P||E||this._handleOverridablePaintPropertyUpdate(l,R,N)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,d,g){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Gt(l,(d,g)=>!(d===void 0||g==="layout"&&!Object.keys(d).length||g==="paint"&&!Object.keys(d).length))}_validate(l,d,g,x,E={}){return(!E||E.validate!==!1)&&lu(this,l.call(so,{key:d,layerType:this.type,objectKey:g,value:x,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const d=this.paint.get(l);if(d instanceof qa&&ha(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const Or={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Jr{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Br{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Vn(f,l=1){let d=0,g=0;return{members:f.map(x=>{const E=Or[x.type].BYTES_PER_ELEMENT,P=d=Sl(d,Math.max(l,E)),R=x.components||1;return g=Math.max(g,E),d+=E*R,{name:x.name,type:x.type,components:R,offset:P}}),size:Sl(d,Math.max(g,l)),alignment:l}}function Sl(f,l){return Math.ceil(f/l)*l}class js extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){const g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){const x=2*l;return this.int16[x+0]=d,this.int16[x+1]=g,l}}js.prototype.bytesPerElement=4,Jt("StructArrayLayout2i4",js);class mc extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,g)}emplace(l,d,g,x){const E=3*l;return this.int16[E+0]=d,this.int16[E+1]=g,this.int16[E+2]=x,l}}mc.prototype.bytesPerElement=6,Jt("StructArrayLayout3i6",mc);class is extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,x){const E=this.length;return this.resize(E+1),this.emplace(E,l,d,g,x)}emplace(l,d,g,x,E){const P=4*l;return this.int16[P+0]=d,this.int16[P+1]=g,this.int16[P+2]=x,this.int16[P+3]=E,l}}is.prototype.bytesPerElement=8,Jt("StructArrayLayout4i8",is);class ko extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,d,g,x,E,P)}emplace(l,d,g,x,E,P,R){const N=6*l;return this.int16[N+0]=d,this.int16[N+1]=g,this.int16[N+2]=x,this.int16[N+3]=E,this.int16[N+4]=P,this.int16[N+5]=R,l}}ko.prototype.bytesPerElement=12,Jt("StructArrayLayout2i4i12",ko);class hh extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,d,g,x,E,P)}emplace(l,d,g,x,E,P,R){const N=4*l,F=8*l;return this.int16[N+0]=d,this.int16[N+1]=g,this.uint8[F+4]=x,this.uint8[F+5]=E,this.uint8[F+6]=P,this.uint8[F+7]=R,l}}hh.prototype.bytesPerElement=8,Jt("StructArrayLayout2i4ub8",hh);class Rn extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){const g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){const x=2*l;return this.float32[x+0]=d,this.float32[x+1]=g,l}}Rn.prototype.bytesPerElement=8,Jt("StructArrayLayout2f8",Rn);class gc extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P,R,N,F,$){const H=this.length;return this.resize(H+1),this.emplace(H,l,d,g,x,E,P,R,N,F,$)}emplace(l,d,g,x,E,P,R,N,F,$,H){const Q=10*l;return this.uint16[Q+0]=d,this.uint16[Q+1]=g,this.uint16[Q+2]=x,this.uint16[Q+3]=E,this.uint16[Q+4]=P,this.uint16[Q+5]=R,this.uint16[Q+6]=N,this.uint16[Q+7]=F,this.uint16[Q+8]=$,this.uint16[Q+9]=H,l}}gc.prototype.bytesPerElement=20,Jt("StructArrayLayout10ui20",gc);class fh extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P,R,N,F,$,H,Q){const te=this.length;return this.resize(te+1),this.emplace(te,l,d,g,x,E,P,R,N,F,$,H,Q)}emplace(l,d,g,x,E,P,R,N,F,$,H,Q,te){const ie=12*l;return this.int16[ie+0]=d,this.int16[ie+1]=g,this.int16[ie+2]=x,this.int16[ie+3]=E,this.uint16[ie+4]=P,this.uint16[ie+5]=R,this.uint16[ie+6]=N,this.uint16[ie+7]=F,this.int16[ie+8]=$,this.int16[ie+9]=H,this.int16[ie+10]=Q,this.int16[ie+11]=te,l}}fh.prototype.bytesPerElement=24,Jt("StructArrayLayout4i4ui4i24",fh);class _c extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,g)}emplace(l,d,g,x){const E=3*l;return this.float32[E+0]=d,this.float32[E+1]=g,this.float32[E+2]=x,l}}_c.prototype.bytesPerElement=12,Jt("StructArrayLayout3f12",_c);class Al extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}Al.prototype.bytesPerElement=4,Jt("StructArrayLayout1ul4",Al);class Jd extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P,R,N,F){const $=this.length;return this.resize($+1),this.emplace($,l,d,g,x,E,P,R,N,F)}emplace(l,d,g,x,E,P,R,N,F,$){const H=10*l,Q=5*l;return this.int16[H+0]=d,this.int16[H+1]=g,this.int16[H+2]=x,this.int16[H+3]=E,this.int16[H+4]=P,this.int16[H+5]=R,this.uint32[Q+3]=N,this.uint16[H+8]=F,this.uint16[H+9]=$,l}}Jd.prototype.bytesPerElement=20,Jt("StructArrayLayout6i1ul2ui20",Jd);class hu extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,d,g,x,E,P)}emplace(l,d,g,x,E,P,R){const N=6*l;return this.int16[N+0]=d,this.int16[N+1]=g,this.int16[N+2]=x,this.int16[N+3]=E,this.int16[N+4]=P,this.int16[N+5]=R,l}}hu.prototype.bytesPerElement=12,Jt("StructArrayLayout2i2i2i12",hu);class Do extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E){const P=this.length;return this.resize(P+1),this.emplace(P,l,d,g,x,E)}emplace(l,d,g,x,E,P){const R=4*l,N=8*l;return this.float32[R+0]=d,this.float32[R+1]=g,this.float32[R+2]=x,this.int16[N+6]=E,this.int16[N+7]=P,l}}Do.prototype.bytesPerElement=16,Jt("StructArrayLayout2f1f2i16",Do);class dh extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P){const R=this.length;return this.resize(R+1),this.emplace(R,l,d,g,x,E,P)}emplace(l,d,g,x,E,P,R){const N=16*l,F=4*l,$=8*l;return this.uint8[N+0]=d,this.uint8[N+1]=g,this.float32[F+1]=x,this.float32[F+2]=E,this.int16[$+6]=P,this.int16[$+7]=R,l}}dh.prototype.bytesPerElement=16,Jt("StructArrayLayout2ub2f2i16",dh);class ea extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,g)}emplace(l,d,g,x){const E=3*l;return this.uint16[E+0]=d,this.uint16[E+1]=g,this.uint16[E+2]=x,l}}ea.prototype.bytesPerElement=6,Jt("StructArrayLayout3ui6",ea);class Qn extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,l,d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we)}emplace(l,d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we,Fe){const Ee=24*l,ee=12*l,pe=48*l;return this.int16[Ee+0]=d,this.int16[Ee+1]=g,this.uint16[Ee+2]=x,this.uint16[Ee+3]=E,this.uint32[ee+2]=P,this.uint32[ee+3]=R,this.uint32[ee+4]=N,this.uint16[Ee+10]=F,this.uint16[Ee+11]=$,this.uint16[Ee+12]=H,this.float32[ee+7]=Q,this.float32[ee+8]=te,this.uint8[pe+36]=ie,this.uint8[pe+37]=oe,this.uint8[pe+38]=me,this.uint32[ee+10]=we,this.int16[Ee+22]=Fe,l}}Qn.prototype.bytesPerElement=48,Jt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Qn);class ph extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we,Fe,Ee,ee,pe,Re,st,Nt,dt,wt,$t,Lt){const qt=this.length;return this.resize(qt+1),this.emplace(qt,l,d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we,Fe,Ee,ee,pe,Re,st,Nt,dt,wt,$t,Lt)}emplace(l,d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we,Fe,Ee,ee,pe,Re,st,Nt,dt,wt,$t,Lt,qt){const Et=32*l,ir=16*l;return this.int16[Et+0]=d,this.int16[Et+1]=g,this.int16[Et+2]=x,this.int16[Et+3]=E,this.int16[Et+4]=P,this.int16[Et+5]=R,this.int16[Et+6]=N,this.int16[Et+7]=F,this.uint16[Et+8]=$,this.uint16[Et+9]=H,this.uint16[Et+10]=Q,this.uint16[Et+11]=te,this.uint16[Et+12]=ie,this.uint16[Et+13]=oe,this.uint16[Et+14]=me,this.uint16[Et+15]=we,this.uint16[Et+16]=Fe,this.uint16[Et+17]=Ee,this.uint16[Et+18]=ee,this.uint16[Et+19]=pe,this.uint16[Et+20]=Re,this.uint16[Et+21]=st,this.uint16[Et+22]=Nt,this.uint32[ir+12]=dt,this.float32[ir+13]=wt,this.float32[ir+14]=$t,this.uint16[Et+30]=Lt,this.uint16[Et+31]=qt,l}}ph.prototype.bytesPerElement=64,Jt("StructArrayLayout8i15ui1ul2f2ui64",ph);class T extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}T.prototype.bytesPerElement=4,Jt("StructArrayLayout1f4",T);class a extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,g)}emplace(l,d,g,x){const E=3*l;return this.uint16[6*l+0]=d,this.float32[E+1]=g,this.float32[E+2]=x,l}}a.prototype.bytesPerElement=12,Jt("StructArrayLayout1ui2f12",a);class h extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,l,d,g)}emplace(l,d,g,x){const E=4*l;return this.uint32[2*l+0]=d,this.uint16[E+2]=g,this.uint16[E+3]=x,l}}h.prototype.bytesPerElement=8,Jt("StructArrayLayout1ul2ui8",h);class _ extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){const g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){const x=2*l;return this.uint16[x+0]=d,this.uint16[x+1]=g,l}}_.prototype.bytesPerElement=4,Jt("StructArrayLayout2ui4",_);class b extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}b.prototype.bytesPerElement=2,Jt("StructArrayLayout1ui2",b);class A extends Br{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,x){const E=this.length;return this.resize(E+1),this.emplace(E,l,d,g,x)}emplace(l,d,g,x,E){const P=4*l;return this.float32[P+0]=d,this.float32[P+1]=g,this.float32[P+2]=x,this.float32[P+3]=E,l}}A.prototype.bytesPerElement=16,Jt("StructArrayLayout4f16",A);class C extends Jr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new z(this.anchorPointX,this.anchorPointY)}}C.prototype.size=20;class D extends Jd{get(l){return new C(this,l)}}Jt("CollisionBoxArray",D);class B extends Jr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}B.prototype.size=48;class j extends Qn{get(l){return new B(this,l)}}Jt("PlacedSymbolArray",j);class q extends Jr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}q.prototype.size=64;class X extends ph{get(l){return new q(this,l)}}Jt("SymbolInstanceArray",X);class G extends T{getoffsetX(l){return this.float32[1*l+0]}}Jt("GlyphOffsetArray",G);class ae extends mc{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Jt("SymbolLineVertexArray",ae);class se extends Jr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}se.prototype.size=12;class ve extends a{get(l){return new se(this,l)}}Jt("TextAnchorOffsetArray",ve);class _e extends Jr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_e.prototype.size=8;class xe extends h{get(l){return new _e(this,l)}}Jt("FeatureIndexArray",xe);class Ae extends js{}class Oe extends js{}class ke extends js{}class Be extends ko{}class je extends hh{}class Le extends Rn{}class nt extends gc{}class lt extends fh{}class At extends _c{}class St extends Al{}class Tt extends hu{}class Wt extends dh{}class Ht extends ea{}class Rt extends _{}const lr=Vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ir}=lr;class Tr{constructor(l=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=l}prepareSegment(l,d,g,x){const E=this.segments[this.segments.length-1];return l>Tr.MAX_VERTEX_ARRAY_LENGTH&&hr(`Max vertices per segment is ${Tr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Tr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!E||E.vertexLength+l>Tr.MAX_VERTEX_ARRAY_LENGTH||E.sortKey!==x?this.createNewSegment(d,g,x):E}createNewSegment(l,d,g){const x={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(x.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(x),x}getOrCreateLatestSegment(l,d,g){return this.prepareSegment(0,l,d,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const l of this.segments)for(const d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,g,x){return new Tr([{vertexOffset:l,primitiveOffset:d,vertexLength:g,primitiveLength:x,vaos:{},sortKey:0}])}}function In(f,l){return 256*(f=Ge(Math.floor(f),0,255))+Ge(Math.floor(l),0,255)}Tr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jt("SegmentVector",Tr);const en=Vn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var On,un,nn,Kr={exports:{}},_i={exports:{}},yi={exports:{}},Fi=function(){if(nn)return Kr.exports;nn=1;var f=(On||(On=1,_i.exports=function(d,g){var x,E,P,R,N,F,$,H;for(E=d.length-(x=3&d.length),P=g,N=3432918353,F=461845907,H=0;H<E;)$=255&d.charCodeAt(H)|(255&d.charCodeAt(++H))<<8|(255&d.charCodeAt(++H))<<16|(255&d.charCodeAt(++H))<<24,++H,P=27492+(65535&(R=5*(65535&(P=(P^=$=(65535&($=($=(65535&$)*N+((($>>>16)*N&65535)<<16)&4294967295)<<15|$>>>17))*F+((($>>>16)*F&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(R>>>16)&65535)<<16);switch($=0,x){case 3:$^=(255&d.charCodeAt(H+2))<<16;case 2:$^=(255&d.charCodeAt(H+1))<<8;case 1:P^=$=(65535&($=($=(65535&($^=255&d.charCodeAt(H)))*N+((($>>>16)*N&65535)<<16)&4294967295)<<15|$>>>17))*F+((($>>>16)*F&65535)<<16)&4294967295}return P^=d.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0}),_i.exports),l=(un||(un=1,yi.exports=function(d,g){for(var x,E=d.length,P=g^E,R=0;E>=4;)x=1540483477*(65535&(x=255&d.charCodeAt(R)|(255&d.charCodeAt(++R))<<8|(255&d.charCodeAt(++R))<<16|(255&d.charCodeAt(++R))<<24))+((1540483477*(x>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),E-=4,++R;switch(E){case 3:P^=(255&d.charCodeAt(R+2))<<16;case 2:P^=(255&d.charCodeAt(R+1))<<8;case 1:P=1540483477*(65535&(P^=255&d.charCodeAt(R)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0}),yi.exports);return Kr.exports=f,Kr.exports.murmur3=f,Kr.exports.murmur2=l,Kr.exports}(),pa=m(Fi);class xs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,g,x){this.ids.push(No(l)),this.positions.push(d,g,x)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=No(l);let g=0,x=this.ids.length-1;for(;g<x;){const P=g+x>>1;this.ids[P]>=d?x=P:g=P+1}const E=[];for(;this.ids[g]===d;)E.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return E}static serialize(l,d){const g=new Float64Array(l.ids),x=new Uint32Array(l.positions);return co(g,x,0,g.length-1),d&&d.push(g.buffer,x.buffer),{ids:g,positions:x}}static deserialize(l){const d=new xs;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function No(f){const l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:pa(String(f))}function co(f,l,d,g){for(;d<g;){const x=f[d+g>>1];let E=d-1,P=g+1;for(;;){do E++;while(f[E]<x);do P--;while(f[P]>x);if(E>=P)break;Us(f,E,P),Us(l,3*E,3*P),Us(l,3*E+1,3*P+1),Us(l,3*E+2,3*P+2)}P-d<g-P?(co(f,l,d,P),d=P+1):(co(f,l,P+1,g),g=P)}}function Us(f,l,d){const g=f[l];f[l]=f[d],f[d]=g}Jt("FeaturePositionMap",xs);class $s{constructor(l,d){this.gl=l.gl,this.location=d}}class El extends $s{constructor(l,d){super(l,d),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class yc extends $s{constructor(l,d){super(l,d),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class as extends $s{constructor(l,d){super(l,d),this.current=kr.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const Bo=new Float32Array(16);function ss(f){return[In(255*f.r,255*f.g),In(255*f.b,255*f.a)]}class Vs{constructor(l,d,g){this.value=l,this.uniformNames=d.map(x=>`u_${x}`),this.type=g}setUniform(l,d,g){l.set(g.constantOr(this.value))}getBinding(l,d,g){return this.type==="color"?new as(l,d):new El(l,d)}}class yn{constructor(l,d){this.uniformNames=d.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=l.tlbr}setUniform(l,d,g,x){const E=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;E&&l.set(E)}getBinding(l,d,g){return g.substr(0,9)==="u_pattern"?new yc(l,d):new El(l,d)}}class vn{constructor(l,d,g,x){this.expression=l,this.type=g,this.maxValue=0,this.paintVertexAttributes=d.map(E=>({name:`a_${E}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new x}populatePaintArray(l,d,g,x,E){const P=this.paintVertexArray.length,R=this.expression.evaluate(new cn(0),d,{},x,[],E);this.paintVertexArray.resize(l),this._setPaintValue(P,l,R)}updatePaintArray(l,d,g,x){const E=this.expression.evaluate({zoom:0},g,x);this._setPaintValue(l,d,E)}_setPaintValue(l,d,g){if(this.type==="color"){const x=ss(g);for(let E=l;E<d;E++)this.paintVertexArray.emplace(E,x[0],x[1])}else{for(let x=l;x<d;x++)this.paintVertexArray.emplace(x,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(l,d,g,x,E,P){this.expression=l,this.uniformNames=d.map(R=>`u_${R}_t`),this.type=g,this.useIntegerZoom=x,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=d.map(R=>({name:`a_${R}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new P}populatePaintArray(l,d,g,x,E){const P=this.expression.evaluate(new cn(this.zoom),d,{},x,[],E),R=this.expression.evaluate(new cn(this.zoom+1),d,{},x,[],E),N=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(N,l,P,R)}updatePaintArray(l,d,g,x){const E=this.expression.evaluate({zoom:this.zoom},g,x),P=this.expression.evaluate({zoom:this.zoom+1},g,x);this._setPaintValue(l,d,E,P)}_setPaintValue(l,d,g,x){if(this.type==="color"){const E=ss(g),P=ss(x);for(let R=l;R<d;R++)this.paintVertexArray.emplace(R,E[0],E[1],P[0],P[1])}else{for(let E=l;E<d;E++)this.paintVertexArray.emplace(E,g,x);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(x))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d){const g=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,x=Ge(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);l.set(x)}getBinding(l,d,g){return new El(l,d)}}class hn{constructor(l,d,g,x,E,P){this.expression=l,this.type=d,this.useIntegerZoom=g,this.zoom=x,this.layerId=P,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(l,d,g){const x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(x,l,d.patterns&&d.patterns[this.layerId],g)}updatePaintArray(l,d,g,x,E){this._setPaintValues(l,d,g.patterns&&g.patterns[this.layerId],E)}_setPaintValues(l,d,g,x){if(!x||!g)return;const{min:E,mid:P,max:R}=g,N=x[E],F=x[P],$=x[R];if(N&&F&&$)for(let H=l;H<d;H++)this.zoomInPaintVertexArray.emplace(H,F.tl[0],F.tl[1],F.br[0],F.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],F.pixelRatio,N.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,F.tl[0],F.tl[1],F.br[0],F.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],F.pixelRatio,$.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,en.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,en.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ep{constructor(l,d,g){this.binders={},this._buffers=[];const x=[];for(const E in l.paint._values){if(!g(E))continue;const P=l.paint.get(E);if(!(P instanceof qa&&ha(P.property.specification)))continue;const R=A_(E,l.type),N=P.value,F=P.property.specification.type,$=P.property.useIntegerZoom,H=P.property.specification["property-type"],Q=H==="cross-faded"||H==="cross-faded-data-driven";if(N.kind==="constant")this.binders[E]=Q?new yn(N.value,R):new Vs(N.value,R,F),x.push(`/u_${E}`);else if(N.kind==="source"||Q){const te=vc(E,F,"source");this.binders[E]=Q?new hn(N,F,$,d,te,l.id):new vn(N,R,F,te),x.push(`/a_${E}`)}else{const te=vc(E,F,"composite");this.binders[E]=new Jn(N,R,F,$,d,te),x.push(`/z_${E}`)}}this.cacheKey=x.sort().join("")}getMaxValue(l){const d=this.binders[l];return d instanceof vn||d instanceof Jn?d.maxValue:0}populatePaintArrays(l,d,g,x,E){for(const P in this.binders){const R=this.binders[P];(R instanceof vn||R instanceof Jn||R instanceof hn)&&R.populatePaintArray(l,d,g,x,E)}}setConstantPatternPositions(l,d){for(const g in this.binders){const x=this.binders[g];x instanceof yn&&x.setConstantPatternPositions(l,d)}}updatePaintArrays(l,d,g,x,E){let P=!1;for(const R in l){const N=d.getPositions(R);for(const F of N){const $=g.feature(F.index);for(const H in this.binders){const Q=this.binders[H];if((Q instanceof vn||Q instanceof Jn||Q instanceof hn)&&Q.expression.isStateDependent===!0){const te=x.paint.get(H);Q.expression=te.value,Q.updatePaintArray(F.start,F.end,$,l[R],E),P=!0}}}}return P}defines(){const l=[];for(const d in this.binders){const g=this.binders[d];(g instanceof Vs||g instanceof yn)&&l.push(...g.uniformNames.map(x=>`#define HAS_UNIFORM_${x}`))}return l}getBinderAttributes(){const l=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof vn||g instanceof Jn)for(let x=0;x<g.paintVertexAttributes.length;x++)l.push(g.paintVertexAttributes[x].name);else if(g instanceof hn)for(let x=0;x<en.members.length;x++)l.push(en.members[x].name)}return l}getBinderUniforms(){const l=[];for(const d in this.binders){const g=this.binders[d];if(g instanceof Vs||g instanceof yn||g instanceof Jn)for(const x of g.uniformNames)l.push(x)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,d){const g=[];for(const x in this.binders){const E=this.binders[x];if(E instanceof Vs||E instanceof yn||E instanceof Jn){for(const P of E.uniformNames)if(d[P]){const R=E.getBinding(l,d[P],P);g.push({name:P,property:x,binding:R})}}}return g}setUniforms(l,d,g,x){for(const{name:E,property:P,binding:R}of d)this.binders[P].setUniform(R,x,g.get(P),E)}updatePaintBuffers(l){this._buffers=[];for(const d in this.binders){const g=this.binders[d];if(l&&g instanceof hn){const x=l.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(g instanceof vn||g instanceof Jn)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(l){for(const d in this.binders){const g=this.binders[d];(g instanceof vn||g instanceof Jn||g instanceof hn)&&g.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const d=this.binders[l];(d instanceof vn||d instanceof Jn||d instanceof hn)&&d.destroy()}}}class Ml{constructor(l,d,g=()=>!0){this.programConfigurations={};for(const x of l)this.programConfigurations[x.id]=new ep(x,d,g);this.needsUpload=!1,this._featureMap=new xs,this._bufferOffset=0}populatePaintArrays(l,d,g,x,E,P){for(const R in this.programConfigurations)this.programConfigurations[R].populatePaintArrays(l,d,x,E,P);d.id!==void 0&&this._featureMap.add(d.id,g,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,g,x){for(const E of g)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(l,this._featureMap,d,E,x)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function A_(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function vc(f,l,d){const g={color:{source:Rn,composite:A},number:{source:T,composite:Rn}},x=function(E){return{"line-pattern":{source:nt,composite:nt},"fill-pattern":{source:nt,composite:nt},"fill-extrusion-pattern":{source:nt,composite:nt}}[E]}(f);return x&&x[d]||g[l][d]}Jt("ConstantBinder",Vs),Jt("CrossFadedConstantBinder",yn),Jt("SourceExpressionBinder",vn),Jt("CrossFadedCompositeBinder",hn),Jt("CompositeExpressionBinder",Jn),Jt("ProgramConfiguration",ep,{omit:["_buffers"]}),Jt("ProgramConfigurationSet",Ml);const bc=Math.pow(2,14)-1,mh=-bc-1;function ta(f){const l=ot/f.extent,d=f.loadGeometry();for(let g=0;g<d.length;g++){const x=d[g];for(let E=0;E<x.length;E++){const P=x[E],R=Math.round(P.x*l),N=Math.round(P.y*l);P.x=Ge(R,mh,bc),P.y=Ge(N,mh,bc),(R<P.x||R>P.x+1||N<P.y||N>P.y+1)&&hr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function qs(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?ta(f):[]}}const If=-32768;function tp(f,l,d,g,x){f.emplaceBack(If+8*l+g,If+8*d+x)}class uo{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Oe,this.indexArray=new Ht,this.segments=new Tr,this.programConfigurations=new Ml(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){const x=this.layers[0],E=[];let P=null,R=!1,N=x.type==="heatmap";if(x.type==="circle"){const $=x;P=$.layout.get("circle-sort-key"),R=!P.isConstant(),N=N||$.paint.get("circle-pitch-alignment")==="map"}const F=N?d.subdivisionGranularity.circle:1;for(const{feature:$,id:H,index:Q,sourceLayerIndex:te}of l){const ie=this.layers[0]._featureFilter.needGeometry,oe=qs($,ie);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),oe,g))continue;const me=R?P.evaluate(oe,{},g):void 0,we={id:H,properties:$.properties,type:$.type,sourceLayerIndex:te,index:Q,geometry:ie?oe.geometry:ta($),patterns:{},sortKey:me};E.push(we)}R&&E.sort(($,H)=>$.sortKey-H.sortKey);for(const $ of E){const{geometry:H,index:Q,sourceLayerIndex:te}=$,ie=l[Q].feature;this.addFeature($,H,Q,g,F),d.featureIndex.insert(ie,H,Q,te,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ir),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,g,x,E=1){let P;switch(E){case 1:P=[0,7];break;case 3:P=[0,2,5,7];break;case 5:P=[0,1,3,4,6,7];break;case 7:P=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${E}; valid values are 1, 3, 5, 7.`)}const R=P.length;for(const N of d)for(const F of N){const $=F.x,H=F.y;if($<0||$>=ot||H<0||H>=ot)continue;const Q=this.segments.prepareSegment(R*R,this.layoutVertexArray,this.indexArray,l.sortKey),te=Q.vertexLength;for(let ie=0;ie<R;ie++)for(let oe=0;oe<R;oe++)tp(this.layoutVertexArray,$,H,P[oe],P[ie]);for(let ie=0;ie<R-1;ie++)for(let oe=0;oe<R-1;oe++){const me=te+ie*R+oe,we=te+(ie+1)*R+oe;this.indexArray.emplaceBack(me,we+1,me+1),this.indexArray.emplaceBack(me,we,we+1)}Q.vertexLength+=R*R,Q.primitiveLength+=(R-1)*(R-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,{},x)}}function Of(f,l){for(let d=0;d<f.length;d++)if(xc(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(xc(f,l[d]))return!0;return!!xm(f,l)}function Ha(f,l,d){return!!xc(f,l)||!!Fo(l,f,d)}function Lo(f,l){if(f.length===1)return rp(l,f[0]);for(let d=0;d<l.length;d++){const g=l[d];for(let x=0;x<g.length;x++)if(xc(f,g[x]))return!0}for(let d=0;d<f.length;d++)if(rp(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(xm(f,l[d]))return!0;return!1}function fu(f,l,d){if(f.length>1){if(xm(f,l))return!0;for(let g=0;g<l.length;g++)if(Fo(l[g],f,d))return!0}for(let g=0;g<f.length;g++)if(Fo(f[g],l,d))return!0;return!1}function xm(f,l){if(f.length===0||l.length===0)return!1;for(let d=0;d<f.length-1;d++){const g=f[d],x=f[d+1];for(let E=0;E<l.length-1;E++)if(du(g,x,l[E],l[E+1]))return!0}return!1}function du(f,l,d,g){return Vt(f,d,g)!==Vt(l,d,g)&&Vt(f,l,d)!==Vt(f,l,g)}function Fo(f,l,d){const g=d*d;if(l.length===1)return f.distSqr(l[0])<g;for(let x=1;x<l.length;x++)if(zi(f,l[x-1],l[x])<g)return!0;return!1}function zi(f,l,d){const g=l.distSqr(d);if(g===0)return f.distSqr(l);const x=((f.x-l.x)*(d.x-l.x)+(f.y-l.y)*(d.y-l.y))/g;return f.distSqr(x<0?l:x>1?d:d.sub(l)._mult(x)._add(l))}function rp(f,l){for(let d=0;d<f.length;d++)if(xc(f[d],l))return!0;return!1}function xc(f,l){let d=!1;for(let g=0,x=f.length-1;g<f.length;x=g++){const E=f[g],P=f[x];E.y>l.y!=P.y>l.y&&l.x<(P.x-E.x)*(l.y-E.y)/(P.y-E.y)+E.x&&(d=!d)}return d}function E_(f,l,d){const g=d[0],x=d[2];if(f.x<g.x&&l.x<g.x||f.x>x.x&&l.x>x.x||f.y<g.y&&l.y<g.y||f.y>x.y&&l.y>x.y)return!1;const E=Vt(f,l,d[0]);return E!==Vt(f,l,d[1])||E!==Vt(f,l,d[2])||E!==Vt(f,l,d[3])}function kf(f,l,d){const g=l.paint.get(f).value;return g.kind==="constant"?g.value:d.programConfigurations.get(l.id).getMaxValue(f)}function np(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function Pl(f,l,d,g,x){if(!l[0]&&!l[1])return f;const E=z.convert(l)._mult(x);d==="viewport"&&E._rotate(-g);const P=[];for(let R=0;R<f.length;R++)P.push(f[R].sub(E));return P}let ip,M_;Jt("CircleBucket",uo,{omit:["layers"]});var tb={get paint(){return M_=M_||new da({"circle-radius":new xr(fe.paint_circle["circle-radius"]),"circle-color":new xr(fe.paint_circle["circle-color"]),"circle-blur":new xr(fe.paint_circle["circle-blur"]),"circle-opacity":new xr(fe.paint_circle["circle-opacity"]),"circle-translate":new ur(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new ur(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ur(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ur(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xr(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xr(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xr(fe.paint_circle["circle-stroke-opacity"])})},get layout(){return ip=ip||new da({"circle-sort-key":new xr(fe.layout_circle["circle-sort-key"])})}};class rb extends Ji{constructor(l){super(l,tb)}createBucket(l){return new uo(l)}queryRadius(l){const d=l;return kf("circle-radius",this,d)+kf("circle-stroke-width",this,d)+np(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:x,transform:E,pixelsToTileUnits:P,unwrappedTileID:R,getElevation:N}){const F=Pl(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-E.bearingInRadians,P),$=this.paint.get("circle-radius").evaluate(d,g)+this.paint.get("circle-stroke-width").evaluate(d,g),H=this.paint.get("circle-pitch-alignment")==="map",Q=H?F:function(ie,oe,me,we){return ie.map(Fe=>ap(Fe,oe,me,we))}(F,E,R,N),te=H?$*P:$;for(const ie of x)for(const oe of ie){const me=H?oe:ap(oe,E,R,N);let we=te;const Fe=E.projectTileCoordinates(oe.x,oe.y,R,N).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=Fe/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=E.cameraToCenterDistance/Fe),Ha(Q,me,we))return!0}return!1}}function ap(f,l,d,g){const x=l.projectTileCoordinates(f.x,f.y,d,g).point;return new z((.5*x.x+.5)*l.width,(.5*-x.y+.5)*l.height)}class P_ extends uo{}let wm;Jt("HeatmapBucket",P_,{omit:["layers"]});var nb={get paint(){return wm=wm||new da({"heatmap-radius":new xr(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xr(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ur(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cf(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ur(fe.paint_heatmap["heatmap-opacity"])})}};function Tm(f,{width:l,height:d},g,x){if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==l*d*g)throw new RangeError(`mismatched image size. expected: ${x.length} but got: ${l*d*g}`)}else x=new Uint8Array(l*d*g);return f.width=l,f.height=d,f.data=x,f}function ib(f,{width:l,height:d},g){if(l===f.width&&d===f.height)return;const x=Tm({},{width:l,height:d},g);Sm(f,x,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,d)},g),f.width=l,f.height=d,f.data=x.data}function Sm(f,l,d,g,x,E){if(x.width===0||x.height===0)return l;if(x.width>f.width||x.height>f.height||d.x>f.width-x.width||d.y>f.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>l.width||x.height>l.height||g.x>l.width-x.width||g.y>l.height-x.height)throw new RangeError("out of range destination coordinates for image copy");const P=f.data,R=l.data;if(P===R)throw new Error("srcData equals dstData, so image is already copied");for(let N=0;N<x.height;N++){const F=((d.y+N)*f.width+d.x)*E,$=((g.y+N)*l.width+g.x)*E;for(let H=0;H<x.width*E;H++)R[$+H]=P[F+H]}return l}class vi{constructor(l,d){Tm(this,l,1,d)}resize(l){ib(this,l,1)}clone(){return new vi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,x,E){Sm(l,d,g,x,E,1)}}class bn{constructor(l,d){Tm(this,l,4,d)}resize(l){ib(this,l,4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new bn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,x,E){Sm(l,d,g,x,E,4)}}function C_(f){const l={},d=f.resolution||256,g=f.clips?f.clips.length:1,x=f.image||new bn({width:d,height:g});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const E=(P,R,N)=>{l[f.evaluationKey]=N;const F=f.expression.evaluate(l);x.data[P+R+0]=Math.floor(255*F.r/F.a),x.data[P+R+1]=Math.floor(255*F.g/F.a),x.data[P+R+2]=Math.floor(255*F.b/F.a),x.data[P+R+3]=Math.floor(255*F.a)};if(f.clips)for(let P=0,R=0;P<g;++P,R+=4*d)for(let N=0,F=0;N<d;N++,F+=4){const $=N/(d-1),{start:H,end:Q}=f.clips[P];E(R,F,H*(1-$)+Q*$)}else for(let P=0,R=0;P<d;P++,R+=4)E(0,R,P/(d-1));return x}Jt("AlphaImage",vi),Jt("RGBAImage",bn);const Am="big-fb";class ab extends Ji{createBucket(l){return new P_(l)}constructor(l){super(l,nb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=C_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Am)&&this.heatmapFbos.delete(Am)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let R_;var sb={get paint(){return R_=R_||new da({"hillshade-illumination-direction":new ur(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ur(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ur(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ur(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ur(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ur(fe.paint_hillshade["hillshade-accent-color"])})}};class Em extends Ji{constructor(l){super(l,sb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const I_=Vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ob}=I_;function Mm(f,l,d){const g=d.patternDependencies;let x=!1;for(const E of l){const P=E.paint.get(`${f}-pattern`);P.isConstant()||(x=!0);const R=P.constantOr(null);R&&(x=!0,g[R.to]=!0,g[R.from]=!0)}return x}function Pm(f,l,d,g,x){const E=x.patternDependencies;for(const P of l){const R=P.paint.get(`${f}-pattern`).value;if(R.kind!=="constant"){let N=R.evaluate({zoom:g-1},d,{},x.availableImages),F=R.evaluate({zoom:g},d,{},x.availableImages),$=R.evaluate({zoom:g+1},d,{},x.availableImages);N=N&&N.name?N.name:N,F=F&&F.name?F.name:F,$=$&&$.name?$.name:$,E[N]=!0,E[F]=!0,E[$]=!0,d.patterns[P.id]={min:N,mid:F,max:$}}}return d}function Cm(f,l,d,g,x){let E;if(x===function(P,R,N,F){let $=0;for(let H=R,Q=N-F;H<N;H+=F)$+=(P[Q]-P[H])*(P[H+1]+P[Q+1]),Q=H;return $}(f,l,d,g)>0)for(let P=l;P<d;P+=g)E=Bf(P/g|0,f[P],f[P+1],E);else for(let P=d-g;P>=l;P-=g)E=Bf(P/g|0,f[P],f[P+1],E);return E&&Sc(E,E.next)&&(ho(E),E=E.next),E}function wc(f,l){if(!f)return f;l||(l=f);let d,g=f;do if(d=!1,g.steiner||!Sc(g,g.next)&&ii(g.prev,g,g.next)!==0)g=g.next;else{if(ho(g),g=l=g.prev,g===g.next)break;d=!0}while(d||g!==l);return l}function gh(f,l,d,g,x,E,P){if(!f)return;!P&&E&&function(N,F,$,H){let Q=N;do Q.z===0&&(Q.z=zo(Q.x,Q.y,F,$,H)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==N);Q.prevZ.nextZ=null,Q.prevZ=null,function(te){let ie,oe=1;do{let me,we=te;te=null;let Fe=null;for(ie=0;we;){ie++;let Ee=we,ee=0;for(let Re=0;Re<oe&&(ee++,Ee=Ee.nextZ,Ee);Re++);let pe=oe;for(;ee>0||pe>0&&Ee;)ee!==0&&(pe===0||!Ee||we.z<=Ee.z)?(me=we,we=we.nextZ,ee--):(me=Ee,Ee=Ee.nextZ,pe--),Fe?Fe.nextZ=me:te=me,me.prevZ=Fe,Fe=me;we=Ee}Fe.nextZ=null,oe*=2}while(ie>1)}(Q)}(f,g,x,E);let R=f;for(;f.prev!==f.next;){const N=f.prev,F=f.next;if(E?O_(f,g,x,E):lb(f))l.push(N.i,f.i,F.i),ho(f),f=F.next,R=F.next;else if((f=F)===R){P?P===1?gh(f=Rm(wc(f),l),l,d,g,x,E,2):P===2&&k_(f,l,d,g,x,E):gh(wc(f),l,d,g,x,E,1);break}}}function lb(f){const l=f.prev,d=f,g=f.next;if(ii(l,d,g)>=0)return!1;const x=l.x,E=d.x,P=g.x,R=l.y,N=d.y,F=g.y,$=Math.min(x,E,P),H=Math.min(R,N,F),Q=Math.max(x,E,P),te=Math.max(R,N,F);let ie=g.next;for(;ie!==l;){if(ie.x>=$&&ie.x<=Q&&ie.y>=H&&ie.y<=te&&Df(x,R,E,N,P,F,ie.x,ie.y)&&ii(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function O_(f,l,d,g){const x=f.prev,E=f,P=f.next;if(ii(x,E,P)>=0)return!1;const R=x.x,N=E.x,F=P.x,$=x.y,H=E.y,Q=P.y,te=Math.min(R,N,F),ie=Math.min($,H,Q),oe=Math.max(R,N,F),me=Math.max($,H,Q),we=zo(te,ie,l,d,g),Fe=zo(oe,me,l,d,g);let Ee=f.prevZ,ee=f.nextZ;for(;Ee&&Ee.z>=we&&ee&&ee.z<=Fe;){if(Ee.x>=te&&Ee.x<=oe&&Ee.y>=ie&&Ee.y<=me&&Ee!==x&&Ee!==P&&Df(R,$,N,H,F,Q,Ee.x,Ee.y)&&ii(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,ee.x>=te&&ee.x<=oe&&ee.y>=ie&&ee.y<=me&&ee!==x&&ee!==P&&Df(R,$,N,H,F,Q,ee.x,ee.y)&&ii(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;Ee&&Ee.z>=we;){if(Ee.x>=te&&Ee.x<=oe&&Ee.y>=ie&&Ee.y<=me&&Ee!==x&&Ee!==P&&Df(R,$,N,H,F,Q,Ee.x,Ee.y)&&ii(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;ee&&ee.z<=Fe;){if(ee.x>=te&&ee.x<=oe&&ee.y>=ie&&ee.y<=me&&ee!==x&&ee!==P&&Df(R,$,N,H,F,Q,ee.x,ee.y)&&ii(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Rm(f,l){let d=f;do{const g=d.prev,x=d.next.next;!Sc(g,x)&&Nf(g,d,d.next,x)&&sp(g,x)&&sp(x,g)&&(l.push(g.i,d.i,x.i),ho(d),ho(d.next),d=f=x),d=d.next}while(d!==f);return wc(d)}function k_(f,l,d,g,x,E){let P=f;do{let R=P.next.next;for(;R!==P.prev;){if(P.i!==R.i&&Tc(P,R)){let N=B_(P,R);return P=wc(P,P.next),N=wc(N,N.next),gh(P,l,d,g,x,E,0),void gh(N,l,d,g,x,E,0)}R=R.next}P=P.next}while(P!==f)}function cb(f,l){let d=f.x-l.x;return d===0&&(d=f.y-l.y,d===0)&&(d=(f.next.y-f.y)/(f.next.x-f.x)-(l.next.y-l.y)/(l.next.x-l.x)),d}function D_(f,l){const d=function(x,E){let P=E;const R=x.x,N=x.y;let F,$=-1/0;if(Sc(x,P))return P;do{if(Sc(x,P.next))return P.next;if(N<=P.y&&N>=P.next.y&&P.next.y!==P.y){const oe=P.x+(N-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(oe<=R&&oe>$&&($=oe,F=P.x<P.next.x?P:P.next,oe===R))return F}P=P.next}while(P!==E);if(!F)return null;const H=F,Q=F.x,te=F.y;let ie=1/0;P=F;do{if(R>=P.x&&P.x>=Q&&R!==P.x&&hb(N<te?R:$,N,Q,te,N<te?$:R,N,P.x,P.y)){const oe=Math.abs(N-P.y)/(R-P.x);sp(P,x)&&(oe<ie||oe===ie&&(P.x>F.x||P.x===F.x&&ub(F,P)))&&(F=P,ie=oe)}P=P.next}while(P!==H);return F}(f,l);if(!d)return l;const g=B_(d,f);return wc(g,g.next),wc(d,d.next)}function ub(f,l){return ii(f.prev,f,l.prev)<0&&ii(l.next,f,f.next)<0}function zo(f,l,d,g,x){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-d)*x|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-g)*x|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function N_(f){let l=f,d=f;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==f);return d}function hb(f,l,d,g,x,E,P,R){return(x-P)*(l-R)>=(f-P)*(E-R)&&(f-P)*(g-R)>=(d-P)*(l-R)&&(d-P)*(E-R)>=(x-P)*(g-R)}function Df(f,l,d,g,x,E,P,R){return!(f===P&&l===R)&&hb(f,l,d,g,x,E,P,R)}function Tc(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!function(d,g){let x=d;do{if(x.i!==d.i&&x.next.i!==d.i&&x.i!==g.i&&x.next.i!==g.i&&Nf(x,x.next,d,g))return!0;x=x.next}while(x!==d);return!1}(f,l)&&(sp(f,l)&&sp(l,f)&&function(d,g){let x=d,E=!1;const P=(d.x+g.x)/2,R=(d.y+g.y)/2;do x.y>R!=x.next.y>R&&x.next.y!==x.y&&P<(x.next.x-x.x)*(R-x.y)/(x.next.y-x.y)+x.x&&(E=!E),x=x.next;while(x!==d);return E}(f,l)&&(ii(f.prev,f,l.prev)||ii(f,l.prev,l))||Sc(f,l)&&ii(f.prev,f,f.next)>0&&ii(l.prev,l,l.next)>0)}function ii(f,l,d){return(l.y-f.y)*(d.x-l.x)-(l.x-f.x)*(d.y-l.y)}function Sc(f,l){return f.x===l.x&&f.y===l.y}function Nf(f,l,d,g){const x=Im(ii(f,l,d)),E=Im(ii(f,l,g)),P=Im(ii(d,g,f)),R=Im(ii(d,g,l));return x!==E&&P!==R||!(x!==0||!qn(f,d,l))||!(E!==0||!qn(f,g,l))||!(P!==0||!qn(d,f,g))||!(R!==0||!qn(d,l,g))}function qn(f,l,d){return l.x<=Math.max(f.x,d.x)&&l.x>=Math.min(f.x,d.x)&&l.y<=Math.max(f.y,d.y)&&l.y>=Math.min(f.y,d.y)}function Im(f){return f>0?1:f<0?-1:0}function sp(f,l){return ii(f.prev,f,f.next)<0?ii(f,l,f.next)>=0&&ii(f,f.prev,l)>=0:ii(f,l,f.prev)<0||ii(f,f.next,l)<0}function B_(f,l){const d=Om(f.i,f.x,f.y),g=Om(l.i,l.x,l.y),x=f.next,E=l.prev;return f.next=l,l.prev=f,d.next=x,x.prev=d,g.next=d,d.prev=g,E.next=g,g.prev=E,g}function Bf(f,l,d,g){const x=Om(f,l,d);return g?(x.next=g.next,x.prev=g,g.next.prev=x,g.next=x):(x.prev=x,x.next=x),x}function ho(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function Om(f,l,d){return{i:f,x:l,y:d,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _h{constructor(l,d){if(d>l)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=l,this._minGranularity=d}getGranularityForZoomLevel(l){return Math.max(Math.floor(this._baseZoomGranularity/(1<<l)),this._minGranularity,1)}}class pu{constructor(l){this.fill=l.fill,this.line=l.line,this.tile=l.tile,this.stencil=l.stencil,this.circle=l.circle}}pu.noSubdivision=new pu({fill:new _h(0,0),line:new _h(0,0),tile:new _h(0,0),stencil:new _h(0,0),circle:1}),Jt("SubdivisionGranularityExpression",_h),Jt("SubdivisionGranularitySetting",pu);const os=-32768,Lf=32767;class L_{constructor(l,d){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=l,this._granularityCellSize=ot/l,this._canonical=d}_getKey(l,d){return(l+=32768)<<16|(d+=32768)<<0}_vertexToIndex(l,d){if(l<-32768||d<-32768||l>32767||d>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const g=0|Math.round(l),x=0|Math.round(d),E=this._getKey(g,x);if(this._vertexDictionary.has(E))return this._vertexDictionary.get(E);const P=this._vertexBuffer.length/2;return this._vertexDictionary.set(E,P),this._vertexBuffer.push(g,x),P}_subdivideTrianglesScanline(l){if(this._granularity<2)return function(x,E){const P=[];for(let R=0;R<E.length;R+=3){const N=E[R],F=E[R+1],$=E[R+2],H=x[2*N],Q=x[2*N+1];(x[2*F]-H)*(x[2*$+1]-Q)-(x[2*F+1]-Q)*(x[2*$]-H)>0?(P.push(N),P.push($),P.push(F)):(P.push(N),P.push(F),P.push($))}return P}(this._vertexBuffer,l);const d=[],g=l.length;for(let x=0;x<g;x+=3){const E=[l[x+0],l[x+1],l[x+2]],P=[this._vertexBuffer[2*l[x+0]+0],this._vertexBuffer[2*l[x+0]+1],this._vertexBuffer[2*l[x+1]+0],this._vertexBuffer[2*l[x+1]+1],this._vertexBuffer[2*l[x+2]+0],this._vertexBuffer[2*l[x+2]+1]];let R=1/0,N=1/0,F=-1/0,$=-1/0;for(let oe=0;oe<3;oe++){const me=P[2*oe],we=P[2*oe+1];R=Math.min(R,me),F=Math.max(F,me),N=Math.min(N,we),$=Math.max($,we)}if(R===F||N===$)continue;const H=Math.floor(R/this._granularityCellSize),Q=Math.ceil(F/this._granularityCellSize),te=Math.floor(N/this._granularityCellSize),ie=Math.ceil($/this._granularityCellSize);if(H!==Q||te!==ie)for(let oe=te;oe<ie;oe++){const me=this._scanlineGenerateVertexRingForCellRow(oe,P,E);z_(this._vertexBuffer,me,d)}else d.push(...E)}return d}_scanlineGenerateVertexRingForCellRow(l,d,g){const x=l*this._granularityCellSize,E=x+this._granularityCellSize,P=[];for(let R=0;R<3;R++){const N=d[2*R],F=d[2*R+1],$=d[2*(R+1)%6],H=d[(2*(R+1)+1)%6],Q=d[2*(R+2)%6],te=d[(2*(R+2)+1)%6],ie=$-N,oe=H-F,me=ie===0,we=oe===0,Fe=(x-F)/oe,Ee=(E-F)/oe,ee=Math.min(Fe,Ee),pe=Math.max(Fe,Ee);if(!we&&(ee>=1||pe<=0)||we&&(F<x||F>E)){H>=x&&H<=E&&P.push(g[(R+1)%3]);continue}!we&&ee>0&&P.push(this._vertexToIndex(N+ie*ee,F+oe*ee));const Re=N+ie*Math.max(ee,0),st=N+ie*Math.min(pe,1);me||this._generateIntraEdgeVertices(P,N,F,$,H,Re,st),!we&&pe<1&&P.push(this._vertexToIndex(N+ie*pe,F+oe*pe)),(we||H>=x&&H<=E)&&P.push(g[(R+1)%3]),!we&&(H<=x||H>=E)&&this._generateInterEdgeVertices(P,N,F,$,H,Q,te,st,x,E)}return P}_generateIntraEdgeVertices(l,d,g,x,E,P,R){const N=x-d,F=E-g,$=F===0,H=$?Math.min(d,x):Math.min(P,R),Q=$?Math.max(d,x):Math.max(P,R),te=Math.floor(H/this._granularityCellSize)+1,ie=Math.ceil(Q/this._granularityCellSize)-1;if($?d<x:P<R)for(let oe=te;oe<=ie;oe++){const me=oe*this._granularityCellSize;l.push(this._vertexToIndex(me,g+F*(me-d)/N))}else for(let oe=ie;oe>=te;oe--){const me=oe*this._granularityCellSize;l.push(this._vertexToIndex(me,g+F*(me-d)/N))}}_generateInterEdgeVertices(l,d,g,x,E,P,R,N,F,$){const H=E-g,Q=P-x,te=R-E,ie=(F-E)/te,oe=($-E)/te,me=Math.min(ie,oe),we=Math.max(ie,oe),Fe=x+Q*me;let Ee=Math.floor(Math.min(Fe,N)/this._granularityCellSize)+1,ee=Math.ceil(Math.max(Fe,N)/this._granularityCellSize)-1,pe=N<Fe;const Re=te===0;if(Re&&(R===F||R===$))return;if(Re||me>=1||we<=0){const Nt=g-R,dt=P+(d-P)*Math.min((F-R)/Nt,($-R)/Nt);Ee=Math.floor(Math.min(dt,N)/this._granularityCellSize)+1,ee=Math.ceil(Math.max(dt,N)/this._granularityCellSize)-1,pe=N<dt}const st=H>0?$:F;if(pe)for(let Nt=Ee;Nt<=ee;Nt++)l.push(this._vertexToIndex(Nt*this._granularityCellSize,st));else for(let Nt=ee;Nt>=Ee;Nt--)l.push(this._vertexToIndex(Nt*this._granularityCellSize,st))}_generateOutline(l){const d=[];for(const g of l){const x=Ac(g,this._granularity,!0),E=this._pointArrayToIndices(x),P=[];for(let R=1;R<E.length;R++)P.push(E[R-1]),P.push(E[R]);d.push(P)}return d}_handlePoles(l){let d=!1,g=!1;this._canonical&&(this._canonical.y===0&&(d=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(d||g)&&this._fillPoles(l,d,g)}_ensureNoPoleVertices(){const l=this._vertexBuffer;for(let d=0;d<l.length;d+=2){const g=l[d+1];g===os&&(l[d+1]=-32767),g===Lf&&(l[d+1]=32766)}}_generatePoleQuad(l,d,g,x,E,P){x>E!=(P===os)?(l.push(d),l.push(g),l.push(this._vertexToIndex(x,P)),l.push(g),l.push(this._vertexToIndex(E,P)),l.push(this._vertexToIndex(x,P))):(l.push(g),l.push(d),l.push(this._vertexToIndex(x,P)),l.push(this._vertexToIndex(E,P)),l.push(g),l.push(this._vertexToIndex(x,P)))}_fillPoles(l,d,g){const x=this._vertexBuffer,E=ot,P=l.length;for(let R=2;R<P;R+=3){const N=l[R-2],F=l[R-1],$=l[R],H=x[2*N],Q=x[2*N+1],te=x[2*F],ie=x[2*F+1],oe=x[2*$],me=x[2*$+1];d&&(Q===0&&ie===0&&this._generatePoleQuad(l,N,F,H,te,os),ie===0&&me===0&&this._generatePoleQuad(l,F,$,te,oe,os),me===0&&Q===0&&this._generatePoleQuad(l,$,N,oe,H,os)),g&&(Q===E&&ie===E&&this._generatePoleQuad(l,N,F,H,te,Lf),ie===E&&me===E&&this._generatePoleQuad(l,F,$,te,oe,Lf),me===E&&Q===E&&this._generatePoleQuad(l,$,N,oe,H,Lf))}}_initializeVertices(l){for(let d=0;d<l.length;d+=2)this._vertexToIndex(l[d],l[d+1])}subdividePolygonInternal(l,d){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:g,holeIndices:x}=function(R){const N=[],F=[];for(const $ of R)if($.length!==0){$!==R[0]&&N.push(F.length/2);for(let H=0;H<$.length;H++)F.push($[H].x),F.push($[H].y)}return{flattened:F,holeIndices:N}}(l);let E;this._initializeVertices(g);try{const R=function(F,$,H=2){const Q=$&&$.length,te=Q?$[0]*H:F.length;let ie=Cm(F,0,te,H,!0);const oe=[];if(!ie||ie.next===ie.prev)return oe;let me,we,Fe;if(Q&&(ie=function(Ee,ee,pe,Re){const st=[];for(let Nt=0,dt=ee.length;Nt<dt;Nt++){const wt=Cm(Ee,ee[Nt]*Re,Nt<dt-1?ee[Nt+1]*Re:Ee.length,Re,!1);wt===wt.next&&(wt.steiner=!0),st.push(N_(wt))}st.sort(cb);for(let Nt=0;Nt<st.length;Nt++)pe=D_(st[Nt],pe);return pe}(F,$,ie,H)),F.length>80*H){me=1/0,we=1/0;let Ee=-1/0,ee=-1/0;for(let pe=H;pe<te;pe+=H){const Re=F[pe],st=F[pe+1];Re<me&&(me=Re),st<we&&(we=st),Re>Ee&&(Ee=Re),st>ee&&(ee=st)}Fe=Math.max(Ee-me,ee-we),Fe=Fe!==0?32767/Fe:0}return gh(ie,oe,H,me,we,Fe,0),oe}(g,x),N=this._convertIndices(g,R);E=this._subdivideTrianglesScanline(N)}catch(R){console.error(R)}let P=[];return d&&(P=this._generateOutline(l)),this._ensureNoPoleVertices(),this._handlePoles(E),{verticesFlattened:this._vertexBuffer,indicesTriangles:E,indicesLineList:P}}_convertIndices(l,d){const g=[];for(let x=0;x<d.length;x++)g.push(this._vertexToIndex(l[2*d[x]],l[2*d[x]+1]));return g}_pointArrayToIndices(l){const d=[];for(let g=0;g<l.length;g++){const x=l[g];d.push(this._vertexToIndex(x.x,x.y))}return d}}function F_(f,l,d,g=!0){return new L_(d,l).subdividePolygonInternal(f,g)}function Ac(f,l,d=!1){if(!f||f.length<1)return[];if(f.length<2)return[];const g=f[0],x=f[f.length-1],E=d&&(g.x!==x.x||g.y!==x.y);if(l<2)return E?[...f,f[0]]:[...f];const P=Math.floor(ot/l),R=[];R.push(new z(f[0].x,f[0].y));const N=f.length,F=E?N:N-1;for(let $=0;$<F;$++){const H=f[$],Q=$<N-1?f[$+1]:f[0],te=H.x,ie=H.y,oe=Q.x,me=Q.y,we=te!==oe,Fe=ie!==me;if(!we&&!Fe)continue;const Ee=oe-te,ee=me-ie,pe=Math.abs(Ee),Re=Math.abs(ee);let st=te,Nt=ie;for(;;){const wt=Ee>0?(Math.floor(st/P)+1)*P:(Math.ceil(st/P)-1)*P,$t=ee>0?(Math.floor(Nt/P)+1)*P:(Math.ceil(Nt/P)-1)*P,Lt=Math.abs(st-wt),qt=Math.abs(Nt-$t),Et=Math.abs(st-oe),ir=Math.abs(Nt-me),br=we?Lt/pe:Number.POSITIVE_INFINITY,mr=Fe?qt/Re:Number.POSITIVE_INFINITY;if((Et<=Lt||!we)&&(ir<=qt||!Fe))break;if(br<mr&&we||!Fe){st=wt,Nt+=ee*br;const cr=new z(st,Math.round(Nt));R[R.length-1].x===cr.x&&R[R.length-1].y===cr.y||R.push(cr)}else{st+=Ee*mr,Nt=$t;const cr=new z(Math.round(st),Nt);R[R.length-1].x===cr.x&&R[R.length-1].y===cr.y||R.push(cr)}}const dt=new z(oe,me);R[R.length-1].x===dt.x&&R[R.length-1].y===dt.y||R.push(dt)}return R}function z_(f,l,d){if(l.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,x=f[2*l[0]];for(let N=1;N<l.length;N++){const F=f[2*l[N]];F<x&&(x=F,g=N)}const E=l.length;let P=g,R=(P+1)%E;for(;;){const N=P-1>=0?P-1:E-1,F=(R+1)%E,$=f[2*l[N]],H=f[2*l[F]],Q=f[2*l[P]],te=f[2*l[P]+1],ie=f[2*l[R]+1];let oe=!1;if($<H)oe=!0;else if($>H)oe=!1;else{const me=ie-te,we=-(f[2*l[R]]-Q),Fe=te<ie?1:-1;(($-Q)*me+(f[2*l[N]+1]-te)*we)*Fe>((H-Q)*me+(f[2*l[F]+1]-te)*we)*Fe&&(oe=!0)}if(oe){const me=l[N],we=l[P],Fe=l[R];me!==we&&me!==Fe&&we!==Fe&&d.push(Fe,we,me),P--,P<0&&(P=E-1)}else{const me=l[F],we=l[P],Fe=l[R];me!==we&&me!==Fe&&we!==Fe&&d.push(Fe,we,me),R++,R>=E&&(R=0)}if(N===F)break}}function op(f,l,d,g,x,E,P,R,N){const F=x.length/2,$=P&&R&&N;if(F<Tr.MAX_VERTEX_ARRAY_LENGTH){const H=l.prepareSegment(F,d,g),Q=H.vertexLength;for(let oe=0;oe<E.length;oe+=3)g.emplaceBack(Q+E[oe],Q+E[oe+1],Q+E[oe+2]);let te,ie;H.vertexLength+=F,H.primitiveLength+=E.length/3,$&&(ie=P.prepareSegment(F,d,R),te=ie.vertexLength,ie.vertexLength+=F);for(let oe=0;oe<x.length;oe+=2)f(x[oe],x[oe+1]);if($)for(let oe=0;oe<N.length;oe++){const me=N[oe];for(let we=1;we<me.length;we+=2)R.emplaceBack(te+me[we-1],te+me[we]);ie.primitiveLength+=me.length/2}}else(function(H,Q,te,ie,oe,me){const we=[];for(let Re=0;Re<ie.length/2;Re++)we.push(-1);const Fe={count:0};let Ee=0,ee=H.getOrCreateLatestSegment(Q,te),pe=ee.vertexLength;for(let Re=2;Re<oe.length;Re+=3){const st=oe[Re-2],Nt=oe[Re-1],dt=oe[Re];let wt=we[st]<Ee,$t=we[Nt]<Ee,Lt=we[dt]<Ee;ee.vertexLength+((wt?1:0)+($t?1:0)+(Lt?1:0))>Tr.MAX_VERTEX_ARRAY_LENGTH&&(ee=H.createNewSegment(Q,te),Ee=Fe.count,wt=!0,$t=!0,Lt=!0,pe=0);const qt=Ff(we,ie,me,Fe,st,wt,ee),Et=Ff(we,ie,me,Fe,Nt,$t,ee),ir=Ff(we,ie,me,Fe,dt,Lt,ee);te.emplaceBack(pe+qt-Ee,pe+Et-Ee,pe+ir-Ee),ee.primitiveLength++}})(l,d,g,x,E,f),$&&function(H,Q,te,ie,oe,me){const we=[];for(let Re=0;Re<ie.length/2;Re++)we.push(-1);const Fe={count:0};let Ee=0,ee=H.getOrCreateLatestSegment(Q,te),pe=ee.vertexLength;for(let Re=0;Re<oe.length;Re++){const st=oe[Re];for(let Nt=1;Nt<oe[Re].length;Nt+=2){const dt=st[Nt-1],wt=st[Nt];let $t=we[dt]<Ee,Lt=we[wt]<Ee;ee.vertexLength+(($t?1:0)+(Lt?1:0))>Tr.MAX_VERTEX_ARRAY_LENGTH&&(ee=H.createNewSegment(Q,te),Ee=Fe.count,$t=!0,Lt=!0,pe=0);const qt=Ff(we,ie,me,Fe,dt,$t,ee),Et=Ff(we,ie,me,Fe,wt,Lt,ee);te.emplaceBack(pe+qt-Ee,pe+Et-Ee),ee.primitiveLength++}}}(P,d,R,x,N,f),l.forceNewSegmentOnNextPrepare(),P==null||P.forceNewSegmentOnNextPrepare()}function Ff(f,l,d,g,x,E,P){if(E){const R=g.count;return d(l[2*x],l[2*x+1]),f[x]=g.count,g.count++,P.vertexLength++,R}return f[x]}class jo{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new Ht,this.indexArray2=new Rt,this.programConfigurations=new Ml(l.layers,l.zoom),this.segments=new Tr,this.segments2=new Tr,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=Mm("fill",this.layers,d);const x=this.layers[0].layout.get("fill-sort-key"),E=!x.isConstant(),P=[];for(const{feature:R,id:N,index:F,sourceLayerIndex:$}of l){const H=this.layers[0]._featureFilter.needGeometry,Q=qs(R,H);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),Q,g))continue;const te=E?x.evaluate(Q,{},g,d.availableImages):void 0,ie={id:N,properties:R.properties,type:R.type,sourceLayerIndex:$,index:F,geometry:H?Q.geometry:ta(R),patterns:{},sortKey:te};P.push(ie)}E&&P.sort((R,N)=>R.sortKey-N.sortKey);for(const R of P){const{geometry:N,index:F,sourceLayerIndex:$}=R;if(this.hasPattern){const H=Pm("fill",this.layers,R,this.zoom,d);this.patternFeatures.push(H)}else this.addFeature(R,N,F,g,{},d.subdivisionGranularity);d.featureIndex.insert(l[F].feature,N,F,$,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,d,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,ob),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,g,x,E,P){for(const R of uf(d,500)){const N=F_(R,x,P.fill.getGranularityForZoomLevel(x.z)),F=this.layoutVertexArray;op(($,H)=>{F.emplaceBack($,H)},this.segments,this.layoutVertexArray,this.indexArray,N.verticesFlattened,N.indicesTriangles,this.segments2,this.indexArray2,N.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,E,x)}}let bi,km;Jt("FillBucket",jo,{omit:["layers","patternFeatures"]});var fb={get paint(){return km=km||new da({"fill-antialias":new ur(fe.paint_fill["fill-antialias"]),"fill-opacity":new xr(fe.paint_fill["fill-opacity"]),"fill-color":new xr(fe.paint_fill["fill-color"]),"fill-outline-color":new xr(fe.paint_fill["fill-outline-color"]),"fill-translate":new ur(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new ur(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new lo(fe.paint_fill["fill-pattern"])})},get layout(){return bi=bi||new da({"fill-sort-key":new xr(fe.layout_fill["fill-sort-key"])})}};class ma extends Ji{constructor(l){super(l,fb)}recalculate(l,d){super.recalculate(l,d);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new jo(l)}queryRadius(){return np(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:l,geometry:d,transform:g,pixelsToTileUnits:x}){return Lo(Pl(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-g.bearingInRadians,x),d)}isTileClipped(){return!0}}const Z1=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),db=Vn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:pb}=Z1;var Hn,ls,Uo,j_,Dm,mb,Nm,Wa={};function fo(){if(ls)return Hn;ls=1;var f=M();function l(x,E,P,R,N){this.properties={},this.extent=P,this.type=0,this._pbf=x,this._geometry=-1,this._keys=R,this._values=N,x.readFields(d,this,E)}function d(x,E,P){x==1?E.id=P.readVarint():x==2?function(R,N){for(var F=R.readVarint()+R.pos;R.pos<F;){var $=N._keys[R.readVarint()],H=N._values[R.readVarint()];N.properties[$]=H}}(P,E):x==3?E.type=P.readVarint():x==4&&(E._geometry=P.pos)}function g(x){for(var E,P,R=0,N=0,F=x.length,$=F-1;N<F;$=N++)R+=((P=x[$]).x-(E=x[N]).x)*(E.y+P.y);return R}return Hn=l,l.types=["Unknown","Point","LineString","Polygon"],l.prototype.loadGeometry=function(){var x=this._pbf;x.pos=this._geometry;for(var E,P=x.readVarint()+x.pos,R=1,N=0,F=0,$=0,H=[];x.pos<P;){if(N<=0){var Q=x.readVarint();R=7&Q,N=Q>>3}if(N--,R===1||R===2)F+=x.readSVarint(),$+=x.readSVarint(),R===1&&(E&&H.push(E),E=[]),E.push(new f(F,$));else{if(R!==7)throw new Error("unknown command "+R);E&&E.push(E[0].clone())}}return E&&H.push(E),H},l.prototype.bbox=function(){var x=this._pbf;x.pos=this._geometry;for(var E=x.readVarint()+x.pos,P=1,R=0,N=0,F=0,$=1/0,H=-1/0,Q=1/0,te=-1/0;x.pos<E;){if(R<=0){var ie=x.readVarint();P=7&ie,R=ie>>3}if(R--,P===1||P===2)(N+=x.readSVarint())<$&&($=N),N>H&&(H=N),(F+=x.readSVarint())<Q&&(Q=F),F>te&&(te=F);else if(P!==7)throw new Error("unknown command "+P)}return[$,Q,H,te]},l.prototype.toGeoJSON=function(x,E,P){var R,N,F=this.extent*Math.pow(2,P),$=this.extent*x,H=this.extent*E,Q=this.loadGeometry(),te=l.types[this.type];function ie(we){for(var Fe=0;Fe<we.length;Fe++){var Ee=we[Fe];we[Fe]=[360*(Ee.x+$)/F-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ee.y+H)/F)*Math.PI/180))-90]}}switch(this.type){case 1:var oe=[];for(R=0;R<Q.length;R++)oe[R]=Q[R][0];ie(Q=oe);break;case 2:for(R=0;R<Q.length;R++)ie(Q[R]);break;case 3:for(Q=function(we){var Fe=we.length;if(Fe<=1)return[we];for(var Ee,ee,pe=[],Re=0;Re<Fe;Re++){var st=g(we[Re]);st!==0&&(ee===void 0&&(ee=st<0),ee===st<0?(Ee&&pe.push(Ee),Ee=[we[Re]]):Ee.push(we[Re]))}return Ee&&pe.push(Ee),pe}(Q),R=0;R<Q.length;R++)for(N=0;N<Q[R].length;N++)ie(Q[R][N])}Q.length===1?Q=Q[0]:te="Multi"+te;var me={type:"Feature",geometry:{type:te,coordinates:Q},properties:this.properties};return"id"in this&&(me.id=this.id),me},Hn}function U_(){if(j_)return Uo;j_=1;var f=fo();function l(g,x){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(d,this,x),this.length=this._features.length}function d(g,x,E){g===15?x.version=E.readVarint():g===1?x.name=E.readString():g===5?x.extent=E.readVarint():g===2?x._features.push(E.pos):g===3?x._keys.push(E.readString()):g===4&&x._values.push(function(P){for(var R=null,N=P.readVarint()+P.pos;P.pos<N;){var F=P.readVarint()>>3;R=F===1?P.readString():F===2?P.readFloat():F===3?P.readDouble():F===4?P.readVarint64():F===5?P.readVarint():F===6?P.readSVarint():F===7?P.readBoolean():null}return R}(E))}return Uo=l,l.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var x=this._pbf.readVarint()+this._pbf.pos;return new f(this._pbf,x,this.extent,this._keys,this._values)},Uo}function ws(){return Nm||(Nm=1,Wa.VectorTile=function(){if(mb)return Dm;mb=1;var f=U_();function l(d,g,x){if(d===3){var E=new f(x,x.readVarint()+x.pos);E.length&&(g[E.name]=E)}}return Dm=function(d,g){this.layers=d.readFields(l,{},g)},Dm}(),Wa.VectorTileFeature=fo(),Wa.VectorTileLayer=U_()),Wa}var zf=m(ws());const mu=zf.VectorTileFeature.types,Ec=Math.pow(2,13);function po(f,l,d,g,x,E,P,R){f.emplaceBack(l,d,2*Math.floor(g*Ec)+P,x*Ec*2,E*Ec*2,Math.round(R))}class lp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.centroidVertexArray=new Ae,this.indexArray=new Ht,this.programConfigurations=new Ml(l.layers,l.zoom),this.segments=new Tr,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.features=[],this.hasPattern=Mm("fill-extrusion",this.layers,d);for(const{feature:x,id:E,index:P,sourceLayerIndex:R}of l){const N=this.layers[0]._featureFilter.needGeometry,F=qs(x,N);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),F,g))continue;const $={id:E,sourceLayerIndex:R,index:P,geometry:N?F.geometry:ta(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Pm("fill-extrusion",this.layers,$,this.zoom,d)):this.addFeature($,$.geometry,P,g,{},d.subdivisionGranularity),d.featureIndex.insert(x,$.geometry,P,R,this.index,!0)}}addFeatures(l,d,g){for(const x of this.features){const{geometry:E}=x;this.addFeature(x,E,x.index,d,g,l.subdivisionGranularity)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,pb),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,db.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,d,g,x,E,P){for(const R of uf(d,500)){const N={x:0,y:0,sampleCount:0},F=this.layoutVertexArray.length;this.processPolygon(N,x,l,R,P);const $=this.layoutVertexArray.length-F,H=Math.floor(N.x/N.sampleCount),Q=Math.floor(N.y/N.sampleCount);for(let te=0;te<$;te++)this.centroidVertexArray.emplaceBack(H,Q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,E,x)}processPolygon(l,d,g,x,E){if(x.length<1||V_(x[0]))return;for(const H of x)H.length!==0&&$_(l,H);const P={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},R=E.fill.getGranularityForZoomLevel(d.z),N=mu[g.type]==="Polygon";for(const H of x){if(H.length===0||V_(H))continue;const Q=Ac(H,R,N);this._generateSideFaces(Q,P)}if(!N)return;const F=F_(x,d,R,!1),$=this.layoutVertexArray;op((H,Q)=>{po($,H,Q,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles)}_generateSideFaces(l,d){let g=0;for(let x=1;x<l.length;x++){const E=l[x],P=l[x-1];if(Cl(E,P))continue;d.segment.vertexLength+4>Tr.MAX_VERTEX_ARRAY_LENGTH&&(d.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const R=E.sub(P)._perp()._unit(),N=P.dist(E);g+N>32768&&(g=0),po(this.layoutVertexArray,E.x,E.y,R.x,R.y,0,0,g),po(this.layoutVertexArray,E.x,E.y,R.x,R.y,0,1,g),g+=N,po(this.layoutVertexArray,P.x,P.y,R.x,R.y,0,0,g),po(this.layoutVertexArray,P.x,P.y,R.x,R.y,0,1,g);const F=d.segment.vertexLength;this.indexArray.emplaceBack(F,F+2,F+1),this.indexArray.emplaceBack(F+1,F+2,F+3),d.segment.vertexLength+=4,d.segment.primitiveLength+=2}}}function $_(f,l){for(let d=0;d<l.length;d++){const g=l[d];d===l.length-1&&l[0].x===g.x&&l[0].y===g.y||(f.x+=g.x,f.y+=g.y,f.sampleCount++)}}function Cl(f,l){return f.x===l.x&&(f.x<0||f.x>ot)||f.y===l.y&&(f.y<0||f.y>ot)}function V_(f){return f.every(l=>l.x<0)||f.every(l=>l.x>ot)||f.every(l=>l.y<0)||f.every(l=>l.y>ot)}let yh;Jt("FillExtrusionBucket",lp,{omit:["layers","features"]});var cp={get paint(){return yh=yh||new da({"fill-extrusion-opacity":new ur(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xr(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ur(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ur(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new lo(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xr(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xr(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ur(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class up extends Ji{constructor(l){super(l,cp)}createBucket(l){return new lp(l)}queryRadius(){return np(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:x,transform:E,pixelsToTileUnits:P,pixelPosMatrix:R}){const N=Pl(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-E.bearingInRadians,P),F=this.paint.get("fill-extrusion-height").evaluate(d,g),$=this.paint.get("fill-extrusion-base").evaluate(d,g),H=function(te,ie,oe){const me=[];for(const we of te){const Fe=[we.x,we.y,0,1];Ze(Fe,Fe,ie),me.push(new z(Fe[0]/Fe[3],Fe[1]/Fe[3]))}return me}(N,R),Q=function(te,ie,oe,me){const we=[],Fe=[],Ee=me[8]*ie,ee=me[9]*ie,pe=me[10]*ie,Re=me[11]*ie,st=me[8]*oe,Nt=me[9]*oe,dt=me[10]*oe,wt=me[11]*oe;for(const $t of te){const Lt=[],qt=[];for(const Et of $t){const ir=Et.x,br=Et.y,mr=me[0]*ir+me[4]*br+me[12],cr=me[1]*ir+me[5]*br+me[13],Fr=me[2]*ir+me[6]*br+me[14],Wn=me[3]*ir+me[7]*br+me[15],ai=Fr+pe,_a=Wn+Re,Hs=mr+st,Ra=cr+Nt,ki=Fr+dt,Tn=Wn+wt,wi=new z((mr+Ee)/_a,(cr+ee)/_a);wi.z=ai/_a,Lt.push(wi);const Ui=new z(Hs/Tn,Ra/Tn);Ui.z=ki/Tn,qt.push(Ui)}we.push(Lt),Fe.push(qt)}return[we,Fe]}(x,$,F,R);return function(te,ie,oe){let me=1/0;Lo(oe,ie)&&(me=q_(oe,ie[0]));for(let we=0;we<ie.length;we++){const Fe=ie[we],Ee=te[we];for(let ee=0;ee<Fe.length-1;ee++){const pe=Fe[ee],Re=[pe,Fe[ee+1],Ee[ee+1],Ee[ee],pe];Of(oe,Re)&&(me=Math.min(me,q_(oe,Re)))}}return me!==1/0&&me}(Q[0],Q[1],H)}}function Rl(f,l){return f.x*l.x+f.y*l.y}function q_(f,l){if(f.length===1){let d=0;const g=l[d++];let x;for(;!x||g.equals(x);)if(x=l[d++],!x)return 1/0;for(;d<l.length;d++){const E=l[d],P=f[0],R=x.sub(g),N=E.sub(g),F=P.sub(g),$=Rl(R,R),H=Rl(R,N),Q=Rl(N,N),te=Rl(F,R),ie=Rl(F,N),oe=$*Q-H*H,me=(Q*te-H*ie)/oe,we=($*ie-H*te)/oe,Fe=g.z*(1-me-we)+x.z*me+E.z*we;if(isFinite(Fe))return Fe}return 1/0}{let d=1/0;for(const g of l)d=Math.min(d,g.z);return d}}const gb=Vn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hp}=gb,_b=Vn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Bm}=_b,yb=zf.VectorTileFeature.types,X1=Math.cos(Math.PI/180*37.5),vb=Math.pow(2,14)/.5;class ln{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new je,this.layoutVertexArray2=new Le,this.indexArray=new Ht,this.programConfigurations=new Ml(l.layers,l.zoom),this.segments=new Tr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=Mm("line",this.layers,d);const x=this.layers[0].layout.get("line-sort-key"),E=!x.isConstant(),P=[];for(const{feature:R,id:N,index:F,sourceLayerIndex:$}of l){const H=this.layers[0]._featureFilter.needGeometry,Q=qs(R,H);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),Q,g))continue;const te=E?x.evaluate(Q,{},g):void 0,ie={id:N,properties:R.properties,type:R.type,sourceLayerIndex:$,index:F,geometry:H?Q.geometry:ta(R),patterns:{},sortKey:te};P.push(ie)}E&&P.sort((R,N)=>R.sortKey-N.sortKey);for(const R of P){const{geometry:N,index:F,sourceLayerIndex:$}=R;if(this.hasPattern){const H=Pm("line",this.layers,R,this.zoom,d);this.patternFeatures.push(H)}else this.addFeature(R,N,F,g,{},d.subdivisionGranularity);d.featureIndex.insert(l[F].feature,N,F,$,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,d,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,Bm)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,hp),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,g,x,E,P){const R=this.layers[0].layout,N=R.get("line-join").evaluate(l,{}),F=R.get("line-cap"),$=R.get("line-miter-limit"),H=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const Q of d)this.addLine(Q,l,N,F,$,H,x,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,E,x)}addLine(l,d,g,x,E,P,R,N){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,l=Ac(l,R?N.line.getGranularityForZoomLevel(R.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ee=0;Ee<l.length-1;Ee++)this.totalDistance+=l[Ee].dist(l[Ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const F=yb[d.type]==="Polygon";let $=l.length;for(;$>=2&&l[$-1].equals(l[$-2]);)$--;let H=0;for(;H<$-1&&l[H].equals(l[H+1]);)H++;if($<(F?3:2))return;g==="bevel"&&(E=1.05);const Q=this.overscaling<=16?15*ot/(512*this.overscaling):0,te=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let ie,oe,me,we,Fe;this.e1=this.e2=-1,F&&(ie=l[$-2],Fe=l[H].sub(ie)._unit()._perp());for(let Ee=H;Ee<$;Ee++){if(me=Ee===$-1?F?l[H+1]:void 0:l[Ee+1],me&&l[Ee].equals(me))continue;Fe&&(we=Fe),ie&&(oe=ie),ie=l[Ee],Fe=me?me.sub(ie)._unit()._perp():we,we=we||Fe;let ee=we.add(Fe);ee.x===0&&ee.y===0||ee._unit();const pe=we.x*Fe.x+we.y*Fe.y,Re=ee.x*Fe.x+ee.y*Fe.y,st=Re!==0?1/Re:1/0,Nt=2*Math.sqrt(2-2*Re),dt=Re<X1&&oe&&me,wt=we.x*Fe.y-we.y*Fe.x>0;if(dt&&Ee>H){const qt=ie.dist(oe);if(qt>2*Q){const Et=ie.sub(ie.sub(oe)._mult(Q/qt)._round());this.updateDistance(oe,Et),this.addCurrentVertex(Et,we,0,0,te),oe=Et}}const $t=oe&&me;let Lt=$t?g:F?"butt":x;if($t&&Lt==="round"&&(st<P?Lt="miter":st<=2&&(Lt="fakeround")),Lt==="miter"&&st>E&&(Lt="bevel"),Lt==="bevel"&&(st>2&&(Lt="flipbevel"),st<E&&(Lt="miter")),oe&&this.updateDistance(oe,ie),Lt==="miter")ee._mult(st),this.addCurrentVertex(ie,ee,0,0,te);else if(Lt==="flipbevel"){if(st>100)ee=Fe.mult(-1);else{const qt=st*we.add(Fe).mag()/we.sub(Fe).mag();ee._perp()._mult(qt*(wt?-1:1))}this.addCurrentVertex(ie,ee,0,0,te),this.addCurrentVertex(ie,ee.mult(-1),0,0,te)}else if(Lt==="bevel"||Lt==="fakeround"){const qt=-Math.sqrt(st*st-1),Et=wt?qt:0,ir=wt?0:qt;if(oe&&this.addCurrentVertex(ie,we,Et,ir,te),Lt==="fakeround"){const br=Math.round(180*Nt/Math.PI/20);for(let mr=1;mr<br;mr++){let cr=mr/br;if(cr!==.5){const Wn=cr-.5;cr+=cr*Wn*(cr-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Wn*Wn+(.848013+pe*(.215638*pe-1.06021)))}const Fr=Fe.sub(we)._mult(cr)._add(we)._unit()._mult(wt?-1:1);this.addHalfVertex(ie,Fr.x,Fr.y,!1,wt,0,te)}}me&&this.addCurrentVertex(ie,Fe,-Et,-ir,te)}else if(Lt==="butt")this.addCurrentVertex(ie,ee,0,0,te);else if(Lt==="square"){const qt=oe?1:-1;this.addCurrentVertex(ie,ee,qt,qt,te)}else Lt==="round"&&(oe&&(this.addCurrentVertex(ie,we,0,0,te),this.addCurrentVertex(ie,we,1,1,te,!0)),me&&(this.addCurrentVertex(ie,Fe,-1,-1,te,!0),this.addCurrentVertex(ie,Fe,0,0,te)));if(dt&&Ee<$-1){const qt=ie.dist(me);if(qt>2*Q){const Et=ie.add(me.sub(ie)._mult(Q/qt)._round());this.updateDistance(ie,Et),this.addCurrentVertex(Et,Fe,0,0,te),ie=Et}}}}addCurrentVertex(l,d,g,x,E,P=!1){const R=d.y*x-d.x,N=-d.y-d.x*x;this.addHalfVertex(l,d.x+d.y*g,d.y-d.x*g,P,!1,g,E),this.addHalfVertex(l,R,N,P,!0,-x,E),this.distance>vb/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,d,g,x,E,P))}addHalfVertex({x:l,y:d},g,x,E,P,R,N){const F=.5*(this.lineClips?this.scaledDistance*(vb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(E?1:0),(d<<1)+(P?1:0),Math.round(63*g)+128,Math.round(63*x)+128,1+(R===0?0:R<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const $=N.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),N.primitiveLength++),P?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}let Ln,Wr;Jt("LineBucket",ln,{omit:["layers","patternFeatures"]});var Qr={get paint(){return Wr=Wr||new da({"line-opacity":new xr(fe.paint_line["line-opacity"]),"line-color":new xr(fe.paint_line["line-color"]),"line-translate":new ur(fe.paint_line["line-translate"]),"line-translate-anchor":new ur(fe.paint_line["line-translate-anchor"]),"line-width":new xr(fe.paint_line["line-width"]),"line-gap-width":new xr(fe.paint_line["line-gap-width"]),"line-offset":new xr(fe.paint_line["line-offset"]),"line-blur":new xr(fe.paint_line["line-blur"]),"line-dasharray":new uu(fe.paint_line["line-dasharray"]),"line-pattern":new lo(fe.paint_line["line-pattern"]),"line-gradient":new Cf(fe.paint_line["line-gradient"])})},get layout(){return Ln=Ln||new da({"line-cap":new ur(fe.layout_line["line-cap"]),"line-join":new xr(fe.layout_line["line-join"]),"line-miter-limit":new ur(fe.layout_line["line-miter-limit"]),"line-round-limit":new ur(fe.layout_line["line-round-limit"]),"line-sort-key":new xr(fe.layout_line["line-sort-key"])})}};class xn extends xr{possiblyEvaluate(l,d){return d=new cn(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(l,d)}evaluate(l,d,g,x){return d=tr({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(l,d,g,x)}}let Za;class gu extends Ji{constructor(l){super(l,Qr),this.gradientVersion=0,Za||(Za=new xn(Qr.paint.properties["line-width"].specification),Za.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const d=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof To,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,d){super.recalculate(l,d),this.paint._values["line-floorwidth"]=Za.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new ln(l)}queryRadius(l){const d=l,g=vh(kf("line-width",this,d),kf("line-gap-width",this,d)),x=kf("line-offset",this,d);return g/2+Math.abs(x)+np(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:x,transform:E,pixelsToTileUnits:P}){const R=Pl(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-E.bearingInRadians,P),N=P/2*vh(this.paint.get("line-width").evaluate(d,g),this.paint.get("line-gap-width").evaluate(d,g)),F=this.paint.get("line-offset").evaluate(d,g);return F&&(x=function($,H){const Q=[];for(let te=0;te<$.length;te++){const ie=$[te],oe=[];for(let me=0;me<ie.length;me++){const we=ie[me-1],Fe=ie[me],Ee=ie[me+1],ee=me===0?new z(0,0):Fe.sub(we)._unit()._perp(),pe=me===ie.length-1?new z(0,0):Ee.sub(Fe)._unit()._perp(),Re=ee._add(pe)._unit(),st=Re.x*pe.x+Re.y*pe.y;st!==0&&Re._mult(1/st),oe.push(Re._mult(H)._add(Fe))}Q.push(oe)}return Q}(x,F*P)),function($,H,Q){for(let te=0;te<H.length;te++){const ie=H[te];if($.length>=3){for(let oe=0;oe<ie.length;oe++)if(xc($,ie[oe]))return!0}if(fu($,ie,Q))return!0}return!1}(R,x,N)}isTileClipped(){return!0}}function vh(f,l){return l>0?l+2*f:f}const H_=Vn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Mc=Vn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Vn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xi=Vn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Vn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Pc=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bh=Vn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function W_(f,l,d){return f.sections.forEach(g=>{g.text=function(x,E,P){const R=E.layout.get("text-transform").evaluate(P,{});return R==="uppercase"?x=x.toLocaleUpperCase():R==="lowercase"&&(x=x.toLocaleLowerCase()),Ma.applyArabicShaping&&(x=Ma.applyArabicShaping(x)),x}(g.text,l,d)}),f}Vn([{name:"triangle",components:3,type:"Uint16"}]),Vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Vn([{type:"Float32",name:"offsetX"}]),Vn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Vn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Xa={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var xh,wh,cs,hi=24,fp={};function Lm(){return xh||(xh=1,fp.read=function(f,l,d,g,x){var E,P,R=8*x-g-1,N=(1<<R)-1,F=N>>1,$=-7,H=d?x-1:0,Q=d?-1:1,te=f[l+H];for(H+=Q,E=te&(1<<-$)-1,te>>=-$,$+=R;$>0;E=256*E+f[l+H],H+=Q,$-=8);for(P=E&(1<<-$)-1,E>>=-$,$+=g;$>0;P=256*P+f[l+H],H+=Q,$-=8);if(E===0)E=1-F;else{if(E===N)return P?NaN:1/0*(te?-1:1);P+=Math.pow(2,g),E-=F}return(te?-1:1)*P*Math.pow(2,E-g)},fp.write=function(f,l,d,g,x,E){var P,R,N,F=8*E-x-1,$=(1<<F)-1,H=$>>1,Q=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=g?0:E-1,ie=g?1:-1,oe=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(R=isNaN(l)?1:0,P=$):(P=Math.floor(Math.log(l)/Math.LN2),l*(N=Math.pow(2,-P))<1&&(P--,N*=2),(l+=P+H>=1?Q/N:Q*Math.pow(2,1-H))*N>=2&&(P++,N/=2),P+H>=$?(R=0,P=$):P+H>=1?(R=(l*N-1)*Math.pow(2,x),P+=H):(R=l*Math.pow(2,H-1)*Math.pow(2,x),P=0));x>=8;f[d+te]=255&R,te+=ie,R/=256,x-=8);for(P=P<<x|R,F+=x;F>0;f[d+te]=255&P,te+=ie,P/=256,F-=8);f[d+te-ie]|=128*oe}),fp}function dp(){if(cs)return wh;cs=1,wh=l;var f=Lm();function l(ee){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ee)?ee:new Uint8Array(ee||0),this.pos=0,this.type=0,this.length=this.buf.length}l.Varint=0,l.Fixed64=1,l.Bytes=2,l.Fixed32=5;var d=4294967296,g=1/d,x=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function E(ee){return ee.type===l.Bytes?ee.readVarint()+ee.pos:ee.pos+1}function P(ee,pe,Re){return Re?4294967296*pe+(ee>>>0):4294967296*(pe>>>0)+(ee>>>0)}function R(ee,pe,Re){var st=pe<=16383?1:pe<=2097151?2:pe<=268435455?3:Math.floor(Math.log(pe)/(7*Math.LN2));Re.realloc(st);for(var Nt=Re.pos-1;Nt>=ee;Nt--)Re.buf[Nt+st]=Re.buf[Nt]}function N(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeVarint(ee[Re])}function F(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeSVarint(ee[Re])}function $(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeFloat(ee[Re])}function H(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeDouble(ee[Re])}function Q(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeBoolean(ee[Re])}function te(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeFixed32(ee[Re])}function ie(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeSFixed32(ee[Re])}function oe(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeFixed64(ee[Re])}function me(ee,pe){for(var Re=0;Re<ee.length;Re++)pe.writeSFixed64(ee[Re])}function we(ee,pe){return(ee[pe]|ee[pe+1]<<8|ee[pe+2]<<16)+16777216*ee[pe+3]}function Fe(ee,pe,Re){ee[Re]=pe,ee[Re+1]=pe>>>8,ee[Re+2]=pe>>>16,ee[Re+3]=pe>>>24}function Ee(ee,pe){return(ee[pe]|ee[pe+1]<<8|ee[pe+2]<<16)+(ee[pe+3]<<24)}return l.prototype={destroy:function(){this.buf=null},readFields:function(ee,pe,Re){for(Re=Re||this.length;this.pos<Re;){var st=this.readVarint(),Nt=st>>3,dt=this.pos;this.type=7&st,ee(Nt,pe,this),this.pos===dt&&this.skip(st)}return pe},readMessage:function(ee,pe){return this.readFields(ee,pe,this.readVarint()+this.pos)},readFixed32:function(){var ee=we(this.buf,this.pos);return this.pos+=4,ee},readSFixed32:function(){var ee=Ee(this.buf,this.pos);return this.pos+=4,ee},readFixed64:function(){var ee=we(this.buf,this.pos)+we(this.buf,this.pos+4)*d;return this.pos+=8,ee},readSFixed64:function(){var ee=we(this.buf,this.pos)+Ee(this.buf,this.pos+4)*d;return this.pos+=8,ee},readFloat:function(){var ee=f.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ee},readDouble:function(){var ee=f.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ee},readVarint:function(ee){var pe,Re,st=this.buf;return pe=127&(Re=st[this.pos++]),Re<128?pe:(pe|=(127&(Re=st[this.pos++]))<<7,Re<128?pe:(pe|=(127&(Re=st[this.pos++]))<<14,Re<128?pe:(pe|=(127&(Re=st[this.pos++]))<<21,Re<128?pe:function(Nt,dt,wt){var $t,Lt,qt=wt.buf;if($t=(112&(Lt=qt[wt.pos++]))>>4,Lt<128||($t|=(127&(Lt=qt[wt.pos++]))<<3,Lt<128)||($t|=(127&(Lt=qt[wt.pos++]))<<10,Lt<128)||($t|=(127&(Lt=qt[wt.pos++]))<<17,Lt<128)||($t|=(127&(Lt=qt[wt.pos++]))<<24,Lt<128)||($t|=(1&(Lt=qt[wt.pos++]))<<31,Lt<128))return P(Nt,$t,dt);throw new Error("Expected varint not more than 10 bytes")}(pe|=(15&(Re=st[this.pos]))<<28,ee,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ee=this.readVarint();return ee%2==1?(ee+1)/-2:ee/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ee=this.readVarint()+this.pos,pe=this.pos;return this.pos=ee,ee-pe>=12&&x?function(Re,st,Nt){return x.decode(Re.subarray(st,Nt))}(this.buf,pe,ee):function(Re,st,Nt){for(var dt="",wt=st;wt<Nt;){var $t,Lt,qt,Et=Re[wt],ir=null,br=Et>239?4:Et>223?3:Et>191?2:1;if(wt+br>Nt)break;br===1?Et<128&&(ir=Et):br===2?(192&($t=Re[wt+1]))==128&&(ir=(31&Et)<<6|63&$t)<=127&&(ir=null):br===3?(Lt=Re[wt+2],(192&($t=Re[wt+1]))==128&&(192&Lt)==128&&((ir=(15&Et)<<12|(63&$t)<<6|63&Lt)<=2047||ir>=55296&&ir<=57343)&&(ir=null)):br===4&&(Lt=Re[wt+2],qt=Re[wt+3],(192&($t=Re[wt+1]))==128&&(192&Lt)==128&&(192&qt)==128&&((ir=(15&Et)<<18|(63&$t)<<12|(63&Lt)<<6|63&qt)<=65535||ir>=1114112)&&(ir=null)),ir===null?(ir=65533,br=1):ir>65535&&(ir-=65536,dt+=String.fromCharCode(ir>>>10&1023|55296),ir=56320|1023&ir),dt+=String.fromCharCode(ir),wt+=br}return dt}(this.buf,pe,ee)},readBytes:function(){var ee=this.readVarint()+this.pos,pe=this.buf.subarray(this.pos,ee);return this.pos=ee,pe},readPackedVarint:function(ee,pe){if(this.type!==l.Bytes)return ee.push(this.readVarint(pe));var Re=E(this);for(ee=ee||[];this.pos<Re;)ee.push(this.readVarint(pe));return ee},readPackedSVarint:function(ee){if(this.type!==l.Bytes)return ee.push(this.readSVarint());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readSVarint());return ee},readPackedBoolean:function(ee){if(this.type!==l.Bytes)return ee.push(this.readBoolean());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readBoolean());return ee},readPackedFloat:function(ee){if(this.type!==l.Bytes)return ee.push(this.readFloat());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readFloat());return ee},readPackedDouble:function(ee){if(this.type!==l.Bytes)return ee.push(this.readDouble());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readDouble());return ee},readPackedFixed32:function(ee){if(this.type!==l.Bytes)return ee.push(this.readFixed32());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readFixed32());return ee},readPackedSFixed32:function(ee){if(this.type!==l.Bytes)return ee.push(this.readSFixed32());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readSFixed32());return ee},readPackedFixed64:function(ee){if(this.type!==l.Bytes)return ee.push(this.readFixed64());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readFixed64());return ee},readPackedSFixed64:function(ee){if(this.type!==l.Bytes)return ee.push(this.readSFixed64());var pe=E(this);for(ee=ee||[];this.pos<pe;)ee.push(this.readSFixed64());return ee},skip:function(ee){var pe=7&ee;if(pe===l.Varint)for(;this.buf[this.pos++]>127;);else if(pe===l.Bytes)this.pos=this.readVarint()+this.pos;else if(pe===l.Fixed32)this.pos+=4;else{if(pe!==l.Fixed64)throw new Error("Unimplemented type: "+pe);this.pos+=8}},writeTag:function(ee,pe){this.writeVarint(ee<<3|pe)},realloc:function(ee){for(var pe=this.length||16;pe<this.pos+ee;)pe*=2;if(pe!==this.length){var Re=new Uint8Array(pe);Re.set(this.buf),this.buf=Re,this.length=pe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ee){this.realloc(4),Fe(this.buf,ee,this.pos),this.pos+=4},writeSFixed32:function(ee){this.realloc(4),Fe(this.buf,ee,this.pos),this.pos+=4},writeFixed64:function(ee){this.realloc(8),Fe(this.buf,-1&ee,this.pos),Fe(this.buf,Math.floor(ee*g),this.pos+4),this.pos+=8},writeSFixed64:function(ee){this.realloc(8),Fe(this.buf,-1&ee,this.pos),Fe(this.buf,Math.floor(ee*g),this.pos+4),this.pos+=8},writeVarint:function(ee){(ee=+ee||0)>268435455||ee<0?function(pe,Re){var st,Nt;if(pe>=0?(st=pe%4294967296|0,Nt=pe/4294967296|0):(Nt=~(-pe/4294967296),4294967295^(st=~(-pe%4294967296))?st=st+1|0:(st=0,Nt=Nt+1|0)),pe>=18446744073709552e3||pe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Re.realloc(10),function(dt,wt,$t){$t.buf[$t.pos++]=127&dt|128,dt>>>=7,$t.buf[$t.pos++]=127&dt|128,dt>>>=7,$t.buf[$t.pos++]=127&dt|128,dt>>>=7,$t.buf[$t.pos++]=127&dt|128,$t.buf[$t.pos]=127&(dt>>>=7)}(st,0,Re),function(dt,wt){var $t=(7&dt)<<4;wt.buf[wt.pos++]|=$t|((dt>>>=3)?128:0),dt&&(wt.buf[wt.pos++]=127&dt|((dt>>>=7)?128:0),dt&&(wt.buf[wt.pos++]=127&dt|((dt>>>=7)?128:0),dt&&(wt.buf[wt.pos++]=127&dt|((dt>>>=7)?128:0),dt&&(wt.buf[wt.pos++]=127&dt|((dt>>>=7)?128:0),dt&&(wt.buf[wt.pos++]=127&dt)))))}(Nt,Re)}(ee,this):(this.realloc(4),this.buf[this.pos++]=127&ee|(ee>127?128:0),ee<=127||(this.buf[this.pos++]=127&(ee>>>=7)|(ee>127?128:0),ee<=127||(this.buf[this.pos++]=127&(ee>>>=7)|(ee>127?128:0),ee<=127||(this.buf[this.pos++]=ee>>>7&127))))},writeSVarint:function(ee){this.writeVarint(ee<0?2*-ee-1:2*ee)},writeBoolean:function(ee){this.writeVarint(!!ee)},writeString:function(ee){ee=String(ee),this.realloc(4*ee.length),this.pos++;var pe=this.pos;this.pos=function(st,Nt,dt){for(var wt,$t,Lt=0;Lt<Nt.length;Lt++){if((wt=Nt.charCodeAt(Lt))>55295&&wt<57344){if(!$t){wt>56319||Lt+1===Nt.length?(st[dt++]=239,st[dt++]=191,st[dt++]=189):$t=wt;continue}if(wt<56320){st[dt++]=239,st[dt++]=191,st[dt++]=189,$t=wt;continue}wt=$t-55296<<10|wt-56320|65536,$t=null}else $t&&(st[dt++]=239,st[dt++]=191,st[dt++]=189,$t=null);wt<128?st[dt++]=wt:(wt<2048?st[dt++]=wt>>6|192:(wt<65536?st[dt++]=wt>>12|224:(st[dt++]=wt>>18|240,st[dt++]=wt>>12&63|128),st[dt++]=wt>>6&63|128),st[dt++]=63&wt|128)}return dt}(this.buf,ee,this.pos);var Re=this.pos-pe;Re>=128&&R(pe,Re,this),this.pos=pe-1,this.writeVarint(Re),this.pos+=Re},writeFloat:function(ee){this.realloc(4),f.write(this.buf,ee,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ee){this.realloc(8),f.write(this.buf,ee,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ee){var pe=ee.length;this.writeVarint(pe),this.realloc(pe);for(var Re=0;Re<pe;Re++)this.buf[this.pos++]=ee[Re]},writeRawMessage:function(ee,pe){this.pos++;var Re=this.pos;ee(pe,this);var st=this.pos-Re;st>=128&&R(Re,st,this),this.pos=Re-1,this.writeVarint(st),this.pos+=st},writeMessage:function(ee,pe,Re){this.writeTag(ee,l.Bytes),this.writeRawMessage(pe,Re)},writePackedVarint:function(ee,pe){pe.length&&this.writeMessage(ee,N,pe)},writePackedSVarint:function(ee,pe){pe.length&&this.writeMessage(ee,F,pe)},writePackedBoolean:function(ee,pe){pe.length&&this.writeMessage(ee,Q,pe)},writePackedFloat:function(ee,pe){pe.length&&this.writeMessage(ee,$,pe)},writePackedDouble:function(ee,pe){pe.length&&this.writeMessage(ee,H,pe)},writePackedFixed32:function(ee,pe){pe.length&&this.writeMessage(ee,te,pe)},writePackedSFixed32:function(ee,pe){pe.length&&this.writeMessage(ee,ie,pe)},writePackedFixed64:function(ee,pe){pe.length&&this.writeMessage(ee,oe,pe)},writePackedSFixed64:function(ee,pe){pe.length&&this.writeMessage(ee,me,pe)},writeBytesField:function(ee,pe){this.writeTag(ee,l.Bytes),this.writeBytes(pe)},writeFixed32Field:function(ee,pe){this.writeTag(ee,l.Fixed32),this.writeFixed32(pe)},writeSFixed32Field:function(ee,pe){this.writeTag(ee,l.Fixed32),this.writeSFixed32(pe)},writeFixed64Field:function(ee,pe){this.writeTag(ee,l.Fixed64),this.writeFixed64(pe)},writeSFixed64Field:function(ee,pe){this.writeTag(ee,l.Fixed64),this.writeSFixed64(pe)},writeVarintField:function(ee,pe){this.writeTag(ee,l.Varint),this.writeVarint(pe)},writeSVarintField:function(ee,pe){this.writeTag(ee,l.Varint),this.writeSVarint(pe)},writeStringField:function(ee,pe){this.writeTag(ee,l.Bytes),this.writeString(pe)},writeFloatField:function(ee,pe){this.writeTag(ee,l.Fixed32),this.writeFloat(pe)},writeDoubleField:function(ee,pe){this.writeTag(ee,l.Fixed64),this.writeDouble(pe)},writeBooleanField:function(ee,pe){this.writeVarintField(ee,!!pe)}},wh}var Il=m(dp());const ra=3;function _u(f,l,d){f===1&&d.readMessage(jf,l)}function jf(f,l,d){if(f===3){const{id:g,bitmap:x,width:E,height:P,left:R,top:N,advance:F}=d.readMessage(Uf,{});l.push({id:g,bitmap:new vi({width:E+2*ra,height:P+2*ra},x),metrics:{width:E,height:P,left:R,top:N,advance:F}})}}function Uf(f,l,d){f===1?l.id=d.readVarint():f===2?l.bitmap=d.readBytes():f===3?l.width=d.readVarint():f===4?l.height=d.readVarint():f===5?l.left=d.readSVarint():f===6?l.top=d.readSVarint():f===7&&(l.advance=d.readVarint())}const Z_=ra;function Fm(f){let l=0,d=0;for(const P of f)l+=P.w*P.h,d=Math.max(d,P.w);f.sort((P,R)=>R.h-P.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}];let x=0,E=0;for(const P of f)for(let R=g.length-1;R>=0;R--){const N=g[R];if(!(P.w>N.w||P.h>N.h)){if(P.x=N.x,P.y=N.y,E=Math.max(E,P.y+P.h),x=Math.max(x,P.x+P.w),P.w===N.w&&P.h===N.h){const F=g.pop();R<g.length&&(g[R]=F)}else P.h===N.h?(N.x+=P.w,N.w-=P.w):P.w===N.w?(N.y+=P.h,N.h-=P.h):(g.push({x:N.x+P.w,y:N.y,w:N.w-P.w,h:P.h}),N.y+=P.h,N.h-=P.h);break}}return{w:x,h:E,fill:l/(x*E)||0}}const Ga=1;class Th{constructor(l,{pixelRatio:d,version:g,stretchX:x,stretchY:E,content:P,textFitWidth:R,textFitHeight:N}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=x,this.stretchY=E,this.content=P,this.version=g,this.textFitWidth=R,this.textFitHeight=N}get tl(){return[this.paddedRect.x+Ga,this.paddedRect.y+Ga]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ga,this.paddedRect.y+this.paddedRect.h-Ga]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ga)/this.pixelRatio,(this.paddedRect.h-2*Ga)/this.pixelRatio]}}class zm{constructor(l,d){const g={},x={};this.haveRenderCallbacks=[];const E=[];this.addImages(l,g,E),this.addImages(d,x,E);const{w:P,h:R}=Fm(E),N=new bn({width:P||1,height:R||1});for(const F in l){const $=l[F],H=g[F].paddedRect;bn.copy($.data,N,{x:0,y:0},{x:H.x+Ga,y:H.y+Ga},$.data)}for(const F in d){const $=d[F],H=x[F].paddedRect,Q=H.x+Ga,te=H.y+Ga,ie=$.data.width,oe=$.data.height;bn.copy($.data,N,{x:0,y:0},{x:Q,y:te},$.data),bn.copy($.data,N,{x:0,y:oe-1},{x:Q,y:te-1},{width:ie,height:1}),bn.copy($.data,N,{x:0,y:0},{x:Q,y:te+oe},{width:ie,height:1}),bn.copy($.data,N,{x:ie-1,y:0},{x:Q-1,y:te},{width:1,height:oe}),bn.copy($.data,N,{x:0,y:0},{x:Q+ie,y:te},{width:1,height:oe})}this.image=N,this.iconPositions=g,this.patternPositions=x}addImages(l,d,g){for(const x in l){const E=l[x],P={x:0,y:0,w:E.data.width+2*Ga,h:E.data.height+2*Ga};g.push(P),d[x]=new Th(P,E),E.hasRenderCallback&&this.haveRenderCallbacks.push(x)}}patchUpdatedImages(l,d){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in l.updatedImages)this.patchUpdatedImage(this.iconPositions[g],l.getImage(g),d),this.patchUpdatedImage(this.patternPositions[g],l.getImage(g),d)}patchUpdatedImage(l,d,g){if(!l||!d||l.version===d.version)return;l.version=d.version;const[x,E]=l.tl;g.update(d.data,void 0,{x,y:E})}}var ji;Jt("ImagePosition",Th),Jt("ImageAtlas",zm),c.al=void 0,(ji=c.al||(c.al={}))[ji.none=0]="none",ji[ji.horizontal=1]="horizontal",ji[ji.vertical=2]="vertical",ji[ji.horizontalOnly=3]="horizontalOnly";const pp=-17;class Pa{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(l,d,g){const x=new Pa;return x.scale=l||1,x.fontStack=d,x.verticalAlign=g||"bottom",x}static forImage(l,d){const g=new Pa;return g.imageName=l,g.verticalAlign=d||"bottom",g}}class Sh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){const g=new Sh;for(let x=0;x<l.sections.length;x++){const E=l.sections[x];E.image?g.addImageSection(E):g.addTextSection(E,d)}return g}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let d="";for(let g=0;g<l.length;g++){const x=l.charCodeAt(g+1)||null,E=l.charCodeAt(g-1)||null;d+=x&&ch(x)&&!Xa[l[g+1]]||E&&ch(E)&&!Xa[l[g-1]]||!Xa[l[g]]?l[g]:Xa[l[g]]}return d}(this.text)}trim(){let l=0;for(let g=0;g<this.text.length&&jm[this.text.charCodeAt(g)];g++)l++;let d=this.text.length;for(let g=this.text.length-1;g>=0&&g>=l&&jm[this.text.charCodeAt(g)];g--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){const g=new Sh;return g.text=this.text.substring(l,d),g.sectionIndex=this.sectionIndex.slice(l,d),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}getMaxImageSize(l){let d=0,g=0;for(let x=0;x<this.length();x++){const E=this.getSection(x);if(E.imageName){const P=l[E.imageName];if(!P)continue;const R=P.displaySize;d=Math.max(d,R[0]),g=Math.max(g,R[1])}}return{maxImageWidth:d,maxImageHeight:g}}addTextSection(l,d){this.text+=l.text,this.sections.push(Pa.forText(l.scale,l.fontStack||d,l.verticalAlign));const g=this.sections.length-1;for(let x=0;x<l.text.length;++x)this.sectionIndex.push(g)}addImageSection(l){const d=l.image?l.image.name:"";if(d.length===0)return void hr("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(Pa.forImage(d,l.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):hr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function mp(f,l,d,g,x,E,P,R,N,F,$,H,Q,te,ie){const oe=Sh.fromFeature(f,x);let me;H===c.al.vertical&&oe.verticalizePunctuation();const{processBidirectionalText:we,processStyledBidirectionalText:Fe}=Ma;if(we&&oe.sections.length===1){me=[];const pe=we(oe.toString(),gp(oe,F,E,l,g,te));for(const Re of pe){const st=new Sh;st.text=Re,st.sections=oe.sections;for(let Nt=0;Nt<Re.length;Nt++)st.sectionIndex.push(0);me.push(st)}}else if(Fe){me=[];const pe=Fe(oe.text,oe.sectionIndex,gp(oe,F,E,l,g,te));for(const Re of pe){const st=new Sh;st.text=Re[0],st.sectionIndex=Re[1],st.sections=oe.sections,me.push(st)}}else me=function(pe,Re){const st=[],Nt=pe.text;let dt=0;for(const wt of Re)st.push(pe.substring(dt,wt)),dt=wt;return dt<Nt.length&&st.push(pe.substring(dt,Nt.length)),st}(oe,gp(oe,F,E,l,g,te));const Ee=[],ee={positionedLines:Ee,text:oe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(pe,Re,st,Nt,dt,wt,$t,Lt,qt,Et,ir,br){let mr=0,cr=0,Fr=0,Wn=0;const ai=Lt==="right"?1:Lt==="left"?0:.5,_a=hi/br;let Hs=0;for(const Tn of dt){Tn.trim();const wi=Tn.getMaxScale(),Ui={positionedGlyphs:[],lineOffset:0};pe.positionedLines[Hs]=Ui;const Di=Ui.positionedGlyphs;let fi=0;if(!Tn.length()){cr+=wt,++Hs;continue}const $i=G1(Nt,Tn,_a);for(let na=0;na<Tn.length();na++){const ei=Tn.getSection(na),zn=Tn.getSectionIndex(na),Vi=Tn.getCharCode(na),di=Y1(qt,ir,Vi);let sn;if(ei.imageName){if(pe.iconsInText=!0,ei.scale=ei.scale*_a,sn=Tb(ei,di,wi,$i,Nt),!sn)continue;fi=Math.max(fi,sn.imageOffset)}else if(sn=wb(ei,Vi,di,$i,Re,st),!sn)continue;const{rect:Ho,metrics:Oh,baselineOffset:Ts}=sn;Di.push({glyph:Vi,imageName:ei.imageName,x:mr,y:cr+Ts+pp,vertical:di,scale:ei.scale,fontStack:ei.fontStack,sectionIndex:zn,metrics:Oh,rect:Ho}),di?(pe.verticalizable=!0,mr+=(ei.imageName?Oh.advance:hi)*ei.scale+Et):mr+=Oh.advance*ei.scale+Et}Di.length!==0&&(Fr=Math.max(mr-Et,Fr),$f(Di,0,Di.length-1,ai)),mr=0,Ui.lineOffset=Math.max(fi,(wi-1)*hi);const Fn=wt*wi+fi;cr+=Fn,Wn=Math.max(Fn,Wn),++Hs}const{horizontalAlign:Ra,verticalAlign:ki}=_p($t);(function(Tn,wi,Ui,Di,fi,$i,Fn,na,ei){const zn=(wi-Ui)*fi;let Vi=0;Vi=$i!==Fn?-na*Di-pp:-Di*ei*Fn+.5*Fn;for(const di of Tn)for(const sn of di.positionedGlyphs)sn.x+=zn,sn.y+=Vi})(pe.positionedLines,ai,Ra,ki,Fr,Wn,wt,cr,dt.length),pe.top+=-ki*cr,pe.bottom=pe.top+cr,pe.left+=-Ra*Fr,pe.right=pe.left+Fr}(ee,l,d,g,me,P,R,N,H,F,Q,ie),!function(pe){for(const Re of pe)if(Re.positionedGlyphs.length!==0)return!1;return!0}(Ee)&&ee}const jm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yu={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Um={40:!0};function $m(f,l,d,g,x,E){if(l.imageName){const P=g[l.imageName];return P?P.displaySize[0]*l.scale*hi/E+x:0}{const P=d[l.fontStack],R=P&&P[f];return R?R.metrics.advance*l.scale+x:0}}function Ah(f,l,d,g){const x=Math.pow(f-l,2);return g?f<l?x/2:2*x:x+Math.abs(d)*d}function bb(f,l,d){let g=0;return f===10&&(g-=1e4),d&&(g+=150),f!==40&&f!==65288||(g+=50),l!==41&&l!==65289||(g+=50),g}function X_(f,l,d,g,x,E){let P=null,R=Ah(l,d,x,E);for(const N of g){const F=Ah(l-N.x,d,x,E)+N.badness;F<=R&&(P=N,R=F)}return{index:f,x:l,priorBreak:P,badness:R}}function G_(f){return f?G_(f.priorBreak).concat(f.index):[]}function gp(f,l,d,g,x,E){if(!f)return[];const P=[],R=function(H,Q,te,ie,oe,me){let we=0;for(let Fe=0;Fe<H.length();Fe++){const Ee=H.getSection(Fe);we+=$m(H.getCharCode(Fe),Ee,ie,oe,Q,me)}return we/Math.max(1,Math.ceil(we/te))}(f,l,d,g,x,E),N=f.text.indexOf("​")>=0;let F=0;for(let H=0;H<f.length();H++){const Q=f.getSection(H),te=f.getCharCode(H);if(jm[te]||(F+=$m(te,Q,g,x,l,E)),H<f.length()-1){const ie=!(($=te)<11904)&&(!!Nr["CJK Compatibility Forms"]($)||!!Nr["CJK Compatibility"]($)||!!Nr["CJK Strokes"]($)||!!Nr["CJK Symbols and Punctuation"]($)||!!Nr["Enclosed CJK Letters and Months"]($)||!!Nr["Halfwidth and Fullwidth Forms"]($)||!!Nr["Ideographic Description Characters"]($)||!!Nr["Vertical Forms"]($)||Mf.test(String.fromCodePoint($)));(yu[te]||ie||Q.imageName||H!==f.length()-2&&Um[f.getCharCode(H+1)])&&P.push(X_(H+1,F,R,P,bb(te,f.getCharCode(H+1),ie&&N),!1))}}var $;return G_(X_(f.length(),F,R,P,0,!0))}function _p(f){let l=.5,d=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function G1(f,l,d){const g=l.getMaxScale()*hi,{maxImageWidth:x,maxImageHeight:E}=l.getMaxImageSize(f),P=Math.max(g,E*d);return{verticalLineContentWidth:Math.max(g,x*d),horizontalLineContentHeight:P}}function xb(f){switch(f){case"top":return 0;case"center":return .5;default:return 1}}function Y1(f,l,d){return!(f===c.al.horizontal||!l&&!lh(d)||l&&(jm[d]||(g=d,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(g)))));var g}function wb(f,l,d,g,x,E){const P=E[f.fontStack],R=function(F,$,H,Q){if(F&&F.rect)return F;const te=$[H.fontStack],ie=te&&te[Q];return ie?{rect:null,metrics:ie.metrics}:null}(P&&P[l],x,f,l);if(R===null)return null;let N;if(d)N=g.verticalLineContentWidth-f.scale*hi;else{const F=xb(f.verticalAlign);N=(g.horizontalLineContentHeight-f.scale*hi)*F}return{rect:R.rect,metrics:R.metrics,baselineOffset:N}}function Tb(f,l,d,g,x){const E=x[f.imageName];if(!E)return null;const P=E.paddedRect,R=E.displaySize,N={width:R[0],height:R[1],left:Ga,top:-3,advance:l?R[1]:R[0]};let F;if(l)F=g.verticalLineContentWidth-R[1]*f.scale;else{const $=xb(f.verticalAlign);F=(g.horizontalLineContentHeight-R[1]*f.scale)*$}return{rect:P,metrics:N,baselineOffset:F,imageOffset:(l?R[0]:R[1])*f.scale-hi*d}}function $f(f,l,d,g){if(g===0)return;const x=f[d],E=(f[d].x+x.metrics.advance*x.scale)*g;for(let P=l;P<=d;P++)f[P].x-=E}function Vm(f,l,d){const{horizontalAlign:g,verticalAlign:x}=_p(d),E=l[0]-f.displaySize[0]*g,P=l[1]-f.displaySize[1]*x;return{image:f,top:P,bottom:P+f.displaySize[1],left:E,right:E+f.displaySize[0]}}function Y_(f){var l,d;let g=f.left,x=f.top,E=f.right-g,P=f.bottom-x;const R=(l=f.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",N=(d=f.image.textFitHeight)!==null&&d!==void 0?d:"stretchOrShrink",F=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(N==="proportional"){if(R==="stretchOnly"&&E/P<F||R==="proportional"){const $=Math.ceil(P*F);g*=$/E,E=$}}else if(R==="proportional"&&N==="stretchOnly"&&F!==0&&E/P>F){const $=Math.ceil(E/F);x*=$/P,P=$}return{x1:g,y1:x,x2:g+E,y2:x+P}}function K_(f,l,d,g,x,E){const P=f.image;let R;if(P.content){const me=P.content,we=P.pixelRatio||1;R=[me[0]/we,me[1]/we,P.displaySize[0]-me[2]/we,P.displaySize[1]-me[3]/we]}const N=l.left*E,F=l.right*E;let $,H,Q,te;d==="width"||d==="both"?(te=x[0]+N-g[3],H=x[0]+F+g[1]):(te=x[0]+(N+F-P.displaySize[0])/2,H=te+P.displaySize[0]);const ie=l.top*E,oe=l.bottom*E;return d==="height"||d==="both"?($=x[1]+ie-g[0],Q=x[1]+oe+g[2]):($=x[1]+(ie+oe-P.displaySize[1])/2,Q=$+P.displaySize[1]),{image:P,top:$,right:H,bottom:Q,left:te,collisionPadding:R}}const Vf=255,$o=128,Cc=Vf*$o;function Q_(f,l){const{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new cn(f+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:x}=d;let E=0;for(;E<g.length&&g[E]<=f;)E++;E=Math.max(0,E-1);let P=E;for(;P<g.length&&g[P]<f+1;)P++;P=Math.min(g.length-1,P);const R=g[E],N=g[P];return d.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:N,interpolationType:x}:{kind:"camera",minZoom:R,maxZoom:N,minSize:d.evaluate(new cn(R)),maxSize:d.evaluate(new cn(N)),interpolationType:x}}}function qf(f,l,d){let g="never";const x=f.get(l);return x?g=x:f.get(d)&&(g="always"),g}const Sb=zf.VectorTileFeature.types,Ab=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fn(f,l,d,g,x,E,P,R,N,F,$,H,Q){const te=R?Math.min(Cc,Math.round(R[0])):0,ie=R?Math.min(Cc,Math.round(R[1])):0;f.emplaceBack(l,d,Math.round(32*g),Math.round(32*x),E,P,(te<<1)+(N?1:0),ie,16*F,16*$,256*H,256*Q)}function yp(f,l,d){f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d)}function K1(f){for(const l of f.sections)if(bm(l.text))return!0;return!1}class qm{constructor(l){this.layoutVertexArray=new lt,this.indexArray=new Ht,this.programConfigurations=l,this.segments=new Tr,this.dynamicLayoutVertexArray=new At,this.opacityVertexArray=new St,this.hasVisibleVertices=!1,this.placedSymbolArray=new j}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,g,x){this.isEmpty()||(g&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,H_.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Mc.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,Ab,!0),this.opacityVertexBuffer.itemSize=1),(g||x)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Jt("SymbolBuffers",qm);class J_{constructor(l,d,g){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new g,this.segments=new Tr,this.collisionVertexArray=new Wt}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,xi.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Jt("CollisionBuffers",J_);class Hf{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(P=>P.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Q_(this.zoom,d["text-size"]),this.iconSizeData=Q_(this.zoom,d["icon-size"]);const g=this.layers[0].layout,x=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=qf(g,"text-overlap","text-allow-overlap")!=="never"||qf(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&!x.isConstant(),this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(P=>c.al[P])),this.stateDependentLayerIds=this.layers.filter(P=>P.isStateDependent()).map(P=>P.id),this.sourceID=l.sourceID}createArrays(){this.text=new qm(new Ml(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new qm(new Ml(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new G,this.lineVertexArray=new ae,this.symbolInstances=new X,this.textAnchorOffsets=new ve}calculateGlyphDependencies(l,d,g,x,E){for(let P=0;P<l.length;P++)if(d[l.charCodeAt(P)]=!0,(g||x)&&E){const R=Xa[l.charAt(P)];R&&(d[R.charCodeAt(0)]=!0)}}populate(l,d,g){const x=this.layers[0],E=x.layout,P=E.get("text-font"),R=E.get("text-field"),N=E.get("icon-image"),F=(R.value.kind!=="constant"||R.value.value instanceof za&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),$=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,H=E.get("symbol-sort-key");if(this.features=[],!F&&!$)return;const Q=d.iconDependencies,te=d.glyphDependencies,ie=d.availableImages,oe=new cn(this.zoom);for(const{feature:me,id:we,index:Fe,sourceLayerIndex:Ee}of l){const ee=x._featureFilter.needGeometry,pe=qs(me,ee);if(!x._featureFilter.filter(oe,pe,g))continue;let Re,st;if(ee||(pe.geometry=ta(me)),F){const dt=x.getValueAndResolveTokens("text-field",pe,g,ie),wt=za.factory(dt),$t=this.hasRTLText=this.hasRTLText||K1(wt);(!$t||Ma.getRTLTextPluginStatus()==="unavailable"||$t&&Ma.isParsed())&&(Re=W_(wt,x,pe))}if($){const dt=x.getValueAndResolveTokens("icon-image",pe,g,ie);st=dt instanceof Bi?dt:Bi.fromString(dt)}if(!Re&&!st)continue;const Nt=this.sortFeaturesByKey?H.evaluate(pe,{},g):void 0;if(this.features.push({id:we,text:Re,icon:st,index:Fe,sourceLayerIndex:Ee,geometry:pe.geometry,properties:me.properties,type:Sb[me.type],sortKey:Nt}),st&&(Q[st.name]=!0),Re){const dt=P.evaluate(pe,{},g).join(","),wt=E.get("text-rotation-alignment")!=="viewport"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.al.vertical)>=0;for(const $t of Re.sections)if($t.image)Q[$t.image.name]=!0;else{const Lt=fc(Re.toString()),qt=$t.fontStack||dt,Et=te[qt]=te[qt]||{};this.calculateGlyphDependencies($t.text,Et,wt,this.allowVerticalPlacement,Lt)}}}E.get("symbol-placement")==="line"&&(this.features=function(me){const we={},Fe={},Ee=[];let ee=0;function pe(dt){Ee.push(me[dt]),ee++}function Re(dt,wt,$t){const Lt=Fe[dt];return delete Fe[dt],Fe[wt]=Lt,Ee[Lt].geometry[0].pop(),Ee[Lt].geometry[0]=Ee[Lt].geometry[0].concat($t[0]),Lt}function st(dt,wt,$t){const Lt=we[wt];return delete we[wt],we[dt]=Lt,Ee[Lt].geometry[0].shift(),Ee[Lt].geometry[0]=$t[0].concat(Ee[Lt].geometry[0]),Lt}function Nt(dt,wt,$t){const Lt=$t?wt[0][wt[0].length-1]:wt[0][0];return`${dt}:${Lt.x}:${Lt.y}`}for(let dt=0;dt<me.length;dt++){const wt=me[dt],$t=wt.geometry,Lt=wt.text?wt.text.toString():null;if(!Lt){pe(dt);continue}const qt=Nt(Lt,$t),Et=Nt(Lt,$t,!0);if(qt in Fe&&Et in we&&Fe[qt]!==we[Et]){const ir=st(qt,Et,$t),br=Re(qt,Et,Ee[ir].geometry);delete we[qt],delete Fe[Et],Fe[Nt(Lt,Ee[br].geometry,!0)]=br,Ee[ir].geometry=null}else qt in Fe?Re(qt,Et,$t):Et in we?st(qt,Et,$t):(pe(dt),we[qt]=ee-1,Fe[Et]=ee-1)}return Ee.filter(dt=>dt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,we)=>me.sortKey-we.sortKey)}update(l,d,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,g),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){const g=this.lineVertexArray.length;if(l.segment!==void 0){let x=l.dist(d[l.segment+1]),E=l.dist(d[l.segment]);const P={};for(let R=l.segment+1;R<d.length;R++)P[R]={x:d[R].x,y:d[R].y,tileUnitDistanceFromAnchor:x},R<d.length-1&&(x+=d[R+1].dist(d[R]));for(let R=l.segment||0;R>=0;R--)P[R]={x:d[R].x,y:d[R].y,tileUnitDistanceFromAnchor:E},R>0&&(E+=d[R-1].dist(d[R]));for(let R=0;R<d.length;R++){const N=P[R];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(l,d,g,x,E,P,R,N,F,$,H,Q){const te=l.indexArray,ie=l.layoutVertexArray,oe=l.segments.prepareSegment(4*d.length,ie,te,this.canOverlap?P.sortKey:void 0),me=this.glyphOffsetArray.length,we=oe.vertexLength,Fe=this.allowVerticalPlacement&&R===c.al.vertical?Math.PI/2:0,Ee=P.text&&P.text.sections;for(let ee=0;ee<d.length;ee++){const{tl:pe,tr:Re,bl:st,br:Nt,tex:dt,pixelOffsetTL:wt,pixelOffsetBR:$t,minFontScaleX:Lt,minFontScaleY:qt,glyphOffset:Et,isSDF:ir,sectionIndex:br}=d[ee],mr=oe.vertexLength,cr=Et[1];fn(ie,N.x,N.y,pe.x,cr+pe.y,dt.x,dt.y,g,ir,wt.x,wt.y,Lt,qt),fn(ie,N.x,N.y,Re.x,cr+Re.y,dt.x+dt.w,dt.y,g,ir,$t.x,wt.y,Lt,qt),fn(ie,N.x,N.y,st.x,cr+st.y,dt.x,dt.y+dt.h,g,ir,wt.x,$t.y,Lt,qt),fn(ie,N.x,N.y,Nt.x,cr+Nt.y,dt.x+dt.w,dt.y+dt.h,g,ir,$t.x,$t.y,Lt,qt),yp(l.dynamicLayoutVertexArray,N,Fe),te.emplaceBack(mr,mr+2,mr+1),te.emplaceBack(mr+1,mr+2,mr+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),ee!==d.length-1&&br===d[ee+1].sectionIndex||l.programConfigurations.populatePaintArrays(ie.length,P,P.index,{},Q,Ee&&Ee[br])}l.placedSymbolArray.emplaceBack(N.x,N.y,me,this.glyphOffsetArray.length-me,we,F,$,N.segment,g?g[0]:0,g?g[1]:0,x[0],x[1],R,0,!1,0,H)}_addCollisionDebugVertex(l,d,g,x,E,P){return d.emplaceBack(0,0),l.emplaceBack(g.x,g.y,x,E,Math.round(P.x),Math.round(P.y))}addCollisionDebugVertices(l,d,g,x,E,P,R){const N=E.segments.prepareSegment(4,E.layoutVertexArray,E.indexArray),F=N.vertexLength,$=E.layoutVertexArray,H=E.collisionVertexArray,Q=R.anchorX,te=R.anchorY;this._addCollisionDebugVertex($,H,P,Q,te,new z(l,d)),this._addCollisionDebugVertex($,H,P,Q,te,new z(g,d)),this._addCollisionDebugVertex($,H,P,Q,te,new z(g,x)),this._addCollisionDebugVertex($,H,P,Q,te,new z(l,x)),N.vertexLength+=4;const ie=E.indexArray;ie.emplaceBack(F,F+1),ie.emplaceBack(F+1,F+2),ie.emplaceBack(F+2,F+3),ie.emplaceBack(F+3,F),N.primitiveLength+=4}addDebugCollisionBoxes(l,d,g,x){for(let E=l;E<d;E++){const P=this.collisionBoxArray.get(E);this.addCollisionDebugVertices(P.x1,P.y1,P.x2,P.y2,x?this.textCollisionBox:this.iconCollisionBox,P.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new J_(Tt,Pc.members,Rt),this.iconCollisionBox=new J_(Tt,Pc.members,Rt);for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(l,d,g,x,E,P,R,N,F){const $={};for(let H=d;H<g;H++){const Q=l.get(H);$.textBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},$.textFeatureIndex=Q.featureIndex;break}for(let H=x;H<E;H++){const Q=l.get(H);$.verticalTextBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},$.verticalTextFeatureIndex=Q.featureIndex;break}for(let H=P;H<R;H++){const Q=l.get(H);$.iconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},$.iconFeatureIndex=Q.featureIndex;break}for(let H=N;H<F;H++){const Q=l.get(H);$.verticalIconBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},$.verticalIconFeatureIndex=Q.featureIndex;break}return $}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){const g=l.placedSymbolArray.get(d),x=g.vertexStartIndex+4*g.numGlyphs;for(let E=g.vertexStartIndex;E<x;E+=4)l.indexArray.emplaceBack(E,E+2,E+1),l.indexArray.emplaceBack(E+1,E+2,E+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(l),g=Math.cos(l),x=[],E=[],P=[];for(let R=0;R<this.symbolInstances.length;++R){P.push(R);const N=this.symbolInstances.get(R);x.push(0|Math.round(d*N.anchorX+g*N.anchorY)),E.push(N.featureIndex)}return P.sort((R,N)=>x[R]-x[N]||E[N]-E[R]),P}addToSortKeyRanges(l,d){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===d?g.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const g=this.symbolInstances.get(d);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((x,E,P)=>{x>=0&&P.indexOf(x)===E&&this.addIndicesForPlacedSymbol(this.text,x)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Eb,vp;Jt("SymbolBucket",Hf,{omit:["layers","collisionBoxArray","features","compareText"]}),Hf.MAX_GLYPHS=65535,Hf.addDynamicAttributes=yp;var vu={get paint(){return vp=vp||new da({"icon-opacity":new xr(fe.paint_symbol["icon-opacity"]),"icon-color":new xr(fe.paint_symbol["icon-color"]),"icon-halo-color":new xr(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new xr(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xr(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new ur(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ur(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new xr(fe.paint_symbol["text-opacity"]),"text-color":new xr(fe.paint_symbol["text-color"],{runtimeType:mi,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new xr(fe.paint_symbol["text-halo-color"]),"text-halo-width":new xr(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new xr(fe.paint_symbol["text-halo-blur"]),"text-translate":new ur(fe.paint_symbol["text-translate"]),"text-translate-anchor":new ur(fe.paint_symbol["text-translate-anchor"])})},get layout(){return Eb=Eb||new da({"symbol-placement":new ur(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new ur(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ur(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xr(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ur(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ur(fe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ur(fe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ur(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ur(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ur(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new xr(fe.layout_symbol["icon-size"]),"icon-text-fit":new ur(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ur(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new xr(fe.layout_symbol["icon-image"]),"icon-rotate":new xr(fe.layout_symbol["icon-rotate"]),"icon-padding":new xr(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new ur(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new xr(fe.layout_symbol["icon-offset"]),"icon-anchor":new xr(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ur(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ur(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ur(fe.layout_symbol["text-rotation-alignment"]),"text-field":new xr(fe.layout_symbol["text-field"]),"text-font":new xr(fe.layout_symbol["text-font"]),"text-size":new xr(fe.layout_symbol["text-size"]),"text-max-width":new xr(fe.layout_symbol["text-max-width"]),"text-line-height":new ur(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new xr(fe.layout_symbol["text-letter-spacing"]),"text-justify":new xr(fe.layout_symbol["text-justify"]),"text-radial-offset":new xr(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ur(fe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xr(fe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xr(fe.layout_symbol["text-anchor"]),"text-max-angle":new ur(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new ur(fe.layout_symbol["text-writing-mode"]),"text-rotate":new xr(fe.layout_symbol["text-rotate"]),"text-padding":new ur(fe.layout_symbol["text-padding"]),"text-keep-upright":new ur(fe.layout_symbol["text-keep-upright"]),"text-transform":new xr(fe.layout_symbol["text-transform"]),"text-offset":new xr(fe.layout_symbol["text-offset"]),"text-allow-overlap":new ur(fe.layout_symbol["text-allow-overlap"]),"text-overlap":new ur(fe.layout_symbol["text-overlap"]),"text-ignore-placement":new ur(fe.layout_symbol["text-ignore-placement"]),"text-optional":new ur(fe.layout_symbol["text-optional"])})}};class Hm{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:qr,this.defaultValue=l}evaluate(l){if(l.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Jt("FormatSectionOverride",Hm,{omit:["defaultValue"]});class Eh extends Ji{constructor(l){super(l,vu)}recalculate(l,d){if(super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const x=[];for(const E of g)x.indexOf(E)<0&&x.push(E);this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,d,g,x){const E=this.layout.get(l).evaluate(d,{},g,x),P=this._unevaluatedLayout._values[l];return P.isDataDriven()||lc(P.value)||!E?E:function(R,N){return N.replace(/{([^{}]+)}/g,(F,$)=>R&&$ in R?String(R[$]):"")}(d.properties,E)}createBucket(l){return new Hf(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of vu.paint.overridableProperties){if(!Eh.hasPaintOverride(this.layout,l))continue;const d=this.paint.get(l),g=new Hm(d),x=new gl(g,d.property.specification);let E=null;E=d.value.kind==="constant"||d.value.kind==="source"?new nh("source",x):new Ns("composite",x,d.value.zoomStops),this.paint._values[l]=new qa(d.property,E,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,g){return!(!this.layout||d.isDataDriven()||g.isDataDriven())&&Eh.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){const g=l.get("text-field"),x=vu.paint.properties[d];let E=!1;const P=R=>{for(const N of R)if(x.overrides&&x.overrides.hasOverride(N))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof za)P(g.value.value.sections);else if(g.value.kind==="source"){const R=F=>{E||(F instanceof oa&&jn(F.value)===rl?P(F.value.sections):F instanceof qu?P(F.sections):F.eachChild(R))},N=g.value;N._styleExpression&&R(N._styleExpression.expression)}return E}}let Wm;var Mh={get paint(){return Wm=Wm||new da({"background-color":new ur(fe.paint_background["background-color"]),"background-pattern":new uu(fe.paint_background["background-pattern"]),"background-opacity":new ur(fe.paint_background["background-opacity"])})}};class Ol extends Ji{constructor(l){super(l,Mh)}}let Wf;var Q1={get paint(){return Wf=Wf||new da({"raster-opacity":new ur(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new ur(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ur(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ur(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new ur(fe.paint_raster["raster-saturation"]),"raster-contrast":new ur(fe.paint_raster["raster-contrast"]),"raster-resampling":new ur(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new ur(fe.paint_raster["raster-fade-duration"])})}};class Mb extends Ji{constructor(l){super(l,Q1)}}class Pb extends Ji{constructor(l){super(l,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Cb{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Rb={once:!0},ey=63710088e-1;class kl{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new kl(Pt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const d=Math.PI/180,g=this.lat*d,x=l.lat*d,E=Math.sin(g)*Math.sin(x)+Math.cos(g)*Math.cos(x)*Math.cos((l.lng-this.lng)*d);return ey*Math.acos(Math.min(E,1))}static convert(l){if(l instanceof kl)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new kl(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new kl(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ty=2*Math.PI*ey;function ry(f){return ty*Math.cos(f*Math.PI/180)}function Ib(f){return(180+f)/360}function Zm(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function Xm(f,l){return f/ry(l)}function ny(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}function Ob(f,l){return f*ry(ny(l))}class Rc{constructor(l,d,g=0){this.x=+l,this.y=+d,this.z=+g}static fromLngLat(l,d=0){const g=kl.convert(l);return new Rc(Ib(g.lng),Zm(g.lat),Xm(d,g.lat))}toLngLat(){return new kl(360*this.x-180,ny(this.y))}toAltitude(){return Ob(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ty*(l=ny(this.y),1/Math.cos(l*Math.PI/180));var l}}function kb(f,l,d){var g=2*Math.PI*6378137/256/Math.pow(2,d);return[f*g-2*Math.PI*6378137/2,l*g-2*Math.PI*6378137/2]}class Gm{constructor(l,d,g){if(!function(x,E,P){return!(x<0||x>25||P<0||P>=Math.pow(2,x)||E<0||E>=Math.pow(2,x))}(l,d,g))throw new Error(`x=${d}, y=${g}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=d,this.y=g,this.key=Ic(0,l,l,d,g)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d,g){const x=(P=this.y,R=this.z,N=kb(256*(E=this.x),256*(P=Math.pow(2,R)-P-1),R),F=kb(256*(E+1),256*(P+1),R),N[0]+","+N[1]+","+F[0]+","+F[1]);var E,P,R,N,F;const $=function(H,Q,te){let ie,oe="";for(let me=H;me>0;me--)ie=1<<me-1,oe+=(Q&ie?1:0)+(te&ie?2:0);return oe}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,x)}isChildOf(l){const d=this.z-l.z;return d>0&&l.x===this.x>>d&&l.y===this.y>>d}getTilePoint(l){const d=Math.pow(2,this.z);return new z((l.x*d-this.x)*ot,(l.y*d-this.y)*ot)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zr{constructor(l,d){this.wrap=l,this.canonical=d,this.key=Ic(l,d.z,d.z,d.x,d.y)}}class us{constructor(l,d,g,x,E){if(this.terrainRttPosMatrix32f=null,l<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${g}`);this.overscaledZ=l,this.wrap=d,this.canonical=new Gm(g,+x,+E),this.key=Ic(d,l,g,x,E)}clone(){return new us(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-l;return l>this.canonical.z?new us(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new us(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-l;return l>this.canonical.z?Ic(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y):Ic(this.wrap*+d,l,l,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new us(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,g=2*this.canonical.x,x=2*this.canonical.y;return[new us(d,this.wrap,d,g,x),new us(d,this.wrap,d,g+1,x),new us(d,this.wrap,d,g,x+1),new us(d,this.wrap,d,g+1,x+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new us(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new us(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new Rc(l.x-this.wrap,l.y))}}function Ic(f,l,d,g,x){(f*=2)<0&&(f=-1*f-1);const E=1<<d;return(E*E*f+E*x+g).toString(36)+d.toString(36)+l.toString(36)}Jt("CanonicalTileID",Gm),Jt("OverscaledTileID",us,{omit:["terrainRttPosMatrix32f"]});class Ym{constructor(l,d,g,x=1,E=1,P=1,R=0){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void hr(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;const N=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=x,this.greenFactor=E,this.blueFactor=P,this.baseShift=R;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<N;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(N,F)]=this.data[this._idx(N-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,N)]=this.data[this._idx(F,N-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(N,-1)]=this.data[this._idx(N-1,0)],this.data[this._idx(-1,N)]=this.data[this._idx(0,N-1)],this.data[this._idx(N,N)]=this.data[this._idx(N-1,N-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<N;F++)for(let $=0;$<N;$++){const H=this.get(F,$);H>this.max&&(this.max=H),H<this.min&&(this.min=H)}}get(l,d){const g=new Uint8Array(this.data.buffer),x=4*this._idx(l,d);return this.unpack(g[x],g[x+1],g[x+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}unpack(l,d,g){return l*this.redFactor+d*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new bn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,d,g){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let x=d*this.dim,E=d*this.dim+this.dim,P=g*this.dim,R=g*this.dim+this.dim;switch(d){case-1:x=E-1;break;case 1:E=x+1}switch(g){case-1:P=R-1;break;case 1:R=P+1}const N=-d*this.dim,F=-g*this.dim;for(let $=P;$<R;$++)for(let H=x;H<E;H++)this.data[this._idx(H,$)]=l.data[this._idx(H+N,$+F)]}}Jt("DEMData",Ym);class iy{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){const g=l[d];this._stringToNumber[g]=d,this._numberToString[d]=g}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class Km{constructor(l,d,g,x,E){this.type="Feature",this._vectorTileFeature=l,l._z=d,l._x=g,l._y=x,this.properties=l.properties,this.id=E}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(l[d]=this[d]);return l}}class Zf{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new ns(ot,16,0),this.grid3D=new ns(ot,16,0),this.featureIndexArray=new xe,this.promoteId=d}insert(l,d,g,x,E,P){const R=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,x,E);const N=P?this.grid3D:this.grid;for(let F=0;F<d.length;F++){const $=d[F],H=[1/0,1/0,-1/0,-1/0];for(let Q=0;Q<$.length;Q++){const te=$[Q];H[0]=Math.min(H[0],te.x),H[1]=Math.min(H[1],te.y),H[2]=Math.max(H[2],te.x),H[3]=Math.max(H[3],te.y)}H[0]<ot&&H[1]<ot&&H[2]>=0&&H[3]>=0&&N.insert(R,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zf.VectorTile(new Il(this.rawTileData)).layers,this.sourceLayerCoder=new iy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,d,g,x){this.loadVTLayers();const E=l.params,P=ot/l.tileSize/l.scale,R=_l(E.filter),N=l.queryGeometry,F=l.queryPadding*P,$=Ph(N),H=this.grid.query($.minX-F,$.minY-F,$.maxX+F,$.maxY+F),Q=Ph(l.cameraQueryGeometry),te=this.grid3D.query(Q.minX-F,Q.minY-F,Q.maxX+F,Q.maxY+F,(me,we,Fe,Ee)=>function(ee,pe,Re,st,Nt){for(const wt of ee)if(pe<=wt.x&&Re<=wt.y&&st>=wt.x&&Nt>=wt.y)return!0;const dt=[new z(pe,Re),new z(pe,Nt),new z(st,Nt),new z(st,Re)];if(ee.length>2){for(const wt of dt)if(xc(ee,wt))return!0}for(let wt=0;wt<ee.length-1;wt++)if(E_(ee[wt],ee[wt+1],dt))return!0;return!1}(l.cameraQueryGeometry,me-F,we-F,Fe+F,Ee+F));for(const me of te)H.push(me);H.sort(Db);const ie={};let oe;for(let me=0;me<H.length;me++){const we=H[me];if(we===oe)continue;oe=we;const Fe=this.featureIndexArray.get(we);let Ee=null;this.loadMatchingFeature(ie,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,R,E.layers,E.availableImages,d,g,x,(ee,pe,Re)=>(Ee||(Ee=ta(ee)),pe.queryIntersectsFeature({queryGeometry:N,feature:ee,featureState:Re,geometry:Ee,zoom:this.z,transform:l.transform,pixelsToTileUnits:P,pixelPosMatrix:l.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:l.getElevation})))}return ie}loadMatchingFeature(l,d,g,x,E,P,R,N,F,$,H){const Q=this.bucketLayerIDs[d];if(P&&!Q.some(me=>P.has(me)))return;const te=this.sourceLayerCoder.decode(g),ie=this.vtLayers[te].feature(x);if(E.needGeometry){const me=qs(ie,!0);if(!E.filter(new cn(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!E.filter(new cn(this.tileID.overscaledZ),ie))return;const oe=this.getId(ie,te);for(let me=0;me<Q.length;me++){const we=Q[me];if(P&&!P.has(we))continue;const Fe=N[we];if(!Fe)continue;let Ee={};oe&&$&&(Ee=$.getState(Fe.sourceLayer||"_geojsonTileLayer",oe));const ee=tr({},F[we]);ee.paint=bp(ee.paint,Fe.paint,ie,Ee,R),ee.layout=bp(ee.layout,Fe.layout,ie,Ee,R);const pe=!H||H(ie,Fe,Ee);if(!pe)continue;const Re=new Km(ie,this.z,this.x,this.y,oe);Re.layer=ee;let st=l[we];st===void 0&&(st=l[we]=[]),st.push({featureIndex:x,feature:Re,intersectionZ:pe})}}lookupSymbolFeatures(l,d,g,x,E,P,R,N){const F={};this.loadVTLayers();const $=_l(E);for(const H of l)this.loadMatchingFeature(F,g,x,H,$,P,R,N,d);return F}hasLayer(l){for(const d of this.bucketLayerIDs)for(const g of d)if(l===g)return!0;return!1}getId(l,d){var g;let x=l.id;return this.promoteId&&(x=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof x=="boolean"&&(x=Number(x)),x===void 0&&(!((g=l.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(x=Number(l.properties.cluster_id))),x}}function bp(f,l,d,g,x){return zt(f,(E,P)=>{const R=l instanceof Tl?l.get(P):null;return R&&R.evaluate?R.evaluate(d,g,x):R})}function Ph(f){let l=1/0,d=1/0,g=-1/0,x=-1/0;for(const E of f)l=Math.min(l,E.x),d=Math.min(d,E.y),g=Math.max(g,E.x),x=Math.max(x,E.y);return{minX:l,minY:d,maxX:g,maxY:x}}function Db(f,l){return l-f}function Nb(f,l,d,g,x){const E=[];for(let P=0;P<f.length;P++){const R=f[P];let N;for(let F=0;F<R.length-1;F++){let $=R[F],H=R[F+1];$.x<l&&H.x<l||($.x<l?$=new z(l,$.y+(l-$.x)/(H.x-$.x)*(H.y-$.y))._round():H.x<l&&(H=new z(l,$.y+(l-$.x)/(H.x-$.x)*(H.y-$.y))._round()),$.y<d&&H.y<d||($.y<d?$=new z($.x+(d-$.y)/(H.y-$.y)*(H.x-$.x),d)._round():H.y<d&&(H=new z($.x+(d-$.y)/(H.y-$.y)*(H.x-$.x),d)._round()),$.x>=g&&H.x>=g||($.x>=g?$=new z(g,$.y+(g-$.x)/(H.x-$.x)*(H.y-$.y))._round():H.x>=g&&(H=new z(g,$.y+(g-$.x)/(H.x-$.x)*(H.y-$.y))._round()),$.y>=x&&H.y>=x||($.y>=x?$=new z($.x+(x-$.y)/(H.y-$.y)*(H.x-$.x),x)._round():H.y>=x&&(H=new z($.x+(x-$.y)/(H.y-$.y)*(H.x-$.x),x)._round()),N&&$.equals(N[N.length-1])||(N=[$],E.push(N)),N.push(H)))))}}return E}Jt("FeatureIndex",Zf,{omit:["rawTileData","sourceLayerCoder"]});class bu extends z{constructor(l,d,g,x){super(l,d),this.angle=g,x!==void 0&&(this.segment=x)}clone(){return new bu(this.x,this.y,this.angle,this.segment)}}function ay(f,l,d,g,x){if(l.segment===void 0||d===0)return!0;let E=l,P=l.segment+1,R=0;for(;R>-d/2;){if(P--,P<0)return!1;R-=f[P].dist(E),E=f[P]}R+=f[P].dist(f[P+1]),P++;const N=[];let F=0;for(;R<d/2;){const $=f[P],H=f[P+1];if(!H)return!1;let Q=f[P-1].angleTo($)-$.angleTo(H);for(Q=Math.abs((Q+3*Math.PI)%(2*Math.PI)-Math.PI),N.push({distance:R,angleDelta:Q}),F+=Q;R-N[0].distance>g;)F-=N.shift().angleDelta;if(F>x)return!1;P++,R+=$.dist(H)}return!0}function sy(f){let l=0;for(let d=0;d<f.length-1;d++)l+=f[d].dist(f[d+1]);return l}function xp(f,l,d){return f?.6*l*d:0}function wn(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function oy(f,l,d,g,x,E){const P=xp(d,x,E),R=wn(d,g)*E;let N=0;const F=sy(f)/2;for(let $=0;$<f.length-1;$++){const H=f[$],Q=f[$+1],te=H.dist(Q);if(N+te>F){const ie=(F-N)/te,oe=_n.number(H.x,Q.x,ie),me=_n.number(H.y,Q.y,ie),we=new bu(oe,me,Q.angleTo(H),$);return we._round(),!P||ay(f,we,R,P,l)?we:void 0}N+=te}}function Ca(f,l,d,g,x,E,P,R,N){const F=xp(g,E,P),$=wn(g,x),H=$*P,Q=f[0].x===0||f[0].x===N||f[0].y===0||f[0].y===N;return l-H<l/4&&(l=H+l/4),Bb(f,Q?l/2*R%l:($/2+2*E)*P*R%l,l,F,d,H,Q,!1,N)}function Bb(f,l,d,g,x,E,P,R,N){const F=E/2,$=sy(f);let H=0,Q=l-d,te=[];for(let ie=0;ie<f.length-1;ie++){const oe=f[ie],me=f[ie+1],we=oe.dist(me),Fe=me.angleTo(oe);for(;Q+d<H+we;){Q+=d;const Ee=(Q-H)/we,ee=_n.number(oe.x,me.x,Ee),pe=_n.number(oe.y,me.y,Ee);if(ee>=0&&ee<N&&pe>=0&&pe<N&&Q-F>=0&&Q+F<=$){const Re=new bu(ee,pe,Fe,ie);Re._round(),g&&!ay(f,Re,E,g,x)||te.push(Re)}}H+=we}return R||te.length||P||(te=Bb(f,H/2,d,g,x,E,P,!0,N)),te}Jt("Anchor",bu);const Ch=Ga;function Qm(f,l,d,g){const x=[],E=f.image,P=E.pixelRatio,R=E.paddedRect.w-2*Ch,N=E.paddedRect.h-2*Ch;let F={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};const $=E.stretchX||[[0,R]],H=E.stretchY||[[0,N]],Q=(Et,ir)=>Et+ir[1]-ir[0],te=$.reduce(Q,0),ie=H.reduce(Q,0),oe=R-te,me=N-ie;let we=0,Fe=te,Ee=0,ee=ie,pe=0,Re=oe,st=0,Nt=me;if(E.content&&g){const Et=E.content,ir=Et[2]-Et[0],br=Et[3]-Et[1];(E.textFitWidth||E.textFitHeight)&&(F=Y_(f)),we=Rh($,0,Et[0]),Ee=Rh(H,0,Et[1]),Fe=Rh($,Et[0],Et[2]),ee=Rh(H,Et[1],Et[3]),pe=Et[0]-we,st=Et[1]-Ee,Re=ir-Fe,Nt=br-ee}const dt=F.x1,wt=F.y1,$t=F.x2-dt,Lt=F.y2-wt,qt=(Et,ir,br,mr)=>{const cr=wp(Et.stretch-we,Fe,$t,dt),Fr=Xf(Et.fixed-pe,Re,Et.stretch,te),Wn=wp(ir.stretch-Ee,ee,Lt,wt),ai=Xf(ir.fixed-st,Nt,ir.stretch,ie),_a=wp(br.stretch-we,Fe,$t,dt),Hs=Xf(br.fixed-pe,Re,br.stretch,te),Ra=wp(mr.stretch-Ee,ee,Lt,wt),ki=Xf(mr.fixed-st,Nt,mr.stretch,ie),Tn=new z(cr,Wn),wi=new z(_a,Wn),Ui=new z(_a,Ra),Di=new z(cr,Ra),fi=new z(Fr/P,ai/P),$i=new z(Hs/P,ki/P),Fn=l*Math.PI/180;if(Fn){const zn=Math.sin(Fn),Vi=Math.cos(Fn),di=[Vi,-zn,zn,Vi];Tn._matMult(di),wi._matMult(di),Di._matMult(di),Ui._matMult(di)}const na=Et.stretch+Et.fixed,ei=ir.stretch+ir.fixed;return{tl:Tn,tr:wi,bl:Di,br:Ui,tex:{x:E.paddedRect.x+Ch+na,y:E.paddedRect.y+Ch+ei,w:br.stretch+br.fixed-na,h:mr.stretch+mr.fixed-ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:$i,minFontScaleX:Re/P/$t,minFontScaleY:Nt/P/Lt,isSDF:d}};if(g&&(E.stretchX||E.stretchY)){const Et=ly($,oe,te),ir=ly(H,me,ie);for(let br=0;br<Et.length-1;br++){const mr=Et[br],cr=Et[br+1];for(let Fr=0;Fr<ir.length-1;Fr++)x.push(qt(mr,ir[Fr],cr,ir[Fr+1]))}}else x.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:N+1}));return x}function Rh(f,l,d){let g=0;for(const x of f)g+=Math.max(l,Math.min(d,x[1]))-Math.max(l,Math.min(d,x[0]));return g}function ly(f,l,d){const g=[{fixed:-1,stretch:0}];for(const[x,E]of f){const P=g[g.length-1];g.push({fixed:x-P.stretch,stretch:P.stretch}),g.push({fixed:x-P.stretch,stretch:P.stretch+(E-x)})}return g.push({fixed:l+Ch,stretch:d}),g}function wp(f,l,d,g){return f/l*d+g}function Xf(f,l,d,g){return f-l*d/g}class Gf{constructor(l,d,g,x,E,P,R,N,F,$){var H;if(this.boxStartIndex=l.length,F){let Q=P.top,te=P.bottom;const ie=P.collisionPadding;ie&&(Q-=ie[1],te+=ie[3]);let oe=te-Q;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{const Q=!((H=P.image)===null||H===void 0)&&H.content&&(P.image.textFitWidth||P.image.textFitHeight)?Y_(P):{x1:P.left,y1:P.top,x2:P.right,y2:P.bottom};Q.y1=Q.y1*R-N[0],Q.y2=Q.y2*R+N[2],Q.x1=Q.x1*R-N[3],Q.x2=Q.x2*R+N[1];const te=P.collisionPadding;if(te&&(Q.x1-=te[0]*R,Q.y1-=te[1]*R,Q.x2+=te[2]*R,Q.y2+=te[3]*R),$){const ie=new z(Q.x1,Q.y1),oe=new z(Q.x2,Q.y1),me=new z(Q.x1,Q.y2),we=new z(Q.x2,Q.y2),Fe=$*Math.PI/180;ie._rotate(Fe),oe._rotate(Fe),me._rotate(Fe),we._rotate(Fe),Q.x1=Math.min(ie.x,oe.x,me.x,we.x),Q.x2=Math.max(ie.x,oe.x,me.x,we.x),Q.y1=Math.min(ie.y,oe.y,me.y,we.y),Q.y2=Math.max(ie.y,oe.y,me.y,we.y)}l.emplaceBack(d.x,d.y,Q.x1,Q.y1,Q.x2,Q.y2,g,x,E)}this.boxEndIndex=l.length}}class J1{constructor(l=[],d=(g,x)=>g<x?-1:g>x?1:0){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:d,compare:g}=this,x=d[l];for(;l>0;){const E=l-1>>1,P=d[E];if(g(x,P)>=0)break;d[l]=P,l=E}d[l]=x}_down(l){const{data:d,compare:g}=this,x=this.length>>1,E=d[l];for(;l<x;){let P=1+(l<<1);const R=P+1;if(R<this.length&&g(d[R],d[P])<0&&(P=R),g(d[P],E)>=0)break;d[l]=d[P],l=P}d[l]=E}}function Lb(f,l=1,d=!1){let g=1/0,x=1/0,E=-1/0,P=-1/0;const R=f[0];for(let te=0;te<R.length;te++){const ie=R[te];(!te||ie.x<g)&&(g=ie.x),(!te||ie.y<x)&&(x=ie.y),(!te||ie.x>E)&&(E=ie.x),(!te||ie.y>P)&&(P=ie.y)}const N=Math.min(E-g,P-x);let F=N/2;const $=new J1([],ew);if(N===0)return new z(g,x);for(let te=g;te<E;te+=N)for(let ie=x;ie<P;ie+=N)$.push(new Ih(te+F,ie+F,F,f));let H=function(te){let ie=0,oe=0,me=0;const we=te[0];for(let Fe=0,Ee=we.length,ee=Ee-1;Fe<Ee;ee=Fe++){const pe=we[Fe],Re=we[ee],st=pe.x*Re.y-Re.x*pe.y;oe+=(pe.x+Re.x)*st,me+=(pe.y+Re.y)*st,ie+=3*st}return new Ih(oe/ie,me/ie,0,te)}(f),Q=$.length;for(;$.length;){const te=$.pop();(te.d>H.d||!H.d)&&(H=te,d&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,Q)),te.max-H.d<=l||(F=te.h/2,$.push(new Ih(te.p.x-F,te.p.y-F,F,f)),$.push(new Ih(te.p.x+F,te.p.y-F,F,f)),$.push(new Ih(te.p.x-F,te.p.y+F,F,f)),$.push(new Ih(te.p.x+F,te.p.y+F,F,f)),Q+=4)}return d&&(console.log(`num probes: ${Q}`),console.log(`best distance: ${H.d}`)),H.p}function ew(f,l){return l.max-f.max}function Ih(f,l,d,g){this.p=new z(f,l),this.h=d,this.d=function(x,E){let P=!1,R=1/0;for(let N=0;N<E.length;N++){const F=E[N];for(let $=0,H=F.length,Q=H-1;$<H;Q=$++){const te=F[$],ie=F[Q];te.y>x.y!=ie.y>x.y&&x.x<(ie.x-te.x)*(x.y-te.y)/(ie.y-te.y)+te.x&&(P=!P),R=Math.min(R,zi(x,te,ie))}}return(P?1:-1)*Math.sqrt(R)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var ga;c.aB=void 0,(ga=c.aB||(c.aB={}))[ga.center=1]="center",ga[ga.left=2]="left",ga[ga.right=3]="right",ga[ga.top=4]="top",ga[ga.bottom=5]="bottom",ga[ga["top-left"]=6]="top-left",ga[ga["top-right"]=7]="top-right",ga[ga["bottom-left"]=8]="bottom-left",ga[ga["bottom-right"]=9]="bottom-right";const xu=7,Dl=Number.POSITIVE_INFINITY;function cy(f,l){return l[1]!==Dl?function(d,g,x){let E=0,P=0;switch(g=Math.abs(g),x=Math.abs(x),d){case"top-right":case"top-left":case"top":P=x-xu;break;case"bottom-right":case"bottom-left":case"bottom":P=-x+xu}switch(d){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,P]}(f,l[0],l[1]):function(d,g){let x=0,E=0;g<0&&(g=0);const P=g/Math.SQRT2;switch(d){case"top-right":case"top-left":E=P-xu;break;case"bottom-right":case"bottom-left":E=-P+xu;break;case"bottom":E=-g+xu;break;case"top":E=g-xu}switch(d){case"top-right":case"bottom-right":x=-P;break;case"top-left":case"bottom-left":x=P;break;case"left":x=g;break;case"right":x=-g}return[x,E]}(f,l[0])}function Jm(f,l,d){var g;const x=f.layout,E=(g=x.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(l,{},d);if(E){const R=E.values,N=[];for(let F=0;F<R.length;F+=2){const $=N[F]=R[F],H=R[F+1].map(Q=>Q*hi);$.startsWith("top")?H[1]-=xu:$.startsWith("bottom")&&(H[1]+=xu),N[F+1]=H}return new Ii(N)}const P=x.get("text-variable-anchor");if(P){let R;R=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[x.get("text-radial-offset").evaluate(l,{},d)*hi,Dl]:x.get("text-offset").evaluate(l,{},d).map(F=>F*hi);const N=[];for(const F of P)N.push(F,cy(F,R));return new Ii(N)}return null}function uy(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tw(f,l,d,g,x,E,P,R,N,F,$,H){let Q=E.textMaxSize.evaluate(l,{});Q===void 0&&(Q=P);const te=f.layers[0].layout,ie=te.get("icon-offset").evaluate(l,{},$),oe=Fb(d.horizontal),me=P/24,we=f.tilePixelRatio*me,Fe=f.tilePixelRatio*Q/24,Ee=f.tilePixelRatio*R,ee=f.tilePixelRatio*te.get("symbol-spacing"),pe=te.get("text-padding")*f.tilePixelRatio,Re=function(br,mr,cr,Fr=1){const Wn=br.get("icon-padding").evaluate(mr,{},cr),ai=Wn&&Wn.values;return[ai[0]*Fr,ai[1]*Fr,ai[2]*Fr,ai[3]*Fr]}(te,l,$,f.tilePixelRatio),st=te.get("text-max-angle")/180*Math.PI,Nt=te.get("text-rotation-alignment")!=="viewport"&&te.get("symbol-placement")!=="point",dt=te.get("icon-rotation-alignment")==="map"&&te.get("symbol-placement")!=="point",wt=te.get("symbol-placement"),$t=ee/2,Lt=te.get("icon-text-fit");let qt;g&&Lt!=="none"&&(f.allowVerticalPlacement&&d.vertical&&(qt=K_(g,d.vertical,Lt,te.get("icon-text-fit-padding"),ie,me)),oe&&(g=K_(g,oe,Lt,te.get("icon-text-fit-padding"),ie,me)));const Et=$?H.line.getGranularityForZoomLevel($.z):1,ir=(br,mr)=>{mr.x<0||mr.x>=ot||mr.y<0||mr.y>=ot||function(cr,Fr,Wn,ai,_a,Hs,Ra,ki,Tn,wi,Ui,Di,fi,$i,Fn,na,ei,zn,Vi,di,sn,Ho,Oh,Ts,zb){const Kf=cr.addToLineVertexArray(Fr,Wn);let Nl,Oc,kh,Bl,og=0,Ap=0,fy=0,jb=0,Qf=-1,u=-1;const p={};let y=pa("");if(cr.allowVerticalPlacement&&ai.vertical){const ze=ki.layout.get("text-rotate").evaluate(sn,{},Ts)+90;kh=new Gf(Tn,Fr,wi,Ui,Di,ai.vertical,fi,$i,Fn,ze),Ra&&(Bl=new Gf(Tn,Fr,wi,Ui,Di,Ra,ei,zn,Fn,ze))}if(_a){const ze=ki.layout.get("icon-rotate").evaluate(sn,{}),tt=ki.layout.get("icon-text-fit")!=="none",Ot=Qm(_a,ze,Oh,tt),or=Ra?Qm(Ra,ze,Oh,tt):void 0;Oc=new Gf(Tn,Fr,wi,Ui,Di,_a,ei,zn,!1,ze),og=4*Ot.length;const Lr=cr.iconSizeData;let pr=null;Lr.kind==="source"?(pr=[$o*ki.layout.get("icon-size").evaluate(sn,{})],pr[0]>Cc&&hr(`${cr.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)):Lr.kind==="composite"&&(pr=[$o*Ho.compositeIconSizes[0].evaluate(sn,{},Ts),$o*Ho.compositeIconSizes[1].evaluate(sn,{},Ts)],(pr[0]>Cc||pr[1]>Cc)&&hr(`${cr.layerIds[0]}: Value for "icon-size" is >= ${Vf}. Reduce your "icon-size".`)),cr.addSymbols(cr.icon,Ot,pr,di,Vi,sn,c.al.none,Fr,Kf.lineStartIndex,Kf.lineLength,-1,Ts),Qf=cr.icon.placedSymbolArray.length-1,or&&(Ap=4*or.length,cr.addSymbols(cr.icon,or,pr,di,Vi,sn,c.al.vertical,Fr,Kf.lineStartIndex,Kf.lineLength,-1,Ts),u=cr.icon.placedSymbolArray.length-1)}const S=Object.keys(ai.horizontal);for(const ze of S){const tt=ai.horizontal[ze];if(!Nl){y=pa(tt.text);const or=ki.layout.get("text-rotate").evaluate(sn,{},Ts);Nl=new Gf(Tn,Fr,wi,Ui,Di,tt,fi,$i,Fn,or)}const Ot=tt.positionedLines.length===1;if(fy+=eg(cr,Fr,tt,Hs,ki,Fn,sn,na,Kf,ai.vertical?c.al.horizontal:c.al.horizontalOnly,Ot?S:[ze],p,Qf,Ho,Ts),Ot)break}ai.vertical&&(jb+=eg(cr,Fr,ai.vertical,Hs,ki,Fn,sn,na,Kf,c.al.vertical,["vertical"],p,u,Ho,Ts));const O=Nl?Nl.boxStartIndex:cr.collisionBoxArray.length,L=Nl?Nl.boxEndIndex:cr.collisionBoxArray.length,ne=kh?kh.boxStartIndex:cr.collisionBoxArray.length,he=kh?kh.boxEndIndex:cr.collisionBoxArray.length,De=Oc?Oc.boxStartIndex:cr.collisionBoxArray.length,pt=Oc?Oc.boxEndIndex:cr.collisionBoxArray.length,Dt=Bl?Bl.boxStartIndex:cr.collisionBoxArray.length,Ut=Bl?Bl.boxEndIndex:cr.collisionBoxArray.length;let ht=-1;const yt=(ze,tt)=>ze&&ze.circleDiameter?Math.max(ze.circleDiameter,tt):tt;ht=yt(Nl,ht),ht=yt(kh,ht),ht=yt(Oc,ht),ht=yt(Bl,ht);const Er=ht>-1?1:0;Er&&(ht*=zb/hi),cr.glyphOffsetArray.length>=Hf.MAX_GLYPHS&&hr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sn.sortKey!==void 0&&cr.addToSortKeyRanges(cr.symbolInstances.length,sn.sortKey);const Sr=Jm(ki,sn,Ts),[kn,Je]=function(ze,tt){const Ot=ze.length,or=tt==null?void 0:tt.values;if((or==null?void 0:or.length)>0)for(let Lr=0;Lr<or.length;Lr+=2){const pr=or[Lr+1];ze.emplaceBack(c.aB[or[Lr]],pr[0],pr[1])}return[Ot,ze.length]}(cr.textAnchorOffsets,Sr);cr.symbolInstances.emplaceBack(Fr.x,Fr.y,p.right>=0?p.right:-1,p.center>=0?p.center:-1,p.left>=0?p.left:-1,p.vertical||-1,Qf,u,y,O,L,ne,he,De,pt,Dt,Ut,wi,fy,jb,og,Ap,Er,0,fi,ht,kn,Je)}(f,mr,br,d,g,x,qt,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,we,[pe,pe,pe,pe],Nt,N,Ee,Re,dt,ie,l,E,F,$,P)};if(wt==="line")for(const br of Nb(l.geometry,0,0,ot,ot)){const mr=Ac(br,Et),cr=Ca(mr,ee,st,d.vertical||oe,g,24,Fe,f.overscaling,ot);for(const Fr of cr)oe&&Vo(f,oe.text,$t,Fr)||ir(mr,Fr)}else if(wt==="line-center"){for(const br of l.geometry)if(br.length>1){const mr=Ac(br,Et),cr=oy(mr,st,d.vertical||oe,g,24,Fe);cr&&ir(mr,cr)}}else if(l.type==="Polygon")for(const br of uf(l.geometry,0)){const mr=Lb(br,16);ir(Ac(br[0],Et,!0),new bu(mr.x,mr.y,0))}else if(l.type==="LineString")for(const br of l.geometry){const mr=Ac(br,Et);ir(mr,new bu(mr[0].x,mr[0].y,0))}else if(l.type==="Point")for(const br of l.geometry)for(const mr of br)ir([mr],new bu(mr.x,mr.y,0))}function eg(f,l,d,g,x,E,P,R,N,F,$,H,Q,te,ie){const oe=function(Fe,Ee,ee,pe,Re,st,Nt,dt){const wt=pe.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,$t=[];for(const Lt of Ee.positionedLines)for(const qt of Lt.positionedGlyphs){if(!qt.rect)continue;const Et=qt.rect||{};let ir=Z_+1,br=!0,mr=1,cr=0;const Fr=(Re||dt)&&qt.vertical,Wn=qt.metrics.advance*qt.scale/2;if(dt&&Ee.verticalizable&&(cr=Lt.lineOffset/2-(qt.imageName?-(hi-qt.metrics.width*qt.scale)/2:(qt.scale-1)*hi)),qt.imageName){const zn=Nt[qt.imageName];br=zn.sdf,mr=zn.pixelRatio,ir=Ga/mr}const ai=Re?[qt.x+Wn,qt.y]:[0,0];let _a=Re?[0,0]:[qt.x+Wn+ee[0],qt.y+ee[1]-cr],Hs=[0,0];Fr&&(Hs=_a,_a=[0,0]);const Ra=qt.metrics.isDoubleResolution?2:1,ki=(qt.metrics.left-ir)*qt.scale-Wn+_a[0],Tn=(-qt.metrics.top-ir)*qt.scale+_a[1],wi=ki+Et.w/Ra*qt.scale/mr,Ui=Tn+Et.h/Ra*qt.scale/mr,Di=new z(ki,Tn),fi=new z(wi,Tn),$i=new z(ki,Ui),Fn=new z(wi,Ui);if(Fr){const zn=new z(-Wn,Wn-pp),Vi=-Math.PI/2,di=hi/2-Wn,sn=new z(5-pp-di,-(qt.imageName?di:0)),Ho=new z(...Hs);Di._rotateAround(Vi,zn)._add(sn)._add(Ho),fi._rotateAround(Vi,zn)._add(sn)._add(Ho),$i._rotateAround(Vi,zn)._add(sn)._add(Ho),Fn._rotateAround(Vi,zn)._add(sn)._add(Ho)}if(wt){const zn=Math.sin(wt),Vi=Math.cos(wt),di=[Vi,-zn,zn,Vi];Di._matMult(di),fi._matMult(di),$i._matMult(di),Fn._matMult(di)}const na=new z(0,0),ei=new z(0,0);$t.push({tl:Di,tr:fi,bl:$i,br:Fn,tex:Et,writingMode:Ee.writingMode,glyphOffset:ai,sectionIndex:qt.sectionIndex,isSDF:br,pixelOffsetTL:na,pixelOffsetBR:ei,minFontScaleX:0,minFontScaleY:0})}return $t}(0,d,R,x,E,P,g,f.allowVerticalPlacement),me=f.textSizeData;let we=null;me.kind==="source"?(we=[$o*x.layout.get("text-size").evaluate(P,{})],we[0]>Cc&&hr(`${f.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)):me.kind==="composite"&&(we=[$o*te.compositeTextSizes[0].evaluate(P,{},ie),$o*te.compositeTextSizes[1].evaluate(P,{},ie)],(we[0]>Cc||we[1]>Cc)&&hr(`${f.layerIds[0]}: Value for "text-size" is >= ${Vf}. Reduce your "text-size".`)),f.addSymbols(f.text,oe,we,R,E,P,F,l,N.lineStartIndex,N.lineLength,Q,ie);for(const Fe of $)H[Fe]=f.text.placedSymbolArray.length-1;return 4*oe.length}function Fb(f){for(const l in f)return f[l];return null}function Vo(f,l,d,g){const x=f.compareText;if(l in x){const E=x[l];for(let P=E.length-1;P>=0;P--)if(g.dist(E[P])<d)return!0}else x[l]=[];return x[l].push(g),!1}const tg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rg{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,g]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const x=g>>4;if(x!==1)throw new Error(`Got v${x} data when expected v1.`);const E=tg[15&g];if(!E)throw new Error("Unrecognized array type.");const[P]=new Uint16Array(l,2,1),[R]=new Uint32Array(l,4,1);return new rg(R,P,E,l)}constructor(l,d=64,g=Float64Array,x){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=g,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const E=tg.indexOf(this.ArrayType),P=2*l*this.ArrayType.BYTES_PER_ELEMENT,R=l*this.IndexArrayType.BYTES_PER_ELEMENT,N=(8-R%8)%8;if(E<0)throw new Error(`Unexpected typed array class: ${g}.`);x&&x instanceof ArrayBuffer?(this.data=x,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+R+N,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+P+R+N),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+R+N,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+E]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=l,this.coords[this._pos++]=d,g}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return ng(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,g,x){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:P,nodeSize:R}=this,N=[0,E.length-1,0],F=[];for(;N.length;){const $=N.pop()||0,H=N.pop()||0,Q=N.pop()||0;if(H-Q<=R){for(let me=Q;me<=H;me++){const we=P[2*me],Fe=P[2*me+1];we>=l&&we<=g&&Fe>=d&&Fe<=x&&F.push(E[me])}continue}const te=Q+H>>1,ie=P[2*te],oe=P[2*te+1];ie>=l&&ie<=g&&oe>=d&&oe<=x&&F.push(E[te]),($===0?l<=ie:d<=oe)&&(N.push(Q),N.push(te-1),N.push(1-$)),($===0?g>=ie:x>=oe)&&(N.push(te+1),N.push(H),N.push(1-$))}return F}within(l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:E,nodeSize:P}=this,R=[0,x.length-1,0],N=[],F=g*g;for(;R.length;){const $=R.pop()||0,H=R.pop()||0,Q=R.pop()||0;if(H-Q<=P){for(let me=Q;me<=H;me++)Tp(E[2*me],E[2*me+1],l,d)<=F&&N.push(x[me]);continue}const te=Q+H>>1,ie=E[2*te],oe=E[2*te+1];Tp(ie,oe,l,d)<=F&&N.push(x[te]),($===0?l-g<=ie:d-g<=oe)&&(R.push(Q),R.push(te-1),R.push(1-$)),($===0?l+g>=ie:d+g>=oe)&&(R.push(te+1),R.push(H),R.push(1-$))}return N}}function ng(f,l,d,g,x,E){if(x-g<=d)return;const P=g+x>>1;Yf(f,l,P,g,x,E),ng(f,l,d,g,P-1,1-E),ng(f,l,d,P+1,x,1-E)}function Yf(f,l,d,g,x,E){for(;x>g;){if(x-g>600){const F=x-g+1,$=d-g+1,H=Math.log(F),Q=.5*Math.exp(2*H/3),te=.5*Math.sqrt(H*Q*(F-Q)/F)*($-F/2<0?-1:1);Yf(f,l,d,Math.max(g,Math.floor(d-$*Q/F+te)),Math.min(x,Math.floor(d+(F-$)*Q/F+te)),E)}const P=l[2*d+E];let R=g,N=x;for(Ya(f,l,g,d),l[2*x+E]>P&&Ya(f,l,g,x);R<N;){for(Ya(f,l,R,N),R++,N--;l[2*R+E]<P;)R++;for(;l[2*N+E]>P;)N--}l[2*g+E]===P?Ya(f,l,g,N):(N++,Ya(f,l,N,x)),N<=d&&(g=N+1),d<=N&&(x=N-1)}}function Ya(f,l,d,g){ig(f,d,g),ig(l,2*d,2*g),ig(l,2*d+1,2*g+1)}function ig(f,l,d){const g=f[l];f[l]=f[d],f[d]=g}function Tp(f,l,d,g){const x=f-d,E=l-g;return x*x+E*E}var qo;c.cm=void 0,(qo=c.cm||(c.cm={})).create="create",qo.load="load",qo.fullLoad="fullLoad";let ag=null,Sp=[];const wu=1e3/60,sg="loadTime",hy="fullLoadTime",rw={mark(f){performance.mark(f)},frame(f){const l=f;ag!=null&&Sp.push(l-ag),ag=l},clearMetrics(){ag=null,Sp=[],performance.clearMeasures(sg),performance.clearMeasures(hy);for(const f in c.cm)performance.clearMarks(c.cm[f])},getPerformanceMetrics(){performance.measure(sg,c.cm.create,c.cm.load),performance.measure(hy,c.cm.create,c.cm.fullLoad);const f=performance.getEntriesByName(sg)[0].duration,l=performance.getEntriesByName(hy)[0].duration,d=Sp.length,g=1/(Sp.reduce((E,P)=>E+P,0)/d/1e3),x=Sp.filter(E=>E>wu).reduce((E,P)=>E+(P-wu)/wu,0);return{loadTime:f,fullLoadTime:l,fps:g,percentDroppedFrames:x/(d+x)*100,totalFrames:d}}};c.$=Rc,c.A=Y,c.B=_n,c.C=cn,c.D=ur,c.E=Pe,c.F=Xd,c.G=function(f){if(rr==null){const l=f.navigator?f.navigator.userAgent:null;rr=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return rr},c.H=class{constructor(f,l){this.target=f,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Cb(()=>this.process()),this.subscription=Ei(this.target,"message",d=>this.receive(d),!1),this.globalScope=ar(self)?f:window}registerMessageHandler(f,l){this.messageHandlers[f]=l}sendAsync(f,l){return new Promise((d,g)=>{const x=Math.round(1e18*Math.random()).toString(36).substring(0,10),E=l?Ei(l.signal,"abort",()=>{E==null||E.unsubscribe(),delete this.resolveRejects[x];const N={id:x,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(N)},Rb):null;this.resolveRejects[x]={resolve:N=>{E==null||E.unsubscribe(),d(N)},reject:N=>{E==null||E.unsubscribe(),g(N)}};const P=[],R=Object.assign(Object.assign({},f),{id:x,sourceMapId:this.mapId,origin:location.origin,data:sh(f.data,P)});this.target.postMessage(R,{transfer:P})})}receive(f){const l=f.data,d=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[d];const g=this.abortControllers[d];return delete this.abortControllers[d],void(g&&g.abort())}if(ar(self)||l.mustQueue)return this.tasks[d]=l,this.taskQueue.push(d),void this.invoker.trigger();this.processTask(d,l)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),l=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(f,l)}processTask(f,l){return s(this,void 0,void 0,function*(){if(l.type==="<response>"){const x=this.resolveRejects[f];return delete this.resolveRejects[f],x?void(l.error?x.reject(xl(l.error)):x.resolve(xl(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const d=xl(l.data),g=new AbortController;this.abortControllers[f]=g;try{const x=yield this.messageHandlers[l.type](l.sourceMapId,d,g);this.completeTask(f,null,x)}catch(x){this.completeTask(f,x)}})}completeTask(f,l,d){const g=[];delete this.abortControllers[f];const x={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?sh(l):null,data:sh(d,g)};this.target.postMessage(x,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.I=Th,c.J=yo,c.K=function(){var f=new Y(16);return Y!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},c.L=function(f,l,d){var g,x,E,P,R,N,F,$,H,Q,te,ie,oe=d[0],me=d[1],we=d[2];return l===f?(f[12]=l[0]*oe+l[4]*me+l[8]*we+l[12],f[13]=l[1]*oe+l[5]*me+l[9]*we+l[13],f[14]=l[2]*oe+l[6]*me+l[10]*we+l[14],f[15]=l[3]*oe+l[7]*me+l[11]*we+l[15]):(x=l[1],E=l[2],P=l[3],R=l[4],N=l[5],F=l[6],$=l[7],H=l[8],Q=l[9],te=l[10],ie=l[11],f[0]=g=l[0],f[1]=x,f[2]=E,f[3]=P,f[4]=R,f[5]=N,f[6]=F,f[7]=$,f[8]=H,f[9]=Q,f[10]=te,f[11]=ie,f[12]=g*oe+R*me+H*we+l[12],f[13]=x*oe+N*me+Q*we+l[13],f[14]=E*oe+F*me+te*we+l[14],f[15]=P*oe+$*me+ie*we+l[15]),f},c.M=function(f,l,d){var g=d[0],x=d[1],E=d[2];return f[0]=l[0]*g,f[1]=l[1]*g,f[2]=l[2]*g,f[3]=l[3]*g,f[4]=l[4]*x,f[5]=l[5]*x,f[6]=l[6]*x,f[7]=l[7]*x,f[8]=l[8]*E,f[9]=l[9]*E,f[10]=l[10]*E,f[11]=l[11]*E,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},c.N=function(f,l,d){var g=l[0],x=l[1],E=l[2],P=l[3],R=l[4],N=l[5],F=l[6],$=l[7],H=l[8],Q=l[9],te=l[10],ie=l[11],oe=l[12],me=l[13],we=l[14],Fe=l[15],Ee=d[0],ee=d[1],pe=d[2],Re=d[3];return f[0]=Ee*g+ee*R+pe*H+Re*oe,f[1]=Ee*x+ee*N+pe*Q+Re*me,f[2]=Ee*E+ee*F+pe*te+Re*we,f[3]=Ee*P+ee*$+pe*ie+Re*Fe,f[4]=(Ee=d[4])*g+(ee=d[5])*R+(pe=d[6])*H+(Re=d[7])*oe,f[5]=Ee*x+ee*N+pe*Q+Re*me,f[6]=Ee*E+ee*F+pe*te+Re*we,f[7]=Ee*P+ee*$+pe*ie+Re*Fe,f[8]=(Ee=d[8])*g+(ee=d[9])*R+(pe=d[10])*H+(Re=d[11])*oe,f[9]=Ee*x+ee*N+pe*Q+Re*me,f[10]=Ee*E+ee*F+pe*te+Re*we,f[11]=Ee*P+ee*$+pe*ie+Re*Fe,f[12]=(Ee=d[12])*g+(ee=d[13])*R+(pe=d[14])*H+(Re=d[15])*oe,f[13]=Ee*x+ee*N+pe*Q+Re*me,f[14]=Ee*E+ee*F+pe*te+Re*we,f[15]=Ee*P+ee*$+pe*ie+Re*Fe,f},c.O=function(f,l){const d={};for(let g=0;g<l.length;g++){const x=l[g];x in f&&(d[x]=f[x])}return d},c.P=z,c.Q=kl,c.R=bn,c.S=Zm,c.T=oo,c.U=Ib,c.V=Z,c.W=re,c.X=aa,c.Y=us,c.Z=ot,c._=s,c.a=Xi,c.a$=function(f,l,d){var g=Math.sin(d),x=Math.cos(d),E=l[4],P=l[5],R=l[6],N=l[7],F=l[8],$=l[9],H=l[10],Q=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=E*x+F*g,f[5]=P*x+$*g,f[6]=R*x+H*g,f[7]=N*x+Q*g,f[8]=F*x-E*g,f[9]=$*x-P*g,f[10]=H*x-R*g,f[11]=Q*x-N*g,f},c.a0=25,c.a1=Gm,c.a2=f=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(d=>{l.onloadstart=()=>{d(l)};for(const g of f){const x=window.document.createElement("source");ms(g)||(l.crossOrigin="Anonymous"),x.src=g,l.appendChild(x)}})},c.a3=_t,c.a4=function(){return Ft++},c.a5=D,c.a6=Hf,c.a7=_l,c.a8=qs,c.a9=Km,c.aA=function(f,l,d,g,x=!1){if(!d[0]&&!d[1])return[0,0];const E=x?g==="map"?-f.bearingInRadians:0:g==="viewport"?f.bearingInRadians:0;if(E){const P=Math.sin(E),R=Math.cos(E);d=[d[0]*R-d[1]*P,d[0]*P+d[1]*R]}return[x?d[0]:Bt(l,d[0],f.zoom),x?d[1]:Bt(l,d[1],f.zoom)]},c.aC=qf,c.aD=uy,c.aE=_p,c.aF=rg,c.aG=Vn,c.aH=pu,c.aI=Ae,c.aJ=Tr,c.aK=Ht,c.aL=Pt,c.aM=Mi,c.aN=Ob,c.aO=function(f,l,d){return f[0]=l[0]*d,f[1]=l[1]*d,f[2]=l[2]*d,f},c.aP=function(f,l,d){return f[0]=l[0]+d[0],f[1]=l[1]+d[1],f[2]=l[2]+d[2],f},c.aQ=function(f){var l=new Y(3);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l},c.aR=function(f,l,d){return f[0]=l[0]*d[0],f[1]=l[1]*d[1],f[2]=l[2]*d[2],f[3]=l[3]*d[3],f},c.aS=function(f,l,d){return f[0]=l[0]-d[0],f[1]=l[1]-d[1],f[2]=l[2]-d[2],f},c.aT=function(f,l){var d=l[0],g=l[1],x=l[2],E=d*d+g*g+x*x;return E>0&&(E=1/Math.sqrt(E)),f[0]=l[0]*E,f[1]=l[1]*E,f[2]=l[2]*E,f},c.aU=function(f,l,d){var g=l[0],x=l[1],E=l[2],P=d[0],R=d[1],N=d[2];return f[0]=x*N-E*R,f[1]=E*P-g*N,f[2]=g*R-x*P,f},c.aV=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]},c.aW=Zr,c.aX=Ic,c.aY=function(f,l,d,g,x){var E,P=1/Math.tan(l/2);return f[0]=P/d,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=P,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,x!=null&&x!==1/0?(f[10]=(x+g)*(E=1/(g-x)),f[14]=2*x*g*E):(f[10]=-1,f[14]=-2*g),f},c.aZ=function(f){var l=new Y(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},c.a_=function(f,l,d){var g=Math.sin(d),x=Math.cos(d),E=l[0],P=l[1],R=l[2],N=l[3],F=l[4],$=l[5],H=l[6],Q=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=E*x+F*g,f[1]=P*x+$*g,f[2]=R*x+H*g,f[3]=N*x+Q*g,f[4]=F*x-E*g,f[5]=$*x-P*g,f[6]=H*x-R*g,f[7]=Q*x-N*g,f},c.aa=function(f){const l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,g,x,E)=>{const P=x||E;return l[g]=!P||P.toLowerCase(),""}),l["max-age"]){const d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l},c.ab=function(f){return f*Math.PI/180},c.ac=function(f){return Math.pow(2,f)},c.ad=be,c.ae=Ge,c.af=85.051129,c.ag=Xm,c.ah=function(f){return Math.log(f)/Math.LN2},c.ai=function(f){var l=f[0],d=f[1];return l*l+d*d},c.aj=function(f,l){const d=[];for(const g in f)g in l||d.push(g);return d},c.ak=function(f,l){let d=0,g=0;if(f.kind==="constant")g=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:x,minZoom:E,maxZoom:P}=f,R=x?Ge(ua.interpolationFactor(x,l,E,P),0,1):0;f.kind==="camera"?g=_n.number(f.minSize,f.maxSize,R):d=R}return{uSizeT:d,uSize:g}},c.am=function(f,{uSize:l,uSizeT:d},{lowerSize:g,upperSize:x}){return f.kind==="source"?g/$o:f.kind==="composite"?_n.number(g/$o,x/$o,d):l},c.an=function(f,l){var d=l[0],g=l[1],x=l[2],E=l[3],P=l[4],R=l[5],N=l[6],F=l[7],$=l[8],H=l[9],Q=l[10],te=l[11],ie=l[12],oe=l[13],me=l[14],we=l[15],Fe=d*R-g*P,Ee=d*N-x*P,ee=d*F-E*P,pe=g*N-x*R,Re=g*F-E*R,st=x*F-E*N,Nt=$*oe-H*ie,dt=$*me-Q*ie,wt=$*we-te*ie,$t=H*me-Q*oe,Lt=H*we-te*oe,qt=Q*we-te*me,Et=Fe*qt-Ee*Lt+ee*$t+pe*wt-Re*dt+st*Nt;return Et?(f[0]=(R*qt-N*Lt+F*$t)*(Et=1/Et),f[1]=(x*Lt-g*qt-E*$t)*Et,f[2]=(oe*st-me*Re+we*pe)*Et,f[3]=(Q*Re-H*st-te*pe)*Et,f[4]=(N*wt-P*qt-F*dt)*Et,f[5]=(d*qt-x*wt+E*dt)*Et,f[6]=(me*ee-ie*st-we*Ee)*Et,f[7]=($*st-Q*ee+te*Ee)*Et,f[8]=(P*Lt-R*wt+F*Nt)*Et,f[9]=(g*wt-d*Lt-E*Nt)*Et,f[10]=(ie*Re-oe*ee+we*Fe)*Et,f[11]=(H*ee-$*Re-te*Fe)*Et,f[12]=(R*dt-P*$t-N*Nt)*Et,f[13]=(d*$t-g*dt+x*Nt)*Et,f[14]=(oe*Ee-ie*pe-me*Fe)*Et,f[15]=($*pe-H*Ee+Q*Fe)*Et,f):null},c.ao=Ie,c.ap=function(f){return Math.hypot(f[0],f[1])},c.aq=function(f){return f[0]=0,f[1]=0,f},c.ar=function(f,l,d){return f[0]=l[0]*d,f[1]=l[1]*d,f},c.as=yp,c.at=Ze,c.au=function(f,l,d,g){const x=l.y-f.y,E=l.x-f.x,P=g.y-d.y,R=g.x-d.x,N=P*E-R*x;if(N===0)return null;const F=(R*(f.y-d.y)-P*(f.x-d.x))/N;return new z(f.x+F*E,f.y+F*x)},c.av=Nb,c.aw=Of,c.ax=function(f){let l=1/0,d=1/0,g=-1/0,x=-1/0;for(const E of f)l=Math.min(l,E.x),d=Math.min(d,E.y),g=Math.max(g,E.x),x=Math.max(x,E.y);return[l,d,g,x]},c.ay=hi,c.az=Bt,c.b=fr,c.b$=function(f,l){var d=f[0],g=f[1],x=f[2],E=f[3],P=f[4],R=f[5],N=f[6],F=f[7],$=f[8],H=f[9],Q=f[10],te=f[11],ie=f[12],oe=f[13],me=f[14],we=f[15],Fe=l[0],Ee=l[1],ee=l[2],pe=l[3],Re=l[4],st=l[5],Nt=l[6],dt=l[7],wt=l[8],$t=l[9],Lt=l[10],qt=l[11],Et=l[12],ir=l[13],br=l[14],mr=l[15];return Math.abs(d-Fe)<=W*Math.max(1,Math.abs(d),Math.abs(Fe))&&Math.abs(g-Ee)<=W*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(x-ee)<=W*Math.max(1,Math.abs(x),Math.abs(ee))&&Math.abs(E-pe)<=W*Math.max(1,Math.abs(E),Math.abs(pe))&&Math.abs(P-Re)<=W*Math.max(1,Math.abs(P),Math.abs(Re))&&Math.abs(R-st)<=W*Math.max(1,Math.abs(R),Math.abs(st))&&Math.abs(N-Nt)<=W*Math.max(1,Math.abs(N),Math.abs(Nt))&&Math.abs(F-dt)<=W*Math.max(1,Math.abs(F),Math.abs(dt))&&Math.abs($-wt)<=W*Math.max(1,Math.abs($),Math.abs(wt))&&Math.abs(H-$t)<=W*Math.max(1,Math.abs(H),Math.abs($t))&&Math.abs(Q-Lt)<=W*Math.max(1,Math.abs(Q),Math.abs(Lt))&&Math.abs(te-qt)<=W*Math.max(1,Math.abs(te),Math.abs(qt))&&Math.abs(ie-Et)<=W*Math.max(1,Math.abs(ie),Math.abs(Et))&&Math.abs(oe-ir)<=W*Math.max(1,Math.abs(oe),Math.abs(ir))&&Math.abs(me-br)<=W*Math.max(1,Math.abs(me),Math.abs(br))&&Math.abs(we-mr)<=W*Math.max(1,Math.abs(we),Math.abs(mr))},c.b0=function(){const f=new Float32Array(16);return be(f),f},c.b1=function(){const f=new Float64Array(16);return be(f),f},c.b2=function(){return new Float64Array(16)},c.b3=function(f,l,d){const g=new Float64Array(4);return function(x,E,P,R){var N=.5*Math.PI/180;E*=N,P*=N,R*=N;var F=Math.sin(E),$=Math.cos(E),H=Math.sin(P),Q=Math.cos(P),te=Math.sin(R),ie=Math.cos(R);x[0]=F*Q*ie-$*H*te,x[1]=$*H*ie+F*Q*te,x[2]=$*Q*te-F*H*ie,x[3]=$*Q*ie+F*H*te}(g,f,l-90,d),g},c.b4=function(f,l,d,g){var x,E,P,R,N,F=l[0],$=l[1],H=l[2],Q=l[3],te=d[0],ie=d[1],oe=d[2],me=d[3];return(E=F*te+$*ie+H*oe+Q*me)<0&&(E=-E,te=-te,ie=-ie,oe=-oe,me=-me),1-E>W?(x=Math.acos(E),P=Math.sin(x),R=Math.sin((1-g)*x)/P,N=Math.sin(g*x)/P):(R=1-g,N=g),f[0]=R*F+N*te,f[1]=R*$+N*ie,f[2]=R*H+N*oe,f[3]=R*Q+N*me,f},c.b5=function(f){const l=new Float64Array(9);var d,g,x,E,P,R,N,F,$,H,Q,te,ie,oe,me,we,Fe,Ee;H=(x=(g=f)[0])*(N=x+x),Q=(E=g[1])*N,ie=(P=g[2])*N,oe=P*(F=E+E),we=(R=g[3])*N,Fe=R*F,Ee=R*($=P+P),(d=l)[0]=1-(te=E*F)-(me=P*$),d[3]=Q-Ee,d[6]=ie+Fe,d[1]=Q+Ee,d[4]=1-H-me,d[7]=oe-we,d[2]=ie-Fe,d[5]=oe+we,d[8]=1-H-te;const ee=Mi(-Math.asin(Ge(l[2],-1,1)));let pe,Re;return Math.hypot(l[5],l[8])<.001?(pe=0,Re=-Mi(Math.atan2(l[3],l[4]))):(pe=Mi(l[5]===0&&l[8]===0?0:Math.atan2(l[5],l[8])),Re=Mi(l[1]===0&&l[0]===0?0:Math.atan2(l[1],l[0]))),{roll:pe,pitch:ee+90,bearing:Re}},c.b6=function(f,l){return f.roll==l.roll&&f.pitch==l.pitch&&f.bearing==l.bearing},c.b7=kr,c.b8=El,c.b9=os,c.bA=function(f){if(f.type==="custom")return new Pb(f);switch(f.type){case"background":return new Ol(f);case"circle":return new rb(f);case"fill":return new ma(f);case"fill-extrusion":return new up(f);case"heatmap":return new ab(f);case"hillshade":return new Em(f);case"line":return new gu(f);case"raster":return new Mb(f);case"symbol":return new Eh(f)}},c.bB=Zt,c.bC=function(f,l){if(!f)return[{command:"setStyle",args:[l]}];let d=[];try{if(!Ne(f.version,l.version))return[{command:"setStyle",args:[l]}];Ne(f.center,l.center)||d.push({command:"setCenter",args:[l.center]}),Ne(f.centerAltitude,l.centerAltitude)||d.push({command:"setCenterAltitude",args:[l.centerAltitude]}),Ne(f.zoom,l.zoom)||d.push({command:"setZoom",args:[l.zoom]}),Ne(f.bearing,l.bearing)||d.push({command:"setBearing",args:[l.bearing]}),Ne(f.pitch,l.pitch)||d.push({command:"setPitch",args:[l.pitch]}),Ne(f.roll,l.roll)||d.push({command:"setRoll",args:[l.roll]}),Ne(f.sprite,l.sprite)||d.push({command:"setSprite",args:[l.sprite]}),Ne(f.glyphs,l.glyphs)||d.push({command:"setGlyphs",args:[l.glyphs]}),Ne(f.transition,l.transition)||d.push({command:"setTransition",args:[l.transition]}),Ne(f.light,l.light)||d.push({command:"setLight",args:[l.light]}),Ne(f.terrain,l.terrain)||d.push({command:"setTerrain",args:[l.terrain]}),Ne(f.sky,l.sky)||d.push({command:"setSky",args:[l.sky]}),Ne(f.projection,l.projection)||d.push({command:"setProjection",args:[l.projection]});const g={},x=[];(function(P,R,N,F){let $;for($ in R=R||{},P=P||{})Object.prototype.hasOwnProperty.call(P,$)&&(Object.prototype.hasOwnProperty.call(R,$)||Ke($,N,F));for($ in R)Object.prototype.hasOwnProperty.call(R,$)&&(Object.prototype.hasOwnProperty.call(P,$)?Ne(P[$],R[$])||(P[$].type==="geojson"&&R[$].type==="geojson"&&Xt(P,R,$)?gt(N,{command:"setGeoJSONSourceData",args:[$,R[$].data]}):It($,R,N,F)):bt($,R,N))})(f.sources,l.sources,x,g);const E=[];f.layers&&f.layers.forEach(P=>{"source"in P&&g[P.source]?d.push({command:"removeLayer",args:[P.id]}):E.push(P)}),d=d.concat(x),function(P,R,N){R=R||[];const F=(P=P||[]).map(dr),$=R.map(dr),H=P.reduce(_r,{}),Q=R.reduce(_r,{}),te=F.slice(),ie=Object.create(null);let oe,me,we,Fe,Ee;for(let ee=0,pe=0;ee<F.length;ee++)oe=F[ee],Object.prototype.hasOwnProperty.call(Q,oe)?pe++:(gt(N,{command:"removeLayer",args:[oe]}),te.splice(te.indexOf(oe,pe),1));for(let ee=0,pe=0;ee<$.length;ee++)oe=$[$.length-1-ee],te[te.length-1-ee]!==oe&&(Object.prototype.hasOwnProperty.call(H,oe)?(gt(N,{command:"removeLayer",args:[oe]}),te.splice(te.lastIndexOf(oe,te.length-pe),1)):pe++,Fe=te[te.length-ee],gt(N,{command:"addLayer",args:[Q[oe],Fe]}),te.splice(te.length-ee,0,oe),ie[oe]=!0);for(let ee=0;ee<$.length;ee++)if(oe=$[ee],me=H[oe],we=Q[oe],!ie[oe]&&!Ne(me,we))if(Ne(me.source,we.source)&&Ne(me["source-layer"],we["source-layer"])&&Ne(me.type,we.type)){for(Ee in Kt(me.layout,we.layout,N,oe,null,"setLayoutProperty"),Kt(me.paint,we.paint,N,oe,null,"setPaintProperty"),Ne(me.filter,we.filter)||gt(N,{command:"setFilter",args:[oe,we.filter]}),Ne(me.minzoom,we.minzoom)&&Ne(me.maxzoom,we.maxzoom)||gt(N,{command:"setLayerZoomRange",args:[oe,we.minzoom,we.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?Kt(me[Ee],we[Ee],N,oe,Ee.slice(6),"setPaintProperty"):Ne(me[Ee],we[Ee])||gt(N,{command:"setLayerProperty",args:[oe,Ee,we[Ee]]}));for(Ee in we)Object.prototype.hasOwnProperty.call(we,Ee)&&!Object.prototype.hasOwnProperty.call(me,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?Kt(me[Ee],we[Ee],N,oe,Ee.slice(6),"setPaintProperty"):Ne(me[Ee],we[Ee])||gt(N,{command:"setLayerProperty",args:[oe,Ee,we[Ee]]}))}else gt(N,{command:"removeLayer",args:[oe]}),Fe=te[te.lastIndexOf(oe)+1],gt(N,{command:"addLayer",args:[we,Fe]})}(E,l.layers,d)}catch(g){console.warn("Unable to compute style diff:",g),d=[{command:"setStyle",args:[l]}]}return d},c.bD=function(f){const l=[],d=f.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},c.bE=function f(l,d){if(Array.isArray(l)){if(!Array.isArray(d)||l.length!==d.length)return!1;for(let g=0;g<l.length;g++)if(!f(l[g],d[g]))return!1;return!0}if(typeof l=="object"&&l!==null&&d!==null){if(typeof d!="object"||Object.keys(l).length!==Object.keys(d).length)return!1;for(const g in l)if(!f(l[g],d[g]))return!1;return!0}return l===d},c.bF=zt,c.bG=Gt,c.bH=class extends $s{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},c.bI=as,c.bJ=class extends $s{constructor(f,l){super(f,l),this.current=Bo}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},c.bK=yc,c.bL=class extends $s{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},c.bM=class extends $s{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},c.bN=ue,c.bO=function(f,l){var d=Math.sin(l),g=Math.cos(l);return f[0]=g,f[1]=d,f[2]=0,f[3]=-d,f[4]=g,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},c.bP=function(f,l,d){var g=l[0],x=l[1],E=l[2];return f[0]=g*d[0]+x*d[3]+E*d[6],f[1]=g*d[1]+x*d[4]+E*d[7],f[2]=g*d[2]+x*d[5]+E*d[8],f},c.bQ=function(f,l,d,g,x,E,P){var R=1/(l-d),N=1/(g-x),F=1/(E-P);return f[0]=-2*R,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*N,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*F,f[11]=0,f[12]=(l+d)*R,f[13]=(x+g)*N,f[14]=(P+E)*F,f[15]=1,f},c.bR=class extends Do{},c.bS=bh,c.bT=class extends ea{},c.bU=Am,c.bV=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},c.bW=C_,c.bX=function(f,l,d){var g=l[0],x=l[1],E=l[2],P=d[3]*g+d[7]*x+d[11]*E+d[15];return f[0]=(d[0]*g+d[4]*x+d[8]*E+d[12])/(P=P||1),f[1]=(d[1]*g+d[5]*x+d[9]*E+d[13])/P,f[2]=(d[2]*g+d[6]*x+d[10]*E+d[14])/P,f},c.bY=class extends is{},c.bZ=class extends b{},c.b_=function(f,l){return f[0]===l[0]&&f[1]===l[1]&&f[2]===l[2]&&f[3]===l[3]&&f[4]===l[4]&&f[5]===l[5]&&f[6]===l[6]&&f[7]===l[7]&&f[8]===l[8]&&f[9]===l[9]&&f[10]===l[10]&&f[11]===l[11]&&f[12]===l[12]&&f[13]===l[13]&&f[14]===l[14]&&f[15]===l[15]},c.ba=Lf,c.bb=_h,c.bc=ft,c.bd=vt,c.be=gi,c.bf=function(f,l,d,g,x){return ft(g,x,Ge((f-l)/(d-l),0,1))},c.bg=Te,c.bh=function(){return new Float64Array(3)},c.bi=function(f,l,d,g){return f[0]=l[0]+d[0]*g,f[1]=l[1]+d[1]*g,f[2]=l[2]+d[2]*g,f},c.bj=Qe,c.bk=function(){return new Float64Array(4)},c.bl=function(f,l,d,g){var x=[],E=[];return x[0]=l[0]-d[0],x[1]=l[1]-d[1],x[2]=l[2]-d[2],E[0]=x[0]*Math.cos(g)-x[1]*Math.sin(g),E[1]=x[0]*Math.sin(g)+x[1]*Math.cos(g),E[2]=x[2],f[0]=E[0]+d[0],f[1]=E[1]+d[1],f[2]=E[2]+d[2],f},c.bm=function(f,l,d,g){var x=[],E=[];return x[0]=l[0]-d[0],x[1]=l[1]-d[1],x[2]=l[2]-d[2],E[0]=x[0],E[1]=x[1]*Math.cos(g)-x[2]*Math.sin(g),E[2]=x[1]*Math.sin(g)+x[2]*Math.cos(g),f[0]=E[0]+d[0],f[1]=E[1]+d[1],f[2]=E[2]+d[2],f},c.bn=function(f,l,d,g){var x=[],E=[];return x[0]=l[0]-d[0],x[1]=l[1]-d[1],x[2]=l[2]-d[2],E[0]=x[2]*Math.sin(g)+x[0]*Math.cos(g),E[1]=x[1],E[2]=x[2]*Math.cos(g)-x[0]*Math.sin(g),f[0]=E[0]+d[0],f[1]=E[1]+d[1],f[2]=E[2]+d[2],f},c.bo=Ye,c.bp=function(f,l,d){var g=Math.sin(d),x=Math.cos(d),E=l[0],P=l[1],R=l[2],N=l[3],F=l[8],$=l[9],H=l[10],Q=l[11];return l!==f&&(f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=E*x-F*g,f[1]=P*x-$*g,f[2]=R*x-H*g,f[3]=N*x-Q*g,f[8]=E*g+F*x,f[9]=P*g+$*x,f[10]=R*g+H*x,f[11]=N*g+Q*x,f},c.bq=function(f,l){const d=Te(f,360),g=Te(l,360),x=g-d,E=g>d?x-360:x+360;return Math.abs(x)<Math.abs(E)?x:E},c.br=function(f){return f[0]=0,f[1]=0,f[2]=0,f},c.bs=function(f,l,d,g){const x=Math.sqrt(f*f+l*l),E=Math.sqrt(d*d+g*g);f/=x,l/=x,d/=E,g/=E;const P=Math.acos(f*d+l*g);return-l*d+f*g>0?P:-P},c.bt=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]},c.bu=ey,c.bv=function(f,l){const d=Te(f,2*Math.PI),g=Te(l,2*Math.PI);return Math.min(Math.abs(d-g),Math.abs(d-g+2*Math.PI),Math.abs(d-g-2*Math.PI))},c.bw=function(){const f={},l=fe.$version;for(const d in fe.$root){const g=fe.$root[d];if(g.required){let x=null;x=d==="version"?l:g.type==="array"?[]:{},x!=null&&(f[d]=x)}}return f},c.bx=Fs,c.by=Ks,c.bz=function(f){f=f.slice();const l=Object.create(null);for(let d=0;d<f.length;d++)l[f[d].id]=f[d];for(let d=0;d<f.length;d++)"ref"in f[d]&&(f[d]=at(f[d],l[f[d].ref]));return f},c.c=Pi,c.c0=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},c.c1=f=>f.type==="symbol",c.c2=f=>f.type==="circle",c.c3=f=>f.type==="heatmap",c.c4=f=>f.type==="line",c.c5=f=>f.type==="fill",c.c6=f=>f.type==="fill-extrusion",c.c7=f=>f.type==="hillshade",c.c8=f=>f.type==="raster",c.c9=f=>f.type==="background",c.cA=zf,c.cB=Il,c.cC=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},c.cD=function(f,l,d,g,x){return s(this,void 0,void 0,function*(){if(re())try{return yield aa(f,l,d,g,x)}catch{}return function(E,P,R,N,F){const $=E.width,H=E.height;li&&Kn||(li=new OffscreenCanvas($,H),Kn=li.getContext("2d",{willReadFrequently:!0})),li.width=$,li.height=H,Kn.drawImage(E,0,0,$,H);const Q=Kn.getImageData(P,R,N,F);return Kn.clearRect(0,0,$,H),Q.data}(f,l,d,g,x)})},c.cE=Ym,c.cF=m,c.cG=M,c.cH=ws,c.cI=dp,c.cJ=Ki,c.cK=Ma,c.ca=f=>f.type==="custom",c.cb=Ct,c.cc=function(f,l,d){const g=et(l.x-d.x,l.y-d.y),x=et(f.x-d.x,f.y-d.y);var E,P;return Mi(Math.atan2(g[0]*x[1]-g[1]*x[0],(E=g)[0]*(P=x)[0]+E[1]*P[1]))},c.cd=Yt,c.ce=function(f,l){return _o[l]&&(f instanceof MouseEvent||f instanceof WheelEvent)},c.cf=function(f,l){return el[l]&&"touches"in f},c.cg=function(f){return el[f]||_o[f]},c.ch=function(f,l,d){var g=l[0],x=l[1];return f[0]=d[0]*g+d[4]*x+d[12],f[1]=d[1]*g+d[5]*x+d[13],f},c.ci=function(f,l){const{x:d,y:g}=Rc.fromLngLat(l);return!(f<0||f>25||g<0||g>=1||d<0||d>=1)},c.cj=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},c.ck=class extends mc{},c.cl=rw,c.cn=function(f){return f.message===Ys},c.co=tl,c.cp=function(f,l){Xi.REGISTERED_PROTOCOLS[f]=l},c.cq=function(f){delete Xi.REGISTERED_PROTOCOLS[f]},c.cr=function(f,l){const d={};for(let x=0;x<f.length;x++){const E=l&&l[f[x].id]||ro(f[x]);l&&(l[f[x].id]=E);let P=d[E];P||(P=d[E]=[]),P.push(f[x])}const g=[];for(const x in d)g.push(d[x]);return g},c.cs=Jt,c.ct=iy,c.cu=Zf,c.cv=zm,c.cw=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=ot/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const l=f.bucket.layers[0],d=l.layout,g=l._unevaluatedLayout._values,x={layoutIconSize:g["icon-size"].possiblyEvaluate(new cn(f.bucket.zoom+1),f.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new cn(f.bucket.zoom+1),f.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new cn(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:$}=f.bucket.textSizeData;x.compositeTextSizes=[g["text-size"].possiblyEvaluate(new cn(F),f.canonical),g["text-size"].possiblyEvaluate(new cn($),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:$}=f.bucket.iconSizeData;x.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new cn(F),f.canonical),g["icon-size"].possiblyEvaluate(new cn($),f.canonical)]}const E=d.get("text-line-height")*hi,P=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",R=d.get("text-keep-upright"),N=d.get("text-size");for(const F of f.bucket.features){const $=d.get("text-font").evaluate(F,{},f.canonical).join(","),H=N.evaluate(F,{},f.canonical),Q=x.layoutTextSize.evaluate(F,{},f.canonical),te=x.layoutIconSize.evaluate(F,{},f.canonical),ie={horizontal:{},vertical:void 0},oe=F.text;let me,we=[0,0];if(oe){const ee=oe.toString(),pe=d.get("text-letter-spacing").evaluate(F,{},f.canonical)*hi,Re=Yd(ee)?pe:0,st=d.get("text-anchor").evaluate(F,{},f.canonical),Nt=Jm(l,F,f.canonical);if(!Nt){const Lt=d.get("text-radial-offset").evaluate(F,{},f.canonical);we=Lt?cy(st,[Lt*hi,Dl]):d.get("text-offset").evaluate(F,{},f.canonical).map(qt=>qt*hi)}let dt=P?"center":d.get("text-justify").evaluate(F,{},f.canonical);const wt=d.get("symbol-placement")==="point"?d.get("text-max-width").evaluate(F,{},f.canonical)*hi:1/0,$t=()=>{f.bucket.allowVerticalPlacement&&fc(ee)&&(ie.vertical=mp(oe,f.glyphMap,f.glyphPositions,f.imagePositions,$,wt,E,st,"left",Re,we,c.al.vertical,!0,Q,H))};if(!P&&Nt){const Lt=new Set;if(dt==="auto")for(let Et=0;Et<Nt.values.length;Et+=2)Lt.add(uy(Nt.values[Et]));else Lt.add(dt);let qt=!1;for(const Et of Lt)if(!ie.horizontal[Et])if(qt)ie.horizontal[Et]=ie.horizontal[0];else{const ir=mp(oe,f.glyphMap,f.glyphPositions,f.imagePositions,$,wt,E,"center",Et,Re,we,c.al.horizontal,!1,Q,H);ir&&(ie.horizontal[Et]=ir,qt=ir.positionedLines.length===1)}$t()}else{dt==="auto"&&(dt=uy(st));const Lt=mp(oe,f.glyphMap,f.glyphPositions,f.imagePositions,$,wt,E,st,dt,Re,we,c.al.horizontal,!1,Q,H);Lt&&(ie.horizontal[dt]=Lt),$t(),fc(ee)&&P&&R&&(ie.vertical=mp(oe,f.glyphMap,f.glyphPositions,f.imagePositions,$,wt,E,st,dt,Re,we,c.al.vertical,!1,Q,H))}}let Fe=!1;if(F.icon&&F.icon.name){const ee=f.imageMap[F.icon.name];ee&&(me=Vm(f.imagePositions[F.icon.name],d.get("icon-offset").evaluate(F,{},f.canonical),d.get("icon-anchor").evaluate(F,{},f.canonical)),Fe=!!ee.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=Fe:f.bucket.sdfIcons!==Fe&&hr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ee.pixelRatio!==f.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Ee=Fb(ie.horizontal)||ie.vertical;f.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||me)&&tw(f.bucket,F,ie,me,f.imageMap,x,Q,te,we,Fe,f.canonical,f.subdivisionGranularity)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},c.cx=ln,c.cy=jo,c.cz=lp,c.d=ms,c.e=tr,c.f=f=>s(void 0,void 0,void 0,function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(l)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.g=Ci,c.h=f=>new Promise((l,d)=>{const g=new Image;g.onload=()=>{l(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=En})},g.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const x=new Blob([new Uint8Array(f)],{type:"image/png"});g.src=f.byteLength?URL.createObjectURL(x):En}),c.i=ar,c.j=(f,l)=>Gi(tr(f,{type:"json"}),l),c.k=ge,c.l=ce,c.m=Gi,c.n=(f,l)=>Gi(tr(f,{type:"arrayBuffer"}),l),c.o=function(f){return new Il(f).readFields(_u,[])},c.p=Fm,c.q=vi,c.r=da,c.s=Ei,c.t=vm,c.u=Nr,c.v=fe,c.w=hr,c.x=lu,c.y=so,c.z=function([f,l,d]){return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(d),y:f*Math.sin(l)*Math.sin(d),z:f*Math.cos(d)}}}),i("worker",["./shared"],function(c){class s{constructor(le){this.keyCache={},le&&this.replace(le)}replace(le){this._layerConfigs={},this._layers={},this.update(le,[])}update(le,ce){for(const Pe of le){this._layerConfigs[Pe.id]=Pe;const fe=this._layers[Pe.id]=c.bA(Pe);fe._featureFilter=c.a7(fe.filter),this.keyCache[Pe.id]&&delete this.keyCache[Pe.id]}for(const Pe of ce)delete this.keyCache[Pe],delete this._layerConfigs[Pe],delete this._layers[Pe];this.familiesBySource={};const ge=c.cr(Object.values(this._layerConfigs),this.keyCache);for(const Pe of ge){const fe=Pe.map(Ke=>this._layers[Ke.id]),$e=fe[0];if($e.visibility==="none")continue;const at=$e.source||"";let Ne=this.familiesBySource[at];Ne||(Ne=this.familiesBySource[at]={});const gt=$e.sourceLayer||"_geojsonTileLayer";let bt=Ne[gt];bt||(bt=Ne[gt]=[]),bt.push(fe)}}}class m{constructor(le){const ce={},ge=[];for(const at in le){const Ne=le[at],gt=ce[at]={};for(const bt in Ne){const Ke=Ne[+bt];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const It={x:0,y:0,w:Ke.bitmap.width+2,h:Ke.bitmap.height+2};ge.push(It),gt[bt]={rect:It,metrics:Ke.metrics}}}const{w:Pe,h:fe}=c.p(ge),$e=new c.q({width:Pe||1,height:fe||1});for(const at in le){const Ne=le[at];for(const gt in Ne){const bt=Ne[+gt];if(!bt||bt.bitmap.width===0||bt.bitmap.height===0)continue;const Ke=ce[at][gt].rect;c.q.copy(bt.bitmap,$e,{x:0,y:0},{x:Ke.x+1,y:Ke.y+1},bt.bitmap)}}this.image=$e,this.positions=ce}}c.cs("GlyphAtlas",m);class v{constructor(le){this.tileID=new c.Y(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.uid=le.uid,this.zoom=le.zoom,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.collectResourceTiming,this.returnDependencies=!!le.returnDependencies,this.promoteId=le.promoteId,this.inFlightDependencies=[]}parse(le,ce,ge,Pe,fe){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=le,this.collisionBoxArray=new c.a5;const $e=new c.ct(Object.keys(le.layers).sort()),at=new c.cu(this.tileID,this.promoteId);at.bucketLayerIDs=[];const Ne={},gt={featureIndex:at,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge,subdivisionGranularity:fe},bt=ce.familiesBySource[this.source];for(const Mt in bt){const er=le.layers[Mt];if(!er)continue;er.version===1&&c.w(`Vector tile source "${this.source}" layer "${Mt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yr=$e.encode(Mt),mi=[];for(let ci=0;ci<er.length;ci++){const on=er.feature(ci),wr=at.getId(on,Mt);mi.push({feature:on,id:wr,index:ci,sourceLayerIndex:yr})}for(const ci of bt[Mt]){const on=ci[0];on.source!==this.source&&c.w(`layer.source = ${on.source} does not equal this.source = ${this.source}`),on.minzoom&&this.zoom<Math.floor(on.minzoom)||on.maxzoom&&this.zoom>=on.maxzoom||on.visibility!=="none"&&(w(ci,this.zoom,ge),(Ne[on.id]=on.createBucket({index:at.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yr,sourceID:this.source})).populate(mi,gt,this.tileID.canonical),at.bucketLayerIDs.push(ci.map(wr=>wr.id)))}}const Ke=c.bF(gt.glyphDependencies,Mt=>Object.keys(Mt).map(Number));this.inFlightDependencies.forEach(Mt=>Mt==null?void 0:Mt.abort()),this.inFlightDependencies=[];let It=Promise.resolve({});if(Object.keys(Ke).length){const Mt=new AbortController;this.inFlightDependencies.push(Mt),It=Pe.sendAsync({type:"GG",data:{stacks:Ke,source:this.source,tileID:this.tileID,type:"glyphs"}},Mt)}const Xt=Object.keys(gt.iconDependencies);let Kt=Promise.resolve({});if(Xt.length){const Mt=new AbortController;this.inFlightDependencies.push(Mt),Kt=Pe.sendAsync({type:"GI",data:{icons:Xt,source:this.source,tileID:this.tileID,type:"icons"}},Mt)}const dr=Object.keys(gt.patternDependencies);let _r=Promise.resolve({});if(dr.length){const Mt=new AbortController;this.inFlightDependencies.push(Mt),_r=Pe.sendAsync({type:"GI",data:{icons:dr,source:this.source,tileID:this.tileID,type:"patterns"}},Mt)}const[_t,vr,jr]=yield Promise.all([It,Kt,_r]),rn=new m(_t),qr=new c.cv(vr,jr);for(const Mt in Ne){const er=Ne[Mt];er instanceof c.a6?(w(er.layers,this.zoom,ge),c.cw({bucket:er,glyphMap:_t,glyphPositions:rn.positions,imageMap:vr,imagePositions:qr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:gt.subdivisionGranularity})):er.hasPattern&&(er instanceof c.cx||er instanceof c.cy||er instanceof c.cz)&&(w(er.layers,this.zoom,ge),er.addFeatures(gt,this.tileID.canonical,qr.patternPositions))}return this.status="done",{buckets:Object.values(Ne).filter(Mt=>!Mt.isEmpty()),featureIndex:at,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:rn.image,imageAtlas:qr,glyphMap:this.returnDependencies?_t:null,iconMap:this.returnDependencies?vr:null,glyphPositions:this.returnDependencies?rn.positions:null}})}}function w(Ve,le,ce){const ge=new c.C(le);for(const Pe of Ve)Pe.recalculate(ge,ce)}class M{constructor(le,ce,ge){this.actor=le,this.layerIndex=ce,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(le,ce){return c._(this,void 0,void 0,function*(){const ge=yield c.n(le.request,ce);try{return{vectorTile:new c.cA.VectorTile(new c.cB(ge.data)),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(Pe){const fe=new Uint8Array(ge.data);let $e=`Unable to parse the tile at ${le.request.url}, `;throw $e+=fe[0]===31&&fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Pe.message}`,new Error($e)}})}loadTile(le){return c._(this,void 0,void 0,function*(){const ce=le.uid,ge=!!(le&&le.request&&le.request.collectResourceTiming)&&new c.cC(le.request),Pe=new v(le);this.loading[ce]=Pe;const fe=new AbortController;Pe.abort=fe;try{const $e=yield this.loadVectorTile(le,fe);if(delete this.loading[ce],!$e)return null;const at=$e.rawData,Ne={};$e.expires&&(Ne.expires=$e.expires),$e.cacheControl&&(Ne.cacheControl=$e.cacheControl);const gt={};if(ge){const Ke=ge.finish();Ke&&(gt.resourceTiming=JSON.parse(JSON.stringify(Ke)))}Pe.vectorTile=$e.vectorTile;const bt=Pe.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,le.subdivisionGranularity);this.loaded[ce]=Pe,this.fetching[ce]={rawTileData:at,cacheControl:Ne,resourceTiming:gt};try{const Ke=yield bt;return c.e({rawTileData:at.slice(0)},Ke,Ne,gt)}finally{delete this.fetching[ce]}}catch($e){throw delete this.loading[ce],Pe.status="done",this.loaded[ce]=Pe,$e}})}reloadTile(le){return c._(this,void 0,void 0,function*(){const ce=le.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[ce];if(ge.showCollisionBoxes=le.showCollisionBoxes,ge.status==="parsing"){const Pe=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,le.subdivisionGranularity);let fe;if(this.fetching[ce]){const{rawTileData:$e,cacheControl:at,resourceTiming:Ne}=this.fetching[ce];delete this.fetching[ce],fe=c.e({rawTileData:$e.slice(0)},Pe,at,Ne)}else fe=Pe;return fe}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,le.subdivisionGranularity)})}abortTile(le){return c._(this,void 0,void 0,function*(){const ce=this.loading,ge=le.uid;ce&&ce[ge]&&ce[ge].abort&&(ce[ge].abort.abort(),delete ce[ge])})}removeTile(le){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[le.uid]&&delete this.loaded[le.uid]})}}class I{constructor(){this.loaded={}}loadTile(le){return c._(this,void 0,void 0,function*(){const{uid:ce,encoding:ge,rawImageData:Pe,redFactor:fe,greenFactor:$e,blueFactor:at,baseShift:Ne}=le,gt=Pe.width+2,bt=Pe.height+2,Ke=c.b(Pe)?new c.R({width:gt,height:bt},yield c.cD(Pe,-1,-1,gt,bt)):Pe,It=new c.cE(ce,Ke,ge,fe,$e,at,Ne);return this.loaded=this.loaded||{},this.loaded[ce]=It,It})}removeTile(le){const ce=this.loaded,ge=le.uid;ce&&ce[ge]&&delete ce[ge]}}var k,z,V=function(){if(z)return k;function Ve(ce,ge){if(ce.length!==0){le(ce[0],ge);for(var Pe=1;Pe<ce.length;Pe++)le(ce[Pe],!ge)}}function le(ce,ge){for(var Pe=0,fe=0,$e=0,at=ce.length,Ne=at-1;$e<at;Ne=$e++){var gt=(ce[$e][0]-ce[Ne][0])*(ce[Ne][1]+ce[$e][1]),bt=Pe+gt;fe+=Math.abs(Pe)>=Math.abs(gt)?Pe-bt+gt:gt-bt+Pe,Pe=bt}Pe+fe>=0!=!!ge&&ce.reverse()}return z=1,k=function ce(ge,Pe){var fe,$e=ge&&ge.type;if($e==="FeatureCollection")for(fe=0;fe<ge.features.length;fe++)ce(ge.features[fe],Pe);else if($e==="GeometryCollection")for(fe=0;fe<ge.geometries.length;fe++)ce(ge.geometries[fe],Pe);else if($e==="Feature")ce(ge.geometry,Pe);else if($e==="Polygon")Ve(ge.coordinates,Pe);else if($e==="MultiPolygon")for(fe=0;fe<ge.coordinates.length;fe++)Ve(ge.coordinates[fe],Pe);return ge}}(),U=c.cF(V);const K=c.cA.VectorTileFeature.prototype.toGeoJSON;class J{constructor(le){this._feature=le,this.extent=c.Z,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const ce of this._feature.geometry)le.push([new c.P(ce[0],ce[1])]);return le}{const le=[];for(const ce of this._feature.geometry){const ge=[];for(const Pe of ce)ge.push(new c.P(Pe[0],Pe[1]));le.push(ge)}return le}}toGeoJSON(le,ce,ge){return K.call(this,le,ce,ge)}}class Z{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.Z,this.length=le.length,this._features=le}feature(le){return new J(this._features[le])}}var re,W,Y,ue={exports:{}},be=function(){if(Y)return ue.exports;Y=1;var Ve=c.cI(),le=function(){if(W)return re;W=1;var bt=c.cG(),Ke=c.cH().VectorTileFeature;function It(Kt,dr){this.options=dr||{},this.features=Kt,this.length=Kt.length}function Xt(Kt,dr){this.id=typeof Kt.id=="number"?Kt.id:void 0,this.type=Kt.type,this.rawGeometry=Kt.type===1?[Kt.geometry]:Kt.geometry,this.properties=Kt.tags,this.extent=dr||4096}return re=It,It.prototype.feature=function(Kt){return new Xt(this.features[Kt],this.options.extent)},Xt.prototype.loadGeometry=function(){var Kt=this.rawGeometry;this.geometry=[];for(var dr=0;dr<Kt.length;dr++){for(var _r=Kt[dr],_t=[],vr=0;vr<_r.length;vr++)_t.push(new bt(_r[vr][0],_r[vr][1]));this.geometry.push(_t)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Kt=this.geometry,dr=1/0,_r=-1/0,_t=1/0,vr=-1/0,jr=0;jr<Kt.length;jr++)for(var rn=Kt[jr],qr=0;qr<rn.length;qr++){var Mt=rn[qr];dr=Math.min(dr,Mt.x),_r=Math.max(_r,Mt.x),_t=Math.min(_t,Mt.y),vr=Math.max(vr,Mt.y)}return[dr,_t,_r,vr]},Xt.prototype.toGeoJSON=Ke.prototype.toGeoJSON,re}();function ce(bt){var Ke=new Ve;return function(It,Xt){for(var Kt in It.layers)Xt.writeMessage(3,ge,It.layers[Kt])}(bt,Ke),Ke.finish()}function ge(bt,Ke){var It;Ke.writeVarintField(15,bt.version||1),Ke.writeStringField(1,bt.name||""),Ke.writeVarintField(5,bt.extent||4096);var Xt={keys:[],values:[],keycache:{},valuecache:{}};for(It=0;It<bt.length;It++)Xt.feature=bt.feature(It),Ke.writeMessage(2,Pe,Xt);var Kt=Xt.keys;for(It=0;It<Kt.length;It++)Ke.writeStringField(3,Kt[It]);var dr=Xt.values;for(It=0;It<dr.length;It++)Ke.writeMessage(4,gt,dr[It])}function Pe(bt,Ke){var It=bt.feature;It.id!==void 0&&Ke.writeVarintField(1,It.id),Ke.writeMessage(2,fe,bt),Ke.writeVarintField(3,It.type),Ke.writeMessage(4,Ne,It)}function fe(bt,Ke){var It=bt.feature,Xt=bt.keys,Kt=bt.values,dr=bt.keycache,_r=bt.valuecache;for(var _t in It.properties){var vr=It.properties[_t],jr=dr[_t];if(vr!==null){jr===void 0&&(Xt.push(_t),dr[_t]=jr=Xt.length-1),Ke.writeVarint(jr);var rn=typeof vr;rn!=="string"&&rn!=="boolean"&&rn!=="number"&&(vr=JSON.stringify(vr));var qr=rn+":"+vr,Mt=_r[qr];Mt===void 0&&(Kt.push(vr),_r[qr]=Mt=Kt.length-1),Ke.writeVarint(Mt)}}}function $e(bt,Ke){return(Ke<<3)+(7&bt)}function at(bt){return bt<<1^bt>>31}function Ne(bt,Ke){for(var It=bt.loadGeometry(),Xt=bt.type,Kt=0,dr=0,_r=It.length,_t=0;_t<_r;_t++){var vr=It[_t],jr=1;Xt===1&&(jr=vr.length),Ke.writeVarint($e(1,jr));for(var rn=Xt===3?vr.length-1:vr.length,qr=0;qr<rn;qr++){qr===1&&Xt!==1&&Ke.writeVarint($e(2,rn-1));var Mt=vr[qr].x-Kt,er=vr[qr].y-dr;Ke.writeVarint(at(Mt)),Ke.writeVarint(at(er)),Kt+=Mt,dr+=er}Xt===3&&Ke.writeVarint($e(7,1))}}function gt(bt,Ke){var It=typeof bt;It==="string"?Ke.writeStringField(1,bt):It==="boolean"?Ke.writeBooleanField(7,bt):It==="number"&&(bt%1!=0?Ke.writeDoubleField(3,bt):bt<0?Ke.writeSVarintField(6,bt):Ke.writeVarintField(5,bt))}return ue.exports=ce,ue.exports.fromVectorTileJs=ce,ue.exports.fromGeojsonVt=function(bt,Ke){Ke=Ke||{};var It={};for(var Xt in bt)It[Xt]=new le(bt[Xt].features,Ke),It[Xt].name=Xt,It[Xt].version=Ke.version,It[Xt].extent=Ke.extent;return ce({layers:It})},ue.exports.GeoJSONWrapper=le,ue.exports}(),Ce=c.cF(be);const Ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},Me=Math.fround||(Ue=new Float32Array(1),Ve=>(Ue[0]=+Ve,Ue[0]));var Ue;const Qe=3,Ze=5,ct=6;class Ie{constructor(le){this.options=Object.assign(Object.create(Ye),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:ce,minZoom:ge,maxZoom:Pe}=this.options;ce&&console.time("total time");const fe=`prepare ${le.length} points`;ce&&console.time(fe),this.points=le;const $e=[];for(let Ne=0;Ne<le.length;Ne++){const gt=le[Ne];if(!gt.geometry)continue;const[bt,Ke]=gt.geometry.coordinates,It=Me(Bt(bt)),Xt=Me(Te(Ke));$e.push(It,Xt,1/0,Ne,-1,1),this.options.reduce&&$e.push(0)}let at=this.trees[Pe+1]=this._createTree($e);ce&&console.timeEnd(fe);for(let Ne=Pe;Ne>=ge;Ne--){const gt=+Date.now();at=this.trees[Ne]=this._createTree(this._cluster(at,Ne)),ce&&console.log("z%d: %d clusters in %dms",Ne,at.numItems,+Date.now()-gt)}return ce&&console.timeEnd("total time"),this}getClusters(le,ce){let ge=((le[0]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,le[1]));let fe=le[2]===180?180:((le[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)ge=-180,fe=180;else if(ge>fe){const Ke=this.getClusters([ge,Pe,180,$e],ce),It=this.getClusters([-180,Pe,fe,$e],ce);return Ke.concat(It)}const at=this.trees[this._limitZoom(ce)],Ne=at.range(Bt(ge),Te($e),Bt(fe),Te(Pe)),gt=at.data,bt=[];for(const Ke of Ne){const It=this.stride*Ke;bt.push(gt[It+Ze]>1?et(gt,It,this.clusterProps):this.points[gt[It+Qe]])}return bt}getChildren(le){const ce=this._getOriginId(le),ge=this._getOriginZoom(le),Pe="No cluster with the specified id.",fe=this.trees[ge];if(!fe)throw new Error(Pe);const $e=fe.data;if(ce*this.stride>=$e.length)throw new Error(Pe);const at=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Ne=fe.within($e[ce*this.stride],$e[ce*this.stride+1],at),gt=[];for(const bt of Ne){const Ke=bt*this.stride;$e[Ke+4]===le&&gt.push($e[Ke+Ze]>1?et($e,Ke,this.clusterProps):this.points[$e[Ke+Qe]])}if(gt.length===0)throw new Error(Pe);return gt}getLeaves(le,ce,ge){const Pe=[];return this._appendLeaves(Pe,le,ce=ce||10,ge=ge||0,0),Pe}getTile(le,ce,ge){const Pe=this.trees[this._limitZoom(le)],fe=Math.pow(2,le),{extent:$e,radius:at}=this.options,Ne=at/$e,gt=(ge-Ne)/fe,bt=(ge+1+Ne)/fe,Ke={features:[]};return this._addTileFeatures(Pe.range((ce-Ne)/fe,gt,(ce+1+Ne)/fe,bt),Pe.data,ce,ge,fe,Ke),ce===0&&this._addTileFeatures(Pe.range(1-Ne/fe,gt,1,bt),Pe.data,fe,ge,fe,Ke),ce===fe-1&&this._addTileFeatures(Pe.range(0,gt,Ne/fe,bt),Pe.data,-1,ge,fe,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(le){let ce=this._getOriginZoom(le)-1;for(;ce<=this.options.maxZoom;){const ge=this.getChildren(le);if(ce++,ge.length!==1)break;le=ge[0].properties.cluster_id}return ce}_appendLeaves(le,ce,ge,Pe,fe){const $e=this.getChildren(ce);for(const at of $e){const Ne=at.properties;if(Ne&&Ne.cluster?fe+Ne.point_count<=Pe?fe+=Ne.point_count:fe=this._appendLeaves(le,Ne.cluster_id,ge,Pe,fe):fe<Pe?fe++:le.push(at),le.length===ge)break}return fe}_createTree(le){const ce=new c.aF(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<le.length;ge+=this.stride)ce.add(le[ge],le[ge+1]);return ce.finish(),ce.data=le,ce}_addTileFeatures(le,ce,ge,Pe,fe,$e){for(const at of le){const Ne=at*this.stride,gt=ce[Ne+Ze]>1;let bt,Ke,It;if(gt)bt=ot(ce,Ne,this.clusterProps),Ke=ce[Ne],It=ce[Ne+1];else{const dr=this.points[ce[Ne+Qe]];bt=dr.properties;const[_r,_t]=dr.geometry.coordinates;Ke=Bt(_r),It=Te(_t)}const Xt={type:1,geometry:[[Math.round(this.options.extent*(Ke*fe-ge)),Math.round(this.options.extent*(It*fe-Pe))]],tags:bt};let Kt;Kt=gt||this.options.generateId?ce[Ne+Qe]:this.points[ce[Ne+Qe]].id,Kt!==void 0&&(Xt.id=Kt),$e.features.push(Xt)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,ce){const{radius:ge,extent:Pe,reduce:fe,minPoints:$e}=this.options,at=ge/(Pe*Math.pow(2,ce)),Ne=le.data,gt=[],bt=this.stride;for(let Ke=0;Ke<Ne.length;Ke+=bt){if(Ne[Ke+2]<=ce)continue;Ne[Ke+2]=ce;const It=Ne[Ke],Xt=Ne[Ke+1],Kt=le.within(Ne[Ke],Ne[Ke+1],at),dr=Ne[Ke+Ze];let _r=dr;for(const _t of Kt){const vr=_t*bt;Ne[vr+2]>ce&&(_r+=Ne[vr+Ze])}if(_r>dr&&_r>=$e){let _t,vr=It*dr,jr=Xt*dr,rn=-1;const qr=((Ke/bt|0)<<5)+(ce+1)+this.points.length;for(const Mt of Kt){const er=Mt*bt;if(Ne[er+2]<=ce)continue;Ne[er+2]=ce;const yr=Ne[er+Ze];vr+=Ne[er]*yr,jr+=Ne[er+1]*yr,Ne[er+4]=qr,fe&&(_t||(_t=this._map(Ne,Ke,!0),rn=this.clusterProps.length,this.clusterProps.push(_t)),fe(_t,this._map(Ne,er)))}Ne[Ke+4]=qr,gt.push(vr/_r,jr/_r,1/0,qr,-1,_r),fe&&gt.push(rn)}else{for(let _t=0;_t<bt;_t++)gt.push(Ne[Ke+_t]);if(_r>1)for(const _t of Kt){const vr=_t*bt;if(!(Ne[vr+2]<=ce)){Ne[vr+2]=ce;for(let jr=0;jr<bt;jr++)gt.push(Ne[vr+jr])}}}}return gt}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,ce,ge){if(le[ce+Ze]>1){const $e=this.clusterProps[le[ce+ct]];return ge?Object.assign({},$e):$e}const Pe=this.points[le[ce+Qe]].properties,fe=this.options.map(Pe);return ge&&fe===Pe?Object.assign({},fe):fe}}function et(Ve,le,ce){return{type:"Feature",id:Ve[le+Qe],properties:ot(Ve,le,ce),geometry:{type:"Point",coordinates:[(ge=Ve[le],360*(ge-.5)),ft(Ve[le+1])]}};var ge}function ot(Ve,le,ce){const ge=Ve[le+Ze],Pe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,fe=Ve[le+ct],$e=fe===-1?{}:Object.assign({},ce[fe]);return Object.assign($e,{cluster:!0,cluster_id:Ve[le+Qe],point_count:ge,point_count_abbreviated:Pe})}function Bt(Ve){return Ve/360+.5}function Te(Ve){const le=Math.sin(Ve*Math.PI/180),ce=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ce<0?0:ce>1?1:ce}function ft(Ve){const le=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function vt(Ve,le,ce,ge){let Pe=ge;const fe=le+(ce-le>>1);let $e,at=ce-le;const Ne=Ve[le],gt=Ve[le+1],bt=Ve[ce],Ke=Ve[ce+1];for(let It=le+3;It<ce;It+=3){const Xt=Ct(Ve[It],Ve[It+1],Ne,gt,bt,Ke);if(Xt>Pe)$e=It,Pe=Xt;else if(Xt===Pe){const Kt=Math.abs(It-fe);Kt<at&&($e=It,at=Kt)}}Pe>ge&&($e-le>3&&vt(Ve,le,$e,ge),Ve[$e+2]=Pe,ce-$e>3&&vt(Ve,$e,ce,ge))}function Ct(Ve,le,ce,ge,Pe,fe){let $e=Pe-ce,at=fe-ge;if($e!==0||at!==0){const Ne=((Ve-ce)*$e+(le-ge)*at)/($e*$e+at*at);Ne>1?(ce=Pe,ge=fe):Ne>0&&(ce+=$e*Ne,ge+=at*Ne)}return $e=Ve-ce,at=le-ge,$e*$e+at*at}function Yt(Ve,le,ce,ge){const Pe={id:Ve??null,type:le,geometry:ce,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(le==="Point"||le==="MultiPoint"||le==="LineString")Ge(Pe,ce);else if(le==="Polygon")Ge(Pe,ce[0]);else if(le==="MultiLineString")for(const fe of ce)Ge(Pe,fe);else if(le==="MultiPolygon")for(const fe of ce)Ge(Pe,fe[0]);return Pe}function Ge(Ve,le){for(let ce=0;ce<le.length;ce+=3)Ve.minX=Math.min(Ve.minX,le[ce]),Ve.minY=Math.min(Ve.minY,le[ce+1]),Ve.maxX=Math.max(Ve.maxX,le[ce]),Ve.maxY=Math.max(Ve.maxY,le[ce+1])}function Pt(Ve,le,ce,ge){if(!le.geometry)return;const Pe=le.geometry.coordinates;if(Pe&&Pe.length===0)return;const fe=le.geometry.type,$e=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2);let at=[],Ne=le.id;if(ce.promoteId?Ne=le.properties[ce.promoteId]:ce.generateId&&(Ne=ge||0),fe==="Point")tr(Pe,at);else if(fe==="MultiPoint")for(const gt of Pe)tr(gt,at);else if(fe==="LineString")Ft(Pe,at,$e,!1);else if(fe==="MultiLineString"){if(ce.lineMetrics){for(const gt of Pe)at=[],Ft(gt,at,$e,!1),Ve.push(Yt(Ne,"LineString",at,le.properties));return}zt(Pe,at,$e,!1)}else if(fe==="Polygon")zt(Pe,at,$e,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(const gt of le.geometry.geometries)Pt(Ve,{id:Ne,geometry:gt,properties:le.properties},ce,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const gt of Pe){const bt=[];zt(gt,bt,$e,!0),at.push(bt)}}Ve.push(Yt(Ne,fe,at,le.properties))}function tr(Ve,le){le.push(Gt(Ve[0]),Zt(Ve[1]),0)}function Ft(Ve,le,ce,ge){let Pe,fe,$e=0;for(let Ne=0;Ne<Ve.length;Ne++){const gt=Gt(Ve[Ne][0]),bt=Zt(Ve[Ne][1]);le.push(gt,bt,0),Ne>0&&($e+=ge?(Pe*bt-gt*fe)/2:Math.sqrt(Math.pow(gt-Pe,2)+Math.pow(bt-fe,2))),Pe=gt,fe=bt}const at=le.length-3;le[2]=1,vt(le,0,at,ce),le[at+2]=1,le.size=Math.abs($e),le.start=0,le.end=le.size}function zt(Ve,le,ce,ge){for(let Pe=0;Pe<Ve.length;Pe++){const fe=[];Ft(Ve[Pe],fe,ce,ge),le.push(fe)}}function Gt(Ve){return Ve/360+.5}function Zt(Ve){const le=Math.sin(Ve*Math.PI/180),ce=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ce<0?0:ce>1?1:ce}function mt(Ve,le,ce,ge,Pe,fe,$e,at){if(ge/=le,fe>=(ce/=le)&&$e<ge)return Ve;if($e<ce||fe>=ge)return null;const Ne=[];for(const gt of Ve){const bt=gt.geometry;let Ke=gt.type;const It=Pe===0?gt.minX:gt.minY,Xt=Pe===0?gt.maxX:gt.maxY;if(It>=ce&&Xt<ge){Ne.push(gt);continue}if(Xt<ce||It>=ge)continue;let Kt=[];if(Ke==="Point"||Ke==="MultiPoint")hr(bt,Kt,ce,ge,Pe);else if(Ke==="LineString")Vt(bt,Kt,ce,ge,Pe,!1,at.lineMetrics);else if(Ke==="MultiLineString")rr(bt,Kt,ce,ge,Pe,!1);else if(Ke==="Polygon")rr(bt,Kt,ce,ge,Pe,!0);else if(Ke==="MultiPolygon")for(const dr of bt){const _r=[];rr(dr,_r,ce,ge,Pe,!0),_r.length&&Kt.push(_r)}if(Kt.length){if(at.lineMetrics&&Ke==="LineString"){for(const dr of Kt)Ne.push(Yt(gt.id,Ke,dr,gt.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Kt.length===1?(Ke="LineString",Kt=Kt[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Kt.length===3?"Point":"MultiPoint"),Ne.push(Yt(gt.id,Ke,Kt,gt.tags))}}return Ne.length?Ne:null}function hr(Ve,le,ce,ge,Pe){for(let fe=0;fe<Ve.length;fe+=3){const $e=Ve[fe+Pe];$e>=ce&&$e<=ge&&fr(le,Ve[fe],Ve[fe+1],Ve[fe+2])}}function Vt(Ve,le,ce,ge,Pe,fe,$e){let at=ar(Ve);const Ne=Pe===0?En:aa;let gt,bt,Ke=Ve.start;for(let _r=0;_r<Ve.length-3;_r+=3){const _t=Ve[_r],vr=Ve[_r+1],jr=Ve[_r+2],rn=Ve[_r+3],qr=Ve[_r+4],Mt=Pe===0?_t:vr,er=Pe===0?rn:qr;let yr=!1;$e&&(gt=Math.sqrt(Math.pow(_t-rn,2)+Math.pow(vr-qr,2))),Mt<ce?er>ce&&(bt=Ne(at,_t,vr,rn,qr,ce),$e&&(at.start=Ke+gt*bt)):Mt>ge?er<ge&&(bt=Ne(at,_t,vr,rn,qr,ge),$e&&(at.start=Ke+gt*bt)):fr(at,_t,vr,jr),er<ce&&Mt>=ce&&(bt=Ne(at,_t,vr,rn,qr,ce),yr=!0),er>ge&&Mt<=ge&&(bt=Ne(at,_t,vr,rn,qr,ge),yr=!0),!fe&&yr&&($e&&(at.end=Ke+gt*bt),le.push(at),at=ar(Ve)),$e&&(Ke+=gt)}let It=Ve.length-3;const Xt=Ve[It],Kt=Ve[It+1],dr=Pe===0?Xt:Kt;dr>=ce&&dr<=ge&&fr(at,Xt,Kt,Ve[It+2]),It=at.length-3,fe&&It>=3&&(at[It]!==at[0]||at[It+1]!==at[1])&&fr(at,at[0],at[1],at[2]),at.length&&le.push(at)}function ar(Ve){const le=[];return le.size=Ve.size,le.start=Ve.start,le.end=Ve.end,le}function rr(Ve,le,ce,ge,Pe,fe){for(const $e of Ve)Vt($e,le,ce,ge,Pe,fe,!1)}function fr(Ve,le,ce,ge){Ve.push(le,ce,ge)}function En(Ve,le,ce,ge,Pe,fe){const $e=(fe-le)/(ge-le);return fr(Ve,fe,ce+(Pe-ce)*$e,1),$e}function aa(Ve,le,ce,ge,Pe,fe){const $e=(fe-ce)/(Pe-ce);return fr(Ve,le+(ge-le)*$e,fe,1),$e}function li(Ve,le){const ce=[];for(let ge=0;ge<Ve.length;ge++){const Pe=Ve[ge],fe=Pe.type;let $e;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")$e=Kn(Pe.geometry,le);else if(fe==="MultiLineString"||fe==="Polygon"){$e=[];for(const at of Pe.geometry)$e.push(Kn(at,le))}else if(fe==="MultiPolygon"){$e=[];for(const at of Pe.geometry){const Ne=[];for(const gt of at)Ne.push(Kn(gt,le));$e.push(Ne)}}ce.push(Yt(Pe.id,fe,$e,Pe.tags))}return ce}function Kn(Ve,le){const ce=[];ce.size=Ve.size,Ve.start!==void 0&&(ce.start=Ve.start,ce.end=Ve.end);for(let ge=0;ge<Ve.length;ge+=3)ce.push(Ve[ge]+le,Ve[ge+1],Ve[ge+2]);return ce}function Ei(Ve,le){if(Ve.transformed)return Ve;const ce=1<<Ve.z,ge=Ve.x,Pe=Ve.y;for(const fe of Ve.features){const $e=fe.geometry,at=fe.type;if(fe.geometry=[],at===1)for(let Ne=0;Ne<$e.length;Ne+=2)fe.geometry.push(Mi($e[Ne],$e[Ne+1],le,ce,ge,Pe));else for(let Ne=0;Ne<$e.length;Ne++){const gt=[];for(let bt=0;bt<$e[Ne].length;bt+=2)gt.push(Mi($e[Ne][bt],$e[Ne][bt+1],le,ce,ge,Pe));fe.geometry.push(gt)}}return Ve.transformed=!0,Ve}function Mi(Ve,le,ce,ge,Pe,fe){return[Math.round(ce*(Ve*ge-Pe)),Math.round(ce*(le*ge-fe))]}function el(Ve,le,ce,ge,Pe){const fe=le===Pe.maxZoom?0:Pe.tolerance/((1<<le)*Pe.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:Ve.length,source:null,x:ce,y:ge,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const at of Ve)_o($e,at,fe,Pe);return $e}function _o(Ve,le,ce,ge){const Pe=le.geometry,fe=le.type,$e=[];if(Ve.minX=Math.min(Ve.minX,le.minX),Ve.minY=Math.min(Ve.minY,le.minY),Ve.maxX=Math.max(Ve.maxX,le.maxX),Ve.maxY=Math.max(Ve.maxY,le.maxY),fe==="Point"||fe==="MultiPoint")for(let at=0;at<Pe.length;at+=3)$e.push(Pe[at],Pe[at+1]),Ve.numPoints++,Ve.numSimplified++;else if(fe==="LineString")Ys($e,Pe,Ve,ce,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(let at=0;at<Pe.length;at++)Ys($e,Pe[at],Ve,ce,fe==="Polygon",at===0);else if(fe==="MultiPolygon")for(let at=0;at<Pe.length;at++){const Ne=Pe[at];for(let gt=0;gt<Ne.length;gt++)Ys($e,Ne[gt],Ve,ce,!0,gt===0)}if($e.length){let at=le.tags||null;if(fe==="LineString"&&ge.lineMetrics){at={};for(const gt in le.tags)at[gt]=le.tags[gt];at.mapbox_clip_start=Pe.start/Pe.size,at.mapbox_clip_end=Pe.end/Pe.size}const Ne={geometry:$e,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:at};le.id!==null&&(Ne.id=le.id),Ve.features.push(Ne)}}function Ys(Ve,le,ce,ge,Pe,fe){const $e=ge*ge;if(ge>0&&le.size<(Pe?$e:ge))return void(ce.numPoints+=le.length/3);const at=[];for(let Ne=0;Ne<le.length;Ne+=3)(ge===0||le[Ne+2]>$e)&&(ce.numSimplified++,at.push(le[Ne],le[Ne+1])),ce.numPoints++;Pe&&function(Ne,gt){let bt=0;for(let Ke=0,It=Ne.length,Xt=It-2;Ke<It;Xt=Ke,Ke+=2)bt+=(Ne[Ke]-Ne[Xt])*(Ne[Ke+1]+Ne[Xt+1]);if(bt>0===gt)for(let Ke=0,It=Ne.length;Ke<It/2;Ke+=2){const Xt=Ne[Ke],Kt=Ne[Ke+1];Ne[Ke]=Ne[It-2-Ke],Ne[Ke+1]=Ne[It-1-Ke],Ne[It-2-Ke]=Xt,Ne[It-1-Ke]=Kt}}(at,fe),Ve.push(at)}const Pi={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xi{constructor(le,ce){const ge=(ce=this.options=function(fe,$e){for(const at in $e)fe[at]=$e[at];return fe}(Object.create(Pi),ce)).debug;if(ge&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");let Pe=function(fe,$e){const at=[];if(fe.type==="FeatureCollection")for(let Ne=0;Ne<fe.features.length;Ne++)Pt(at,fe.features[Ne],$e,Ne);else Pt(at,fe.type==="Feature"?fe:{geometry:fe},$e);return at}(le,ce);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Pe=function(fe,$e){const at=$e.buffer/$e.extent;let Ne=fe;const gt=mt(fe,1,-1-at,at,0,-1,2,$e),bt=mt(fe,1,1-at,2+at,0,-1,2,$e);return(gt||bt)&&(Ne=mt(fe,1,-at,1+at,0,-1,2,$e)||[],gt&&(Ne=li(gt,1).concat(Ne)),bt&&(Ne=Ne.concat(li(bt,-1)))),Ne}(Pe,ce),Pe.length&&this.splitTile(Pe,0,0,0),ge&&(Pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(le,ce,ge,Pe,fe,$e,at){const Ne=[le,ce,ge,Pe],gt=this.options,bt=gt.debug;for(;Ne.length;){Pe=Ne.pop(),ge=Ne.pop(),ce=Ne.pop(),le=Ne.pop();const Ke=1<<ce,It=Ci(ce,ge,Pe);let Xt=this.tiles[It];if(!Xt&&(bt>1&&console.time("creation"),Xt=this.tiles[It]=el(le,ce,ge,Pe,gt),this.tileCoords.push({z:ce,x:ge,y:Pe}),bt)){bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ge,Pe,Xt.numFeatures,Xt.numPoints,Xt.numSimplified),console.timeEnd("creation"));const yr=`z${ce}`;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if(Xt.source=le,fe==null){if(ce===gt.indexMaxZoom||Xt.numPoints<=gt.indexMaxPoints)continue}else{if(ce===gt.maxZoom||ce===fe)continue;if(fe!=null){const yr=fe-ce;if(ge!==$e>>yr||Pe!==at>>yr)continue}}if(Xt.source=null,le.length===0)continue;bt>1&&console.time("clipping");const Kt=.5*gt.buffer/gt.extent,dr=.5-Kt,_r=.5+Kt,_t=1+Kt;let vr=null,jr=null,rn=null,qr=null,Mt=mt(le,Ke,ge-Kt,ge+_r,0,Xt.minX,Xt.maxX,gt),er=mt(le,Ke,ge+dr,ge+_t,0,Xt.minX,Xt.maxX,gt);le=null,Mt&&(vr=mt(Mt,Ke,Pe-Kt,Pe+_r,1,Xt.minY,Xt.maxY,gt),jr=mt(Mt,Ke,Pe+dr,Pe+_t,1,Xt.minY,Xt.maxY,gt),Mt=null),er&&(rn=mt(er,Ke,Pe-Kt,Pe+_r,1,Xt.minY,Xt.maxY,gt),qr=mt(er,Ke,Pe+dr,Pe+_t,1,Xt.minY,Xt.maxY,gt),er=null),bt>1&&console.timeEnd("clipping"),Ne.push(vr||[],ce+1,2*ge,2*Pe),Ne.push(jr||[],ce+1,2*ge,2*Pe+1),Ne.push(rn||[],ce+1,2*ge+1,2*Pe),Ne.push(qr||[],ce+1,2*ge+1,2*Pe+1)}}getTile(le,ce,ge){le=+le,ce=+ce,ge=+ge;const Pe=this.options,{extent:fe,debug:$e}=Pe;if(le<0||le>24)return null;const at=1<<le,Ne=Ci(le,ce=ce+at&at-1,ge);if(this.tiles[Ne])return Ei(this.tiles[Ne],fe);$e>1&&console.log("drilling down to z%d-%d-%d",le,ce,ge);let gt,bt=le,Ke=ce,It=ge;for(;!gt&&bt>0;)bt--,Ke>>=1,It>>=1,gt=this.tiles[Ci(bt,Ke,It)];return gt&&gt.source?($e>1&&(console.log("found parent tile z%d-%d-%d",bt,Ke,It),console.time("drilling down")),this.splitTile(gt.source,bt,Ke,It,le,ce,ge),$e>1&&console.timeEnd("drilling down"),this.tiles[Ne]?Ei(this.tiles[Ne],fe):null):null}}function Ci(Ve,le,ce){return 32*((1<<Ve)*ce+le)+Ve}function yo(Ve,le){return le?Ve.properties[le]:Ve.id}function tl(Ve,le){if(Ve==null)return!0;if(Ve.type==="Feature")return yo(Ve,le)!=null;if(Ve.type==="FeatureCollection"){const ce=new Set;for(const ge of Ve.features){const Pe=yo(ge,le);if(Pe==null||ce.has(Pe))return!1;ce.add(Pe)}return!0}return!1}function Ks(Ve,le){const ce=new Map;if(Ve!=null)if(Ve.type==="Feature")ce.set(yo(Ve,le),Ve);else for(const ge of Ve.features)ce.set(yo(ge,le),ge);return ce}class Gi extends M{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(le,ce){return c._(this,void 0,void 0,function*(){const ge=le.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Pe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!Pe)return null;const fe=new Z(Pe.features);let $e=Ce(fe);return $e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),{vectorTile:fe,rawData:$e.buffer}})}loadData(le){return c._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const ge=!!(le&&le.request&&le.request.collectResourceTiming)&&new c.cC(le.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(le,this._pendingRequest),this._geoJSONIndex=le.cluster?new Ie(function({superclusterOptions:$e,clusterProperties:at}){if(!at||!$e)return $e;const Ne={},gt={},bt={accumulated:null,zoom:0},Ke={properties:null},It=Object.keys(at);for(const Xt of It){const[Kt,dr]=at[Xt],_r=c.cJ(dr),_t=c.cJ(typeof Kt=="string"?[Kt,["accumulated"],["get",Xt]]:Kt);Ne[Xt]=_r.value,gt[Xt]=_t.value}return $e.map=Xt=>{Ke.properties=Xt;const Kt={};for(const dr of It)Kt[dr]=Ne[dr].evaluate(bt,Ke);return Kt},$e.reduce=(Xt,Kt)=>{Ke.properties=Kt;for(const dr of It)bt.accumulated=Xt[dr],Xt[dr]=gt[dr].evaluate(bt,Ke)},$e}(le)).load((yield this._pendingData).features):(Pe=yield this._pendingData,new Xi(Pe,le.geojsonVtOptions)),this.loaded={};const fe={};if(ge){const $e=ge.finish();$e&&(fe.resourceTiming={},fe.resourceTiming[le.source]=JSON.parse(JSON.stringify($e)))}return fe}catch(fe){if(delete this._pendingRequest,c.cn(fe))return{abandoned:!0};throw fe}var Pe})}getData(){return c._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(le){const ce=this.loaded;return ce&&ce[le.uid]?super.reloadTile(le):this.loadTile(le)}loadAndProcessGeoJSON(le,ce){return c._(this,void 0,void 0,function*(){let ge=yield this.loadGeoJSON(le,ce);if(delete this._pendingRequest,typeof ge!="object")throw new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`);if(U(ge,!0),le.filter){const Pe=c.cJ(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));ge={type:"FeatureCollection",features:ge.features.filter($e=>Pe.value.evaluate({zoom:0},$e))}}return ge})}loadGeoJSON(le,ce){return c._(this,void 0,void 0,function*(){const{promoteId:ge}=le;if(le.request){const Pe=yield c.j(le.request,ce);return this._dataUpdateable=tl(Pe.data,ge)?Ks(Pe.data,ge):void 0,Pe.data}if(typeof le.data=="string")try{const Pe=JSON.parse(le.data);return this._dataUpdateable=tl(Pe,ge)?Ks(Pe,ge):void 0,Pe}catch{throw new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`)}if(!le.dataDiff)throw new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${le.source}`);return function(Pe,fe,$e){var at,Ne,gt,bt;if(fe.removeAll&&Pe.clear(),fe.remove)for(const Ke of fe.remove)Pe.delete(Ke);if(fe.add)for(const Ke of fe.add){const It=yo(Ke,$e);It!=null&&Pe.set(It,Ke)}if(fe.update)for(const Ke of fe.update){let It=Pe.get(Ke.id);if(It==null)continue;const Xt=!Ke.removeAllProperties&&(((at=Ke.removeProperties)===null||at===void 0?void 0:at.length)>0||((Ne=Ke.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0);if((Ke.newGeometry||Ke.removeAllProperties||Xt)&&(It=Object.assign({},It),Pe.set(Ke.id,It),Xt&&(It.properties=Object.assign({},It.properties))),Ke.newGeometry&&(It.geometry=Ke.newGeometry),Ke.removeAllProperties)It.properties={};else if(((gt=Ke.removeProperties)===null||gt===void 0?void 0:gt.length)>0)for(const Kt of Ke.removeProperties)Object.prototype.hasOwnProperty.call(It.properties,Kt)&&delete It.properties[Kt];if(((bt=Ke.addOrUpdateProperties)===null||bt===void 0?void 0:bt.length)>0)for(const{key:Kt,value:dr}of Ke.addOrUpdateProperties)It.properties[Kt]=dr}}(this._dataUpdateable,le.dataDiff,ge),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(le){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(le){return this._geoJSONIndex.getClusterExpansionZoom(le.clusterId)}getClusterChildren(le){return this._geoJSONIndex.getChildren(le.clusterId)}getClusterLeaves(le){return this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset)}}class ms{constructor(le){this.self=le,this.actor=new c.H(le),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,ge)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=ge},this.self.addProtocol=c.cp,this.self.removeProtocol=c.cq,this.self.registerRTLTextPlugin=ce=>{c.cK.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,ge)=>this._getDEMWorkerSource(ce,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(ce,ge)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(ce,ge)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(ce,ge)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(ce,ge)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("GD",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).getData()),this.actor.registerMessageHandler("LT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(ce,ge)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][ge.type]||!this.workerSources[ce][ge.type][ge.source])return;const Pe=this.workerSources[ce][ge.type][ge.source];delete this.workerSources[ce][ge.type][ge.source],Pe.removeSource!==void 0&&Pe.removeSource(ge)})),this.actor.registerMessageHandler("RM",ce=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,ge)=>c._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(ce,ge)=>this._syncRTLPluginState(ce,ge)),this.actor.registerMessageHandler("IS",(ce,ge)=>c._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(ce,ge)=>this._setImages(ce,ge)),this.actor.registerMessageHandler("UL",(ce,ge)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(ge.layers,ge.removedIds)})),this.actor.registerMessageHandler("SL",(ce,ge)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(ge)}))}_setImages(le,ce){return c._(this,void 0,void 0,function*(){this.availableImages[le]=ce;for(const ge in this.workerSources[le]){const Pe=this.workerSources[le][ge];for(const fe in Pe)Pe[fe].availableImages=ce}})}_syncRTLPluginState(le,ce){return c._(this,void 0,void 0,function*(){return yield c.cK.syncState(ce,this.self.importScripts)})}_getAvailableImages(le){let ce=this.availableImages[le];return ce||(ce=[]),ce}_getLayerIndex(le){let ce=this.layerIndexes[le];return ce||(ce=this.layerIndexes[le]=new s),ce}_getWorkerSource(le,ce,ge){if(this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][ce]||(this.workerSources[le][ce]={}),!this.workerSources[le][ce][ge]){const Pe={sendAsync:(fe,$e)=>(fe.targetMapId=le,this.actor.sendAsync(fe,$e))};switch(ce){case"vector":this.workerSources[le][ce][ge]=new M(Pe,this._getLayerIndex(le),this._getAvailableImages(le));break;case"geojson":this.workerSources[le][ce][ge]=new Gi(Pe,this._getLayerIndex(le),this._getAvailableImages(le));break;default:this.workerSources[le][ce][ge]=new this.externalWorkerSourceTypes[ce](Pe,this._getLayerIndex(le),this._getAvailableImages(le))}}return this.workerSources[le][ce][ge]}_getDEMWorkerSource(le,ce){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][ce]||(this.demWorkerSources[le][ce]=new I),this.demWorkerSources[le][ce]}}return c.i(self)&&(self.worker=new ms(self)),ms}),i("index",["exports","./shared"],function(c,s){var m="5.4.0";function v(){var T=new s.A(4);return s.A!=Float32Array&&(T[1]=0,T[2]=0),T[0]=1,T[3]=1,T}let w,M;const I={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(T,a,h){const _=requestAnimationFrame(A=>{b(),a(A)}),{unsubscribe:b}=s.s(T.signal,"abort",()=>{b(),cancelAnimationFrame(_),h(s.c())},!1)},frameAsync(T){return new Promise((a,h)=>{this.frame(T,a,h)})},getImageData(T,a=0){return this.getImageCanvasContext(T).getImageData(-a,-a,T.width+2*a,T.height+2*a)},getImageCanvasContext(T){const a=window.document.createElement("canvas"),h=a.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return a.width=T.width,a.height=T.height,h.drawImage(T,0,0,T.width,T.height),h},resolveURL:T=>(w||(w=document.createElement("a")),w.href=T,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(M==null&&(M=matchMedia("(prefers-reduced-motion: reduce)")),M.matches)}};class k{static testProp(a){if(!k.docStyle)return a[0];for(let h=0;h<a.length;h++)if(a[h]in k.docStyle)return a[h];return a[0]}static create(a,h,_){const b=window.document.createElement(a);return h!==void 0&&(b.className=h),_&&_.appendChild(b),b}static createNS(a,h){return window.document.createElementNS(a,h)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(a,h){a.style[k.transformProp]=h}static addEventListener(a,h,_,b={}){a.addEventListener(h,_,"passive"in b?b:b.capture)}static removeEventListener(a,h,_,b={}){a.removeEventListener(h,_,"passive"in b?b:b.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static getScale(a){const h=a.getBoundingClientRect();return{x:h.width/a.offsetWidth||1,y:h.height/a.offsetHeight||1,boundingClientRect:h}}static getPoint(a,h,_){const b=h.boundingClientRect;return new s.P((_.clientX-b.left)/h.x-a.clientLeft,(_.clientY-b.top)/h.y-a.clientTop)}static mousePos(a,h){const _=k.getScale(a);return k.getPoint(a,_,h)}static touchPos(a,h){const _=[],b=k.getScale(a);for(let A=0;A<h.length;A++)_.push(k.getPoint(a,b,h[A]));return _}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}static sanitize(a){const h=new DOMParser().parseFromString(a,"text/html").body||document.createElement("body"),_=h.querySelectorAll("script");for(const b of _)b.remove();return k.clean(h),h.innerHTML}static isPossiblyDangerous(a,h){const _=h.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(a)||!_.includes("javascript:")&&!_.includes("data:"))||!!a.startsWith("on")||void 0}static clean(a){const h=a.children;for(const _ of h)k.removeAttributes(_),k.clean(_)}static removeAttributes(a){for(const{name:h,value:_}of a.attributes)k.isPossiblyDangerous(h,_)&&a.removeAttribute(h)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const z={supported:!1,testSupport:function(T){!K&&U&&(J?Z(T):V=T)}};let V,U,K=!1,J=!1;function Z(T){const a=T.createTexture();T.bindTexture(T.TEXTURE_2D,a);try{if(T.texImage2D(T.TEXTURE_2D,0,T.RGBA,T.RGBA,T.UNSIGNED_BYTE,U),T.isContextLost())return;z.supported=!0}catch{}T.deleteTexture(a),K=!0}var re;typeof document<"u"&&(U=document.createElement("img"),U.onload=()=>{V&&Z(V),V=null,J=!0},U.onerror=()=>{K=!0,V=null},U.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(T){let a,h,_,b;T.resetRequestQueue=()=>{a=[],h=0,_=0,b={}},T.addThrottleControl=B=>{const j=_++;return b[j]=B,j},T.removeThrottleControl=B=>{delete b[B],C()},T.getImage=(B,j,q=!0)=>new Promise((X,G)=>{z.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),s.e(B,{type:"image"}),a.push({abortController:j,requestParameters:B,supportImageRefresh:q,state:"queued",onError:ae=>{G(ae)},onSuccess:ae=>{X(ae)}}),C()});const A=B=>s._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:j,supportImageRefresh:q,onError:X,onSuccess:G,abortController:ae}=B,se=q===!1&&!s.i(self)&&!s.g(j.url)&&(!j.headers||Object.keys(j.headers).reduce((xe,Ae)=>xe&&Ae==="accept",!0));h++;const ve=se?D(j,ae):s.m(j,ae);try{const xe=yield ve;delete B.abortController,B.state="completed",xe.data instanceof HTMLImageElement||s.b(xe.data)?G(xe):xe.data&&G({data:yield(_e=xe.data,typeof createImageBitmap=="function"?s.f(_e):s.h(_e)),cacheControl:xe.cacheControl,expires:xe.expires})}catch(xe){delete B.abortController,X(xe)}finally{h--,C()}var _e}),C=()=>{const B=(()=>{for(const j of Object.keys(b))if(b[j]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let j=h;j<B&&a.length>0;j++){const q=a.shift();q.abortController.signal.aborted?j--:A(q)}},D=(B,j)=>new Promise((q,X)=>{const G=new Image,ae=B.url,se=B.credentials;se&&se==="include"?G.crossOrigin="use-credentials":(se&&se==="same-origin"||!s.d(ae))&&(G.crossOrigin="anonymous"),j.signal.addEventListener("abort",()=>{G.src="",X(s.c())}),G.fetchPriority="high",G.onload=()=>{G.onerror=G.onload=null,q({data:G})},G.onerror=()=>{G.onerror=G.onload=null,j.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},G.src=ae})}(re||(re={})),re.resetRequestQueue();class W{constructor(a){this._transformRequestFn=a}transformRequest(a,h){return this._transformRequestFn&&this._transformRequestFn(a,h)||{url:a}}setTransformRequest(a){this._transformRequestFn=a}}function Y(T){const a=[];if(typeof T=="string")a.push({id:"default",url:T});else if(T&&T.length>0){const h=[];for(const{id:_,url:b}of T){const A=`${_}${b}`;h.indexOf(A)===-1&&(h.push(A),a.push({id:_,url:b}))}}return a}function ue(T,a,h){try{const _=new URL(T);return _.pathname+=`${a}${h}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${T}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class be{constructor(a,h,_,b){this.context=a,this.format=_,this.texture=a.gl.createTexture(),this.update(h,b)}update(a,h,_){const{width:b,height:A}=a,C=!(this.size&&this.size[0]===b&&this.size[1]===A||_),{context:D}=this,{gl:B}=D;if(this.useMipmap=!!(h&&h.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!h||h.premultiply!==!1)),C)this.size=[b,A],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,a):B.texImage2D(B.TEXTURE_2D,0,this.format,b,A,0,this.format,B.UNSIGNED_BYTE,a.data);else{const{x:j,y:q}=_||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?B.texSubImage2D(B.TEXTURE_2D,0,j,q,B.RGBA,B.UNSIGNED_BYTE,a):B.texSubImage2D(B.TEXTURE_2D,0,j,q,b,A,B.RGBA,B.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D),D.pixelStoreUnpackFlipY.setDefault(),D.pixelStoreUnpack.setDefault(),D.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(a,h,_){const{context:b}=this,{gl:A}=b;A.bindTexture(A.TEXTURE_2D,this.texture),_!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=A.LINEAR),a!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,a),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,_||a),this.filter=a),h!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,h),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Ce(T){const{userImage:a}=T;return!!(a&&a.render&&a.render())&&(T.data.replace(new Uint8Array(a.data.buffer)),!0)}class Ye extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:h,promiseResolve:_}of this.requestors)_(this._getImagesForIds(h));this.requestors=[]}}getImage(a){const h=this.images[a];if(h&&!h.data&&h.spriteData){const _=h.spriteData;h.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),h.spriteData=null}return h}addImage(a,h){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,h)&&(this.images[a]=h)}_validate(a,h){let _=!0;const b=h.data||h.spriteData;return this._validateStretch(h.stretchX,b&&b.width)||(this.fire(new s.k(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,b&&b.height)||(this.fire(new s.k(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new s.k(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,h){if(!a)return!0;let _=0;for(const b of a){if(b[0]<_||b[1]<b[0]||h<b[1])return!1;_=b[1]}return!0}_validateContent(a,h){if(!a)return!0;if(a.length!==4)return!1;const _=h.spriteData,b=_&&_.width||h.data.width,A=_&&_.height||h.data.height;return!(a[0]<0||b<a[0]||a[1]<0||A<a[1]||a[2]<0||b<a[2]||a[3]<0||A<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,h,_=!0){const b=this.getImage(a);if(_&&(b.data.width!==h.data.width||b.data.height!==h.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=b.version+1,this.images[a]=h,this.updatedImages[a]=!0}removeImage(a){const h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((h,_)=>{let b=!0;if(!this.isLoaded())for(const A of a)this.images[A]||(b=!1);this.isLoaded()||b?h(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:h})})}_getImagesForIds(a){const h={};for(const _ of a){let b=this.getImage(_);b||(this.fire(new s.l("styleimagemissing",{id:_})),b=this.getImage(_)),b?h[_]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,textFitWidth:b.textFitWidth,textFitHeight:b.textFitHeight,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:a,height:h}=this.atlasImage;return{width:a,height:h}}getPattern(a){const h=this.patterns[a],_=this.getImage(a);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const b={w:_.data.width+2,h:_.data.height+2,x:0,y:0},A=new s.I(b,_);this.patterns[a]={bin:b,position:A}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new be(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const A in this.patterns)a.push(this.patterns[A].bin);const{w:h,h:_}=s.p(a),b=this.atlasImage;b.resize({width:h||1,height:_||1});for(const A in this.patterns){const{bin:C}=this.patterns[A],D=C.x+1,B=C.y+1,j=this.getImage(A).data,q=j.width,X=j.height;s.R.copy(j,b,{x:0,y:0},{x:D,y:B},{width:q,height:X}),s.R.copy(j,b,{x:0,y:X-1},{x:D,y:B-1},{width:q,height:1}),s.R.copy(j,b,{x:0,y:0},{x:D,y:B+X},{width:q,height:1}),s.R.copy(j,b,{x:q-1,y:0},{x:D-1,y:B},{width:1,height:X}),s.R.copy(j,b,{x:0,y:0},{x:D+q,y:B},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const h of a){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.getImage(h);_||s.w(`Image with ID: "${h}" was not found`),Ce(_)&&this.updateImage(h,_)}}}const Me=1e20;function Ue(T,a,h,_,b,A,C,D,B){for(let j=a;j<a+_;j++)Qe(T,h*A+j,A,b,C,D,B);for(let j=h;j<h+b;j++)Qe(T,j*A+a,1,_,C,D,B)}function Qe(T,a,h,_,b,A,C){A[0]=0,C[0]=-1e20,C[1]=Me,b[0]=T[a];for(let D=1,B=0,j=0;D<_;D++){b[D]=T[a+D*h];const q=D*D;do{const X=A[B];j=(b[D]-b[X]+q-X*X)/(D-X)/2}while(j<=C[B]&&--B>-1);B++,A[B]=D,C[B]=j,C[B+1]=Me}for(let D=0,B=0;D<_;D++){for(;C[B+1]<D;)B++;const j=A[B],q=D-j;T[a+D*h]=b[j]+q*q}}class Ze{constructor(a,h){this.requestManager=a,this.localIdeographFontFamily=h,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return s._(this,void 0,void 0,function*(){const h=[];for(const A in a)for(const C of a[A])h.push(this._getAndCacheGlyphsPromise(A,C));const _=yield Promise.all(h),b={};for(const{stack:A,id:C,glyph:D}of _)b[A]||(b[A]={}),b[A][C]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return b})}_getAndCacheGlyphsPromise(a,h){return s._(this,void 0,void 0,function*(){let _=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let b=_.glyphs[h];if(b!==void 0)return{stack:a,id:h,glyph:b};if(b=this._tinySDF(_,a,h),b)return _.glyphs[h]=b,{stack:a,id:h,glyph:b};const A=Math.floor(h/256);if(256*A>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[A])return{stack:a,id:h,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[A]){const D=Ze.loadGlyphRange(a,A,this.url,this.requestManager);_.requests[A]=D}const C=yield _.requests[A];for(const D in C)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=C[+D]);return _.ranges[A]=!0,{stack:a,id:h,glyph:C[h]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(a))||s.u["CJK Unified Ideographs"](a)||s.u["Hangul Syllables"](a)||s.u.Hiragana(a)||s.u.Katakana(a)||s.u["CJK Symbols and Punctuation"](a)||s.u["Halfwidth and Fullwidth Forms"](a))}_tinySDF(a,h,_){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(_))return;let A=a.tinySDF;if(!A){let D="400";/bold/i.test(h)?D="900":/medium/i.test(h)?D="500":/light/i.test(h)&&(D="200"),A=a.tinySDF=new Ze.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:D})}const C=A.draw(String.fromCharCode(_));return{id:_,bitmap:new s.q({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ze.loadGlyphRange=function(T,a,h,_){return s._(this,void 0,void 0,function*(){const b=256*a,A=b+255,C=_.transformRequest(h.replace("{fontstack}",T).replace("{range}",`${b}-${A}`),"Glyphs"),D=yield s.n(C,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${a}, ${b}-${A}`);const B={};for(const j of s.o(D.data))B[j.id]=j;return B})},Ze.TinySDF=class{constructor({fontSize:T=24,buffer:a=3,radius:h=8,cutoff:_=.25,fontFamily:b="sans-serif",fontWeight:A="normal",fontStyle:C="normal"}={}){this.buffer=a,this.cutoff=_,this.radius=h;const D=this.size=T+4*a,B=this._createCanvas(D),j=this.ctx=B.getContext("2d",{willReadFrequently:!0});j.font=`${C} ${A} ${T}px ${b}`,j.textBaseline="alphabetic",j.textAlign="left",j.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(T){const a=document.createElement("canvas");return a.width=a.height=T,a}draw(T){const{width:a,actualBoundingBoxAscent:h,actualBoundingBoxDescent:_,actualBoundingBoxLeft:b,actualBoundingBoxRight:A}=this.ctx.measureText(T),C=Math.ceil(h),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-b))),B=Math.min(this.size-this.buffer,C+Math.ceil(_)),j=D+2*this.buffer,q=B+2*this.buffer,X=Math.max(j*q,0),G=new Uint8ClampedArray(X),ae={data:G,width:j,height:q,glyphWidth:D,glyphHeight:B,glyphTop:C,glyphLeft:0,glyphAdvance:a};if(D===0||B===0)return ae;const{ctx:se,buffer:ve,gridInner:_e,gridOuter:xe}=this;se.clearRect(ve,ve,D,B),se.fillText(T,ve,ve+C);const Ae=se.getImageData(ve,ve,D,B);xe.fill(Me,0,X),_e.fill(0,0,X);for(let Oe=0;Oe<B;Oe++)for(let ke=0;ke<D;ke++){const Be=Ae.data[4*(Oe*D+ke)+3]/255;if(Be===0)continue;const je=(Oe+ve)*j+ke+ve;if(Be===1)xe[je]=0,_e[je]=Me;else{const Le=.5-Be;xe[je]=Le>0?Le*Le:0,_e[je]=Le<0?Le*Le:0}}Ue(xe,0,0,j,q,j,this.f,this.v,this.z),Ue(_e,ve,ve,D,B,j,this.f,this.v,this.z);for(let Oe=0;Oe<X;Oe++){const ke=Math.sqrt(xe[Oe])-Math.sqrt(_e[Oe]);G[Oe]=Math.round(255-255*(ke/this.radius+this.cutoff))}return ae}};class ct{constructor(){this.specification=s.v.light.position}possiblyEvaluate(a,h){return s.z(a.expression.evaluate(h))}interpolate(a,h,_){return{x:s.B.number(a.x,h.x,_),y:s.B.number(a.y,h.y,_),z:s.B.number(a.z,h.z,_)}}}let Ie;class et extends s.E{constructor(a){super(),Ie=Ie||new s.r({anchor:new s.D(s.v.light.anchor),position:new ct,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Ie),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,h={}){if(!this._validate(s.t,a,h))for(const _ in a){const b=a[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_){return(!_||_.validate!==!1)&&s.x(this,a.call(s.y,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}const ot=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class Bt extends s.E{constructor(a){super(),this._transitionable=new s.T(ot),this.setSky(a),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0))}setSky(a,h={}){if(!this._validate(s.F,a,h)){a||(a={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const _ in a){const b=a[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),b):this._transitionable.setValue(_,b)}}}getSky(){return this._transitionable.serialize()}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,h,_={}){return(_==null?void 0:_.validate)!==!1&&s.x(this,a.call(s.y,s.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(a){return a<60?0:a<70?(a-60)/10:1}}class Te{constructor(a,h){this.width=a,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,h){const _=a.join(",")+String(h);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(a,h)),this.dashEntry[_]}getDashRanges(a,h,_){const b=[];let A=a.length%2==1?-a[a.length-1]*_:0,C=a[0]*_,D=!0;b.push({left:A,right:C,isDash:D,zeroLength:a[0]===0});let B=a[0];for(let j=1;j<a.length;j++){D=!D;const q=a[j];A=B*_,B+=q,C=B*_,b.push({left:A,right:C,isDash:D,zeroLength:q===0})}return b}addRoundDash(a,h,_){const b=h/2;for(let A=-_;A<=_;A++){const C=this.width*(this.nextRow+_+A);let D=0,B=a[D];for(let j=0;j<this.width;j++){j/B.right>1&&(B=a[++D]);const q=Math.abs(j-B.left),X=Math.abs(j-B.right),G=Math.min(q,X);let ae;const se=A/_*(b+1);if(B.isDash){const ve=b-Math.abs(se);ae=Math.sqrt(G*G+ve*ve)}else ae=b-Math.sqrt(G*G+se*se);this.data[C+j]=Math.max(0,Math.min(255,ae+128))}}}addRegularDash(a){for(let D=a.length-1;D>=0;--D){const B=a[D],j=a[D+1];B.zeroLength?a.splice(D,1):j&&j.isDash===B.isDash&&(j.left=B.left,a.splice(D,1))}const h=a[0],_=a[a.length-1];h.isDash===_.isDash&&(h.left=_.left-this.width,_.right=h.right+this.width);const b=this.width*this.nextRow;let A=0,C=a[A];for(let D=0;D<this.width;D++){D/C.right>1&&(C=a[++A]);const B=Math.abs(D-C.left),j=Math.abs(D-C.right),q=Math.min(B,j);this.data[b+D]=Math.max(0,Math.min(255,(C.isDash?q:-q)+128))}}addDash(a,h){const _=h?7:0,b=2*_+1;if(this.nextRow+b>this.height)return s.w("LineAtlas out of space"),null;let A=0;for(let D=0;D<a.length;D++)A+=a[D];if(A!==0){const D=this.width/A,B=this.getDashRanges(a,this.width,D);h?this.addRoundDash(B,D,_):this.addRegularDash(B)}const C={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:A};return this.nextRow+=b,this.dirty=!0,C}bind(a){const h=a.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const ft="maplibre_preloaded_worker_pool";class vt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<vt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ft]}numActive(){return Object.keys(this.active).length}}const Ct=Math.floor(I.hardwareConcurrency/2);let Yt,Ge;function Pt(){return Yt||(Yt=new vt),Yt}vt.workerCount=s.G(globalThis)?Math.max(Math.min(Ct,3),1):1;class tr{constructor(a,h){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=h;const _=this.workerPool.acquire(h);for(let b=0;b<_.length;b++){const A=new s.H(_[b],h);A.name=`Worker ${b}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,h){const _=[];for(const b of this.actors)_.push(b.sendAsync({type:a,data:h}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(a=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,h){for(const _ of this.actors)_.registerMessageHandler(a,h)}}function Ft(){return Ge||(Ge=new tr(Pt(),s.J),Ge.registerMessageHandler("GR",(T,a,h)=>s.m(a,h))),Ge}function zt(T,a){const h=s.K();return s.L(h,h,[1,1,0]),s.M(h,h,[.5*T.width,.5*T.height,1]),T.calculatePosMatrix?s.N(h,h,T.calculatePosMatrix(a.toUnwrapped())):h}function Gt(T,a,h,_,b,A,C){var D;const B=function(G,ae,se){if(G)for(const ve of G){const _e=ae[ve];if(_e&&_e.source===se&&_e.type==="fill-extrusion")return!0}else for(const ve in ae){const _e=ae[ve];if(_e.source===se&&_e.type==="fill-extrusion")return!0}return!1}((D=b==null?void 0:b.layers)!==null&&D!==void 0?D:null,a,T.id),j=A.maxPitchScaleFactor(),q=T.tilesIn(_,j,B);q.sort(Zt);const X=[];for(const G of q)X.push({wrappedTileID:G.tileID.wrapped().key,queryResults:G.tile.queryRenderedFeatures(a,h,T._state,G.queryGeometry,G.cameraQueryGeometry,G.scale,b,A,j,zt(T.transform,G.tileID),C?(ae,se)=>C(G.tileID,ae,se):void 0)});return function(G,ae){for(const se in G)for(const ve of G[se])mt(ve,ae);return G}(function(G){const ae={},se={};for(const ve of G){const _e=ve.queryResults,xe=ve.wrappedTileID,Ae=se[xe]=se[xe]||{};for(const Oe in _e){const ke=_e[Oe],Be=Ae[Oe]=Ae[Oe]||{},je=ae[Oe]=ae[Oe]||[];for(const Le of ke)Be[Le.featureIndex]||(Be[Le.featureIndex]=!0,je.push(Le))}}return ae}(X),T)}function Zt(T,a){const h=T.tileID,_=a.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function mt(T,a){const h=T.feature,_=a.getFeatureState(h.layer["source-layer"],h.id);h.source=h.layer.source,h.layer["source-layer"]&&(h.sourceLayer=h.layer["source-layer"]),h.state=_}function hr(T,a,h){return s._(this,void 0,void 0,function*(){let _=T;if(T.url?_=(yield s.j(a.transformRequest(T.url,"Source"),h)).data:yield I.frameAsync(h),!_)return null;const b=s.O(s.e(_,T),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(b.vectorLayerIds=_.vector_layers.map(A=>A.id)),b})}class Vt{constructor(a,h){a&&(h?this.setSouthWest(a).setNorthEast(h):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof s.Q?new s.Q(a.lng,a.lat):s.Q.convert(a),this}setSouthWest(a){return this._sw=a instanceof s.Q?new s.Q(a.lng,a.lat):s.Q.convert(a),this}extend(a){const h=this._sw,_=this._ne;let b,A;if(a instanceof s.Q)b=a,A=a;else{if(!(a instanceof Vt))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Vt.convert(a)):this.extend(s.Q.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(s.Q.convert(a)):this;if(b=a._sw,A=a._ne,!b||!A)return this}return h||_?(h.lng=Math.min(b.lng,h.lng),h.lat=Math.min(b.lat,h.lat),_.lng=Math.max(A.lng,_.lng),_.lat=Math.max(A.lat,_.lat)):(this._sw=new s.Q(b.lng,b.lat),this._ne=new s.Q(A.lng,A.lat)),this}getCenter(){return new s.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.Q(this.getWest(),this.getNorth())}getSouthEast(){return new s.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:h,lat:_}=s.Q.convert(a);let b=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&b}static convert(a){return a instanceof Vt?a:a&&new Vt(a)}static fromLngLat(a,h=0){const _=360*h/40075017,b=_/Math.cos(Math.PI/180*a.lat);return new Vt(new s.Q(a.lng-b,a.lat-_),new s.Q(a.lng+b,a.lat+_))}adjustAntiMeridian(){const a=new s.Q(this._sw.lng,this._sw.lat),h=new s.Q(this._ne.lng,this._ne.lat);return new Vt(a,a.lng>h.lng?new s.Q(h.lng+360,h.lat):h)}}class ar{constructor(a,h,_){this.bounds=Vt.convert(this.validateBounds(a)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const h=Math.pow(2,a.z),_=Math.floor(s.U(this.bounds.getWest())*h),b=Math.floor(s.S(this.bounds.getNorth())*h),A=Math.ceil(s.U(this.bounds.getEast())*h),C=Math.ceil(s.S(this.bounds.getSouth())*h);return a.x>=_&&a.x<A&&a.y>=b&&a.y<C}}class rr extends s.E{constructor(a,h,_,b){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.O(h,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield hr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(s.e(this,a),a.bounds&&(this.tileBounds=new ar(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.k(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(a){return s._(this,void 0,void 0,function*(){const h=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(h,"Tile"),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};_.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((A,C)=>{a.reloadPromise={resolve:A,reject:C}})}else a.actor=this.dispatcher.getActor(),b="LT";a.abortController=new AbortController;try{const A=yield a.actor.sendAsync({type:b,data:_},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,A)}catch(A){if(delete a.abortController,a.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,h){if(h&&h.resourceTiming&&(a.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&a.setExpiryData(h),a.loadVectorData(h,this.map.painter),a.reloadPromise){const _=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(_.resolve).catch(_.reject)}}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"AT",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class fr extends s.E{constructor(a,h,_,b){super(),this.id=a,this.dispatcher=_,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},h),s.e(this,s.O(h,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(a=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const h=yield hr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,h&&(s.e(this,h),h.bounds&&(this.tileBounds=new ar(h.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:a})))}catch(h){this._tileJSONRequest=null,this.fire(new s.k(h))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load(!0)}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return s.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return s._(this,void 0,void 0,function*(){const h=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const _=yield re.getImage(this.map._requestManager.transformRequest(h,"Tile"),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&a.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const b=this.map.painter.context,A=b.gl,C=_.data;a.texture=this.map.painter.getTileTexture(C.width),a.texture?a.texture.update(C,{useMipmap:!0}):(a.texture=new be(b,C,A.RGBA,{useMipmap:!0}),a.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST)),a.state="loaded"}}catch(_){if(delete a.abortController,a.aborted)a.state="unloaded";else if(_)throw a.state="errored",_}})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class En extends fr{constructor(a,h,_,b){super(a,h,_,b),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(a){return s._(this,void 0,void 0,function*(){const h=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(h,"Tile");a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const b=yield re.getImage(_,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(b&&b.data){const A=b.data;this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&a.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const C=s.b(A)&&s.V()?A:yield this.readImageNow(A),D={type:this.type,uid:a.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const B=yield a.actor.sendAsync({type:"LDT",data:D});a.dem=B,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(b){if(delete a.abortController,a.aborted)a.state="unloaded";else if(b)throw a.state="errored",b}})}readImageNow(a){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.W()){const h=a.width+2,_=a.height+2;try{return new s.R({width:h,height:_},yield s.X(a,-1,-1,h,_))}catch{}}return I.getImageData(a,1)})}_getNeighboringTiles(a){const h=a.canonical,_=Math.pow(2,h.z),b=(h.x-1+_)%_,A=h.x===0?a.wrap-1:a.wrap,C=(h.x+1+_)%_,D=h.x+1===_?a.wrap+1:a.wrap,B={};return B[new s.Y(a.overscaledZ,A,h.z,b,h.y).key]={backfilled:!1},B[new s.Y(a.overscaledZ,D,h.z,C,h.y).key]={backfilled:!1},h.y>0&&(B[new s.Y(a.overscaledZ,A,h.z,b,h.y-1).key]={backfilled:!1},B[new s.Y(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},B[new s.Y(a.overscaledZ,D,h.z,C,h.y-1).key]={backfilled:!1}),h.y+1<_&&(B[new s.Y(a.overscaledZ,A,h.z,b,h.y+1).key]={backfilled:!1},B[new s.Y(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},B[new s.Y(a.overscaledZ,D,h.z,C,h.y+1).key]={backfilled:!1}),B}unloadTile(a){return s._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"RDT",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class aa extends s.E{constructor(a,h,_,b){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(b),this._data=h.data,this._options=s.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId,h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(h.buffer!==void 0?h.buffer:128),tolerance:this._pixelsToTileUnits(h.tolerance!==void 0?h.tolerance:.375),extent:s.Z,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.Z,radius:this._pixelsToTileUnits(h.clusterRadius||50),log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(a){return a*(s.Z/this.tileSize)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}getData(){return s._(this,void 0,void 0,function*(){const a=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:a})})}getCoordinatesFromGeometry(a){return a.type==="GeometryCollection"?a.geometries.map(h=>h.coordinates).flat(1/0):a.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,function*(){const a=new Vt,h=yield this.getData();let _;switch(h.type){case"FeatureCollection":_=h.features.map(b=>this.getCoordinatesFromGeometry(b.geometry)).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(h.geometry);break;default:_=this.getCoordinatesFromGeometry(h)}if(_.length==0)return a;for(let b=0;b<_.length-1;b+=2)a.extend([_[b],_[b+1]]);return a})}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(a.clusterRadius)),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,h,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:a,limit:h,offset:_}})}_updateWorkerData(a){return s._(this,void 0,void 0,function*(){const h=s.e({type:this.type},this.workerOptions);a?h.dataDiff=a:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(I.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.l("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));let b=null;_.resourceTiming&&_.resourceTiming[this.id]&&(b=_.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&s.e(A,{resourceTiming:b}),this.fire(new s.l("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(_))}})}loaded(){return this._pendingLoads===0}loadTile(a){return s._(this,void 0,void 0,function*(){const h=a.actor?"RT":"LT";a.actor=this.actor;const _={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};a.abortController=new AbortController;const b=yield this.actor.sendAsync({type:h,data:_},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(b,this.map.painter,h==="RT")})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class li extends s.E{constructor(a,h,_,b){super(),this.flippedWindingOrder=!1,this.id=a,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}load(a){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield re.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,a&&(this.coordinates=a),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new s.k(h))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const h=a.map(s.$.fromLngLat);var _;return this.tileID=function(b){let A=1/0,C=1/0,D=-1/0,B=-1/0;for(const G of b)A=Math.min(A,G.x),C=Math.min(C,G.y),D=Math.max(D,G.x),B=Math.max(B,G.y);const j=Math.max(D-A,B-C),q=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),X=Math.pow(2,q);return new s.a1(q,Math.floor((A+D)/2*X),Math.floor((C+B)/2*X))}(h),this.terrainTileRanges=this._getOverlappingTileRanges(h),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=h.map(b=>this.tileID.getTilePoint(b)._round()),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,h=a.gl;this.texture||(this.texture=new be(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(a){let h=1/0,_=1/0,b=-1/0,A=-1/0;for(const D of a)h=Math.min(h,D.x),_=Math.min(_,D.y),b=Math.max(b,D.x),A=Math.max(A,D.y);const C={};for(let D=0;D<=s.a0;D++){const B=Math.pow(2,D),j=Math.floor(h*B),q=Math.floor(_*B),X=Math.floor(b*B),G=Math.floor(A*B);C[D]={minTileX:j,minTileY:q,maxTileX:X,maxTileY:G}}return C}}class Kn extends li{constructor(a,h,_,b){super(a,h,_,b),this.roundZoom=!0,this.type="video",this.options=h}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const h of a.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield s.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new s.k(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new s.k(new s.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,h=a.gl;this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new be(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const b in this.tiles){const A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ei extends li{constructor(a,h,_,b){super(a,h,_,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(C=>typeof C!="number"))||this.fire(new s.k(new s.a3(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a3(`sources.${a}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.k(new s.a3(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a3(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a3(`sources.${a}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,_=h.gl;this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new be(h,this.canvas,_.RGBA,{premultiply:!0});let b=!1;for(const A in this.tiles){const C=this.tiles[A];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,b=!0)}b&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Mi={},el=T=>{switch(T){case"geojson":return aa;case"image":return li;case"raster":return fr;case"raster-dem":return En;case"vector":return rr;case"video":return Kn;case"canvas":return Ei}return Mi[T]},_o="RTLPluginLoaded";class Ys extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ft()}_syncState(a){return this.status=a,this.dispatcher.broadcast("SRPS",{pluginStatus:a,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return s._(this,arguments,void 0,function*(h,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=I.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(_o))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Pi=null;function Xi(){return Pi||(Pi=new Ys),Pi}class Ci{constructor(a,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=s.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const h=a+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,h,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(b,A){const C={};if(!A)return C;for(const D of b){const B=D.layerIds.map(j=>A.getLayer(j)).filter(Boolean);if(B.length!==0){D.layers=B,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(j=>B.filter(q=>q.id===j)[0]));for(const j of B)C[j.id]=D}}return C}(a.buckets,h==null?void 0:h.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const A=this.buckets[b];if(A instanceof s.a6){if(this.hasSymbolBuckets=!0,!_)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const A=this.buckets[b];if(A instanceof s.a6&&A.hasRTLText){this.hasRTLText=!0,Xi().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const A=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(b).queryRadius(A))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new s.a5}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const _ in this.buckets){const b=this.buckets[_];b.uploadPending()&&b.upload(a)}const h=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new be(a,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new be(a,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,h,_,b,A,C,D,B,j,q,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:A,scale:C,tileSize:this.tileSize,pixelPosMatrix:q,transform:B,params:D,queryPadding:this.queryPadding*j,getElevation:X},a,h,_):{}}querySourceFeatures(a,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const b=_.loadVTLayers(),A=h&&h.sourceLayer?h.sourceLayer:"",C=b._geojsonTileLayer||b[A];if(!C)return;const D=s.a7(h&&h.filter),{z:B,x:j,y:q}=this.tileID.canonical,X={z:B,x:j,y:q};for(let G=0;G<C.length;G++){const ae=C.feature(G);if(D.needGeometry){const _e=s.a8(ae,!0);if(!D.filter(new s.C(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!D.filter(new s.C(this.tileID.overscaledZ),ae))continue;const se=_.getId(ae,A),ve=new s.a9(ae,B,j,q,se);ve.tile=X,a.push(ve)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const h=this.expirationTime;if(a.cacheControl){const _=s.aa(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let b=!1;if(this.expirationTime>_)b=!1;else if(h)if(this.expirationTime<h)b=!0;else{const A=this.expirationTime-h;A?this.expirationTime=_+Math.max(A,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!h.style.hasLayer(b))continue;const A=this.buckets[b],C=A.layers[0].sourceLayer||"_geojsonTileLayer",D=_[C],B=a[C];if(!D||!B||Object.keys(B).length===0)continue;A.update(B,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const j=h&&h.style&&h.style.getLayer(b);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<I.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=I.now()+a}setDependencies(a,h){const _={};for(const b of h)_[b]=!0;this.dependencies[a]=_}hasDependency(a,h){for(const _ of a){const b=this.dependencies[_];if(b){for(const A of h)if(b[A])return!0}}return!1}}class yo{constructor(a,h){this.max=a,this.onRemove=h,this.reset()}reset(){for(const a in this.data)for(const h of this.data[a])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(a,h,_){const b=a.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const A={value:h,timeout:void 0};if(_!==void 0&&(A.timeout=setTimeout(()=>{this.remove(a,A)},_)),this.data[b].push(A),this.order.push(b),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const h=this.data[a].shift();return h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),h.value}getByKey(a){const h=this.data[a];return h?h[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,h){if(!this.has(a))return this;const _=a.wrapped().key,b=h===void 0?0:this.data[_].indexOf(h),A=this.data[_][b];return this.data[_].splice(b,1),A.timeout&&clearTimeout(A.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(A.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(a){const h=[];for(const _ in this.data)for(const b of this.data[_])a(b.value)||h.push(b);for(const _ of h)this.remove(_.value.tileID,_)}}class tl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,h,_){const b=String(h);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][b]=this.stateChanges[a][b]||{},s.e(this.stateChanges[a][b],_),this.deletedStates[a]===null){this.deletedStates[a]={};for(const A in this.state[a])A!==b&&(this.deletedStates[a][A]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][b]===null){this.deletedStates[a][b]={};for(const A in this.state[a][b])_[A]||(this.deletedStates[a][b][A]=null)}else for(const A in _)this.deletedStates[a]&&this.deletedStates[a][b]&&this.deletedStates[a][b][A]===null&&delete this.deletedStates[a][b][A]}removeFeatureState(a,h,_){if(this.deletedStates[a]===null)return;const b=String(h);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&h!==void 0)this.deletedStates[a][b]!==null&&(this.deletedStates[a][b]=this.deletedStates[a][b]||{},this.deletedStates[a][b][_]=null);else if(h!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][b])for(_ in this.deletedStates[a][b]={},this.stateChanges[a][b])this.deletedStates[a][b][_]=null;else this.deletedStates[a][b]=null;else this.deletedStates[a]=null}getState(a,h){const _=String(h),b=s.e({},(this.state[a]||{})[_],(this.stateChanges[a]||{})[_]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const A=this.deletedStates[a][h];if(A===null)return{};for(const C in A)delete b[C]}return b}initializeTileState(a,h){a.setFeatureState(this.state,h)}coalesceChanges(a,h){const _={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const A={};for(const C in this.stateChanges[b])this.state[b][C]||(this.state[b][C]={}),s.e(this.state[b][C],this.stateChanges[b][C]),A[C]=this.state[b][C];_[b]=A}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const A={};if(this.deletedStates[b]===null)for(const C in this.state[b])A[C]={},this.state[b][C]={};else for(const C in this.deletedStates[b]){if(this.deletedStates[b][C]===null)this.state[b][C]={};else for(const D of Object.keys(this.deletedStates[b][C]))delete this.state[b][C][D];A[C]=this.state[b][C]}_[b]=_[b]||{},s.e(_[b],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const b in a)a[b].setFeatureState(_,h)}}const Ks=89.25;function Gi(T,a){const h=s.ae(a.lat,-85.051129,s.af);return new s.P(s.U(a.lng)*T,s.S(h)*T)}function ms(T,a){return new s.$(a.x/T,a.y/T).toLngLat()}function Ve(T){return T.cameraToCenterDistance*Math.min(.85*Math.tan(s.ab(90-T.pitch)),Math.tan(s.ab(Ks-T.pitch)))}function le(T,a){const h=T.canonical,_=a/s.ac(h.z),b=h.x+Math.pow(2,h.z)*T.wrap,A=s.ad(new Float64Array(16));return s.L(A,A,[b*_,h.y*_,0]),s.M(A,A,[_/s.Z,_/s.Z,1]),A}function ce(T,a,h,_,b){const A=s.$.fromLngLat(T,a),C=b*s.ag(1,T.lat),D=C*Math.cos(s.ab(h)),B=Math.sqrt(C*C-D*D),j=B*Math.sin(s.ab(-_)),q=B*Math.cos(s.ab(-_));return new s.$(A.x+j,A.y+q,A.z+D)}function ge(T,a,h){const _=a.intersectsFrustum(T);if(!h)return _;const b=a.intersectsPlane(h);return _===0||b===0?0:_===2&&b===2?2:1}function Pe(T,a,h){let _=0;const b=(h-a)/10;for(let A=0;A<10;A++)_+=b*Math.pow(Math.cos(a+(A+.5)/10*(h-a)),T);return _}function fe(T,a){return function(h,_,b,A,C){const D=2*((T-1)/s.ah(Math.cos(s.ab(Ks-C))/Math.cos(s.ab(Ks)))-1),B=Math.acos(b/A),j=2*Pe(D-1,0,s.ab(C/2)),q=Math.min(s.ab(Ks),B+s.ab(C/2)),X=Pe(D-1,Math.min(q,B-s.ab(C/2)),q),G=Math.atan(_/b),ae=Math.hypot(_,b);let se=h;return se+=s.ah(A/ae/Math.max(.5,Math.cos(s.ab(C/2)))),se+=D*s.ah(Math.cos(G))/2,se-=s.ah(Math.max(1,X/j/a))/2,se}}const $e=fe(9.314,3);function at(T,a){const h=(a.roundZoom?Math.round:Math.floor)(T.zoom+s.ah(T.tileSize/a.tileSize));return Math.max(0,h)}function Ne(T,a){const h=T.getCameraFrustum(),_=T.getClippingPlane(),b=T.screenPointToMercatorCoordinate(T.getCameraPoint()),A=s.$.fromLngLat(T.center,T.elevation);b.z=A.z+Math.cos(T.pitchInRadians)*T.cameraToCenterDistance/T.worldSize;const C=T.getCoveringTilesDetailsProvider(),D=C.allowVariableZoom(T,a),B=at(T,a),j=a.minzoom||0,q=a.maxzoom!==void 0?a.maxzoom:T.maxZoom,X=Math.min(Math.max(0,B),q),G=Math.pow(2,X),ae=[G*b.x,G*b.y,0],se=[G*A.x,G*A.y,0],ve=Math.hypot(A.x-b.x,A.y-b.y),_e=Math.abs(A.z-b.z),xe=Math.hypot(ve,_e),Ae=Be=>({zoom:0,x:0,y:0,wrap:Be,fullyVisible:!1}),Oe=[],ke=[];if(T.renderWorldCopies&&C.allowWorldCopies())for(let Be=1;Be<=3;Be++)Oe.push(Ae(-Be)),Oe.push(Ae(Be));for(Oe.push(Ae(0));Oe.length>0;){const Be=Oe.pop(),je=Be.x,Le=Be.y;let nt=Be.fullyVisible;const lt={x:je,y:Le,z:Be.zoom},At=C.getTileAABB(lt,Be.wrap,T.elevation,a);if(!nt){const Ht=ge(h,At,_);if(Ht===0)continue;nt=Ht===2}const St=C.distanceToTile2d(b.x,b.y,lt,At);let Tt=B;D&&(Tt=(a.calculateTileZoom||$e)(T.zoom+s.ah(T.tileSize/a.tileSize),St,_e,xe,T.fov)),Tt=(a.roundZoom?Math.round:Math.floor)(Tt),Tt=Math.max(0,Tt);const Wt=Math.min(Tt,q);if(Be.wrap=C.getWrap(A,lt,Be.wrap),Be.zoom>=Wt){if(Be.zoom<j)continue;const Ht=X-Be.zoom,Rt=ae[0]-.5-(je<<Ht),lr=ae[1]-.5-(Le<<Ht),Ir=a.reparseOverscaled?Math.max(Be.zoom,Tt):Be.zoom;ke.push({tileID:new s.Y(Be.zoom===q?Ir:Be.zoom,Be.wrap,Be.zoom,je,Le),distanceSq:s.ai([se[0]-.5-je,se[1]-.5-Le]),tileDistanceToCamera:Math.sqrt(Rt*Rt+lr*lr)})}else for(let Ht=0;Ht<4;Ht++)Oe.push({zoom:Be.zoom+1,x:(je<<1)+Ht%2,y:(Le<<1)+(Ht>>1),wrap:Be.wrap,fullyVisible:nt})}return ke.sort((Be,je)=>Be.distanceSq-je.distanceSq).map(Be=>Be.tileID)}class gt extends s.E{constructor(a,h,_){super(),this.id=a,this.dispatcher=_,this.on("data",b=>this._dataHandler(b)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((b,A,C,D)=>{const B=new(el(A.type))(b,A,C,D);if(B.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${B.id}`);return B})(a,h,_,this),this._tiles={},this._cache=new yo(0,b=>this._unloadTile(b)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new tl,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,h,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,h,_)}catch(b){a.state="errored",b.status!==404?this._source.fire(new s.k(b,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new s.l("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(a),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(bt).map(a=>a.key)}getRenderableIds(a){const h=[];for(const _ in this._tiles)this._isIdRenderable(_,a)&&h.push(this._tiles[_]);return a?h.sort((_,b)=>{const A=_.tileID,C=b.tileID,D=new s.P(A.canonical.x,A.canonical.y)._rotate(-this.transform.bearingInRadians),B=new s.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians);return A.overscaledZ-C.overscaledZ||B.y-D.y||B.x-D.x}).map(_=>_.tileID.key):h.map(_=>_.tileID).sort(bt).map(_=>_.key)}hasRenderableParent(a){const h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())}reload(a){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const h in this._tiles)(a||this._tiles[h].state!=="errored")&&this._reloadTile(h,"reloading")}}_reloadTile(a,h){return s._(this,void 0,void 0,function*(){const _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=h),yield this._loadTile(_,a,h))})}_tileLoaded(a,h,_){a.timeAdded=I.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const h=this.getRenderableIds();for(let b=0;b<h.length;b++){const A=h[b];if(a.neighboringTiles&&a.neighboringTiles[A]){const C=this.getTileByID(A);_(a,C),_(C,a)}}function _(b,A){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let C=A.tileID.canonical.x-b.tileID.canonical.x;const D=A.tileID.canonical.y-b.tileID.canonical.y,B=Math.pow(2,b.tileID.canonical.z),j=A.tileID.key;C===0&&D===0||Math.abs(D)>1||(Math.abs(C)>1&&(Math.abs(C+B)===1?C+=B:Math.abs(C-B)===1&&(C-=B)),A.dem&&b.dem&&(b.dem.backfillBorder(A.dem,C,D),b.neighboringTiles&&b.neighboringTiles[j]&&(b.neighboringTiles[j].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,h,_,b){for(const A in this._tiles){let C=this._tiles[A];if(b[A]||!C.hasData()||C.tileID.overscaledZ<=h||C.tileID.overscaledZ>_)continue;let D=C.tileID;for(;C&&C.tileID.overscaledZ>h+1;){const j=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[j.key],C&&C.hasData()&&(D=j)}let B=D;for(;B.overscaledZ>h;)if(B=B.scaledTo(B.overscaledZ-1),a[B.key]||a[B.canonical.key]){b[D.key]=D;break}}}findLoadedParent(a,h){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=a.overscaledZ-1;_>=h;_--){const b=a.scaledTo(_),A=this._getLoadedTile(b);if(A)return A}}findLoadedSibling(a){return this._getLoadedTile(a)}_getLoadedTile(a){const h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const h=Math.ceil(a.width/this._source.tileSize)+1,_=Math.ceil(a.height/this._source.tileSize)+1,b=Math.floor(h*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)}handleWrapJump(a){const h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){const _={};for(const b in this._tiles){const A=this._tiles[b];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),_[A.tileID.key]=A}this._tiles=_;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}_updateCoveredAndRetainedTiles(a,h,_,b,A,C){const D={},B={},j=Object.keys(a),q=I.now();for(const X of j){const G=a[X],ae=this._tiles[X];if(!ae||ae.fadeEndTime!==0&&ae.fadeEndTime<=q)continue;const se=this.findLoadedParent(G,h),ve=this.findLoadedSibling(G),_e=se||ve||null;_e&&(this._addTile(_e.tileID),D[_e.tileID.key]=_e.tileID),B[X]=G}this._retainLoadedChildren(B,b,_,a);for(const X in D)a[X]||(this._coveredTiles[X]=!0,a[X]=D[X]);if(C){const X={},G={};for(const ae of A)this._tiles[ae.key].hasData()?X[ae.key]=ae:G[ae.key]=ae;for(const ae in G){const se=G[ae].children(this._source.maxzoom);this._tiles[se[0].key]&&this._tiles[se[1].key]&&this._tiles[se[2].key]&&this._tiles[se[3].key]&&(X[se[0].key]=a[se[0].key]=se[0],X[se[1].key]=a[se[1].key]=se[1],X[se[2].key]=a[se[2].key]=se[2],X[se[3].key]=a[se[3].key]=se[3],delete G[ae])}for(const ae in G){const se=G[ae],ve=this.findLoadedParent(se,this._source.minzoom),_e=this.findLoadedSibling(se),xe=ve||_e||null;if(xe){X[xe.tileID.key]=a[xe.tileID.key]=xe.tileID;for(const Ae in X)X[Ae].isChildOf(xe.tileID)&&delete X[Ae]}}for(const ae in this._tiles)X[ae]||(this._coveredTiles[ae]=!0)}}update(a,h){if(!this._sourceLoaded||this._paused)return;let _;this.transform=a,this.terrain=h,this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new s.Y(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(_=Ne(a,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter(q=>this._source.hasTile(q)))):_=[];const b=at(a,this._source),A=Math.max(b-gt.maxOverzooming,this._source.minzoom),C=Math.max(b+gt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const X of _)if(X.canonical.z>this._source.minzoom){const G=X.scaledTo(X.canonical.z-1);q[G.key]=G;const ae=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));q[ae.key]=ae}_=_.concat(Object.values(q))}const D=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(_,b);Ke(this._source.type)&&this._updateCoveredAndRetainedTiles(B,A,C,b,_,h);for(const q in B)this._tiles[q].clearFadeHold();const j=s.aj(this._tiles,B);for(const q of j){const X=this._tiles[q];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,h){var _;const b={},A={},C=Math.max(h-gt.maxOverzooming,this._source.minzoom),D=Math.max(h+gt.maxUnderzooming,this._source.minzoom),B={};for(const j of a){const q=this._addTile(j);b[j.key]=j,q.hasData()||h<this._source.maxzoom&&(B[j.key]=j)}this._retainLoadedChildren(B,h,D,b);for(const j of a){let q=this._tiles[j.key];if(q.hasData())continue;if(h+1>this._source.maxzoom){const G=j.children(this._source.maxzoom)[0],ae=this.getTile(G);if(ae&&ae.hasData()){b[G.key]=G;continue}}else{const G=j.children(this._source.maxzoom);if(b[G[0].key]&&b[G[1].key]&&b[G[2].key]&&b[G[3].key])continue}let X=q.wasRequested();for(let G=j.overscaledZ-1;G>=C;--G){const ae=j.scaledTo(G);if(A[ae.key])break;if(A[ae.key]=!0,q=this.getTile(ae),!q&&X&&(q=this._addTile(ae)),q){const se=q.hasData();if((se||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||X)&&(b[ae.key]=ae),X=q.wasRequested(),se)break}}}return b}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const h=[];let _,b=this._tiles[a].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){_=this._loadedParentTiles[b.key];break}h.push(b.key);const A=b.scaledTo(b.overscaledZ-1);if(_=this._getLoadedTile(A),_)break;b=A}for(const A of h)this._loadedParentTiles[A]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const a in this._tiles){const h=this._tiles[a].tileID,_=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=_}}_addTile(a){let h=this._tiles[a.key];if(h)return h;h=this._cache.getAndRemove(a),h&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));const _=h;return h||(h=new Ci(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,a.key,h.state)),h.uses++,this._tiles[a.key]=h,_||this._source.fire(new s.l("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(a,h){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=h.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(a){const h=a.sourceDataType;a.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&h==="content"&&(this.reload(a.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,h,_){const b=[],A=this.transform;if(!A)return b;const C=_?A.getCameraQueryGeometry(a):a,D=a.map(se=>A.screenPointToMercatorCoordinate(se,this.terrain)),B=C.map(se=>A.screenPointToMercatorCoordinate(se,this.terrain)),j=this.getIds();let q=1/0,X=1/0,G=-1/0,ae=-1/0;for(const se of B)q=Math.min(q,se.x),X=Math.min(X,se.y),G=Math.max(G,se.x),ae=Math.max(ae,se.y);for(let se=0;se<j.length;se++){const ve=this._tiles[j[se]];if(ve.holdingForFade())continue;const _e=A.getCoveringTilesDetailsProvider().allowWorldCopies()?ve.tileID:ve.tileID.unwrapTo(0),xe=Math.pow(2,A.zoom-ve.tileID.overscaledZ),Ae=h*ve.queryPadding*s.Z/ve.tileSize/xe,Oe=[_e.getTilePoint(new s.$(q,X)),_e.getTilePoint(new s.$(G,ae))];if(Oe[0].x-Ae<s.Z&&Oe[0].y-Ae<s.Z&&Oe[1].x+Ae>=0&&Oe[1].y+Ae>=0){const ke=D.map(je=>_e.getTilePoint(je)),Be=B.map(je=>_e.getTilePoint(je));b.push({tile:ve,tileID:_e,queryGeometry:ke,cameraQueryGeometry:Be,scale:xe})}}return b}getVisibleCoordinates(a){const h=this.getRenderableIds(a).map(_=>this._tiles[_].tileID);return this.transform&&this.transform.populateCache(h),h}hasTransition(){if(this._source.hasTransition())return!0;if(Ke(this._source.type)){const a=I.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=a)return!0}return!1}setFeatureState(a,h,_){this._state.updateState(a=a||"_geojsonTileLayer",h,_)}removeFeatureState(a,h,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,_)}getFeatureState(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)}setDependencies(a,h,_){const b=this._tiles[a];b&&b.setDependencies(h,_)}reloadTilesForDependencies(a,h){for(const _ in this._tiles)this._tiles[_].hasDependency(a,h)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(a,h))}}function bt(T,a){const h=Math.abs(2*T.wrap)-+(T.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return T.overscaledZ-a.overscaledZ||_-h||a.canonical.y-T.canonical.y||a.canonical.x-T.canonical.x}function Ke(T){return T==="raster"||T==="image"||T==="video"}gt.maxOverzooming=10,gt.maxUnderzooming=3;class It{constructor(a,h){this.reset(a,h)}reset(a,h){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.ae(a,0,1);let h=1,_=this._distances[h];const b=a*this.paddedLength+this.padding;for(;_<b&&h<this._distances.length;)_=this._distances[++h];const A=h-1,C=this._distances[A],D=_-C,B=D>0?(b-C)/D:0;return this.points[A].mult(1-B).add(this.points[h].mult(B))}}function Xt(T,a){let h=!0;return T==="always"||T!=="never"&&a!=="never"||(h=!1),h}class Kt{constructor(a,h,_){const b=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(h/_);for(let C=0;C<this.xCellCount*this.yCellCount;C++)b.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=h,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,h,_,b,A){this._forEachCell(h,_,b,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(b),this.bboxes.push(A)}insertCircle(a,h,_,b){this._forEachCell(h-b,_-b,h+b,_+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(h),this.circles.push(_),this.circles.push(b)}_insertBoxCell(a,h,_,b,A,C){this.boxCells[A].push(C)}_insertCircleCell(a,h,_,b,A,C){this.circleCells[A].push(C)}_query(a,h,_,b,A,C,D){if(_<0||a>this.width||b<0||h>this.height)return[];const B=[];if(a<=0&&h<=0&&this.width<=_&&this.height<=b){if(A)return[{key:null,x1:a,y1:h,x2:_,y2:b}];for(let j=0;j<this.boxKeys.length;j++)B.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const q=this.circles[3*j],X=this.circles[3*j+1],G=this.circles[3*j+2];B.push({key:this.circleKeys[j],x1:q-G,y1:X-G,x2:q+G,y2:X+G})}}else this._forEachCell(a,h,_,b,this._queryCell,B,{hitTest:A,overlapMode:C,seenUids:{box:{},circle:{}}},D);return B}query(a,h,_,b){return this._query(a,h,_,b,!1,null)}hitTest(a,h,_,b,A,C){return this._query(a,h,_,b,!0,A,C).length>0}hitTestCircle(a,h,_,b,A){const C=a-_,D=a+_,B=h-_,j=h+_;if(D<0||C>this.width||j<0||B>this.height)return!1;const q=[];return this._forEachCell(C,B,D,j,this._queryCellCircle,q,{hitTest:!0,overlapMode:b,circle:{x:a,y:h,radius:_},seenUids:{box:{},circle:{}}},A),q.length>0}_queryCell(a,h,_,b,A,C,D,B){const{seenUids:j,hitTest:q,overlapMode:X}=D,G=this.boxCells[A];if(G!==null){const se=this.bboxes;for(const ve of G)if(!j.box[ve]){j.box[ve]=!0;const _e=4*ve,xe=this.boxKeys[ve];if(a<=se[_e+2]&&h<=se[_e+3]&&_>=se[_e+0]&&b>=se[_e+1]&&(!B||B(xe))&&(!q||!Xt(X,xe.overlapMode))&&(C.push({key:xe,x1:se[_e],y1:se[_e+1],x2:se[_e+2],y2:se[_e+3]}),q))return!0}}const ae=this.circleCells[A];if(ae!==null){const se=this.circles;for(const ve of ae)if(!j.circle[ve]){j.circle[ve]=!0;const _e=3*ve,xe=this.circleKeys[ve];if(this._circleAndRectCollide(se[_e],se[_e+1],se[_e+2],a,h,_,b)&&(!B||B(xe))&&(!q||!Xt(X,xe.overlapMode))){const Ae=se[_e],Oe=se[_e+1],ke=se[_e+2];if(C.push({key:xe,x1:Ae-ke,y1:Oe-ke,x2:Ae+ke,y2:Oe+ke}),q)return!0}}}return!1}_queryCellCircle(a,h,_,b,A,C,D,B){const{circle:j,seenUids:q,overlapMode:X}=D,G=this.boxCells[A];if(G!==null){const se=this.bboxes;for(const ve of G)if(!q.box[ve]){q.box[ve]=!0;const _e=4*ve,xe=this.boxKeys[ve];if(this._circleAndRectCollide(j.x,j.y,j.radius,se[_e+0],se[_e+1],se[_e+2],se[_e+3])&&(!B||B(xe))&&!Xt(X,xe.overlapMode))return C.push(!0),!0}}const ae=this.circleCells[A];if(ae!==null){const se=this.circles;for(const ve of ae)if(!q.circle[ve]){q.circle[ve]=!0;const _e=3*ve,xe=this.circleKeys[ve];if(this._circlesCollide(se[_e],se[_e+1],se[_e+2],j.x,j.y,j.radius)&&(!B||B(xe))&&!Xt(X,xe.overlapMode))return C.push(!0),!0}}}_forEachCell(a,h,_,b,A,C,D,B){const j=this._convertToXCellCoord(a),q=this._convertToYCellCoord(h),X=this._convertToXCellCoord(_),G=this._convertToYCellCoord(b);for(let ae=j;ae<=X;ae++)for(let se=q;se<=G;se++)if(A.call(this,a,h,_,b,this.xCellCount*se+ae,C,D,B))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,h,_,b,A,C){const D=b-a,B=A-h,j=_+C;return j*j>D*D+B*B}_circleAndRectCollide(a,h,_,b,A,C,D){const B=(C-b)/2,j=Math.abs(a-(b+B));if(j>B+_)return!1;const q=(D-A)/2,X=Math.abs(h-(A+q));if(X>q+_)return!1;if(j<=B||X<=q)return!0;const G=j-B,ae=X-q;return G*G+ae*ae<=_*_}}function dr(T,a,h){const _=s.K();if(!T){const{vecSouth:X,vecEast:G}=_t(a),ae=v();ae[0]=G[0],ae[1]=G[1],ae[2]=X[0],ae[3]=X[1],b=ae,(q=(C=(A=ae)[0])*(j=A[3])-(B=A[2])*(D=A[1]))&&(b[0]=j*(q=1/q),b[1]=-D*q,b[2]=-B*q,b[3]=C*q),_[0]=ae[0],_[1]=ae[1],_[4]=ae[2],_[5]=ae[3]}var b,A,C,D,B,j,q;return s.M(_,_,[1/h,1/h,1]),_}function _r(T,a,h,_){if(T){const b=s.K();if(!a){const{vecSouth:A,vecEast:C}=_t(h);b[0]=C[0],b[1]=C[1],b[4]=A[0],b[5]=A[1]}return s.M(b,b,[_,_,1]),b}return h.pixelsToClipSpaceMatrix}function _t(T){const a=Math.cos(T.rollInRadians),h=Math.sin(T.rollInRadians),_=Math.cos(T.pitchInRadians),b=Math.cos(T.bearingInRadians),A=Math.sin(T.bearingInRadians),C=s.ao();C[0]=-b*_*h-A*a,C[1]=-A*_*h+b*a;const D=s.ap(C);D<1e-9?s.aq(C):s.ar(C,C,1/D);const B=s.ao();B[0]=b*_*a-A*h,B[1]=A*_*a+b*h;const j=s.ap(B);return j<1e-9?s.aq(B):s.ar(B,B,1/j),{vecEast:B,vecSouth:C}}function vr(T,a,h,_){let b;_?(b=[T,a,_(T,a),1],s.at(b,b,h)):(b=[T,a,0,1],gn(b,b,h));const A=b[3];return{point:new s.P(b[0]/A,b[1]/A),signedDistanceFromCamera:A,isOccluded:!1}}function jr(T,a){return .5+T/a*.5}function rn(T,a){return T.x>=-a[0]&&T.x<=a[0]&&T.y>=-a[1]&&T.y<=a[1]}function qr(T,a,h,_,b,A,C,D,B,j,q,X,G){const ae=h?T.textSizeData:T.iconSizeData,se=s.ak(ae,a.transform.zoom),ve=[256/a.width*2+1,256/a.height*2+1],_e=h?T.text.dynamicLayoutVertexArray:T.icon.dynamicLayoutVertexArray;_e.clear();const xe=T.lineVertexArray,Ae=h?T.text.placedSymbolArray:T.icon.placedSymbolArray,Oe=a.transform.width/a.transform.height;let ke=!1;for(let Be=0;Be<Ae.length;Be++){const je=Ae.get(Be);if(je.hidden||je.writingMode===s.al.vertical&&!ke){Ni(je.numGlyphs,_e);continue}ke=!1;const Le=new s.P(je.anchorX,je.anchorY),nt={getElevation:G,pitchedLabelPlaneMatrix:_,lineVertexArray:xe,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:a.transform,tileAnchorPoint:Le,unwrappedTileID:B,width:j,height:q,translation:X},lt=ni(je.anchorX,je.anchorY,nt);if(!rn(lt.point,ve)){Ni(je.numGlyphs,_e);continue}const At=jr(a.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),St=s.am(ae,se,je),Tt=A?St*a.transform.getPitchedTextCorrection(je.anchorX,je.anchorY,B)/At:St*At,Wt=yr({projectionContext:nt,pitchedLabelPlaneMatrixInverse:b,symbol:je,fontSize:Tt,flip:!1,keepUpright:C,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:_e,aspectRatio:Oe,rotateToLine:D});ke=Wt.useVertical,(Wt.notEnoughRoom||ke||Wt.needsFlipping&&yr({projectionContext:nt,pitchedLabelPlaneMatrixInverse:b,symbol:je,fontSize:Tt,flip:!0,keepUpright:C,glyphOffsetArray:T.glyphOffsetArray,dynamicLayoutVertexArray:_e,aspectRatio:Oe,rotateToLine:D}).notEnoughRoom)&&Ni(je.numGlyphs,_e)}h?T.text.dynamicLayoutVertexBuffer.updateData(_e):T.icon.dynamicLayoutVertexBuffer.updateData(_e)}function Mt(T,a,h,_,b,A,C,D){const B=A.glyphStartIndex+A.numGlyphs,j=A.lineStartIndex,q=A.lineStartIndex+A.lineLength,X=a.getoffsetX(A.glyphStartIndex),G=a.getoffsetX(B-1),ae=Ba(T*X,h,_,b,A.segment,j,q,D,C);if(!ae)return null;const se=Ba(T*G,h,_,b,A.segment,j,q,D,C);return se?D.projectionCache.anyProjectionOccluded?null:{first:ae,last:se}:null}function er(T,a,h,_){return T===s.al.horizontal&&Math.abs(h.y-a.y)>Math.abs(h.x-a.x)*_?{useVertical:!0}:(T===s.al.vertical?a.y<h.y:a.x>h.x)?{needsFlipping:!0}:null}function yr(T){const{projectionContext:a,pitchedLabelPlaneMatrixInverse:h,symbol:_,fontSize:b,flip:A,keepUpright:C,glyphOffsetArray:D,dynamicLayoutVertexArray:B,aspectRatio:j,rotateToLine:q}=T,X=b/24,G=_.lineOffsetX*X,ae=_.lineOffsetY*X;let se;if(_.numGlyphs>1){const ve=_.glyphStartIndex+_.numGlyphs,_e=_.lineStartIndex,xe=_.lineStartIndex+_.lineLength,Ae=Mt(X,D,G,ae,A,_,q,a);if(!Ae)return{notEnoughRoom:!0};const Oe=wr(Ae.first.point.x,Ae.first.point.y,a,h),ke=wr(Ae.last.point.x,Ae.last.point.y,a,h);if(C&&!A){const Be=er(_.writingMode,Oe,ke,j);if(Be)return Be}se=[Ae.first];for(let Be=_.glyphStartIndex+1;Be<ve-1;Be++)se.push(Ba(X*D.getoffsetX(Be),G,ae,A,_.segment,_e,xe,a,q));se.push(Ae.last)}else{if(C&&!A){const _e=on(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,xe=_.lineStartIndex+_.segment+1,Ae=new s.P(a.lineVertexArray.getx(xe),a.lineVertexArray.gety(xe)),Oe=on(Ae.x,Ae.y,a),ke=Oe.signedDistanceFromCamera>0?Oe.point:mi(a.tileAnchorPoint,Ae,_e,1,a),Be=wr(_e.x,_e.y,a,h),je=wr(ke.x,ke.y,a,h),Le=er(_.writingMode,Be,je,j);if(Le)return Le}const ve=Ba(X*D.getoffsetX(_.glyphStartIndex),G,ae,A,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,a,q);if(!ve||a.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};se=[ve]}for(const ve of se)s.as(B,ve.point,ve.angle);return{}}function mi(T,a,h,_,b){const A=T.add(T.sub(a)._unit()),C=on(A.x,A.y,b).point,D=h.sub(C);return h.add(D._mult(_/D.mag()))}function ci(T,a,h){const _=a.projectionCache;if(_.projections[T])return _.projections[T];const b=new s.P(a.lineVertexArray.getx(T),a.lineVertexArray.gety(T)),A=on(b.x,b.y,a);if(A.signedDistanceFromCamera>0)return _.projections[T]=A.point,_.anyProjectionOccluded=_.anyProjectionOccluded||A.isOccluded,A.point;const C=T-h.direction;return mi(h.distanceFromAnchor===0?a.tileAnchorPoint:new s.P(a.lineVertexArray.getx(C),a.lineVertexArray.gety(C)),b,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,a)}function on(T,a,h){const _=T+h.translation[0],b=a+h.translation[1];let A;return h.pitchWithMap?(A=vr(_,b,h.pitchedLabelPlaneMatrix,h.getElevation),A.isOccluded=!1):(A=h.transform.projectTileCoordinates(_,b,h.unwrappedTileID,h.getElevation),A.point.x=(.5*A.point.x+.5)*h.width,A.point.y=(.5*-A.point.y+.5)*h.height),A}function wr(T,a,h,_){if(h.pitchWithMap){const b=[T,a,0,1];return s.at(b,b,_),h.transform.projectTileCoordinates(b[0]/b[3],b[1]/b[3],h.unwrappedTileID,h.getElevation).point}return{x:T/h.width*2-1,y:a/h.height*2-1}}function ni(T,a,h){return h.transform.projectTileCoordinates(T,a,h.unwrappedTileID,h.getElevation)}function rl(T,a,h){return T._unit()._perp()._mult(a*h)}function Lu(T,a,h,_,b,A,C,D,B){if(D.projectionCache.offsets[T])return D.projectionCache.offsets[T];const j=h.add(a);if(T+B.direction<_||T+B.direction>=b)return D.projectionCache.offsets[T]=j,j;const q=ci(T+B.direction,D,B),X=rl(q.sub(h),C,B.direction),G=h.add(X),ae=q.add(X);return D.projectionCache.offsets[T]=s.au(A,j,G,ae)||j,D.projectionCache.offsets[T]}function Ba(T,a,h,_,b,A,C,D,B){const j=_?T-a:T+a;let q=j>0?1:-1,X=0;_&&(q*=-1,X=Math.PI),q<0&&(X+=Math.PI);let G,ae=q>0?A+b:A+b+1;D.projectionCache.cachedAnchorPoint?G=D.projectionCache.cachedAnchorPoint:(G=on(D.tileAnchorPoint.x,D.tileAnchorPoint.y,D).point,D.projectionCache.cachedAnchorPoint=G);let se,ve,_e=G,xe=G,Ae=0,Oe=0;const ke=Math.abs(j),Be=[];let je;for(;Ae+Oe<=ke;){if(ae+=q,ae<A||ae>=C)return null;Ae+=Oe,xe=_e,ve=se;const lt={absOffsetX:ke,direction:q,distanceFromAnchor:Ae,previousVertex:xe};if(_e=ci(ae,D,lt),h===0)Be.push(xe),je=_e.sub(xe);else{let At;const St=_e.sub(xe);At=St.mag()===0?rl(ci(ae+q,D,lt).sub(_e),h,q):rl(St,h,q),ve||(ve=xe.add(At)),se=Lu(ae,At,_e,A,C,ve,h,D,lt),Be.push(ve),je=se.sub(ve)}Oe=je.mag()}const Le=je._mult((ke-Ae)/Oe)._add(ve||xe),nt=X+Math.atan2(_e.y-xe.y,_e.x-xe.x);return Be.push(Le),{point:Le,angle:B?nt:0,path:Be}}const vo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ni(T,a){for(let h=0;h<T;h++){const _=a.length;a.resize(_+4),a.float32.set(vo,3*_)}}function gn(T,a,h){const _=a[0],b=a[1];return T[0]=h[0]*_+h[4]*b+h[12],T[1]=h[1]*_+h[5]*b+h[13],T[3]=h[3]*_+h[7]*b+h[15],T}const Ri=100;class Fu{constructor(a,h=new Kt(a.width+200,a.height+200,25),_=new Kt(a.width+200,a.height+200,25)){this.transform=a,this.grid=h,this.ignoredGrid=_,this.pitchFactor=Math.cos(a.pitch*Math.PI/180)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Ri,this.screenBottomBoundary=a.height+Ri,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,h,_,b,A,C,D,B,j,q,X,G){const ae=this.projectAndGetPerspectiveRatio(a.anchorPointX+B[0],a.anchorPointY+B[1],A,q,G),se=_*ae.perspectiveRatio;let ve;if(C||D)ve=this._projectCollisionBox(a,se,b,A,C,D,B,ae,q,X,G);else{const je=ae.x+(X?X.x*se:0),Le=ae.y+(X?X.y*se:0);ve={allPointsOccluded:!1,box:[je+a.x1*se,Le+a.y1*se,je+a.x2*se,Le+a.y2*se]}}const[_e,xe,Ae,Oe]=ve.box,ke=C?ve.allPointsOccluded:ae.isOccluded;let Be=ke;return Be||(Be=ae.perspectiveRatio<this.perspectiveRatioCutoff),Be||(Be=!this.isInsideGrid(_e,xe,Ae,Oe)),Be||h!=="always"&&this.grid.hitTest(_e,xe,Ae,Oe,h,j)?{box:[_e,xe,Ae,Oe],placeable:!1,offscreen:!1,occluded:ke}:{box:[_e,xe,Ae,Oe],placeable:!0,offscreen:this.isOffscreen(_e,xe,Ae,Oe),occluded:ke}}placeCollisionCircles(a,h,_,b,A,C,D,B,j,q,X,G,ae,se){const ve=[],_e=new s.P(h.anchorX,h.anchorY),xe=this.getPerspectiveRatio(_e.x,_e.y,C,se),Ae=(j?A*this.transform.getPitchedTextCorrection(h.anchorX,h.anchorY,C)/xe:A*xe)/s.ay,Oe={getElevation:se,pitchedLabelPlaneMatrix:D,lineVertexArray:_,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:_e,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:ae},ke=Mt(Ae,b,h.lineOffsetX*Ae,h.lineOffsetY*Ae,!1,h,!1,Oe);let Be=!1,je=!1,Le=!0;if(ke){const nt=.5*X*xe+G,lt=new s.P(-100,-100),At=new s.P(this.screenRightBoundary,this.screenBottomBoundary),St=new It,Tt=ke.first,Wt=ke.last;let Ht=[];for(let Ir=Tt.path.length-1;Ir>=1;Ir--)Ht.push(Tt.path[Ir]);for(let Ir=1;Ir<Wt.path.length;Ir++)Ht.push(Wt.path[Ir]);const Rt=2.5*nt;if(j){const Ir=this.projectPathToScreenSpace(Ht,Oe);Ht=Ir.some(Tr=>Tr.signedDistanceFromCamera<=0)?[]:Ir.map(Tr=>Tr.point)}let lr=[];if(Ht.length>0){const Ir=Ht[0].clone(),Tr=Ht[0].clone();for(let In=1;In<Ht.length;In++)Ir.x=Math.min(Ir.x,Ht[In].x),Ir.y=Math.min(Ir.y,Ht[In].y),Tr.x=Math.max(Tr.x,Ht[In].x),Tr.y=Math.max(Tr.y,Ht[In].y);lr=Ir.x>=lt.x&&Tr.x<=At.x&&Ir.y>=lt.y&&Tr.y<=At.y?[Ht]:Tr.x<lt.x||Ir.x>At.x||Tr.y<lt.y||Ir.y>At.y?[]:s.av([Ht],lt.x,lt.y,At.x,At.y)}for(const Ir of lr){St.reset(Ir,.25*nt);let Tr=0;Tr=St.length<=.5*nt?1:Math.ceil(St.paddedLength/Rt)+1;for(let In=0;In<Tr;In++){const en=In/Math.max(Tr-1,1),On=St.lerp(en),un=On.x+Ri,nn=On.y+Ri;ve.push(un,nn,nt,0);const Kr=un-nt,_i=nn-nt,yi=un+nt,Fi=nn+nt;if(Le=Le&&this.isOffscreen(Kr,_i,yi,Fi),je=je||this.isInsideGrid(Kr,_i,yi,Fi),a!=="always"&&this.grid.hitTestCircle(un,nn,nt,a,q)&&(Be=!0,!B))return{circles:[],offscreen:!1,collisionDetected:Be}}}}return{circles:!B&&Be||!je||xe<this.perspectiveRatioCutoff?[]:ve,offscreen:Le,collisionDetected:Be}}projectPathToScreenSpace(a,h){const _=function(b,A){const C=s.K();return s.an(C,A.pitchedLabelPlaneMatrix),b.map(D=>{const B=vr(D.x,D.y,C,A.getElevation),j=A.transform.projectTileCoordinates(B.point.x,B.point.y,A.unwrappedTileID,A.getElevation);return j.point.x=(.5*j.point.x+.5)*A.width,j.point.y=(.5*-j.point.y+.5)*A.height,j})}(a,h);return function(b){let A=0,C=0,D=0,B=0;for(let j=0;j<b.length;j++)b[j].isOccluded?(D=j+1,B=0):(B++,B>C&&(C=B,A=D));return b.slice(A,A+C)}(_)}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,b=1/0,A=-1/0,C=-1/0;for(const q of a){const X=new s.P(q.x+Ri,q.y+Ri);_=Math.min(_,X.x),b=Math.min(b,X.y),A=Math.max(A,X.x),C=Math.max(C,X.y),h.push(X)}const D=this.grid.query(_,b,A,C).concat(this.ignoredGrid.query(_,b,A,C)),B={},j={};for(const q of D){const X=q.key;if(B[X.bucketInstanceId]===void 0&&(B[X.bucketInstanceId]={}),B[X.bucketInstanceId][X.featureIndex])continue;const G=[new s.P(q.x1,q.y1),new s.P(q.x2,q.y1),new s.P(q.x2,q.y2),new s.P(q.x1,q.y2)];s.aw(h,G)&&(B[X.bucketInstanceId][X.featureIndex]=!0,j[X.bucketInstanceId]===void 0&&(j[X.bucketInstanceId]=[]),j[X.bucketInstanceId].push(X.featureIndex))}return j}insertCollisionBox(a,h,_,b,A,C){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:A,collisionGroupID:C,overlapMode:h},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,h,_,b,A,C){const D=_?this.ignoredGrid:this.grid,B={bucketInstanceId:b,featureIndex:A,collisionGroupID:C,overlapMode:h};for(let j=0;j<a.length;j+=4)D.insertCircle(B,a[j],a[j+1],a[j+2])}projectAndGetPerspectiveRatio(a,h,_,b,A){if(A){let C;b?(C=[a,h,b(a,h),1],s.at(C,C,A)):(C=[a,h,0,1],gn(C,C,A));const D=C[3];return{x:(C[0]/D+1)/2*this.transform.width+Ri,y:(-C[1]/D+1)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/D*.5,isOccluded:!1,signedDistanceFromCamera:D}}{const C=this.transform.projectTileCoordinates(a,h,_,b);return{x:(C.point.x+1)/2*this.transform.width+Ri,y:(1-C.point.y)/2*this.transform.height+Ri,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5,isOccluded:C.isOccluded,signedDistanceFromCamera:C.signedDistanceFromCamera}}}getPerspectiveRatio(a,h,_,b){const A=this.transform.projectTileCoordinates(a,h,_,b);return .5+this.transform.cameraToCenterDistance/A.signedDistanceFromCamera*.5}isOffscreen(a,h,_,b){return _<Ri||a>=this.screenRightBoundary||b<Ri||h>this.screenBottomBoundary}isInsideGrid(a,h,_,b){return _>=0&&a<this.gridRightBoundary&&b>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const a=s.ad([]);return s.L(a,a,[-100,-100,0]),a}_projectCollisionBox(a,h,_,b,A,C,D,B,j,q,X){let G=1,ae=0,se=0,ve=1;const _e=a.anchorPointX+D[0],xe=a.anchorPointY+D[1];if(C&&!A){const Ht=this.projectAndGetPerspectiveRatio(_e+1,xe,b,j,X),Rt=Ht.x-B.x,lr=Math.atan((Ht.y-B.y)/Rt)+(Rt<0?Math.PI:0),Ir=Math.sin(lr),Tr=Math.cos(lr);G=Tr,ae=Ir,se=-Ir,ve=Tr}else if(!C&&A){const Ht=_t(this.transform);G=Ht.vecEast[0],ae=Ht.vecEast[1],se=Ht.vecSouth[0],ve=Ht.vecSouth[1]}let Ae=B.x,Oe=B.y,ke=h;A&&(Ae=_e,Oe=xe,ke=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),ke*=this.transform.getPitchedTextCorrection(_e,xe,b),q||(ke*=s.ae(.5+B.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),q&&(Ae+=G*q.x*ke+se*q.y*ke,Oe+=ae*q.x*ke+ve*q.y*ke);const Be=a.x1*ke,je=a.x2*ke,Le=(Be+je)/2,nt=a.y1*ke,lt=a.y2*ke,At=(nt+lt)/2,St=[{offsetX:Be,offsetY:nt},{offsetX:Le,offsetY:nt},{offsetX:je,offsetY:nt},{offsetX:je,offsetY:At},{offsetX:je,offsetY:lt},{offsetX:Le,offsetY:lt},{offsetX:Be,offsetY:lt},{offsetX:Be,offsetY:At}];let Tt=[];for(const{offsetX:Ht,offsetY:Rt}of St)Tt.push(new s.P(Ae+G*Ht+se*Rt,Oe+ae*Ht+ve*Rt));let Wt=!1;if(A){const Ht=Tt.map(Rt=>this.projectAndGetPerspectiveRatio(Rt.x,Rt.y,b,j,X));Wt=Ht.some(Rt=>!Rt.isOccluded),Tt=Ht.map(Rt=>new s.P(Rt.x,Rt.y))}else Wt=!0;return{box:s.ax(Tt),allPointsOccluded:!Wt}}}class Yl{constructor(a,h,_,b){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?h:-h))):b&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class La{constructor(a,h,_,b,A){this.text=new Yl(a?a.text:null,h,_,A),this.icon=new Yl(a?a.icon:null,h,b,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ta{constructor(a,h,_){this.text=a,this.icon=h,this.skipFade=_}}class ef{constructor(a,h,_,b,A){this.bucketInstanceId=a,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=b,this.tileID=A}}class Sd{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const h=++this.maxGroupID;this.collisionGroups[a]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[a]}}function nl(T,a,h,_,b){const{horizontalAlign:A,verticalAlign:C}=s.aE(T);return new s.P(-(A-.5)*a+_[0]*b,-(C-.5)*h+_[1]*b)}class il{constructor(a,h,_,b,A){this.transform=a.clone(),this.terrain=h,this.collisionIndex=new Fu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Sd(b),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(a){const h=this.terrain;return h?(_,b)=>h.getElevation(a,_,b):null}getBucketParts(a,h,_,b){const A=_.getBucket(h),C=_.latestFeatureIndex;if(!A||!C||h.id!==A.layerIds[0])return;const D=_.collisionBoxArray,B=A.layers[0].layout,j=A.layers[0].paint,q=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),X=_.tileSize/s.Z,G=_.tileID.toUnwrapped(),ae=B.get("text-rotation-alignment")==="map",se=s.az(_,1,this.transform.zoom),ve=s.aA(this.collisionIndex.transform,_,j.get("text-translate"),j.get("text-translate-anchor")),_e=s.aA(this.collisionIndex.transform,_,j.get("icon-translate"),j.get("icon-translate-anchor")),xe=dr(ae,this.transform,se);this.retainedQueryData[A.bucketInstanceId]=new ef(A.bucketInstanceId,C,A.sourceLayerIndex,A.index,_.tileID);const Ae={bucket:A,layout:B,translationText:ve,translationIcon:_e,unwrappedTileID:G,pitchedLabelPlaneMatrix:xe,scale:q,textPixelRatio:X,holdingForFade:_.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.ak(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(b)for(const Oe of A.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:Be,symbolInstanceEnd:je}=Oe;a.push({sortKey:ke,symbolInstanceStart:Be,symbolInstanceEnd:je,parameters:Ae})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(a,h,_,b,A,C,D,B,j,q,X,G,ae,se,ve,_e,xe,Ae,Oe,ke){const Be=s.aB[a.textAnchor],je=[a.textOffset0,a.textOffset1],Le=nl(Be,_,b,je,A),nt=this.collisionIndex.placeCollisionBox(h,G,B,j,q,D,C,_e,X.predicate,Oe,Le,ke);if((!Ae||this.collisionIndex.placeCollisionBox(Ae,G,B,j,q,D,C,xe,X.predicate,Oe,Le,ke).placeable)&&nt.placeable){let lt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ae.crossTileID]&&this.prevPlacement.placements[ae.crossTileID]&&this.prevPlacement.placements[ae.crossTileID].text&&(lt=this.prevPlacement.variableOffsets[ae.crossTileID].anchor),ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ae.crossTileID]={textOffset:je,width:_,height:b,anchor:Be,textBoxScale:A,prevAnchor:lt},this.markUsedJustification(se,Be,ae,ve),se.allowVerticalPlacement&&(this.markUsedOrientation(se,ve,ae),this.placedOrientations[ae.crossTileID]=ve),{shift:Le,placedGlyphBoxes:nt}}}placeLayerBucketPart(a,h,_){const{bucket:b,layout:A,translationText:C,translationIcon:D,unwrappedTileID:B,pitchedLabelPlaneMatrix:j,textPixelRatio:q,holdingForFade:X,collisionBoxArray:G,partiallyEvaluatedTextSize:ae,collisionGroup:se}=a.parameters,ve=A.get("text-optional"),_e=A.get("icon-optional"),xe=s.aC(A,"text-overlap","text-allow-overlap"),Ae=xe==="always",Oe=s.aC(A,"icon-overlap","icon-allow-overlap"),ke=Oe==="always",Be=A.get("text-rotation-alignment")==="map",je=A.get("text-pitch-alignment")==="map",Le=A.get("icon-text-fit")!=="none",nt=A.get("symbol-z-order")==="viewport-y",lt=Ae&&(ke||!b.hasIconData()||_e),At=ke&&(Ae||!b.hasTextData()||ve);!b.collisionArrays&&G&&b.deserializeCollisionBoxes(G);const St=this.retainedQueryData[b.bucketInstanceId].tileID,Tt=this._getTerrainElevationFunc(St),Wt=this.transform.getFastPathSimpleProjectionMatrix(St),Ht=(Rt,lr,Ir)=>{var Tr,In;if(h[Rt.crossTileID])return;if(X)return void(this.placements[Rt.crossTileID]=new Ta(!1,!1,!1));let en=!1,On=!1,un=!0,nn=null,Kr={box:null,placeable:!1,offscreen:null,occluded:!1},_i={placeable:!1},yi=null,Fi=null,pa=null,xs=0,No=0,co=0;lr.textFeatureIndex?xs=lr.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(xs=Rt.featureIndex),lr.verticalTextFeatureIndex&&(No=lr.verticalTextFeatureIndex);const Us=lr.textBox;if(Us){const as=yn=>{let vn=s.al.horizontal;if(b.allowVerticalPlacement&&!yn&&this.prevPlacement){const Jn=this.prevPlacement.placedOrientations[Rt.crossTileID];Jn&&(this.placedOrientations[Rt.crossTileID]=Jn,vn=Jn,this.markUsedOrientation(b,vn,Rt))}return vn},Bo=(yn,vn)=>{if(b.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&lr.verticalTextBox){for(const Jn of b.writingModes)if(Jn===s.al.vertical?(Kr=vn(),_i=Kr):Kr=yn(),Kr&&Kr.placeable)break}else Kr=yn()},ss=Rt.textAnchorOffsetStartIndex,Vs=Rt.textAnchorOffsetEndIndex;if(Vs===ss){const yn=(vn,Jn)=>{const hn=this.collisionIndex.placeCollisionBox(vn,xe,q,St,B,je,Be,C,se.predicate,Tt,void 0,Wt);return hn&&hn.placeable&&(this.markUsedOrientation(b,Jn,Rt),this.placedOrientations[Rt.crossTileID]=Jn),hn};Bo(()=>yn(Us,s.al.horizontal),()=>{const vn=lr.verticalTextBox;return b.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&vn?yn(vn,s.al.vertical):{box:null,offscreen:null}}),as(Kr&&Kr.placeable)}else{let yn=s.aB[(In=(Tr=this.prevPlacement)===null||Tr===void 0?void 0:Tr.variableOffsets[Rt.crossTileID])===null||In===void 0?void 0:In.anchor];const vn=(hn,ep,Ml)=>{const A_=hn.x2-hn.x1,vc=hn.y2-hn.y1,bc=Rt.textBoxScale,mh=Le&&Oe==="never"?ep:null;let ta=null,qs=xe==="never"?1:2,If="never";yn&&qs++;for(let tp=0;tp<qs;tp++){for(let uo=ss;uo<Vs;uo++){const Of=b.textAnchorOffsets.get(uo);if(yn&&Of.textAnchor!==yn)continue;const Ha=this.attemptAnchorPlacement(Of,hn,A_,vc,bc,Be,je,q,St,B,se,If,Rt,b,Ml,C,D,mh,Tt);if(Ha&&(ta=Ha.placedGlyphBoxes,ta&&ta.placeable))return en=!0,nn=Ha.shift,ta}yn?yn=null:If=xe}return _&&!ta&&(ta={box:this.collisionIndex.placeCollisionBox(Us,"always",q,St,B,je,Be,C,se.predicate,Tt,void 0,Wt).box,offscreen:!1,placeable:!1,occluded:!1}),ta};Bo(()=>vn(Us,lr.iconBox,s.al.horizontal),()=>{const hn=lr.verticalTextBox;return b.allowVerticalPlacement&&(!Kr||!Kr.placeable)&&Rt.numVerticalGlyphVertices>0&&hn?vn(hn,lr.verticalIconBox,s.al.vertical):{box:null,occluded:!0,offscreen:null}}),Kr&&(en=Kr.placeable,un=Kr.offscreen);const Jn=as(Kr&&Kr.placeable);if(!en&&this.prevPlacement){const hn=this.prevPlacement.variableOffsets[Rt.crossTileID];hn&&(this.variableOffsets[Rt.crossTileID]=hn,this.markUsedJustification(b,hn.anchor,Rt,Jn))}}}if(yi=Kr,en=yi&&yi.placeable,un=yi&&yi.offscreen,Rt.useRuntimeCollisionCircles){const as=b.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex),Bo=s.am(b.textSizeData,ae,as),ss=A.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(xe,as,b.lineVertexArray,b.glyphOffsetArray,Bo,B,j,_,je,se.predicate,Rt.collisionCircleDiameter,ss,C,Tt),Fi.circles.length&&Fi.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),en=Ae||Fi.circles.length>0&&!Fi.collisionDetected,un=un&&Fi.offscreen}if(lr.iconFeatureIndex&&(co=lr.iconFeatureIndex),lr.iconBox){const as=Bo=>this.collisionIndex.placeCollisionBox(Bo,Oe,q,St,B,je,Be,D,se.predicate,Tt,Le&&nn?nn:void 0,Wt);_i&&_i.placeable&&lr.verticalIconBox?(pa=as(lr.verticalIconBox),On=pa.placeable):(pa=as(lr.iconBox),On=pa.placeable),un=un&&pa.offscreen}const $s=ve||Rt.numHorizontalGlyphVertices===0&&Rt.numVerticalGlyphVertices===0,El=_e||Rt.numIconVertices===0;$s||El?El?$s||(On=On&&en):en=On&&en:On=en=On&&en;const yc=On&&pa.placeable;if(en&&yi.placeable&&this.collisionIndex.insertCollisionBox(yi.box,xe,A.get("text-ignore-placement"),b.bucketInstanceId,_i&&_i.placeable&&No?No:xs,se.ID),yc&&this.collisionIndex.insertCollisionBox(pa.box,Oe,A.get("icon-ignore-placement"),b.bucketInstanceId,co,se.ID),Fi&&en&&this.collisionIndex.insertCollisionCircles(Fi.circles,xe,A.get("text-ignore-placement"),b.bucketInstanceId,xs,se.ID),_&&this.storeCollisionData(b.bucketInstanceId,Ir,lr,yi,pa,Fi),Rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Rt.crossTileID]=new Ta((en||lt)&&!(yi!=null&&yi.occluded),(On||At)&&!(pa!=null&&pa.occluded),un||b.justReloaded),h[Rt.crossTileID]=!0};if(nt){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Rt=b.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let lr=Rt.length-1;lr>=0;--lr){const Ir=Rt[lr];Ht(b.symbolInstances.get(Ir),b.collisionArrays[Ir],Ir)}}else for(let Rt=a.symbolInstanceStart;Rt<a.symbolInstanceEnd;Rt++)Ht(b.symbolInstances.get(Rt),b.collisionArrays[Rt],Rt);b.justReloaded=!1}storeCollisionData(a,h,_,b,A,C){if(_.textBox||_.iconBox){let D,B;this.collisionBoxArrays.has(a)?D=this.collisionBoxArrays.get(a):(D=new Map,this.collisionBoxArrays.set(a,D)),D.has(h)?B=D.get(h):(B={text:null,icon:null},D.set(h,B)),_.textBox&&(B.text=b.box),_.iconBox&&(B.icon=A.box)}if(C){let D=this.collisionCircleArrays[a];D===void 0&&(D=this.collisionCircleArrays[a]=[]);for(let B=0;B<C.circles.length;B+=4)D.push(C.circles[B+0]-Ri),D.push(C.circles[B+1]-Ri),D.push(C.circles[B+2]),D.push(C.collisionDetected?1:0)}}markUsedJustification(a,h,_,b){let A;A=b===s.al.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.aD(h)];const C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const D of C)D>=0&&(a.text.placedSymbolArray.get(D).crossTileID=A>=0&&D!==A?0:_.crossTileID)}markUsedOrientation(a,h,_){const b=h===s.al.horizontal||h===s.al.horizontalOnly?h:0,A=h===s.al.vertical?h:0,C=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const D of C)a.text.placedSymbolArray.get(D).placedOrientation=b;_.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const b=h?h.symbolFadeChange(a):1,A=h?h.opacities:{},C=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const B in this.placements){const j=this.placements[B],q=A[B];q?(this.opacities[B]=new La(q,b,j.text,j.icon),_=_||j.text!==q.text.placed||j.icon!==q.icon.placed):(this.opacities[B]=new La(null,b,j.text,j.icon,j.skipFade),_=_||j.text||j.icon)}for(const B in A){const j=A[B];if(!this.opacities[B]){const q=new La(j,b,!1,!1);q.isHidden()||(this.opacities[B]=q,_=_||j.text.placed||j.icon.placed)}}for(const B in C)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=C[B]);for(const B in D)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=D[B]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:a)}updateLayerOpacities(a,h){const _={};for(const b of h){const A=b.getBucket(a);A&&b.latestFeatureIndex&&a.id===A.layerIds[0]&&this.updateBucketOpacities(A,b.tileID,_,b.collisionBoxArray)}}updateBucketOpacities(a,h,_,b){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const A=a.layers[0],C=A.layout,D=new La(null,0,!1,!1,!0),B=C.get("text-allow-overlap"),j=C.get("icon-allow-overlap"),q=A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=C.get("text-rotation-alignment")==="map",G=C.get("text-pitch-alignment")==="map",ae=C.get("icon-text-fit")!=="none",se=new La(null,0,B&&(j||!a.hasIconData()||C.get("icon-optional")),j&&(B||!a.hasTextData()||C.get("text-optional")),!0);!a.collisionArrays&&b&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(b);const ve=(xe,Ae,Oe)=>{for(let ke=0;ke<Ae/4;ke++)xe.opacityVertexArray.emplaceBack(Oe);xe.hasVisibleVertices=xe.hasVisibleVertices||Oe!==Kl},_e=this.collisionBoxArrays.get(a.bucketInstanceId);for(let xe=0;xe<a.symbolInstances.length;xe++){const Ae=a.symbolInstances.get(xe),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:ke,crossTileID:Be}=Ae;let je=this.opacities[Be];_[Be]?je=D:je||(je=se,this.opacities[Be]=je),_[Be]=!0;const Le=Ae.numIconVertices>0,nt=this.placedOrientations[Ae.crossTileID],lt=nt===s.al.vertical,At=nt===s.al.horizontal||nt===s.al.horizontalOnly;if(Oe>0||ke>0){const Tt=Xc(je.text);ve(a.text,Oe,lt?Kl:Tt),ve(a.text,ke,At?Kl:Tt);const Wt=je.text.isHidden();[Ae.rightJustifiedTextSymbolIndex,Ae.centerJustifiedTextSymbolIndex,Ae.leftJustifiedTextSymbolIndex].forEach(lr=>{lr>=0&&(a.text.placedSymbolArray.get(lr).hidden=Wt||lt?1:0)}),Ae.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(Ae.verticalPlacedTextSymbolIndex).hidden=Wt||At?1:0);const Ht=this.variableOffsets[Ae.crossTileID];Ht&&this.markUsedJustification(a,Ht.anchor,Ae,nt);const Rt=this.placedOrientations[Ae.crossTileID];Rt&&(this.markUsedJustification(a,"left",Ae,Rt),this.markUsedOrientation(a,Rt,Ae))}if(Le){const Tt=Xc(je.icon),Wt=!(ae&&Ae.verticalPlacedIconSymbolIndex&&lt);Ae.placedIconSymbolIndex>=0&&(ve(a.icon,Ae.numIconVertices,Wt?Tt:Kl),a.icon.placedSymbolArray.get(Ae.placedIconSymbolIndex).hidden=je.icon.isHidden()),Ae.verticalPlacedIconSymbolIndex>=0&&(ve(a.icon,Ae.numVerticalIconVertices,Wt?Kl:Tt),a.icon.placedSymbolArray.get(Ae.verticalPlacedIconSymbolIndex).hidden=je.icon.isHidden())}const St=_e&&_e.has(xe)?_e.get(xe):{text:null,icon:null};if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Tt=a.collisionArrays[xe];if(Tt){let Wt=new s.P(0,0);if(Tt.textBox||Tt.verticalTextBox){let Ht=!0;if(q){const Rt=this.variableOffsets[Be];Rt?(Wt=nl(Rt.anchor,Rt.width,Rt.height,Rt.textOffset,Rt.textBoxScale),X&&Wt._rotate(G?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ht=!1}if(Tt.textBox||Tt.verticalTextBox){let Rt;Tt.textBox&&(Rt=lt),Tt.verticalTextBox&&(Rt=At),zu(a.textCollisionBox.collisionVertexArray,je.text.placed,!Ht||Rt,St.text,Wt.x,Wt.y)}}if(Tt.iconBox||Tt.verticalIconBox){const Ht=!!(!At&&Tt.verticalIconBox);let Rt;Tt.iconBox&&(Rt=Ht),Tt.verticalIconBox&&(Rt=!Ht),zu(a.iconCollisionBox.collisionVertexArray,je.icon.placed,Rt,St.icon,ae?Wt.x:0,ae?Wt.y:0)}}}}if(a.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);a.bucketInstanceId in this.collisionCircleArrays&&(a.collisionCircleArray=this.collisionCircleArrays[a.bucketInstanceId],delete this.collisionCircleArrays[a.bucketInstanceId])}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function zu(T,a,h,_,b,A){_&&_.length!==0||(_=[0,0,0,0]);const C=_[0]-Ri,D=_[1]-Ri,B=_[2]-Ri,j=_[3]-Ri;T.emplaceBack(a?1:0,h?1:0,b||0,A||0,C,D),T.emplaceBack(a?1:0,h?1:0,b||0,A||0,B,D),T.emplaceBack(a?1:0,h?1:0,b||0,A||0,B,j),T.emplaceBack(a?1:0,h?1:0,b||0,A||0,C,j)}const x_=Math.pow(2,25),lm=Math.pow(2,24),gs=Math.pow(2,17),Ad=Math.pow(2,16),cm=Math.pow(2,9),Zc=Math.pow(2,8),tf=Math.pow(2,1);function Xc(T){if(T.opacity===0&&!T.placed)return 0;if(T.opacity===1&&T.placed)return 4294967295;const a=T.placed?1:0,h=Math.floor(127*T.opacity);return h*x_+a*lm+h*gs+a*Ad+h*cm+a*Zc+h*tf+a}const Kl=0;class Fa{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,h,_,b,A){const C=this._bucketParts;for(;this._currentTileIndex<a.length;)if(h.getBucketParts(C,b,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((D,B)=>D.sortKey-B.sortKey));this._currentPartIndex<C.length;)if(h.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,A())return!0;return!1}}class Gc{constructor(a,h,_,b,A,C,D,B){this.placement=new il(a,h,C,D,B),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(a,h,_){const b=I.now(),A=()=>!this._forceFullPlacement&&I.now()-b>2;for(;this._currentPlacementIndex>=0;){const C=h[a[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=D)&&(!C.maxzoom||C.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Fa(C)),this._inProgressLayer.continuePlacement(_[C.source],this.placement,this._showCollisionBoxes,C,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Ql=512/s.Z/2;class al{constructor(a,h,_){this.tileID=a,this.bucketInstanceId=_,this._symbolsByKey={};const b=new Map;for(let A=0;A<h.length;A++){const C=h.get(A),D=C.key,B=b.get(D);B?B.push(C):b.set(D,[C])}for(const[A,C]of b){const D={positions:C.map(B=>({x:Math.floor(B.anchorX*Ql),y:Math.floor(B.anchorY*Ql)})),crossTileIDs:C.map(B=>B.crossTileID)};if(D.positions.length>128){const B=new s.aF(D.positions.length,16,Uint16Array);for(const{x:j,y:q}of D.positions)B.add(j,q);B.finish(),delete D.positions,D.index=B}this._symbolsByKey[A]=D}}getScaledCoordinates(a,h){const{x:_,y:b,z:A}=this.tileID.canonical,{x:C,y:D,z:B}=h.canonical,j=Ql/Math.pow(2,B-A),q=(D*s.Z+a.anchorY)*j,X=b*s.Z*Ql;return{x:Math.floor((C*s.Z+a.anchorX)*j-_*s.Z*Ql),y:Math.floor(q-X)}}findMatches(a,h,_){const b=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let A=0;A<a.length;A++){const C=a.get(A);if(C.crossTileID)continue;const D=this._symbolsByKey[C.key];if(!D)continue;const B=this.getScaledCoordinates(C,h);if(D.index){const j=D.index.range(B.x-b,B.y-b,B.x+b,B.y+b).sort();for(const q of j){const X=D.crossTileIDs[q];if(!_[X]){_[X]=!0,C.crossTileID=X;break}}}else if(D.positions)for(let j=0;j<D.positions.length;j++){const q=D.positions[j],X=D.crossTileIDs[j];if(Math.abs(q.x-B.x)<=b&&Math.abs(q.y-B.y)<=b&&!_[X]){_[X]=!0,C.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:a})=>a)}}class Jl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class um{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const h=Math.round((a-this.lng)/360);if(h!==0)for(const _ in this.indexes){const b=this.indexes[_],A={};for(const C in b){const D=b[C];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),A[D.tileID.key]=D}this.indexes[_]=A}this.lng=a}addBucket(a,h,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let A=0;A<h.symbolInstances.length;A++)h.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const b=this.usedCrossTileIDs[a.overscaledZ];for(const A in this.indexes){const C=this.indexes[A];if(Number(A)>a.overscaledZ)for(const D in C){const B=C[D];B.tileID.isChildOf(a)&&B.findMatches(h.symbolInstances,a,b)}else{const D=C[a.scaledTo(Number(A)).key];D&&D.findMatches(h.symbolInstances,a,b)}}for(let A=0;A<h.symbolInstances.length;A++){const C=h.symbolInstances.get(A);C.crossTileID||(C.crossTileID=_.generate(),b[C.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new al(a,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(a,h){for(const _ of h.getCrossTileIDsLists())for(const b of _)delete this.usedCrossTileIDs[a][b]}removeStaleBuckets(a){let h=!1;for(const _ in this.indexes){const b=this.indexes[_];for(const A in b)a[b[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,b[A]),delete b[A],h=!0)}return h}}class Qs{constructor(){this.layerIndexes={},this.crossTileIDs=new Jl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,h,_){let b=this.layerIndexes[a.id];b===void 0&&(b=this.layerIndexes[a.id]=new um);let A=!1;const C={};b.handleWrapJump(_);for(const D of h){const B=D.getBucket(a);B&&a.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,B,this.crossTileIDs)&&(A=!0),C[B.bucketInstanceId]=!0)}return b.removeStaleBuckets(C)&&(A=!0),A}pruneUnusedLayers(a){const h={};a.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}var Os="void main() {fragColor=vec4(1.0);}";const kr={prelude:Ur(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ur("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ur("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ur(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ur(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ur(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ur(Os,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ur(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ur("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ur("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ur(Os,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ur(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ur(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ur(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ur(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ur(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ur(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ur(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ur(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ur(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ur(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ur(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ur(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ur(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ur(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ur(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ur(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ur("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ur("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ur("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ur("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ur(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ur("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ur(T,a){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/in ([\w]+) ([\w]+)/g),b=T.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=A?A.concat(b):b,D={};return{fragmentSource:T=T.replace(h,(B,j,q,X,G)=>(D[G]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${q} ${X} ${G};
#else
uniform ${q} ${X} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${q} ${X} ${G} = u_${G};
#endif
`)),vertexSource:a=a.replace(h,(B,j,q,X,G)=>{const ae=X==="float"?"vec2":"vec4",se=G.match(/color/)?"color":ae;return D[G]?j==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${q} ${ae} a_${G};
out ${q} ${X} ${G};
#else
uniform ${q} ${X} u_${G};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${q} ${X} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${se}(a_${G}, u_${G}_t);
#else
    ${q} ${X} ${G} = u_${G};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${q} ${ae} a_${G};
#else
uniform ${q} ${X} u_${G};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${q} ${X} ${G} = a_${G};
#else
    ${q} ${X} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${q} ${X} ${G} = unpack_mix_${se}(a_${G}, u_${G}_t);
#else
    ${q} ${X} ${G} = u_${G};
#endif
`}),staticAttributes:_,staticUniforms:C}}class ec{constructor(a,h,_){this.vertexBuffer=a,this.indexBuffer=h,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _s=s.aG([{name:"a_pos",type:"Int16",components:2}]);const za="#define PROJECTION_MERCATOR",sa="mercator";class Mn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return sa}get shaderDefine(){return za}get shaderPreludeCode(){return kr.projectionMercator}get vertexShaderPreludeCode(){return kr.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aH.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(a){}getMeshFromTileID(a,h,_,b,A){if(this._cachedMesh)return this._cachedMesh;const C=new s.aI;C.emplaceBack(0,0),C.emplaceBack(s.Z,0),C.emplaceBack(0,s.Z),C.emplaceBack(s.Z,s.Z);const D=a.createVertexBuffer(C,_s.members),B=s.aJ.simpleSegment(0,0,4,2),j=new s.aK;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3);const q=a.createIndexBuffer(j);return this._cachedMesh=new ec(D,q,B),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(a){}}class tc{constructor(a=0,h=0,_=0,b=0){if(isNaN(a)||a<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=h,this.left=_,this.right=b}interpolate(a,h,_){return h.top!=null&&a.top!=null&&(this.top=s.B.number(a.top,h.top,_)),h.bottom!=null&&a.bottom!=null&&(this.bottom=s.B.number(a.bottom,h.bottom,_)),h.left!=null&&a.left!=null&&(this.left=s.B.number(a.left,h.left,_)),h.right!=null&&a.right!=null&&(this.right=s.B.number(a.right,h.right,_)),this}getCenter(a,h){const _=s.ae((this.left+a-this.right)/2,0,a),b=s.ae((this.top+h-this.bottom)/2,0,h);return new s.P(_,b)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new tc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ii(T,a){if(!T.renderWorldCopies||T.lngRange)return;const h=a.lng-T.center.lng;a.lng+=h>180?-360:h<-180?360:0}function Bi(T){return Math.max(0,Math.floor(T))}class gi{constructor(a,h,_,b,A,C){this._callbacks=a,this._tileSize=512,this._renderWorldCopies=C===void 0||!!C,this._minZoom=h||0,this._maxZoom=_||22,this._minPitch=b??0,this._maxPitch=A??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Bi(this._zoom),this._scale=s.ac(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new tc,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(a,h,_){this._latRange=a.latRange,this._lngRange=a.lngRange,this._width=a.width,this._height=a.height,this._center=a.center,this._elevation=a.elevation,this._minElevationForCurrentTile=a.minElevationForCurrentTile,this._zoom=a.zoom,this._tileZoom=Bi(this._zoom),this._scale=s.ac(this._zoom),this._bearingInRadians=a.bearingInRadians,this._fovInRadians=a.fovInRadians,this._pitchInRadians=a.pitchInRadians,this._rollInRadians=a.rollInRadians,this._unmodified=a.unmodified,this._edgeInsets=new tc(a.padding.top,a.padding.bottom,a.padding.left,a.padding.right),this._minZoom=a.minZoom,this._maxZoom=a.maxZoom,this._minPitch=a.minPitch,this._maxPitch=a.maxPitch,this._renderWorldCopies=a.renderWorldCopies,this._cameraToCenterDistance=a.cameraToCenterDistance,this._nearZ=a.nearZ,this._farZ=a.farZ,this._autoCalculateNearFarZ=!_&&a.autoCalculateNearFarZ,h&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(a){this._minElevationForCurrentTile=a}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(a){this._minZoom!==a&&(this._minZoom=a,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(a){this._minPitch!==a&&(this._minPitch=a,this.setPitch(Math.max(this.pitch,a)))}get maxPitch(){return this._maxPitch}setMaxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.setPitch(Math.min(this.pitch,a)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(a){const h=s.aL(a,-180,180)*Math.PI/180;var _,b,A,C,D,B,j,q,X;this._bearingInRadians!==h&&(this._unmodified=!1,this._bearingInRadians=h,this._calcMatrices(),this._rotationMatrix=v(),_=this._rotationMatrix,A=-this._bearingInRadians,C=(b=this._rotationMatrix)[0],D=b[1],B=b[2],j=b[3],q=Math.sin(A),X=Math.cos(A),_[0]=C*X+B*q,_[1]=D*X+j*q,_[2]=C*-q+B*X,_[3]=D*-q+j*X)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(a){const h=s.ae(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==h&&(this._unmodified=!1,this._pitchInRadians=h,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(a){const h=a/180*Math.PI;this._rollInRadians!==h&&(this._unmodified=!1,this._rollInRadians=h,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aM(this._fovInRadians)}setFov(a){a=s.ae(a,.1,150),this.fov!==a&&(this._unmodified=!1,this._fovInRadians=s.ab(a),this._calcMatrices())}get zoom(){return this._zoom}setZoom(a){const h=this.getConstrained(this._center,a).zoom;this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this._tileZoom=Math.max(0,Math.floor(h)),this._scale=s.ac(h),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(a,h){this._autoCalculateNearFarZ=!1,this._nearZ=a,this._farZ=h,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,h,_){this._unmodified=!1,this._edgeInsets.interpolate(a,h,_),this._constrain(),this._calcMatrices()}resize(a,h,_=!0){this._width=a,this._height=h,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Vt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(a){a?(this._lngRange=[a.getWest(),a.getEast()],this._latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,s.af])}getConstrained(a,h){return this._callbacks.getConstrained(a,h)}getCameraQueryGeometry(a,h){if(h.length===1)return[h[0],a];{let _=a.x,b=a.y,A=a.x,C=a.y;for(const D of h)_=Math.min(_,D.x),b=Math.min(b,D.y),A=Math.max(A,D.x),C=Math.max(C,D.y);return[new s.P(_,b),new s.P(A,b),new s.P(A,C),new s.P(_,C),new s.P(_,b)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const a=this._unmodified,{center:h,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(h),this.setZoom(_),this._unmodified=a,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let a=s.ad(new Float64Array(16));s.M(a,a,[this._width/2,-this._height/2,1]),s.L(a,a,[1,-1,0]),this._clipSpaceToPixelsMatrix=a,a=s.ad(new Float64Array(16)),s.M(a,a,[1,-1,1]),s.L(a,a,[-1,-1,0]),s.M(a,a,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=a,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(a,h,_,b){const A=_!==void 0?_:this.bearing,C=b=b!==void 0?b:this.pitch,D=s.$.fromLngLat(a,h),B=-Math.cos(s.ab(C)),j=Math.sin(s.ab(C)),q=j*Math.sin(s.ab(A)),X=-j*Math.cos(s.ab(A));let G=this.elevation;const ae=h-G;let se;B*ae>=0||Math.abs(B)<.1?(se=1e4,G=h+se*B):se=-ae/B;let ve,_e,xe=s.aN(1,D.y),Ae=0;do{if(Ae+=1,Ae>10)break;_e=se/xe,ve=new s.$(D.x+q*_e,D.y+X*_e),xe=1/ve.meterInMercatorCoordinateUnits()}while(Math.abs(se-_e*xe)>1e-12);return{center:ve.toLngLat(),elevation:G,zoom:s.ah(this.height/2/Math.tan(this.fovInRadians/2)/_e/this.tileSize)}}recalculateZoomAndCenter(a){if(this.elevation-a==0)return;const h=s.ag(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/h,b=s.$.fromLngLat(this.center,this.elevation),A=ce(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=a;const C=this.calculateCenterFromCameraLngLatAlt(A.toLngLat(),s.aN(A.z,b.y),this.bearing,this.pitch);this._elevation=C.elevation,this._center=C.center,this.setZoom(C.zoom)}getCameraPoint(){const a=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(a*Math.sin(this.rollInRadians),a*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const a=s.ag(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/a).toLngLat()}getMercatorTileCoordinates(a){if(!a)return[0,0,1,1];const h=a.canonical.z>=0?1<<a.canonical.z:Math.pow(2,a.canonical.z);return[a.canonical.x/h,a.canonical.y/h,1/h/s.Z,1/h/s.Z]}}class bo{constructor(a,h){this.min=a,this.max=h,this.center=s.aO([],s.aP([],this.min,this.max),.5)}quadrant(a){const h=[a%2==0,a<2],_=s.aQ(this.min),b=s.aQ(this.max);for(let A=0;A<h.length;A++)_[A]=h[A]?this.min[A]:this.center[A],b[A]=h[A]?this.center[A]:this.max[A];return b[2]=this.max[2],new bo(_,b)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersectsFrustum(a){let h=!0;for(let _=0;_<a.planes.length;_++){const b=this.intersectsPlane(a.planes[_]);if(b===0)return 0;b===1&&(h=!1)}return h?2:a.aabb.min[0]>this.max[0]||a.aabb.min[1]>this.max[1]||a.aabb.min[2]>this.max[2]||a.aabb.max[0]<this.min[0]||a.aabb.max[1]<this.min[1]||a.aabb.max[2]<this.min[2]?0:1}intersectsPlane(a){let h=a[3],_=a[3];for(let b=0;b<3;b++)a[b]>0?(h+=a[b]*this.min[b],_+=a[b]*this.max[b]):(_+=a[b]*this.min[b],h+=a[b]*this.max[b]);return h>=0?2:_<0?0:1}}class rc{distanceToTile2d(a,h,_,b){const A=b.distanceX([a,h]),C=b.distanceY([a,h]);return Math.hypot(A,C)}getWrap(a,h,_){return _}getTileAABB(a,h,_,b){var A,C;let D=_,B=_;if(b.terrain){const q=new s.Y(a.z,h,a.z,a.x,a.y),X=b.terrain.getMinMaxElevation(q);D=(A=X.minElevation)!==null&&A!==void 0?A:_,B=(C=X.maxElevation)!==null&&C!==void 0?C:_}const j=1<<a.z;return new bo([h+a.x/j,a.y/j,D],[h+(a.x+1)/j,(a.y+1)/j,B])}allowVariableZoom(a,h){const _=a.fov*(Math.abs(Math.cos(a.rollInRadians))*a.height+Math.abs(Math.sin(a.rollInRadians))*a.width)/a.height,b=s.ae(78.5-_/2,0,60);return!!h.terrain||a.pitch>b}allowWorldCopies(){return!0}recalculateCache(){}}class jn{constructor(a,h,_){this.points=a,this.planes=h,this.aabb=_}static fromInvProjectionMatrix(a,h=1,_=0){const b=Math.pow(2,_),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(j=>{const q=1/(j=s.at([],j,a))[3]/h*b;return s.aR(j,j,[q,q,1/j[3],q])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(j=>{const q=s.aS([],A[j[0]],A[j[1]]),X=s.aS([],A[j[2]],A[j[1]]),G=s.aT([],s.aU([],q,X)),ae=-s.aV(G,A[j[1]]);return G.concat(ae)}),D=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],B=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const j of A)for(let q=0;q<3;q++)D[q]=Math.min(D[q],j[q]),B[q]=Math.max(B[q],j[q]);return new jn(A,C,new bo(D,B))}}class ja{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(a){this._helper.setMinZoom(a)}setMaxZoom(a){this._helper.setMaxZoom(a)}setMinPitch(a){this._helper.setMinPitch(a)}setMaxPitch(a){this._helper.setMaxPitch(a)}setRenderWorldCopies(a){this._helper.setRenderWorldCopies(a)}setBearing(a){this._helper.setBearing(a)}setPitch(a){this._helper.setPitch(a)}setRoll(a){this._helper.setRoll(a)}setFov(a){this._helper.setFov(a)}setZoom(a){this._helper.setZoom(a)}setCenter(a){this._helper.setCenter(a)}setElevation(a){this._helper.setElevation(a)}setMinElevationForCurrentTile(a){this._helper.setMinElevationForCurrentTile(a)}setPadding(a){this._helper.setPadding(a)}interpolatePadding(a,h,_){return this._helper.interpolatePadding(a,h,_)}isPaddingEqual(a){return this._helper.isPaddingEqual(a)}resize(a,h,_=!0){this._helper.resize(a,h,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(a){this._helper.setMaxBounds(a)}overrideNearFarZ(a,h){this._helper.overrideNearFarZ(a,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(a){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),a)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(a,h){}constructor(a,h,_,b,A){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new gi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(C,D)=>this.getConstrained(C,D)},a,h,_,b,A),this._coveringTilesDetailsProvider=new rc}clone(){const a=new ja;return a.apply(this),a}apply(a,h,_){this._helper.apply(a,h,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(a){const h=[new s.aW(0,a)];if(this._helper._renderWorldCopies){const _=this.screenPointToMercatorCoordinate(new s.P(0,0)),b=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),A=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),C=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),D=Math.floor(Math.min(_.x,b.x,A.x,C.x)),B=Math.floor(Math.max(_.x,b.x,A.x,C.x)),j=1;for(let q=D-j;q<=B+j;q++)q!==0&&h.push(new s.aW(q,a))}return h}getCameraFrustum(){return jn.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(a){const h=this.screenPointToLocation(this.centerPoint,a),_=a?a.getElevationForLngLatZoom(h,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(a,h){const _=s.ag(this.elevation,this.center.lat),b=this.screenPointToMercatorCoordinateAtZ(h,_),A=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),C=s.$.fromLngLat(a),D=new s.$(C.x-(b.x-A.x),C.y-(b.y-A.y));this.setCenter(D==null?void 0:D.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(a,h){return h?this.coordinatePoint(s.$.fromLngLat(a),h.getElevationForLngLatZoom(a,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.$.fromLngLat(a))}screenPointToLocation(a,h){var _;return(_=this.screenPointToMercatorCoordinate(a,h))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(a,h){if(h){const _=h.pointCoordinate(a);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(a)}screenPointToMercatorCoordinateAtZ(a,h){const _=h||0,b=[a.x,a.y,0,1],A=[a.x,a.y,1,1];s.at(b,b,this._pixelMatrixInverse),s.at(A,A,this._pixelMatrixInverse);const C=b[3],D=A[3],B=b[1]/C,j=A[1]/D,q=b[2]/C,X=A[2]/D,G=q===X?0:(_-q)/(X-q);return new s.$(s.B.number(b[0]/C,A[0]/D,G)/this.worldSize,s.B.number(B,j,G)/this.worldSize,_)}coordinatePoint(a,h=0,_=this._pixelMatrix){const b=[a.x*this.worldSize,a.y*this.worldSize,h,1];return s.at(b,b,_),new s.P(b[0]/b[3],b[1]/b[3])}getBounds(){const a=Math.max(0,this._helper._height/2-Ve(this));return new Vt().extend(this.screenPointToLocation(new s.P(0,a))).extend(this.screenPointToLocation(new s.P(this._helper._width,a))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(a,h){return h?h.pointCoordinate(a)!=null:a.y>this.height/2-Ve(this)}calculatePosMatrix(a,h=!1,_){var b;const A=(b=a.key)!==null&&b!==void 0?b:s.aX(a.wrap,a.canonical.z,a.canonical.z,a.canonical.x,a.canonical.y),C=h?this._alignedPosMatrixCache:this._posMatrixCache;if(C.has(A)){const j=C.get(A);return _?j.f32:j.f64}const D=le(a,this.worldSize);s.N(D,h?this._alignedProjMatrix:this._viewProjMatrix,D);const B={f64:D,f32:new Float32Array(D)};return C.set(A,B),_?B.f32:B.f64}calculateFogMatrix(a){const h=a.key,_=this._fogMatrixCacheF32;if(_.has(h))return _.get(h);const b=le(a,this.worldSize);return s.N(b,this._fogMatrix,b),_.set(h,new Float32Array(b)),_.get(h)}getConstrained(a,h){h=s.ae(+h,this.minZoom,this.maxZoom);const _={center:new s.Q(a.lng,a.lat),zoom:h};let b=this._helper._lngRange;this._helper._renderWorldCopies||b!==null||(b=[-179.9999999999,180-1e-10]);const A=this.tileSize*s.ac(_.zoom);let C=0,D=A,B=0,j=A,q=0,X=0;const{x:G,y:ae}=this.size;if(this._helper._latRange){const Oe=this._helper._latRange;C=s.S(Oe[1])*A,D=s.S(Oe[0])*A,D-C<ae&&(q=ae/(D-C))}b&&(B=s.aL(s.U(b[0])*A,0,A),j=s.aL(s.U(b[1])*A,0,A),j<B&&(j+=A),j-B<G&&(X=G/(j-B)));const{x:se,y:ve}=Gi(A,a);let _e,xe;const Ae=Math.max(X||0,q||0);if(Ae){const Oe=new s.P(X?(j+B)/2:se,q?(D+C)/2:ve);return _.center=ms(A,Oe).wrap(),_.zoom+=s.ah(Ae),_}if(this._helper._latRange){const Oe=ae/2;ve-Oe<C&&(xe=C+Oe),ve+Oe>D&&(xe=D-Oe)}if(b){const Oe=(B+j)/2;let ke=se;this._helper._renderWorldCopies&&(ke=s.aL(se,Oe-A/2,Oe+A/2));const Be=G/2;ke-Be<B&&(_e=B+Be),ke+Be>j&&(_e=j-Be)}if(_e!==void 0||xe!==void 0){const Oe=new s.P(_e??se,xe??ve);_.center=ms(A,Oe).wrap()}return _}calculateCenterFromCameraLngLatAlt(a,h,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(a,h,_,b)}_calculateNearFarZIfNeeded(a,h,_){if(!this._helper.autoCalculateNearFarZ)return;const b=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),A=a-b*this._helper._pixelPerMeter/Math.cos(h),C=b<0?A:a,D=Math.PI/2+this.pitchInRadians,B=s.ab(this.fov)*(Math.abs(Math.cos(s.ab(this.roll)))*this.height+Math.abs(Math.sin(s.ab(this.roll)))*this.width)/this.height*(.5+_.y/this.height),j=Math.sin(B)*C/Math.sin(s.ae(Math.PI-D-B,.01,Math.PI-.01)),q=Ve(this),X=Math.atan(q/this._helper.cameraToCenterDistance),G=s.ab(.75),ae=X>G?2*X*(.5+_.y/(2*q)):G,se=Math.sin(ae)*C/Math.sin(s.ae(Math.PI-D-ae,.01,Math.PI-.01)),ve=Math.min(j,se);this._helper._farZ=1.01*(Math.cos(Math.PI/2-h)*ve+C),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const a=this.centerOffset,h=Gi(this.worldSize,this.center),_=h.x,b=h.y;this._helper._pixelPerMeter=s.ag(1,this.center.lat)*this.worldSize;const A=s.ab(Math.min(this.pitch,Ks)),C=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(A));let D;this._calculateNearFarZIfNeeded(C,A,a),D=new Float64Array(16),s.aY(D,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.an(this._invProjMatrix,D),D[8]=2*-a.x/this._helper._width,D[9]=2*a.y/this._helper._height,this._projectionMatrix=s.aZ(D),s.M(D,D,[1,-1,1]),s.L(D,D,[0,0,-this._helper.cameraToCenterDistance]),s.a_(D,D,-this.rollInRadians),s.a$(D,D,this.pitchInRadians),s.a_(D,D,-this.bearingInRadians),s.L(D,D,[-_,-b,0]),this._mercatorMatrix=s.M([],D,[this.worldSize,this.worldSize,this.worldSize]),s.M(D,D,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,D),s.L(D,D,[0,0,-this.elevation]),this._viewProjMatrix=D,this._invViewProjMatrix=s.an([],D);const B=[0,0,-1,1];s.at(B,B,this._invViewProjMatrix),this._cameraPosition=[B[0]/B[3],B[1]/B[3],B[2]/B[3]],this._fogMatrix=new Float64Array(16),s.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,C,this._helper._farZ),this._fogMatrix[8]=2*-a.x/this.width,this._fogMatrix[9]=2*a.y/this.height,s.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.L(this._fogMatrix,this._fogMatrix,[-_,-b,0]),s.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,D);const j=this._helper._width%2/2,q=this._helper._height%2/2,X=Math.cos(this.bearingInRadians),G=Math.sin(-this.bearingInRadians),ae=_-Math.round(_)+X*j+G*q,se=b-Math.round(b)+X*q+G*j,ve=new Float64Array(D);if(s.L(ve,ve,[ae>.5?ae-1:ae,se>.5?se-1:se,0]),this._alignedProjMatrix=ve,D=s.an(new Float64Array(16),this._pixelMatrix),!D)throw new Error("failed to invert matrix");this._pixelMatrixInverse=D,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const a=this.screenPointToMercatorCoordinate(new s.P(0,0)),h=[a.x*this.worldSize,a.y*this.worldSize,0,1];return s.at(h,h,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const a=s.ag(1,this.center.lat)*this.worldSize;return ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/a).toLngLat()}lngLatToCameraDepth(a,h){const _=s.$.fromLngLat(a),b=[_.x*this.worldSize,_.y*this.worldSize,h,1];return s.at(b,b,this._viewProjMatrix),b[2]/b[3]}getProjectionData(a){const{overscaledTileID:h,aligned:_,applyTerrainMatrix:b}=a,A=this._helper.getMercatorTileCoordinates(h),C=h?this.calculatePosMatrix(h,_,!0):null;let D;return D=h&&h.terrainRttPosMatrix32f&&b?h.terrainRttPosMatrix32f:C||s.b0(),{mainMatrix:D,tileMercatorCoords:A,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:D}}isLocationOccluded(a){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(a,h,_){return 1}transformLightDirection(a){return s.aQ(a)}getRayDirectionFromPixel(a){throw new Error("Not implemented.")}projectTileCoordinates(a,h,_,b){const A=this.calculatePosMatrix(_);let C;b?(C=[a,h,b(a,h),1],s.at(C,C,A)):(C=[a,h,0,1],gn(C,C,A));const D=C[3];return{point:new s.P(C[0]/D,C[1]/D),signedDistanceFromCamera:D,isOccluded:!1}}populateCache(a){for(const h of a)this.calculatePosMatrix(h)}getMatrixForModel(a,h){const _=s.$.fromLngLat(a,h),b=_.meterInMercatorCoordinateUnits(),A=s.b1();return s.L(A,A,[_.x,_.y,_.z]),s.a_(A,A,Math.PI),s.a$(A,A,Math.PI/2),s.M(A,A,[-b,b,b]),A}getProjectionDataForCustomLayer(a=!0){const h=new s.Y(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:h,applyGlobeMatrix:a}),b=le(h,this.worldSize);s.N(b,this._viewProjMatrix,b),_.tileMercatorCoords=[0,0,1,1];const A=[s.Z,s.Z,this.worldSize/this._helper.pixelsPerMeter],C=s.b2();return s.M(C,b,A),_.fallbackMatrix=C,_.mainMatrix=C,_}getFastPathSimpleProjectionMatrix(a){return this.calculatePosMatrix(a)}}function oa(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function nc(T){if(T.useSlerp)if(T.k<1){const a=s.b3(T.startEulerAngles.roll,T.startEulerAngles.pitch,T.startEulerAngles.bearing),h=s.b3(T.endEulerAngles.roll,T.endEulerAngles.pitch,T.endEulerAngles.bearing),_=new Float64Array(4);s.b4(_,a,h,T.k);const b=s.b5(_);T.tr.setRoll(b.roll),T.tr.setPitch(b.pitch),T.tr.setBearing(b.bearing)}else T.tr.setRoll(T.endEulerAngles.roll),T.tr.setPitch(T.endEulerAngles.pitch),T.tr.setBearing(T.endEulerAngles.bearing);else T.tr.setRoll(s.B.number(T.startEulerAngles.roll,T.endEulerAngles.roll,T.k)),T.tr.setPitch(s.B.number(T.startEulerAngles.pitch,T.endEulerAngles.pitch,T.k)),T.tr.setBearing(s.B.number(T.startEulerAngles.bearing,T.endEulerAngles.bearing,T.k))}function la(T,a,h,_,b){const A=b.padding,C=Gi(b.worldSize,h.getNorthWest()),D=Gi(b.worldSize,h.getNorthEast()),B=Gi(b.worldSize,h.getSouthEast()),j=Gi(b.worldSize,h.getSouthWest()),q=s.ab(-_),X=C.rotate(q),G=D.rotate(q),ae=B.rotate(q),se=j.rotate(q),ve=new s.P(Math.max(X.x,G.x,se.x,ae.x),Math.max(X.y,G.y,se.y,ae.y)),_e=new s.P(Math.min(X.x,G.x,se.x,ae.x),Math.min(X.y,G.y,se.y,ae.y)),xe=ve.sub(_e),Ae=(b.width-(A.left+A.right+a.left+a.right))/xe.x,Oe=(b.height-(A.top+A.bottom+a.top+a.bottom))/xe.y;if(Oe<0||Ae<0)return void oa();const ke=Math.min(s.ah(b.scale*Math.min(Ae,Oe)),T.maxZoom),Be=s.P.convert(T.offset),je=new s.P((a.left-a.right)/2,(a.top-a.bottom)/2).rotate(s.ab(_)),Le=Be.add(je).mult(b.scale/s.ac(ke));return{center:ms(b.worldSize,C.add(B).div(2).sub(Le)),zoom:ke,bearing:_}}class ys{get useGlobeControls(){return!1}handlePanInertia(a,h){return{easingOffset:a,easingCenter:h.center}}handleMapControlsRollPitchBearingZoom(a,h){a.bearingDelta&&h.setBearing(h.bearing+a.bearingDelta),a.pitchDelta&&h.setPitch(h.pitch+a.pitchDelta),a.rollDelta&&h.setRoll(h.roll+a.rollDelta),a.zoomDelta&&h.setZoom(h.zoom+a.zoomDelta)}handleMapControlsPan(a,h,_){a.around.distSqr(h.centerPoint)<.01||h.setLocationAtPoint(_,a.around)}cameraForBoxAndBearing(a,h,_,b,A){return la(a,h,_,b,A)}handleJumpToCenterZoom(a,h){a.zoom!==(h.zoom!==void 0?+h.zoom:a.zoom)&&a.setZoom(+h.zoom),h.center!==void 0&&a.setCenter(s.Q.convert(h.center))}handleEaseTo(a,h){const _=a.zoom,b=a.padding,A={roll:a.roll,pitch:a.pitch,bearing:a.bearing},C={roll:h.roll===void 0?a.roll:h.roll,pitch:h.pitch===void 0?a.pitch:h.pitch,bearing:h.bearing===void 0?a.bearing:h.bearing},D=h.zoom!==void 0,B=!a.isPaddingEqual(h.padding);let j=!1;const q=D?+h.zoom:a.zoom;let X=a.centerPoint.add(h.offsetAsPoint);const G=a.screenPointToLocation(X),{center:ae,zoom:se}=a.getConstrained(s.Q.convert(h.center||G),q??_);Ii(a,ae);const ve=Gi(a.worldSize,G),_e=Gi(a.worldSize,ae).sub(ve),xe=s.ac(se-_);return j=se!==_,{easeFunc:Ae=>{if(j&&a.setZoom(s.B.number(_,se,Ae)),s.b6(A,C)||nc({startEulerAngles:A,endEulerAngles:C,tr:a,k:Ae,useSlerp:A.roll!=C.roll}),B&&(a.interpolatePadding(b,h.padding,Ae),X=a.centerPoint.add(h.offsetAsPoint)),h.around)a.setLocationAtPoint(h.around,h.aroundPoint);else{const Oe=s.ac(a.zoom-_),ke=se>_?Math.min(2,xe):Math.max(.5,xe),Be=Math.pow(ke,1-Ae),je=ms(a.worldSize,ve.add(_e.mult(Ae*Be)).mult(Oe));a.setLocationAtPoint(a.renderWorldCopies?je.wrap():je,X)}},isZooming:j,elevationCenter:ae}}handleFlyTo(a,h){const _=h.zoom!==void 0,b=a.zoom,A=a.getConstrained(s.Q.convert(h.center||h.locationAtOffset),_?+h.zoom:b),C=A.center,D=A.zoom;Ii(a,C);const B=Gi(a.worldSize,h.locationAtOffset),j=Gi(a.worldSize,C).sub(B),q=j.mag(),X=s.ac(D-b);let G;if(h.minZoom!==void 0){const ae=Math.min(+h.minZoom,b,D),se=a.getConstrained(C,ae).zoom;G=s.ac(se-b)}return{easeFunc:(ae,se,ve,_e)=>{a.setZoom(ae===1?D:b+s.ah(se));const xe=ae===1?C:ms(a.worldSize,B.add(j.mult(ve)).mult(se));a.setLocationAtPoint(a.renderWorldCopies?xe.wrap():xe,_e)},scaleOfZoom:X,targetCenter:C,scaleOfMinZoom:G,pixelPathLength:q}}}class Gr{constructor(a,h,_){this.blendFunction=a,this.blendColor=h,this.mask=_}}Gr.Replace=[1,0],Gr.disabled=new Gr(Gr.Replace,s.b7.transparent,[!1,!1,!1,!1]),Gr.unblended=new Gr(Gr.Replace,s.b7.transparent,[!0,!0,!0,!0]),Gr.alphaBlended=new Gr([1,771],s.b7.transparent,[!0,!0,!0,!0]);const Yc=2305;class Hr{constructor(a,h,_){this.enable=a,this.mode=h,this.frontFace=_}}Hr.disabled=new Hr(!1,1029,Yc),Hr.backCCW=new Hr(!0,1029,Yc),Hr.frontCCW=new Hr(!0,1028,Yc);class Ar{constructor(a,h,_){this.func=a,this.mask=h,this.range=_}}Ar.ReadOnly=!1,Ar.ReadWrite=!0,Ar.disabled=new Ar(519,Ar.ReadOnly,[0,1]);const xo=7680;class $r{constructor(a,h,_,b,A,C){this.test=a,this.ref=h,this.mask=_,this.fail=b,this.depthFail=A,this.pass=C}}$r.disabled=new $r({func:519,mask:0},0,0,xo,xo,xo);const Li=new WeakMap;function Yi(T){var a;if(Li.has(T))return Li.get(T);{const h=(a=T.getParameter(T.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return Li.set(T,h),h}}class wo{get awaitingQuery(){return!!this._readbackQueue}constructor(a){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=a;const h=a.context,_=h.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;const b=new s.aI;b.emplaceBack(-1,-1),b.emplaceBack(2,-1),b.emplaceBack(-1,2);const A=new s.aK;A.emplaceBack(0,1,2),this._fullscreenTriangle=new ec(h.createVertexBuffer(b,_s.members),h.createIndexBuffer(A),s.aJ.simpleSegment(0,0,b.length,A.length)),this._resultBuffer=new Uint8Array(4),h.activeTexture.set(_.TEXTURE1);const C=_.createTexture();_.bindTexture(_.TEXTURE_2D,C),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=h.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(C),Yi(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){const a=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),a.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(a,h){const _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(a,h),this._updateCount++,this._measuredError}_bindFramebuffer(){const a=this._cachedRenderContext.context,h=a.gl;a.activeTexture.set(h.TEXTURE1),h.bindTexture(h.TEXTURE_2D,this._fbo.colorAttachment.get()),a.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(a,h){const _=this._cachedRenderContext.context,b=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:s.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,b.TRIANGLES,Ar.disabled,$r.disabled,Gr.unblended,Hr.disabled,((A,C)=>({u_input:A,u_output_expected:C}))(a,h),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Yi(b)){b.bindBuffer(b.PIXEL_PACK_BUFFER,this._pbo),b.readBuffer(b.COLOR_ATTACHMENT0),b.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),b.bindBuffer(b.PIXEL_PACK_BUFFER,null);const A=b.fenceSync(b.SYNC_GPU_COMMANDS_COMPLETE,0);b.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:A}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const a=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Yi(a)){const h=a.clientWaitSync(this._readbackQueue.sync,0,0);if(h===a.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(h===a.TIMEOUT_EXPIRED)return;a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),a.bindBuffer(a.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),a.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=wo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(a){let h=0;return h+=a[0]/256,h+=a[1]/65536,h+=a[2]/16777216,a[3]<127&&(h=-h),h/128}}const sl=s.Z/128;function rf(T,a){const h=T.granularity!==void 0?Math.max(T.granularity,1):1,_=h+(T.generateBorders?2:0),b=h+(T.extendToNorthPole||T.generateBorders?1:0)+(T.extendToSouthPole||T.generateBorders?1:0),A=_+1,C=b+1,D=T.generateBorders?-1:0,B=T.generateBorders||T.extendToNorthPole?-1:0,j=h+(T.generateBorders?1:0),q=h+(T.generateBorders||T.extendToSouthPole?1:0),X=A*C,G=_*b*6,ae=A*C>65536;if(ae&&a==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const se=ae||a==="32bit",ve=new Int16Array(2*X);let _e=0;for(let Oe=B;Oe<=q;Oe++)for(let ke=D;ke<=j;ke++){let Be=ke/h*s.Z;ke===-1&&(Be=-64),ke===h+1&&(Be=s.Z+sl);let je=Oe/h*s.Z;Oe===-1&&(je=T.extendToNorthPole?s.b9:-64),Oe===h+1&&(je=T.extendToSouthPole?s.ba:s.Z+sl),ve[_e++]=Be,ve[_e++]=je}const xe=se?new Uint32Array(G):new Uint16Array(G);let Ae=0;for(let Oe=0;Oe<b;Oe++)for(let ke=0;ke<_;ke++){const Be=ke+1+Oe*A,je=ke+(Oe+1)*A,Le=ke+1+(Oe+1)*A;xe[Ae++]=ke+Oe*A,xe[Ae++]=je,xe[Ae++]=Be,xe[Ae++]=Be,xe[Ae++]=je,xe[Ae++]=Le}return{vertices:ve.buffer.slice(0),indices:xe.buffer.slice(0),uses32bitIndices:se}}const ol=new s.aH({fill:new s.bb(128,2),line:new s.bb(512,0),tile:new s.bb(128,32),stencil:new s.bb(128,1),circle:3});class ic{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return kr.projectionGlobe}get vertexShaderPreludeCode(){return kr.projectionMercator.vertexSource}get subdivisionGranularity(){return ol}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(a){this._errorMeasurement||(this._errorMeasurement=new wo(a));const h=s.S(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-h*Math.PI*2))-.5*Math.PI,b=this._errorMeasurement.updateErrorLoop(h,_),A=I.now();b!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=b,this._errorMeasurementLastChangeTime=A);const C=Math.min(Math.max((A-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bd(C))}_getMeshKey(a){return`${a.granularity.toString(36)}_${a.generateBorders?"b":""}${a.extendToNorthPole?"n":""}${a.extendToSouthPole?"s":""}`}getMeshFromTileID(a,h,_,b,A){const C=(A==="stencil"?ol.stencil:ol.tile).getGranularityForZoomLevel(h.z);return this._getMesh(a,{granularity:C,generateBorders:_,extendToNorthPole:h.y===0&&b,extendToSouthPole:h.y===(1<<h.z)-1&&b})}_getMesh(a,h){const _=this._getMeshKey(h);if(_ in this._tileMeshCache)return this._tileMeshCache[_];const b=function(A,C){const D=rf(C,"16bit"),B=s.aI.deserialize({arrayBuffer:D.vertices,length:D.vertices.byteLength/2/2}),j=s.aK.deserialize({arrayBuffer:D.indices,length:D.indices.byteLength/2/3});return new ec(A.createVertexBuffer(B,_s.members),A.createIndexBuffer(j),s.aJ.simpleSegment(0,0,B.length,j.length))}(a,h);return this._tileMeshCache[_]=b,b}recalculate(a){}hasTransition(){const a=I.now();let h=!1;return h=h||(a-this._errorMeasurementLastChangeTime)/1e3<.7,h=h||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,h}setErrorQueryLatitudeDegrees(a){this._errorQueryLatitudeDegrees=a}}const To=new s.r({type:new s.D(s.v.projection.type)});class ju extends s.E{constructor(a){super(),this._transitionable=new s.T(To),this.setProjection(a),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0)),this._mercatorProjection=new Mn,this._verticalPerspectiveProjection=new ic}get transitionState(){const a=this.properties.get("type");if(typeof a=="string"&&a==="mercator")return 0;if(typeof a=="string"&&a==="vertical-perspective")return 1;if(a instanceof s.be){if(a.from==="vertical-perspective"&&a.to==="mercator")return 1-a.transition;if(a.from==="mercator"&&a.to==="vertical-perspective")return a.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(a){this._mercatorProjection.updateGPUdependent(a),this._verticalPerspectiveProjection.updateGPUdependent(a)}getMeshFromTileID(a,h,_,b,A){return this.currentProjection.getMeshFromTileID(a,h,_,b,A)}setProjection(a){this._transitionable.setValue("type",(a==null?void 0:a.type)||"mercator")}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}setErrorQueryLatitudeDegrees(a){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(a),this._mercatorProjection.setErrorQueryLatitudeDegrees(a)}}function Uu(T){const a=nf(T.worldSize,T.center.lat);return 2*Math.PI*a}function Kc(T,a,h,_,b){const A=1/(1<<b),C=a/s.Z*A+_*A,D=s.bg((T/s.Z*A+h*A)*Math.PI*2+Math.PI,2*Math.PI),B=2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI,j=Math.cos(B),q=new Float64Array(3);return q[0]=Math.sin(D)*j,q[1]=Math.sin(B),q[2]=Math.cos(D)*j,q}function ca(T){return function(a,h){const _=Math.cos(h),b=new Float64Array(3);return b[0]=Math.sin(a)*_,b[1]=Math.sin(h),b[2]=Math.cos(a)*_,b}(T.lng*Math.PI/180,T.lat*Math.PI/180)}function nf(T,a){return T/(2*Math.PI)/Math.cos(a*Math.PI/180)}function ua(T){const a=Math.asin(T[1])/Math.PI*180,h=Math.sqrt(T[0]*T[0]+T[2]*T[2]);if(h>1e-6){const _=T[0]/h,b=Math.acos(T[2]/h),A=(_>0?b:-b)/Math.PI*180;return new s.Q(s.aL(A,-180,180),a)}return new s.Q(0,a)}function Qc(T){return Math.cos(T*Math.PI/180)}function _n(T,a){const h=Qc(T),_=Qc(a);return s.ah(_/h)}function $u(T,a){const h=T.rotate(a.bearingInRadians),_=a.zoom+_n(a.center.lat,0),b=s.bc(1/Qc(a.center.lat),1/Qc(Math.min(Math.abs(a.center.lat),60)),s.bf(_,7,3,0,1)),A=360/Uu({worldSize:a.worldSize,center:{lat:a.center.lat}});return new s.Q(a.center.lng-h.x*A*b,s.ae(a.center.lat+h.y*A,-85.051129,s.af))}function af(T){const a=.5*T,h=Math.sin(a),_=Math.cos(a);return Math.log(h+_)-Math.log(_-h)}function Ed(T,a,h,_){const b=T.lat+h*_;if(Math.abs(h)>1){const A=(Math.sign(T.lat+h)!==Math.sign(T.lat)?-Math.abs(T.lat):Math.abs(T.lat))*Math.PI/180,C=Math.abs(T.lat+h)*Math.PI/180,D=af(A+_*(C-A)),B=af(A),j=af(C);return new s.Q(T.lng+a*((D-B)/(j-B)),b)}return new s.Q(T.lng+a*_,b)}class ac{constructor(a){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=a}recalculateCache(){if(!this._hadAnyChanges)return;const a=this._cachePrevious;this._cachePrevious=this._cache,this._cache=a,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(a,h,_,b){const A=`${a.z}_${a.x}_${a.y}`,C=this._cache.get(A);if(C)return C;const D=this._cachePrevious.get(A);if(D)return this._cache.set(A,D),D;const B=this._aabbFactory(a,h,_,b);return this._cache.set(A,B),this._hadAnyChanges=!0,B}}function sf(T,a,h){const _=T-a;return _<0?-_:Math.max(0,_-h)}function Md(T,a,h,_,b){const A=T-h;let C;return C=A<0?Math.min(-A,1+A-b):A>1?Math.min(Math.max(A-b,0),1-A):0,Math.max(C,sf(a,_,b))}class w_{constructor(){this._aabbCache=new ac(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(a,h,_,b){const A=1<<_.z,C=1/A,D=_.x/A,B=_.y/A;let j=2;return j=Math.min(j,Md(a,h,D,B,C)),j=Math.min(j,Md(a,h,D+.5,-B-C,C)),j=Math.min(j,Md(a,h,D+.5,2-B-C,C)),j}getWrap(a,h,_){const b=1<<h.z,A=1/b,C=h.x/b,D=sf(a.x,C,A),B=sf(a.x,C-1,A),j=sf(a.x,C+1,A),q=Math.min(D,B,j);return q===j?1:q===B?-1:0}allowVariableZoom(a,h){return at(a,h)>4}allowWorldCopies(){return!1}getTileAABB(a,h,_,b){return this._aabbCache.getTileAABB(a,h,_,b)}_computeTileAABB(a,h,_,b){if(a.z<=0)return new bo([-1,-1,-1],[1,1,1]);if(a.z===1)return new bo([a.x===0?-1:0,a.y===0?0:-1,-1],[a.x===0?0:1,a.y===0?1:0,1]);{const A=[Kc(0,0,a.x,a.y,a.z),Kc(s.Z,0,a.x,a.y,a.z),Kc(s.Z,s.Z,a.x,a.y,a.z),Kc(0,s.Z,a.x,a.y,a.z)],C=[1,1,1],D=[-1,-1,-1];for(const B of A)for(let j=0;j<3;j++)C[j]=Math.min(C[j],B[j]),D[j]=Math.max(D[j],B[j]);if(a.y===0||a.y===(1<<a.z)-1){const B=[0,a.y===0?1:-1,0];for(let j=0;j<3;j++)C[j]=Math.min(C[j],B[j]),D[j]=Math.max(D[j],B[j])}return new bo(C,D)}}}class of{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(a){this._helper.setMinZoom(a)}setMaxZoom(a){this._helper.setMaxZoom(a)}setMinPitch(a){this._helper.setMinPitch(a)}setMaxPitch(a){this._helper.setMaxPitch(a)}setRenderWorldCopies(a){this._helper.setRenderWorldCopies(a)}setBearing(a){this._helper.setBearing(a)}setPitch(a){this._helper.setPitch(a)}setRoll(a){this._helper.setRoll(a)}setFov(a){this._helper.setFov(a)}setZoom(a){this._helper.setZoom(a)}setCenter(a){this._helper.setCenter(a)}setElevation(a){this._helper.setElevation(a)}setMinElevationForCurrentTile(a){this._helper.setMinElevationForCurrentTile(a)}setPadding(a){this._helper.setPadding(a)}interpolatePadding(a,h,_){return this._helper.interpolatePadding(a,h,_)}isPaddingEqual(a){return this._helper.isPaddingEqual(a)}resize(a,h){this._helper.resize(a,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(a){this._helper.setMaxBounds(a)}overrideNearFarZ(a,h){this._helper.overrideNearFarZ(a,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(a){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),a)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(a){}constructor(){this._cachedClippingPlane=s.bk(),this._projectionMatrix=s.b1(),this._globeViewProjMatrix32f=s.b0(),this._globeViewProjMatrixNoCorrection=s.b1(),this._globeViewProjMatrixNoCorrectionInverted=s.b1(),this._globeProjMatrixInverted=s.b1(),this._cameraPosition=s.bh(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new gi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(a,h)=>this.getConstrained(a,h)}),this._coveringTilesDetailsProvider=new w_}clone(){const a=new of;return a.apply(this),a}apply(a,h){this._globeLatitudeErrorCorrectionRadians=h||0,this._helper.apply(a)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const a=s.bh();return a[0]=this._cameraPosition[0],a[1]=this._cameraPosition[1],a[2]=this._cameraPosition[2],a}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(a){const{overscaledTileID:h,applyGlobeMatrix:_}=a,b=this._helper.getMercatorTileCoordinates(h);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:b,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(a){const h=this.pitchInRadians,_=this.cameraToCenterDistance/a,b=Math.sin(h)*_,A=Math.cos(h)*_+1,C=1/Math.sqrt(b*b+A*A)*1;let D=-b,B=A;const j=Math.sqrt(D*D+B*B);D/=j,B/=j;const q=[0,D,B];s.bl(q,q,[0,0,0],-this.bearingInRadians),s.bm(q,q,[0,0,0],-1*this.center.lat*Math.PI/180),s.bn(q,q,[0,0,0],this.center.lng*Math.PI/180);const X=1/s.bo(q);return s.aO(q,q,X),[...q,-C*X]}isLocationOccluded(a){return!this.isSurfacePointVisible(ca(a))}transformLightDirection(a){const h=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,b=Math.cos(_),A=[Math.sin(h)*b,Math.sin(_),Math.cos(h)*b],C=[A[2],0,-A[0]],D=[0,0,0];s.aU(D,C,A),s.aT(C,C),s.aT(D,D);const B=[0,0,0];return s.aT(B,[C[0]*a[0]+D[0]*a[1]+A[0]*a[2],C[1]*a[0]+D[1]*a[1]+A[1]*a[2],C[2]*a[0]+D[2]*a[1]+A[2]*a[2]]),B}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(a,h,_){const b=function(D,B,j){const q=1/(1<<j.z);return new s.$(D/s.Z*q+j.x*q,B/s.Z*q+j.y*q)}(a,h,_.canonical),A=(C=b.y,[s.bg(b.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-C*Math.PI*2))-.5*Math.PI]);var C;return this.getCircleRadiusCorrection()/Math.cos(A[1])}projectTileCoordinates(a,h,_,b){const A=_.canonical,C=Kc(a,h,A.x,A.y,A.z),D=1+(b?b(a,h):0)/s.bu,B=[C[0]*D,C[1]*D,C[2]*D,1];s.at(B,B,this._globeViewProjMatrixNoCorrection);const j=this._cachedClippingPlane,q=j[0]*C[0]+j[1]*C[1]+j[2]*C[2]+j[3]<0;return{point:new s.P(B[0]/B[3],B[1]/B[3]),signedDistanceFromCamera:B[3],isOccluded:q}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const a=nf(this.worldSize,this.center.lat),h=s.b2(),_=s.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*a),s.aY(h,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const b=this.centerOffset;h[8]=2*-b.x/this._helper._width,h[9]=2*b.y/this._helper._height,this._projectionMatrix=s.aZ(h),this._globeProjMatrixInverted=s.b2(),s.an(this._globeProjMatrixInverted,h),s.L(h,h,[0,0,-this.cameraToCenterDistance]),s.a_(h,h,this.rollInRadians),s.a$(h,h,-this.pitchInRadians),s.a_(h,h,this.bearingInRadians),s.L(h,h,[0,0,-a]);const A=s.bh();A[0]=a,A[1]=a,A[2]=a,s.a$(_,h,this.center.lat*Math.PI/180),s.bp(_,_,-this.center.lng*Math.PI/180),s.M(_,_,A),this._globeViewProjMatrixNoCorrection=_,s.a$(h,h,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bp(h,h,-this.center.lng*Math.PI/180),s.M(h,h,A),this._globeViewProjMatrix32f=new Float32Array(h),this._globeViewProjMatrixNoCorrectionInverted=s.b2(),s.an(this._globeViewProjMatrixNoCorrectionInverted,_);const C=s.bh();this._cameraPosition=s.bh(),this._cameraPosition[2]=this.cameraToCenterDistance/a,s.bl(this._cameraPosition,this._cameraPosition,C,-this.rollInRadians),s.bm(this._cameraPosition,this._cameraPosition,C,this.pitchInRadians),s.bl(this._cameraPosition,this._cameraPosition,C,-this.bearingInRadians),s.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bm(this._cameraPosition,this._cameraPosition,C,-this.center.lat*Math.PI/180),s.bn(this._cameraPosition,this._cameraPosition,C,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(a);const D=s.aZ(this._globeViewProjMatrixNoCorrectionInverted);s.M(D,D,[1,1,-1]),this._cachedFrustum=jn.fromInvProjectionMatrix(D)}calculateFogMatrix(a){s.w("calculateFogMatrix is not supported on globe projection.");const h=s.b2();return s.ad(h),h}getVisibleUnwrappedCoordinates(a){return[new s.aW(0,a)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(a){a&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(a,h){if(!this._globeViewProjMatrixNoCorrection)return 1;const _=ca(a);s.aO(_,_,1+h/s.bu);const b=s.bk();return s.at(b,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),b[2]/b[3]}populateCache(a){}getBounds(){const a=.5*this.width,h=.5*this.height,_=[new s.P(0,0),new s.P(a,0),new s.P(this.width,0),new s.P(this.width,h),new s.P(this.width,this.height),new s.P(a,this.height),new s.P(0,this.height),new s.P(0,h)],b=[];for(const X of _)b.push(this.unprojectScreenPoint(X));let A=0,C=0,D=0,B=0;const j=this.center;for(const X of b){const G=s.bq(j.lng,X.lng),ae=s.bq(j.lat,X.lat);G<C&&(C=G),G>A&&(A=G),ae<B&&(B=ae),ae>D&&(D=ae)}const q=[j.lng+C,j.lat+B,j.lng+A,j.lat+D];return this.isSurfacePointOnScreen([0,1,0])&&(q[3]=90,q[0]=-180,q[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(q[1]=-90,q[0]=-180,q[2]=180),new Vt(q)}getConstrained(a,h){const _=s.ae(a.lat,-85.051129,s.af),b=s.ae(+h,this.minZoom+_n(0,_),this.maxZoom);return{center:new s.Q(a.lng,_),zoom:b}}calculateCenterFromCameraLngLatAlt(a,h,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(a,h,_,b)}setLocationAtPoint(a,h){const _=ca(this.unprojectScreenPoint(h)),b=ca(a),A=s.bh();s.br(A);const C=s.bh();s.bn(C,_,A,-this.center.lng*Math.PI/180),s.bm(C,C,A,this.center.lat*Math.PI/180);const D=b[0]*b[0]+b[2]*b[2],B=C[0]*C[0];if(D<B)return;const j=Math.sqrt(D-B),q=-j,X=s.bs(b[0],b[2],C[0],j),G=s.bs(b[0],b[2],C[0],q),ae=s.bh();s.bn(ae,b,A,-X);const se=s.bs(ae[1],ae[2],C[1],C[2]),ve=s.bh();s.bn(ve,b,A,-G);const _e=s.bs(ve[1],ve[2],C[1],C[2]),xe=.5*Math.PI,Ae=se>=-xe&&se<=xe,Oe=_e>=-xe&&_e<=xe;let ke,Be;if(Ae&&Oe){const lt=this.center.lng*Math.PI/180,At=this.center.lat*Math.PI/180;s.bv(X,lt)+s.bv(se,At)<s.bv(G,lt)+s.bv(_e,At)?(ke=X,Be=se):(ke=G,Be=_e)}else if(Ae)ke=X,Be=se;else{if(!Oe)return;ke=G,Be=_e}const je=ke/Math.PI*180,Le=Be/Math.PI*180,nt=this.center.lat;this.setCenter(new s.Q(je,s.ae(Le,-90,90))),this.setZoom(this.zoom+_n(nt,this.center.lat))}locationToScreenPoint(a,h){const _=ca(a);if(h){const b=h.getElevationForLngLatZoom(a,this._helper._tileZoom);s.aO(_,_,1+b/s.bu)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(a){const h=s.bk();return s.at(h,[...a,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],new s.P((.5*h[0]+.5)*this.width,(.5*-h[1]+.5)*this.height)}screenPointToMercatorCoordinate(a,h){if(h){const _=h.pointCoordinate(a);if(_)return _}return s.$.fromLngLat(this.unprojectScreenPoint(a))}screenPointToLocation(a,h){var _;return(_=this.screenPointToMercatorCoordinate(a,h))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(a,h){const _=this._cameraPosition,b=this.getRayDirectionFromPixel(a);return!!this.rayPlanetIntersection(_,b)}getRayDirectionFromPixel(a){const h=s.bk();h[0]=a.x/this.width*2-1,h[1]=-1*(a.y/this.height*2-1),h[2]=1,h[3]=1,s.at(h,h,this._globeViewProjMatrixNoCorrectionInverted),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3];const _=s.bh();_[0]=h[0]-this._cameraPosition[0],_[1]=h[1]-this._cameraPosition[1],_[2]=h[2]-this._cameraPosition[2];const b=s.bh();return s.aT(b,_),b}isSurfacePointVisible(a){const h=this._cachedClippingPlane;return h[0]*a[0]+h[1]*a[1]+h[2]*a[2]+h[3]>=0}isSurfacePointOnScreen(a){if(!this.isSurfacePointVisible(a))return!1;const h=s.bk();return s.at(h,[...a,1],this._globeViewProjMatrixNoCorrection),h[0]/=h[3],h[1]/=h[3],h[2]/=h[3],h[0]>-1&&h[0]<1&&h[1]>-1&&h[1]<1&&h[2]>-1&&h[2]<1}rayPlanetIntersection(a,h){const _=s.aV(a,h),b=s.bh(),A=s.bh();s.aO(A,h,_),s.aS(b,a,A);const C=1-s.aV(b,b);if(C<0)return null;const D=s.aV(a,a)-1,B=-_+(_<0?1:-1)*Math.sqrt(C),j=D/B,q=B;return{tMin:Math.min(j,q),tMax:Math.max(j,q)}}unprojectScreenPoint(a){const h=this._cameraPosition,_=this.getRayDirectionFromPixel(a),b=this.rayPlanetIntersection(h,_);if(b){const q=s.bh();s.aP(q,h,[_[0]*b.tMin,_[1]*b.tMin,_[2]*b.tMin]);const X=s.bh();return s.aT(X,q),ua(X)}const A=this._cachedClippingPlane,C=A[0]*_[0]+A[1]*_[1]+A[2]*_[2],D=-s.bt(A,h)/C,B=s.bh();if(D>0)s.aP(B,h,[_[0]*D,_[1]*D,_[2]*D]);else{const q=s.bh();s.aP(q,h,[2*_[0],2*_[1],2*_[2]]);const X=s.bt(this._cachedClippingPlane,q);s.aS(B,q,[this._cachedClippingPlane[0]*X,this._cachedClippingPlane[1]*X,this._cachedClippingPlane[2]*X])}const j=function(q){const X=s.bh();return X[0]=q[0]*-q[3],X[1]=q[1]*-q[3],X[2]=q[2]*-q[3],{center:X,radius:Math.sqrt(1-q[3]*q[3])}}(A);return ua(function(q,X,G){const ae=s.bh();s.aS(ae,G,q);const se=s.bh();return s.bi(se,q,ae,X/s.bj(ae)),se}(j.center,j.radius,B))}getMatrixForModel(a,h){const _=s.Q.convert(a),b=1/s.bu,A=s.b1();return s.bp(A,A,_.lng/180*Math.PI),s.a$(A,A,-_.lat/180*Math.PI),s.L(A,A,[0,0,1+h/s.bu]),s.a$(A,A,.5*Math.PI),s.M(A,A,[b,b,b]),A}getProjectionDataForCustomLayer(a=!0){const h=this.getProjectionData({overscaledTileID:new s.Y(0,0,0,0,0),applyGlobeMatrix:a});return h.tileMercatorCoords=[0,0,1,1],h}getFastPathSimpleProjectionMatrix(a){}}class Jc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(a){this._helper.setMinZoom(a)}setMaxZoom(a){this._helper.setMaxZoom(a)}setMinPitch(a){this._helper.setMinPitch(a)}setMaxPitch(a){this._helper.setMaxPitch(a)}setRenderWorldCopies(a){this._helper.setRenderWorldCopies(a)}setBearing(a){this._helper.setBearing(a)}setPitch(a){this._helper.setPitch(a)}setRoll(a){this._helper.setRoll(a)}setFov(a){this._helper.setFov(a)}setZoom(a){this._helper.setZoom(a)}setCenter(a){this._helper.setCenter(a)}setElevation(a){this._helper.setElevation(a)}setMinElevationForCurrentTile(a){this._helper.setMinElevationForCurrentTile(a)}setPadding(a){this._helper.setPadding(a)}interpolatePadding(a,h,_){return this._helper.interpolatePadding(a,h,_)}isPaddingEqual(a){return this._helper.isPaddingEqual(a)}resize(a,h,_=!0){this._helper.resize(a,h,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(a){this._helper.setMaxBounds(a)}overrideNearFarZ(a,h){this._helper.overrideNearFarZ(a,h)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(a){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),a)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(a,h){this._globeness=a,this._globeLatitudeErrorCorrectionRadians=h,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new gi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(a,h)=>this.getConstrained(a,h)}),this._globeness=1,this._mercatorTransform=new ja,this._verticalPerspectiveTransform=new of}clone(){const a=new Jc;return a._globeness=this._globeness,a._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,a.apply(this),a}apply(a){this._helper.apply(a),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(a){const h=this._mercatorTransform.getProjectionData(a),_=this._verticalPerspectiveTransform.getProjectionData(a);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:h.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:a.applyGlobeMatrix?this._globeness:0,fallbackMatrix:h.fallbackMatrix}}isLocationOccluded(a){return this.currentTransform.isLocationOccluded(a)}transformLightDirection(a){return this.currentTransform.transformLightDirection(a)}getPixelScale(){return s.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(a,h,_){const b=this._mercatorTransform.getPitchedTextCorrection(a,h,_),A=this._verticalPerspectiveTransform.getPitchedTextCorrection(a,h,_);return s.bc(b,A,this._globeness)}projectTileCoordinates(a,h,_,b){return this.currentTransform.projectTileCoordinates(a,h,_,b)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(a){return this.currentTransform.calculateFogMatrix(a)}getVisibleUnwrappedCoordinates(a){return this.currentTransform.getVisibleUnwrappedCoordinates(a)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(a){this._mercatorTransform.recalculateZoomAndCenter(a),this._verticalPerspectiveTransform.recalculateZoomAndCenter(a)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(a,h){return this.currentTransform.lngLatToCameraDepth(a,h)}populateCache(a){this._mercatorTransform.populateCache(a),this._verticalPerspectiveTransform.populateCache(a)}getBounds(){return this.currentTransform.getBounds()}getConstrained(a,h){return this.currentTransform.getConstrained(a,h)}calculateCenterFromCameraLngLatAlt(a,h,_,b){return this._helper.calculateCenterFromCameraLngLatAlt(a,h,_,b)}setLocationAtPoint(a,h){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(a,h),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(a,h),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(a,h){return this.currentTransform.locationToScreenPoint(a,h)}screenPointToMercatorCoordinate(a,h){return this.currentTransform.screenPointToMercatorCoordinate(a,h)}screenPointToLocation(a,h){return this.currentTransform.screenPointToLocation(a,h)}isPointOnMapSurface(a,h){return this.currentTransform.isPointOnMapSurface(a,h)}getRayDirectionFromPixel(a){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(a)}getMatrixForModel(a,h){return this.currentTransform.getMatrixForModel(a,h)}getProjectionDataForCustomLayer(a=!0){const h=this._mercatorTransform.getProjectionDataForCustomLayer(a);if(!this.isGlobeRendering)return h;const _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(a);return _.fallbackMatrix=h.mainMatrix,_}getFastPathSimpleProjectionMatrix(a){return this.currentTransform.getFastPathSimpleProjectionMatrix(a)}}class ks{get useGlobeControls(){return!0}handlePanInertia(a,h){const _=$u(a,h);return Math.abs(_.lng-h.center.lng)>180&&(_.lng=h.center.lng+179.5*Math.sign(_.lng-h.center.lng)),{easingCenter:_,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(a,h){const _=a.around,b=h.screenPointToLocation(_);a.bearingDelta&&h.setBearing(h.bearing+a.bearingDelta),a.pitchDelta&&h.setPitch(h.pitch+a.pitchDelta),a.rollDelta&&h.setRoll(h.roll+a.rollDelta);const A=h.zoom;a.zoomDelta&&h.setZoom(h.zoom+a.zoomDelta);const C=h.zoom-A;if(C===0)return;const D=s.bq(h.center.lng,b.lng),B=D/(Math.abs(D/180)+1),j=s.bq(h.center.lat,b.lat),q=h.getRayDirectionFromPixel(_),X=h.cameraPosition,G=-1*s.aV(X,q),ae=s.bh();s.aP(ae,X,[q[0]*G,q[1]*G,q[2]*G]);const se=s.bo(ae)-1,ve=Math.exp(.5*-Math.max(se-.3,0)),_e=nf(h.worldSize,h.center.lat)/Math.min(h.width,h.height),xe=s.bf(_e,.9,.5,1,.25),Ae=(1-s.ac(-C))*Math.min(ve,xe),Oe=h.center.lat,ke=h.zoom,Be=new s.Q(h.center.lng+B*Ae,s.ae(h.center.lat+j*Ae,-85.051129,s.af));h.setLocationAtPoint(b,_);const je=h.center,Le=s.bf(Math.abs(D),45,85,0,1),nt=s.bf(_e,.75,.35,0,1),lt=Math.pow(Math.max(Le,nt),.25),At=s.bq(je.lng,Be.lng),St=s.bq(je.lat,Be.lat);h.setCenter(new s.Q(je.lng+At*lt,je.lat+St*lt).wrap()),h.setZoom(ke+_n(Oe,h.center.lat))}handleMapControlsPan(a,h,_){if(!a.panDelta)return;const b=h.center.lat,A=h.zoom;h.setCenter($u(a.panDelta,h).wrap()),h.setZoom(A+_n(b,h.center.lat))}cameraForBoxAndBearing(a,h,_,b,A){const C=la(a,h,_,b,A),D=h.left/A.width*2-1,B=(A.width-h.right)/A.width*2-1,j=h.top/A.height*-2+1,q=(A.height-h.bottom)/A.height*-2+1,X=s.bq(_.getWest(),_.getEast())<0,G=X?_.getEast():_.getWest(),ae=X?_.getWest():_.getEast(),se=Math.max(_.getNorth(),_.getSouth()),ve=Math.min(_.getNorth(),_.getSouth()),_e=G+.5*s.bq(G,ae),xe=se+.5*s.bq(se,ve),Ae=A.clone();Ae.setCenter(C.center),Ae.setBearing(C.bearing),Ae.setPitch(0),Ae.setRoll(0),Ae.setZoom(C.zoom);const Oe=Ae.modelViewProjectionMatrix,ke=[ca(_.getNorthWest()),ca(_.getNorthEast()),ca(_.getSouthWest()),ca(_.getSouthEast()),ca(new s.Q(ae,xe)),ca(new s.Q(G,xe)),ca(new s.Q(_e,se)),ca(new s.Q(_e,ve))],Be=ca(C.center);let je=Number.POSITIVE_INFINITY;for(const Le of ke)D<0&&(je=ks.getLesserNonNegativeNonNull(je,ks.solveVectorScale(Le,Be,Oe,"x",D))),B>0&&(je=ks.getLesserNonNegativeNonNull(je,ks.solveVectorScale(Le,Be,Oe,"x",B))),j>0&&(je=ks.getLesserNonNegativeNonNull(je,ks.solveVectorScale(Le,Be,Oe,"y",j))),q<0&&(je=ks.getLesserNonNegativeNonNull(je,ks.solveVectorScale(Le,Be,Oe,"y",q)));if(Number.isFinite(je)&&je!==0)return C.zoom=Ae.zoom+s.ah(je),C;oa()}handleJumpToCenterZoom(a,h){const _=a.center.lat,b=a.getConstrained(h.center?s.Q.convert(h.center):a.center,a.zoom).center;a.setCenter(b.wrap());const A=h.zoom!==void 0?+h.zoom:a.zoom+_n(_,b.lat);a.zoom!==A&&a.setZoom(A)}handleEaseTo(a,h){const _=a.zoom,b=a.center,A=a.padding,C={roll:a.roll,pitch:a.pitch,bearing:a.bearing},D={roll:h.roll===void 0?a.roll:h.roll,pitch:h.pitch===void 0?a.pitch:h.pitch,bearing:h.bearing===void 0?a.bearing:h.bearing},B=h.zoom!==void 0,j=!a.isPaddingEqual(h.padding);let q=!1;const X=h.center?s.Q.convert(h.center):b,G=a.getConstrained(X,_).center;Ii(a,G);const ae=a.clone();ae.setCenter(G),ae.setZoom(B?+h.zoom:_+_n(b.lat,X.lat)),ae.setBearing(h.bearing);const se=new s.P(s.ae(a.centerPoint.x+h.offsetAsPoint.x,0,a.width),s.ae(a.centerPoint.y+h.offsetAsPoint.y,0,a.height));ae.setLocationAtPoint(G,se);const ve=(h.offset&&h.offsetAsPoint.mag())>0?ae.center:G,_e=B?+h.zoom:_+_n(b.lat,ve.lat),xe=_+_n(b.lat,0),Ae=_e+_n(ve.lat,0),Oe=s.bq(b.lng,ve.lng),ke=s.bq(b.lat,ve.lat),Be=s.ac(Ae-xe);return q=_e!==_,{easeFunc:je=>{if(s.b6(C,D)||nc({startEulerAngles:C,endEulerAngles:D,tr:a,k:je,useSlerp:C.roll!=D.roll}),j&&a.interpolatePadding(A,h.padding,je),h.around)s.w("Easing around a point is not supported under globe projection."),a.setLocationAtPoint(h.around,h.aroundPoint);else{const Le=Ae>xe?Math.min(2,Be):Math.max(.5,Be),nt=Math.pow(Le,1-je),lt=Ed(b,Oe,ke,je*nt);a.setCenter(lt.wrap())}if(q){const Le=s.B.number(xe,Ae,je)+_n(0,a.center.lat);a.setZoom(Le)}},isZooming:q,elevationCenter:ve}}handleFlyTo(a,h){const _=h.zoom!==void 0,b=a.center,A=a.zoom,C=a.padding,D=!a.isPaddingEqual(h.padding),B=a.getConstrained(s.Q.convert(h.center||h.locationAtOffset),A).center,j=_?+h.zoom:a.zoom+_n(a.center.lat,B.lat),q=a.clone();q.setCenter(B),q.setZoom(j),q.setBearing(h.bearing);const X=new s.P(s.ae(a.centerPoint.x+h.offsetAsPoint.x,0,a.width),s.ae(a.centerPoint.y+h.offsetAsPoint.y,0,a.height));q.setLocationAtPoint(B,X);const G=q.center;Ii(a,G);const ae=function(ke,Be,je){const Le=ca(Be),nt=ca(je),lt=s.aV(Le,nt),At=Math.acos(lt),St=Uu(ke);return At/(2*Math.PI)*St}(a,b,G),se=A+_n(b.lat,0),ve=j+_n(G.lat,0),_e=s.ac(ve-se);let xe;if(typeof h.minZoom=="number"){const ke=+h.minZoom+_n(G.lat,0),Be=Math.min(ke,se,ve)+_n(0,G.lat),je=a.getConstrained(G,Be).zoom+_n(G.lat,0);xe=s.ac(je-se)}const Ae=s.bq(b.lng,G.lng),Oe=s.bq(b.lat,G.lat);return{easeFunc:(ke,Be,je,Le)=>{const nt=Ed(b,Ae,Oe,je);D&&a.interpolatePadding(C,h.padding,ke);const lt=ke===1?G:nt;a.setCenter(lt.wrap());const At=se+s.ah(Be);a.setZoom(ke===1?j:At+_n(0,lt.lat))},scaleOfZoom:_e,targetCenter:G,scaleOfMinZoom:xe,pixelPathLength:ae}}static solveVectorScale(a,h,_,b,A){const C=b==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],D=[_[3],_[7],_[11],_[15]],B=a[0]*C[0]+a[1]*C[1]+a[2]*C[2],j=a[0]*D[0]+a[1]*D[1]+a[2]*D[2],q=h[0]*C[0]+h[1]*C[1]+h[2]*C[2],X=h[0]*D[0]+h[1]*D[1]+h[2]*D[2];return q+A*j===B+A*X||D[3]*(B-q)+C[3]*(X-j)+B*X==q*j?null:(q+C[3]-A*X-A*D[3])/(q-B-A*X+A*j)}static getLesserNonNegativeNonNull(a,h){return h!==null&&h>=0&&h<a?h:a}}class Vu{constructor(a){this._globe=a,this._mercatorCameraHelper=new ys,this._verticalPerspectiveCameraHelper=new ks}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(a,h){return this.currentHelper.handlePanInertia(a,h)}handleMapControlsRollPitchBearingZoom(a,h){return this.currentHelper.handleMapControlsRollPitchBearingZoom(a,h)}handleMapControlsPan(a,h,_){this.currentHelper.handleMapControlsPan(a,h,_)}cameraForBoxAndBearing(a,h,_,b,A){return this.currentHelper.cameraForBoxAndBearing(a,h,_,b,A)}handleJumpToCenterZoom(a,h){this.currentHelper.handleJumpToCenterZoom(a,h)}handleEaseTo(a,h){return this.currentHelper.handleEaseTo(a,h)}handleFlyTo(a,h){return this.currentHelper.handleFlyTo(a,h)}}const eu=(T,a)=>s.x(T,a&&a.filter(h=>h.identifier!=="source.canvas")),qu=s.bw();class Hu extends s.E{constructor(a,h={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const b=this.sourceCaches[_].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[_].reload()}},this.map=a,this.dispatcher=new tr(Pt(),a._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,b)=>this.getGlyphs(_,b)),this.dispatcher.registerMessageHandler("GI",(_,b)=>this.getImages(_,b)),this.imageManager=new Ye,this.imageManager.setEventedParent(this),this.glyphManager=new Ze(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Te(256,512),this.crossTileSymbolIndex=new Qs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bx,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.by()),Xi().on(_o,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const b=this.sourceCaches[_.sourceId];if(!b)return;const A=b.getSource();if(A&&A.vectorLayerIds)for(const C in this._layers){const D=this._layers[C];D.source===A.id&&this._validateLayer(D)}})}loadURL(a,h={},_){this.fire(new s.l("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const b=this.map._requestManager.transformRequest(a,"Style");this._loadStyleRequest=new AbortController;const A=this._loadStyleRequest;s.j(b,this._loadStyleRequest).then(C=>{this._loadStyleRequest=null,this._load(C.data,h,_)}).catch(C=>{this._loadStyleRequest=null,C&&!A.signal.aborted&&this.fire(new s.k(C))})}loadJSON(a,h={},_){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(a,h,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(qu,{validate:!1})}_load(a,h,_){var b,A;const C=h.transformStyle?h.transformStyle(_,a):a;if(!h.validate||!eu(this,s.y(C))){this._loaded=!0,this.stylesheet=C;for(const D in C.sources)this.addSource(D,C.sources[D],{validate:!1});C.sprite?this._loadSprite(C.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(C.glyphs),this._createLayers(),this.light=new et(this.stylesheet.light),this._setProjectionInternal(((b=this.stylesheet.projection)===null||b===void 0?void 0:b.type)||"mercator"),this.sky=new Bt(this.stylesheet.sky),this.map.setTerrain((A=this.stylesheet.terrain)!==null&&A!==void 0?A:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){const a=s.bz(this.stylesheet.layers);this.dispatcher.broadcast("SL",a),this._order=a.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of a){const _=s.bA(h);_.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=_}}_loadSprite(a,h=!1,_=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(A,C,D,B){return s._(this,void 0,void 0,function*(){const j=Y(A),q=D>1?"@2x":"",X={},G={};for(const{id:ae,url:se}of j){const ve=C.transformRequest(ue(se,q,".json"),"SpriteJSON");X[ae]=s.j(ve,B);const _e=C.transformRequest(ue(se,q,".png"),"SpriteImage");G[ae]=re.getImage(_e,B)}return yield Promise.all([...Object.values(X),...Object.values(G)]),function(ae,se){return s._(this,void 0,void 0,function*(){const ve={};for(const _e in ae){ve[_e]={};const xe=I.getImageCanvasContext((yield se[_e]).data),Ae=(yield ae[_e]).data;for(const Oe in Ae){const{width:ke,height:Be,x:je,y:Le,sdf:nt,pixelRatio:lt,stretchX:At,stretchY:St,content:Tt,textFitWidth:Wt,textFitHeight:Ht}=Ae[Oe];ve[_e][Oe]={data:null,pixelRatio:lt,sdf:nt,stretchX:At,stretchY:St,content:Tt,textFitWidth:Wt,textFitHeight:Ht,spriteData:{width:ke,height:Be,x:je,y:Le,context:xe}}}}return ve})}(X,G)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(A=>{if(this._spriteRequest=null,A)for(const C in A){this._spritesImagesIds[C]=[];const D=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(B=>!(B in A)):[];for(const B of D)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in A[C]){const j=C==="default"?B:`${C}:${B}`;this._spritesImagesIds[C].push(j),j in this.imageManager.images?this.imageManager.updateImage(j,A[C][B],!1):this.imageManager.addImage(j,A[C][B]),h&&(this._changedImages[j]=!0)}}}).catch(A=>{this._spriteRequest=null,b=A,this.fire(new s.k(b))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),_&&_(b)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(a){const h=this.sourceCaches[a.source];if(!h)return;const _=a.sourceLayer;if(!_)return;const b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.k(new Error(`Source layer "${_}" does not exist on source "${b.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a,h=!1){const _=this._serializedAllLayers();if(!a||a.length===0)return Object.values(h?s.bB(_):_);const b=[];for(const A of a)if(_[A]){const C=h?s.bB(_[A]):_[A];b.push(C)}return b}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const h=Object.keys(this._layers);for(const _ of h){const b=this._layers[_];b.type!=="custom"&&(a[_]=b.serialize())}return a}hasTransitions(){var a,h,_;if(!((a=this.light)===null||a===void 0)&&a.hasTransition()||!((h=this.sky)===null||h===void 0)&&h.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(const b in this.sourceCaches)if(this.sourceCaches[b].hasTransition())return!0;for(const b in this._layers)if(this._layers[b].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const h=this._changed;if(h){const b=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(b.length||A.length)&&this._updateWorkerLayers(b,A);for(const C in this._updatedSources){const D=this._updatedSources[C];if(D==="reload")this._reloadSource(C);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(a);this.light.updateTransitions(a),this.sky.updateTransitions(a),this._resetUpdates()}const _={};for(const b in this.sourceCaches){const A=this.sourceCaches[b];_[b]=A.used,A.used=!1}for(const b of this._order){const A=this._layers[b];A.recalculate(a,this._availableImages),!A.isHidden(a.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const b in _){const A=this.sourceCaches[b];!!_[b]!=!!A.used&&A.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(a),this.sky.recalculate(a),this.projection.recalculate(a),this.z=a.zoom,h&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(a,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a,h={}){var _;this._checkLoaded();const b=this.serialize();if(a=h.transformStyle?h.transformStyle(b,a):a,((_=h.validate)===null||_===void 0||_)&&eu(this,s.y(a)))return!1;(a=s.bB(a)).layers=s.bz(a.layers);const A=s.bC(b,a),C=this._getOperationsToPerform(A);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const D of C.operations)D();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const h=[],_=[];for(const b of a)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,b.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,b.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,b.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,b.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,b.args));break;case"addSource":h.push(()=>this.addSource.apply(this,b.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,b.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,b.args));break;case"setLight":h.push(()=>this.setLight.apply(this,b.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,b.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,b.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,b.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,b.args));break;case"setSky":h.push(()=>this.setSky.apply(this,b.args));break;case"setProjection":this.setProjection.apply(this,b.args);break;case"setTransition":h.push(()=>{});break;default:_.push(b.command)}return{operations:h,unimplemented:_}}addImage(a,h){if(this.getImage(a))return this.fire(new s.k(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,h),this._afterImageUpdated(a)}updateImage(a,h){this.imageManager.updateImage(a,h)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new s.k(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,h,_={}){if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.y.source,`sources.${a}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const b=this.sourceCaches[a]=new gt(a,h,this.dispatcher);b.style=this,b.setEventedParent(this,()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:a})),b.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===a)return this.fire(new s.k(new Error(`Source "${a}" cannot be removed while layer "${_}" is using it.`)));const h=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],h.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,h){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const _=this.sourceCaches[a].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(h),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,h,_={}){this._checkLoaded();const b=a.id;if(this.getLayer(b))return void this.fire(new s.k(new Error(`Layer "${b}" already exists on this map.`)));let A;if(a.type==="custom"){if(eu(this,s.bD(a)))return;A=s.bA(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(b,a.source),a=s.bB(a),a=s.e(a,{source:b})),this._validate(s.y.layer,`layers.${b}`,a,{arrayIndex:-1},_))return;A=s.bA(a),this._validateLayer(A),A.setEventedParent(this,{layer:{id:b}})}const C=h?this._order.indexOf(h):this._order.length;if(h&&C===-1)this.fire(new s.k(new Error(`Cannot add layer "${b}" before non-existing layer "${h}".`)));else{if(this._order.splice(C,0,b),this._layerOrderChanged=!0,this._layers[b]=A,this._removedLayers[b]&&A.source&&A.type!=="custom"){const D=this._removedLayers[b];delete this._removedLayers[b],D.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(a,h){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new s.k(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===h)return;const _=this._order.indexOf(a);this._order.splice(_,1);const b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new s.k(new Error(`Cannot move layer "${a}" before non-existing layer "${h}".`))):(this._order.splice(b,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const h=this._layers[a];if(!h)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${a}".`)));h.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,h,_){this._checkLoaded();const b=this.getLayer(a);b?b.minzoom===h&&b.maxzoom===_||(h!=null&&(b.minzoom=h),_!=null&&(b.maxzoom=_),this._updateLayer(b)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,h,_={}){this._checkLoaded();const b=this.getLayer(a);if(b){if(!s.bE(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(s.y.filter,`layers.${b.id}.filter`,h,null,_)||(b.filter=s.bB(h),this._updateLayer(b)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return s.bB(this.getLayer(a).filter)}setLayoutProperty(a,h,_,b={}){this._checkLoaded();const A=this.getLayer(a);A?s.bE(A.getLayoutProperty(h),_)||(A.setLayoutProperty(h,_,b),this._updateLayer(A)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,h){const _=this.getLayer(a);if(_)return _.getLayoutProperty(h);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,h,_,b={}){this._checkLoaded();const A=this.getLayer(a);A?s.bE(A.getPaintProperty(h),_)||(A.setPaintProperty(h,_,b)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[a]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,h){return this.getLayer(a).getPaintProperty(h)}setFeatureState(a,h){this._checkLoaded();const _=a.source,b=a.sourceLayer,A=this.sourceCaches[_];if(A===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));const C=A.getSource().type;C==="geojson"&&b?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||b?(a.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),A.setFeatureState(b,a.id,h)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,h){this._checkLoaded();const _=a.source,b=this.sourceCaches[_];if(b===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));const A=b.getSource().type,C=A==="vector"?a.sourceLayer:void 0;A!=="vector"||C?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(C,a.id,h):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const h=a.source,_=a.sourceLayer,b=this.sourceCaches[h];if(b!==void 0)return b.getSource().type!=="vector"||_?(a.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),b.getFeatureState(_,a.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=s.bF(this.sourceCaches,A=>A.serialize()),h=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,b=this.stylesheet;return s.bG({version:b.version,name:b.name,metadata:b.metadata,light:b.light,sky:b.sky,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,projection:b.projection,sources:a,layers:h,terrain:_},A=>A!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const h=C=>this._layers[C].type==="fill-extrusion",_={},b=[];for(let C=this._order.length-1;C>=0;C--){const D=this._order[C];if(h(D)){_[D]=C;for(const B of a){const j=B[D];if(j)for(const q of j)b.push(q)}}}b.sort((C,D)=>D.intersectionZ-C.intersectionZ);const A=[];for(let C=this._order.length-1;C>=0;C--){const D=this._order[C];if(h(D))for(let B=b.length-1;B>=0;B--){const j=b[B].feature;if(_[j.layer.id]<C)break;A.push(j),b.pop()}else for(const B of a){const j=B[D];if(j)for(const q of j)A.push(q.feature)}}return A}queryRenderedFeatures(a,h,_){h&&h.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",h.filter,null,h);const b={};if(h&&h.layers){if(!(Array.isArray(h.layers)||h.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const j of h.layers){const q=this._layers[j];if(!q)return this.fire(new s.k(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];b[q.source]=!0}}const A=[];h.availableImages=this._availableImages;const C=this._serializedAllLayers(),D=h.layers instanceof Set?h.layers:Array.isArray(h.layers)?new Set(h.layers):null,B=Object.assign(Object.assign({},h),{layers:D});for(const j in this.sourceCaches)h.layers&&!b[j]||A.push(Gt(this.sourceCaches[j],this._layers,C,a,B,_,this.map.terrain?(q,X,G)=>this.map.terrain.getElevation(q,X,G):void 0));return this.placement&&A.push(function(j,q,X,G,ae,se,ve){const _e={},xe=se.queryRenderedSymbols(G),Ae=[];for(const Oe of Object.keys(xe).map(Number))Ae.push(ve[Oe]);Ae.sort(Zt);for(const Oe of Ae){const ke=Oe.featureIndex.lookupSymbolFeatures(xe[Oe.bucketInstanceId],q,Oe.bucketIndex,Oe.sourceLayerIndex,ae.filter,ae.layers,ae.availableImages,j);for(const Be in ke){const je=_e[Be]=_e[Be]||[],Le=ke[Be];Le.sort((nt,lt)=>{const At=Oe.featureSortOrder;if(At){const St=At.indexOf(nt.featureIndex);return At.indexOf(lt.featureIndex)-St}return lt.featureIndex-nt.featureIndex});for(const nt of Le)je.push(nt)}}return function(Oe,ke,Be){for(const je in Oe)for(const Le of Oe[je])mt(Le,Be[ke[je].source]);return Oe}(_e,j,X)}(this._layers,C,this.sourceCaches,a,B,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(a,h){h&&h.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",h.filter,null,h);const _=this.sourceCaches[a];return _?function(b,A){const C=b.getRenderableIds().map(j=>b.getTileByID(j)),D=[],B={};for(let j=0;j<C.length;j++){const q=C[j],X=q.tileID.canonical.key;B[X]||(B[X]=!0,q.querySourceFeatures(D,A))}return D}(_,h):[]}getLight(){return this.light.getLight()}setLight(a,h={}){this._checkLoaded();const _=this.light.getLight();let b=!1;for(const C in a)if(!s.bE(a[C],_[C])){b=!0;break}if(!b)return;const A={now:I.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(A)}getProjection(){var a;return(a=this.stylesheet)===null||a===void 0?void 0:a.projection}setProjection(a){if(this._checkLoaded(),this.projection){if(this.projection.name===a.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=a,this._setProjectionInternal(a.type)}getSky(){var a;return(a=this.stylesheet)===null||a===void 0?void 0:a.sky}setSky(a,h={}){this._checkLoaded();const _=this.getSky();let b=!1;if(!a&&!_)return;if(a&&!_)b=!0;else if(!a&&_)b=!0;else for(const C in a)if(!s.bE(a[C],_[C])){b=!0;break}if(!b)return;const A={now:I.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=a,this.sky.setSky(a,h),this.sky.updateTransitions(A)}_setProjectionInternal(a){const h=function(_){if(Array.isArray(_)){const b=new ju({type:_});return{projection:b,transform:new Jc,cameraHelper:new Vu(b)}}switch(_){case"mercator":return{projection:new Mn,transform:new ja,cameraHelper:new ys};case"globe":{const b=new ju({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:b,transform:new Jc,cameraHelper:new Vu(b)}}case"vertical-perspective":return{projection:new ic,transform:new of,cameraHelper:new ks};default:return s.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new Mn,transform:new ja,cameraHelper:new ys}}}(a);this.projection=h.projection,this.map.migrateProjection(h.transform,h.cameraHelper);for(const _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(a,h,_,b,A={}){return(!A||A.validate!==!1)&&eu(this,a.call(s.y,s.e({key:h,style:this.serialize(),value:_,styleSpec:s.v},b)))}_remove(a=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Xi().off(_o,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const _=this.sourceCaches[h];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const h in this.sourceCaches)this.sourceCaches[h].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,h,_,b,A=!1){let C=!1,D=!1;const B={};for(const j of this._order){const q=this._layers[j];if(q.type!=="symbol")continue;if(!B[q.source]){const G=this.sourceCaches[q.source];B[q.source]=G.getRenderableIds(!0).map(ae=>G.getTileByID(ae)).sort((ae,se)=>se.tileID.overscaledZ-ae.tileID.overscaledZ||(ae.tileID.isLessThan(se.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(q,B[q.source],a.center.lng);C=C||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(I.now(),a.zoom))&&(this.pauseablePlacement=new Gc(a,this.map.terrain,this._order,A,h,_,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(I.now()),D=!0),C&&this.pauseablePlacement.placement.setStale()),D||C)for(const j of this._order){const q=this._layers[j];q.type==="symbol"&&this.placement.updateLayerOpacities(q,B[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(I.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,h){return s._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[h.source];return b&&b.setDependencies(h.tileID.key,h.type,h.icons),_})}getGlyphs(a,h){return s._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(h.stacks),b=this.sourceCaches[h.source];return b&&b.setDependencies(h.tileID.key,h.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a,h={}){this._checkLoaded(),a&&this._validate(s.y.glyphs,"glyphs",a,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,h,_={},b){this._checkLoaded();const A=[{id:a,url:h}],C=[...Y(this.stylesheet.sprite),...A];this._validate(s.y.sprite,"sprite",C,null,_)||(this.stylesheet.sprite=C,this._loadSprite(A,!0,b))}removeSprite(a){this._checkLoaded();const h=Y(this.stylesheet.sprite);if(h.find(_=>_.id===a)){if(this._spritesImagesIds[a])for(const _ of this._spritesImagesIds[a])this.imageManager.removeImage(_),this._changedImages[_]=!0;h.splice(h.findIndex(_=>_.id===a),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return Y(this.stylesheet.sprite)}setSprite(a,h={},_){this._checkLoaded(),a&&this._validate(s.y.sprite,"sprite",a,null,h)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,_):(this._unloadSprite(),_&&_(null)))}}var Pd=s.aG([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Js{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,h,_,b,A,C,D,B,j){this.context=a;let q=this.boundPaintVertexBuffers.length!==b.length;for(let X=0;!q&&X<b.length;X++)this.boundPaintVertexBuffers[X]!==b[X]&&(q=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||q||this.boundIndexBuffer!==A||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==j?this.freshBind(h,_,b,A,C,D,B,j):(a.bindVertexArray.set(this.vao),D&&D.bind(),A&&A.dynamicDraw&&A.bind(),B&&B.bind(),j&&j.bind())}freshBind(a,h,_,b,A,C,D,B){const j=a.numAttributes,q=this.context,X=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=b,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=B,h.enableAttributes(X,a);for(const G of _)G.enableAttributes(X,a);C&&C.enableAttributes(X,a),D&&D.enableAttributes(X,a),B&&B.enableAttributes(X,a),h.bind(),h.setVertexAttribPointers(X,a,A);for(const G of _)G.bind(),G.setVertexAttribPointers(X,a,A);C&&(C.bind(),C.setVertexAttribPointers(X,a,A)),b&&b.bind(),D&&(D.bind(),D.setVertexAttribPointers(X,a,A)),B&&(B.bind(),B.setVertexAttribPointers(X,a,A)),q.currentNumAttributes=j}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const T_=(T,a,h,_,b)=>({u_texture:0,u_ele_delta:T,u_fog_matrix:a,u_fog_color:h?h.properties.get("fog-color"):s.b7.white,u_fog_ground_blend:h?h.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:b?0:h?h.calculateFogBlendOpacity(_):0,u_horizon_color:h?h.properties.get("horizon-color"):s.b7.white,u_horizon_fog_blend:h?h.properties.get("horizon-fog-blend"):1,u_is_globe_mode:b?1:0}),Cd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function ll(T){const a=[];for(let h=0;h<T.length;h++){if(T[h]===null)continue;const _=T[h].split(" ");a.push(_.pop())}return a}class Wu{constructor(a,h,_,b,A,C,D,B){const j=a.gl;this.program=j.createProgram();const q=ll(h.staticAttributes),X=_?_.getBinderAttributes():[],G=q.concat(X),ae=kr.prelude.staticUniforms?ll(kr.prelude.staticUniforms):[],se=D.staticUniforms?ll(D.staticUniforms):[],ve=h.staticUniforms?ll(h.staticUniforms):[],_e=_?_.getBinderUniforms():[],xe=ae.concat(se).concat(ve).concat(_e),Ae=[];for(const lt of xe)Ae.indexOf(lt)<0&&Ae.push(lt);const Oe=_?_.defines():[];Yi(j)&&Oe.unshift("#version 300 es"),A&&Oe.push("#define OVERDRAW_INSPECTOR;"),C&&Oe.push("#define TERRAIN3D;"),B&&Oe.push(B);let ke=Oe.concat(kr.prelude.fragmentSource,D.fragmentSource,h.fragmentSource).join(`
`),Be=Oe.concat(kr.prelude.vertexSource,D.vertexSource,h.vertexSource).join(`
`);Yi(j)||(ke=function(lt){return lt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ke),Be=function(lt){return lt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Be));const je=j.createShader(j.FRAGMENT_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(je,ke),j.compileShader(je),!j.getShaderParameter(je,j.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${j.getShaderInfoLog(je)}`);j.attachShader(this.program,je);const Le=j.createShader(j.VERTEX_SHADER);if(j.isContextLost())return void(this.failedToCreate=!0);if(j.shaderSource(Le,Be),j.compileShader(Le),!j.getShaderParameter(Le,j.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${j.getShaderInfoLog(Le)}`);j.attachShader(this.program,Le),this.attributes={};const nt={};this.numAttributes=G.length;for(let lt=0;lt<this.numAttributes;lt++)G[lt]&&(j.bindAttribLocation(this.program,lt,G[lt]),this.attributes[G[lt]]=lt);if(j.linkProgram(this.program),!j.getProgramParameter(this.program,j.LINK_STATUS))throw new Error(`Program failed to link: ${j.getProgramInfoLog(this.program)}`);j.deleteShader(Le),j.deleteShader(je);for(let lt=0;lt<Ae.length;lt++){const At=Ae[lt];if(At&&!nt[At]){const St=j.getUniformLocation(this.program,At);St&&(nt[At]=St)}}this.fixedUniforms=b(a,nt),this.terrainUniforms=((lt,At)=>({u_depth:new s.bH(lt,At.u_depth),u_terrain:new s.bH(lt,At.u_terrain),u_terrain_dim:new s.b8(lt,At.u_terrain_dim),u_terrain_matrix:new s.bJ(lt,At.u_terrain_matrix),u_terrain_unpack:new s.bK(lt,At.u_terrain_unpack),u_terrain_exaggeration:new s.b8(lt,At.u_terrain_exaggeration)}))(a,nt),this.projectionUniforms=((lt,At)=>({u_projection_matrix:new s.bJ(lt,At.u_projection_matrix),u_projection_tile_mercator_coords:new s.bK(lt,At.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bK(lt,At.u_projection_clipping_plane),u_projection_transition:new s.b8(lt,At.u_projection_transition),u_projection_fallback_matrix:new s.bJ(lt,At.u_projection_fallback_matrix)}))(a,nt),this.binderUniforms=_?_.getUniforms(a,nt):[]}draw(a,h,_,b,A,C,D,B,j,q,X,G,ae,se,ve,_e,xe,Ae,Oe){const ke=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(b),a.setColorMode(A),a.setCullFace(C),B){a.activeTexture.set(ke.TEXTURE2),ke.bindTexture(ke.TEXTURE_2D,B.depthTexture),a.activeTexture.set(ke.TEXTURE3),ke.bindTexture(ke.TEXTURE_2D,B.texture);for(const je in this.terrainUniforms)this.terrainUniforms[je].set(B[je])}if(j)for(const je in j)this.projectionUniforms[Cd[je]].set(j[je]);if(D)for(const je in this.fixedUniforms)this.fixedUniforms[je].set(D[je]);_e&&_e.setUniforms(a,this.binderUniforms,se,{zoom:ve});let Be=0;switch(h){case ke.LINES:Be=2;break;case ke.TRIANGLES:Be=3;break;case ke.LINE_STRIP:Be=1}for(const je of ae.get()){const Le=je.vaos||(je.vaos={});(Le[q]||(Le[q]=new Js)).bind(a,this,X,_e?_e.getPaintVertexBuffers():[],G,je.vertexOffset,xe,Ae,Oe),ke.drawElements(h,je.primitiveLength*Be,ke.UNSIGNED_SHORT,je.primitiveOffset*Be*2)}}}function hm(T,a,h){const _=1/s.az(h,1,a.transform.tileZoom),b=Math.pow(2,h.tileID.overscaledZ),A=h.tileSize*Math.pow(2,a.transform.tileZoom)/b,C=A*(h.tileID.canonical.x+h.tileID.wrap*b),D=A*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,T.fromScale,T.toScale],u_fade:T.t,u_pixel_coord_upper:[C>>16,D>>16],u_pixel_coord_lower:[65535&C,65535&D]}}const Zu=(T,a,h,_)=>{const b=T.style.light,A=b.properties.get("position"),C=[A.x,A.y,A.z],D=s.bN();b.properties.get("anchor")==="viewport"&&s.bO(D,T.transform.bearingInRadians),s.bP(C,C,D);const B=T.transform.transformLightDirection(C),j=b.properties.get("color");return{u_lightpos:C,u_lightpos_globe:B,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+a,u_opacity:h,u_fill_translate:_}},Rd=(T,a,h,_,b,A,C)=>s.e(Zu(T,a,h,_),hm(A,T,C),{u_height_factor:-Math.pow(2,b.overscaledZ)/C.tileSize/8}),Ds=(T,a,h,_)=>s.e(hm(a,T,h),{u_fill_translate:_}),S_=(T,a)=>({u_world:T,u_fill_translate:a}),Id=(T,a,h,_,b)=>s.e(Ds(T,a,h,b),{u_world:_}),fm=(T,a,h,_,b)=>{const A=T.transform;let C,D,B=0;if(h.paint.get("circle-pitch-alignment")==="map"){const j=s.az(a,1,A.zoom);C=!0,D=[j,j],B=j/(s.Z*Math.pow(2,a.tileID.overscaledZ))*2*Math.PI*b}else C=!1,D=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+C,u_device_pixel_ratio:T.pixelRatio,u_extrude_scale:D,u_globe_extrude_scale:B,u_translate:_}},Od=T=>({u_pixel_extrude_scale:[1/T.width,1/T.height]}),lf=T=>({u_viewport_size:[T.width,T.height]}),cf=(T,a=1)=>({u_color:T,u_overlay:0,u_overlay_scale:a}),cl=(T,a,h,_)=>{const b=s.az(T,1,a)/(s.Z*Math.pow(2,T.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:s.az(T,1,a),u_intensity:h,u_globe_extrude_scale:b}},kd=(T,a,h,_)=>{const b=s.K();s.bQ(b,0,T.width,T.height,0,0,1);const A=T.context.gl;return{u_matrix:b,u_world:[A.drawingBufferWidth,A.drawingBufferHeight],u_image:h,u_color_ramp:_,u_opacity:a.paint.get("heatmap-opacity")}},dm=(T,a,h)=>{const _=h.paint.get("hillshade-shadow-color"),b=h.paint.get("hillshade-highlight-color"),A=h.paint.get("hillshade-accent-color");let C=h.paint.get("hillshade-illumination-direction")*(Math.PI/180);return h.paint.get("hillshade-illumination-anchor")==="viewport"&&(C+=T.transform.bearingInRadians),{u_image:0,u_latrange:Dd(0,a.tileID),u_light:[h.paint.get("hillshade-exaggeration"),C],u_shadow:_,u_highlight:b,u_accent:A}},sc=(T,a)=>{const h=a.stride,_=s.K();return s.bQ(_,0,s.Z,-8192,0,0,1),s.L(_,_,[0,-8192,0]),{u_matrix:_,u_image:1,u_dimension:[h,h],u_zoom:T.overscaledZ,u_unpack:a.getUnpackVector()}};function Dd(T,a){const h=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new s.$(0,_/h).toLngLat().lat,new s.$(0,(_+1)/h).toLngLat().lat]}const Xu=(T,a,h,_)=>{const b=T.transform;return{u_translation:Nd(T,a,h),u_ratio:_/s.az(a,1,b.zoom),u_device_pixel_ratio:T.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},So=(T,a,h,_,b)=>s.e(Xu(T,a,h,_),{u_image:0,u_image_height:b}),Gu=(T,a,h,_,b)=>{const A=T.transform,C=Yu(a,A);return{u_translation:Nd(T,a,h),u_texsize:a.imageAtlasTexture.size,u_ratio:_/s.az(a,1,A.zoom),u_device_pixel_ratio:T.pixelRatio,u_image:0,u_scale:[C,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},uf=(T,a,h,_,b,A)=>{const C=T.lineAtlas,D=Yu(a,T.transform),B=h.layout.get("line-cap")==="round",j=C.getDash(b.from,B),q=C.getDash(b.to,B),X=j.width*A.fromScale,G=q.width*A.toScale;return s.e(Xu(T,a,h,_),{u_patternscale_a:[D/X,-j.height/2],u_patternscale_b:[D/G,-q.height/2],u_sdfgamma:C.width/(256*Math.min(X,G)*T.pixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:q.y,u_mix:A.t})};function Yu(T,a){return 1/s.az(T,1,a.tileZoom)}function Nd(T,a,h){return s.aA(T.transform,a,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Bd=(T,a,h,_,b)=>{return{u_tl_parent:T,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(C=_.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(A=_.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:hf(_.paint.get("raster-hue-rotate")),u_coords_top:[b[0].x,b[0].y,b[1].x,b[1].y],u_coords_bottom:[b[3].x,b[3].y,b[2].x,b[2].y]};var A,C};function hf(T){T*=Math.PI/180;const a=Math.sin(T),h=Math.cos(T);return[(2*h+1)/3,(-Math.sqrt(3)*a-h+1)/3,(Math.sqrt(3)*a-h+1)/3]}const Ku=(T,a,h,_,b,A,C,D,B,j,q,X,G)=>{const ae=C.transform;return{u_is_size_zoom_constant:+(T==="constant"||T==="source"),u_is_size_feature_constant:+(T==="constant"||T==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_pitch:ae.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ae.width/ae.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_label_plane_matrix:D,u_coord_matrix:B,u_is_text:+q,u_pitch_with_map:+_,u_is_along_line:b,u_is_variable_anchor:A,u_texsize:X,u_texture:0,u_translation:j,u_pitched_scale:G}},Qu=(T,a,h,_,b,A,C,D,B,j,q,X,G,ae)=>{const se=C.transform;return s.e(Ku(T,a,h,_,b,A,C,D,B,j,q,X,ae),{u_gamma_scale:_?Math.cos(se.pitch*Math.PI/180)*se.cameraToCenterDistance:1,u_device_pixel_ratio:C.pixelRatio,u_is_halo:1})},Ld=(T,a,h,_,b,A,C,D,B,j,q,X,G)=>s.e(Qu(T,a,h,_,b,A,C,D,B,j,!0,q,0,G),{u_texsize_icon:X,u_texture_icon:1}),Ju=(T,a)=>({u_opacity:T,u_color:a}),Ao=(T,a,h,_,b)=>s.e(function(A,C,D,B){const j=D.imageManager.getPattern(A.from.toString()),q=D.imageManager.getPattern(A.to.toString()),{width:X,height:G}=D.imageManager.getPixelSize(),ae=Math.pow(2,B.tileID.overscaledZ),se=B.tileSize*Math.pow(2,D.transform.tileZoom)/ae,ve=se*(B.tileID.canonical.x+B.tileID.wrap*ae),_e=se*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[X,G],u_mix:C.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/s.az(B,1,D.transform.tileZoom),u_pixel_coord_upper:[ve>>16,_e>>16],u_pixel_coord_lower:[65535&ve,65535&_e]}}(h,b,a,_),{u_opacity:T}),ff=(T,a)=>{},Fd={fillExtrusion:(T,a)=>({u_lightpos:new s.bL(T,a.u_lightpos),u_lightpos_globe:new s.bL(T,a.u_lightpos_globe),u_lightintensity:new s.b8(T,a.u_lightintensity),u_lightcolor:new s.bL(T,a.u_lightcolor),u_vertical_gradient:new s.b8(T,a.u_vertical_gradient),u_opacity:new s.b8(T,a.u_opacity),u_fill_translate:new s.bM(T,a.u_fill_translate)}),fillExtrusionPattern:(T,a)=>({u_lightpos:new s.bL(T,a.u_lightpos),u_lightpos_globe:new s.bL(T,a.u_lightpos_globe),u_lightintensity:new s.b8(T,a.u_lightintensity),u_lightcolor:new s.bL(T,a.u_lightcolor),u_vertical_gradient:new s.b8(T,a.u_vertical_gradient),u_height_factor:new s.b8(T,a.u_height_factor),u_opacity:new s.b8(T,a.u_opacity),u_fill_translate:new s.bM(T,a.u_fill_translate),u_image:new s.bH(T,a.u_image),u_texsize:new s.bM(T,a.u_texsize),u_pixel_coord_upper:new s.bM(T,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.bM(T,a.u_pixel_coord_lower),u_scale:new s.bL(T,a.u_scale),u_fade:new s.b8(T,a.u_fade)}),fill:(T,a)=>({u_fill_translate:new s.bM(T,a.u_fill_translate)}),fillPattern:(T,a)=>({u_image:new s.bH(T,a.u_image),u_texsize:new s.bM(T,a.u_texsize),u_pixel_coord_upper:new s.bM(T,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.bM(T,a.u_pixel_coord_lower),u_scale:new s.bL(T,a.u_scale),u_fade:new s.b8(T,a.u_fade),u_fill_translate:new s.bM(T,a.u_fill_translate)}),fillOutline:(T,a)=>({u_world:new s.bM(T,a.u_world),u_fill_translate:new s.bM(T,a.u_fill_translate)}),fillOutlinePattern:(T,a)=>({u_world:new s.bM(T,a.u_world),u_image:new s.bH(T,a.u_image),u_texsize:new s.bM(T,a.u_texsize),u_pixel_coord_upper:new s.bM(T,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.bM(T,a.u_pixel_coord_lower),u_scale:new s.bL(T,a.u_scale),u_fade:new s.b8(T,a.u_fade),u_fill_translate:new s.bM(T,a.u_fill_translate)}),circle:(T,a)=>({u_camera_to_center_distance:new s.b8(T,a.u_camera_to_center_distance),u_scale_with_map:new s.bH(T,a.u_scale_with_map),u_pitch_with_map:new s.bH(T,a.u_pitch_with_map),u_extrude_scale:new s.bM(T,a.u_extrude_scale),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_globe_extrude_scale:new s.b8(T,a.u_globe_extrude_scale),u_translate:new s.bM(T,a.u_translate)}),collisionBox:(T,a)=>({u_pixel_extrude_scale:new s.bM(T,a.u_pixel_extrude_scale)}),collisionCircle:(T,a)=>({u_viewport_size:new s.bM(T,a.u_viewport_size)}),debug:(T,a)=>({u_color:new s.bI(T,a.u_color),u_overlay:new s.bH(T,a.u_overlay),u_overlay_scale:new s.b8(T,a.u_overlay_scale)}),depth:ff,clippingMask:ff,heatmap:(T,a)=>({u_extrude_scale:new s.b8(T,a.u_extrude_scale),u_intensity:new s.b8(T,a.u_intensity),u_globe_extrude_scale:new s.b8(T,a.u_globe_extrude_scale)}),heatmapTexture:(T,a)=>({u_matrix:new s.bJ(T,a.u_matrix),u_world:new s.bM(T,a.u_world),u_image:new s.bH(T,a.u_image),u_color_ramp:new s.bH(T,a.u_color_ramp),u_opacity:new s.b8(T,a.u_opacity)}),hillshade:(T,a)=>({u_image:new s.bH(T,a.u_image),u_latrange:new s.bM(T,a.u_latrange),u_light:new s.bM(T,a.u_light),u_shadow:new s.bI(T,a.u_shadow),u_highlight:new s.bI(T,a.u_highlight),u_accent:new s.bI(T,a.u_accent)}),hillshadePrepare:(T,a)=>({u_matrix:new s.bJ(T,a.u_matrix),u_image:new s.bH(T,a.u_image),u_dimension:new s.bM(T,a.u_dimension),u_zoom:new s.b8(T,a.u_zoom),u_unpack:new s.bK(T,a.u_unpack)}),line:(T,a)=>({u_translation:new s.bM(T,a.u_translation),u_ratio:new s.b8(T,a.u_ratio),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_units_to_pixels:new s.bM(T,a.u_units_to_pixels)}),lineGradient:(T,a)=>({u_translation:new s.bM(T,a.u_translation),u_ratio:new s.b8(T,a.u_ratio),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_units_to_pixels:new s.bM(T,a.u_units_to_pixels),u_image:new s.bH(T,a.u_image),u_image_height:new s.b8(T,a.u_image_height)}),linePattern:(T,a)=>({u_translation:new s.bM(T,a.u_translation),u_texsize:new s.bM(T,a.u_texsize),u_ratio:new s.b8(T,a.u_ratio),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_image:new s.bH(T,a.u_image),u_units_to_pixels:new s.bM(T,a.u_units_to_pixels),u_scale:new s.bL(T,a.u_scale),u_fade:new s.b8(T,a.u_fade)}),lineSDF:(T,a)=>({u_translation:new s.bM(T,a.u_translation),u_ratio:new s.b8(T,a.u_ratio),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_units_to_pixels:new s.bM(T,a.u_units_to_pixels),u_patternscale_a:new s.bM(T,a.u_patternscale_a),u_patternscale_b:new s.bM(T,a.u_patternscale_b),u_sdfgamma:new s.b8(T,a.u_sdfgamma),u_image:new s.bH(T,a.u_image),u_tex_y_a:new s.b8(T,a.u_tex_y_a),u_tex_y_b:new s.b8(T,a.u_tex_y_b),u_mix:new s.b8(T,a.u_mix)}),raster:(T,a)=>({u_tl_parent:new s.bM(T,a.u_tl_parent),u_scale_parent:new s.b8(T,a.u_scale_parent),u_buffer_scale:new s.b8(T,a.u_buffer_scale),u_fade_t:new s.b8(T,a.u_fade_t),u_opacity:new s.b8(T,a.u_opacity),u_image0:new s.bH(T,a.u_image0),u_image1:new s.bH(T,a.u_image1),u_brightness_low:new s.b8(T,a.u_brightness_low),u_brightness_high:new s.b8(T,a.u_brightness_high),u_saturation_factor:new s.b8(T,a.u_saturation_factor),u_contrast_factor:new s.b8(T,a.u_contrast_factor),u_spin_weights:new s.bL(T,a.u_spin_weights),u_coords_top:new s.bK(T,a.u_coords_top),u_coords_bottom:new s.bK(T,a.u_coords_bottom)}),symbolIcon:(T,a)=>({u_is_size_zoom_constant:new s.bH(T,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bH(T,a.u_is_size_feature_constant),u_size_t:new s.b8(T,a.u_size_t),u_size:new s.b8(T,a.u_size),u_camera_to_center_distance:new s.b8(T,a.u_camera_to_center_distance),u_pitch:new s.b8(T,a.u_pitch),u_rotate_symbol:new s.bH(T,a.u_rotate_symbol),u_aspect_ratio:new s.b8(T,a.u_aspect_ratio),u_fade_change:new s.b8(T,a.u_fade_change),u_label_plane_matrix:new s.bJ(T,a.u_label_plane_matrix),u_coord_matrix:new s.bJ(T,a.u_coord_matrix),u_is_text:new s.bH(T,a.u_is_text),u_pitch_with_map:new s.bH(T,a.u_pitch_with_map),u_is_along_line:new s.bH(T,a.u_is_along_line),u_is_variable_anchor:new s.bH(T,a.u_is_variable_anchor),u_texsize:new s.bM(T,a.u_texsize),u_texture:new s.bH(T,a.u_texture),u_translation:new s.bM(T,a.u_translation),u_pitched_scale:new s.b8(T,a.u_pitched_scale)}),symbolSDF:(T,a)=>({u_is_size_zoom_constant:new s.bH(T,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bH(T,a.u_is_size_feature_constant),u_size_t:new s.b8(T,a.u_size_t),u_size:new s.b8(T,a.u_size),u_camera_to_center_distance:new s.b8(T,a.u_camera_to_center_distance),u_pitch:new s.b8(T,a.u_pitch),u_rotate_symbol:new s.bH(T,a.u_rotate_symbol),u_aspect_ratio:new s.b8(T,a.u_aspect_ratio),u_fade_change:new s.b8(T,a.u_fade_change),u_label_plane_matrix:new s.bJ(T,a.u_label_plane_matrix),u_coord_matrix:new s.bJ(T,a.u_coord_matrix),u_is_text:new s.bH(T,a.u_is_text),u_pitch_with_map:new s.bH(T,a.u_pitch_with_map),u_is_along_line:new s.bH(T,a.u_is_along_line),u_is_variable_anchor:new s.bH(T,a.u_is_variable_anchor),u_texsize:new s.bM(T,a.u_texsize),u_texture:new s.bH(T,a.u_texture),u_gamma_scale:new s.b8(T,a.u_gamma_scale),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_is_halo:new s.bH(T,a.u_is_halo),u_translation:new s.bM(T,a.u_translation),u_pitched_scale:new s.b8(T,a.u_pitched_scale)}),symbolTextAndIcon:(T,a)=>({u_is_size_zoom_constant:new s.bH(T,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bH(T,a.u_is_size_feature_constant),u_size_t:new s.b8(T,a.u_size_t),u_size:new s.b8(T,a.u_size),u_camera_to_center_distance:new s.b8(T,a.u_camera_to_center_distance),u_pitch:new s.b8(T,a.u_pitch),u_rotate_symbol:new s.bH(T,a.u_rotate_symbol),u_aspect_ratio:new s.b8(T,a.u_aspect_ratio),u_fade_change:new s.b8(T,a.u_fade_change),u_label_plane_matrix:new s.bJ(T,a.u_label_plane_matrix),u_coord_matrix:new s.bJ(T,a.u_coord_matrix),u_is_text:new s.bH(T,a.u_is_text),u_pitch_with_map:new s.bH(T,a.u_pitch_with_map),u_is_along_line:new s.bH(T,a.u_is_along_line),u_is_variable_anchor:new s.bH(T,a.u_is_variable_anchor),u_texsize:new s.bM(T,a.u_texsize),u_texsize_icon:new s.bM(T,a.u_texsize_icon),u_texture:new s.bH(T,a.u_texture),u_texture_icon:new s.bH(T,a.u_texture_icon),u_gamma_scale:new s.b8(T,a.u_gamma_scale),u_device_pixel_ratio:new s.b8(T,a.u_device_pixel_ratio),u_is_halo:new s.bH(T,a.u_is_halo),u_translation:new s.bM(T,a.u_translation),u_pitched_scale:new s.b8(T,a.u_pitched_scale)}),background:(T,a)=>({u_opacity:new s.b8(T,a.u_opacity),u_color:new s.bI(T,a.u_color)}),backgroundPattern:(T,a)=>({u_opacity:new s.b8(T,a.u_opacity),u_image:new s.bH(T,a.u_image),u_pattern_tl_a:new s.bM(T,a.u_pattern_tl_a),u_pattern_br_a:new s.bM(T,a.u_pattern_br_a),u_pattern_tl_b:new s.bM(T,a.u_pattern_tl_b),u_pattern_br_b:new s.bM(T,a.u_pattern_br_b),u_texsize:new s.bM(T,a.u_texsize),u_mix:new s.b8(T,a.u_mix),u_pattern_size_a:new s.bM(T,a.u_pattern_size_a),u_pattern_size_b:new s.bM(T,a.u_pattern_size_b),u_scale_a:new s.b8(T,a.u_scale_a),u_scale_b:new s.b8(T,a.u_scale_b),u_pixel_coord_upper:new s.bM(T,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.bM(T,a.u_pixel_coord_lower),u_tile_units_to_pixels:new s.b8(T,a.u_tile_units_to_pixels)}),terrain:(T,a)=>({u_texture:new s.bH(T,a.u_texture),u_ele_delta:new s.b8(T,a.u_ele_delta),u_fog_matrix:new s.bJ(T,a.u_fog_matrix),u_fog_color:new s.bI(T,a.u_fog_color),u_fog_ground_blend:new s.b8(T,a.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.b8(T,a.u_fog_ground_blend_opacity),u_horizon_color:new s.bI(T,a.u_horizon_color),u_horizon_fog_blend:new s.b8(T,a.u_horizon_fog_blend),u_is_globe_mode:new s.b8(T,a.u_is_globe_mode)}),terrainDepth:(T,a)=>({u_ele_delta:new s.b8(T,a.u_ele_delta)}),terrainCoords:(T,a)=>({u_texture:new s.bH(T,a.u_texture),u_terrain_coords_id:new s.b8(T,a.u_terrain_coords_id),u_ele_delta:new s.b8(T,a.u_ele_delta)}),projectionErrorMeasurement:(T,a)=>({u_input:new s.b8(T,a.u_input),u_output_expected:new s.b8(T,a.u_output_expected)}),atmosphere:(T,a)=>({u_sun_pos:new s.bL(T,a.u_sun_pos),u_atmosphere_blend:new s.b8(T,a.u_atmosphere_blend),u_globe_position:new s.bL(T,a.u_globe_position),u_globe_radius:new s.b8(T,a.u_globe_radius),u_inv_proj_matrix:new s.bJ(T,a.u_inv_proj_matrix)}),sky:(T,a)=>({u_sky_color:new s.bI(T,a.u_sky_color),u_horizon_color:new s.bI(T,a.u_horizon_color),u_horizon:new s.bM(T,a.u_horizon),u_horizon_normal:new s.bM(T,a.u_horizon_normal),u_sky_horizon_blend:new s.b8(T,a.u_sky_horizon_blend),u_sky_blend:new s.b8(T,a.u_sky_blend)})};class zd{constructor(a,h,_){this.context=a;const b=a.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const pm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sa{constructor(a,h,_,b){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=b,this.context=a;const A=a.gl;this.buffer=A.createBuffer(),a.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,h){for(let _=0;_<this.attributes.length;_++){const b=h.attributes[this.attributes[_].name];b!==void 0&&a.enableVertexAttribArray(b)}}setVertexAttribPointers(a,h,_){for(let b=0;b<this.attributes.length;b++){const A=this.attributes[b],C=h.attributes[A.name];C!==void 0&&a.vertexAttribPointer(C,A.components,a[pm[A.type]],!1,this.itemSize,A.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class df extends Dr{getDefault(){return s.b7.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class mm extends Dr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class gm extends Dr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class _m extends Dr{getDefault(){return[!0,!0,!0,!0]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class jd extends Dr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class ym extends Dr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class tu extends Dr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class pf extends Dr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class ul extends Dr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}}class ru extends Dr{getDefault(){return[0,1]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class eh extends Dr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}}class Eo extends Dr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class vs extends Dr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}}class hl extends Dr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class ts extends Dr{getDefault(){return s.b7.transparent}set(a){const h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class fl extends Dr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ud extends Dr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}}class mf extends Dr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class dl extends Dr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class gf extends Dr{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class _f extends Dr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class th extends Dr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class rh extends Dr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class $d extends Dr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class pl extends Dr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ha extends Dr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Vd extends Dr{getDefault(){return null}set(a){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ua extends Dr{getDefault(){return null}set(a){var h;if(a===this.current&&!this.dirty)return;const _=this.gl;Yi(_)?_.bindVertexArray(a):(h=_.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class Mr extends Dr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class Mo extends Dr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class qd extends Dr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class oc extends Dr{constructor(a,h){super(a),this.context=a,this.parent=h}getDefault(){return null}}class ml extends oc{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Hd extends oc{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class nu extends oc{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}}const yf="Framebuffer is not complete";class vf{constructor(a,h,_,b,A){this.context=a,this.width=h,this.height=_;const C=a.gl,D=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new ml(a,D),b)this.depthAttachment=A?new nu(a,D):new Hd(a,D);else if(A)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error(yf)}destroy(){const a=this.context.gl,h=this.colorAttachment.get();if(h&&a.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class gl{constructor(a){var h,_;if(this.gl=a,this.clearColor=new df(this),this.clearDepth=new mm(this),this.clearStencil=new gm(this),this.colorMask=new _m(this),this.depthMask=new jd(this),this.stencilMask=new ym(this),this.stencilFunc=new tu(this),this.stencilOp=new pf(this),this.stencilTest=new ul(this),this.depthRange=new ru(this),this.depthTest=new eh(this),this.depthFunc=new Eo(this),this.blend=new vs(this),this.blendFunc=new hl(this),this.blendColor=new ts(this),this.blendEquation=new fl(this),this.cullFace=new Ud(this),this.cullFaceSide=new mf(this),this.frontFace=new dl(this),this.program=new gf(this),this.activeTexture=new _f(this),this.viewport=new th(this),this.bindFramebuffer=new rh(this),this.bindRenderbuffer=new $d(this),this.bindTexture=new pl(this),this.bindVertexBuffer=new ha(this),this.bindElementBuffer=new Vd(this),this.bindVertexArray=new Ua(this),this.pixelStoreUnpack=new Mr(this),this.pixelStoreUnpackPremultiplyAlpha=new Mo(this),this.pixelStoreUnpackFlipY=new qd(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),Yi(a)){this.HALF_FLOAT=a.HALF_FLOAT;const b=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=a.RGBA16F)!==null&&h!==void 0?h:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(_=a.RGB16F)!==null&&_!==void 0?_:b==null?void 0:b.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const b=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,h){return new zd(this,a,h)}createVertexBuffer(a,h,_){return new Sa(this,a,h,_)}createRenderbuffer(a,h,_){const b=this.gl,A=b.createRenderbuffer();return this.bindRenderbuffer.set(A),b.renderbufferStorage(b.RENDERBUFFER,a,h,_),this.bindRenderbuffer.set(null),A}createFramebuffer(a,h,_,b){return new vf(this,a,h,_,b)}clear({color:a,depth:h,stencil:_}){const b=this.gl;let A=0;a&&(A|=b.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(A|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(A|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),b.clear(A)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.bE(a.blendFunction,Gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return Yi(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var h;return Yi(this.gl)?this.gl.deleteVertexArray(a):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}let lc;function Ki(T,a,h,_,b){const A=T.context,C=T.transform,D=A.gl,B=T.useProgram("collisionBox"),j=[];let q=0,X=0;for(let xe=0;xe<_.length;xe++){const Ae=_[xe],Oe=a.getTile(Ae).getBucket(h);if(!Oe)continue;const ke=b?Oe.textCollisionBox:Oe.iconCollisionBox,Be=Oe.collisionCircleArray;Be.length>0&&(j.push({circleArray:Be,circleOffset:X,coord:Ae}),q+=Be.length/4,X=q),ke&&B.draw(A,D.LINES,Ar.disabled,$r.disabled,T.colorModeForRenderPass(),Hr.disabled,Od(T.transform),T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ae),C.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),h.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,T.transform.zoom,null,null,ke.collisionVertexBuffer)}if(!b||!j.length)return;const G=T.useProgram("collisionCircle"),ae=new s.bR;ae.resize(4*q),ae._trim();let se=0;for(const xe of j)for(let Ae=0;Ae<xe.circleArray.length/4;Ae++){const Oe=4*Ae,ke=xe.circleArray[Oe+0],Be=xe.circleArray[Oe+1],je=xe.circleArray[Oe+2],Le=xe.circleArray[Oe+3];ae.emplace(se++,ke,Be,je,Le,0),ae.emplace(se++,ke,Be,je,Le,1),ae.emplace(se++,ke,Be,je,Le,2),ae.emplace(se++,ke,Be,je,Le,3)}(!lc||lc.length<2*q)&&(lc=function(xe){const Ae=2*xe,Oe=new s.bT;Oe.resize(Ae),Oe._trim();for(let ke=0;ke<Ae;ke++){const Be=6*ke;Oe.uint16[Be+0]=4*ke+0,Oe.uint16[Be+1]=4*ke+1,Oe.uint16[Be+2]=4*ke+2,Oe.uint16[Be+3]=4*ke+2,Oe.uint16[Be+4]=4*ke+3,Oe.uint16[Be+5]=4*ke+0}return Oe}(q));const ve=A.createIndexBuffer(lc,!0),_e=A.createVertexBuffer(ae,s.bS.members,!0);for(const xe of j){const Ae=lf(T.transform);G.draw(A,D.TRIANGLES,Ar.disabled,$r.disabled,T.colorModeForRenderPass(),Hr.disabled,Ae,T.style.map.terrain&&T.style.map.terrain.getTerrainData(xe.coord),null,h.id,_e,ve,s.aJ.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,T.transform.zoom,null,null,null)}_e.destroy(),ve.destroy()}const nh=s.ad(new Float32Array(16));function Ns(T,a,h,_,b,A){const{horizontalAlign:C,verticalAlign:D}=s.aE(T);return new s.P((-(C-.5)*a/b+_[0])*A,(-(D-.5)*h/b+_[1])*A)}function Wd(T,a,h,_,b,A){const C=a.tileAnchorPoint.add(new s.P(a.translation[0],a.translation[1]));if(a.pitchWithMap){let D=_.mult(A);h||(D=D.rotate(-b));const B=C.add(D);return vr(B.x,B.y,a.pitchedLabelPlaneMatrix,a.getElevation).point}if(h){const D=on(a.tileAnchorPoint.x+1,a.tileAnchorPoint.y,a).point.sub(T),B=Math.atan(D.y/D.x)+(D.x<0?Math.PI:0);return T.add(_.rotate(B))}return T.add(_)}function cc(T,a,h,_,b,A,C,D,B,j,q,X){const G=T.text.placedSymbolArray,ae=T.text.dynamicLayoutVertexArray,se=T.icon.dynamicLayoutVertexArray,ve={};ae.clear();for(let _e=0;_e<G.length;_e++){const xe=G.get(_e),Ae=xe.hidden||!xe.crossTileID||T.allowVerticalPlacement&&!xe.placedOrientation?null:_[xe.crossTileID];if(Ae){const Oe=new s.P(xe.anchorX,xe.anchorY),ke={getElevation:X,width:b.width,height:b.height,pitchedLabelPlaneMatrix:A,pitchWithMap:h,transform:b,tileAnchorPoint:Oe,translation:j,unwrappedTileID:q},Be=h?ni(Oe.x,Oe.y,ke):on(Oe.x,Oe.y,ke),je=jr(b.cameraToCenterDistance,Be.signedDistanceFromCamera);let Le=s.am(T.textSizeData,D,xe)*je/s.ay;h&&(Le*=T.tilePixelRatio/C);const{width:nt,height:lt,anchor:At,textOffset:St,textBoxScale:Tt}=Ae,Wt=Ns(At,nt,lt,St,Tt,Le),Ht=b.getPitchedTextCorrection(Oe.x+j[0],Oe.y+j[1],q),Rt=Wd(Be.point,ke,a,Wt,-b.bearingInRadians,Ht),lr=T.allowVerticalPlacement&&xe.placedOrientation===s.al.vertical?Math.PI/2:0;for(let Ir=0;Ir<xe.numGlyphs;Ir++)s.as(ae,Rt,lr);B&&xe.associatedIconIndex>=0&&(ve[xe.associatedIconIndex]={shiftedAnchor:Rt,angle:lr})}else Ni(xe.numGlyphs,ae)}if(B){se.clear();const _e=T.icon.placedSymbolArray;for(let xe=0;xe<_e.length;xe++){const Ae=_e.get(xe);if(Ae.hidden)Ni(Ae.numGlyphs,se);else{const Oe=ve[xe];if(Oe)for(let ke=0;ke<Ae.numGlyphs;ke++)s.as(se,Oe.shiftedAnchor,Oe.angle);else Ni(Ae.numGlyphs,se)}}T.icon.dynamicLayoutVertexBuffer.updateData(se)}T.text.dynamicLayoutVertexBuffer.updateData(ae)}function eo(T,a,h){return h.iconsInText&&a?"symbolTextAndIcon":T?"symbolSDF":"symbolIcon"}function iu(T,a,h,_,b,A,C,D,B,j,q,X,G){const ae=T.context,se=ae.gl,ve=T.transform,_e=D==="map",xe=B==="map",Ae=D!=="viewport"&&h.layout.get("symbol-placement")!=="point",Oe=_e&&!xe&&!Ae,ke=!h.layout.get("symbol-sort-key").isConstant();let Be=!1;const je=T.getDepthModeForSublayer(0,Ar.ReadOnly),Le=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),nt=[],lt=ve.getCircleRadiusCorrection();for(const At of _){const St=a.getTile(At),Tt=St.getBucket(h);if(!Tt)continue;const Wt=b?Tt.text:Tt.icon;if(!Wt||!Wt.segments.get().length||!Wt.hasVisibleVertices)continue;const Ht=Wt.programConfigurations.get(h.id),Rt=b||Tt.sdfIcons,lr=b?Tt.textSizeData:Tt.iconSizeData,Ir=xe||ve.pitch!==0,Tr=T.useProgram(eo(Rt,b,Tt),Ht),In=s.ak(lr,ve.zoom),en=T.style.map.terrain&&T.style.map.terrain.getTerrainData(At);let On,un,nn,Kr,_i=[0,0],yi=null;if(b)un=St.glyphAtlasTexture,nn=se.LINEAR,On=St.glyphAtlasTexture.size,Tt.iconsInText&&(_i=St.imageAtlasTexture.size,yi=St.imageAtlasTexture,Kr=Ir||T.options.rotating||T.options.zooming||lr.kind==="composite"||lr.kind==="camera"?se.LINEAR:se.NEAREST);else{const yn=h.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear;un=St.imageAtlasTexture,nn=Rt||T.options.rotating||T.options.zooming||yn||Ir?se.LINEAR:se.NEAREST,On=St.imageAtlasTexture.size}const Fi=s.az(St,1,T.transform.zoom),pa=dr(_e,T.transform,Fi),xs=s.K();s.an(xs,pa);const No=_r(xe,_e,T.transform,Fi),co=s.aA(ve,St,A,C),Us=ve.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!G,applyTerrainMatrix:!0}),$s=Le&&Tt.hasTextData(),El=h.layout.get("icon-text-fit")!=="none"&&$s&&Tt.hasIconData();if(Ae){const yn=T.style.map.terrain?(Jn,hn)=>T.style.map.terrain.getElevation(At,Jn,hn):null,vn=h.layout.get("text-rotation-alignment")==="map";qr(Tt,T,b,pa,xs,xe,j,vn,At.toUnwrapped(),ve.width,ve.height,co,yn)}const yc=b&&Le||El,as=Ae||yc?nh:xe?pa:T.transform.clipSpaceToPixelsMatrix,Bo=Rt&&h.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ss;ss=Rt?Tt.iconsInText?Ld(lr.kind,In,Oe,xe,Ae,yc,T,as,No,co,On,_i,lt):Qu(lr.kind,In,Oe,xe,Ae,yc,T,as,No,co,b,On,0,lt):Ku(lr.kind,In,Oe,xe,Ae,yc,T,as,No,co,b,On,lt);const Vs={program:Tr,buffers:Wt,uniformValues:ss,projectionData:Us,atlasTexture:un,atlasTextureIcon:yi,atlasInterpolation:nn,atlasInterpolationIcon:Kr,isSDF:Rt,hasHalo:Bo};if(ke&&Tt.canOverlap){Be=!0;const yn=Wt.segments.get();for(const vn of yn)nt.push({segments:new s.aJ([vn]),sortKey:vn.sortKey,state:Vs,terrainData:en})}else nt.push({segments:Wt.segments,sortKey:0,state:Vs,terrainData:en})}Be&&nt.sort((At,St)=>At.sortKey-St.sortKey);for(const At of nt){const St=At.state;if(ae.activeTexture.set(se.TEXTURE0),St.atlasTexture.bind(St.atlasInterpolation,se.CLAMP_TO_EDGE),St.atlasTextureIcon&&(ae.activeTexture.set(se.TEXTURE1),St.atlasTextureIcon&&St.atlasTextureIcon.bind(St.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),St.isSDF){const Tt=St.uniformValues;St.hasHalo&&(Tt.u_is_halo=1,bf(St.buffers,At.segments,h,T,St.program,je,q,X,Tt,St.projectionData,At.terrainData)),Tt.u_is_halo=0}bf(St.buffers,At.segments,h,T,St.program,je,q,X,St.uniformValues,St.projectionData,At.terrainData)}}function bf(T,a,h,_,b,A,C,D,B,j,q){const X=_.context;b.draw(X,X.gl.TRIANGLES,A,C,D,Hr.backCCW,B,q,j,h.id,T.layoutVertexBuffer,T.indexBuffer,a,h.paint,_.transform.zoom,T.programConfigurations.get(h.id),T.dynamicLayoutVertexBuffer,T.opacityVertexBuffer)}function _l(T,a,h,_,b){const A=T.context,C=A.gl,D=$r.disabled,B=new Gr([C.ONE,C.ONE],s.b7.transparent,[!0,!0,!0,!0]),j=a.getBucket(h);if(!j)return;const q=_.key;let X=h.heatmapFbos.get(q);X||(X=su(A,a.tileSize,a.tileSize),h.heatmapFbos.set(q,X)),A.bindFramebuffer.set(X.framebuffer),A.viewport.set([0,0,a.tileSize,a.tileSize]),A.clear({color:s.b7.transparent});const G=j.programConfigurations.get(h.id),ae=T.useProgram("heatmap",G,!b),se=T.transform.getProjectionData({overscaledTileID:a.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=T.style.map.terrain.getTerrainData(_);ae.draw(A,C.TRIANGLES,Ar.disabled,D,B,Hr.disabled,cl(a,T.transform.zoom,h.paint.get("heatmap-intensity"),1),ve,se,h.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,h.paint,T.transform.zoom,G)}function au(T,a,h,_,b){const A=T.context,C=A.gl,D=T.transform;A.setColorMode(T.colorModeForRenderPass());const B=yl(A,a),j=h.key,q=a.heatmapFbos.get(j);if(!q)return;A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,q.colorAttachment.get()),A.activeTexture.set(C.TEXTURE1),B.bind(C.LINEAR,C.CLAMP_TO_EDGE);const X=D.getProjectionData({overscaledTileID:h,applyTerrainMatrix:b,applyGlobeMatrix:!_});T.useProgram("heatmapTexture").draw(A,C.TRIANGLES,Ar.disabled,$r.disabled,T.colorModeForRenderPass(),Hr.disabled,kd(T,a,0,1),null,X,a.id,T.rasterBoundsBuffer,T.quadTriangleIndexBuffer,T.rasterBoundsSegments,a.paint,D.zoom),q.destroy(),a.heatmapFbos.delete(j)}function su(T,a,h){var _,b;const A=T.gl,C=A.createTexture();A.bindTexture(A.TEXTURE_2D,C),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.LINEAR),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.LINEAR);const D=(_=T.HALF_FLOAT)!==null&&_!==void 0?_:A.UNSIGNED_BYTE,B=(b=T.RGBA16F)!==null&&b!==void 0?b:A.RGBA;A.texImage2D(A.TEXTURE_2D,0,B,a,h,0,A.RGBA,D,null);const j=T.createFramebuffer(a,h,!1,!1);return j.colorAttachment.set(C),j}function yl(T,a){return a.colorRampTexture||(a.colorRampTexture=new be(T,a.colorRamp,T.gl.RGBA)),a.colorRampTexture}function Aa(T,a,h,_,b){if(!h||!_||!_.imageAtlas)return;const A=_.imageAtlas.patternPositions;let C=A[h.to.toString()],D=A[h.from.toString()];if(!C&&D&&(C=D),!D&&C&&(D=C),!C||!D){const B=b.getPaintProperty(a);C=A[B],D=A[B]}C&&D&&T.setConstantPatternPositions(C,D)}function $a(T,a,h,_,b,A,C,D){const B=T.context.gl,j="fill-pattern",q=h.paint.get(j),X=q&&q.constantOr(1),G=h.getCrossfadeParameters();let ae,se,ve,_e,xe;const Ae=T.transform,Oe=h.paint.get("fill-translate"),ke=h.paint.get("fill-translate-anchor");C?(se=X&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=B.LINES):(se=X?"fillPattern":"fill",ae=B.TRIANGLES);const Be=q.constantOr(null);for(const je of _){const Le=a.getTile(je);if(X&&!Le.patternsLoaded())continue;const nt=Le.getBucket(h);if(!nt)continue;const lt=nt.programConfigurations.get(h.id),At=T.useProgram(se,lt),St=T.style.map.terrain&&T.style.map.terrain.getTerrainData(je);X&&(T.context.activeTexture.set(B.TEXTURE0),Le.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),lt.updatePaintBuffers(G)),Aa(lt,j,Be,Le,h);const Tt=Ae.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Wt=s.aA(Ae,Le,Oe,ke);if(C){_e=nt.indexBuffer2,xe=nt.segments2;const Rt=[B.drawingBufferWidth,B.drawingBufferHeight];ve=se==="fillOutlinePattern"&&X?Id(T,G,Le,Rt,Wt):S_(Rt,Wt)}else _e=nt.indexBuffer,xe=nt.segments,ve=X?Ds(T,G,Le,Wt):{u_fill_translate:Wt};let Ht;if(T.renderPass==="translucent"&&D){const[Rt]=T.getStencilConfigForOverlapAndUpdateStencilID(_);Ht=Rt[je.overscaledZ]}else Ht=T.stencilModeForClipping(je);At.draw(T.context,ae,b,Ht,A,Hr.backCCW,ve,St,Tt,h.id,nt.layoutVertexBuffer,_e,xe,h.paint,T.transform.zoom,lt)}}function to(T,a,h,_,b,A,C,D){const B=T.context,j=B.gl,q="fill-extrusion-pattern",X=h.paint.get(q),G=X.constantOr(1),ae=h.getCrossfadeParameters(),se=h.paint.get("fill-extrusion-opacity"),ve=X.constantOr(null),_e=T.transform;for(const xe of _){const Ae=a.getTile(xe),Oe=Ae.getBucket(h);if(!Oe)continue;const ke=T.style.map.terrain&&T.style.map.terrain.getTerrainData(xe),Be=Oe.programConfigurations.get(h.id),je=T.useProgram(G?"fillExtrusionPattern":"fillExtrusion",Be);G&&(T.context.activeTexture.set(j.TEXTURE0),Ae.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Be.updatePaintBuffers(ae));const Le=_e.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!D,applyTerrainMatrix:!0});Aa(Be,q,ve,Ae,h);const nt=s.aA(_e,Ae,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),lt=h.paint.get("fill-extrusion-vertical-gradient"),At=G?Rd(T,lt,se,nt,xe,ae,Ae):Zu(T,lt,se,nt);je.draw(B,B.gl.TRIANGLES,b,A,C,Hr.backCCW,At,ke,Le,h.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,h.paint,T.transform.zoom,Be,T.style.map.terrain&&Oe.centroidVertexBuffer)}}function Va(T,a,h,_,b,A,C,D,B){var j;const q=T.style.projection,X=T.context,G=T.transform,ae=X.gl,se=T.useProgram("hillshade"),ve=!T.options.moving;for(const _e of _){const xe=a.getTile(_e),Ae=xe.fbo;if(!Ae)continue;const Oe=q.getMeshFromTileID(X,_e.canonical,D,!0,"raster"),ke=(j=T.style.map.terrain)===null||j===void 0?void 0:j.getTerrainData(_e);X.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_2D,Ae.colorAttachment.get());const Be=G.getProjectionData({overscaledTileID:_e,aligned:ve,applyGlobeMatrix:!B,applyTerrainMatrix:!0});se.draw(X,ae.TRIANGLES,A,b[_e.overscaledZ],C,Hr.backCCW,dm(T,xe,h),ke,Be,h.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}}const rs=[new s.P(0,0),new s.P(s.Z,0),new s.P(s.Z,s.Z),new s.P(0,s.Z)];function ro(T,a,h,_,b,A,C,D,B=!1,j=!1){const q=_[_.length-1].overscaledZ,X=T.context,G=X.gl,ae=T.useProgram("raster"),se=T.transform,ve=T.style.projection,_e=T.colorModeForRenderPass(),xe=!T.options.moving;for(const Ae of _){const Oe=T.getDepthModeForSublayer(Ae.overscaledZ-q,h.paint.get("raster-opacity")===1?Ar.ReadWrite:Ar.ReadOnly,G.LESS),ke=a.getTile(Ae);ke.registerFadeDuration(h.paint.get("raster-fade-duration"));const Be=a.findLoadedParent(Ae,0),je=a.findLoadedSibling(Ae),Le=Zd(ke,Be||je||null,a,h,T.transform,T.style.map.terrain);let nt,lt;const At=h.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR;X.activeTexture.set(G.TEXTURE0),ke.texture.bind(At,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),X.activeTexture.set(G.TEXTURE1),Be?(Be.texture.bind(At,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),nt=Math.pow(2,Be.tileID.overscaledZ-ke.tileID.overscaledZ),lt=[ke.tileID.canonical.x*nt%1,ke.tileID.canonical.y*nt%1]):ke.texture.bind(At,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),ke.texture.useMipmap&&X.extTextureFilterAnisotropic&&T.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const St=T.style.map.terrain&&T.style.map.terrain.getTerrainData(Ae),Tt=se.getProjectionData({overscaledTileID:Ae,aligned:xe,applyGlobeMatrix:!j,applyTerrainMatrix:!0}),Wt=Bd(lt||[0,0],nt||1,Le,h,D),Ht=ve.getMeshFromTileID(X,Ae.canonical,A,C,"raster");ae.draw(X,G.TRIANGLES,Oe,b?b[Ae.overscaledZ]:$r.disabled,_e,B?Hr.frontCCW:Hr.backCCW,Wt,St,Tt,h.id,Ht.vertexBuffer,Ht.indexBuffer,Ht.segments)}}function Zd(T,a,h,_,b,A){const C=_.paint.get("raster-fade-duration");if(!A&&C>0){const D=I.now(),B=(D-T.timeAdded)/C,j=a?(D-a.timeAdded)/C:-1,q=h.getSource(),X=at(b,{tileSize:q.tileSize,roundZoom:q.roundZoom}),G=!a||Math.abs(a.tileID.overscaledZ-X)>Math.abs(T.tileID.overscaledZ-X),ae=G&&T.refreshedUponExpiration?1:s.ae(G?B:1-j,0,1);return T.refreshedUponExpiration&&B>=1&&(T.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ae}:{opacity:ae,mix:0}}return{opacity:1,mix:0}}const Un=new s.b7(1,0,0,1),Po=new s.b7(0,1,0,1),Pn=new s.b7(0,0,1,1),$n=new s.b7(1,0,1,1),Yr=new s.b7(0,1,1,1);function Co(T,a,h,_){no(T,0,a+h/2,T.transform.width,h,_)}function fa(T,a,h,_){no(T,a-h/2,0,h,T.transform.height,_)}function no(T,a,h,_,b,A){const C=T.context,D=C.gl;D.enable(D.SCISSOR_TEST),D.scissor(a*T.pixelRatio,h*T.pixelRatio,_*T.pixelRatio,b*T.pixelRatio),C.clear({color:A}),D.disable(D.SCISSOR_TEST)}function Ro(T,a,h){const _=T.context,b=_.gl,A=T.useProgram("debug"),C=Ar.disabled,D=$r.disabled,B=T.colorModeForRenderPass(),j="$debug",q=T.style.map.terrain&&T.style.map.terrain.getTerrainData(h);_.activeTexture.set(b.TEXTURE0);const X=a.getTileByID(h.key).latestRawTileData,G=Math.floor((X&&X.byteLength||0)/1024),ae=a.getTile(h).tileSize,se=512/Math.min(ae,512)*(h.overscaledZ/T.transform.zoom)*.5;let ve=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ve+=` => ${h.overscaledZ}`),function(xe,Ae){xe.initDebugOverlayCanvas();const Oe=xe.debugOverlayCanvas,ke=xe.context.gl,Be=xe.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,Oe.width,Oe.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(Ae,5,5),Be.strokeText(Ae,5,5),xe.debugOverlayTexture.update(Oe),xe.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}(T,`${ve} ${G}kB`);const _e=T.transform.getProjectionData({overscaledTileID:h,applyGlobeMatrix:!0,applyTerrainMatrix:!0});A.draw(_,b.TRIANGLES,C,D,Gr.alphaBlended,Hr.disabled,cf(s.b7.transparent,se),null,_e,j,T.debugBuffer,T.quadTriangleIndexBuffer,T.debugSegments),A.draw(_,b.LINE_STRIP,C,D,B,Hr.disabled,cf(s.b7.red),q,_e,j,T.debugBuffer,T.tileBorderIndexBuffer,T.debugSegments)}function xf(T,a,h,_){const{isRenderingGlobe:b}=_,A=T.context,C=A.gl,D=T.transform,B=T.colorModeForRenderPass(),j=T.getDepthModeFor3D(),q=T.useProgram("terrain");A.bindFramebuffer.set(null),A.viewport.set([0,0,T.width,T.height]);for(const X of h){const G=a.getTerrainMesh(X.tileID),ae=T.renderToTexture.getTexture(X),se=a.getTerrainData(X.tileID);A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,ae.texture);const ve=a.getMeshFrameDelta(D.zoom),_e=D.calculateFogMatrix(X.tileID.toUnwrapped()),xe=T_(ve,_e,T.style.sky,D.pitch,b),Ae=D.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(A,C.TRIANGLES,j,$r.disabled,B,Hr.backCCW,xe,se,Ae,"terrain",G.vertexBuffer,G.indexBuffer,G.segments)}}function wf(T,a){if(!a.mesh){const h=new s.aI;h.emplaceBack(-1,-1),h.emplaceBack(1,-1),h.emplaceBack(1,1),h.emplaceBack(-1,1);const _=new s.aK;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),a.mesh=new ec(T.createVertexBuffer(h,_s.members),T.createIndexBuffer(_),s.aJ.simpleSegment(0,0,h.length,_.length))}return a.mesh}class ou{constructor(a,h){this.context=new gl(a),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.ad(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=gt.maxUnderzooming+gt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qs}resize(a,h,_){if(this.width=Math.floor(a*_),this.height=Math.floor(h*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const a=this.context,h=new s.aI;h.emplaceBack(0,0),h.emplaceBack(s.Z,0),h.emplaceBack(0,s.Z),h.emplaceBack(s.Z,s.Z),this.tileExtentBuffer=a.createVertexBuffer(h,_s.members),this.tileExtentSegments=s.aJ.simpleSegment(0,0,4,2);const _=new s.aI;_.emplaceBack(0,0),_.emplaceBack(s.Z,0),_.emplaceBack(0,s.Z),_.emplaceBack(s.Z,s.Z),this.debugBuffer=a.createVertexBuffer(_,_s.members),this.debugSegments=s.aJ.simpleSegment(0,0,4,5);const b=new s.bY;b.emplaceBack(0,0,0,0),b.emplaceBack(s.Z,0,s.Z,0),b.emplaceBack(0,s.Z,0,s.Z),b.emplaceBack(s.Z,s.Z,s.Z,s.Z),this.rasterBoundsBuffer=a.createVertexBuffer(b,Pd.members),this.rasterBoundsSegments=s.aJ.simpleSegment(0,0,4,2);const A=new s.aI;A.emplaceBack(0,0),A.emplaceBack(s.Z,0),A.emplaceBack(0,s.Z),A.emplaceBack(s.Z,s.Z),this.rasterBoundsBufferPosOnly=a.createVertexBuffer(A,_s.members),this.rasterBoundsSegmentsPosOnly=s.aJ.simpleSegment(0,0,4,5);const C=new s.aI;C.emplaceBack(0,0),C.emplaceBack(1,0),C.emplaceBack(0,1),C.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(C,_s.members),this.viewportSegments=s.aJ.simpleSegment(0,0,4,2);const D=new s.bZ;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(D);const B=new s.aK;B.emplaceBack(1,0,2),B.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(B);const j=this.context.gl;this.stencilClearMode=new $r({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.tileExtentMesh=new ec(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const a=this.context,h=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=s.K();s.bQ(_,0,this.width,this.height,0,0,1),s.M(_,_,[h.drawingBufferWidth,h.drawingBufferHeight,0]);const b={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(a,h.TRIANGLES,Ar.disabled,this.stencilClearMode,Gr.disabled,Hr.disabled,null,null,b,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,h,_){if(this.currentStencilSource===a.source||!a.isTileClipped()||!h||!h.length)return;this.currentStencilSource=a.source,this.nextStencilID+h.length>256&&this.clearStencil();const b=this.context;b.setColorMode(Gr.disabled),b.setDepthMode(Ar.disabled);const A={};for(const C of h)A[C.key]=this.nextStencilID++;this._renderTileMasks(A,h,_,!0),this._renderTileMasks(A,h,_,!1),this._tileClippingMaskIDs=A}_renderTileMasks(a,h,_,b){const A=this.context,C=A.gl,D=this.style.projection,B=this.transform,j=this.useProgram("clippingMask");for(const q of h){const X=a[q.key],G=this.style.map.terrain&&this.style.map.terrain.getTerrainData(q),ae=D.getMeshFromTileID(this.context,q.canonical,b,!0,"stencil"),se=B.getProjectionData({overscaledTileID:q,applyGlobeMatrix:!0,applyTerrainMatrix:!0});j.draw(A,C.TRIANGLES,Ar.disabled,new $r({func:C.ALWAYS,mask:0},X,255,C.KEEP,C.KEEP,C.REPLACE),Gr.disabled,_?Hr.disabled:Hr.backCCW,null,G,se,"$clipping",ae.vertexBuffer,ae.indexBuffer,ae.segments)}}_renderTilesDepthBuffer(){const a=this.context,h=a.gl,_=this.style.projection,b=this.transform,A=this.useProgram("depth"),C=this.getDepthModeFor3D(),D=Ne(b,{tileSize:b.tileSize});for(const B of D){const j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(B),q=_.getMeshFromTileID(this.context,B.canonical,!0,!0,"raster"),X=b.getProjectionData({overscaledTileID:B,applyGlobeMatrix:!0,applyTerrainMatrix:!0});A.draw(a,h.TRIANGLES,C,$r.disabled,Gr.disabled,Hr.backCCW,null,j,X,"$clipping",q.vertexBuffer,q.indexBuffer,q.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,h=this.context.gl;return new $r({func:h.NOTEQUAL,mask:255},a,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(a){const h=this.context.gl;return new $r({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,h.KEEP,h.KEEP,h.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(a){const h=this.context.gl,_=a.sort((C,D)=>D.overscaledZ-C.overscaledZ),b=_[_.length-1].overscaledZ,A=_[0].overscaledZ-b+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const C={};for(let D=0;D<A;D++)C[D+b]=new $r({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=A,[C,_]}return[{[b]:$r.disabled},_]}stencilConfigForOverlapTwoPass(a){const h=this.context.gl,_=a.sort((C,D)=>D.overscaledZ-C.overscaledZ),b=_[_.length-1].overscaledZ,A=_[0].overscaledZ-b+1;if(this.clearStencil(),A>1){const C={},D={};for(let B=0;B<A;B++)C[B+b]=new $r({func:h.GREATER,mask:255},A+1+B,255,h.KEEP,h.KEEP,h.REPLACE),D[B+b]=new $r({func:h.GREATER,mask:255},1+B,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID=2*A+1,[C,D,_]}return this.nextStencilID=3,[{[b]:new $r({func:h.GREATER,mask:255},2,255,h.KEEP,h.KEEP,h.REPLACE)},{[b]:new $r({func:h.GREATER,mask:255},1,255,h.KEEP,h.KEEP,h.REPLACE)},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Gr([a.CONSTANT_COLOR,a.ONE],new s.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gr.unblended:Gr.alphaBlended}getDepthModeForSublayer(a,h,_){if(!this.opaquePassEnabledForLayer())return Ar.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new Ar(_||this.context.gl.LEQUAL,h,[b,b])}getDepthModeFor3D(){return new Ar(this.context.gl.LEQUAL,Ar.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,h){var _,b;this.style=a,this.options=h,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(I.now()),this.imageManager.beginFrame();const A=this.style._order,C=this.style.sourceCaches,D={},B={},j={},q={isRenderingToTexture:!1,isRenderingGlobe:((_=a.projection)===null||_===void 0?void 0:_.transitionState)>0};for(const G in C){const ae=C[G];ae.used&&ae.prepare(this.context),D[G]=ae.getVisibleCoordinates(!1),B[G]=D[G].slice().reverse(),j[G]=ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<A.length;G++)if(this.style._layers[A[G]].is3D()){this.opaquePassCutoff=G;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const G of A){const ae=this.style._layers[G];if(!ae.hasOffscreenPass()||ae.isHidden(this.transform.zoom))continue;const se=B[ae.source];(ae.type==="custom"||se.length)&&this.renderLayer(this,C[ae.source],ae,se,q)}if((b=this.style.projection)===null||b===void 0||b.updateGPUdependent({context:this.context,useProgram:G=>this.useProgram(G)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.b7.black:s.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(G,ae){const se=G.context,ve=se.gl,_e=((je,Le,nt)=>{const lt=Math.cos(Le.rollInRadians),At=Math.sin(Le.rollInRadians),St=Ve(Le),Tt=Le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:je.properties.get("sky-color"),u_horizon_color:je.properties.get("horizon-color"),u_horizon:[(Le.width/2-St*At)*nt,(Le.height/2+St*lt)*nt],u_horizon_normal:[-At,lt],u_sky_horizon_blend:je.properties.get("sky-horizon-blend")*Le.height/2*nt,u_sky_blend:Tt}})(ae,G.style.map.transform,G.pixelRatio),xe=new Ar(ve.LEQUAL,Ar.ReadWrite,[0,1]),Ae=$r.disabled,Oe=G.colorModeForRenderPass(),ke=G.useProgram("sky"),Be=wf(se,ae);ke.draw(se,ve.TRIANGLES,xe,Ae,Oe,Hr.disabled,_e,null,void 0,"sky",Be.vertexBuffer,Be.indexBuffer,Be.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[A[this.currentLayer]],ae=C[G.source],se=D[G.source];this._renderTileClippingMasks(G,se,!1),this.renderLayer(this,ae,G,se,q)}this.renderPass="translucent";let X=!1;for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const G=this.style._layers[A[this.currentLayer]],ae=C[G.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(G,q))continue;this.opaquePassEnabledForLayer()||X||(X=!0,q.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const se=(G.type==="symbol"?j:B)[G.source];this._renderTileClippingMasks(G,D[G.source],!1),this.renderLayer(this,ae,G,se,q)}if(q.isRenderingGlobe&&function(G,ae,se){const ve=G.context,_e=ve.gl,xe=G.useProgram("atmosphere"),Ae=new Ar(_e.LEQUAL,Ar.ReadOnly,[0,1]),Oe=G.transform,ke=function(Tt,Wt){const Ht=Tt.properties.get("position"),Rt=[-Ht.x,-Ht.y,-Ht.z],lr=s.ad(new Float64Array(16));return Tt.properties.get("anchor")==="map"&&(s.a_(lr,lr,Wt.rollInRadians),s.a$(lr,lr,-Wt.pitchInRadians),s.a_(lr,lr,Wt.bearingInRadians),s.a$(lr,lr,Wt.center.lat*Math.PI/180),s.bp(lr,lr,-Wt.center.lng*Math.PI/180)),s.bX(Rt,Rt,lr),Rt}(se,G.transform),Be=Oe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),je=ae.properties.get("atmosphere-blend")*Be.projectionTransition;if(je===0)return;const Le=nf(Oe.worldSize,Oe.center.lat),nt=Oe.inverseProjectionMatrix,lt=new Float64Array(4);lt[3]=1,s.at(lt,lt,Oe.modelViewProjectionMatrix),lt[0]/=lt[3],lt[1]/=lt[3],lt[2]/=lt[3],lt[3]=1,s.at(lt,lt,nt),lt[0]/=lt[3],lt[1]/=lt[3],lt[2]/=lt[3],lt[3]=1;const At=((Tt,Wt,Ht,Rt,lr)=>({u_sun_pos:Tt,u_atmosphere_blend:Wt,u_globe_position:Ht,u_globe_radius:Rt,u_inv_proj_matrix:lr}))(ke,je,[lt[0],lt[1],lt[2]],Le,nt),St=wf(ve,ae);xe.draw(ve,_e.TRIANGLES,Ae,$r.disabled,Gr.alphaBlended,Hr.disabled,At,null,null,"atmosphere",St.vertexBuffer,St.indexBuffer,St.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const G=function(ae,se){let ve=null;const _e=Object.values(ae._layers).flatMap(ke=>ke.source&&!ke.isHidden(se)?[ae.sourceCaches[ke.source]]:[]),xe=_e.filter(ke=>ke.getSource().type==="vector"),Ae=_e.filter(ke=>ke.getSource().type!=="vector"),Oe=ke=>{(!ve||ve.getSource().maxzoom<ke.getSource().maxzoom)&&(ve=ke)};return xe.forEach(ke=>Oe(ke)),ve||Ae.forEach(ke=>Oe(ke)),ve}(this.style,this.transform.zoom);G&&function(ae,se,ve){for(let _e=0;_e<ve.length;_e++)Ro(ae,se,ve[_e])}(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const ae=G.transform.padding;Co(G,G.transform.height-(ae.top||0),3,Un),Co(G,ae.bottom||0,3,Po),fa(G,ae.left||0,3,Pn),fa(G,G.transform.width-(ae.right||0),3,$n);const se=G.transform.centerPoint;(function(ve,_e,xe,Ae){no(ve,_e-1,xe-10,2,20,Ae),no(ve,_e-10,xe-1,20,2,Ae)})(G,se.x,G.transform.height-se.y,Yr)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix;let b=this.terrainFacilitator.dirty;b||(b=a?!s.b_(h,_):!s.b$(h,_)),b||(b=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),b&&(s.c0(h,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,C){const D=A.context,B=D.gl,j=A.transform,q=Gr.unblended,X=new Ar(B.LEQUAL,Ar.ReadWrite,[0,1]),G=C.sourceCache.getRenderableTiles(),ae=A.useProgram("terrainDepth");D.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.b7.transparent,depth:1});for(const se of G){const ve=C.getTerrainMesh(se.tileID),_e=C.getTerrainData(se.tileID),xe=j.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ae={u_ele_delta:C.getMeshFrameDelta(j.zoom)};ae.draw(D,B.TRIANGLES,X,$r.disabled,q,Hr.backCCW,Ae,_e,xe,"terrain",ve.vertexBuffer,ve.indexBuffer,ve.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,C){const D=A.context,B=D.gl,j=A.transform,q=Gr.unblended,X=new Ar(B.LEQUAL,Ar.ReadWrite,[0,1]),G=C.getCoordsTexture(),ae=C.sourceCache.getRenderableTiles(),se=A.useProgram("terrainCoords");D.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.b7.transparent,depth:1}),C.coordsIndex=[];for(const ve of ae){const _e=C.getTerrainMesh(ve.tileID),xe=C.getTerrainData(ve.tileID);D.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.texture);const Ae={u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(j.zoom)},Oe=j.getProjectionData({overscaledTileID:ve.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});se.draw(D,B.TRIANGLES,X,$r.disabled,q,Hr.backCCW,Ae,xe,Oe,"terrain",_e.vertexBuffer,_e.indexBuffer,_e.segments),C.coordsIndex.push(ve.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}renderLayer(a,h,_,b,A){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(b||[]).length)&&(this.id=_.id,s.c1(_)?function(C,D,B,j,q,X){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:G}=X,ae=$r.disabled,se=C.colorModeForRenderPass();(B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ve,_e,xe,Ae,Oe,ke,Be,je,Le){const nt=_e.transform,lt=_e.style.map.terrain,At=Oe==="map",St=ke==="map";for(const Tt of ve){const Wt=Ae.getTile(Tt),Ht=Wt.getBucket(xe);if(!Ht||!Ht.text||!Ht.text.segments.get().length)continue;const Rt=s.ak(Ht.textSizeData,nt.zoom),lr=s.az(Wt,1,_e.transform.zoom),Ir=dr(At,_e.transform,lr),Tr=xe.layout.get("icon-text-fit")!=="none"&&Ht.hasIconData();if(Rt){const In=Math.pow(2,nt.zoom-Wt.tileID.overscaledZ),en=lt?(On,un)=>lt.getElevation(Tt,On,un):null;cc(Ht,At,St,Le,nt,Ir,In,Rt,Tr,s.aA(nt,Wt,Be,je),Tt.toUnwrapped(),en)}}}(j,C,B,D,B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),q),B.paint.get("icon-opacity").constantOr(1)!==0&&iu(C,D,B,j,!1,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),B.layout.get("icon-rotation-alignment"),B.layout.get("icon-pitch-alignment"),B.layout.get("icon-keep-upright"),ae,se,G),B.paint.get("text-opacity").constantOr(1)!==0&&iu(C,D,B,j,!0,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.layout.get("text-keep-upright"),ae,se,G),D.map.showCollisionBoxes&&(Ki(C,D,B,j,!0),Ki(C,D,B,j,!1))}(a,h,_,b,this.style.placement.variableOffsets,A):s.c2(_)?function(C,D,B,j,q){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:X}=q,G=B.paint.get("circle-opacity"),ae=B.paint.get("circle-stroke-width"),se=B.paint.get("circle-stroke-opacity"),ve=!B.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(ae.constantOr(1)===0||se.constantOr(1)===0))return;const _e=C.context,xe=_e.gl,Ae=C.transform,Oe=C.getDepthModeForSublayer(0,Ar.ReadOnly),ke=$r.disabled,Be=C.colorModeForRenderPass(),je=[],Le=Ae.getCircleRadiusCorrection();for(let nt=0;nt<j.length;nt++){const lt=j[nt],At=D.getTile(lt),St=At.getBucket(B);if(!St)continue;const Tt=B.paint.get("circle-translate"),Wt=B.paint.get("circle-translate-anchor"),Ht=s.aA(Ae,At,Tt,Wt),Rt=St.programConfigurations.get(B.id),lr=C.useProgram("circle",Rt),Ir=St.layoutVertexBuffer,Tr=St.indexBuffer,In=C.style.map.terrain&&C.style.map.terrain.getTerrainData(lt),en={programConfiguration:Rt,program:lr,layoutVertexBuffer:Ir,indexBuffer:Tr,uniformValues:fm(C,At,B,Ht,Le),terrainData:In,projectionData:Ae.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!X,applyTerrainMatrix:!0})};if(ve){const On=St.segments.get();for(const un of On)je.push({segments:new s.aJ([un]),sortKey:un.sortKey,state:en})}else je.push({segments:St.segments,sortKey:0,state:en})}ve&&je.sort((nt,lt)=>nt.sortKey-lt.sortKey);for(const nt of je){const{programConfiguration:lt,program:At,layoutVertexBuffer:St,indexBuffer:Tt,uniformValues:Wt,terrainData:Ht,projectionData:Rt}=nt.state;At.draw(_e,xe.TRIANGLES,Oe,ke,Be,Hr.backCCW,Wt,Ht,Rt,B.id,St,Tt,nt.segments,B.paint,C.transform.zoom,lt)}}(a,h,_,b,A):s.c3(_)?function(C,D,B,j,q){if(B.paint.get("heatmap-opacity")===0)return;const X=C.context,{isRenderingToTexture:G,isRenderingGlobe:ae}=q;if(C.style.map.terrain){for(const se of j){const ve=D.getTile(se);D.hasRenderableParent(se)||(C.renderPass==="offscreen"?_l(C,ve,B,se,ae):C.renderPass==="translucent"&&au(C,B,se,G,ae))}X.viewport.set([0,0,C.width,C.height])}else C.renderPass==="offscreen"?function(se,ve,_e,xe){const Ae=se.context,Oe=Ae.gl,ke=se.transform,Be=$r.disabled,je=new Gr([Oe.ONE,Oe.ONE],s.b7.transparent,[!0,!0,!0,!0]);(function(Le,nt,lt){const At=Le.gl;Le.activeTexture.set(At.TEXTURE1),Le.viewport.set([0,0,nt.width/4,nt.height/4]);let St=lt.heatmapFbos.get(s.bU);St?(At.bindTexture(At.TEXTURE_2D,St.colorAttachment.get()),Le.bindFramebuffer.set(St.framebuffer)):(St=su(Le,nt.width/4,nt.height/4),lt.heatmapFbos.set(s.bU,St))})(Ae,se,_e),Ae.clear({color:s.b7.transparent});for(let Le=0;Le<xe.length;Le++){const nt=xe[Le];if(ve.hasRenderableParent(nt))continue;const lt=ve.getTile(nt),At=lt.getBucket(_e);if(!At)continue;const St=At.programConfigurations.get(_e.id),Tt=se.useProgram("heatmap",St),Wt=ke.getProjectionData({overscaledTileID:nt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ht=ke.getCircleRadiusCorrection();Tt.draw(Ae,Oe.TRIANGLES,Ar.disabled,Be,je,Hr.backCCW,cl(lt,ke.zoom,_e.paint.get("heatmap-intensity"),Ht),null,Wt,_e.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,_e.paint,ke.zoom,St)}Ae.viewport.set([0,0,se.width,se.height])}(C,D,B,j):C.renderPass==="translucent"&&function(se,ve){const _e=se.context,xe=_e.gl;_e.setColorMode(se.colorModeForRenderPass());const Ae=ve.heatmapFbos.get(s.bU);Ae&&(_e.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,Ae.colorAttachment.get()),_e.activeTexture.set(xe.TEXTURE1),yl(_e,ve).bind(xe.LINEAR,xe.CLAMP_TO_EDGE),se.useProgram("heatmapTexture").draw(_e,xe.TRIANGLES,Ar.disabled,$r.disabled,se.colorModeForRenderPass(),Hr.disabled,kd(se,ve,0,1),null,null,ve.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments,ve.paint,se.transform.zoom))}(C,B)}(a,h,_,b,A):s.c4(_)?function(C,D,B,j,q){if(C.renderPass!=="translucent")return;const{isRenderingToTexture:X}=q,G=B.paint.get("line-opacity"),ae=B.paint.get("line-width");if(G.constantOr(1)===0||ae.constantOr(1)===0)return;const se=C.getDepthModeForSublayer(0,Ar.ReadOnly),ve=C.colorModeForRenderPass(),_e=B.paint.get("line-dasharray"),xe=B.paint.get("line-pattern"),Ae=xe.constantOr(1),Oe=B.paint.get("line-gradient"),ke=B.getCrossfadeParameters(),Be=Ae?"linePattern":_e?"lineSDF":Oe?"lineGradient":"line",je=C.context,Le=je.gl,nt=C.transform;let lt=!0;for(const At of j){const St=D.getTile(At);if(Ae&&!St.patternsLoaded())continue;const Tt=St.getBucket(B);if(!Tt)continue;const Wt=Tt.programConfigurations.get(B.id),Ht=C.context.program.get(),Rt=C.useProgram(Be,Wt),lr=lt||Rt.program!==Ht,Ir=C.style.map.terrain&&C.style.map.terrain.getTerrainData(At),Tr=xe.constantOr(null);if(Tr&&St.imageAtlas){const nn=St.imageAtlas,Kr=nn.patternPositions[Tr.to.toString()],_i=nn.patternPositions[Tr.from.toString()];Kr&&_i&&Wt.setConstantPatternPositions(Kr,_i)}const In=nt.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),en=nt.getPixelScale(),On=Ae?Gu(C,St,B,en,ke):_e?uf(C,St,B,en,_e,ke):Oe?So(C,St,B,en,Tt.lineClipsArray.length):Xu(C,St,B,en);if(Ae)je.activeTexture.set(Le.TEXTURE0),St.imageAtlasTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE),Wt.updatePaintBuffers(ke);else if(_e&&(lr||C.lineAtlas.dirty))je.activeTexture.set(Le.TEXTURE0),C.lineAtlas.bind(je);else if(Oe){const nn=Tt.gradients[B.id];let Kr=nn.texture;if(B.gradientVersion!==nn.version){let _i=256;if(B.stepInterpolant){const yi=D.getSource().maxzoom,Fi=At.canonical.z===yi?Math.ceil(1<<C.transform.maxZoom-At.canonical.z):1;_i=s.ae(s.bV(Tt.maxLineLength/s.Z*1024*Fi),256,je.maxTextureSize)}nn.gradient=s.bW({expression:B.gradientExpression(),evaluationKey:"lineProgress",resolution:_i,image:nn.gradient||void 0,clips:Tt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new be(je,nn.gradient,Le.RGBA),nn.version=B.gradientVersion,Kr=nn.texture}je.activeTexture.set(Le.TEXTURE0),Kr.bind(B.stepInterpolant?Le.NEAREST:Le.LINEAR,Le.CLAMP_TO_EDGE)}let un;if(X){const[nn]=C.getStencilConfigForOverlapAndUpdateStencilID(j);un=nn[At.overscaledZ]}else un=C.stencilModeForClipping(At);Rt.draw(je,Le.TRIANGLES,se,un,ve,Hr.disabled,On,Ir,In,B.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,B.paint,C.transform.zoom,Wt,Tt.layoutVertexBuffer2),lt=!1}}(a,h,_,b,A):s.c5(_)?function(C,D,B,j,q){const X=B.paint.get("fill-color"),G=B.paint.get("fill-opacity");if(G.constantOr(1)===0)return;const{isRenderingToTexture:ae}=q,se=C.colorModeForRenderPass(),ve=B.paint.get("fill-pattern"),_e=C.opaquePassEnabledForLayer()&&!ve.constantOr(1)&&X.constantOr(s.b7.transparent).a===1&&G.constantOr(0)===1?"opaque":"translucent";if(C.renderPass===_e){const xe=C.getDepthModeForSublayer(1,C.renderPass==="opaque"?Ar.ReadWrite:Ar.ReadOnly);$a(C,D,B,j,xe,se,!1,ae)}if(C.renderPass==="translucent"&&B.paint.get("fill-antialias")){const xe=C.getDepthModeForSublayer(B.getPaintProperty("fill-outline-color")?2:0,Ar.ReadOnly);$a(C,D,B,j,xe,se,!0,ae)}}(a,h,_,b,A):s.c6(_)?function(C,D,B,j,q){const X=B.paint.get("fill-extrusion-opacity");if(X===0)return;const{isRenderingToTexture:G}=q;if(C.renderPass==="translucent"){const ae=new Ar(C.context.gl.LEQUAL,Ar.ReadWrite,C.depthRangeFor3D);if(X!==1||B.paint.get("fill-extrusion-pattern").constantOr(1))to(C,D,B,j,ae,$r.disabled,Gr.disabled,G),to(C,D,B,j,ae,C.stencilModeFor3D(),C.colorModeForRenderPass(),G);else{const se=C.colorModeForRenderPass();to(C,D,B,j,ae,$r.disabled,se,G)}}}(a,h,_,b,A):s.c7(_)?function(C,D,B,j,q){if(C.renderPass!=="offscreen"&&C.renderPass!=="translucent")return;const{isRenderingToTexture:X}=q,G=C.context,ae=C.style.projection.useSubdivision,se=C.getDepthModeForSublayer(0,Ar.ReadOnly),ve=C.colorModeForRenderPass();if(C.renderPass==="offscreen")(function(_e,xe,Ae,Oe,ke,Be,je){const Le=_e.context,nt=Le.gl;for(const lt of Ae){const At=xe.getTile(lt),St=At.dem;if(!St||!St.data||!At.needsHillshadePrepare)continue;const Tt=St.dim,Wt=St.stride,Ht=St.getPixels();if(Le.activeTexture.set(nt.TEXTURE1),Le.pixelStoreUnpackPremultiplyAlpha.set(!1),At.demTexture=At.demTexture||_e.getTileTexture(Wt),At.demTexture){const lr=At.demTexture;lr.update(Ht,{premultiply:!1}),lr.bind(nt.NEAREST,nt.CLAMP_TO_EDGE)}else At.demTexture=new be(Le,Ht,nt.RGBA,{premultiply:!1}),At.demTexture.bind(nt.NEAREST,nt.CLAMP_TO_EDGE);Le.activeTexture.set(nt.TEXTURE0);let Rt=At.fbo;if(!Rt){const lr=new be(Le,{width:Tt,height:Tt,data:null},nt.RGBA);lr.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),Rt=At.fbo=Le.createFramebuffer(Tt,Tt,!0,!1),Rt.colorAttachment.set(lr.texture)}Le.bindFramebuffer.set(Rt.framebuffer),Le.viewport.set([0,0,Tt,Tt]),_e.useProgram("hillshadePrepare").draw(Le,nt.TRIANGLES,ke,Be,je,Hr.disabled,sc(At.tileID,St),null,null,Oe.id,_e.rasterBoundsBuffer,_e.quadTriangleIndexBuffer,_e.rasterBoundsSegments),At.needsHillshadePrepare=!1}})(C,D,j,B,se,$r.disabled,ve),G.viewport.set([0,0,C.width,C.height]);else if(C.renderPass==="translucent")if(ae){const[_e,xe,Ae]=C.stencilConfigForOverlapTwoPass(j);Va(C,D,B,Ae,_e,se,ve,!1,X),Va(C,D,B,Ae,xe,se,ve,!0,X)}else{const[_e,xe]=C.getStencilConfigForOverlapAndUpdateStencilID(j);Va(C,D,B,xe,_e,se,ve,!1,X)}}(a,h,_,b,A):s.c8(_)?function(C,D,B,j,q){if(C.renderPass!=="translucent"||B.paint.get("raster-opacity")===0||!j.length)return;const{isRenderingToTexture:X}=q,G=D.getSource(),ae=C.style.projection.useSubdivision;if(G instanceof li)ro(C,D,B,j,null,!1,!1,G.tileCoords,G.flippedWindingOrder,X);else if(ae){const[se,ve,_e]=C.stencilConfigForOverlapTwoPass(j);ro(C,D,B,_e,se,!1,!0,rs,!1,X),ro(C,D,B,_e,ve,!0,!0,rs,!1,X)}else{const[se,ve]=C.getStencilConfigForOverlapAndUpdateStencilID(j);ro(C,D,B,ve,se,!1,!0,rs,!1,X)}}(a,h,_,b,A):s.c9(_)?function(C,D,B,j,q){const X=B.paint.get("background-color"),G=B.paint.get("background-opacity");if(G===0)return;const{isRenderingToTexture:ae}=q,se=C.context,ve=se.gl,_e=C.style.projection,xe=C.transform,Ae=xe.tileSize,Oe=B.paint.get("background-pattern");if(C.isPatternMissing(Oe))return;const ke=!Oe&&X.a===1&&G===1&&C.opaquePassEnabledForLayer()?"opaque":"translucent";if(C.renderPass!==ke)return;const Be=$r.disabled,je=C.getDepthModeForSublayer(0,ke==="opaque"?Ar.ReadWrite:Ar.ReadOnly),Le=C.colorModeForRenderPass(),nt=C.useProgram(Oe?"backgroundPattern":"background"),lt=j||Ne(xe,{tileSize:Ae,terrain:C.style.map.terrain});Oe&&(se.activeTexture.set(ve.TEXTURE0),C.imageManager.bind(C.context));const At=B.getCrossfadeParameters();for(const St of lt){const Tt=xe.getProjectionData({overscaledTileID:St,applyGlobeMatrix:!ae,applyTerrainMatrix:!0}),Wt=Oe?Ao(G,C,Oe,{tileID:St,tileSize:Ae},At):Ju(G,X),Ht=C.style.map.terrain&&C.style.map.terrain.getTerrainData(St),Rt=_e.getMeshFromTileID(se,St.canonical,!1,!0,"raster");nt.draw(se,ve.TRIANGLES,je,Be,Le,Hr.backCCW,Wt,Ht,Tt,B.id,Rt.vertexBuffer,Rt.indexBuffer,Rt.segments)}}(a,0,_,b,A):s.ca(_)&&function(C,D,B,j){const{isRenderingGlobe:q}=j,X=C.context,G=B.implementation,ae=C.style.projection,se=C.transform,ve=se.getProjectionDataForCustomLayer(q),_e={farZ:se.farZ,nearZ:se.nearZ,fov:se.fov*Math.PI/180,modelViewProjectionMatrix:se.modelViewProjectionMatrix,projectionMatrix:se.projectionMatrix,shaderData:{variantName:ae.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ae.shaderPreludeCode.vertexSource}`,define:ae.shaderDefine},defaultProjectionData:ve},xe=G.renderingMode?G.renderingMode:"2d";if(C.renderPass==="offscreen"){const Ae=G.prerender;Ae&&(C.setCustomLayerDefaults(),X.setColorMode(C.colorModeForRenderPass()),Ae.call(G,X.gl,_e),X.setDirty(),C.setBaseState())}else if(C.renderPass==="translucent"){C.setCustomLayerDefaults(),X.setColorMode(C.colorModeForRenderPass()),X.setStencilMode($r.disabled);const Ae=xe==="3d"?C.getDepthModeFor3D():C.getDepthModeForSublayer(0,Ar.ReadOnly);X.setDepthMode(Ae),G.render(X.gl,_e),X.setDirty(),C.setBaseState(),X.bindFramebuffer.set(null)}}(a,0,_,A))}saveTileTexture(a){const h=this._tileTextures[a.size[0]];h?h.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const h=this._tileTextures[a];return h&&h.length>0?h.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const h=this.imageManager.getPattern(a.from.toString()),_=this.imageManager.getPattern(a.to.toString());return!h||!_}useProgram(a,h,_=!1){this.cache=this.cache||{};const b=!!this.style.map.terrain,A=this.style.projection,C=a+(h?h.cacheKey:"")+`/${_?sa:A.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"");return this.cache[C]||(this.cache[C]=new Wu(this.context,kr[a],h,Fd[a],this._showOverdrawInspector,b,_?kr.projectionMercator:A.shaderPreludeCode,_?za:A.shaderDefine)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:h}=this.context.gl;return this.width!==a||this.height!==h}}function uc(T,a){let h,_=!1,b=null,A=null;const C=()=>{b=null,_&&(T.apply(A,h),b=setTimeout(C,a),_=!1)};return(...D)=>(_=!0,A=this,h=D,b||C(),b)}class Tf{constructor(a){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let _;return h.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(_=b)}),(_&&_[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(!this._isValidHash(h))return!1;const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const _=h.join("/");let b=_;b.split("&").length>0&&(b=b.split("&")[0]),this._hashName&&(b=`${this._hashName}=${_}`);let A=window.location.hash.replace(b,"");A.startsWith("#&")?A=A.slice(0,1)+A.slice(2):A==="#"&&(A="");let C=window.location.href.replace(/(#.+)?$/,A);C=C.replace("&&","&"),window.history.replaceState(window.history.state,null,C)},this._updateHash=uc(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(a){const h=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,b=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,b),C=Math.round(h.lng*A)/A,D=Math.round(h.lat*A)/A,B=this._map.getBearing(),j=this._map.getPitch();let q="";if(q+=a?`/${C}/${D}/${_}`:`${_}/${D}/${C}`,(B||j)&&(q+="/"+Math.round(10*B)/10),j&&(q+=`/${Math.round(j)}`),this._hashName){const X=this._hashName;let G=!1;const ae=window.location.hash.slice(1).split("&").map(se=>{const ve=se.split("=")[0];return ve===X?(G=!0,`${ve}=${q}`):se}).filter(se=>se);return G||ae.push(`${X}=${q}`),`#${ae.join("&")}`}return`#${q}`}_isValidHash(a){if(a.length<3||a.some(isNaN))return!1;try{new s.Q(+a[2],+a[1])}catch{return!1}const h=+a[0],_=+(a[3]||0),b=+(a[4]||0);return h>=this._map.getMinZoom()&&h<=this._map.getMaxZoom()&&_>=-180&&_<=180&&b>=this._map.getMinPitch()&&b<=this._map.getMaxPitch()}}const Ea={linearity:.3,easing:s.cb(0,0,.3,1)},Sf=s.e({deceleration:2500,maxSpeed:1400},Ea),vl=s.e({deceleration:20,maxSpeed:1400},Ea),io=s.e({deceleration:1e3,maxSpeed:360},Ea),Io=s.e({deceleration:1e3,maxSpeed:90},Ea),ao=s.e({deceleration:1e3,maxSpeed:360},Ea);class Af{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:I.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,h=I.now();for(;a.length>0&&h-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)h.zoom+=A.zoomDelta||0,h.bearing+=A.bearingDelta||0,h.pitch+=A.pitchDelta||0,h.roll+=A.rollDelta||0,A.panDelta&&h.pan._add(A.panDelta),A.around&&(h.around=A.around),A.pinchAround&&(h.pinchAround=A.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(h.pan.mag()){const A=bs(h.pan.mag(),_,s.e({},Sf,a||{})),C=h.pan.mult(A.amount/h.pan.mag()),D=this._map.cameraHelper.handlePanInertia(C,this._map.transform);b.center=D.easingCenter,b.offset=D.easingOffset,bl(b,A)}if(h.zoom){const A=bs(h.zoom,_,vl);b.zoom=this._map.transform.zoom+A.amount,bl(b,A)}if(h.bearing){const A=bs(h.bearing,_,io);b.bearing=this._map.transform.bearing+s.ae(A.amount,-179,179),bl(b,A)}if(h.pitch){const A=bs(h.pitch,_,Io);b.pitch=this._map.transform.pitch+A.amount,bl(b,A)}if(h.roll){const A=bs(h.roll,_,ao);b.roll=this._map.transform.roll+s.ae(A.amount,-179,179),bl(b,A)}if(b.zoom||b.bearing){const A=h.pinchAround===void 0?h.around:h.pinchAround;b.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),s.e(b,{noMoveStart:!0})}}function bl(T,a){(!T.duration||T.duration<a.duration)&&(T.duration=a.duration,T.easing=a.easing)}function bs(T,a,h){const{maxSpeed:_,linearity:b,deceleration:A}=h,C=s.ae(T*b/(a/1e3),-_,_),D=Math.abs(C)/(A*b);return{easing:h.easing,duration:1e3*D,amount:C*(D/2)}}class Qi extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_,b={}){_=_ instanceof MouseEvent?_:new MouseEvent(a,_);const A=k.mousePos(h.getCanvas(),_),C=h.unproject(A);super(a,s.e({point:A,lngLat:C,originalEvent:_},b)),this._defaultPrevented=!1,this.target=h}}class ui extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){const b=a==="touchend"?_.changedTouches:_.touches,A=k.touchPos(h.getCanvasContainer(),b),C=A.map(B=>h.unproject(B)),D=A.reduce((B,j,q,X)=>B.add(j.div(X.length)),new s.P(0,0));super(a,{points:A,point:D,lngLats:C,lngLat:h.unproject(D),originalEvent:_}),this._defaultPrevented=!1}}class Cn extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,h,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class ih{constructor(a,h){this._map=a,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new Cn(a.type,this._map,a))}mousedown(a,h){return this._mousedownPos=h,this._firePreventable(new Qi(a.type,this._map,a))}mouseup(a){this._map.fire(new Qi(a.type,this._map,a))}click(a,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Qi(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Qi(a.type,this._map,a))}mouseover(a){this._map.fire(new Qi(a.type,this._map,a))}mouseout(a){this._map.fire(new Qi(a.type,this._map,a))}touchstart(a){return this._firePreventable(new ui(a.type,this._map,a))}touchmove(a){this._map.fire(new ui(a.type,this._map,a))}touchend(a){this._map.fire(new ui(a.type,this._map,a))}touchcancel(a){this._map.fire(new ui(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bs{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Qi(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Qi(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class so{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.screenPointToLocation(s.P.convert(a),this._map.terrain)}}class vm{constructor(a,h){this._map=a,this._tr=new so(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,h){this.isEnabled()&&a.shiftKey&&a.button===0&&(k.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(a,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=_,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const A=Math.min(b.x,_.x),C=Math.max(b.x,_.x),D=Math.min(b.y,_.y),B=Math.max(b.y,_.y);k.setTransform(this._box,`translate(${A}px,${D}px)`),this._box.style.width=C-A+"px",this._box.style.height=B-D+"px"}mouseupWindow(a,h){if(!this._active||a.button!==0)return;const _=this._startPos,b=h;if(this.reset(),k.suppressClick(),_.x!==b.x||_.y!==b.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:a})),{cameraAnimation:A=>A.fitScreenCoordinates(_,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,h){return this._map.fire(new s.l(a,{originalEvent:h}))}}function Xd(T,a){if(T.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${T.length}, points ${a.length}`);const h={};for(let _=0;_<T.length;_++)h[T[_].identifier]=a[_];return h}class Oi{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(b){const A=new s.P(0,0);for(const C of b)A._add(C);return A.div(b.length)}(h),this.touches=Xd(_,h)))}touchmove(a,h,_){if(this.aborted||!this.centroid)return;const b=Xd(_,h);for(const A in this.touches){const C=b[A];(!C||C.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(a,h,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class ah{constructor(a){this.singleTap=new Oi(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,h,_){this.singleTap.touchstart(a,h,_)}touchmove(a,h,_){this.singleTap.touchmove(a,h,_)}touchend(a,h,_){const b=this.singleTap.touchend(a,h,_);if(b){const A=a.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(b)<30;if(A&&C||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class lu{constructor(a){this._tr=new so(a),this._zoomIn=new ah({numTouches:1,numTaps:2}),this._zoomOut=new ah({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,h,_){this._zoomIn.touchstart(a,h,_),this._zoomOut.touchstart(a,h,_)}touchmove(a,h,_){this._zoomIn.touchmove(a,h,_),this._zoomOut.touchmove(a,h,_)}touchend(a,h,_){const b=this._zoomIn.touchend(a,h,_),A=this._zoomOut.touchend(a,h,_),C=this._tr;return b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(b)},{originalEvent:a})}):A?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(A)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ns{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(...a){const h=this._moveFunction(...a);if(h.bearingDelta||h.pitchDelta||h.rollDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(a,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=Array.isArray(h)?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,h){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const b=Array.isArray(h)?h[0]:h;return!this._moved&&b.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(_,b))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&k.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ls={0:1,2:2};class Jt{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const h=k.mouseButton(a);this._eventButton=h}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(h,_){const b=Ls[_];return h.buttons===void 0||(h.buttons&b)!==b}(a,this._eventButton)}isValidEndEvent(a){return k.mouseButton(a)===this._eventButton}}class hc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}class Gd{constructor(a=new Jt({checkCorrectEvent:()=>!0}),h=new hc){this.mouseMoveStateManager=a,this.oneFingerTouchMoveStateManager=h}_executeRelevantHandler(a,h,_){return a instanceof MouseEvent?h(a):typeof TouchEvent<"u"&&a instanceof TouchEvent?_(a):void 0}startMove(a){this._executeRelevantHandler(a,h=>this.mouseMoveStateManager.startMove(h),h=>this.oneFingerTouchMoveStateManager.startMove(h))}endMove(a){this._executeRelevantHandler(a,h=>this.mouseMoveStateManager.endMove(h),h=>this.oneFingerTouchMoveStateManager.endMove(h))}isValidStartEvent(a){return this._executeRelevantHandler(a,h=>this.mouseMoveStateManager.isValidStartEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidStartEvent(h))}isValidMoveEvent(a){return this._executeRelevantHandler(a,h=>this.mouseMoveStateManager.isValidMoveEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(h))}isValidEndEvent(a){return this._executeRelevantHandler(a,h=>this.mouseMoveStateManager.isValidEndEvent(h),h=>this.oneFingerTouchMoveStateManager.isValidEndEvent(h))}}const cu=T=>{T.mousedown=T.dragStart,T.mousemoveWindow=T.dragMove,T.mouseup=T.dragEnd,T.contextmenu=a=>{a.preventDefault()}};class sh{constructor(a,h){this._clickTolerance=a.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(a){return a<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(a,h,_){return this._calculateTransform(a,h,_)}touchmove(a,h,_){if(this._active){if(!this._shouldBePrevented(_.length))return a.preventDefault(),this._calculateTransform(a,h,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",a)}}touchend(a,h,_){this._calculateTransform(a,h,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,h,_){_.length>0&&(this._active=!0);const b=Xd(_,h),A=new s.P(0,0),C=new s.P(0,0);let D=0;for(const j in b){const q=b[j],X=this._touches[j];X&&(A._add(q),C._add(q.sub(X)),D++,b[j]=q)}if(this._touches=b,this._shouldBePrevented(D)||!C.mag())return;const B=C.div(D);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(D),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(a,h,_){if(!this._firstTwoTouches)return;a.preventDefault();const[b,A]=this._firstTwoTouches,C=Fs(_,h,b),D=Fs(_,h,A);if(!C||!D)return;const B=this._aroundCenter?null:C.add(D).div(2);return this._move([C,D],B,a)}touchend(a,h,_){if(!this._firstTwoTouches)return;const[b,A]=this._firstTwoTouches,C=Fs(_,h,b),D=Fs(_,h,A);C&&D||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Fs(T,a,h){for(let _=0;_<T.length;_++)if(T[_].identifier===h)return a[_]}function Nr(T,a){return Math.log(T/a)/Math.LN2}class fc extends xl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,h){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Nr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nr(this._distance,_),pinchAround:h}}}function Yd(T,a){return 180*T.angleWith(a)/Math.PI}class wl extends xl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,h,_){const b=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Yd(this._vector,b),pinchAround:h}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const h=25/(Math.PI*this._minDiameter)*360,_=Yd(a,this._startVector);return Math.abs(_)<h}}function Ef(T){return Math.abs(T.y)>Math.abs(T.x)}class oh extends xl{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,h,_){super.touchstart(a,h,_),this._currentTouchCount=_.length}_start(a){this._lastPoints=a,Ef(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,h,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=a[0].sub(this._lastPoints[0]),A=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,A,_.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(a,h,_){if(this._valid!==void 0)return this._valid;const b=a.mag()>=2,A=h.mag()>=2;if(!b&&!A)return;if(!b||!A)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const C=a.y>0==h.y>0;return Ef(a)&&Ef(h)&&C}}const Mf={panStep:100,bearingStep:15,pitchStep:10};class lh{constructor(a){this._tr=new so(a);const h=Mf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let h=0,_=0,b=0,A=0,C=0;switch(a.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),A=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),A=1);break;case 38:a.shiftKey?b=1:(a.preventDefault(),C=-1);break;case 40:a.shiftKey?b=-1:(a.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(_=0,b=0),{cameraAnimation:D=>{const B=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:ch,zoom:h?Math.round(B.zoom)+h*(a.shiftKey?2:1):B.zoom,bearing:B.bearing+_*this._bearingStep,pitch:B.pitch+b*this._pitchStep,offset:[-A*this._panStep,-C*this._panStep],center:B.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ch(T){return T*(2-T)}const Kd=4.000244140625;class dc{constructor(a,h){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=a,this._tr=new so(a),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(a){return!!this._map.cooperativeGestures.isEnabled()&&!(a.ctrlKey||this._map.cooperativeGestures.isBypassed(a))}wheel(a){if(!this.isEnabled())return;if(this._shouldBePrevented(a))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",a);let h=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=I.now(),b=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%Kd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(b*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),a.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=a,this._delta-=h,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=k.mousePos(this._map.getCanvas(),a),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(s.Q.convert(_.center)):h,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const D=a.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=D),typeof this._targetZoom=="number"&&(this._targetZoom+=D)}if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Kd?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&B!==0&&(B=1/B);const j=typeof this._targetZoom!="number"?a.scale:s.ac(this._targetZoom);this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,s.ah(j*B))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom!="number"?a.zoom:this._targetZoom,_=this._startZoom,b=this._easing;let A,C=!1;if(this._type==="wheel"&&_&&b){const D=I.now()-this._lastWheelEventTime,B=Math.min((D+5)/200,1),j=b(B);A=s.B.number(_,h,j),B<1?this._frameId||(this._frameId=!0):C=!0}else A=h,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=A,{noInertia:!0,needsRenderFrame:!C,zoomDelta:A-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let h=s.cd;if(this._prevEase){const _=this._prevEase,b=(I.now()-_.start)/_.duration,A=_.easing(b+.01)-_.easing(b),C=.27/Math.sqrt(A*A+1e-4)*.01,D=Math.sqrt(.0729-C*C);h=s.cb(C,D,.25,1)}return this._prevEase={start:I.now(),duration:a,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Qd{constructor(a,h){this._clickZoom=a,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bm{constructor(a){this._tr=new so(a),this.reset()}reset(){this._active=!1}dblclick(a,h){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ma{constructor(){this._tap=new ah({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,h,_){if(!this._swipePoint)if(this._tapTime){const b=h[0],A=a.timeStamp-this._tapTime<500,C=this._tapPoint.dist(b)<30;A&&C?_.length>0&&(this._swipePoint=b,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(a,h,_)}touchmove(a,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const b=h[0],A=b.y-this._swipePoint.y;return this._swipePoint=b,a.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(a,h,_)}touchend(a,h,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const b=this._tap.touchend(a,h,_);b&&(this._tapTime=a.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cn{constructor(a,h,_){this._el=a,this._mousePan=h,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pc{constructor(a,h,_,b){this._pitchWithRotate=a.pitchWithRotate,this._rollEnabled=a.rollEnabled,this._mouseRotate=h,this._mousePitch=_,this._mouseRoll=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class zs{constructor(a,h,_,b){this._el=a,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class oo{constructor(a,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=k.create("div","maplibregl-cooperative-gesture-screen",a);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=h,this._container.appendChild(b);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=_,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(k.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(a){return a[this._bypassKey]}notifyGestureBlocked(a,h){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:a,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Oo=T=>T.zoom||T.drag||T.roll||T.pitch||T.rotate;class Pf extends s.l{}function uh(T){return T.panDelta&&T.panDelta.mag()||T.zoomDelta||T.bearingDelta||T.pitchDelta||T.rollDelta}class qa{constructor(a,h){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,A)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=b.type==="renderFrame"?void 0:b,D={needsRenderFrame:!1},B={},j={};for(const{handlerName:G,handler:ae,allowed:se}of this._handlers){if(!ae.isEnabled())continue;let ve;if(this._blockedByActive(j,se,G))ae.reset();else if(ae[A||b.type]){if(s.ce(b,A||b.type)){const _e=k.mousePos(this._map.getCanvas(),b);ve=ae[A||b.type](b,_e)}else if(s.cf(b,A||b.type)){const _e=this._getMapTouches(b.touches),xe=k.touchPos(this._map.getCanvas(),_e);ve=ae[A||b.type](b,xe,_e)}else s.cg(A||b.type)||(ve=ae[A||b.type](b));this.mergeHandlerResult(D,B,ve,G,C),ve&&ve.needsRenderFrame&&this._triggerRenderFrame()}(ve||ae.isActive())&&(j[G]=ae)}const q={};for(const G in this._previousActiveHandlers)j[G]||(q[G]=C);this._previousActiveHandlers=j,(Object.keys(q).length||uh(D))&&(this._changes.push([D,B,q]),this._triggerRenderFrame()),(Object.keys(j).length||uh(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=D;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Af(a),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,A,C]of this._listeners)k.addEventListener(b,A,b===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[a,h,_]of this._listeners)k.removeEventListener(a,h,a===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new ih(h,a));const b=h.boxZoom=new vm(h,a);this._add("boxZoom",b),a.interactive&&a.boxZoom&&b.enable();const A=h.cooperativeGestures=new oo(h,a.cooperativeGestures);this._add("cooperativeGestures",A),a.cooperativeGestures&&A.enable();const C=new lu(h),D=new bm(h);h.doubleClickZoom=new Qd(D,C),this._add("tapZoom",C),this._add("clickZoom",D),a.interactive&&a.doubleClickZoom&&h.doubleClickZoom.enable();const B=new Ma;this._add("tapDragZoom",B);const j=h.touchPitch=new oh(h);this._add("touchPitch",j),a.interactive&&a.touchPitch&&h.touchPitch.enable(a.touchPitch);const q=()=>h.project(h.getCenter()),X=function({enable:ke,clickTolerance:Be,aroundCenter:je=!0,minPixelCenterThreshold:Le=100,rotateDegreesPerPixelMoved:nt=.8},lt){const At=new Jt({checkCorrectEvent:St=>k.mouseButton(St)===0&&St.ctrlKey||k.mouseButton(St)===2&&!St.ctrlKey});return new ns({clickTolerance:Be,move:(St,Tt)=>{const Wt=lt();if(je&&Math.abs(Wt.y-St.y)>Le)return{bearingDelta:s.cc(new s.P(St.x,Tt.y),Tt,Wt)};let Ht=(Tt.x-St.x)*nt;return je&&Tt.y<Wt.y&&(Ht=-Ht),{bearingDelta:Ht}},moveStateManager:At,enable:ke,assignEvents:cu})}(a,q),G=function({enable:ke,clickTolerance:Be,pitchDegreesPerPixelMoved:je=-.5}){const Le=new Jt({checkCorrectEvent:nt=>k.mouseButton(nt)===0&&nt.ctrlKey||k.mouseButton(nt)===2});return new ns({clickTolerance:Be,move:(nt,lt)=>({pitchDelta:(lt.y-nt.y)*je}),moveStateManager:Le,enable:ke,assignEvents:cu})}(a),ae=function({enable:ke,clickTolerance:Be,rollDegreesPerPixelMoved:je=.3},Le){const nt=new Jt({checkCorrectEvent:lt=>k.mouseButton(lt)===2&&lt.ctrlKey});return new ns({clickTolerance:Be,move:(lt,At)=>{const St=Le();let Tt=(At.x-lt.x)*je;return At.y<St.y&&(Tt=-Tt),{rollDelta:Tt}},moveStateManager:nt,enable:ke,assignEvents:cu})}(a,q);h.dragRotate=new pc(a,X,G,ae),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",G,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ae,["mousePitch"]),a.interactive&&a.dragRotate&&h.dragRotate.enable();const se=function({enable:ke,clickTolerance:Be}){const je=new Jt({checkCorrectEvent:Le=>k.mouseButton(Le)===0&&!Le.ctrlKey});return new ns({clickTolerance:Be,move:(Le,nt)=>({around:nt,panDelta:nt.sub(Le)}),activateOnStart:!0,moveStateManager:je,enable:ke,assignEvents:cu})}(a),ve=new sh(a,h);h.dragPan=new cn(_,se,ve),this._add("mousePan",se),this._add("touchPan",ve,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&h.dragPan.enable(a.dragPan);const _e=new wl,xe=new fc;h.touchZoomRotate=new zs(_,xe,_e,B),this._add("touchRotate",_e,["touchPan","touchZoom"]),this._add("touchZoom",xe,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&h.touchZoomRotate.enable(a.touchZoomRotate);const Ae=h.scrollZoom=new dc(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Ae,["mousePan"]),a.interactive&&a.scrollZoom&&h.scrollZoom.enable(a.scrollZoom);const Oe=h.keyboard=new lh(h);this._add("keyboard",Oe),a.interactive&&a.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Bs(h))}_add(a,h,_){this._handlers.push({handlerName:a,handler:h,allowed:_}),this._handlersById[a]=h}stop(a){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oo(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,h,_){for(const b in a)if(b!==_&&(!h||h.indexOf(b)<0))return!0;return!1}_getMapTouches(a){const h=[];for(const _ of a)this._el.contains(_.target)&&h.push(_);return h}mergeHandlerResult(a,h,_,b,A){if(!_)return;s.e(a,_);const C={handlerName:b,originalEvent:_.originalEvent||A};_.zoomDelta!==void 0&&(h.zoom=C),_.panDelta!==void 0&&(h.drag=C),_.rollDelta!==void 0&&(h.roll=C),_.pitchDelta!==void 0&&(h.pitch=C),_.bearingDelta!==void 0&&(h.rotate=C)}_applyChanges(){const a={},h={},_={};for(const[b,A,C]of this._changes)b.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(b.panDelta)),b.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+b.pitchDelta),b.rollDelta&&(a.rollDelta=(a.rollDelta||0)+b.rollDelta),b.around!==void 0&&(a.around=b.around),b.pinchAround!==void 0&&(a.pinchAround=b.pinchAround),b.noInertia&&(a.noInertia=b.noInertia),s.e(h,A),s.e(_,C);this._updateMapTransform(a,h,_),this._changes=[]}_updateMapTransform(a,h,_){const b=this._map,A=b._getTransformForUpdate(),C=b.terrain;if(!(uh(a)||C&&this._terrainMovement))return this._fireEvents(h,_,!0);b._stop(!0);let{panDelta:D,zoomDelta:B,bearingDelta:j,pitchDelta:q,rollDelta:X,around:G,pinchAround:ae}=a;ae!==void 0&&(G=ae),G=G||b.transform.centerPoint,C&&!A.isPointOnMapSurface(G)&&(G=A.centerPoint);const se={panDelta:D,zoomDelta:B,rollDelta:X,pitchDelta:q,bearingDelta:j,around:G};this._map.cameraHelper.useGlobeControls&&!A.isPointOnMapSurface(G)&&(G=A.centerPoint);const ve=G.distSqr(A.centerPoint)<.01?A.center:A.screenPointToLocation(D?G.sub(D):G);C?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(se,A),this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?A.setCenter(A.screenPointToLocation(A.centerPoint.sub(D))):this._map.cameraHelper.handleMapControlsPan(se,A,ve):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(se,A,ve))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(se,A),this._map.cameraHelper.handleMapControlsPan(se,A,ve)),b._applyUpdatedTransform(A),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(h,_,!0)}_fireEvents(a,h,_){const b=Oo(this._eventsInProgress),A=Oo(a),C={};for(const X in a){const{originalEvent:G}=a[X];this._eventsInProgress[X]||(C[`${X}start`]=G),this._eventsInProgress[X]=a[X]}!b&&A&&this._fireEvent("movestart",A.originalEvent);for(const X in C)this._fireEvent(X,C[X]);A&&this._fireEvent("move",A.originalEvent);for(const X in a){const{originalEvent:G}=a[X];this._fireEvent(X,G)}const D={};let B;for(const X in this._eventsInProgress){const{handlerName:G,originalEvent:ae}=this._eventsInProgress[X];this._handlersById[G].isActive()||(delete this._eventsInProgress[X],B=h[G]||ae,D[`${X}end`]=B)}for(const X in D)this._fireEvent(X,D[X]);const j=Oo(this._eventsInProgress),q=(b||A)&&!j;if(q&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const X=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&X.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(X)}if(_&&q){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=ae=>ae!==0&&-this._bearingSnap<ae&&ae<this._bearingSnap;!X||!X.essential&&I.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:B})),G(this._map.getBearing())&&this._map.resetNorth()):(G(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(a,h){this._map.fire(new s.l(a,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new Pf("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Tl extends s.E{constructor(a,h,_){super(),this._renderFrameCallback=()=>{const b=Math.min((I.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(b)),b<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=_.bearingSnap,this.cameraHelper=h,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(a,h){a.apply(this.transform),this.transform=a,this.cameraHelper=h}getCenter(){return new s.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(a,h){return this.jumpTo({center:a},h)}getCenterElevation(){return this.transform.elevation}setCenterElevation(a,h){return this.jumpTo({elevation:a},h),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(a){this._centerClampedToGround=a}panBy(a,h,_){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,s.e({offset:a},h),_)}panTo(a,h,_){return this.easeTo(s.e({center:a},h),_)}getZoom(){return this.transform.zoom}setZoom(a,h){return this.jumpTo({zoom:a},h),this}zoomTo(a,h,_){return this.easeTo(s.e({zoom:a},h),_)}zoomIn(a,h){return this.zoomTo(this.getZoom()+1,a,h),this}zoomOut(a,h){return this.zoomTo(this.getZoom()-1,a,h),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(a,h){return a!=this.transform.fov&&(this.transform.setFov(a),this.fire(new s.l("movestart",h)).fire(new s.l("move",h)).fire(new s.l("moveend",h))),this}getBearing(){return this.transform.bearing}setBearing(a,h){return this.jumpTo({bearing:a},h),this}getPadding(){return this.transform.padding}setPadding(a,h){return this.jumpTo({padding:a},h),this}rotateTo(a,h,_){return this.easeTo(s.e({bearing:a},h),_)}resetNorth(a,h){return this.rotateTo(0,s.e({duration:1e3},a),h),this}resetNorthPitch(a,h){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},a),h),this}snapToNorth(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this}getPitch(){return this.transform.pitch}setPitch(a,h){return this.jumpTo({pitch:a},h),this}getRoll(){return this.transform.roll}setRoll(a,h){return this.jumpTo({roll:a},h),this}cameraForBounds(a,h){a=Vt.convert(a).adjustAntiMeridian();const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,h)}_cameraForBoxAndBearing(a,h,_,b){const A={top:0,bottom:0,right:0,left:0};if(typeof(b=s.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const j=b.padding;b.padding={top:j,bottom:j,right:j,left:j}}const C=s.e(A,b.padding);b.padding=C;const D=this.transform,B=new Vt(a,h);return this.cameraHelper.cameraForBoxAndBearing(b,C,B,_,D)}fitBounds(a,h,_){return this._fitInternal(this.cameraForBounds(a,h),h,_)}fitScreenCoordinates(a,h,_,b,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(a)),this.transform.screenPointToLocation(s.P.convert(h)),_,b),b,A)}_fitInternal(a,h,_){return a?(delete(h=s.e(a,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(a,h){this.stop();const _=this._getTransformForUpdate();let b=!1,A=!1,C=!1;const D=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,a);const B=_.zoom!==D;return"elevation"in a&&_.elevation!==+a.elevation&&_.setElevation(+a.elevation),"bearing"in a&&_.bearing!==+a.bearing&&(b=!0,_.setBearing(+a.bearing)),"pitch"in a&&_.pitch!==+a.pitch&&(A=!0,_.setPitch(+a.pitch)),"roll"in a&&_.roll!==+a.roll&&(C=!0,_.setRoll(+a.roll)),a.padding==null||_.isPaddingEqual(a.padding)||_.setPadding(a.padding),this._applyUpdatedTransform(_),this.fire(new s.l("movestart",h)).fire(new s.l("move",h)),B&&this.fire(new s.l("zoomstart",h)).fire(new s.l("zoom",h)).fire(new s.l("zoomend",h)),b&&this.fire(new s.l("rotatestart",h)).fire(new s.l("rotate",h)).fire(new s.l("rotateend",h)),A&&this.fire(new s.l("pitchstart",h)).fire(new s.l("pitch",h)).fire(new s.l("pitchend",h)),C&&this.fire(new s.l("rollstart",h)).fire(new s.l("roll",h)).fire(new s.l("rollend",h)),this.fire(new s.l("moveend",h))}calculateCameraOptionsFromTo(a,h,_,b=0){const A=s.$.fromLngLat(a,h),C=s.$.fromLngLat(_,b),D=C.x-A.x,B=C.y-A.y,j=C.z-A.z,q=Math.hypot(D,B,j);if(q===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(D,B),G=s.ah(this.transform.cameraToCenterDistance/q/this.transform.tileSize),ae=180*Math.atan2(D,-B)/Math.PI;let se=180*Math.acos(X/q)/Math.PI;return se=j<0?90-se:90+se,{center:C.toLngLat(),elevation:b,zoom:G,pitch:se,bearing:ae}}calculateCameraOptionsFromCameraLngLatAltRotation(a,h,_,b,A){const C=this.transform.calculateCenterFromCameraLngLatAlt(a,h,_,b);return{center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:_,pitch:b,roll:A}}easeTo(a,h){this._stop(!1,a.easeId),((a=s.e({offset:[0,0],duration:500,easing:s.cd},a)).animate===!1||!a.essential&&I.prefersReducedMotion)&&(a.duration=0);const _=this._getTransformForUpdate(),b=this.getBearing(),A=_.pitch,C=_.roll,D="bearing"in a?this._normalizeBearing(a.bearing,b):b,B="pitch"in a?+a.pitch:A,j="roll"in a?this._normalizeBearing(a.roll,C):C,q="padding"in a?a.padding:_.padding,X=s.P.convert(a.offset);let G,ae;a.around&&(G=s.Q.convert(a.around),ae=_.locationToScreenPoint(G));const se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ve=this.cameraHelper.handleEaseTo(_,{bearing:D,pitch:B,roll:j,padding:q,around:G,aroundPoint:ae,offsetAsPoint:X,offset:a.offset,zoom:a.zoom,center:a.center});return this._rotating=this._rotating||b!==D,this._pitching=this._pitching||B!==A,this._rolling=this._rolling||j!==C,this._padding=!_.isPaddingEqual(q),this._zooming=this._zooming||ve.isZooming,this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,se),this.terrain&&this._prepareElevation(ve.elevationCenter),this._ease(_e=>{ve.easeFunc(_e),this.terrain&&!a.freezeElevation&&this._updateElevation(_e),this._applyUpdatedTransform(_),this._fireMoveEvents(h)},_e=>{this.terrain&&a.freezeElevation&&this._finalizeElevation(),this._afterEase(h,_e)},a),this}_prepareEase(a,h,_={}){this._moving=!0,h||_.moving||this.fire(new s.l("movestart",a)),this._zooming&&!_.zooming&&this.fire(new s.l("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new s.l("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new s.l("pitchstart",a)),this._rolling&&!_.rolling&&this.fire(new s.l("rollstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&h!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(_-(h-(_*a+this._elevationStart))/(1-a)),this._elevationTarget=h}this.transform.setElevation(s.B.number(this._elevationStart,this._elevationTarget,a))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(a){if(!this.terrain&&a.elevation>=0&&a.pitch<=90)return{};const h=a.getCameraLngLat(),_=a.getCameraAltitude(),b=this.terrain?this.terrain.getElevationForLngLatZoom(h,a.zoom):0;if(_<b){const A=this.calculateCameraOptionsFromTo(h,b,a.center,a.elevation);return{pitch:A.pitch,zoom:A.zoom}}return{}}_applyUpdatedTransform(a){const h=[];if(h.push(b=>this._elevateCameraIfInsideTerrain(b)),this.transformCameraUpdate&&h.push(b=>this.transformCameraUpdate(b)),!h.length)return;const _=a.clone();for(const b of h){const A=_.clone(),{center:C,zoom:D,roll:B,pitch:j,bearing:q,elevation:X}=b(A);C&&A.setCenter(C),X!==void 0&&A.setElevation(X),D!==void 0&&A.setZoom(D),B!==void 0&&A.setRoll(B),j!==void 0&&A.setPitch(j),q!==void 0&&A.setBearing(q),_.apply(A)}this.transform.apply(_)}_fireMoveEvents(a){this.fire(new s.l("move",a)),this._zooming&&this.fire(new s.l("zoom",a)),this._rotating&&this.fire(new s.l("rotate",a)),this._pitching&&this.fire(new s.l("pitch",a)),this._rolling&&this.fire(new s.l("roll",a))}_afterEase(a,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const _=this._zooming,b=this._rotating,A=this._pitching,C=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new s.l("zoomend",a)),b&&this.fire(new s.l("rotateend",a)),A&&this.fire(new s.l("pitchend",a)),C&&this.fire(new s.l("rollend",a)),this.fire(new s.l("moveend",a))}flyTo(a,h){if(!a.essential&&I.prefersReducedMotion){const Tt=s.O(a,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Tt,h)}this.stop(),a=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cd},a);const _=this._getTransformForUpdate(),b=_.bearing,A=_.pitch,C=_.roll,D=_.padding,B="bearing"in a?this._normalizeBearing(a.bearing,b):b,j="pitch"in a?+a.pitch:A,q="roll"in a?this._normalizeBearing(a.roll,C):C,X="padding"in a?a.padding:_.padding,G=s.P.convert(a.offset);let ae=_.centerPoint.add(G);const se=_.screenPointToLocation(ae),ve=this.cameraHelper.handleFlyTo(_,{bearing:B,pitch:j,roll:q,padding:X,locationAtOffset:se,offsetAsPoint:G,center:a.center,minZoom:a.minZoom,zoom:a.zoom});let _e=a.curve;const xe=Math.max(_.width,_.height),Ae=xe/ve.scaleOfZoom,Oe=ve.pixelPathLength;typeof ve.scaleOfMinZoom=="number"&&(_e=Math.sqrt(xe/ve.scaleOfMinZoom/Oe*2));const ke=_e*_e;function Be(Tt){const Wt=(Ae*Ae-xe*xe+(Tt?-1:1)*ke*ke*Oe*Oe)/(2*(Tt?Ae:xe)*ke*Oe);return Math.log(Math.sqrt(Wt*Wt+1)-Wt)}function je(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function Le(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}const nt=Be(!1);let lt=function(Tt){return Le(nt)/Le(nt+_e*Tt)},At=function(Tt){return xe*((Le(nt)*(je(Wt=nt+_e*Tt)/Le(Wt))-je(nt))/ke)/Oe;var Wt},St=(Be(!0)-nt)/_e;if(Math.abs(Oe)<2e-6||!isFinite(St)){if(Math.abs(xe-Ae)<1e-6)return this.easeTo(a,h);const Tt=Ae<xe?-1:1;St=Math.abs(Math.log(Ae/xe))/_e,At=()=>0,lt=Wt=>Math.exp(Tt*_e*Wt)}return a.duration="duration"in a?+a.duration:1e3*St/("screenSpeed"in a?+a.screenSpeed/_e:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=b!==B,this._pitching=j!==A,this._rolling=q!==C,this._padding=!_.isPaddingEqual(X),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ve.targetCenter),this._ease(Tt=>{const Wt=Tt*St,Ht=1/lt(Wt),Rt=At(Wt);this._rotating&&_.setBearing(s.B.number(b,B,Tt)),this._pitching&&_.setPitch(s.B.number(A,j,Tt)),this._rolling&&_.setRoll(s.B.number(C,q,Tt)),this._padding&&(_.interpolatePadding(D,X,Tt),ae=_.centerPoint.add(G)),ve.easeFunc(Tt,Ht,Rt,ae),this.terrain&&!a.freezeElevation&&this._updateElevation(Tt),this._applyUpdatedTransform(_),this._fireMoveEvents(h)},()=>{this.terrain&&a.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,h){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,h)}return a||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(a,h,_){_.animate===!1||_.duration===0?(a(1),h()):(this._easeStart=I.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,h){a=s.aL(a,-180,180);const _=Math.abs(a-h);return Math.abs(a-360-h)<_&&(a-=360),Math.abs(a+360-h)<_&&(a+=360),a}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(s.Q.convert(a),this.transform.tileZoom):null}}const ur={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xr{constructor(a=ur){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,h){const _=this._map._getUIString(`AttributionControl.${h}`);a.title=_,a.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(b=>typeof b!="string"?"":b)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const h=this._map.style.sourceCaches;for(const b in h){const A=h[b];if(A.used||A.usedForTerrain){const C=A.getSource();C.attribution&&a.indexOf(C.attribution)<0&&a.push(C.attribution)}}a=a.filter(b=>String(b).trim()),a.sort((b,A)=>b.length-A.length),a=a.filter((b,A)=>{for(let C=A+1;C<a.length;C++)if(a[C].indexOf(b)>=0)return!1;return!0});const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=k.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class lo{constructor(a={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const _=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const h=k.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class uu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const h=++this._id;return this._queue.push({callback:a,id:h,cancelled:!1}),h}remove(a){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const b of _)if(b.id===a)return void(b.cancelled=!0)}run(a=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Cf=s.aG([{name:"a_pos3d",type:"Int16",components:3}]);class da extends s.E{constructor(a){super(),this._lastTilesetChange=I.now(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=a._source.tileSize*2**this.deltaZoom,a.usedForTerrain=!0,a.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,h){this.sourceCache.update(a,h),this._renderableTilesKeys=[];const _={};for(const b of Ne(a,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.terrainRttPosMatrix32f=new Float64Array(16),s.bQ(b.terrainRttPosMatrix32f,0,s.Z,s.Z,0,0,1),this._tiles[b.key]=new Ci(b,this.tileSize),this._lastTilesetChange=I.now());for(const b in this._tiles)_[b]||delete this._tiles[b]}freeRtt(a){for(const h in this._tiles){const _=this._tiles[h];(!a||_.tileID.equals(a)||_.tileID.isChildOf(a)||a.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a,h){return h?this._getTerrainCoordsForTileRanges(a,h):this._getTerrainCoordsForRegularTile(a)}_getTerrainCoordsForRegularTile(a){const h={};for(const _ of this._renderableTilesKeys){const b=this._tiles[_].tileID,A=a.clone(),C=s.b2();if(b.canonical.equals(a.canonical))s.bQ(C,0,s.Z,s.Z,0,0,1);else if(b.canonical.isChildOf(a.canonical)){const D=b.canonical.z-a.canonical.z,B=b.canonical.x-(b.canonical.x>>D<<D),j=b.canonical.y-(b.canonical.y>>D<<D),q=s.Z>>D;s.bQ(C,0,q,q,0,0,1),s.L(C,C,[-B*q,-j*q,0])}else{if(!a.canonical.isChildOf(b.canonical))continue;{const D=a.canonical.z-b.canonical.z,B=a.canonical.x-(a.canonical.x>>D<<D),j=a.canonical.y-(a.canonical.y>>D<<D),q=s.Z>>D;s.bQ(C,0,s.Z,s.Z,0,0,1),s.L(C,C,[B*q,j*q,0]),s.M(C,C,[1/2**D,1/2**D,0])}}A.terrainRttPosMatrix32f=new Float32Array(C),h[_]=A}return h}_getTerrainCoordsForTileRanges(a,h){const _={};for(const b of this._renderableTilesKeys){const A=this._tiles[b].tileID;if(!this._isWithinTileRanges(A,h))continue;const C=a.clone(),D=s.b2();if(A.canonical.z===a.canonical.z){const B=a.canonical.x-A.canonical.x,j=a.canonical.y-A.canonical.y;s.bQ(D,0,s.Z,s.Z,0,0,1),s.L(D,D,[B*s.Z,j*s.Z,0])}else if(A.canonical.z>a.canonical.z){const B=A.canonical.z-a.canonical.z,j=A.canonical.x-(A.canonical.x>>B<<B),q=A.canonical.y-(A.canonical.y>>B<<B),X=a.canonical.x-(A.canonical.x>>B),G=a.canonical.y-(A.canonical.y>>B),ae=s.Z>>B;s.bQ(D,0,ae,ae,0,0,1),s.L(D,D,[-j*ae+X*s.Z,-q*ae+G*s.Z,0])}else{const B=a.canonical.z-A.canonical.z,j=a.canonical.x-(a.canonical.x>>B<<B),q=a.canonical.y-(a.canonical.y>>B<<B),X=(a.canonical.x>>B)-A.canonical.x,G=(a.canonical.y>>B)-A.canonical.y,ae=s.Z<<B;s.bQ(D,0,ae,ae,0,0,1),s.L(D,D,[j*s.Z+X*ae,q*s.Z+G*ae,0])}C.terrainRttPosMatrix32f=new Float32Array(D),_[b]=C}return _}getSourceTile(a,h){const _=this.sourceCache._source;let b=a.overscaledZ-this.deltaZoom;if(b>_.maxzoom&&(b=_.maxzoom),b<_.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(b).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!A||!A.dem)&&h)for(;b>=_.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(a.scaledTo(b--).key);return A}anyTilesAfterTime(a=Date.now()){return this._lastTilesetChange>=a}_isWithinTileRanges(a,h){return h[a.canonical.z]&&a.canonical.x>=h[a.canonical.z].minTileX&&a.canonical.x<=h[a.canonical.z].maxTileX&&a.canonical.y>=h[a.canonical.z].minTileY&&a.canonical.y<=h[a.canonical.z].maxTileY}}class Rf{constructor(a,h,_){this._meshCache={},this.painter=a,this.sourceCache=new da(h),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,h,_,b=s.Z){var A;if(!(h>=0&&h<b&&_>=0&&_<b))return 0;const C=this.getTerrainData(a),D=(A=C.tile)===null||A===void 0?void 0:A.dem;if(!D)return 0;const B=s.ch([],[h/b*s.Z,_/b*s.Z],C.u_terrain_matrix),j=[B[0]*D.dim,B[1]*D.dim],q=Math.floor(j[0]),X=Math.floor(j[1]),G=j[0]-q,ae=j[1]-X;return D.get(q,X)*(1-G)*(1-ae)+D.get(q+1,X)*G*(1-ae)+D.get(q,X+1)*(1-G)*ae+D.get(q+1,X+1)*G*ae}getElevationForLngLatZoom(a,h){if(!s.ci(h,a.wrap()))return 0;const{tileID:_,mercatorX:b,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(a,h);return this.getElevation(_,b%s.Z,A%s.Z,s.Z)}getElevation(a,h,_,b=s.Z){return this.getDEMElevation(a,h,_,b)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const b=this.painter.context,A=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new be(b,A,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new be(b,new s.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ad([])}const h=this.sourceCache.getSourceTile(a,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const b=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new be(b,h.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),h.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const _=h&&h+h.tileID.key+a.key;if(_&&!this._demMatrixCache[_]){const b=this.sourceCache.sourceCache._source.maxzoom;let A=a.canonical.z-h.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=b?A=a.canonical.z-b:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=a.canonical.x-(a.canonical.x>>A<<A),D=a.canonical.y-(a.canonical.y>>A<<A),B=s.cj(new Float64Array(16),[1/(s.Z<<A),1/(s.Z<<A),0]);s.L(B,B,[C*s.Z,D*s.Z,0]),this._demMatrixCache[a.key]={matrix:B,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(a){const h=this.painter,_=h.width/devicePixelRatio,b=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new be(h.context,{width:_,height:b,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new be(h.context,{width:_,height:b,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(_,b,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,_,b))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,C=0;A<this._coordsTextureSize;A++)for(let D=0;D<this._coordsTextureSize;D++,C+=4)h[C+0]=255&D,h[C+1]=255&A,h[C+2]=D>>8<<4|A>>8,h[C+3]=0;const _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),b=new be(a,_,a.gl.RGBA,{premultiply:!1});return b.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),_=this.painter.context,b=_.gl,A=Math.round(a.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(a.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(A,D-C-1,1,1,b.RGBA,b.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const B=h[0]+(h[2]>>4<<8),j=h[1]+((15&h[2])<<8),q=this.coordsIndex[255-h[3]],X=q&&this.sourceCache.getTileByID(q);if(!X)return null;const G=this._coordsTextureSize,ae=(1<<X.tileID.canonical.z)*G;return new s.$((X.tileID.canonical.x*G+B)/ae+X.tileID.wrap,(X.tileID.canonical.y*G+j)/ae,this.getElevation(X.tileID,B,j,G))}depthAtPoint(a){const h=new Uint8Array(4),_=this.painter.context,b=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(a){var h;const _=((h=this.painter.style.projection)===null||h===void 0?void 0:h.transitionState)>0,b=_&&a.canonical.y===0,A=_&&a.canonical.y===(1<<a.canonical.z)-1,C=`m_${b?"n":""}_${A?"s":""}`;if(this._meshCache[C])return this._meshCache[C];const D=this.painter.context,B=new s.ck,j=new s.aK,q=this.meshSize,X=s.Z/q,G=q*q;for(let Le=0;Le<=q;Le++)for(let nt=0;nt<=q;nt++)B.emplaceBack(nt*X,Le*X,0);for(let Le=0;Le<G;Le+=q+1)for(let nt=0;nt<q;nt++)j.emplaceBack(nt+Le,q+nt+Le+1,q+nt+Le+2),j.emplaceBack(nt+Le,q+nt+Le+2,nt+Le+1);const ae=B.length,se=ae+(q+1),ve=(q+1)*q,_e=b?s.b9:0,xe=b?0:1,Ae=A?s.ba:s.Z,Oe=A?0:1;for(let Le=0;Le<=q;Le++)B.emplaceBack(Le*X,_e,xe);for(let Le=0;Le<=q;Le++)B.emplaceBack(Le*X,Ae,Oe);for(let Le=0;Le<q;Le++)j.emplaceBack(ve+Le,se+Le,se+Le+1),j.emplaceBack(ve+Le,se+Le+1,ve+Le+1),j.emplaceBack(0+Le,ae+Le+1,ae+Le),j.emplaceBack(0+Le,0+Le+1,ae+Le+1);const ke=B.length,Be=ke+2*(q+1);for(const Le of[0,1])for(let nt=0;nt<=q;nt++)for(const lt of[0,1])B.emplaceBack(Le*s.Z,nt*X,lt);for(let Le=0;Le<2*q;Le+=2)j.emplaceBack(ke+Le,ke+Le+1,ke+Le+3),j.emplaceBack(ke+Le,ke+Le+3,ke+Le+2),j.emplaceBack(Be+Le,Be+Le+3,Be+Le+1),j.emplaceBack(Be+Le,Be+Le+2,Be+Le+3);const je=new ec(D.createVertexBuffer(B,Cf.members),D.createIndexBuffer(j),s.aJ.simpleSegment(0,0,B.length,j.length));return this._meshCache[C]=je,je}getMeshFrameDelta(a){return 2*Math.PI*s.bu/Math.pow(2,Math.max(a,0))/5}getMinTileElevationForLngLatZoom(a,h){var _;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(a,h);return(_=this.getMinMaxElevation(b).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(a){const h=this.getTerrainData(a).tile,_={minElevation:null,maxElevation:null};return h&&h.dem&&(_.minElevation=h.dem.min*this.exaggeration,_.maxElevation=h.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(a,h){const _=s.$.fromLngLat(a.wrap()),b=(1<<h)*s.Z,A=_.x*b,C=_.y*b,D=Math.floor(A/s.Z),B=Math.floor(C/s.Z);return{tileID:new s.Y(h,0,h,D,B),mercatorX:A,mercatorY:C}}}class Ji{constructor(a,h,_){this._context=a,this._size=h,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new be(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(_.texture),{id:a,fbo:h,texture:_,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>a.id!==h),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const Or={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Jr{constructor(a,h){this.painter=a,this.terrain=h,this.pool=new Ji(a.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(_=>!a._layers[_].isHidden(h)),this._coordsAscending={};for(const _ in a.sourceCaches){this._coordsAscending[_]={};const b=a.sourceCaches[_].getVisibleCoordinates(),A=a.sourceCaches[_].getSource(),C=A instanceof li?A.terrainTileRanges:null;for(const D of b){const B=this.terrain.sourceCache.getTerrainCoords(D,C);for(const j in B)this._coordsAscending[_][j]||(this._coordsAscending[_][j]=[]),this._coordsAscending[_][j].push(B[j])}}this._coordsAscendingStr={};for(const _ of a._order){const b=a._layers[_],A=b.source;if(Or[b.type]&&!this._coordsAscendingStr[A]){this._coordsAscendingStr[A]={};for(const C in this._coordsAscending[A])this._coordsAscendingStr[A][C]=this._coordsAscending[A][C].map(D=>D.key).sort().join()}}for(const _ of this._renderableTiles)for(const b in this._coordsAscendingStr){const A=this._coordsAscendingStr[b][_.tileID.key];A&&A!==_.rttCoords[b]&&(_.rtt=[])}}renderLayer(a,h){if(a.isHidden(this.painter.transform.zoom))return!1;const _=Object.assign(Object.assign({},h),{isRenderingToTexture:!0}),b=a.type,A=this.painter,C=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(Or[b]&&(this._prevType&&Or[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(a.id),!C))return!0;if(Or[this._prevType]||Or[b]&&C){this._prevType=b;const D=this._stacks.length-1,B=this._stacks[D]||[];for(const j of this._renderableTiles){if(this.pool.isFull()&&(xf(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(j),j.rtt[D]){const X=this.pool.getObjectForId(j.rtt[D].id);if(X.stamp===j.rtt[D].stamp){this.pool.useObject(X);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),j.rtt[D]={id:q.id,stamp:q.stamp},A.context.bindFramebuffer.set(q.fbo.framebuffer),A.context.clear({color:s.b7.transparent,stencil:0}),A.currentStencilSource=void 0;for(let X=0;X<B.length;X++){const G=A.style._layers[B[X]],ae=G.source?this._coordsAscending[G.source][j.tileID.key]:[j.tileID];A.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),A._renderTileClippingMasks(G,ae,!0),A.renderLayer(A,A.style.sourceCaches[G.source],G,ae,_),G.source&&(j.rttCoords[G.source]=this._coordsAscendingStr[G.source][j.tileID.key])}}return xf(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),Or[b]}return!1}}const Br={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Vn=m,Sl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ur,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},js={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class mc{constructor(a,h,_=!1){this.mousedown=A=>{this.startMove(A,k.mousePos(this.element,A)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.move(A,k.mousePos(this.element,A))},this.mouseup=A=>{this._rotatePitchHanlder.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,A.targetTouches)[0],this.startMove(A,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,A.targetTouches)[0],this.move(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=h;const b=new Gd;this._rotatePitchHanlder=new ns({clickTolerance:3,move:(A,C)=>{const D=h.getBoundingClientRect(),B=new s.P((D.bottom-D.top)/2,(D.right-D.left)/2);return{bearingDelta:s.cc(new s.P(A.x,C.y),C,B),pitchDelta:_?-.5*(C.y-A.y):void 0}},moveStateManager:b,enable:!0,assignEvents:()=>{}}),this.map=a,k.addEventListener(h,"mousedown",this.mousedown),k.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(h,"touchcancel",this.reset)}startMove(a,h){this._rotatePitchHanlder.dragStart(a,h),k.disableDrag()}move(a,h){const _=this.map,{bearingDelta:b,pitchDelta:A}=this._rotatePitchHanlder.dragMove(a,h)||{};b&&_.setBearing(_.getBearing()+b),A&&_.setPitch(_.getPitch()+A)}off(){const a=this.element;k.removeEventListener(a,"mousedown",this.mousedown),k.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let is;function ko(T,a,h,_=!1){if(_||!h.getCoveringTilesDetailsProvider().allowWorldCopies())return T==null?void 0:T.wrap();const b=new s.Q(T.lng,T.lat);if(T=new s.Q(T.lng,T.lat),a){const A=new s.Q(T.lng-360,T.lat),C=new s.Q(T.lng+360,T.lat),D=h.locationToScreenPoint(T).distSqr(a);h.locationToScreenPoint(A).distSqr(a)<D?T=A:h.locationToScreenPoint(C).distSqr(a)<D&&(T=C)}for(;Math.abs(T.lng-h.center.lng)>180;){const A=h.locationToScreenPoint(T);if(A.x>=0&&A.y>=0&&A.x<=h.width&&A.y<=h.height)break;T.lng>h.center.lng?T.lng-=360:T.lng+=360}return T.lng!==b.lng&&h.isPointOnMapSurface(h.locationToScreenPoint(T))?T:b}const hh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Rn(T,a,h){const _=T.classList;for(const b in hh)_.remove(`maplibregl-${h}-anchor-${b}`);_.add(`maplibregl-${h}-anchor-${a}`)}class gc extends s.E{constructor(a){if(super(),this._onKeyPress=h=>{const _=h.code,b=h.charCode||h.keyCode;_!=="Space"&&_!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=h=>{const _=h.originalEvent.target,b=this._element;this._popup&&(_===b||b.contains(_))&&this.togglePopup()},this._update=h=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!_)&&this._map.once("render",this._update),this._lngLat=ko(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${hh[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${b}`),I.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._subpixelPositioning=a&&a.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div");const h=k.createNS("http://www.w3.org/2000/svg","svg"),_=41,b=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${_}px`),h.setAttributeNS(null,"width",`${b}px`),h.setAttributeNS(null,"viewBox",`0 0 ${b} ${_}`);const A=k.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const C=k.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const D=k.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const xe of B){const Ae=k.createNS("http://www.w3.org/2000/svg","ellipse");Ae.setAttributeNS(null,"opacity","0.04"),Ae.setAttributeNS(null,"cx","10.5"),Ae.setAttributeNS(null,"cy","5.80029008"),Ae.setAttributeNS(null,"rx",xe.rx),Ae.setAttributeNS(null,"ry",xe.ry),D.appendChild(Ae)}const j=k.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill",this._color);const q=k.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),j.appendChild(q);const X=k.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const G=k.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(G);const ae=k.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ae.setAttributeNS(null,"fill","#FFFFFF");const se=k.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ve=k.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#000000"),ve.setAttributeNS(null,"opacity","0.25"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962");const _e=k.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#FFFFFF"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962"),se.appendChild(ve),se.appendChild(_e),C.appendChild(D),C.appendChild(j),C.appendChild(X),C.appendChild(ae),C.appendChild(se),h.appendChild(C),h.setAttributeNS(null,"height",_*this._scale+"px"),h.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(h),this._offset=s.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Rn(this._element,this._anchor,"marker"),a&&a.className)for(const h of a.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(a){return this.remove(),this._map=a,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",a._getUIString("Marker.Title")),a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),a.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.Q.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const b=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(a){return this._subpixelPositioning=a,this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(a=!1){var h,_;if(!(!((h=this._map)===null||h===void 0)&&h.terrain)){const X=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==X&&(this._element.style.opacity=X))}if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,A=b.terrain.depthAtPoint(this._pos),C=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,C)-A<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/b.transform.pixelsPerMeter,B=Math.sin(b.getPitch()*Math.PI/180)*D,j=b.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),q=b.transform.lngLatToCameraDepth(this._lngLat,C+B)-j>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,h){return(this._opacity===void 0||a===void 0&&h===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const fh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let _c=0,Al=!1;const Jd={maxWidth:100,unit:"metric"};function hu(T,a,h){const _=h&&h.maxWidth||100,b=T._container.clientHeight/2,A=T._container.clientWidth/2,C=T.unproject([A-_/2,b]),D=T.unproject([A+_/2,b]),B=Math.round(T.project(D).x-T.project(C).x),j=Math.min(_,B,T._container.clientWidth),q=C.distanceTo(D);if(h&&h.unit==="imperial"){const X=3.2808*q;X>5280?Do(a,j,X/5280,T._getUIString("ScaleControl.Miles")):Do(a,j,X,T._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Do(a,j,q/1852,T._getUIString("ScaleControl.NauticalMiles")):q>=1e3?Do(a,j,q/1e3,T._getUIString("ScaleControl.Kilometers")):Do(a,j,q,T._getUIString("ScaleControl.Meters"))}function Do(T,a,h,_){const b=function(A){const C=Math.pow(10,`${Math.floor(A)}`.length-1);let D=A/C;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(B){const j=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*j)/j}(D),C*D}(h);T.style.width=a*(b/h)+"px",T.innerHTML=`${b}&nbsp;${_}`}const dh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ea=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qn(T){if(T){if(typeof T=="number"){const a=Math.round(Math.abs(T)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,T),"top-left":new s.P(a,a),"top-right":new s.P(-a,a),bottom:new s.P(0,-T),"bottom-left":new s.P(a,-a),"bottom-right":new s.P(-a,-a),left:new s.P(T,0),right:new s.P(-T,0)}}if(T instanceof s.P||Array.isArray(T)){const a=s.P.convert(T);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:s.P.convert(T.center||[0,0]),top:s.P.convert(T.top||[0,0]),"top-left":s.P.convert(T["top-left"]||[0,0]),"top-right":s.P.convert(T["top-right"]||[0,0]),bottom:s.P.convert(T.bottom||[0,0]),"bottom-left":s.P.convert(T["bottom-left"]||[0,0]),"bottom-right":s.P.convert(T["bottom-right"]||[0,0]),left:s.P.convert(T.left||[0,0]),right:s.P.convert(T.right||[0,0])}}return Qn(new s.P(0,0))}const ph=m;c.AJAXError=s.co,c.Event=s.l,c.Evented=s.E,c.LngLat=s.Q,c.MercatorCoordinate=s.$,c.Point=s.P,c.addProtocol=s.cp,c.config=s.a,c.removeProtocol=s.cq,c.AttributionControl=xr,c.BoxZoomHandler=vm,c.CanvasSource=Ei,c.CooperativeGesturesHandler=oo,c.DoubleClickZoomHandler=Qd,c.DragPanHandler=cn,c.DragRotateHandler=pc,c.EdgeInsets=tc,c.FullscreenControl=class extends s.E{constructor(T={}){super(),this._onFullscreenChange=()=>{var a;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=h==null?void 0:h.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,T&&T.container&&(T.container instanceof HTMLElement?this._container=T.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(T){return this._map=T,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const T=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",T).setAttribute("aria-hidden","true"),T.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const T=this._getTitle();this._fullscreenButton.setAttribute("aria-label",T),this._fullscreenButton.title=T}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=aa,c.GeolocateControl=class extends s.E{constructor(T){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",a)),this._finish()}},this._updateCamera=a=>{const h=new s.Q(a.coords.longitude,a.coords.latitude),_=a.coords.accuracy,b=this._map.getBearing(),A=s.e({bearing:b},this.options.fitBoundsOptions),C=Vt.fromLngLat(h,_);this._map.fitBounds(C,A,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const h=new s.Q(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&Al)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=a=>{if(this._map){if(a===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gc({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},fh,T)}onAdd(T){return this._map=T,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(a=!1){if(is!==void 0&&!a)return is;if(window.navigator.permissions===void 0)return is=!!window.navigator.geolocation,is;try{is=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{is=!!window.navigator.geolocation}return is})}().then(a=>this._finishSetupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,_c=0,Al=!1}_isOutOfMapMaxBounds(T){const a=this._map.getMaxBounds(),h=T.coords;return a&&(h.longitude<a.getWest()||h.longitude>a.getEast()||h.latitude<a.getSouth()||h.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const T=this._map.getBounds(),a=T.getSouthEast(),h=T.getNorthEast(),_=a.distanceTo(h),b=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":_c--,Al=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let T;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),_c++,_c>1?(T={maximumAge:6e5,timeout:0},Al=!0):(T=this.options.positionOptions,Al=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,T)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.GlobeControl=class{constructor(){this._toggleProjection=()=>{var T;const a=(T=this._map.getProjection())===null||T===void 0?void 0:T.type;this._map.setProjection(a!=="mercator"&&a?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var T;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((T=this._map.getProjection())===null||T===void 0?void 0:T.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(T){return this._map=T,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=k.create("button","maplibregl-ctrl-globe",this._container),k.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},c.Hash=Tf,c.ImageSource=li,c.KeyboardHandler=lh,c.LngLatBounds=Vt,c.LogoControl=lo,c.Map=class extends Tl{constructor(T){var a,h;s.cl.mark(s.cm.create);const _=Object.assign(Object.assign(Object.assign({},Sl),T),{canvasContextAttributes:Object.assign(Object.assign({},Sl.canvasContextAttributes),T.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const b=new ja,A=new ys;if(_.minZoom!==void 0&&b.setMinZoom(_.minZoom),_.maxZoom!==void 0&&b.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&b.setMinPitch(_.minPitch),_.maxPitch!==void 0&&b.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&b.setRenderWorldCopies(_.renderWorldCopies),super(b,A,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new uu,this._controls=[],this._mapId=s.a4(),this._contextLost=D=>{D.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:D}))},this._contextRestored=D=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:D}))},this._onMapScroll=D=>{if(D.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Br),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=re.addThrottleControl(()=>this.isMoving()),this._requestManager=new W(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let D=!1;const B=uc(j=>{this._trackResize&&!this._removed&&(this.resize(j),this.redraw())},50);this._resizeObserver=new ResizeObserver(j=>{D?B(j):D=!0}),this._resizeObserver.observe(this._container)}this.handlers=new qa(this,_),this._hash=_.hash&&new Tf(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,s.e({},_.fitBoundsOptions,{duration:0}))));const C=typeof _.style=="string"||((h=(a=_.style)===null||a===void 0?void 0:a.projection)===null||h===void 0?void 0:h.type)!=="globe";this.resize(null,C),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new xr(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new lo,_.logoPosition),this.on("style.load",()=>{if(C||this._resizeTransform(),this.transform.unmodified){const D=s.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(D)}}),this.on("data",D=>{this._update(D.dataType==="style"),this.fire(new s.l(`${D.dataType}data`,D))}),this.on("dataloading",D=>{this.fire(new s.l(`${D.dataType}dataloading`,D))}),this.on("dataabort",D=>{this.fire(new s.l("sourcedataabort",D))})}_getMapId(){return this._mapId}addControl(T,a){if(a===void 0&&(a=T.getDefaultPosition?T.getDefaultPosition():"top-right"),!T||!T.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=T.onAdd(this);this._controls.push(T);const _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(T){if(!T||!T.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(T);return a>-1&&this._controls.splice(a,1),T.onRemove(this),this}hasControl(T){return this._controls.indexOf(T)>-1}calculateCameraOptionsFromTo(T,a,h,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(T,a,h,_)}resize(T,a=!0){const[h,_]=this._containerDimensions(),b=this._getClampedPixelRatio(h,_);if(this._resizeCanvas(h,_,b),this.painter.resize(h,_,b),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const D=this._getClampedPixelRatio(h,_);this._resizeCanvas(h,_,D),this.painter.resize(h,_,D)}this._resizeTransform(a);const A=!this._moving;return A&&(this.stop(),this.fire(new s.l("movestart",T)).fire(new s.l("move",T))),this.fire(new s.l("resize",T)),A&&this.fire(new s.l("moveend",T)),this}_resizeTransform(T=!0){var a;const[h,_]=this._containerDimensions();this.transform.resize(h,_,T),(a=this._requestedCameraState)===null||a===void 0||a.resize(h,_,T)}_getClampedPixelRatio(T,a){const{0:h,1:_}=this._maxCanvasSize,b=this.getPixelRatio(),A=T*b,C=a*b;return Math.min(A>h?h/A:1,C>_?_/C:1)*b}getPixelRatio(){var T;return(T=this._overridePixelRatio)!==null&&T!==void 0?T:devicePixelRatio}setPixelRatio(T){this._overridePixelRatio=T,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(T){return this.transform.setMaxBounds(Vt.convert(T)),this._update()}setMinZoom(T){if((T=T??-2)>=-2&&T<=this.transform.maxZoom)return this.transform.setMinZoom(T),this._update(),this.getZoom()<T&&this.setZoom(T),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(T){if((T=T??22)>=this.transform.minZoom)return this.transform.setMaxZoom(T),this._update(),this.getZoom()>T&&this.setZoom(T),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(T){if((T=T??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(T>=0&&T<=this.transform.maxPitch)return this.transform.setMinPitch(T),this._update(),this.getPitch()<T&&this.setPitch(T),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(T){if((T=T??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(T>=this.transform.minPitch)return this.transform.setMaxPitch(T),this._update(),this.getPitch()>T&&this.setPitch(T),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(T){return this.transform.setRenderWorldCopies(T),this._update()}project(T){return this.transform.locationToScreenPoint(s.Q.convert(T),this.style&&this.terrain)}unproject(T){return this.transform.screenPointToLocation(s.P.convert(T),this.terrain)}isMoving(){var T;return this._moving||((T=this.handlers)===null||T===void 0?void 0:T.isMoving())}isZooming(){var T;return this._zooming||((T=this.handlers)===null||T===void 0?void 0:T.isZooming())}isRotating(){var T;return this._rotating||((T=this.handlers)===null||T===void 0?void 0:T.isRotating())}_createDelegatedListener(T,a,h){if(T==="mouseenter"||T==="mouseover"){let _=!1;return{layers:a,listener:h,delegates:{mousemove:A=>{const C=a.filter(B=>this.getLayer(B)),D=C.length!==0?this.queryRenderedFeatures(A.point,{layers:C}):[];D.length?_||(_=!0,h.call(this,new Qi(T,this,A.originalEvent,{features:D}))):_=!1},mouseout:()=>{_=!1}}}}if(T==="mouseleave"||T==="mouseout"){let _=!1;return{layers:a,listener:h,delegates:{mousemove:C=>{const D=a.filter(B=>this.getLayer(B));(D.length!==0?this.queryRenderedFeatures(C.point,{layers:D}):[]).length?_=!0:_&&(_=!1,h.call(this,new Qi(T,this,C.originalEvent)))},mouseout:C=>{_&&(_=!1,h.call(this,new Qi(T,this,C.originalEvent)))}}}}{const _=b=>{const A=a.filter(D=>this.getLayer(D)),C=A.length!==0?this.queryRenderedFeatures(b.point,{layers:A}):[];C.length&&(b.features=C,h.call(this,b),delete b.features)};return{layers:a,listener:h,delegates:{[T]:_}}}}_saveDelegatedListener(T,a){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[T]=this._delegatedListeners[T]||[],this._delegatedListeners[T].push(a)}_removeDelegatedListener(T,a,h){if(!this._delegatedListeners||!this._delegatedListeners[T])return;const _=this._delegatedListeners[T];for(let b=0;b<_.length;b++){const A=_[b];if(A.listener===h&&A.layers.length===a.length&&A.layers.every(C=>a.includes(C))){for(const C in A.delegates)this.off(C,A.delegates[C]);return void _.splice(b,1)}}}on(T,a,h){if(h===void 0)return super.on(T,a);const _=typeof a=="string"?[a]:a,b=this._createDelegatedListener(T,_,h);this._saveDelegatedListener(T,b);for(const A in b.delegates)this.on(A,b.delegates[A]);return{unsubscribe:()=>{this._removeDelegatedListener(T,_,h)}}}once(T,a,h){if(h===void 0)return super.once(T,a);const _=typeof a=="string"?[a]:a,b=this._createDelegatedListener(T,_,h);for(const A in b.delegates){const C=b.delegates[A];b.delegates[A]=(...D)=>{this._removeDelegatedListener(T,_,h),C(...D)}}this._saveDelegatedListener(T,b);for(const A in b.delegates)this.once(A,b.delegates[A]);return this}off(T,a,h){return h===void 0?super.off(T,a):(this._removeDelegatedListener(T,typeof a=="string"?[a]:a,h),this)}queryRenderedFeatures(T,a){if(!this.style)return[];let h;const _=T instanceof s.P||Array.isArray(T),b=_?T:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(_?{}:T)||{},b instanceof s.P||typeof b[0]=="number")h=[s.P.convert(b)];else{const A=s.P.convert(b[0]),C=s.P.convert(b[1]);h=[A,new s.P(C.x,A.y),C,new s.P(A.x,C.y),A]}return this.style.queryRenderedFeatures(h,a,this.transform)}querySourceFeatures(T,a){return this.style.querySourceFeatures(T,a)}setStyle(T,a){return(a=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&T?(this._diffStyle(T,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(T,a))}setTransformRequest(T){return this._requestManager.setTransformRequest(T),this}_getUIString(T){const a=this._locale[T];if(a==null)throw new Error(`Missing UI string '${T}'`);return a}_updateStyle(T,a){var h,_;if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(T,a));const b=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!T)),T?(this.style=new Hu(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof T=="string"?this.style.loadURL(T,a,b):this.style.loadJSON(T,a,b),this):((_=(h=this.style)===null||h===void 0?void 0:h.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(T,a){if(typeof T=="string"){const h=this._requestManager.transformRequest(T,"Style");s.j(h,new AbortController).then(_=>{this._updateDiff(_.data,a)}).catch(_=>{_&&this.fire(new s.k(_))})}else typeof T=="object"&&this._updateDiff(T,a)}_updateDiff(T,a){try{this.style.setState(T,a)&&this._update(!0)}catch(h){s.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(T,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(T,a){return this._lazyInitEmptyStyle(),this.style.addSource(T,a),this._update(!0)}isSourceLoaded(T){const a=this.style&&this.style.sourceCaches[T];if(a!==void 0)return a.loaded();this.fire(new s.k(new Error(`There is no source with ID '${T}'`)))}setTerrain(T){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),T){const a=this.style.sourceCaches[T.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${T.source}`);this.terrain===null&&a.reload();for(const h in this.style._layers){const _=this.style._layers[h];_.type==="hillshade"&&_.source===T.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Rf(this.painter,a,T),this.painter.renderToTexture=new Jr(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=h=>{var _;h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==T.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=h.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:T})),this}getTerrain(){var T,a;return(a=(T=this.terrain)===null||T===void 0?void 0:T.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const T=this.style&&this.style.sourceCaches;for(const a in T){const h=T[a]._tiles;for(const _ in h){const b=h[_];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(T){return this.style.removeSource(T),this._update(!0)}getSource(T){return this.style.getSource(T)}setSourceTileLodParams(T,a,h){if(h){const _=this.getSource(h);if(!_)throw new Error(`There is no source with ID "${h}", cannot set LOD parameters`);_.calculateTileZoom=fe(Math.max(1,T),Math.max(1,a))}else for(const _ in this.style.sourceCaches)this.style.sourceCaches[_].getSource().calculateTileZoom=fe(Math.max(1,T),Math.max(1,a));return this._update(!0),this}addImage(T,a,h={}){const{pixelRatio:_=1,sdf:b=!1,stretchX:A,stretchY:C,content:D,textFitWidth:B,textFitHeight:j}=h;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||s.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:X,data:G}=a,ae=a;return this.style.addImage(T,{data:new s.R({width:q,height:X},new Uint8Array(G)),pixelRatio:_,stretchX:A,stretchY:C,content:D,textFitWidth:B,textFitHeight:j,sdf:b,version:0,userImage:ae}),ae.onAdd&&ae.onAdd(this,T),this}}{const{width:q,height:X,data:G}=I.getImageData(a);this.style.addImage(T,{data:new s.R({width:q,height:X},G),pixelRatio:_,stretchX:A,stretchY:C,content:D,textFitWidth:B,textFitHeight:j,sdf:b,version:0})}}updateImage(T,a){const h=this.style.getImage(T);if(!h)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof HTMLImageElement||s.b(a)?I.getImageData(a):a,{width:b,height:A,data:C}=_;if(b===void 0||A===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==h.data.width||A!==h.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(a instanceof HTMLImageElement||s.b(a));return h.data.replace(C,D),this.style.updateImage(T,h),this}getImage(T){return this.style.getImage(T)}hasImage(T){return T?!!this.style.getImage(T):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(T){this.style.removeImage(T)}loadImage(T){return re.getImage(this._requestManager.transformRequest(T,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(T,a){return this._lazyInitEmptyStyle(),this.style.addLayer(T,a),this._update(!0)}moveLayer(T,a){return this.style.moveLayer(T,a),this._update(!0)}removeLayer(T){return this.style.removeLayer(T),this._update(!0)}getLayer(T){return this.style.getLayer(T)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(T,a,h){return this.style.setLayerZoomRange(T,a,h),this._update(!0)}setFilter(T,a,h={}){return this.style.setFilter(T,a,h),this._update(!0)}getFilter(T){return this.style.getFilter(T)}setPaintProperty(T,a,h,_={}){return this.style.setPaintProperty(T,a,h,_),this._update(!0)}getPaintProperty(T,a){return this.style.getPaintProperty(T,a)}setLayoutProperty(T,a,h,_={}){return this.style.setLayoutProperty(T,a,h,_),this._update(!0)}getLayoutProperty(T,a){return this.style.getLayoutProperty(T,a)}setGlyphs(T,a={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(T,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(T,a,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(T,a,h,_=>{_||this._update(!0)}),this}removeSprite(T){return this._lazyInitEmptyStyle(),this.style.removeSprite(T),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(T,a={}){return this._lazyInitEmptyStyle(),this.style.setSprite(T,a,h=>{h||this._update(!0)}),this}setLight(T,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(T,a),this._update(!0)}getLight(){return this.style.getLight()}setSky(T,a={}){return this._lazyInitEmptyStyle(),this.style.setSky(T,a),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(T,a){return this.style.setFeatureState(T,a),this._update()}removeFeatureState(T,a){return this.style.removeFeatureState(T,a),this._update()}getFeatureState(T){return this.style.getFeatureState(T)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let T=0,a=0;return this._container&&(T=this._container.clientWidth||400,a=this._container.clientHeight||300),[T,a]}_setupContainer(){const T=this._container;T.classList.add("maplibregl-map");const a=this._canvasContainer=k.create("div","maplibregl-canvas-container",T);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),_=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],_);const b=this._controlContainer=k.create("div","maplibregl-control-container",T),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{A[C]=k.create("div",`maplibregl-ctrl-${C} `,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(T,a,h){this._canvas.width=Math.floor(h*T),this._canvas.height=Math.floor(h*a),this._canvas.style.width=`${T}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const T=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let a=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{a={requestedAttributes:T},_&&(a.statusMessage=_.statusMessage,a.type=_.type)},{once:!0});let h=null;if(h=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,T):this._canvas.getContext("webgl2",T)||this._canvas.getContext("webgl",T),!h){const _="Failed to initialize WebGL";throw a?(a.message=_,new Error(JSON.stringify(a))):new Error(_)}this.painter=new ou(h,this.transform),z.testSupport(h)}migrateProjection(T,a){super.migrateProjection(T,a),this.painter.transform=T,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(T){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||T,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(T){return this._update(),this._renderTaskQueue.add(T)}_cancelRenderFrame(T){this._renderTaskQueue.remove(T)}_render(T){var a,h,_,b,A;const C=this._idleTriggered?this._fadeDuration:0,D=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(T),this._removed)return;let B=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const X=this.transform.zoom,G=I.now();this.style.zoomHistory.update(X,G);const ae=new s.C(X,{now:G,fadeDuration:C,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=ae.crossFadingFactor();se===1&&se===this._crossFadingFactor||(B=!0,this._crossFadingFactor=se),this.style.update(ae)}const j=((h=this.style.projection)===null||h===void 0?void 0:h.transitionState)>0!==D;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((b=this.style.projection)===null||b===void 0?void 0:b.transitionState,(A=this.style.projection)===null||A===void 0?void 0:A.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||j)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,C,this._crossSourceCollisions,j),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:C,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cl.mark(s.cm.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||B)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const q=this._sourcesDirty||this._styleDirty||this._placementDirty;return q||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||q||(this._fullyLoaded=!0,s.cl.mark(s.cm.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var T;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),re.removeThrottleControl(this._imageQueueHandle),(T=this._resizeObserver)===null||T===void 0||T.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a!=null&&a.loseContext&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cl.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,I.frame(this._frameRequest,T=>{s.cl.frame(T),this._frameRequest=null;try{this._render(T)}catch(a){if(!s.cn(a)&&!function(h){return h.message===yf}(a))throw a}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(T){this._showTileBoundaries!==T&&(this._showTileBoundaries=T,this._update())}get showPadding(){return!!this._showPadding}set showPadding(T){this._showPadding!==T&&(this._showPadding=T,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(T){this._showCollisionBoxes!==T&&(this._showCollisionBoxes=T,T?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(T){this._showOverdrawInspector!==T&&(this._showOverdrawInspector=T,this._update())}get repaint(){return!!this._repaint}set repaint(T){this._repaint!==T&&(this._repaint=T,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(T){this._vertices=T,this._update()}get version(){return Vn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(T){return this._lazyInitEmptyStyle(),this.style.setProjection(T),this._update(!0)}},c.MapMouseEvent=Qi,c.MapTouchEvent=ui,c.MapWheelEvent=Cn,c.Marker=gc,c.NavigationControl=class{constructor(T){this._updateZoomButtons=()=>{const a=this._map.getZoom(),h=a===this._map.getMaxZoom(),_=a===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(a,h)=>{const _=this._map._getUIString(`NavigationControl.${h}`);a.title=_,a.setAttribute("aria-label",_)},this.options=s.e({},js,T),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(T){return this._map=T,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(T,a){const h=k.create("button",T,this._container);return h.type="button",h.addEventListener("click",a),h}},c.Popup=class extends s.E{constructor(T){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=ko(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!a)return;const h=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationToScreenPoint(this._lngLat));let _=this.options.anchor;const b=Qn(this.options.offset);if(!_){const C=this._container.offsetWidth,D=this._container.offsetHeight;let B;B=h.y+b.bottom.y<D?["top"]:h.y>this._map.transform.height-D?["bottom"]:[],h.x<C/2?B.push("left"):h.x>this._map.transform.width-C/2&&B.push("right"),_=B.length===0?"bottom":B.join("-")}let A=h.add(b[_]);this.options.subpixelPositioning||(A=A.round()),k.setTransform(this._container,`${hh[_]} translate(${A.x}px,${A.y}px)`),Rn(this._container,_,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(dh),T)}addTo(T){return this._map&&this.remove(),this._map=T,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(T){return this._lngLat=s.Q.convert(T),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(T){return this.setDOMContent(document.createTextNode(T))}setHTML(T){const a=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=T;_=h.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){var T;return(T=this._container)===null||T===void 0?void 0:T.style.maxWidth}setMaxWidth(T){return this.options.maxWidth=T,this._update(),this}setDOMContent(T){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(T),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(T){return this._container&&this._container.classList.add(T),this}removeClassName(T){return this._container&&this._container.classList.remove(T),this}setOffset(T){return this.options.offset=T,this._update(),this}toggleClassName(T){if(this._container)return this._container.classList.toggle(T)}setSubpixelPositioning(T){this.options.subpixelPositioning=T}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const T=this._container.querySelector(ea);T&&T.focus()}},c.RasterDEMTileSource=En,c.RasterTileSource=fr,c.ScaleControl=class{constructor(T){this._onMove=()=>{hu(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,hu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Jd),T)}getDefaultPosition(){return"bottom-left"}onAdd(T){return this._map=T,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",T.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=dc,c.Style=Hu,c.TerrainControl=class{constructor(T){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=T}onAdd(T){return this._map=T,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=oh,c.TwoFingersTouchRotateHandler=wl,c.TwoFingersTouchZoomHandler=fc,c.TwoFingersTouchZoomRotateHandler=zs,c.VectorTileSource=rr,c.VideoSource=Kn,c.addSourceType=(T,a)=>s._(void 0,void 0,void 0,function*(){if(el(T))throw new Error(`A source type called "${T}" already exists.`);((h,_)=>{Mi[h]=_})(T,a)}),c.clearPrewarmedResources=function(){const T=Yt;T&&(T.isPreloaded()&&T.numActive()===1?(T.release(ft),Yt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.createTileMesh=rf,c.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return Xi().getRTLTextPluginStatus()},c.getVersion=function(){return ph},c.getWorkerCount=function(){return vt.workerCount},c.getWorkerUrl=function(){return s.a.WORKER_URL},c.importScriptInWorkers=function(T){return Ft().broadcast("IS",T)},c.prewarm=function(){Pt().acquire(ft)},c.setMaxParallelImageRequests=function(T){s.a.MAX_PARALLEL_IMAGE_REQUESTS=T},c.setRTLTextPlugin=function(T,a){return Xi().setRTLTextPlugin(T,a)},c.setWorkerCount=function(T){vt.workerCount=T},c.setWorkerUrl=function(T){s.a.WORKER_URL=T}});var o=r;return o})}(m0)),m0.exports}var HB=n5();const WB=Yn(HB),i5=TU({__proto__:null,default:WB},[HB]);function w0(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const KM=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Q3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Q3&&parseFloat(Q3[1]);const $b=globalThis,lg=globalThis.process||{},a5=globalThis.navigator||{};function ZB(t){var n,i;if(typeof window<"u"&&((n=window.process)==null?void 0:n.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const r=typeof navigator<"u"&&navigator.userAgent;return!!(r&&r.indexOf("Electron")>=0)}function tm(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ZB()}function s5(t){return tm()?ZB()?"Electron":(a5.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const XB="4.1.0";function o5(t){try{const e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}class l5{constructor(e,r,n="sessionStorage"){this.storage=o5(n),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){const r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}}function c5(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function u5(t,e=8){const r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var T0;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(T0||(T0={}));const h5=10;function J3(t){return typeof t!="string"?t:(t=t.toUpperCase(),T0[t]||T0.WHITE)}function f5(t,e,r){return!tm&&typeof t=="string"&&(e&&(t=`\x1B[${J3(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${J3(r)+h5}m${t}\x1B[49m`)),t}function d5(t,e=["constructor"]){const r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),i=t;for(const o of n){const c=i[o];typeof c=="function"&&(e.find(s=>o===s)||(i[o]=c.bind(t)))}}function QM(t,e){if(!t)throw new Error("Assertion failed")}function cg(){var e,r,n;let t;if(tm()&&$b.performance)t=(r=(e=$b==null?void 0:$b.performance)==null?void 0:e.now)==null?void 0:r.call(e);else if("hrtime"in lg){const i=(n=lg==null?void 0:lg.hrtime)==null?void 0:n.call(lg);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const ug={debug:tm()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},p5={enabled:!0,level:0};function hg(){}const eC={},tC={once:!0};class Fv{constructor({id:e}={id:""}){this.VERSION=XB,this._startTs=cg(),this._deltaTs=cg(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new l5(`__probe-${this.id}__`,p5),this.timeStamp(`${this.id} started`),d5(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((cg()-this._startTs).toPrecision(10))}getDelta(){return Number((cg()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ug.warn,arguments,tC)}error(e){return this._getLogFunction(0,e,ug.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,ug.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,ug.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,ug.debug||ug.info,arguments,tC)}table(e,r,n){return r?this._getLogFunction(e,r,console.table||hg,n&&[n],{tag:g5(r)}):hg}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||hg)}group(e,r,n={collapsed:!1}){const i=rC({logLevel:e,message:r,opts:n}),{collapsed:o}=n;return i.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,r,n={}){return this.group(e,r,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||hg)}withGroup(e,r,n){this.group(e,r)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=GB(e)}_getLogFunction(e,r,n,i,o){if(this._shouldLog(e)){o=rC({logLevel:e,message:r,args:i,opts:o}),n=n||o.method,QM(n),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=cg();const c=o.tag||o.message;if(o.once&&c)if(!eC[c])eC[c]=cg();else return hg;return r=m5(this.id,o.message,o),n.bind(console,r,...o.args)}return hg}}Fv.VERSION=XB;function GB(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return QM(Number.isFinite(e)&&e>=0),e}function rC(t){const{logLevel:e,message:r}=t;t.logLevel=GB(e);const n=t.args?Array.from(t.args):[];for(;n.length&&n.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return QM(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function m5(t,e,r){if(typeof e=="string"){const n=r.time?u5(c5(r.total)):"";e=r.time?`${t}: ${n}  ${e}`:`${t}: ${e}`,e=f5(e,r.color,r.background)}return e}function g5(t){for(const e in t)for(const r in t[e])return r||"untitled";return"empty"}const cw="4.3.2",_5=cw[0]>="0"&&cw[0]<="9"?`v${cw}`:"";function y5(){const t=new Fv({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=_5,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const v5=y5();function b5(t,e){return YB(t||{},e)}function YB(t,e,r=0){if(r>3)return e;const n={...t};for(const[i,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?n[i]=YB(n[i]||{},e[i],r+1):n[i]=e[i];return n}const x5="latest";function w5(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const T5=w5();function yd(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Fp=typeof process!="object"||String(process)!=="[object process]"||process.browser,S5=typeof window<"u"&&typeof window.orientation<"u",nC=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);nC&&parseFloat(nC[1]);class A5{constructor(e,r){de(this,"name");de(this,"workerThread");de(this,"isRunning",!0);de(this,"result");de(this,"_resolve",()=>{});de(this,"_reject",()=>{});this.name=e,this.workerThread=r,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){yd(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){yd(this.isRunning),this.isRunning=!1,this._reject(e)}}class uw{terminate(){}}const hw=new Map;function E5(t){yd(t.source&&!t.url||!t.source&&t.url);let e=hw.get(t.source||t.url);return e||(t.url&&(e=M5(t.url),hw.set(t.url,e)),t.source&&(e=KB(t.source),hw.set(t.source,e))),yd(e),e}function M5(t){if(!t.startsWith("http"))return t;const e=P5(t);return KB(e)}function KB(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function P5(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function QB(t,e=!0,r){const n=r||new Set;if(t){if(iC(t))n.add(t);else if(iC(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)QB(t[i],e,n)}}return r===void 0?Array.from(n):[]}function iC(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const fw=()=>{};class $A{constructor(e){de(this,"name");de(this,"source");de(this,"url");de(this,"terminated",!1);de(this,"worker");de(this,"onMessage");de(this,"onError");de(this,"_loadableURL","");const{name:r,source:n,url:i}=e;yd(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=fw,this.onError=o=>console.log(o),this.worker=Fp?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Fp||typeof uw<"u"&&!Fp}destroy(){this.onMessage=fw,this.onError=fw,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||QB(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=E5({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new uw(n,{eval:!1})}else if(this.source)e=new uw(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}}class C5{constructor(e){de(this,"name","unnamed");de(this,"source");de(this,"url");de(this,"maxConcurrency",1);de(this,"maxMobileConcurrency",1);de(this,"onDebug",()=>{});de(this,"reuseWorkers",!0);de(this,"props",{});de(this,"jobQueue",[]);de(this,"idleQueue",[]);de(this,"count",0);de(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return $A.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(i,o,c)=>i.done(c),n=(i,o)=>i.error(o)){const i=new Promise(o=>(this.jobQueue.push({name:e,onMessage:r,onError:n,onStart:o}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const n=new A5(r.name,e);e.onMessage=i=>r.onMessage(n,i.type,i.payload),e.onError=i=>r.onError(n,i),r.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Fp||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new $A({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return S5?this.maxMobileConcurrency:this.maxConcurrency}}const R5={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},sd=class sd{constructor(e){de(this,"props");de(this,"workerPools",new Map);this.props={...R5},this.setProps(e),this.workerPools=new Map}static isSupported(){return $A.isSupported()}static getWorkerFarm(e={}){return sd._workerFarm=sd._workerFarm||new sd({}),sd._workerFarm.setProps(e),sd._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:n,url:i}=e;let o=this.workerPools.get(r);return o||(o=new C5({name:r,source:n,url:i}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};de(sd,"_workerFarm");let S0=sd;function I5(t,e={}){const r=e[t.id]||{},n=Fp?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=r.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Fp?i=`modules/${t.module}/dist/${n}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let o=t.version;o==="latest"&&(o=x5);const c=o?`@${o}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${n}`}return yd(i),i}function O5(t,e=T5){yd(t,"no worker provided");const r=t.version;return!(!e||!r)}function k5(t,e){return!S0.isSupported()||!Fp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function D5(t,e,r,n,i){const o=t.id,c=I5(t,r),m=S0.getWorkerFarm(r).getWorkerPool({name:o,url:c});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));const v=await m.startJob("process-on-worker",N5.bind(null,i));return v.postMessage("process",{input:e,options:r,context:n}),await(await v.result).result}async function N5(t,e,r,n){switch(r){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:o,options:c}=n;try{const s=await t(o,c);e.postMessage("done",{id:i,result:s})}catch(s){const m=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:i,error:m})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function B5(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;const n=new Uint8Array(t),i=new Uint8Array(e);for(let o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function L5(...t){return F5(t)}function F5(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,c)=>o+c.byteLength,0),n=new Uint8Array(r);let i=0;for(const o of e)n.set(o,i),i+=o.byteLength;return n.buffer}async function z5(t){const e=[];for await(const r of t)e.push(r);return L5(...e)}function aC(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class sC{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=aC(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(aC()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class l1{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const r of Object.values(this.stats))e(r)}getTable(){const e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){const{name:r,type:n}=e;let i=this.stats[r];return i||(e instanceof sC?i=e:i=new sC(r,n),this.stats[r]=i),i}}let j5="";const oC={};function U5(t){for(const e in oC)if(t.startsWith(e)){const r=oC[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${j5}${t}`),t}function $5(t){return t&&typeof t=="object"&&t.isBuffer}function JB(t){if($5(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function eL(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function V5(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const q5=t=>typeof t=="boolean",By=t=>typeof t=="function",zv=t=>t!==null&&typeof t=="object",lC=t=>zv(t)&&t.constructor==={}.constructor,H5=t=>!!t&&typeof t[Symbol.iterator]=="function",W5=t=>t&&typeof t[Symbol.asyncIterator]=="function",rm=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,nm=t=>typeof Blob<"u"&&t instanceof Blob,Z5=t=>t&&typeof t=="object"&&t.isBuffer,X5=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||zv(t)&&By(t.tee)&&By(t.cancel)&&By(t.getReader),G5=t=>zv(t)&&By(t.read)&&By(t.pipe)&&q5(t.readable),tL=t=>X5(t)||G5(t);class Y5 extends Error{constructor(r,n){super(r);de(this,"reason");de(this,"url");de(this,"response");this.reason=n.reason,this.url=n.url,this.response=n.response}}const K5=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Q5=/^([-\w.]+\/[-\w.+]+)/;function cC(t,e){return t.toLowerCase()===e.toLowerCase()}function J5(t){const e=Q5.exec(t);return e?e[1]:t}function uC(t){const e=K5.exec(t);return e?e[1]:""}const rL=/\?.*/;function e8(t){const e=t.match(rL);return e&&e[0]}function JM(t){return t.replace(rL,"")}function t8(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function c1(t){return rm(t)?t.url:nm(t)?t.name||"":typeof t=="string"?t:""}function eP(t){if(rm(t)){const e=t,r=e.headers.get("content-type")||"",n=JM(e.url);return J5(r)||uC(n)}return nm(t)?t.type||"":typeof t=="string"?uC(t):""}function r8(t){return rm(t)?t.headers["content-length"]||-1:nm(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function nL(t){if(rm(t))return t;const e={},r=r8(t);r>=0&&(e["content-length"]=String(r));const n=c1(t),i=eP(t);i&&(e["content-type"]=i);const o=await a8(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:n}),c}async function n8(t){if(!t.ok)throw await i8(t)}async function i8(t){const e=t8(t.url);let r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;const n={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");n.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new Y5(r,n)}async function a8(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const r=t.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=o=>{var c;return n((c=o==null?void 0:o.target)==null?void 0:c.result)},i.readAsDataURL(r)})}if(t instanceof ArrayBuffer){const r=t.slice(0,5);return`data:base64,${s8(r)}`}return null}function s8(t){let e="";const r=new Uint8Array(t);for(let n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function o8(t){return!l8(t)&&!c8(t)}function l8(t){return t.startsWith("http:")||t.startsWith("https:")}function c8(t){return t.startsWith("data:")}async function hC(t,e){var r,n;if(typeof t=="string"){const i=U5(t);return o8(i)&&(r=globalThis.loaders)!=null&&r.fetchNode?(n=globalThis.loaders)==null?void 0:n.fetchNode(i,e):await fetch(i,e)}return await nL(t)}const fC=new Fv({id:"loaders.gl"});class u8{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class h8{constructor(){de(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const iL={fetch:null,mimeType:void 0,nothrow:!1,log:new h8,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:KM,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},f8={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function aL(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function sL(){const t=aL();return t.globalOptions=t.globalOptions||{...iL},t.globalOptions}function d8(t,e,r,n){return r=r||[],r=Array.isArray(r)?r:[r],p8(t,r),g8(e,t,n)}function p8(t,e){dC(t,null,iL,f8,e);for(const r of e){const n=t&&t[r.id]||{},i=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};dC(n,r.id,i,o,e)}}function dC(t,e,r,n,i){const o=e||"Top level",c=e?`${e}.`:"";for(const s in t){const m=!e&&zv(t[s]),v=s==="baseUri"&&!e,w=s==="workerUrl"&&e;if(!(s in r)&&!v&&!w){if(s in n)fC.warn(`${o} loader option '${c}${s}' no longer supported, use '${n[s]}'`)();else if(!m){const M=m8(s,i);fC.warn(`${o} loader option '${c}${s}' not recognized. ${M}`)()}}}}function m8(t,e){const r=t.toLowerCase();let n="";for(const i of e)for(const o in i.options){if(t===o)return`Did you mean '${i.id}.${o}'?`;const c=o.toLowerCase();(r.startsWith(c)||c.startsWith(r))&&(n=n||`Did you mean '${i.id}.${o}'?`)}return n}function g8(t,e,r){const i={...t.options||{}};return _8(i,r),i.log===null&&(i.log=new u8),pC(i,sL()),pC(i,e),i}function pC(t,e){for(const r in e)if(r in e){const n=e[r];lC(n)&&lC(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function _8(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function tP(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function rP(t){w0(t,"null loader"),w0(tP(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const oL=()=>{const t=aL();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function y8(t){const e=oL();t=Array.isArray(t)?t:[t];for(const r of t){const n=rP(r);e.find(i=>n===i)||e.unshift(n)}}function v8(){return oL()}const b8=/\.([^.]+)$/;async function x8(t,e=[],r,n){if(!lL(t))return null;let i=mC(t,e,{...r,nothrow:!0},n);if(i)return i;if(nm(t)&&(t=await t.slice(0,10).arrayBuffer(),i=mC(t,e,r,n)),!i&&!(r!=null&&r.nothrow))throw new Error(cL(t));return i}function mC(t,e=[],r,n){if(!lL(t))return null;if(e&&!Array.isArray(e))return rP(e);let i=[];e&&(i=i.concat(e)),r!=null&&r.ignoreRegisteredLoaders||i.push(...v8()),T8(i);const o=w8(t,i,r,n);if(!o&&!(r!=null&&r.nothrow))throw new Error(cL(t));return o}function w8(t,e,r,n){const i=c1(t),o=eP(t),c=JM(i)||(n==null?void 0:n.url);let s=null,m="";return r!=null&&r.mimeType&&(s=dw(e,r==null?void 0:r.mimeType),m=`match forced by supplied MIME type ${r==null?void 0:r.mimeType}`),s=s||S8(e,c),m=m||(s?`matched url ${c}`:""),s=s||dw(e,o),m=m||(s?`matched MIME type ${o}`:""),s=s||E8(e,t),m=m||(s?`matched initial data ${uL(t)}`:""),r!=null&&r.fallbackMimeType&&(s=s||dw(e,r==null?void 0:r.fallbackMimeType),m=m||(s?`matched fallback MIME type ${o}`:"")),m&&v5.log(1,`selectLoader selected ${s==null?void 0:s.name}: ${m}.`),s}function lL(t){return!(t instanceof Response&&t.status===204)}function cL(t){const e=c1(t),r=eP(t);let n="No valid loader found (";n+=e?`${eL(e)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;const i=t?uL(t):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function T8(t){for(const e of t)rP(e)}function S8(t,e){const r=e&&b8.exec(e),n=r&&r[1];return n?A8(t,n):null}function A8(t,e){e=e.toLowerCase();for(const r of t)for(const n of r.extensions)if(n.toLowerCase()===e)return r;return null}function dw(t,e){var r;for(const n of t)if((r=n.mimeTypes)!=null&&r.some(i=>cC(e,i))||cC(e,`application/x.${n.id}`))return n;return null}function E8(t,e){if(!e)return null;for(const r of t)if(typeof e=="string"){if(M8(e,r))return r}else if(ArrayBuffer.isView(e)){if(gC(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&gC(e,0,r))return r;return null}function M8(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>t.startsWith(n))}function gC(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(i=>P8(t,e,r,i))}function P8(t,e,r,n){if(n instanceof ArrayBuffer)return B5(n,t,n.byteLength);switch(typeof n){case"function":return n(t);case"string":const i=VA(t,e,n.length);return n===i;default:return!1}}function uL(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?VA(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?VA(t,0,e):""}function VA(t,e,r){if(t.byteLength<e+r)return"";const n=new DataView(t);let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}const C8=256*1024;function*R8(t,e){const r=(e==null?void 0:e.chunkSize)||C8;let n=0;const i=new TextEncoder;for(;n<t.length;){const o=Math.min(t.length-n,r),c=t.slice(n,n+o);n+=o,yield i.encode(c)}}const I8=256*1024;function*O8(t,e={}){const{chunkSize:r=I8}=e;let n=0;for(;n<t.byteLength;){const i=Math.min(t.byteLength-n,r),o=new ArrayBuffer(i),c=new Uint8Array(t,n,i);new Uint8Array(o).set(c),n+=i,yield o}}const k8=1024*1024;async function*D8(t,e){const r=(e==null?void 0:e.chunkSize)||k8;let n=0;for(;n<t.size;){const i=n+r,o=await t.slice(n,i).arrayBuffer();n=i,yield o}}function _C(t,e){return KM?N8(t,e):B8(t)}async function*N8(t,e){const r=t.getReader();let n;try{for(;;){const i=n||r.read();e!=null&&e._streamReadAhead&&(n=r.read());const{done:o,value:c}=await i;if(o)return;yield JB(c)}}catch{r.releaseLock()}}async function*B8(t,e){for await(const r of t)yield JB(r)}function L8(t,e){if(typeof t=="string")return R8(t,e);if(t instanceof ArrayBuffer)return O8(t,e);if(nm(t))return D8(t,e);if(tL(t))return _C(t,e);if(rm(t))return _C(t.body,e);throw new Error("makeIterator")}const hL="Cannot convert supplied data type";function F8(t,e,r){if(e.text&&typeof t=="string")return t;if(Z5(t)&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(hL)}async function z8(t,e,r){const n=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||n)return F8(t,e);if(nm(t)&&(t=await nL(t)),rm(t)){const i=t;return await n8(i),e.binary?await i.arrayBuffer():await i.text()}if(tL(t)&&(t=L8(t,r)),H5(t)||W5(t))return z5(t);throw new Error(hL)}function fL(t,e){const r=sL(),n=t||r;return typeof n.fetch=="function"?n.fetch:zv(n.fetch)?i=>hC(i,n.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:hC}function j8(t,e,r){if(r)return r;const n={fetch:fL(e,t),...t};if(n.url){const i=JM(n.url);n.baseUrl=i,n.queryString=e8(n.url),n.filename=eL(i),n.baseUrl=V5(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function U8(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function A0(t,e,r,n){e&&!Array.isArray(e)&&!tP(e)&&(n=void 0,r=e,e=void 0),t=await t,r=r||{};const i=c1(t),c=U8(e,n),s=await x8(t,c,r);return s?(r=d8(r,s,c,i),n=j8({url:i,_parse:A0,loaders:c},r,n||null),await $8(s,t,r,n)):null}async function $8(t,e,r,n){if(O5(t),r=b5(t.options,r),rm(e)){const o=e,{ok:c,redirected:s,status:m,statusText:v,type:w,url:M}=o,I=Object.fromEntries(o.headers.entries());n.response={headers:I,ok:c,redirected:s,status:m,statusText:v,type:w,url:M}}e=await z8(e,t,r);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,r,n);if(k5(t,r))return await D5(t,e,r,n,A0);if(i.parseText&&typeof e=="string")return await i.parseText(e,r,n);if(i.parse)return await i.parse(e,r,n);throw yd(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function qA(t,e,r,n){let i,o;!Array.isArray(e)&&!tP(e)?(i=[],o=e):(i=e,o=r);const c=fL(o);let s=t;return typeof t=="string"&&(s=await c(t)),nm(t)&&(s=await c(t)),Array.isArray(i)?await A0(s,i,o):await A0(s,i,o)}const V8="4.3.2";var jB;const q8=(jB=globalThis.loaders)==null?void 0:jB.parseImageNode,HA=typeof Image<"u",WA=typeof ImageBitmap<"u",H8=!!q8,ZA=KM?!0:H8;function W8(t){switch(t){case"auto":return WA||HA||ZA;case"imagebitmap":return WA;case"image":return HA;case"data":return ZA;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function Z8(){if(WA)return"imagebitmap";if(HA)return"image";if(ZA)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function X8(t){const e=Y8(t);if(!e)throw new Error("Not an image");return e}function G8(t){switch(X8(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Y8(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const K8=/^data:image\/svg\+xml/,Q8=/\.svg((\?|#).*)?$/;function nP(t){return t&&(K8.test(t)||Q8.test(t))}function J8(t,e){if(nP(e)){let n=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return dL(t,e)}function dL(t,e){if(nP(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function pL(t,e,r){const n=J8(t,r),i=self.URL||self.webkitURL,o=typeof n!="string"&&i.createObjectURL(n);try{return await e$(o||n,e)}finally{o&&i.revokeObjectURL(o)}}async function e$(t,e){const r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,i)=>{try{r.onload=()=>n(r),r.onerror=o=>{const c=o instanceof Error?o.message:"error";i(new Error(c))}}catch(o){i(o)}})}const t$={};let yC=!0;async function r$(t,e,r){let n;nP(r)?n=await pL(t,e,r):n=dL(t,r);const i=e&&e.imagebitmap;return await n$(n,i)}async function n$(t,e=null){if((i$(e)||!yC)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),yC=!1}return await createImageBitmap(t)}function i$(t){for(const e in t||t$)return!1;return!0}function a$(t){return!c$(t,"ftyp",4)||(t[8]&96)===0?null:s$(t)}function s$(t){switch(o$(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function o$(t,e,r){return String.fromCharCode(...t.slice(e,r))}function l$(t){return[...t].map(e=>e.charCodeAt(0))}function c$(t,e,r=0){const n=l$(e);for(let i=0;i<n.length;++i)if(n[i]!==t[i+r])return!1;return!0}const Mu=!1,Ly=!0;function mL(t){const e=jv(t);return h$(e)||p$(e)||f$(e)||d$(e)||u$(e)}function u$(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),r=a$(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function h$(t){const e=jv(t);return e.byteLength>=24&&e.getUint32(0,Mu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Mu),height:e.getUint32(20,Mu)}:null}function f$(t){const e=jv(t);return e.byteLength>=10&&e.getUint32(0,Mu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ly),height:e.getUint16(8,Ly)}:null}function d$(t){const e=jv(t);return e.byteLength>=14&&e.getUint16(0,Mu)===16973&&e.getUint32(2,Ly)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ly),height:e.getUint32(22,Ly)}:null}function p$(t){const e=jv(t);if(!(e.byteLength>=3&&e.getUint16(0,Mu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=m$();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,Mu);if(i.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Mu),width:e.getUint16(o+7,Mu)};if(!n.has(c))return null;o+=2,o+=e.getUint16(o,Mu)}return null}function m$(){const t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function jv(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function g$(t,e){var i;const{mimeType:r}=mL(t)||{},n=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return w0(n),await n(t,r)}async function _$(t,e,r){e=e||{};const i=(e.image||{}).type||"auto",{url:o}=r||{},c=y$(i);let s;switch(c){case"imagebitmap":s=await r$(t,e,o);break;case"image":s=await pL(t,e,o);break;case"data":s=await g$(t);break;default:w0(!1)}return i==="data"&&(s=G8(s)),s}function y$(t){switch(t){case"auto":case"data":return Z8();default:return W8(t),t}}const v$=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],b$=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],x$={image:{type:"auto",decode:!0}},w$={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:V8,mimeTypes:b$,extensions:v$,parse:_$,tests:[t=>!!mL(new DataView(t))],options:x$},oi=new Fv({id:"deck"});let XA={};function T$(t){XA=t}function Xs(t,e,r,n){oi.level>0&&XA[t]&&XA[t].call(null,e,r,n)}function S$(t){const e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}const A$={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:S$,parseTextSync:JSON.parse};function E$(){const t="9.1.11",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(oi.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:oi,_registerLoggers:T$},y8([A$,[w$,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const M$=E$();function iP(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const pw={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function P$(t){const e={};for(const[r,n]of Object.entries(t))e[r]=C$(n);return e}function C$(t){let e=vC(t);if(e!=="object")return{value:t,...pw[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...pw[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=vC(t.value),{...t,...pw[e],type:e}):{type:"object",value:null};throw new Error("props")}function vC(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const R$=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,I$=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,O$={vertex:R$,fragment:I$},bC=/void\s+main\s*\([^)]*\)\s*\{\n?/,xC=/}\n?[^{}]*$/,mw=[],g0="__LUMA_INJECT_DECLARATIONS__";function k$(t){const e={vertex:{},fragment:{}};for(const r in t){let n=t[r];const i=D$(r);typeof n=="string"&&(n={order:0,injection:n}),e[i][r]=n}return e}function D$(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function E0(t,e,r,n=!1){const i=e==="vertex";for(const o in r){const c=r[o];c.sort((m,v)=>m.order-v.order),mw.length=c.length;for(let m=0,v=c.length;m<v;++m)mw[m]=c[m].injection;const s=`${mw.join(`
`)}
`;switch(o){case"vs:#decl":i&&(t=t.replace(g0,s));break;case"vs:#main-start":i&&(t=t.replace(bC,m=>m+s));break;case"vs:#main-end":i&&(t=t.replace(xC,m=>s+m));break;case"fs:#decl":i||(t=t.replace(g0,s));break;case"fs:#main-start":i||(t=t.replace(bC,m=>m+s));break;case"fs:#main-end":i||(t=t.replace(xC,m=>s+m));break;default:t=t.replace(o,m=>m+s)}}return t=t.replace(g0,""),n&&(t=t.replace(/\}\s*$/,o=>o+O$[e])),t}function M0(t){t.map(e=>N$(e))}function N$(t){if(t.instance)return;M0(t.dependencies||[]);const{propTypes:e={},deprecations:r=[],inject:n={}}=t,i={normalizedInjections:k$(n),parsedDeprecations:B$(r)};e&&(i.propValidators=P$(e)),t.instance=i;let o={};e&&(o=Object.entries(e).reduce((c,[s,m])=>{const v=m==null?void 0:m.value;return v&&(c[s]=v),c},{})),t.defaultUniforms={...t.defaultUniforms,...o}}function gL(t,e,r){var n;(n=t.deprecations)==null||n.forEach(i=>{var o;(o=i.regex)!=null&&o.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}function B$(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function aP(t){M0(t);const e={},r={};_L({modules:t,level:0,moduleMap:e,moduleDepth:r});const n=Object.keys(r).sort((i,o)=>r[o]-r[i]).map(i=>e[i]);return M0(n),n}function _L(t){const{modules:e,level:r,moduleMap:n,moduleDepth:i}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)n[o.name]=o,(i[o.name]===void 0||i[o.name]<r)&&(i[o.name]=r);for(const o of e)o.dependencies&&_L({modules:o.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}function L$(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function F$(t,e){var n;if(Number(((n=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:n[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=wC(t,z$),t;case"fragment":return t=wC(t,j$),t;default:throw new Error(e)}}const yL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],z$=[...yL,[GA("attribute"),"in $1"],[GA("varying"),"out $1"]],j$=[...yL,[GA("varying"),"in $1"]];function wC(t,e){for(const[r,n]of e)t=t.replace(r,n);return t}function GA(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function vL(t,e){let r="";for(const n in t){const i=t[n];if(r+=`void ${i.signature} {
`,i.header&&(r+=`  ${i.header}`),e[n]){const o=e[n];o.sort((c,s)=>c.order-s.order);for(const c of o)r+=`  ${c.injection}
`}i.footer&&(r+=`  ${i.footer}`),r+=`}
`}return r}function bL(t){const e={vertex:{},fragment:{}};for(const r of t){let n,i;typeof r!="string"?(n=r,i=n.hook):(n={},i=r),i=i.trim();const[o,c]=i.split(":"),s=i.replace(/\(.+/,""),m=Object.assign(n,{signature:c});switch(o){case"vs":e.vertex[s]=m;break;case"fs":e.fragment[s]=m;break;default:throw new Error(o)}}return e}function U$(t,e){return{name:$$(t,e),language:"glsl",version:V$(t)}}function $$(t,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return n?n[1]:e}function V$(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){const n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const xL=`

${g0}
`,q$=`precision highp float;
`;function H$(t){const e=aP(t.modules||[]);return{source:Z$(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:wL(e)}}function W$(t){const{vs:e,fs:r}=t,n=aP(t.modules||[]);return{vs:TC(t.platformInfo,{...t,source:e,stage:"vertex",modules:n}),fs:TC(t.platformInfo,{...t,source:r,stage:"fragment",modules:n}),getUniforms:wL(n)}}function Z$(t,e){var V;const{source:r,stage:n,modules:i,hookFunctions:o=[],inject:c={},log:s}=e;iP(typeof r=="string","shader source must be a string");const m=r;let v="";const w=bL(o),M={},I={},k={};for(const U in c){const K=typeof c[U]=="string"?{injection:c[U],order:0}:c[U],J=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(J){const Z=J[2],re=J[3];Z?re==="decl"?I[U]=[K]:k[U]=[K]:M[U]=[K]}else k[U]=[K]}const z=i;for(const U of z){s&&gL(U,m,s);const K=TL(U,"wgsl");v+=K;const J=((V=U.injections)==null?void 0:V[n])||{};for(const Z in J){const re=/^(v|f)s:#([\w-]+)$/.exec(Z);if(re){const Y=re[2]==="decl"?I:k;Y[Z]=Y[Z]||[],Y[Z].push(J[Z])}else M[Z]=M[Z]||[],M[Z].push(J[Z])}}return v+=xL,v=E0(v,n,I),v+=vL(w[n],M),v+=m,v=E0(v,n,k),v}function TC(t,e){var ue;const{id:r,source:n,stage:i,language:o="glsl",modules:c,defines:s={},hookFunctions:m=[],inject:v={},prologue:w=!0,log:M}=e;iP(typeof n=="string","shader source must be a string");const I=o==="glsl"?U$(n).version:-1,k=t.shaderLanguageVersion,z=I===100?"#version 100":"#version 300 es",U=n.split(`
`).slice(1).join(`
`),K={};c.forEach(be=>{Object.assign(K,be.defines)}),Object.assign(K,s);let J="";switch(o){case"wgsl":break;case"glsl":J=w?`${z}

// ----- PROLOGUE -------------------------
${X$({id:r,source:n,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${L$(t)}
${i==="fragment"?q$:""}

// ----- APPLICATION DEFINES -------------------------

${G$(K)}

`:`${z}
`;break}const Z=bL(m),re={},W={},Y={};for(const be in v){const Ce=typeof v[be]=="string"?{injection:v[be],order:0}:v[be],Ye=/^(v|f)s:(#)?([\w-]+)$/.exec(be);if(Ye){const Me=Ye[2],Ue=Ye[3];Me?Ue==="decl"?W[be]=[Ce]:Y[be]=[Ce]:re[be]=[Ce]}else Y[be]=[Ce]}for(const be of c){M&&gL(be,U,M);const Ce=TL(be,i);J+=Ce;const Ye=((ue=be.instance)==null?void 0:ue.normalizedInjections[i])||{};for(const Me in Ye){const Ue=/^(v|f)s:#([\w-]+)$/.exec(Me);if(Ue){const Ze=Ue[2]==="decl"?W:Y;Ze[Me]=Ze[Me]||[],Ze[Me].push(Ye[Me])}else re[Me]=re[Me]||[],re[Me].push(Ye[Me])}}return J+="// ----- MAIN SHADER SOURCE -------------------------",J+=xL,J=E0(J,i,W),J+=vL(Z[i],re),J+=U,J=E0(J,i,Y),o==="glsl"&&I!==k&&(J=F$(J,i)),J.trim()}function wL(t){return function(r){var i;const n={};for(const o of t){const c=(i=o.getUniforms)==null?void 0:i.call(o,r,n);Object.assign(n,c)}return n}}function X$(t){const{id:e,source:r,stage:n}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${n}`:""}function G$(t={}){let e="";for(const r in t){const n=t[r];(n||Number.isFinite(n))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function TL(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:iP(!1)}if(!t.name)throw new Error("Shader module must have a name");const n=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${r}
`,i}const Y$=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,K$=/^\s*\#\s*endif\s*$/;function Q$(t,e){var c;const r=t.split(`
`),n=[];let i=!0,o=null;for(const s of r){const m=s.match(Y$),v=s.match(K$);m?(o=m[1],i=!!((c=e==null?void 0:e.defines)!=null&&c[o])):v?i=!0:i&&n.push(s)}return n.join(`
`)}const Op=class Op{constructor(){de(this,"_hookFunctions",[]);de(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Op.defaultShaderAssembler=Op.defaultShaderAssembler||new Op,Op.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const r=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:o}=H$({...e,source:e.source,modules:r,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?Q$(i):i,getUniforms:o,modules:r}}assembleGLSLShaderPair(e){const r=this._getModuleList(e.modules),n=this._hookFunctions;return{...W$({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(e=[]){const r=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let o=0,c=this._defaultModules.length;o<c;++o){const s=this._defaultModules[o],m=s.name;r[i++]=s,n[m]=!0}for(let o=0,c=e.length;o<c;++o){const s=e[o],m=s.name;n[m]||(r[i++]=s,n[m]=!0)}return r.length=i,M0(r),r}};de(Op,"defaultShaderAssembler");let P0=Op;const J$=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,eV=`#version 300 es
${J$}`;function tV(t){const{input:e,inputChannels:r,output:n}={};if(!e)return eV;if(!r)throw new Error("inputChannels");const i=rV(r),o=nV(e,r);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${o};
}`}function rV(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function nV(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class iV{constructor(){de(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new l1({id:e})),this.stats.get(e)}}const SL=new iV,Qt=new Fv({id:"luma.gl"}),gw={};function u1(t="id"){gw[t]=gw[t]||1;const e=gw[t]++;return`${t}-${e}`}var UA;let Gn=(UA=class{constructor(e,r,n){de(this,"id");de(this,"props");de(this,"userData",{});de(this,"_device");de(this,"destroyed",!1);de(this,"allocatedBytes",0);de(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=aV(r,n);const i=this.props.id!=="undefined"?this.props.id:u1(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}},de(UA,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),UA);function aV(t,e){const r={...e};for(const n in t)t[n]!==void 0&&(r[n]=t[n]);return r}const hs=class hs extends Gn{constructor(r,n){const i={...n};(n.usage||0)&hs.INDEX&&!n.indexType&&(n.data instanceof Uint32Array?i.indexType="uint32":n.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(r,i,hs.defaultProps);de(this,"usage");de(this,"indexType");de(this,"updateTimestamp");de(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=r.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(r){return this.device.createBuffer({...this.props,...r})}readSyncWebGL(r,n){throw new Error("not implemented")}_setDebugData(r,n,i){const o=ArrayBuffer.isView(r)?r.buffer:r,c=Math.min(r?r.byteLength:i,hs.DEBUG_DATA_MAX_LENGTH);o===null?this.debugData=new ArrayBuffer(c):n===0&&i===o.byteLength?this.debugData=o.slice(0,c):this.debugData=o.slice(n,n+c)}};de(hs,"defaultProps",{...Gn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),de(hs,"MAP_READ",1),de(hs,"MAP_WRITE",2),de(hs,"COPY_SRC",4),de(hs,"COPY_DST",8),de(hs,"INDEX",16),de(hs,"VERTEX",32),de(hs,"UNIFORM",64),de(hs,"STORAGE",128),de(hs,"INDIRECT",256),de(hs,"QUERY_RESOLVE",512),de(hs,"DEBUG_DATA_MAX_LENGTH",32);let Ti=hs;function AL(t){const e=SC[t],r=sV(e),n=t.includes("norm"),i=!n&&!t.startsWith("float"),o=t.startsWith("s");return{dataType:SC[t],byteLength:r,integer:i,signed:o,normalized:n}}function sV(t){return oV[t]}const SC={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},oV={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},As="texture-compression-bc",Zn="texture-compression-astc",Tu="texture-compression-etc2",lV="texture-compression-etc1-webgl",Vb="texture-compression-pvrtc-webgl",_w="texture-compression-atc-webgl",qb="float32-renderable-webgl",yw="float16-renderable-webgl",cV="rgb9e5ufloat-renderable-webgl",vw="snorm8-renderable-webgl",my="norm16-renderable-webgl",bw="snorm16-renderable-webgl",Hb="float32-filterable",AC="float16-filterable-webgl";function EL(t){const e=uV[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const uV={r8unorm:{},r8snorm:{render:vw},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:vw},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:yw,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:my},"r16snorm-webgl":{f:bw},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:vw},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:yw,filter:AC},"rg16unorm-webgl":{render:my},"rg16snorm-webgl":{render:bw},r32uint:{},r32sint:{},r32float:{render:qb,filter:Hb},rgb9e5ufloat:{channels:"rgb",packed:!0,render:cV},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:qb},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:my},"rgb16snorm-webgl":{f:my},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Hb},rgba16uint:{},rgba16sint:{},rgba16float:{render:yw,filter:AC},"rgba16unorm-webgl":{render:my},"rgba16snorm-webgl":{render:bw},"rgb32float-webgl":{render:qb,filter:Hb},rgba32uint:{},rgba32sint:{},rgba32float:{render:qb,filter:Hb},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:As},"bc1-rgb-unorm-srgb-webgl":{f:As},"bc1-rgba-unorm":{f:As},"bc1-rgba-unorm-srgb":{f:As},"bc2-rgba-unorm":{f:As},"bc2-rgba-unorm-srgb":{f:As},"bc3-rgba-unorm":{f:As},"bc3-rgba-unorm-srgb":{f:As},"bc4-r-unorm":{f:As},"bc4-r-snorm":{f:As},"bc5-rg-unorm":{f:As},"bc5-rg-snorm":{f:As},"bc6h-rgb-ufloat":{f:As},"bc6h-rgb-float":{f:As},"bc7-rgba-unorm":{f:As},"bc7-rgba-unorm-srgb":{f:As},"etc2-rgb8unorm":{f:Tu},"etc2-rgb8unorm-srgb":{f:Tu},"etc2-rgb8a1unorm":{f:Tu},"etc2-rgb8a1unorm-srgb":{f:Tu},"etc2-rgba8unorm":{f:Tu},"etc2-rgba8unorm-srgb":{f:Tu},"eac-r11unorm":{f:Tu},"eac-r11snorm":{f:Tu},"eac-rg11unorm":{f:Tu},"eac-rg11snorm":{f:Tu},"astc-4x4-unorm":{f:Zn},"astc-4x4-unorm-srgb":{f:Zn},"astc-5x4-unorm":{f:Zn},"astc-5x4-unorm-srgb":{f:Zn},"astc-5x5-unorm":{f:Zn},"astc-5x5-unorm-srgb":{f:Zn},"astc-6x5-unorm":{f:Zn},"astc-6x5-unorm-srgb":{f:Zn},"astc-6x6-unorm":{f:Zn},"astc-6x6-unorm-srgb":{f:Zn},"astc-8x5-unorm":{f:Zn},"astc-8x5-unorm-srgb":{f:Zn},"astc-8x6-unorm":{f:Zn},"astc-8x6-unorm-srgb":{f:Zn},"astc-8x8-unorm":{f:Zn},"astc-8x8-unorm-srgb":{f:Zn},"astc-10x5-unorm":{f:Zn},"astc-10x5-unorm-srgb":{f:Zn},"astc-10x6-unorm":{f:Zn},"astc-10x6-unorm-srgb":{f:Zn},"astc-10x8-unorm":{f:Zn},"astc-10x8-unorm-srgb":{f:Zn},"astc-10x10-unorm":{f:Zn},"astc-10x10-unorm-srgb":{f:Zn},"astc-12x10-unorm":{f:Zn},"astc-12x10-unorm-srgb":{f:Zn},"astc-12x12-unorm":{f:Zn},"astc-12x12-unorm-srgb":{f:Zn},"pvrtc-rgb4unorm-webgl":{f:Vb},"pvrtc-rgba4unorm-webgl":{f:Vb},"pvrtc-rbg2unorm-webgl":{f:Vb},"pvrtc-rgba2unorm-webgl":{f:Vb},"etc1-rbg-unorm-webgl":{f:lV},"atc-rgb-unorm-webgl":{f:_w},"atc-rgba-unorm-webgl":{f:_w},"atc-rgbai-unorm-webgl":{f:_w}},hV=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],fV=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function ML(t){return hV.some(e=>t.startsWith(e))}function sP(t){let e=dV(t);if(ML(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=pV(t);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const r=fV.exec(t);if(r){const[,n,i,o,c,s]=r,m=`${o}${i}`,v=AL(m),w=v.byteLength*8,M=n.length,I=[w,M>=2?w:0,M>=3?w:0,M>=4?w:0];e={format:t,attachment:e.attachment,dataType:v.dataType,components:M,channels:n,integer:v.integer,signed:v.signed,normalized:v.normalized,bitsPerChannel:I,bytesPerPixel:v.byteLength*n.length,packed:e.packed,srgb:e.srgb},s==="-webgl"&&(e.webgl=!0),c==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function dV(t){var o;const e=EL(t),r=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((o=e.channels)==null?void 0:o.length)||1,bytesPerPixel:r,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function pV(t){const r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){const[,n,i]=r;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function mV(t){const e=EL(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},n=sP(t),i=t.startsWith("depth")||t.startsWith("stencil"),o=n==null?void 0:n.signed,c=n==null?void 0:n.integer,s=n==null?void 0:n.webgl;return r.render&&(r.render=!o),r.filter&&(r.filter=!i&&!o&&!c&&!s),r}class gV{}class _V{constructor(e=[],r){de(this,"features");de(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){var r;return!((r=this.disabledFeatures)!=null&&r[e])&&this.features.has(e)}}const Wx=class Wx{constructor(e){de(this,"id");de(this,"props");de(this,"userData",{});de(this,"statsManager",SL);de(this,"timestamp",0);de(this,"_reused",!1);de(this,"_lumaData",{});this.props={...Wx.defaultProps,...e},this.id=this.props.id||u1(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const r=mV(e),n=c=>(typeof c=="string"?this.features.has(c):c)??!0,i=n(r.create),o={format:e,create:i,render:i&&n(r.render),filter:i&&n(r.filter),blend:i&&n(r.blend),store:i&&n(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return ML(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const r={...e};return(e.usage||0)&Ti.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Qt.warn("indices buffer content must be of integer type")()),r}};de(Wx,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Qt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Qt.get("debug")||void 0,debugShaders:Qt.get("debug-shaders")||void 0,debugFramebuffers:!!Qt.get("debug-framebuffers"),debugWebGL:!!Qt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let dd=Wx;const yV=tm()&&typeof document<"u",vV=()=>yV&&document.readyState==="complete",bV="set luma.log.level=1 (or higher) to trace rendering",EC="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",od=class od{constructor(){de(this,"stats",SL);de(this,"log",Qt);de(this,"VERSION","9.1.9");de(this,"spector");de(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Qt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Qt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Qt.error("This version of luma.gl has already been initialized")()}Qt.log(1,`${this.VERSION} - ${bV}`)(),globalThis.luma=this}registerAdapters(e){for(const r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){const r=this.getAdapterMap(e);return Array.from(r).map(([,n])=>n).filter(n=>{var i;return(i=n.isSupported)==null?void 0:i.call(n)}).map(n=>n.type)}getBestAvailableAdapter(e=[]){var n,i,o,c;const r=this.getAdapterMap(e);return(i=(n=r.get("webgpu"))==null?void 0:n.isSupported)!=null&&i.call(n)?"webgpu":(c=(o=r.get("webgl"))==null?void 0:o.isSupported)!=null&&c.call(o)?"webgl":null}setDefaultDeviceProps(e){Object.assign(od.defaultProps,e)}async createDevice(e={}){var s;e={...od.defaultProps,...e},e.waitForPageLoad&&await od.pageLoaded;const r=this.getAdapterMap(e.adapters);let n=e.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(e.adapters)||n);const o=(this.getAdapterMap(e.adapters)||r).get(n),c=await((s=o==null?void 0:o.create)==null?void 0:s.call(o,e));if(c)return c;throw new Error(EC)}async attachDevice(e){var c;const r=this.getAdapterMap(e.adapters);let n="";e.handle instanceof WebGL2RenderingContext&&(n="webgl"),e.createCanvasContext&&await od.pageLoaded,e.handle===null&&(n="unknown");const i=r.get(n),o=await((c=i==null?void 0:i.attach)==null?void 0:c.call(i,null));if(o)return o;throw new Error(EC)}enforceWebGL2(e=!0,r=[]){var o;const i=this.getAdapterMap(r).get("webgl");i||Qt.warn("enforceWebGL2: webgl adapter not found")(),(o=i==null?void 0:i.enforceWebGL2)==null||o.call(i,e)}getAdapterMap(e=[]){const r=new Map(this.preregisteredAdapters);for(const n of e)r.set(n.type,n);return r}registerDevices(e){Qt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const r of e){const n=r.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}};de(od,"defaultProps",{...dd.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),de(od,"pageLoaded",xV().then(()=>{Qt.probe(2,"DOM is loaded")()}));let YA=od;const KA=new YA;function xV(){return vV()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class wV{}const Zx=class Zx{constructor(e){de(this,"id");de(this,"props");de(this,"canvas");de(this,"htmlCanvas");de(this,"offscreenCanvas");de(this,"type");de(this,"width",1);de(this,"height",1);de(this,"resizeObserver");de(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...Zx.defaultProps,...e},e=this.props,!tm()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=SV(e.canvas):this.canvas=e.canvas;else{const r=AV(e),n=TV((e==null?void 0:e.container)||null);n.insertBefore(r,n.firstChild),this.canvas=r,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(const n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){var e;try{const[r]=this.getDrawingBufferSize(),n=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return n?r/n:1}catch{return 1}}cssToDevicePixels(e,r=!0){const n=this.cssToDeviceRatio(),[i,o]=this.getDrawingBufferSize();return EV(e,n,i,o,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,i="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!i)&&(Qt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==n||o.clientHeight!==i||o.devicePixelRatio!==e){let c=e;const s=Math.floor(n*c),m=Math.floor(i*c);if(this.htmlCanvas.width=s,this.htmlCanvas.height=m,this.device.gl){const[w,M]=this.getDrawingBufferSize();(w!==s||M!==m)&&(c=Math.min(w/n,M/i),this.htmlCanvas.width=Math.floor(n*c),this.htmlCanvas.height=Math.floor(i*c),Qt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var r;((r=this.htmlCanvas)==null?void 0:r.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};de(Zx,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let QA=Zx;function TV(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function SV(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function AV(t){const{width:e,height:r}=t,n=document.createElement("canvas");return n.id=u1("lumagl-auto-created-canvas"),n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function EV(t,e,r,n,i){const o=t,c=MC(o[0],e,r);let s=PC(o[1],e,n,i),m=MC(o[0]+1,e,r);const v=m===r-1?m:m-1;m=PC(o[1]+1,e,n,i);let w;return i?(m=m===0?m:m+1,w=s,s=m):w=m===n-1?m:m-1,{x:c,y:s,width:Math.max(v-c+1,1),height:Math.max(w-s+1,1)}}function MC(t,e,r){return Math.min(Math.round(t*e),r-1)}function PC(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}const fs=class fs extends Gn{constructor(r,n){n=fs.normalizeProps(r,n);super(r,n,fs.defaultProps);de(this,"dimension");de(this,"format");de(this,"width");de(this,"height");de(this,"depth");de(this,"mipLevels");de(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=fs.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?fs.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=r.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(r){return this.device.createTexture({...this.props,...r})}static isExternalImage(r){return typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement||typeof VideoFrame<"u"&&r instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas}static getExternalImageSize(r){if(typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height};if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight};if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return{width:r.videoWidth,height:r.videoHeight};if(typeof VideoFrame<"u"&&r instanceof VideoFrame)return{width:r.displayWidth,height:r.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(r){const n=r==null?void 0:r.data;return ArrayBuffer.isView(n)}static getTextureDataSize(r){if(!r||ArrayBuffer.isView(r))return null;if(Array.isArray(r))return fs.getTextureDataSize(r[0]);if(fs.isExternalImage(r))return fs.getExternalImageSize(r);if(r&&typeof r=="object"&&r.constructor===Object){const i=Object.values(r)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(r,n){let i;return ArrayBuffer.isView(r)?i=[{data:r,width:n.width,height:n.height}]:Array.isArray(r)?i=r:i=[r],i}static getMipLevelCount(r,n){return Math.floor(Math.log2(Math.max(r,n)))+1}static getCubeFaceDepth(r){switch(r){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(r)}}static normalizeProps(r,n){var m,v;const i={...n},o=((v=(m=r==null?void 0:r.props)==null?void 0:m._resourceDefaults)==null?void 0:v.texture)||{};Object.assign(i,o);const{width:c,height:s}=i;return typeof c=="number"&&(i.width=Math.max(1,Math.ceil(c))),typeof s=="number"&&(i.height=Math.max(1,Math.ceil(s))),i}};de(fs,"COPY_SRC",1),de(fs,"COPY_DST",2),de(fs,"TEXTURE",4),de(fs,"STORAGE",8),de(fs,"RENDER_ATTACHMENT",16),de(fs,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),de(fs,"defaultProps",{...Gn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),de(fs,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Hi=fs;const Xx=class Xx extends Gn{get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,Xx.defaultProps)}};de(Xx,"defaultProps",{...Gn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let C0=Xx;function MV(t,e,r){let n="";const i=e.split(/\r?\n/),o=t.slice().sort((c,s)=>c.lineNum-s.lineNum);switch((r==null?void 0:r.showSourceCode)||"no"){case"all":let c=0;for(let s=1;s<=i.length;s++)for(n+=PL(i[s-1],s,r);o.length>c&&o[c].lineNum===s;){const m=o[c++];n+=CC(m,i,m.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const s of t)n+=CC(s,i,s.lineNum,{inlineSource:(r==null?void 0:r.showSourceCode)!=="no"});return n}}function CC(t,e,r,n){if(n!=null&&n.inlineSource){const o=PV(e,r),c=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${c}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return n!=null&&n.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function PV(t,e,r){let n="";for(let i=e-2;i<=e;i++){const o=t[i-1];o!==void 0&&(n+=PL(o,e,r))}return n}function PL(t,e,r){const n=r!=null&&r.html?RV(t):t;return`${CV(String(e),4)}: ${n}${r!=null&&r.html?"<br/>":`
`}`}function CV(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}function RV(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const Gx=class Gx extends Gn{constructor(r,n){n={...n,debugShaders:n.debugShaders||r.props.debugShaders||"errors"};super(r,{id:IV(n),...n},Gx.defaultProps);de(this,"stage");de(this,"source");de(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const r=this.props.debugShaders;switch(r){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const n=await this.getCompilationInfo();r==="warnings"&&(n==null?void 0:n.length)===0||this._displayShaderLog(n)}_displayShaderLog(r){var v;if(typeof document>"u"||!(document!=null&&document.createElement))return;const n=CL(this.source),i=`${this.stage} ${n}`;let o=MV(r,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(o+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${c}</pre></code>`);const s=document.createElement("Button");s.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${o}
</pre></code>`,s.style.top="10px",s.style.left="10px",s.style.position="absolute",s.style.zIndex="9999",s.style.width="100%",s.style.textAlign="left",document.body.appendChild(s),(v=document.getElementsByClassName("luma-compiler-log-error")[0])==null||v.scrollIntoView(),s.onclick=()=>{const w=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(w)}}};de(Gx,"defaultProps",{...Gn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let R0=Gx;function IV(t){return CL(t.source)||t.id||u1(`unnamed ${t.stage}-shader`)}function CL(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return n?n[1]:e}const Xy=class Xy extends Gn{get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=Xy.normalizeProps(e,r),super(e,r,Xy.defaultProps)}static normalizeProps(e,r){var o,c;const n=((c=(o=e==null?void 0:e.props)==null?void 0:o._resourceDefaults)==null?void 0:c.sampler)||{};return{...r,...n}}};de(Xy,"defaultProps",{...Gn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let I0=Xy;const Yx=class Yx extends Gn{constructor(r,n={}){super(r,n,Yx.defaultProps);de(this,"width");de(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(r){const n=this.colorAttachments.map(o=>o.texture.clone(r)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(r);return this.device.createFramebuffer({...this.props,colorAttachments:n,depthStencilAttachment:i})}resize(r){let n=!r;if(r){const[i,o]=Array.isArray(r)?r:[r.width,r.height];n=n||o!==this.height||i!==this.width,this.width=i,this.height=o}n&&(Qt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((n,i)=>{if(typeof n=="string"){const o=this.createColorTexture(n,i);return this.attachResource(o),o.view}return n instanceof Hi?n.view:n});const r=this.props.depthStencilAttachment;if(r)if(typeof r=="string"){const n=this.createDepthStencilTexture(r);this.attachResource(n),this.depthStencilAttachment=n.view}else r instanceof Hi?this.depthStencilAttachment=r.view:this.depthStencilAttachment=r}createColorTexture(r,n){return this.device.createTexture({id:`${this.id}-color-attachment-${n}`,usage:Hi.RENDER_ATTACHMENT,format:r,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(r){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Hi.RENDER_ATTACHMENT,format:r,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(r,n){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const o=this.colorAttachments[i].texture.clone({width:r,height:n});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=o.view,this.attachResource(o.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:r,height:n});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};de(Yx,"defaultProps",{...Gn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let O0=Yx;const Kx=class Kx extends Gn{constructor(r,n){super(r,n,Kx.defaultProps);de(this,"shaderLayout");de(this,"bufferLayout");de(this,"linkStatus","pending");de(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(r){throw new Error("Use uniform blocks")}};de(Kx,"defaultProps",{...Gn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Ng=Kx;const Lc=class Lc extends Gn{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=Lc.normalizeProps(e,r),super(e,r,Lc.defaultProps)}static normalizeProps(e,r){var o;return{...(o=e.props._resourceDefaults)==null?void 0:o.renderPass,...r}}};de(Lc,"defaultClearColor",[0,0,0,1]),de(Lc,"defaultClearDepth",1),de(Lc,"defaultClearStencil",0),de(Lc,"defaultProps",{...Gn.defaultProps,framebuffer:null,parameters:void 0,clearColor:Lc.defaultClearColor,clearColors:void 0,clearDepth:Lc.defaultClearDepth,clearStencil:Lc.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let JA=Lc;const Qx=class Qx extends Gn{constructor(r,n){super(r,n,Qx.defaultProps);de(this,"hash","");de(this,"shaderLayout");this.shaderLayout=n.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};de(Qx,"defaultProps",{...Gn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let k0=Qx;const Jx=class Jx extends Gn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,Jx.defaultProps)}};de(Jx,"defaultProps",{...Gn.defaultProps,measureExecutionTime:void 0});let eE=Jx;const e1=class e1 extends Gn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,e1.defaultProps)}};de(e1,"defaultProps",{...Gn.defaultProps});let tE=e1;function OV(t){const[e,r]=DV[t],n=e==="i32"||e==="u32",i=e!=="u32",o=NV[e]*r,c=kV(e,r);return{dataType:e,components:r,defaultVertexFormat:c,byteLength:o,integer:n,signed:i}}function kV(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}const DV={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},NV={f32:4,f16:2,i32:4,u32:4};function RL(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),i=r,o=n?parseInt(n):1,c=AL(i),s={type:i,components:o,byteLength:c.byteLength*o,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(s.webglOnly=!0),s}function IL(t,e){const r={};for(const n of t.attributes){const i=LV(t,e,n.name);i&&(r[n.name]=i)}return r}function BV(t,e,r=16){const n=IL(t,e),i=new Array(r).fill(null);for(const o of Object.values(n))i[o.location]=o;return i}function LV(t,e,r){const n=FV(t,r),i=zV(e,r);if(!n)return null;const o=OV(n.type),c=(i==null?void 0:i.vertexFormat)||o.defaultVertexFormat,s=RL(c);return{attributeName:(i==null?void 0:i.attributeName)||n.name,bufferName:(i==null?void 0:i.bufferName)||n.name,location:n.location,shaderType:n.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:c,bufferDataType:s.type,bufferComponents:s.components,normalized:s.normalized,integer:o.integer,stepMode:(i==null?void 0:i.stepMode)||n.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function FV(t,e){const r=t.attributes.find(n=>n.name===e);return r||Qt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function zV(t,e){jV(t);let r=UV(t,e);return r||(r=$V(t,e),r)?r:(Qt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function jV(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Qt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function UV(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function $V(t,e){var r;for(const n of t){let i=n.byteStride;if(typeof n.byteStride!="number")for(const c of n.attributes||[]){const s=RL(c.format);i+=s.byteLength}const o=(r=n.attributes)==null?void 0:r.find(c=>c.attribute===e);if(o)return{attributeName:o.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:o.format,byteOffset:o.byteOffset,byteStride:i}}return null}const t1=class t1 extends Gn{constructor(r,n){super(r,n,t1.defaultProps);de(this,"maxVertexAttributes");de(this,"attributeInfos");de(this,"indexBuffer",null);de(this,"attributes");this.maxVertexAttributes=r.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:o}=n.renderPipeline||{};if(!i||!o)throw new Error("VertexArray");this.attributeInfos=BV(i,o,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(r,n){this.device.reportError(new Error("constant attributes not supported"))}};de(t1,"defaultProps",{...Gn.defaultProps,renderPipeline:null});let rE=t1;const r1=class r1 extends Gn{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,r1.defaultProps)}};de(r1,"defaultProps",{...Gn.defaultProps,layout:void 0,buffers:{}});let nE=r1;const n1=class n1 extends Gn{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,n1.defaultProps)}};de(n1,"defaultProps",{...Gn.defaultProps,type:void 0,count:void 0});let iE=n1;const VV={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function qV(t){return VV[t]}function HV(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let Wb;function OL(t){return(!Wb||Wb.byteLength<t)&&(Wb=new ArrayBuffer(t)),Wb}function WV(t,e){const r=OL(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function ZV(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function D0(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":ZV(t)}const RC=1024;class XV{constructor(e){de(this,"layout",{});de(this,"byteLength");let r=0;for(const[i,o]of Object.entries(e)){const c=qV(o),{type:s,components:m}=c;r=HV(r,m);const v=r;r+=m,this.layout[i]={type:s,size:m,offset:v}}r+=(4-r%4)%4;const n=r*4;this.byteLength=Math.max(n,RC)}getData(e){const r=Math.max(this.byteLength,RC),n=OL(r),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[o,c]of Object.entries(e)){const s=this.layout[o];if(!s){Qt.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:m,size:v,offset:w}=s,M=i[m];if(v===1){if(typeof c!="number"&&typeof c!="boolean"){Qt.warn(`Supplied value for single component uniform ${o} is not a number: ${c}`)();continue}M[w]=Number(c)}else{if(!D0(c)){Qt.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${c}`)();continue}M.set(c,w)}}return new Uint8Array(n)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function GV(t,e,r=16){if(t!==e)return!1;const n=t,i=e;if(!D0(n))return!1;if(D0(i)&&n.length===i.length){for(let o=0;o<n.length;++o)if(i[o]!==n[o])return!1}return!0}function YV(t){return D0(t)?t.slice():t}class KV{constructor(e){de(this,"name");de(this,"uniforms",{});de(this,"modifiedUniforms",{});de(this,"modified",!0);de(this,"bindingLayout",{});de(this,"needsRedraw","initialized");var r;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const n=(r=e==null?void 0:e.shaderLayout.bindings)==null?void 0:r.find(o=>o.type==="uniform"&&o.name===(e==null?void 0:e.name));if(!n)throw new Error(e==null?void 0:e.name);const i=n;for(const o of i.uniforms||[])this.bindingLayout[o.name]=o}}setUniforms(e){for(const[r,n]of Object.entries(e))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){GV(this.uniforms[e],r)||(this.uniforms[e]=YV(r),this.modifiedUniforms[e]=!0,this.modified=!0)}}class QV{constructor(e){de(this,"uniformBlocks",new Map);de(this,"uniformBufferLayouts",new Map);de(this,"uniformBuffers",new Map);for(const[r,n]of Object.entries(e)){const i=r,o=new XV(n.uniformTypes||{});this.uniformBufferLayouts.set(i,o);const c=new KV({name:r});c.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var r;for(const[n,i]of Object.entries(e))(r=this.uniformBlocks.get(n))==null||r.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var r;return((r=this.uniformBufferLayouts.get(e))==null?void 0:r.byteLength)||0}getUniformBufferData(e){var n,i;const r=((n=this.uniformBlocks.get(e))==null?void 0:n.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(r)}createUniformBuffer(e,r,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(r),o=e.createBuffer({usage:Ti.UNIFORM|Ti.COPY_DST,byteLength:i}),c=this.getUniformBufferData(r);return o.write(c),o}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){const n=this.getUniformBufferByteLength(r),i=e.createBuffer({usage:Ti.UNIFORM|Ti.COPY_DST,byteLength:n});this.uniformBuffers.set(r,i)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(const r of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(r);e||(e=n)}return e&&Qt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var o;const r=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&(r!=null&&r.needsRedraw)){i||(i=r.needsRedraw);const c=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n==null||n.write(c);const s=(o=this.uniformBlocks.get(e))==null?void 0:o.getAllUniforms();Qt.log(4,`Writing to uniform buffer ${String(e)}`,c,s)()}return i}}function kL(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function DL(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function JV(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let i=kL(t);if(i==="uint8"&&r&&n===1)return"unorm8-webgl";if(i==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}if(i==="uint16"||i==="sint16"){if(n===1||n===3)throw new Error(`size: ${e}`);return r&&(i=i.replace("int","norm")),`${i}x${n}`}return n===1?i:`${i}x${n}`}class xw{constructor(e){de(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){var r;return e.attributes?(r=e.attributes)==null?void 0:r.map(n=>n.attribute):[e.name]}mergeBufferLayouts(e,r){const n=[...e];for(const i of r){const o=n.findIndex(c=>c.name===i.name);o<0?n.push(i):n[o]=i}return n}getBufferIndex(e){const r=this.bufferLayouts.findIndex(n=>n.name===e);return r===-1&&Qt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}}function eq(t,e){const r=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),n=e.slice();return n.sort((i,o)=>{const c=i.attributes?i.attributes.map(w=>w.attribute):[i.name],s=o.attributes?o.attributes.map(w=>w.attribute):[o.name],m=Math.min(...c.map(w=>r[w])),v=Math.min(...s.map(w=>r[w]));return m-v}),n}class Ul{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class IC{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class cd extends Ul{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}let pd=class extends Ul{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}},Hp=class extends Ul{constructor(e,r,n,i){super(e,n),this.format=r,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};var id;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(id||(id={}));class Zb{constructor(e,r,n,i,o,c,s){this.name=e,this.type=r,this.group=n,this.binding=i,this.attributes=o,this.resourceType=c,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class tq{constructor(e,r){this.name=e,this.type=r}}class rq{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i,this.interpolation=null}}let OC=class{constructor(e,r,n,i){this.name=e,this.type=r,this.locationType=n,this.location=i}};class nq{constructor(e,r,n,i){this.name=e,this.type=r,this.attributes=n,this.id=i}}class iq{constructor(e,r,n){this.name=e,this.type=r,this.attributes=n}}class aq{constructor(e,r=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=n}}class sq{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const NL=new Float32Array(1),oq=new Int32Array(NL.buffer),Es=new Uint16Array(1);function lq(t){NL[0]=t;const e=oq[0],r=e>>31&1;let n=e>>23&255,i=8388607&e;if(n===255)return Es[0]=r<<15|31744|(i!==0?512:0),Es[0];if(n===0){if(i===0)return Es[0]=r<<15,Es[0];i|=8388608;let o=113;for(;!(8388608&i);)i<<=1,o--;return n=127-o,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),Es[0]=r<<15|n<<10|i>>13,Es[0]):(Es[0]=r<<15,Es[0])}return n=n-127+15,n>=31?(Es[0]=r<<15|31744,Es[0]):n<=0?n<-10?(Es[0]=r<<15,Es[0]):(i=(8388608|i)>>1-n,Es[0]=r<<15|i>>13,Es[0]):(i>>=13,Es[0]=r<<15|n<<10|i,Es[0])}const oP=new Uint32Array(1),BL=new Float32Array(oP.buffer,0,1);function kC(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return oP[0]=e,BL[0]}function cq(t,e,r,n,i,o,c,s,m){const v=n*(c>>=i)*(o>>=i)+r*c+e*s;switch(m){case"r8unorm":return[Sn(t,v,"8unorm",1)[0]];case"r8snorm":return[Sn(t,v,"8snorm",1)[0]];case"r8uint":return[Sn(t,v,"8uint",1)[0]];case"r8sint":return[Sn(t,v,"8sint",1)[0]];case"rg8unorm":{const w=Sn(t,v,"8unorm",2);return[w[0],w[1]]}case"rg8snorm":{const w=Sn(t,v,"8snorm",2);return[w[0],w[1]]}case"rg8uint":{const w=Sn(t,v,"8uint",2);return[w[0],w[1]]}case"rg8sint":{const w=Sn(t,v,"8sint",2);return[w[0],w[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const w=Sn(t,v,"8unorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8snorm":{const w=Sn(t,v,"8snorm",4);return[w[0],w[1],w[2],w[3]]}case"rgba8uint":{const w=Sn(t,v,"8uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba8sint":{const w=Sn(t,v,"8sint",4);return[w[0],w[1],w[2],w[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const w=Sn(t,v,"8unorm",4);return[w[2],w[1],w[0],w[3]]}case"r16uint":return[Sn(t,v,"16uint",1)[0]];case"r16sint":return[Sn(t,v,"16sint",1)[0]];case"r16float":return[Sn(t,v,"16float",1)[0]];case"rg16uint":{const w=Sn(t,v,"16uint",2);return[w[0],w[1]]}case"rg16sint":{const w=Sn(t,v,"16sint",2);return[w[0],w[1]]}case"rg16float":{const w=Sn(t,v,"16float",2);return[w[0],w[1]]}case"rgba16uint":{const w=Sn(t,v,"16uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16sint":{const w=Sn(t,v,"16sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba16float":{const w=Sn(t,v,"16float",4);return[w[0],w[1],w[2],w[3]]}case"r32uint":return[Sn(t,v,"32uint",1)[0]];case"r32sint":return[Sn(t,v,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Sn(t,v,"32float",1)[0]];case"rg32uint":{const w=Sn(t,v,"32uint",2);return[w[0],w[1]]}case"rg32sint":{const w=Sn(t,v,"32sint",2);return[w[0],w[1]]}case"rg32float":{const w=Sn(t,v,"32float",2);return[w[0],w[1]]}case"rgba32uint":{const w=Sn(t,v,"32uint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32sint":{const w=Sn(t,v,"32sint",4);return[w[0],w[1],w[2],w[3]]}case"rgba32float":{const w=Sn(t,v,"32float",4);return[w[0],w[1],w[2],w[3]]}case"rg11b10ufloat":{const w=new Uint32Array(t.buffer,v,1)[0],M=(4192256&w)>>11,I=(4290772992&w)>>22;return[kC(2047&w),kC(M),function(k){const z=112+(k>>5&31)<<23|(31&k)<<18;return oP[0]=z,BL[0]}(I),1]}}return null}function Sn(t,e,r,n){const i=[0,0,0,0];for(let v=0;v<n;++v)switch(r){case"8unorm":i[v]=t[e]/255,e++;break;case"8snorm":i[v]=t[e]/255*2-1,e++;break;case"8uint":i[v]=t[e],e++;break;case"8sint":i[v]=t[e]-127,e++;break;case"16uint":i[v]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[v]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[v]=(o=t[e]|t[e+1]<<8,c=void 0,s=void 0,m=void 0,c=(32768&o)>>15,m=1023&o,(s=(31744&o)>>10)==0?(c?-1:1)*Math.pow(2,-14)*(m/Math.pow(2,10)):s==31?m?NaN:1/0*(c?-1:1):(c?-1:1)*Math.pow(2,s-15)*(1+m/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[v]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[v]=new Float32Array(t.buffer,e,1)[0],e+=4}var o,c,s,m;return i}function Dn(t,e,r,n,i){for(let o=0;o<n;++o)switch(r){case"8unorm":t[e]=255*i[o],e++;break;case"8snorm":t[e]=.5*(i[o]+1)*255,e++;break;case"8uint":t[e]=i[o],e++;break;case"8sint":t[e]=i[o]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[o],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[o],e+=2;break;case"16float":{const c=lq(i[o]);new Uint16Array(t.buffer,e,1)[0]=c,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[o],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[o],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[o],e+=4}return i}const ww={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Xl{constructor(){this.id=Xl._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(N0.instance);for(const n of e)n instanceof Array?this.searchBlock(n,r):n.search(r);r(B0.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Xl._id=0;class N0 extends Xl{}N0.instance=new N0;class B0 extends Xl{}B0.instance=new B0;const LL=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ai extends Xl{constructor(){super()}}class Yy extends Ai{constructor(e,r,n,i,o,c){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=n,this.body=i,this.startLine=o,this.endLine=c}get astNodeType(){return"function"}search(e){if(this.attributes)for(const r of this.attributes)e(r);e(this);for(const r of this.args)e(r);this.searchBlock(this.body,e)}}class uq extends Ai{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class FL extends Ai{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class aE extends Ai{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class zL extends Ai{constructor(e,r,n,i){super(),this.init=e,this.condition=r,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var r,n,i;(r=this.init)===null||r===void 0||r.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class Lh extends Ai{constructor(e,r,n,i,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class lP extends Ai{constructor(e,r,n){super(),this.attributes=null,this.name=e,this.type=r,this.value=n}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class Fy extends Ai{constructor(e,r,n,i,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}class _0 extends Ai{constructor(e,r,n,i,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=n,this.access=i,this.value=o}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}}var bg,Py,ut,We;(t=>{t.increment="++",t.decrement="--"})(bg||(bg={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(bg||(bg={}));class jL extends Ai{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Py||(Py={})),(t=>{t.parse=function(e){const r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(Py||(Py={}));class UL extends Ai{constructor(e,r,n){super(),this.operator=e,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class cP extends Ai{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return LL.has(this.name)}search(e){for(const r of this.args)r.search(e);e(this)}}class $L extends Ai{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}}class VL extends Ai{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}}class qL extends Ai{constructor(e,r,n,i){super(),this.condition=e,this.body=r,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class HL extends Ai{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}}class hq extends Ai{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class fq extends Ai{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class WL extends Ai{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}}class uP extends Ai{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}}class dq extends Ai{constructor(){super()}get astNodeType(){return"discard"}}class ZL extends Ai{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class XL extends Ai{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class jt extends Ai{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=jt._priority.get(r.name);jt._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?jt.i32:r}getTypeName(){return this.name}}jt.x32=new jt("x32"),jt.f32=new jt("f32"),jt.i32=new jt("i32"),jt.u32=new jt("u32"),jt.f16=new jt("f16"),jt.bool=new jt("bool"),jt.void=new jt("void"),jt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let DC=class extends jt{constructor(e){super(e)}};class Nh extends jt{constructor(e,r,n,i){super(e),this.members=r,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(const r of this.members)e(r)}}class rt extends jt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}rt.vec2f=new rt("vec2",jt.f32,null),rt.vec3f=new rt("vec3",jt.f32,null),rt.vec4f=new rt("vec4",jt.f32,null),rt.vec2i=new rt("vec2",jt.i32,null),rt.vec3i=new rt("vec3",jt.i32,null),rt.vec4i=new rt("vec4",jt.i32,null),rt.vec2u=new rt("vec2",jt.u32,null),rt.vec3u=new rt("vec3",jt.u32,null),rt.vec4u=new rt("vec4",jt.u32,null),rt.vec2h=new rt("vec2",jt.f16,null),rt.vec3h=new rt("vec3",jt.f16,null),rt.vec4h=new rt("vec4",jt.f16,null),rt.vec2b=new rt("vec2",jt.bool,null),rt.vec3b=new rt("vec3",jt.bool,null),rt.vec4b=new rt("vec4",jt.bool,null),rt.mat2x2f=new rt("mat2x2",jt.f32,null),rt.mat2x3f=new rt("mat2x3",jt.f32,null),rt.mat2x4f=new rt("mat2x4",jt.f32,null),rt.mat3x2f=new rt("mat3x2",jt.f32,null),rt.mat3x3f=new rt("mat3x3",jt.f32,null),rt.mat3x4f=new rt("mat3x4",jt.f32,null),rt.mat4x2f=new rt("mat4x2",jt.f32,null),rt.mat4x3f=new rt("mat4x3",jt.f32,null),rt.mat4x4f=new rt("mat4x4",jt.f32,null),rt.mat2x2h=new rt("mat2x2",jt.f16,null),rt.mat2x3h=new rt("mat2x3",jt.f16,null),rt.mat2x4h=new rt("mat2x4",jt.f16,null),rt.mat3x2h=new rt("mat3x2",jt.f16,null),rt.mat3x3h=new rt("mat3x3",jt.f16,null),rt.mat3x4h=new rt("mat3x4",jt.f16,null),rt.mat4x2h=new rt("mat4x2",jt.f16,null),rt.mat4x3h=new rt("mat4x3",jt.f16,null),rt.mat4x4h=new rt("mat4x4",jt.f16,null),rt.mat2x2i=new rt("mat2x2",jt.i32,null),rt.mat2x3i=new rt("mat2x3",jt.i32,null),rt.mat2x4i=new rt("mat2x4",jt.i32,null),rt.mat3x2i=new rt("mat3x2",jt.i32,null),rt.mat3x3i=new rt("mat3x3",jt.i32,null),rt.mat3x4i=new rt("mat3x4",jt.i32,null),rt.mat4x2i=new rt("mat4x2",jt.i32,null),rt.mat4x3i=new rt("mat4x3",jt.i32,null),rt.mat4x4i=new rt("mat4x4",jt.i32,null),rt.mat2x2u=new rt("mat2x2",jt.u32,null),rt.mat2x3u=new rt("mat2x3",jt.u32,null),rt.mat2x4u=new rt("mat2x4",jt.u32,null),rt.mat3x2u=new rt("mat3x2",jt.u32,null),rt.mat3x3u=new rt("mat3x3",jt.u32,null),rt.mat3x4u=new rt("mat3x4",jt.u32,null),rt.mat4x2u=new rt("mat4x2",jt.u32,null),rt.mat4x3u=new rt("mat4x3",jt.u32,null),rt.mat4x4u=new rt("mat4x4",jt.u32,null);class Tw extends jt{constructor(e,r,n,i){super(e),this.storage=r,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class zy extends jt{constructor(e,r,n,i){super(e),this.attributes=r,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Cy extends jt{constructor(e,r,n){super(e),this.format=r,this.access=n}get astNodeType(){return"sampler"}}class Nu extends Xl{constructor(){super(),this.postfix=null}}class Wp extends Nu{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Au extends Nu{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}}class hP extends Nu{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return LL.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(const r of this.args)r.search(e);e(this)}}class Ko extends Nu{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}}class GL extends Nu{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class Oa extends Nu{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof qe}get isVector(){return this.value instanceof Se||this.value instanceof Rr}get scalarValue(){return this.value instanceof qe?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Se||this.value instanceof Rr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class YL extends Nu{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Bg extends Nu{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class KL extends Nu{constructor(){super()}}class ba extends KL{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Bc extends KL{constructor(e,r,n){super(),this.operator=e,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?jt.f32:e.name==="u32"||r.name==="u32"?jt.u32:jt.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class QL extends Xl{constructor(e){super(),this.body=e}}class y0 extends Nu{constructor(){super()}get astNodeType(){return"default"}}class JL extends QL{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class eF extends QL{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class NC extends Xl{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"argument"}}class pq extends Xl{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class BC extends Xl{constructor(e,r,n){super(),this.name=e,this.type=r,this.attributes=n}get astNodeType(){return"member"}}class tF extends Xl{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}}class Wl{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=Wl._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Wl._id=0;class sE extends Wl{constructor(){super(new Ul("void",null),null)}toString(){return"void"}}sE.void=new sE;class fg extends Wl{constructor(e){super(new Ul("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,r,n,i){this.reference.setDataValue(e,r,n,i)}getSubData(e,r,n){return r?this.reference.getSubData(e,r,n):this}}class qe extends Wl{constructor(e,r,n=null){super(r,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new qe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new qe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new qe(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(r instanceof qe))return void console.error("SetDataValue: Invalid value",r);let o=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,r,n){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}}function mq(t,e,r){const n=e.length;return n===2?r==="f32"?new Se(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new Se(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new Se(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new Se(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):n===3?r==="f32"?new Se(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new Se(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new Se(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new Se(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):n===4?r==="f32"?new Se(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new Se(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new Se(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new Se(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Se extends Wl{constructor(e,r,n=null){if(super(r,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new Se(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Se(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Se(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,n,i){n instanceof Wp?console.error("TODO: Set vector postfix"):r instanceof Se?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Hp)i=this.typeInfo.format||i;else{const c=this.typeInfo.name;c==="vec2f"||c==="vec3f"||c==="vec4f"?i=e.getTypeInfo("f32"):c==="vec2i"||c==="vec3i"||c==="vec4i"?i=e.getTypeInfo("i32"):c==="vec2b"||c==="vec3b"||c==="vec4b"?i=e.getTypeInfo("bool"):c==="vec2u"||c==="vec3u"||c==="vec4u"?i=e.getTypeInfo("u32"):c==="vec2h"||c==="vec3h"||c==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${c}`)}let o=this;for(;r!==null&&o!==null;){if(r instanceof Bg){const c=r.index;let s=-1;if(c instanceof Oa){if(!(c.value instanceof qe))return console.error(`GetSubData: Invalid array index ${c.value}`),null;s=c.value.value}else{const m=e.evalExpression(c,n);if(!(m instanceof qe))return console.error("GetSubData: Unknown index type",c),null;s=m.value}if(s<0||s>=o.data.length)return console.error("GetSubData: Index out of range",s),null;if(o.data instanceof Float32Array){const m=new Float32Array(o.data.buffer,o.data.byteOffset+4*s,1);return new qe(m,i)}if(o.data instanceof Int32Array){const m=new Int32Array(o.data.buffer,o.data.byteOffset+4*s,1);return new qe(m,i)}if(o.data instanceof Uint32Array){const m=new Uint32Array(o.data.buffer,o.data.byteOffset+4*s,1);return new qe(m,i)}throw"GetSubData: Invalid data type"}if(!(r instanceof Wp))return console.error("GetSubData: Unknown postfix",r),null;{const c=r.value.toLowerCase();if(c.length===1){let m=0;if(c==="x"||c==="r")m=0;else if(c==="y"||c==="g")m=1;else if(c==="z"||c==="b")m=2;else{if(c!=="w"&&c!=="a")return console.error(`GetSubData: Unknown member ${c}`),null;m=3}if(this.data instanceof Float32Array){let v=new Float32Array(this.data.buffer,this.data.byteOffset+4*m,1);return new qe(v,i,this)}if(this.data instanceof Int32Array){let v=new Int32Array(this.data.buffer,this.data.byteOffset+4*m,1);return new qe(v,i,this)}if(this.data instanceof Uint32Array){let v=new Uint32Array(this.data.buffer,this.data.byteOffset+4*m,1);return new qe(v,i,this)}}const s=[];for(const m of c)m==="x"||m==="r"?s.push(this.data[0]):m==="y"||m==="g"?s.push(this.data[1]):m==="z"||m==="b"?s.push(this.data[2]):m==="w"||m==="a"?s.push(this.data[3]):console.error(`GetDataValue: Unknown member ${m}`);o=mq(e,s,i.name)}r=r.postfix}return o}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Rr extends Wl{constructor(e,r,n=null){super(r,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Rr(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,n,i){n instanceof Wp?console.error("TODO: Set matrix postfix"):r instanceof Rr?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,n){if(r===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Hp)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(r instanceof Bg){const o=r.index;let c=-1;if(o instanceof Oa){if(!(o.value instanceof qe))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;c=o.value.value}else{const v=e.evalExpression(o,n);if(!(v instanceof qe))return console.error("GetDataValue: Unknown index type",o),null;c=v.value}if(c<0||c>=this.data.length)return console.error("GetDataValue: Index out of range",c),null;const s=i.endsWith("h")?"h":"f";let m;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")m=new Se(new Float32Array(this.data.buffer,this.data.byteOffset+2*c*4,2),e.getTypeInfo(`vec2${s}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")m=new Se(new Float32Array(this.data.buffer,this.data.byteOffset+3*c*4,3),e.getTypeInfo(`vec3${s}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;m=new Se(new Float32Array(this.data.buffer,this.data.byteOffset+4*c*4,4),e.getTypeInfo(`vec4${s}`))}return r.postfix?m.getSubData(e,r.postfix,n):m}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}}class Wi extends Wl{constructor(e,r,n=0,i=null){super(r,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Wi(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,n,i){if(r===null)return void console.log("setDataValue: NULL data.");let o=this.offset,c=this.typeInfo;for(;n;){if(n instanceof Bg)if(c instanceof pd){const s=n.index;if(s instanceof Oa){if(!(s.value instanceof qe))return void console.error(`SetDataValue: Invalid index type ${s.value}`);o+=s.value.value*c.stride}else{const m=e.evalExpression(s,i);if(!(m instanceof qe))return void console.error("SetDataValue: Unknown index type",s);o+=m.value*c.stride}c=c.format}else console.error(`SetDataValue: Type ${c.getTypeName()} is not an array`);else{if(!(n instanceof Wp))return void console.error("SetDataValue: Unknown postfix type",n);{const s=n.value;if(c instanceof cd){let m=!1;for(const v of c.members)if(v.name===s){o+=v.offset,c=v.type,m=!0;break}if(!m)return void console.error(`SetDataValue: Member ${s} not found`)}else if(c instanceof Ul){const m=c.getTypeName();let v=0;if(s==="x"||s==="r")v=0;else if(s==="y"||s==="g")v=1;else if(s==="z"||s==="b")v=2;else{if(s!=="w"&&s!=="a")return void console.error(`SetDataValue: Unknown member ${s}`);v=3}if(!(r instanceof qe))return void console.error("SetDataValue: Invalid value",r);const w=r.value;return m==="vec2f"?void(new Float32Array(this.buffer,o,2)[v]=w):m==="vec3f"?void(new Float32Array(this.buffer,o,3)[v]=w):m==="vec4f"?void(new Float32Array(this.buffer,o,4)[v]=w):m==="vec2i"?void(new Int32Array(this.buffer,o,2)[v]=w):m==="vec3i"?void(new Int32Array(this.buffer,o,3)[v]=w):m==="vec4i"?void(new Int32Array(this.buffer,o,4)[v]=w):m==="vec2u"?void(new Uint32Array(this.buffer,o,2)[v]=w):m==="vec3u"?void(new Uint32Array(this.buffer,o,3)[v]=w):m==="vec4u"?void(new Uint32Array(this.buffer,o,4)[v]=w):void console.error(`SetDataValue: Type ${m} is not a struct`)}}}n=n.postfix}this.setData(e,r,c,o,i)}setData(e,r,n,i,o){const c=n.getTypeName();if(c!=="f32"&&c!=="f16")if(c!=="i32"&&c!=="atomic<i32>"&&c!=="x32")if(c!=="u32"&&c!=="atomic<u32>")if(c!=="bool")if(c!=="vec2f"&&c!=="vec2h")if(c!=="vec3f"&&c!=="vec3h")if(c!=="vec4f"&&c!=="vec4h")if(c!=="vec2i")if(c!=="vec3i")if(c!=="vec4i")if(c!=="vec2u")if(c!=="vec3u")if(c!=="vec4u")if(c!=="vec2b")if(c!=="vec3b")if(c!=="vec4b")if(c!=="mat2x2f"&&c!=="mat2x2h")if(c!=="mat2x3f"&&c!=="mat2x3h")if(c!=="mat2x4f"&&c!=="mat2x4h")if(c!=="mat3x2f"&&c!=="mat3x2h")if(c!=="mat3x3f"&&c!=="mat3x3h")if(c!=="mat3x4f"&&c!=="mat3x4h")if(c!=="mat4x2f"&&c!=="mat4x2h")if(c!=="mat4x3f"&&c!=="mat4x3h")if(c!=="mat4x4f"&&c!=="mat4x4h")if(r instanceof Wi){if(n===r.typeInfo)return void new Uint8Array(this.buffer,i,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",c,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${c}`);else{const s=new Float32Array(this.buffer,i,16);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11],s[12]=r.data[12],s[13]=r.data[13],s[14]=r.data[14],s[15]=r.data[15]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15])}else{const s=new Float32Array(this.buffer,i,12);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11])}else{const s=new Float32Array(this.buffer,i,8);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7])}else{const s=new Float32Array(this.buffer,i,12);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8],s[9]=r.data[9],s[10]=r.data[10],s[11]=r.data[11]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11])}else{const s=new Float32Array(this.buffer,i,9);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7],s[8]=r.data[8]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8])}else{const s=new Float32Array(this.buffer,i,6);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5])}else{const s=new Float32Array(this.buffer,i,8);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5],s[6]=r.data[6],s[7]=r.data[7]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7])}else{const s=new Float32Array(this.buffer,i,6);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3],s[4]=r.data[4],s[5]=r.data[5]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5])}else{const s=new Float32Array(this.buffer,i,4);r instanceof Rr?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3])}else{const s=new Uint32Array(this.buffer,i,4);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3])}else{const s=new Uint32Array(this.buffer,i,3);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2])}else{const s=new Uint32Array(this.buffer,i,2);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1])}else{const s=new Uint32Array(this.buffer,i,4);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3])}else{const s=new Uint32Array(this.buffer,i,3);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2])}else{const s=new Uint32Array(this.buffer,i,2);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1])}else{const s=new Int32Array(this.buffer,i,4);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3])}else{const s=new Int32Array(this.buffer,i,3);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2])}else{const s=new Int32Array(this.buffer,i,2);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1])}else{const s=new Float32Array(this.buffer,i,4);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2],s[3]=r.data[3]):(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3])}else{const s=new Float32Array(this.buffer,i,3);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1],s[2]=r.data[2]):(s[0]=r[0],s[1]=r[1],s[2]=r[2])}else{const s=new Float32Array(this.buffer,i,2);r instanceof Se?(s[0]=r.data[0],s[1]=r.data[1]):(s[0]=r[0],s[1]=r[1])}else r instanceof qe&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof qe&&(new Uint32Array(this.buffer,i,1)[0]=r.value);else r instanceof qe&&(new Int32Array(this.buffer,i,1)[0]=r.value);else r instanceof qe&&(new Float32Array(this.buffer,i,1)[0]=r.value)}getSubData(e,r,n){var i,o,c;if(r===null)return this;let s=this.offset,m=this.typeInfo;for(;r;){if(r instanceof Bg){const w=r.index,M=e.evalExpression(w,n);let I=0;if(M instanceof qe?I=M.value:console.error("GetDataValue: Invalid index type",w),m instanceof pd)s+=I*m.stride,m=m.format;else{const k=m.getTypeName();k==="mat4x4"||k==="mat4x4f"||k==="mat4x4h"?(s+=16*I,m=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${m.getTypeName()} is not an array`)}}else{if(!(r instanceof Wp))return console.error("GetDataValue: Unknown postfix type",r),null;{const w=r.value;if(m instanceof cd){let M=!1;for(const I of m.members)if(I.name===w){s+=I.offset,m=I.type,M=!0;break}if(!M)return console.error(`GetDataValue: Member ${w} not found`),null}else if(m instanceof Ul){const M=m.getTypeName();if(M==="vec2f"||M==="vec3f"||M==="vec4f"||M==="vec2i"||M==="vec3i"||M==="vec4i"||M==="vec2u"||M==="vec3u"||M==="vec4u"||M==="vec2b"||M==="vec3b"||M==="vec4b"||M==="vec2h"||M==="vec3h"||M==="vec4h"||M==="vec2"||M==="vec3"||M==="vec4"){if(w.length>0&&w.length<5){let I="f";const k=[];for(let z=0;z<w.length;++z){const V=w[z].toLowerCase();let U=0;if(V==="x"||V==="r")U=0;else if(V==="y"||V==="g")U=1;else if(V==="z"||V==="b")U=2;else{if(V!=="w"&&V!=="a")return console.error(`Unknown member ${w}`),null;U=3}if(w.length===1){if(M.endsWith("f"))return this.buffer.byteLength<s+4*U+4?(console.log("Insufficient buffer data"),null):new qe(new Float32Array(this.buffer,s+4*U,1),e.getTypeInfo("f32"),this);if(M.endsWith("h"))return new qe(new Float32Array(this.buffer,s+4*U,1),e.getTypeInfo("f16"),this);if(M.endsWith("i"))return new qe(new Int32Array(this.buffer,s+4*U,1),e.getTypeInfo("i32"),this);if(M.endsWith("b"))return new qe(new Int32Array(this.buffer,s+4*U,1),e.getTypeInfo("bool"),this);if(M.endsWith("u"))return new qe(new Uint32Array(this.buffer,s+4*U,1),e.getTypeInfo("i32"),this)}if(M==="vec2f")k.push(new Float32Array(this.buffer,s,2)[U]);else if(M==="vec3f"){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const K=new Float32Array(this.buffer,s,3);k.push(K[U])}else if(M==="vec4f")k.push(new Float32Array(this.buffer,s,4)[U]);else if(M==="vec2i")I="i",k.push(new Int32Array(this.buffer,s,2)[U]);else if(M==="vec3i")I="i",k.push(new Int32Array(this.buffer,s,3)[U]);else if(M==="vec4i")I="i",k.push(new Int32Array(this.buffer,s,4)[U]);else if(M==="vec2u"){I="u";const K=new Uint32Array(this.buffer,s,2);k.push(K[U])}else M==="vec3u"?(I="u",k.push(new Uint32Array(this.buffer,s,3)[U])):M==="vec4u"&&(I="u",k.push(new Uint32Array(this.buffer,s,4)[U]))}return k.length===2?m=e.getTypeInfo(`vec2${I}`):k.length===3?m=e.getTypeInfo(`vec3${I}`):k.length===4?m=e.getTypeInfo(`vec4${I}`):console.error(`GetDataValue: Invalid vector length ${k.length}`),new Se(k,m,null)}return console.error(`GetDataValue: Unknown member ${w}`),null}return console.error(`GetDataValue: Type ${M} is not a struct`),null}}}r=r.postfix}const v=m.getTypeName();return v==="f32"?new qe(new Float32Array(this.buffer,s,1),m,this):v==="i32"?new qe(new Int32Array(this.buffer,s,1),m,this):v==="u32"?new qe(new Uint32Array(this.buffer,s,1),m,this):v==="vec2f"?new Se(new Float32Array(this.buffer,s,2),m,this):v==="vec3f"?new Se(new Float32Array(this.buffer,s,3),m,this):v==="vec4f"?new Se(new Float32Array(this.buffer,s,4),m,this):v==="vec2i"?new Se(new Int32Array(this.buffer,s,2),m,this):v==="vec3i"?new Se(new Int32Array(this.buffer,s,3),m,this):v==="vec4i"?new Se(new Int32Array(this.buffer,s,4),m,this):v==="vec2u"?new Se(new Uint32Array(this.buffer,s,2),m,this):v==="vec3u"?new Se(new Uint32Array(this.buffer,s,3),m,this):v==="vec4u"?new Se(new Uint32Array(this.buffer,s,4),m,this):m instanceof Hp&&m.name==="atomic"?((i=m.format)===null||i===void 0?void 0:i.name)==="u32"?new qe(new Uint32Array(this.buffer,s,1)[0],m.format,this):((o=m.format)===null||o===void 0?void 0:o.name)==="i32"?new qe(new Int32Array(this.buffer,s,1)[0],m.format,this):(console.error(`GetDataValue: Invalid atomic format ${(c=m.format)===null||c===void 0?void 0:c.name}`),null):new Wi(this.buffer,m,s,this)}toString(){let e="";if(this.typeInfo instanceof pd)if(this.typeInfo.format.name==="f32"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="i32"){const r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="u32"){const r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let n=1;n<r.length;++n)e+=`, ${r[n]}`}else if(this.typeInfo.format.name==="vec2f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let n=1;n<r.length/2;++n)e+=`, [${r[2*n]}, ${r[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let n=4;n<r.length;n+=4)e+=`, [${r[n]}, ${r[n+1]}, ${r[n+2]}, ${r[n+3]}]`}else e="[...]";else this.typeInfo instanceof cd?e+="{...}":e="[...]";return e}}class Bh extends Wl{constructor(e,r,n,i){super(r,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new Bh(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.width)!==null&&r!==void 0?r:0}get height(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(r=n.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const r=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<r.length;++n)r[n]=Math.max(1,r[n]>>e);return r}get texelByteSize(){const e=this.format,r=ww[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,r=ww[e];return!!r&&r.isDepthStencil}getGpuSize(){const e=this.format,r=ww[e],n=this.width;if(!e||n<=0||!r)return-1;const i=this.height,o=this.depthOrArrayLayers,c=this.dimension;return n/r.blockWidth*(c==="1d"?1:i/r.blockHeight)*r.bytesPerBlock*o}getPixel(e,r,n=0,i=0){const o=this.texelByteSize,c=this.bytesPerRow,s=this.height,m=this.data[i];return cq(new Uint8Array(m),e,r,n,i,s,c,o,this.format)}setPixel(e,r,n,i,o){const c=this.texelByteSize,s=this.bytesPerRow,m=this.height,v=this.data[i];(function(w,M,I,k,z,V,U,K,J,Z){const re=k*(U>>=z)*(V>>=z)+I*U+M*K;switch(J){case"r8unorm":return void Dn(w,re,"8unorm",1,Z);case"r8snorm":return void Dn(w,re,"8snorm",1,Z);case"r8uint":return void Dn(w,re,"8uint",1,Z);case"r8sint":return void Dn(w,re,"8sint",1,Z);case"rg8unorm":return void Dn(w,re,"8unorm",2,Z);case"rg8snorm":return void Dn(w,re,"8snorm",2,Z);case"rg8uint":return void Dn(w,re,"8uint",2,Z);case"rg8sint":return void Dn(w,re,"8sint",2,Z);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Dn(w,re,"8unorm",4,Z);case"rgba8snorm":return void Dn(w,re,"8snorm",4,Z);case"rgba8uint":return void Dn(w,re,"8uint",4,Z);case"rgba8sint":return void Dn(w,re,"8sint",4,Z);case"r16uint":return void Dn(w,re,"16uint",1,Z);case"r16sint":return void Dn(w,re,"16sint",1,Z);case"r16float":return void Dn(w,re,"16float",1,Z);case"rg16uint":return void Dn(w,re,"16uint",2,Z);case"rg16sint":return void Dn(w,re,"16sint",2,Z);case"rg16float":return void Dn(w,re,"16float",2,Z);case"rgba16uint":return void Dn(w,re,"16uint",4,Z);case"rgba16sint":return void Dn(w,re,"16sint",4,Z);case"rgba16float":return void Dn(w,re,"16float",4,Z);case"r32uint":return void Dn(w,re,"32uint",1,Z);case"r32sint":return void Dn(w,re,"32sint",1,Z);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Dn(w,re,"32float",1,Z);case"rg32uint":return void Dn(w,re,"32uint",2,Z);case"rg32sint":return void Dn(w,re,"32sint",2,Z);case"rg32float":return void Dn(w,re,"32float",2,Z);case"rgba32uint":return void Dn(w,re,"32uint",4,Z);case"rgba32sint":return void Dn(w,re,"32sint",4,Z);case"rgba32float":return void Dn(w,re,"32float",4,Z);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(v),e,r,n,i,m,s,c,this.format,o)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(We||(We={}));class Xe{constructor(e,r,n){this.name=e,this.type=r,this.rule=n}toString(){return this.name}}class ye{}ut=ye,ye.none=new Xe("",We.reserved,""),ye.eof=new Xe("EOF",We.token,""),ye.reserved={asm:new Xe("asm",We.reserved,"asm"),bf16:new Xe("bf16",We.reserved,"bf16"),do:new Xe("do",We.reserved,"do"),enum:new Xe("enum",We.reserved,"enum"),f16:new Xe("f16",We.reserved,"f16"),f64:new Xe("f64",We.reserved,"f64"),handle:new Xe("handle",We.reserved,"handle"),i8:new Xe("i8",We.reserved,"i8"),i16:new Xe("i16",We.reserved,"i16"),i64:new Xe("i64",We.reserved,"i64"),mat:new Xe("mat",We.reserved,"mat"),premerge:new Xe("premerge",We.reserved,"premerge"),regardless:new Xe("regardless",We.reserved,"regardless"),typedef:new Xe("typedef",We.reserved,"typedef"),u8:new Xe("u8",We.reserved,"u8"),u16:new Xe("u16",We.reserved,"u16"),u64:new Xe("u64",We.reserved,"u64"),unless:new Xe("unless",We.reserved,"unless"),using:new Xe("using",We.reserved,"using"),vec:new Xe("vec",We.reserved,"vec"),void:new Xe("void",We.reserved,"void")},ye.keywords={array:new Xe("array",We.keyword,"array"),atomic:new Xe("atomic",We.keyword,"atomic"),bool:new Xe("bool",We.keyword,"bool"),f32:new Xe("f32",We.keyword,"f32"),i32:new Xe("i32",We.keyword,"i32"),mat2x2:new Xe("mat2x2",We.keyword,"mat2x2"),mat2x3:new Xe("mat2x3",We.keyword,"mat2x3"),mat2x4:new Xe("mat2x4",We.keyword,"mat2x4"),mat3x2:new Xe("mat3x2",We.keyword,"mat3x2"),mat3x3:new Xe("mat3x3",We.keyword,"mat3x3"),mat3x4:new Xe("mat3x4",We.keyword,"mat3x4"),mat4x2:new Xe("mat4x2",We.keyword,"mat4x2"),mat4x3:new Xe("mat4x3",We.keyword,"mat4x3"),mat4x4:new Xe("mat4x4",We.keyword,"mat4x4"),ptr:new Xe("ptr",We.keyword,"ptr"),sampler:new Xe("sampler",We.keyword,"sampler"),sampler_comparison:new Xe("sampler_comparison",We.keyword,"sampler_comparison"),struct:new Xe("struct",We.keyword,"struct"),texture_1d:new Xe("texture_1d",We.keyword,"texture_1d"),texture_2d:new Xe("texture_2d",We.keyword,"texture_2d"),texture_2d_array:new Xe("texture_2d_array",We.keyword,"texture_2d_array"),texture_3d:new Xe("texture_3d",We.keyword,"texture_3d"),texture_cube:new Xe("texture_cube",We.keyword,"texture_cube"),texture_cube_array:new Xe("texture_cube_array",We.keyword,"texture_cube_array"),texture_multisampled_2d:new Xe("texture_multisampled_2d",We.keyword,"texture_multisampled_2d"),texture_storage_1d:new Xe("texture_storage_1d",We.keyword,"texture_storage_1d"),texture_storage_2d:new Xe("texture_storage_2d",We.keyword,"texture_storage_2d"),texture_storage_2d_array:new Xe("texture_storage_2d_array",We.keyword,"texture_storage_2d_array"),texture_storage_3d:new Xe("texture_storage_3d",We.keyword,"texture_storage_3d"),texture_depth_2d:new Xe("texture_depth_2d",We.keyword,"texture_depth_2d"),texture_depth_2d_array:new Xe("texture_depth_2d_array",We.keyword,"texture_depth_2d_array"),texture_depth_cube:new Xe("texture_depth_cube",We.keyword,"texture_depth_cube"),texture_depth_cube_array:new Xe("texture_depth_cube_array",We.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Xe("texture_depth_multisampled_2d",We.keyword,"texture_depth_multisampled_2d"),texture_external:new Xe("texture_external",We.keyword,"texture_external"),u32:new Xe("u32",We.keyword,"u32"),vec2:new Xe("vec2",We.keyword,"vec2"),vec3:new Xe("vec3",We.keyword,"vec3"),vec4:new Xe("vec4",We.keyword,"vec4"),bitcast:new Xe("bitcast",We.keyword,"bitcast"),block:new Xe("block",We.keyword,"block"),break:new Xe("break",We.keyword,"break"),case:new Xe("case",We.keyword,"case"),continue:new Xe("continue",We.keyword,"continue"),continuing:new Xe("continuing",We.keyword,"continuing"),default:new Xe("default",We.keyword,"default"),diagnostic:new Xe("diagnostic",We.keyword,"diagnostic"),discard:new Xe("discard",We.keyword,"discard"),else:new Xe("else",We.keyword,"else"),enable:new Xe("enable",We.keyword,"enable"),fallthrough:new Xe("fallthrough",We.keyword,"fallthrough"),false:new Xe("false",We.keyword,"false"),fn:new Xe("fn",We.keyword,"fn"),for:new Xe("for",We.keyword,"for"),function:new Xe("function",We.keyword,"function"),if:new Xe("if",We.keyword,"if"),let:new Xe("let",We.keyword,"let"),const:new Xe("const",We.keyword,"const"),loop:new Xe("loop",We.keyword,"loop"),while:new Xe("while",We.keyword,"while"),private:new Xe("private",We.keyword,"private"),read:new Xe("read",We.keyword,"read"),read_write:new Xe("read_write",We.keyword,"read_write"),return:new Xe("return",We.keyword,"return"),requires:new Xe("requires",We.keyword,"requires"),storage:new Xe("storage",We.keyword,"storage"),switch:new Xe("switch",We.keyword,"switch"),true:new Xe("true",We.keyword,"true"),alias:new Xe("alias",We.keyword,"alias"),type:new Xe("type",We.keyword,"type"),uniform:new Xe("uniform",We.keyword,"uniform"),var:new Xe("var",We.keyword,"var"),override:new Xe("override",We.keyword,"override"),workgroup:new Xe("workgroup",We.keyword,"workgroup"),write:new Xe("write",We.keyword,"write"),r8unorm:new Xe("r8unorm",We.keyword,"r8unorm"),r8snorm:new Xe("r8snorm",We.keyword,"r8snorm"),r8uint:new Xe("r8uint",We.keyword,"r8uint"),r8sint:new Xe("r8sint",We.keyword,"r8sint"),r16uint:new Xe("r16uint",We.keyword,"r16uint"),r16sint:new Xe("r16sint",We.keyword,"r16sint"),r16float:new Xe("r16float",We.keyword,"r16float"),rg8unorm:new Xe("rg8unorm",We.keyword,"rg8unorm"),rg8snorm:new Xe("rg8snorm",We.keyword,"rg8snorm"),rg8uint:new Xe("rg8uint",We.keyword,"rg8uint"),rg8sint:new Xe("rg8sint",We.keyword,"rg8sint"),r32uint:new Xe("r32uint",We.keyword,"r32uint"),r32sint:new Xe("r32sint",We.keyword,"r32sint"),r32float:new Xe("r32float",We.keyword,"r32float"),rg16uint:new Xe("rg16uint",We.keyword,"rg16uint"),rg16sint:new Xe("rg16sint",We.keyword,"rg16sint"),rg16float:new Xe("rg16float",We.keyword,"rg16float"),rgba8unorm:new Xe("rgba8unorm",We.keyword,"rgba8unorm"),rgba8unorm_srgb:new Xe("rgba8unorm_srgb",We.keyword,"rgba8unorm_srgb"),rgba8snorm:new Xe("rgba8snorm",We.keyword,"rgba8snorm"),rgba8uint:new Xe("rgba8uint",We.keyword,"rgba8uint"),rgba8sint:new Xe("rgba8sint",We.keyword,"rgba8sint"),bgra8unorm:new Xe("bgra8unorm",We.keyword,"bgra8unorm"),bgra8unorm_srgb:new Xe("bgra8unorm_srgb",We.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Xe("rgb10a2unorm",We.keyword,"rgb10a2unorm"),rg11b10float:new Xe("rg11b10float",We.keyword,"rg11b10float"),rg32uint:new Xe("rg32uint",We.keyword,"rg32uint"),rg32sint:new Xe("rg32sint",We.keyword,"rg32sint"),rg32float:new Xe("rg32float",We.keyword,"rg32float"),rgba16uint:new Xe("rgba16uint",We.keyword,"rgba16uint"),rgba16sint:new Xe("rgba16sint",We.keyword,"rgba16sint"),rgba16float:new Xe("rgba16float",We.keyword,"rgba16float"),rgba32uint:new Xe("rgba32uint",We.keyword,"rgba32uint"),rgba32sint:new Xe("rgba32sint",We.keyword,"rgba32sint"),rgba32float:new Xe("rgba32float",We.keyword,"rgba32float"),static_assert:new Xe("static_assert",We.keyword,"static_assert")},ye.tokens={decimal_float_literal:new Xe("decimal_float_literal",We.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new Xe("hex_float_literal",We.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new Xe("int_literal",We.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Xe("uint_literal",We.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new Xe("name",We.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new Xe("ident",We.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new Xe("and",We.token,"&"),and_and:new Xe("and_and",We.token,"&&"),arrow:new Xe("arrow ",We.token,"->"),attr:new Xe("attr",We.token,"@"),forward_slash:new Xe("forward_slash",We.token,"/"),bang:new Xe("bang",We.token,"!"),bracket_left:new Xe("bracket_left",We.token,"["),bracket_right:new Xe("bracket_right",We.token,"]"),brace_left:new Xe("brace_left",We.token,"{"),brace_right:new Xe("brace_right",We.token,"}"),colon:new Xe("colon",We.token,":"),comma:new Xe("comma",We.token,","),equal:new Xe("equal",We.token,"="),equal_equal:new Xe("equal_equal",We.token,"=="),not_equal:new Xe("not_equal",We.token,"!="),greater_than:new Xe("greater_than",We.token,">"),greater_than_equal:new Xe("greater_than_equal",We.token,">="),shift_right:new Xe("shift_right",We.token,">>"),less_than:new Xe("less_than",We.token,"<"),less_than_equal:new Xe("less_than_equal",We.token,"<="),shift_left:new Xe("shift_left",We.token,"<<"),modulo:new Xe("modulo",We.token,"%"),minus:new Xe("minus",We.token,"-"),minus_minus:new Xe("minus_minus",We.token,"--"),period:new Xe("period",We.token,"."),plus:new Xe("plus",We.token,"+"),plus_plus:new Xe("plus_plus",We.token,"++"),or:new Xe("or",We.token,"|"),or_or:new Xe("or_or",We.token,"||"),paren_left:new Xe("paren_left",We.token,"("),paren_right:new Xe("paren_right",We.token,")"),semicolon:new Xe("semicolon",We.token,";"),star:new Xe("star",We.token,"*"),tilde:new Xe("tilde",We.token,"~"),underscore:new Xe("underscore",We.token,"_"),xor:new Xe("xor",We.token,"^"),plus_equal:new Xe("plus_equal",We.token,"+="),minus_equal:new Xe("minus_equal",We.token,"-="),times_equal:new Xe("times_equal",We.token,"*="),division_equal:new Xe("division_equal",We.token,"/="),modulo_equal:new Xe("modulo_equal",We.token,"%="),and_equal:new Xe("and_equal",We.token,"&="),or_equal:new Xe("or_equal",We.token,"|="),xor_equal:new Xe("xor_equal",We.token,"^="),shift_right_equal:new Xe("shift_right_equal",We.token,">>="),shift_left_equal:new Xe("shift_left_equal",We.token,"<<=")},ye.simpleTokens={"@":ut.tokens.attr,"{":ut.tokens.brace_left,"}":ut.tokens.brace_right,":":ut.tokens.colon,",":ut.tokens.comma,"(":ut.tokens.paren_left,")":ut.tokens.paren_right,";":ut.tokens.semicolon},ye.literalTokens={"&":ut.tokens.and,"&&":ut.tokens.and_and,"->":ut.tokens.arrow,"/":ut.tokens.forward_slash,"!":ut.tokens.bang,"[":ut.tokens.bracket_left,"]":ut.tokens.bracket_right,"=":ut.tokens.equal,"==":ut.tokens.equal_equal,"!=":ut.tokens.not_equal,">":ut.tokens.greater_than,">=":ut.tokens.greater_than_equal,">>":ut.tokens.shift_right,"<":ut.tokens.less_than,"<=":ut.tokens.less_than_equal,"<<":ut.tokens.shift_left,"%":ut.tokens.modulo,"-":ut.tokens.minus,"--":ut.tokens.minus_minus,".":ut.tokens.period,"+":ut.tokens.plus,"++":ut.tokens.plus_plus,"|":ut.tokens.or,"||":ut.tokens.or_or,"*":ut.tokens.star,"~":ut.tokens.tilde,_:ut.tokens.underscore,"^":ut.tokens.xor,"+=":ut.tokens.plus_equal,"-=":ut.tokens.minus_equal,"*=":ut.tokens.times_equal,"/=":ut.tokens.division_equal,"%=":ut.tokens.modulo_equal,"&=":ut.tokens.and_equal,"|=":ut.tokens.or_equal,"^=":ut.tokens.xor_equal,">>=":ut.tokens.shift_right_equal,"<<=":ut.tokens.shift_left_equal},ye.regexTokens={decimal_float_literal:ut.tokens.decimal_float_literal,hex_float_literal:ut.tokens.hex_float_literal,int_literal:ut.tokens.int_literal,uint_literal:ut.tokens.uint_literal,ident:ut.tokens.ident},ye.storage_class=[ut.keywords.function,ut.keywords.private,ut.keywords.workgroup,ut.keywords.uniform,ut.keywords.storage],ye.access_mode=[ut.keywords.read,ut.keywords.write,ut.keywords.read_write],ye.sampler_type=[ut.keywords.sampler,ut.keywords.sampler_comparison],ye.sampled_texture_type=[ut.keywords.texture_1d,ut.keywords.texture_2d,ut.keywords.texture_2d_array,ut.keywords.texture_3d,ut.keywords.texture_cube,ut.keywords.texture_cube_array],ye.multisampled_texture_type=[ut.keywords.texture_multisampled_2d],ye.storage_texture_type=[ut.keywords.texture_storage_1d,ut.keywords.texture_storage_2d,ut.keywords.texture_storage_2d_array,ut.keywords.texture_storage_3d],ye.depth_texture_type=[ut.keywords.texture_depth_2d,ut.keywords.texture_depth_2d_array,ut.keywords.texture_depth_cube,ut.keywords.texture_depth_cube_array,ut.keywords.texture_depth_multisampled_2d],ye.texture_external_type=[ut.keywords.texture_external],ye.any_texture_type=[...ut.sampled_texture_type,...ut.multisampled_texture_type,...ut.storage_texture_type,...ut.depth_texture_type,...ut.texture_external_type],ye.texel_format=[ut.keywords.r8unorm,ut.keywords.r8snorm,ut.keywords.r8uint,ut.keywords.r8sint,ut.keywords.r16uint,ut.keywords.r16sint,ut.keywords.r16float,ut.keywords.rg8unorm,ut.keywords.rg8snorm,ut.keywords.rg8uint,ut.keywords.rg8sint,ut.keywords.r32uint,ut.keywords.r32sint,ut.keywords.r32float,ut.keywords.rg16uint,ut.keywords.rg16sint,ut.keywords.rg16float,ut.keywords.rgba8unorm,ut.keywords.rgba8unorm_srgb,ut.keywords.rgba8snorm,ut.keywords.rgba8uint,ut.keywords.rgba8sint,ut.keywords.bgra8unorm,ut.keywords.bgra8unorm_srgb,ut.keywords.rgb10a2unorm,ut.keywords.rg11b10float,ut.keywords.rg32uint,ut.keywords.rg32sint,ut.keywords.rg32float,ut.keywords.rgba16uint,ut.keywords.rgba16sint,ut.keywords.rgba16float,ut.keywords.rgba32uint,ut.keywords.rgba32sint,ut.keywords.rgba32float],ye.const_literal=[ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.decimal_float_literal,ut.tokens.hex_float_literal,ut.keywords.true,ut.keywords.false],ye.literal_or_ident=[ut.tokens.ident,ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.decimal_float_literal,ut.tokens.hex_float_literal,ut.tokens.name],ye.element_count_expression=[ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.ident],ye.template_types=[ut.keywords.vec2,ut.keywords.vec3,ut.keywords.vec4,ut.keywords.mat2x2,ut.keywords.mat2x3,ut.keywords.mat2x4,ut.keywords.mat3x2,ut.keywords.mat3x3,ut.keywords.mat3x4,ut.keywords.mat4x2,ut.keywords.mat4x3,ut.keywords.mat4x4,ut.keywords.atomic,ut.keywords.bitcast,...ut.any_texture_type],ye.attribute_name=[ut.tokens.ident,ut.keywords.block,ut.keywords.diagnostic],ye.assignment_operators=[ut.tokens.equal,ut.tokens.plus_equal,ut.tokens.minus_equal,ut.tokens.times_equal,ut.tokens.division_equal,ut.tokens.modulo_equal,ut.tokens.and_equal,ut.tokens.or_equal,ut.tokens.xor_equal,ut.tokens.shift_right_equal,ut.tokens.shift_left_equal],ye.increment_operators=[ut.tokens.plus_plus,ut.tokens.minus_minus];class LC{constructor(e,r,n,i,o){this.type=e,this.lexeme=r,this.line=n,this.start=i,this.end=o}toString(){return this.lexeme}isTemplateType(){return ye.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==ye.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class gq{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new LC(ye.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const r=ye.simpleTokens[e];if(r)return this._addToken(r),!0;let n=ye.none;const i=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(i){const c=ye.keywords[e];if(c)return this._addToken(c),!0}if(i||o)return this._addToken(ye.tokens.ident),!0;for(;;){let c=this._findType(e);const s=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(s=="=")return this._current++,e+=s,this._addToken(ye.tokens.minus_equal),!0;if(s=="-")return this._current++,e+=s,this._addToken(ye.tokens.minus_minus),!0;const m=this._tokens.length-1;if((ye.literal_or_ident.indexOf(this._tokens[m].type)!=-1||this._tokens[m].type==ye.tokens.paren_right)&&s!=">")return this._addToken(c),!0}if(e==">"&&(s==">"||s=="=")){let m=!1,v=this._tokens.length-1;for(let w=0;w<5&&v>=0&&ye.assignment_operators.indexOf(this._tokens[v].type)===-1;++w,--v)if(this._tokens[v].type===ye.tokens.less_than){v>0&&this._tokens[v-1].isArrayOrTemplateType()&&(m=!0);break}if(m)return this._addToken(c),!0}if(c===ye.none){let m=e,v=0;const w=2;for(let M=0;M<w;++M)if(m+=this._peekAhead(M),c=this._findType(m),c!==ye.none){v=M;break}if(c===ye.none)return n!==ye.none&&(this._current--,this._addToken(n),!0);e=m,this._current+=v+1}if(n=c,this._isAtEnd())break;e+=this._advance()}return n!==ye.none&&(this._addToken(n),!0)}_findType(e){for(const n in ye.regexTokens){const i=ye.regexTokens[n];if(this._match(e,i.rule))return i}return ye.literalTokens[e]||ye.none}_match(e,r){const n=r.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const r=this._source.substring(this._start,this._current);this._tokens.push(new LC(e,r,this._line,this._start,this._current))}}function sr(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const L0=new Float32Array(1),_q=new Uint32Array(L0.buffer),yq=new Uint32Array(L0.buffer),F0=new Int32Array(1),vq=new Float32Array(F0.buffer),bq=new Uint32Array(F0.buffer),z0=new Uint32Array(1),xq=new Float32Array(z0.buffer),wq=new Int32Array(z0.buffer);function FC(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return L0[0]=t,_q[0];if(r==="u32")return L0[0]=t,yq[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return F0[0]=t,vq[0];if(r==="u32")return F0[0]=t,bq[0]}else if(e==="u32"){if(r==="f32")return z0[0]=t,xq[0];if(r==="i32"||r==="x32")return z0[0]=t,wq[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}class Tq{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Xb{constructor(e,r){this.align=e,this.size=r}}class Pu{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new sq,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const r of e)r instanceof Yy&&this._functions.set(r.name,new Tq(r));for(const r of e)if(r instanceof Nh){const n=this.getTypeInfo(r,null);n instanceof cd&&this.structs.push(n)}for(const r of e)if(r instanceof uP)this.aliases.push(this._getAliasInfo(r));else if(r instanceof lP){const n=r,i=this._getAttributeNum(n.attributes,"id",0),o=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new nq(n.name,o,n.attributes,i))}else if(this._isUniformVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=new Zb(n.name,c,i,o,n.attributes,id.Uniform,n.access);s.access||(s.access="read"),this.uniforms.push(s)}else if(this._isStorageVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=this._isStorageTexture(c),m=new Zb(n.name,c,i,o,n.attributes,s?id.StorageTexture:id.Storage,n.access);m.access||(m.access="read"),this.storage.push(m)}else if(this._isTextureVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=this._isStorageTexture(c),m=new Zb(n.name,c,i,o,n.attributes,s?id.StorageTexture:id.Texture,n.access);m.access||(m.access="read"),s?this.storage.push(m):this.textures.push(m)}else if(this._isSamplerVar(r)){const n=r,i=this._getAttributeNum(n.attributes,"group",0),o=this._getAttributeNum(n.attributes,"binding",0),c=this.getTypeInfo(n.type,n.attributes),s=new Zb(n.name,c,i,o,n.attributes,id.Sampler,n.access);this.samplers.push(s)}else if(r instanceof Yy){const n=this._getAttribute(r,"vertex"),i=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),c=n||i||o,s=new aq(r.name,c==null?void 0:c.name,r.attributes);s.attributes=r.attributes,s.startLine=r.startLine,s.endLine=r.endLine,this.functions.push(s),this._functions.get(r.name).info=s,c&&(this._functions.get(r.name).inUse=!0,s.inUse=!0,s.resources=this._findResources(r,!!c),s.inputs=this._getInputs(r.args),s.outputs=this._getOutputs(r.returnType),this.entry[c.name].push(s)),s.arguments=r.args.map(m=>new iq(m.name,this.getTypeInfo(m.type,m.attributes),m.attributes)),s.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null}for(const r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(const r of this._functions.values())r.node.search(n=>{var i,o,c;if(n instanceof tF){if(n.value)if(sr(n.value))for(const s of n.value)for(const m of this.overrides)s===m.name&&((i=r.info)===null||i===void 0||i.overrides.push(m));else for(const s of this.overrides)n.value===s.name&&((o=r.info)===null||o===void 0||o.overrides.push(s))}else if(n instanceof Ko)for(const s of this.overrides)n.name===s.name&&((c=r.info)===null||c===void 0||c.overrides.push(s))});for(const r of this.uniforms)this._markStructsInUse(r.type);for(const r of this.storage)this._markStructsInUse(r.type)}getStructInfo(e){for(const r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(const r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var n;for(const i of e.calls){const o=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;o&&r.add(o)}}findResource(e,r,n){if(n){for(const i of this.entry.compute)if(i.name===n){for(const o of i.resources)if(o.group==e&&o.binding==r)return o}for(const i of this.entry.vertex)if(i.name===n){for(const o of i.resources)if(o.group==e&&o.binding==r)return o}for(const i of this.entry.fragment)if(i.name===n){for(const o of i.resources)if(o.group==e&&o.binding==r)return o}}for(const i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(const i of this.storage)if(i.group==e&&i.binding==r)return i;for(const i of this.textures)if(i.group==e&&i.binding==r)return i;for(const i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(const r of this.uniforms)if(r.name==e)return r;for(const r of this.storage)if(r.name==e)return r;for(const r of this.textures)if(r.name==e)return r;for(const r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){const r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){const n=[],i=this,o=[];return e.search(c=>{if(c instanceof N0)o.push({});else if(c instanceof B0)o.pop();else if(c instanceof Lh){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type),o.length>0&&(o[o.length-1][s.name]=s)}else if(c instanceof Au){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type)}else if(c instanceof Fy){const s=c;r&&s.type!==null&&this._markStructsFromAST(s.type),o.length>0&&(o[o.length-1][s.name]=s)}else if(c instanceof Ko){const s=c;if(o.length>0&&o[o.length-1][s.name])return;const m=i._findResource(s.name);m&&n.push(m)}else if(c instanceof hP){const s=c,m=i._functions.get(s.name);m&&(r&&(m.inUse=!0),e.calls.add(m.node),m.resources===null&&(m.resources=i._findResources(m.node,r)),n.push(...m.resources))}else if(c instanceof cP){const s=c,m=i._functions.get(s.name);m&&(r&&(m.inUse=!0),e.calls.add(m.node),m.resources===null&&(m.resources=i._findResources(m.node,r)),n.push(...m.resources))}}),[...new Map(n.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function r(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)r(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)r(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Nh)this._getStructOutputs(e,r);else{const n=this._getOutputInfo(e);n!==null&&r.push(n)}return r}_getStructOutputs(e,r){for(const n of e.members)if(n.type instanceof Nh)this._getStructOutputs(n.type,r);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const o=this.getTypeInfo(n.type,n.type.attributes),c=this._parseInt(i.value),s=new OC(n.name,o,i.name,c);r.push(s)}}}_getOutputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(r.value);return new OC("",n,r.name,i)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(const n of e)if(n.type instanceof Nh)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}return r}_getStructInputs(e,r){for(const n of e.members)if(n.type instanceof Nh)this._getStructInputs(n.type,r);else{const i=this._getInputInfo(n);i!==null&&r.push(i)}}_getInputInfo(e){const r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(r.value),c=new rq(e.name,i,r.name,o);return n!==null&&(c.interpolation=this._parseString(n.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(const r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new tq(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const r of this.structs)if(r.name==e)return r;for(const r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof zy){const i=e,o=i.format?this.getTypeInfo(i.format,i.attributes):null,c=new pd(i.name,r);return c.format=o,c.count=i.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof Nh){const i=e,o=new cd(i.name,r);o.startLine=i.startLine,o.endLine=i.endLine;for(const c of i.members){const s=this.getTypeInfo(c.type,c.attributes);o.members.push(new IC(c.name,s,c.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Cy){const i=e,o=i.format instanceof jt,c=i.format?o?this.getTypeInfo(i.format,null):new Ul(i.format,null):null,s=new Hp(i.name,c,r,i.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof rt){const i=e,o=i.format?this.getTypeInfo(i.format,null):null,c=new Hp(i.name,o,r,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const n=new Ul(e.name,r);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var r,n,i;const o=this._getTypeSize(e);if(e.size=(r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,e instanceof pd&&e.format){const c=this._getTypeSize(e.format);e.stride=Math.max((n=c==null?void 0:c.size)!==null&&n!==void 0?n:0,(i=c==null?void 0:c.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof cd&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let n=0,i=0,o=0,c=0;for(let s=0,m=e.members.length;s<m;++s){const v=e.members[s],w=this._getTypeSize(v);if(!w)continue;(r=this._getAlias(v.type.name))!==null&&r!==void 0||v.type;const M=w.align,I=w.size;n=this._roundUp(M,n+i),i=I,o=n,c=Math.max(c,M),v.offset=n,v.size=I,this._updateTypeInfo(v.type)}e.size=this._roundUp(c,o+i),e.align=c}_getTypeSize(e){var r,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof IC&&(e=e.type),e instanceof Ul){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=Pu._typeInfo[e.name];if(c!==void 0){const s=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Xb(Math.max(o,c.align/s),Math.max(i,c.size/s))}}{const c=Pu._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const s=e.name[e.name.length-1]==="h"?2:1;return new Xb(Math.max(o,c.align/s),Math.max(i,c.size/s))}}if(e instanceof pd){let c=e,s=8,m=8;const v=this._getTypeSize(c.format);return v!==null&&(m=v.size,s=v.align),m=c.count*this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(s,m)),i&&(m=i),new Xb(Math.max(o,s),Math.max(i,m))}if(e instanceof cd){let c=0,s=0,m=0,v=0,w=0;for(const M of e.members){const I=this._getTypeSize(M.type);I!==null&&(c=Math.max(I.align,c),m=this._roundUp(I.align,m+v),v=I.size,w=m)}return s=this._roundUp(c,w+v),new Xb(Math.max(o,c),Math.max(i,s))}return null}_isUniformVar(e){return e instanceof Lh&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Lh&&e.storage=="storage"}_isTextureVar(e){return e instanceof Lh&&e.type!==null&&Pu._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Lh&&e.type!==null&&Pu._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let o of i)if(o.name==r)return o;return null}_getAttributeNum(e,r,n){if(e===null)return n;for(let i of e)if(i.name==r){let o=i!==null&&i.value!==null?i.value:n;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):n}return n}_roundUp(e,r){return Math.ceil(r/e)*e}}Pu._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Pu._textureTypes=ye.any_texture_type.map(t=>t.name),Pu._samplerTypes=ye.sampler_type.map(t=>t.name);class fP{constructor(e,r,n){this.name=e,this.value=r,this.node=n}clone(){return new fP(this.name,this.value,this.node)}}class dP{constructor(e){this.name=e.name,this.node=e}clone(){return new dP(this.node)}}class pP{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,n){this.variables.set(e,new fP(e,r,n??null))}setVariable(e,r,n){const i=this.getVariable(e);i!==null?i.value=r:this.createVariable(e,r,n)}getVariableValue(e){var r;const n=this.getVariable(e);return(r=n==null?void 0:n.value)!==null&&r!==void 0?r:null}clone(){return new pP(this)}}class Sq{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}}class Aq{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){const n=this.exec.evalExpression(e.args[0],r);let i=!0;if(n instanceof Se)return n.data.forEach(o=>{o||(i=!1)}),new qe(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se){const i=n.data.some(o=>o);return new qe(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){const n=this.exec.evalExpression(e.args[2],r);if(!(n instanceof qe))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.evalExpression(n,r);if(i instanceof Wi&&i.typeInfo.size===0){const o=i.typeInfo,c=i.buffer.byteLength/o.stride;return new qe(c,this.getTypeInfo("u32"))}return new qe(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.abs(o)),n.typeInfo);const i=n;return new qe(Math.abs(i.value),i.typeInfo)}Acos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.acos(o)),n.typeInfo);const i=n;return new qe(Math.acos(i.value),n.typeInfo)}Acosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.acosh(o)),n.typeInfo);const i=n;return new qe(Math.acosh(i.value),n.typeInfo)}Asin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.asin(o)),n.typeInfo);const i=n;return new qe(Math.asin(i.value),n.typeInfo)}Asinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.asinh(o)),n.typeInfo);const i=n;return new qe(Math.asinh(i.value),n.typeInfo)}Atan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.atan(o)),n.typeInfo);const i=n;return new qe(Math.atan(i.value),n.typeInfo)}Atanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.atanh(o)),n.typeInfo);const i=n;return new qe(Math.atanh(i.value),n.typeInfo)}Atan2(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se)return new Se(n.data.map((s,m)=>Math.atan2(s,i.data[m])),n.typeInfo);const o=n,c=i;return new qe(Math.atan2(o.value,c.value),n.typeInfo)}Ceil(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.ceil(o)),n.typeInfo);const i=n;return new qe(Math.ceil(i.value),n.typeInfo)}_clamp(e,r,n){return Math.min(Math.max(e,r),n)}Clamp(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Se&&i instanceof Se&&o instanceof Se)return new Se(n.data.map((v,w)=>this._clamp(v,i.data[w],o.data[w])),n.typeInfo);const c=n,s=i,m=o;return new qe(this._clamp(c.value,s.value,m.value),n.typeInfo)}Cos(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.cos(o)),n.typeInfo);const i=n;return new qe(Math.cos(i.value),n.typeInfo)}Cosh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.cosh(o)),n.typeInfo);const i=n;return new qe(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.clz32(o)),n.typeInfo);const i=n;return new qe(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>this._countOneBits(o)),n.typeInfo);const i=n;return new qe(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>this._countTrailingZeros(o)),n.typeInfo);const i=n;return new qe(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const o=n.data,c=i.data;return new Se([o[1]*c[2]-c[1]*o[2],o[2]*c[0]-c[2]*o[0],o[0]*c[1]-c[0]*o[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){const n=this.exec.evalExpression(e.args[0],r),i=180/Math.PI;return n instanceof Se?new Se(n.data.map(o=>o*i),n.typeInfo):new qe(n.value*i,this.getTypeInfo("f32"))}Determinant(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Rr){const i=n.data,o=n.typeInfo.getTypeName(),c=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new qe(i[0]*i[3]-i[1]*i[2],c);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new qe(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),c);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new qe(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),c);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se){let s=0;for(let m=0;m<n.data.length;++m)s+=(n.data[m]-i.data[m])*(n.data[m]-i.data[m]);return new qe(Math.sqrt(s),this.getTypeInfo("f32"))}const o=n,c=i;return new qe(Math.abs(o.value-c.value),n.typeInfo)}_dot(e,r){let n=0;for(let i=0;i<e.length;++i)n+=r[i]*e[i];return n}Dot(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);return n instanceof Se&&i instanceof Se?new qe(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.exp(o)),n.typeInfo);const i=n;return new qe(Math.exp(i.value),n.typeInfo)}Exp2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.pow(2,o)),n.typeInfo);const i=n;return new qe(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const c=i.value,s=o.value;if(n instanceof Se)return new Se(n.data.map(v=>v>>c&(1<<s)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const m=n.value;return new qe(m>>c&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Se&&i instanceof Se&&o instanceof Se){const c=this._dot(i.data,o.data);return new Se(c<0?Array.from(n.data):n.data.map(s=>-s),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>this._firstLeadingBit(o)),n.typeInfo);const i=n;return new qe(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>this._firstTrailingBit(o)),n.typeInfo);const i=n;return new qe(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.floor(o)),n.typeInfo);const i=n;return new qe(Math.floor(i.value),n.typeInfo)}Fma(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Se&&i instanceof Se&&o instanceof Se)return n.data.length!==i.data.length||n.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Se(n.data.map((v,w)=>v*i.data[w]+o.data[w]),n.typeInfo);const c=n,s=i,m=o;return new qe(c.value*s.value+m.value,c.typeInfo)}Fract(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>o-Math.floor(o)),n.typeInfo);const i=n;return new qe(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r),c=this.exec.evalExpression(e.args[3],r);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const s=o.value,m=(1<<c.value)-1<<s,v=~m;if(n instanceof Se&&i instanceof Se)return new Se(n.data.map((I,k)=>I&v|i.data[k]<<s&m),n.typeInfo);const w=n.value,M=i.value;return new qe(w&v|M<<s&m,n.typeInfo)}InverseSqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>1/Math.sqrt(o)),n.typeInfo);const i=n;return new qe(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se){let o=0;return n.data.forEach(c=>{o+=c*c}),new qe(Math.sqrt(o),this.getTypeInfo("f32"))}const i=n;return new qe(Math.abs(i.value),n.typeInfo)}Log(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.log(o)),n.typeInfo);const i=n;return new qe(Math.log(i.value),n.typeInfo)}Log2(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.log2(o)),n.typeInfo);const i=n;return new qe(Math.log2(i.value),n.typeInfo)}Max(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se)return new Se(n.data.map((s,m)=>Math.max(s,i.data[m])),n.typeInfo);const o=n,c=i;return new qe(Math.max(o.value,c.value),n.typeInfo)}Min(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se)return new Se(n.data.map((s,m)=>Math.min(s,i.data[m])),n.typeInfo);const o=n,c=i;return new qe(Math.min(o.value,c.value),n.typeInfo)}Mix(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Se&&i instanceof Se&&o instanceof Se)return new Se(n.data.map((m,v)=>n.data[v]*(1-o.data[v])+i.data[v]*o.data[v]),n.typeInfo);const c=i,s=o;return new qe(n.value*(1-s.value)+c.value*s.value,n.typeInfo)}Modf(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se)return new Se(n.data.map((c,s)=>c%i.data[s]),n.typeInfo);const o=i;return new qe(n.value%o.value,n.typeInfo)}Normalize(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se){const i=this.Length(e,r).value;return new Se(n.data.map(o=>o/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se)return new Se(n.data.map((s,m)=>Math.pow(s,i.data[m])),n.typeInfo);const o=n,c=i;return new qe(Math.pow(o.value,c.value),n.typeInfo)}QuantizeToF16(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Se?new Se(n.data.map(i=>i),n.typeInfo):new qe(n.value,n.typeInfo)}Radians(e,r){const n=this.exec.evalExpression(e.args[0],r);return n instanceof Se?new Se(n.data.map(i=>i*Math.PI/180),n.typeInfo):new qe(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(n instanceof Se&&i instanceof Se){const o=this._dot(n.data,i.data);return new Se(n.data.map((c,s)=>c-2*o*i.data[s]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n instanceof Se&&i instanceof Se&&o instanceof qe){const c=this._dot(i.data,n.data);return new Se(n.data.map((s,m)=>{const v=1-o.value*o.value*(1-c*c);if(v<0)return 0;const w=Math.sqrt(v);return o.value*s-(o.value*c+w)*i.data[m]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.round(o)),n.typeInfo);const i=n;return new qe(Math.round(i.value),n.typeInfo)}Saturate(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.min(Math.max(o,0),1)),n.typeInfo);const i=n;return new qe(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.sign(o)),n.typeInfo);const i=n;return new qe(Math.sign(i.value),n.typeInfo)}Sin(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.sin(o)),n.typeInfo);const i=n;return new qe(Math.sin(i.value),n.typeInfo)}Sinh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.sinh(o)),n.typeInfo);const i=n;return new qe(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,r,n){const i=Math.min(Math.max((n-e)/(r-e),0),1);return i*i*(3-2*i)}SmoothStep(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(o instanceof Se&&n instanceof Se&&i instanceof Se)return new Se(o.data.map((v,w)=>this._smoothstep(n.data[w],i.data[w],v)),o.typeInfo);const c=n,s=i,m=o;return new qe(this._smoothstep(c.value,s.value,m.value),o.typeInfo)}Sqrt(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.sqrt(o)),n.typeInfo);const i=n;return new qe(Math.sqrt(i.value),n.typeInfo)}Step(e,r){const n=this.exec.evalExpression(e.args[0],r),i=this.exec.evalExpression(e.args[1],r);if(i instanceof Se&&n instanceof Se)return new Se(i.data.map((c,s)=>c<n.data[s]?0:1),i.typeInfo);const o=n;return new qe(i.value<o.value?0:1,o.typeInfo)}Tan(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.tan(o)),n.typeInfo);const i=n;return new qe(Math.tan(i.value),n.typeInfo)}Tanh(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.tanh(o)),n.typeInfo);const i=n;return new qe(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){const n=this.exec.evalExpression(e.args[0],r);if(!(n instanceof Rr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const o=n.data;return new Rr([o[0],o[2],o[1],o[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const o=n.data;return new Rr([o[0],o[3],o[6],o[1],o[4],o[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const o=n.data;return new Rr([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const o=n.data;return new Rr([o[0],o[3],o[1],o[4],o[2],o[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const o=n.data;return new Rr([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const o=n.data;return new Rr([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const o=n.data;return new Rr([o[0],o[4],o[1],o[5],o[2],o[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const o=n.data;return new Rr([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const o=n.data;return new Rr([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,r){const n=this.exec.evalExpression(e.args[0],r);if(n instanceof Se)return new Se(n.data.map(o=>Math.trunc(o)),n.typeInfo);const i=n;return new qe(Math.trunc(i.value),n.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(n instanceof Ko){const o=n.name,c=r.getVariableValue(o);if(c instanceof Bh){if(i<0||i>=c.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const s=c.getMipLevelSize(i),m=c.dimension;return m==="1d"?new qe(s[0],this.getTypeInfo("u32")):m==="3d"?new Se(s,this.getTypeInfo("vec3u")):m==="2d"?new Se(s.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${m} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),o=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(i instanceof Se)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof Ko){const c=n.name,s=r.getVariableValue(c);if(s instanceof Bh){const m=Math.floor(i.data[0]),v=Math.floor(i.data[1]);if(m<0||m>=s.width||v<0||v>=s.height)return console.error(`Texture ${c} out of bounds. Line ${e.line}`),null;const w=s.getPixel(m,v,0,o);return w===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Se(w,this.getTypeInfo("vec4f"))}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){const n=e.args[0];if(n instanceof Ko){const i=n.name,o=r.getVariableValue(i);return o instanceof Bh?new qe(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){const n=e.args[0];if(n instanceof Ko){const i=n.name,o=r.getVariableValue(i);return o instanceof Bh?new qe(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){const n=e.args[0];if(n instanceof Ko){const i=n.name,o=r.getVariableValue(i);return o instanceof Bh?new qe(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){const n=e.args[0],i=this.exec.evalExpression(e.args[1],r),o=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,c=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(c.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Se)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof Ko){const s=n.name,m=r.getVariableValue(s);if(m instanceof Bh){const v=m.getMipLevelSize(0),w=Math.floor(i.data[0]),M=Math.floor(i.data[1]);return w<0||w>=v[0]||M<0||M>=v[1]?(console.error(`Texture ${s} out of bounds. Line ${e.line}`),null):(m.setPixel(w,M,0,o,Array.from(c)),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r);return r.getVariable(i).value.getSubData(this.exec,n.postfix,r)}AtomicStore(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r);return m instanceof qe&&s instanceof qe&&(m.value=s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),null}AtomicAdd(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value+=s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicSub(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value-=s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicMax(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value=Math.max(m.value,s.value)),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicMin(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value=Math.min(m.value,s.value)),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicAnd(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value=m.value&s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicOr(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value=m.value|s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicXor(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value=m.value^s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicExchange(e,r){let n=e.args[0];n instanceof ba&&(n=n.right);const i=this.exec.getVariableName(n,r),o=r.getVariable(i);let c=e.args[1];const s=this.exec.evalExpression(c,r),m=o.value.getSubData(this.exec,n.postfix,r),v=new qe(m.value,m.typeInfo);return m instanceof qe&&s instanceof qe&&(m.value=s.value),o.value instanceof Wi&&o.value.setDataValue(this.exec,m,n.postfix,r),v}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}}const Sw={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Ws={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ms extends Sq{constructor(e,r){var n;super(),this.ast=e??[],this.reflection=new Pu,this.reflection.updateAST(this.ast),this.context=(n=r==null?void 0:r.clone())!==null&&n!==void 0?n:new pP,this.builtins=new Aq(this),this.typeInfo={bool:this.getTypeInfo(jt.bool),i32:this.getTypeInfo(jt.i32),u32:this.getTypeInfo(jt.u32),f32:this.getTypeInfo(jt.f32),f16:this.getTypeInfo(jt.f16),vec2f:this.getTypeInfo(rt.vec2f),vec2u:this.getTypeInfo(rt.vec2u),vec2i:this.getTypeInfo(rt.vec2i),vec2h:this.getTypeInfo(rt.vec2h),vec3f:this.getTypeInfo(rt.vec3f),vec3u:this.getTypeInfo(rt.vec3u),vec3i:this.getTypeInfo(rt.vec3i),vec3h:this.getTypeInfo(rt.vec3h),vec4f:this.getTypeInfo(rt.vec4f),vec4u:this.getTypeInfo(rt.vec4u),vec4i:this.getTypeInfo(rt.vec4i),vec4h:this.getTypeInfo(rt.vec4h),mat2x2f:this.getTypeInfo(rt.mat2x2f),mat2x3f:this.getTypeInfo(rt.mat2x3f),mat2x4f:this.getTypeInfo(rt.mat2x4f),mat3x2f:this.getTypeInfo(rt.mat3x2f),mat3x3f:this.getTypeInfo(rt.mat3x3f),mat3x4f:this.getTypeInfo(rt.mat3x4f),mat4x2f:this.getTypeInfo(rt.mat4x2f),mat4x3f:this.getTypeInfo(rt.mat4x3f),mat4x4f:this.getTypeInfo(rt.mat4x4f)}}getVariableValue(e){var r,n;const i=(n=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof qe)return i.value;if(i instanceof Se||i instanceof Rr)return Array.from(i.data);if(i instanceof Wi&&i.typeInfo instanceof pd){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,n,i){const o=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,o),this._execStatements(this.ast,o);const c=o.getFunction(e);if(!c)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}const s=r[0],m=r[1],v=r[2],w=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new Se(r,w));for(const M in n)for(const I in n[M]){const k=n[M][I];o.variables.forEach(z=>{var V;const U=z.node;if(U!=null&&U.attributes){let K=null,J=null;for(const Z of U.attributes)Z.name==="binding"?K=Z.value:Z.name==="group"&&(J=Z.value);if(I==K&&M==J)if(k.texture!==void 0&&k.descriptor!==void 0){const Z=new Bh(k.texture,this.getTypeInfo(U.type),k.descriptor,(V=k.texture.view)!==null&&V!==void 0?V:null);z.value=Z}else k.uniform!==void 0?z.value=new Wi(k.uniform,this.getTypeInfo(U.type)):z.value=new Wi(k,this.getTypeInfo(U.type))}})}for(let M=0;M<v;++M)for(let I=0;I<m;++I)for(let k=0;k<s;++k)o.setVariable("@workgroup_id",new Se([k,I,M],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(c,[k,I,M],o)}execStatement(e,r){if(e instanceof HL)return this.evalExpression(e.value,r);if(e instanceof ZL){if(e.condition){const n=this.evalExpression(e.condition,r);if(!(n instanceof qe))throw new Error("Invalid break-if condition");if(!n.value)return null}return Ms._breakObj}if(e instanceof XL)return Ms._continueObj;if(e instanceof Fy)this._let(e,r);else if(e instanceof Lh)this._var(e,r);else if(e instanceof _0)this._const(e,r);else if(e instanceof Yy)this._function(e,r);else{if(e instanceof qL)return this._if(e,r);if(e instanceof VL)return this._switch(e,r);if(e instanceof zL)return this._for(e,r);if(e instanceof FL)return this._while(e,r);if(e instanceof $L)return this._loop(e,r);if(e instanceof aE){const n=r.clone();return n.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof UL)this._assign(e,r);else if(e instanceof jL)this._increment(e,r);else{if(e instanceof Nh)return null;if(e instanceof lP){const n=e.name;r.getVariable(n)===null&&r.setVariable(n,new qe(0,this.getTypeInfo("u32")))}else if(e instanceof cP)this._call(e,r);else{if(e instanceof WL||e instanceof uP)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof Bc?this._evalBinaryOp(e,r):e instanceof Oa?this._evalLiteral(e,r):e instanceof Ko?this._evalVariable(e,r):e instanceof hP?this._evalCall(e,r):e instanceof Au?this._evalCreate(e,r):e instanceof GL?this._evalConst(e,r):e instanceof YL?this._evalBitcast(e,r):e instanceof ba?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof jt){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let n=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,r){for(const n in e){const i=e[n],o=this.reflection.getOverrideInfo(n);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?r.setVariable(n,new qe(i,o.type)):o.type.name==="bool"?r.setVariable(n,new qe(i?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?r.setVariable(n,new Se(i,o.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,n){const i=[1,1,1];for(const w of e.node.attributes)if(w.name==="workgroup_size"){if(w.value.length>0){const M=n.getVariableValue(w.value[0]);i[0]=M instanceof qe?M.value:parseInt(w.value[0])}if(w.value.length>1){const M=n.getVariableValue(w.value[1]);i[1]=M instanceof qe?M.value:parseInt(w.value[1])}if(w.value.length>2){const M=n.getVariableValue(w.value[2]);i[2]=M instanceof qe?M.value:parseInt(w.value[2])}}const o=this.getTypeInfo("vec3u"),c=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Se(i,o));const s=i[0],m=i[1],v=i[2];for(let w=0,M=0;w<v;++w)for(let I=0;I<m;++I)for(let k=0;k<s;++k,++M){const z=[k,I,w],V=[k+r[0]*i[0],I+r[1]*i[1],w+r[2]*i[2]];n.setVariable("@local_invocation_id",new Se(z,o)),n.setVariable("@global_invocation_id",new Se(V,o)),n.setVariable("@local_invocation_index",new qe(M,c)),this._dispatchExec(e,n)}}_dispatchExec(e,r){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const o=`@${i.value}`,c=r.getVariable(o);c!==void 0&&r.variables.set(n.name,c)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof ba;)e=e.right;return e instanceof Ko?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(const n of e){if(n instanceof Array){const o=r.clone(),c=this._execStatements(n,o);if(c)return c;continue}const i=this.execStatement(n,r);if(i)return i}return null}_call(e,r){const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(i){for(let o=0;o<i.node.args.length;++o){const c=i.node.args[o],s=this.evalExpression(e.args[o],n);n.setVariable(c.name,s,c)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){const n=this.getVariableName(e.variable,r),i=r.getVariable(n);i?e.operator==="++"?i.value instanceof qe?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof qe?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof Ko){const n=this.getVariableName(e,r),i=r.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,r)}if(e instanceof ba){if(e.operator==="*"){const n=this._getVariableData(e.right,r);return n instanceof fg?n.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,r);return new fg(n)}}return null}_assign(e,r){let n=null,i="<var>",o=null;if(e.variable instanceof ba){const m=this._getVariableData(e.variable,r),v=this.evalExpression(e.value,r),w=e.operator;if(w==="="){if(m instanceof qe||m instanceof Se||m instanceof Rr){if(v instanceof qe||v instanceof Se||v instanceof Rr&&m.data.length===v.data.length)return void m.data.set(v.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(m instanceof Wi&&v instanceof Wi&&m.buffer.byteLength-m.offset>=v.buffer.byteLength-v.offset)return void(m.buffer.byteLength%4==0?new Uint32Array(m.buffer,m.offset,m.typeInfo.size/4).set(new Uint32Array(v.buffer,v.offset,v.typeInfo.size/4)):new Uint8Array(m.buffer,m.offset,m.typeInfo.size).set(new Uint8Array(v.buffer,v.offset,v.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(w==="+=")return m instanceof qe||m instanceof Se||m instanceof Rr?v instanceof qe||v instanceof Se||v instanceof Rr?void m.data.set(v.data.map((M,I)=>m.data[I]+M)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(w==="-=")return(m instanceof qe||m instanceof Se||m instanceof Rr)&&(v instanceof qe||v instanceof Se||v instanceof Rr)?void m.data.set(v.data.map((M,I)=>m.data[I]-M)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ba){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,r);const m=r.getVariable(i);if(!(m&&m.value instanceof fg))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=m.value.reference;let v=e.variable.postfix;if(!v){let w=e.variable.right;for(;w instanceof ba;){if(w.postfix){v=w.postfix;break}w=w.right}}v&&(n=n.getSubData(this,v,r))}}else{o=e.variable.postfix,i=this.getVariableName(e.variable,r);const m=r.getVariable(i);if(m===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=m.value}if(n instanceof fg&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const c=this.evalExpression(e.value,r),s=e.operator;if(s==="=")if(n instanceof Wi)n.setDataValue(this,c,o,r);else if(o){if(!(n instanceof Se||n instanceof Rr))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(o instanceof Bg){const m=this.evalExpression(o.index,r).value;if(n instanceof Se){if(!(c instanceof qe))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[m]=c.value}else{if(!(n instanceof Rr))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const v=this.evalExpression(o.index,r).value;if(v<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(c instanceof Se))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const w=n.typeInfo.getTypeName();if(w==="mat2x2"||w==="mat2x2f"||w==="mat2x2h"){if(!(v<2&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*v]=c.data[0],n.data[2*v+1]=c.data[1]}else if(w==="mat2x3"||w==="mat2x3f"||w==="mat2x3h"){if(!(v<2&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*v]=c.data[0],n.data[3*v+1]=c.data[1],n.data[3*v+2]=c.data[2]}else if(w==="mat2x4"||w==="mat2x4f"||w==="mat2x4h"){if(!(v<2&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*v]=c.data[0],n.data[4*v+1]=c.data[1],n.data[4*v+2]=c.data[2],n.data[4*v+3]=c.data[3]}else if(w==="mat3x2"||w==="mat3x2f"||w==="mat3x2h"){if(!(v<3&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*v]=c.data[0],n.data[2*v+1]=c.data[1]}else if(w==="mat3x3"||w==="mat3x3f"||w==="mat3x3h"){if(!(v<3&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*v]=c.data[0],n.data[3*v+1]=c.data[1],n.data[3*v+2]=c.data[2]}else if(w==="mat3x4"||w==="mat3x4f"||w==="mat3x4h"){if(!(v<3&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*v]=c.data[0],n.data[4*v+1]=c.data[1],n.data[4*v+2]=c.data[2],n.data[4*v+3]=c.data[3]}else if(w==="mat4x2"||w==="mat4x2f"||w==="mat4x2h"){if(!(v<4&&c.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*v]=c.data[0],n.data[2*v+1]=c.data[1]}else if(w==="mat4x3"||w==="mat4x3f"||w==="mat4x3h"){if(!(v<4&&c.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*v]=c.data[0],n.data[3*v+1]=c.data[1],n.data[3*v+2]=c.data[2]}else{if(w!=="mat4x4"&&w!=="mat4x4f"&&w!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(v<4&&c.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*v]=c.data[0],n.data[4*v+1]=c.data[1],n.data[4*v+2]=c.data[2],n.data[4*v+3]=c.data[3]}}}}}else if(o instanceof Wp){const m=o.value;if(!(n instanceof Se))return void console.error(`Invalid assignment to ${m}. Variable ${i} is not a vector. Line ${e.line}`);if(c instanceof qe){if(m.length>1)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);if(m==="x")n.data[0]=c.value;else if(m==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);n.data[1]=c.value}else if(m==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);n.data[2]=c.value}else if(m==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);n.data[3]=c.value}}else{if(!(c instanceof Se))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(m.length!==c.data.length)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);for(let v=0;v<m.length;++v){const w=m[v];if(w==="x"||w==="r")n.data[0]=c.data[v];else if(w==="y"||w==="g"){if(c.data.length<2)return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);n.data[1]=c.data[v]}else if(w==="z"||w==="b"){if(c.data.length<3)return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);n.data[2]=c.data[v]}else{if(w!=="w"&&w!=="a")return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);if(c.data.length<4)return void console.error(`Invalid assignment to ${w} for variable ${i}. Line ${e.line}`);n.data[3]=c.data[v]}}}}}else n instanceof qe&&c instanceof qe?n.value=c.value:n instanceof Se&&c instanceof Se||n instanceof Rr&&c instanceof Rr?n.data.set(c.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const m=n.getSubData(this,o,r);if(m instanceof Se&&c instanceof qe){const v=m.data,w=c.value;if(s==="+=")for(let M=0;M<v.length;++M)v[M]+=w;else if(s==="-=")for(let M=0;M<v.length;++M)v[M]-=w;else if(s==="*=")for(let M=0;M<v.length;++M)v[M]*=w;else if(s==="/=")for(let M=0;M<v.length;++M)v[M]/=w;else if(s==="%=")for(let M=0;M<v.length;++M)v[M]%=w;else if(s==="&=")for(let M=0;M<v.length;++M)v[M]&=w;else if(s==="|=")for(let M=0;M<v.length;++M)v[M]|=w;else if(s==="^=")for(let M=0;M<v.length;++M)v[M]^=w;else if(s==="<<=")for(let M=0;M<v.length;++M)v[M]<<=w;else if(s===">>=")for(let M=0;M<v.length;++M)v[M]>>=w;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(m instanceof Se&&c instanceof Se){const v=m.data,w=c.data;if(v.length!==w.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(s==="+=")for(let M=0;M<v.length;++M)v[M]+=w[M];else if(s==="-=")for(let M=0;M<v.length;++M)v[M]-=w[M];else if(s==="*=")for(let M=0;M<v.length;++M)v[M]*=w[M];else if(s==="/=")for(let M=0;M<v.length;++M)v[M]/=w[M];else if(s==="%=")for(let M=0;M<v.length;++M)v[M]%=w[M];else if(s==="&=")for(let M=0;M<v.length;++M)v[M]&=w[M];else if(s==="|=")for(let M=0;M<v.length;++M)v[M]|=w[M];else if(s==="^=")for(let M=0;M<v.length;++M)v[M]^=w[M];else if(s==="<<=")for(let M=0;M<v.length;++M)v[M]<<=w[M];else if(s===">>=")for(let M=0;M<v.length;++M)v[M]>>=w[M];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(m instanceof qe&&c instanceof qe))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);s==="+="?m.value+=c.value:s==="-="?m.value-=c.value:s==="*="?m.value*=c.value:s==="/="?m.value/=c.value:s==="%="?m.value%=c.value:s==="&="?m.value&=c.value:s==="|="?m.value|=c.value:s==="^="?m.value^=c.value:s==="<<="?m.value<<=c.value:s===">>="?m.value>>=c.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}n instanceof Wi&&n.setDataValue(this,m,o,r)}}_function(e,r){const n=new dP(e);r.functions.set(e.name,n)}_const(e,r){let n=null;e.value!==null&&(n=this.evalExpression(e.value,r)),r.createVariable(e.name,n,e)}_let(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ba||(n=n.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const o=new Au(e.type,[]);n=this._evalCreate(o,r)}}r.createVariable(e.name,n,e)}_var(e,r){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,r),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ba||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof zy||e.type instanceof Nh||e.type instanceof rt){const o=new Au(e.type,[]);n=this._evalCreate(o,r)}}r.createVariable(e.name,n,e)}_switch(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof qe))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const o of e.cases)if(o instanceof JL)for(const c of o.selectors){if(c instanceof y0){i=o;continue}const s=this.evalExpression(c,r);if(!(s instanceof qe))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===n.value)return this._execStatements(o.body,r)}else o instanceof eF&&(i=o);return i?this._execStatements(i.body,r):null}_if(e,r){r=r.clone();const n=this.evalExpression(e.condition,r);if(!(n instanceof qe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,r);for(const i of e.elseif){const o=this.evalExpression(i.condition,r);if(!(o instanceof qe))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(i.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof qe?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Ms._breakObj)break;if(n!==null&&n!==Ms._continueObj)return n;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){const n=this._execStatements(e.body,r);if(n===Ms._breakObj)break;if(n===Ms._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===Ms._breakObj)break}else if(n!==null)return n}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){const n=this._execStatements(e.body,r);if(n===Ms._breakObj)break;if(n!==Ms._continueObj&&n!==null)return n}return null}_evalBitcast(e,r){const n=this.evalExpression(e.value,r),i=e.type;if(n instanceof qe){const o=FC(n.value,n.typeInfo.name,i.name);return new qe(o,this.getTypeInfo(i))}if(n instanceof Se){const o=n.typeInfo.getTypeName();let c="";if(o.endsWith("f"))c="f32";else if(o.endsWith("i"))c="i32";else if(o.endsWith("u"))c="u32";else if(o.endsWith("b"))c="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;c="f16"}const s=i.getTypeName();let m="";if(s.endsWith("f"))m="f32";else if(s.endsWith("i"))m="i32";else if(s.endsWith("u"))m="u32";else if(s.endsWith("b"))m="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${m}. Line ${e.line}`),null;m="f16"}const v=function(w,M,I){if(M===I)return w;const k=new Array(w.length);for(let z=0;z<w.length;z++)k[z]=FC(w[z],M,I);return k}(Array.from(n.data),c,m);return new Se(v,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var n;if(e instanceof Au){if(e.type===null)return sE.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}const i=e instanceof Au?e.type.name:e.name,o=e instanceof Au?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(o.size===0)return null;const c=new Wi(new ArrayBuffer(o.size),o,0);if(o instanceof cd){if(e.args)for(let s=0;s<e.args.length;++s){const m=o.members[s],v=e.args[s],w=this.evalExpression(v,r);c.setData(this,w,m.type,m.offset,r)}}else if(o instanceof pd){let s=0;if(e.args)for(let m=0;m<e.args.length;++m){const v=e.args[m],w=this.evalExpression(v,r);o.format===null&&(((n=w.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=w.typeInfo),c.setData(this,w,o.format,s,r),s+=o.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Au?c.getSubData(this,e.postfix,r):c}_evalLiteral(e,r){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new qe(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,r):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){const n=r.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let n=1;n<e.length;++n){const i=Ms._priority.get(r.name);Ms._priority.get(e[n].name)<i&&(r=e[n])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){const n=this.evalExpression(e.right,r);if(e.operator==="&")return new fg(n);if(e.operator==="*")return n instanceof fg?n.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof qe?n.value:n instanceof Se?Array.from(n.data):null;switch(e.operator){case"+":{if(sr(i)){const s=i.map((m,v)=>+m);return new Se(s,n.typeInfo)}const o=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new qe(+o,c)}case"-":{if(sr(i)){const s=i.map((m,v)=>-m);return new Se(s,n.typeInfo)}const o=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new qe(-o,c)}case"!":{if(sr(i)){const s=i.map((m,v)=>m?0:1);return new Se(s,n.typeInfo)}const o=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new qe(o?0:1,c)}case"~":{if(sr(i)){const s=i.map((m,v)=>~m);return new Se(s,n.typeInfo)}const o=i,c=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new qe(~o,c)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){const n=this.evalExpression(e.left,r),i=this.evalExpression(e.right,r),o=n instanceof qe?n.value:n instanceof Se||n instanceof Rr?Array.from(n.data):null,c=i instanceof qe?i.value:i instanceof Se||i instanceof Rr?Array.from(i.data):null;switch(e.operator){case"+":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k+M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I+w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w+I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s+m,v)}case"-":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k-M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I-w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w-I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s-m,v)}case"*":{if(sr(o)&&sr(c)){const w=o,M=c;if(n instanceof Rr&&i instanceof Rr){const I=function(U,K,J,Z){if(Ws[K.name]===void 0||Ws[Z.name]===void 0)return null;const re=Ws[K.name][0],W=Ws[K.name][1],Y=Ws[Z.name][0];if(re!==Ws[Z.name][1])return null;const ue=new Array(Y*W);for(let be=0;be<W;be++)for(let Ce=0;Ce<Y;Ce++){let Ye=0;for(let Me=0;Me<re;Me++)Ye+=U[Me*W+be]*J[Ce*re+Me];ue[be*Y+Ce]=Ye}return ue}(w,n.typeInfo,M,i.typeInfo);if(I===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const k=Ws[i.typeInfo.name][0],z=Ws[n.typeInfo.name][1],V=this.getTypeInfo(`mat${k}x${z}f`);return new Rr(I,V)}if(n instanceof Rr&&i instanceof Se){const I=function(k,z,V,U){if(Ws[z.name]===void 0||Sw[U.name]===void 0)return null;const K=Ws[z.name][0],J=Ws[z.name][1];if(K!==V.length)return null;const Z=new Array(J);for(let re=0;re<J;re++){let W=0;for(let Y=0;Y<K;Y++)W+=k[Y*J+re]*V[Y];Z[re]=W}return Z}(w,n.typeInfo,M,i.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Se(I,i.typeInfo)}if(n instanceof Se&&i instanceof Rr){const I=function(k,z,V,U){if(Sw[z.name]===void 0||Ws[U.name]===void 0)return null;const K=Ws[U.name][0],J=Ws[U.name][1];if(J!==k.length)return null;const Z=[];for(let re=0;re<K;re++){let W=0;for(let Y=0;Y<J;Y++)W+=k[Y]*V[Y*K+re];Z[re]=W}return Z}(w,n.typeInfo,M,i.typeInfo);return I===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Se(I,n.typeInfo)}{if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k*M[z]);return new Se(I,n.typeInfo)}}if(sr(o)){const w=c,M=o.map((I,k)=>I*w);return n instanceof Rr?new Rr(M,n.typeInfo):new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w*I);return i instanceof Rr?new Rr(M,i.typeInfo):new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s*m,v)}case"%":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k%M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I%w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w%I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s%m,v)}case"/":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k/M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I/w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w/I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s/m,v)}case"&":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k&M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I&w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w&I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s&m,v)}case"|":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k|M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I|w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w|I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s|m,v)}case"^":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k^M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I^w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w^I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s^m,v)}case"<<":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k<<M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I<<w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w<<I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s<<m,v)}case">>":{if(sr(o)&&sr(c)){const w=o,M=c;if(w.length!==M.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const I=w.map((k,z)=>k>>M[z]);return new Se(I,n.typeInfo)}if(sr(o)){const w=c,M=o.map((I,k)=>I>>w);return new Se(M,n.typeInfo)}if(sr(c)){const w=o,M=c.map((I,k)=>w>>I);return new Se(M,i.typeInfo)}const s=o,m=c,v=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new qe(s>>m,v)}case">":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w>m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v>s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s>v?1:0);return new Se(m,i.typeInfo)}return new qe(o>c?1:0,this.getTypeInfo("bool"));case"<":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w<m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v<s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s<v?1:0);return new Se(m,i.typeInfo)}return new qe(o<c?1:0,this.getTypeInfo("bool"));case"==":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w===m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v==s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s==v?1:0);return new Se(m,i.typeInfo)}return new qe(o===c?1:0,this.getTypeInfo("bool"));case"!=":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w!==m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v!==s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s!==v?1:0);return new Se(m,i.typeInfo)}return new qe(o!==c?1:0,this.getTypeInfo("bool"));case">=":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w>=m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v>=s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s>=v?1:0);return new Se(m,i.typeInfo)}return new qe(o>=c?1:0,this.getTypeInfo("bool"));case"<=":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w<=m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v<=s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s<=v?1:0);return new Se(m,i.typeInfo)}return new qe(o<=c?1:0,this.getTypeInfo("bool"));case"&&":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w&&m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v&&s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s&&v?1:0);return new Se(m,i.typeInfo)}return new qe(o&&c?1:0,this.getTypeInfo("bool"));case"||":if(sr(o)&&sr(c)){const s=o,m=c;if(s.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=s.map((w,M)=>w||m[M]?1:0);return new Se(v,n.typeInfo)}if(sr(o)){const s=c,m=o.map((v,w)=>v||s?1:0);return new Se(m,n.typeInfo)}if(sr(c)){const s=o,m=c.map((v,w)=>s||v?1:0);return new Se(m,i.typeInfo)}return new qe(o||c?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=r.clone();n.currentFunctionName=e.name;const i=r.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<i.node.args.length;++o){const c=i.node.args[o],s=this.evalExpression(e.args[o],n);n.createVariable(c.name,s,c)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothStep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}const n=r.getFunction(e.name);if(n){const i=r.clone();for(let o=0;o<n.node.args.length;++o){const c=n.node.args[o],s=this.evalExpression(e.args[o],i);i.setVariable(c.name,s,c)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new qe(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],r);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),o=Sw[i];if(o===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const c=[];if(e instanceof Oa)if(e.isVector){const s=e.vectorValue;for(const m of s)c.push(m)}else c.push(e.scalarValue);else if(e.args)for(const s of e.args){const m=this.evalExpression(s,r);if(m instanceof Se){const v=m.data;for(let w=0;w<v.length;++w){let M=v[w];c.push(M)}}else if(m instanceof qe){let v=m.value;c.push(v)}}if(e.type instanceof rt&&e.type.format===null&&(e.type.format=rt.f32),c.length===0){const s=new Array(o).fill(0);return new Se(s,n).getSubData(this,e.postfix,r)}if(c.length===1)for(;c.length<o;)c.push(c[0]);return c.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Se(c.length>o?c.slice(0,o):c,n).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),o=Ws[i];if(o===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const c=[];if(e instanceof Oa)if(e.isVector){const s=e.vectorValue;for(const m of s)c.push(m)}else c.push(e.scalarValue);else if(e.args)for(const s of e.args){const m=this.evalExpression(s,r);m instanceof Se?c.push(...m.data):m instanceof qe?c.push(m.value):m instanceof Rr&&c.push(...m.data)}if(n instanceof Hp&&n.format===null&&(n.format=this.getTypeInfo("f32")),c.length===0){const s=new Array(o[2]).fill(0);return new Rr(s,n).getSubData(this,e.postfix,r)}return c.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Rr(c,n).getSubData(this,e.postfix,r)}}Ms._breakObj=new Wl(new Ul("BREAK",null),null),Ms._continueObj=new Wl(new Ul("CONTINUE",null),null),Ms._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Eq{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class Mq{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Eq,this._exec=new Ms,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const r=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,o=n.countNode;if(o instanceof Ko){const c=o.name,s=this._context.constants.get(c);if(s)try{const m=s.constEvaluate(this._exec);i.count=m}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of r)n.search(i=>{i instanceof BC||i instanceof Tw?i.type=this._forwardType(i.type):i instanceof zy?i.format=this._forwardType(i.format):i instanceof Lh||i instanceof Fy||i instanceof _0?i.type=this._forwardType(i.type):i instanceof Yy?i.returnType=this._forwardType(i.returnType):i instanceof NC&&(i.type=this._forwardType(i.type))});return r}_forwardType(e){if(e instanceof DC){const r=this._getType(e.name);if(r)return r}else e instanceof Tw?e.type=this._forwardType(e.type):e instanceof zy&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const r=new gq(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ye.eof}_match(e){if(e instanceof Xe)return!!this._check(e)&&(this._advance(),!0);for(let r=0,n=e.length;r<n;++r){const i=e[r];if(this._check(i))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const r=this._peek();if(e instanceof Array){const n=r.type;let i=!1;for(const o of e){if(n===o)return!0;o===ye.tokens.name&&(i=!0)}if(i){const o=ye.tokens.name.rule.exec(r.lexeme);if(o&&o.index==0&&o[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===ye.tokens.name){const n=ye.tokens.name.rule.exec(r.lexeme);return n&&n.index==0&&n[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ye.keywords.alias)){const r=this._type_alias();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ye.keywords.diagnostic)){const r=this._diagnostic();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ye.keywords.requires)){const r=this._requires_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(ye.keywords.enable)){const r=this._enable_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}const e=this._attribute();if(this._check(ye.keywords.var)){const r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ye.keywords.override)){const r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ye.keywords.let)){const r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ye.keywords.const)){const r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(ye.keywords.struct)){const r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(ye.keywords.fn)){const r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(ye.keywords.fn))return null;const e=this._currentLine,r=this._consume(ye.tokens.ident,"Expected function name.").toString();this._consume(ye.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(ye.tokens.paren_right))do{if(this._check(ye.tokens.paren_right))break;const s=this._attribute(),m=this._consume(ye.tokens.name,"Expected argument name.").toString();this._consume(ye.tokens.colon,"Expected ':' for argument type.");const v=this._attribute(),w=this._type_decl();w!=null&&(w.attributes=v,n.push(this._updateNode(new NC(m,w,s))))}while(this._match(ye.tokens.comma));this._consume(ye.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(ye.tokens.arrow)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}const o=this._compound_statement(),c=this._currentLine;return this._updateNode(new Yy(r,n,i,o,e,c),e)}_compound_statement(){const e=[];for(this._consume(ye.tokens.brace_left,"Expected '{' for block.");!this._check(ye.tokens.brace_right);){const r=this._statement();r!==null&&e.push(r)}return this._consume(ye.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ye.tokens.attr)&&this._attribute(),this._check(ye.keywords.if))return this._if_statement();if(this._check(ye.keywords.switch))return this._switch_statement();if(this._check(ye.keywords.loop))return this._loop_statement();if(this._check(ye.keywords.for))return this._for_statement();if(this._check(ye.keywords.while))return this._while_statement();if(this._check(ye.keywords.continuing))return this._continuing_statement();if(this._check(ye.keywords.static_assert))return this._static_assert_statement();if(this._check(ye.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(ye.keywords.return))e=this._return_statement();else if(this._check([ye.keywords.var,ye.keywords.let,ye.keywords.const]))e=this._variable_statement();else if(this._match(ye.keywords.discard))e=this._updateNode(new dq);else if(this._match(ye.keywords.break)){const r=this._updateNode(new ZL);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r,this._check(ye.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(ye.keywords.continue)){const r=this._updateNode(new XL);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{const n=this._currentLoop[this._currentLoop.length-1];r.loopId=n.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(ye.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ye.keywords.static_assert))return null;const e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new uq(r),e)}_while_statement(){if(!this._match(ye.keywords.while))return null;const e=this._updateNode(new FL(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ye.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(ye.keywords.continuing))return null;const r=this._currentLine,n=this._compound_statement();return this._updateNode(new aE(n,e),r)}_for_statement(){if(!this._match(ye.keywords.for))return null;this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._updateNode(new zL(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(ye.tokens.semicolon)?null:this._for_init(),this._consume(ye.tokens.semicolon,"Expected ';'."),e.condition=this._check(ye.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(ye.tokens.semicolon,"Expected ';'."),e.increment=this._check(ye.tokens.paren_right)?null:this._for_increment(),this._consume(ye.tokens.paren_right,"Expected ')'."),this._check(ye.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ye.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(ye.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new Lh(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(ye.keywords.let)){const e=this._currentLine,r=this._consume(ye.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(ye.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(ye.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new Fy(r,n,null,null,i),e)}if(this._match(ye.keywords.const)){const e=this._currentLine,r=this._consume(ye.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(ye.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}this._consume(ye.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return n===null&&i instanceof Oa&&(n=i.type),this._updateNode(new _0(r,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(ye.increment_operators))return this._current=e,null;const n=this._consume(ye.increment_operators,"Expected increment operator");return this._updateNode(new jL(n.type===ye.tokens.plus_plus?bg.increment:bg.decrement,r))}_assignment_statement(){let e=null;const r=this._currentLine;if(this._check(ye.tokens.brace_right))return null;let n=this._match(ye.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(ye.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new UL(Py.parse(i.lexeme),e,o),r)}_func_call_statement(){if(!this._check(ye.tokens.ident))return null;const e=this._currentLine,r=this._current,n=this._consume(ye.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=r,null):this._updateNode(new cP(n.lexeme,i),e)}_loop_statement(){if(!this._match(ye.keywords.loop))return null;this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new $L([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.body.push(n);else e.body.push(r);if(r instanceof aE){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(ye.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(ye.keywords.switch))return null;const e=this._updateNode(new VL(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ye.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let r=!1;for(;this._check([ye.keywords.default,ye.keywords.case]);){if(this._match(ye.keywords.case)){const n=this._case_selectors();for(const o of n)if(o instanceof y0){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(ye.tokens.colon),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new JL(n,i)))}if(this._match(ye.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(ye.tokens.colon),this._check(ye.tokens.attr)&&this._attribute(),this._consume(ye.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new eF(n)))}}return e}_case_selectors(){const e=[];for(this._match(ye.keywords.default)?e.push(this._updateNode(new y0)):e.push(this._shift_expression());this._match(ye.tokens.comma);)this._match(ye.keywords.default)?e.push(this._updateNode(new y0)):e.push(this._shift_expression());return e}_case_body(){if(this._match(ye.keywords.fallthrough))return this._consume(ye.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(ye.keywords.if))return null;const e=this._currentLine,r=this._optional_paren_expression();this._check(ye.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(ye.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let o=null;return this._match(ye.keywords.else)&&(this._check(ye.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new qL(r,n,i,o),e)}_match_elseif(){return this._tokens[this._current].type===ye.keywords.else&&this._tokens[this._current+1].type===ye.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const r=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new pq(r,n))),this._match_elseif()&&(this._check(ye.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(ye.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new HL(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ye.tokens.or_or);)e=this._updateNode(new Bc(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ye.tokens.and_and);)e=this._updateNode(new Bc(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ye.tokens.or);)e=this._updateNode(new Bc(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ye.tokens.xor);)e=this._updateNode(new Bc(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(ye.tokens.and);)e=this._updateNode(new Bc(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([ye.tokens.equal_equal,ye.tokens.not_equal])?this._updateNode(new Bc(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ye.tokens.less_than,ye.tokens.greater_than,ye.tokens.less_than_equal,ye.tokens.greater_than_equal]);)e=this._updateNode(new Bc(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ye.tokens.shift_left,ye.tokens.shift_right]);)e=this._updateNode(new Bc(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ye.tokens.plus,ye.tokens.minus]);)e=this._updateNode(new Bc(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ye.tokens.star,ye.tokens.forward_slash,ye.tokens.modulo]);)e=this._updateNode(new Bc(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([ye.tokens.minus,ye.tokens.bang,ye.tokens.tilde,ye.tokens.star,ye.tokens.and])?this._updateNode(new ba(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(ye.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ye.tokens.bracket_right,"Expected ']'.");const r=this._updateNode(new Bg(e)),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(ye.tokens.period)){const e=this._consume(ye.tokens.name,"Expected member name."),r=this._postfix_expression(),n=this._updateNode(new Wp(e.lexeme));return r&&(n.postfix=r),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return jt.void;case"bool":return jt.bool;case"i32":return jt.i32;case"u32":return jt.u32;case"f32":return jt.f32;case"f16":return jt.f16;case"vec2f":return rt.vec2f;case"vec3f":return rt.vec3f;case"vec4f":return rt.vec4f;case"vec2i":return rt.vec2i;case"vec3i":return rt.vec3i;case"vec4i":return rt.vec4i;case"vec2u":return rt.vec2u;case"vec3u":return rt.vec3u;case"vec4u":return rt.vec4u;case"vec2h":return rt.vec2h;case"vec3h":return rt.vec3h;case"vec4h":return rt.vec4h;case"mat2x2f":return rt.mat2x2f;case"mat2x3f":return rt.mat2x3f;case"mat2x4f":return rt.mat2x4f;case"mat3x2f":return rt.mat3x2f;case"mat3x3f":return rt.mat3x3f;case"mat3x4f":return rt.mat3x4f;case"mat4x2f":return rt.mat4x2f;case"mat4x3f":return rt.mat4x3f;case"mat4x4f":return rt.mat4x4f;case"mat2x2h":return rt.mat2x2h;case"mat2x3h":return rt.mat2x3h;case"mat2x4h":return rt.mat2x4h;case"mat3x2h":return rt.mat3x2h;case"mat3x3h":return rt.mat3x3h;case"mat3x4h":return rt.mat3x4h;case"mat4x2h":return rt.mat4x2h;case"mat4x3h":return rt.mat4x3h;case"mat4x4h":return rt.mat4x4h;case"mat2x2i":return rt.mat2x2i;case"mat2x3i":return rt.mat2x3i;case"mat2x4i":return rt.mat2x4i;case"mat3x2i":return rt.mat3x2i;case"mat3x3i":return rt.mat3x3i;case"mat3x4i":return rt.mat3x4i;case"mat4x2i":return rt.mat4x2i;case"mat4x3i":return rt.mat4x3i;case"mat4x4i":return rt.mat4x4i;case"mat2x2u":return rt.mat2x2u;case"mat2x3u":return rt.mat2x3u;case"mat2x4u":return rt.mat2x4u;case"mat3x2u":return rt.mat3x2u;case"mat3x3u":return rt.mat3x3u;case"mat3x4u":return rt.mat3x4u;case"mat4x2u":return rt.mat4x2u;case"mat4x3u":return rt.mat4x3u;case"mat4x4u":return rt.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(ye.tokens.ident)){const n=this._previous().toString();if(this._check(ye.tokens.paren_left)){const i=this._argument_expression_list(),o=this._getType(n);return o!==null?this._updateNode(new Au(o,i)):this._updateNode(new hP(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new GL(n,i.value))}return this._updateNode(new Ko(n))}if(this._match(ye.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?jt.i32:n.endsWith("u")||n.endsWith("U")?jt.u32:jt.x32;const o=parseInt(n);return this._validateTypeRange(o,i),this._updateNode(new Oa(new qe(o,this._exec.getTypeInfo(i)),i))}if(this._match(ye.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,jt.u32),this._updateNode(new Oa(new qe(n,this._exec.getTypeInfo(jt.u32)),jt.u32))}if(this._match([ye.tokens.decimal_float_literal,ye.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const o=parseFloat(n);this._validateTypeRange(o,i?jt.f16:jt.f32);const c=i?jt.f16:jt.f32;return this._updateNode(new Oa(new qe(o,this._exec.getTypeInfo(c)),c))}if(this._match([ye.keywords.true,ye.keywords.false])){let n=this._previous().toString()===ye.keywords.true.rule;return this._updateNode(new Oa(new qe(n?1:0,this._exec.getTypeInfo(jt.bool)),jt.bool))}if(this._check(ye.tokens.paren_left))return this._paren_expression();if(this._match(ye.keywords.bitcast)){this._consume(ye.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(ye.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new YL(n,i))}const e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new Au(e,r))}_argument_expression_list(){if(!this._match(ye.tokens.paren_left))return null;const e=[];do{if(this._check(ye.tokens.paren_right))break;const r=this._short_circuit_or_expression();e.push(r)}while(this._match(ye.tokens.comma));return this._consume(ye.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ye.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ye.tokens.paren_right),e}_paren_expression(){this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ye.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(ye.keywords.struct))return null;const e=this._currentLine,r=this._consume(ye.tokens.ident,"Expected name for struct.").toString();this._consume(ye.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(ye.tokens.brace_right);){const c=this._attribute(),s=this._consume(ye.tokens.name,"Expected variable name.").toString();this._consume(ye.tokens.colon,"Expected ':' for struct member type.");const m=this._attribute(),v=this._type_decl();v!=null&&(v.attributes=m),this._check(ye.tokens.brace_right)?this._match(ye.tokens.comma):this._consume(ye.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new BC(s,v,c)))}this._consume(ye.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,o=this._updateNode(new Nh(r,n,e,i),e);return this._context.structs.set(r,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(ye.tokens.equal)){const r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof Oa){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Oa&&(e.type=e.value.type.name==="x32"?jt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ye.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(ye.keywords.const))return null;const r=this._consume(ye.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(ye.tokens.colon)){const m=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=m)}let o=null;this._consume(ye.tokens.equal,"const declarations require an assignment");const c=this._short_circuit_or_expression();try{let m=[jt.f32],v=c.constEvaluate(this._exec,m);v instanceof qe&&this._validateTypeRange(v.value,m[0]),m[0]instanceof rt&&m[0].format===null&&v.typeInfo instanceof Hp&&v.typeInfo.format!==null&&(v.typeInfo.format.name==="f16"?m[0].format=jt.f16:v.typeInfo.format.name==="f32"?m[0].format=jt.f32:v.typeInfo.format.name==="i32"?m[0].format=jt.i32:v.typeInfo.format.name==="u32"?m[0].format=jt.u32:v.typeInfo.format.name==="bool"?m[0].format=jt.bool:console.error(`TODO: impelement template format type ${v.typeInfo.format.name}`)),o=this._updateNode(new Oa(v,m[0])),this._exec.context.setVariable(r.toString(),v)}catch{o=c}if(i!==null&&o instanceof Oa){if(o.type.name!=="x32"&&i.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${i.name}. Line:${this._currentLine}`);o.type=i,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else i===null&&o instanceof Oa&&(i=(e=o==null?void 0:o.type)!==null&&e!==void 0?e:jt.f32,i===jt.x32&&(i=jt.i32));const s=this._updateNode(new _0(r.toString(),i,"","",o),n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(ye.keywords.let))return null;const e=this._currentLine,r=this._consume(ye.tokens.name,"Expected variable name");let n=null;if(this._match(ye.tokens.colon)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}let i=null;if(this._match(ye.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof Oa){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof Oa&&(n=i.type.name==="x32"?jt.i32:i.type);return i instanceof Oa&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new Fy(r.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(ye.keywords.var))return null;const e=this._currentLine;let r="",n="";this._match(ye.tokens.less_than)&&(r=this._consume(ye.storage_class,"Expected storage_class.").toString(),this._match(ye.tokens.comma)&&(n=this._consume(ye.access_mode,"Expected access_mode.").toString()),this._consume(ye.tokens.greater_than,"Expected '>'."));const i=this._consume(ye.tokens.name,"Expected variable name");let o=null;if(this._match(ye.tokens.colon)){const c=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=c)}return this._updateNode(new Lh(i.toString(),o,r,n,null),e)}_override_decl(){if(!this._match(ye.keywords.override))return null;const e=this._consume(ye.tokens.name,"Expected variable name");let r=null;if(this._match(ye.tokens.colon)){const n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return this._updateNode(new lP(e.toString(),r,null))}_diagnostic(){this._consume(ye.tokens.paren_left,"Expected '('");const e=this._consume(ye.tokens.ident,"Expected severity control name.");this._consume(ye.tokens.comma,"Expected ','");let r=this._consume(ye.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(ye.tokens.period)&&(r+=`.${this._consume(ye.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(ye.tokens.paren_right,"Expected ')'"),this._updateNode(new WL(e.toString(),r))}_enable_directive(){const e=this._consume(ye.tokens.ident,"identity expected.");return this._updateNode(new hq(e.toString()))}_requires_directive(){const e=[this._consume(ye.tokens.ident,"identity expected.").toString()];for(;this._match(ye.tokens.comma);){const r=this._consume(ye.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new fq(e))}_type_alias(){const e=this._consume(ye.tokens.ident,"identity expected.");this._consume(ye.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);const n=this._updateNode(new uP(e.toString(),r));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ye.tokens.ident,...ye.texel_format,ye.keywords.bool,ye.keywords.f32,ye.keywords.i32,ye.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const i=this._updateNode(new DC(n));return this._forwardTypeCount++,i}return this._updateNode(new jt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(ye.template_types)){let n=this._advance().toString(),i=null,o=null;return this._match(ye.tokens.less_than)&&(i=this._type_decl(),o=null,this._match(ye.tokens.comma)&&(o=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new rt(n,i,o))}if(this._match(ye.keywords.ptr)){let n=this._previous().toString();this._consume(ye.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(ye.storage_class,"Expected storage_class for pointer");this._consume(ye.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let c=null;return this._match(ye.tokens.comma)&&(c=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Tw(n,i.toString(),o,c))}const r=this._attribute();if(this._match(ye.keywords.array)){let n=null,i=-1;const o=this._previous();let c=null;if(this._match(ye.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let m="";if(this._match(ye.tokens.comma)){c=this._shift_expression();try{m=c.constEvaluate(this._exec).toString(),c=null}catch{m="1"}}this._consume(ye.tokens.greater_than,"Expected '>' for array."),i=m?parseInt(m):0}const s=this._updateNode(new zy(o.toString(),r,n,i));return c&&this._deferArrayCountEval.push({arrayType:s,countNode:c}),s}return null}_texture_sampler_types(){if(this._match(ye.sampler_type))return this._updateNode(new Cy(this._previous().toString(),null,null));if(this._match(ye.depth_texture_type))return this._updateNode(new Cy(this._previous().toString(),null,null));if(this._match(ye.sampled_texture_type)||this._match(ye.multisampled_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const r=this._type_decl();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Cy(e.toString(),r,null))}if(this._match(ye.storage_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const r=this._consume(ye.texel_format,"Invalid texel format.").toString();this._consume(ye.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ye.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Cy(e.toString(),r,n))}return null}_attribute(){let e=[];for(;this._match(ye.tokens.attr);){const r=this._consume(ye.attribute_name,"Expected attribute name"),n=this._updateNode(new tF(r.toString(),null));if(this._match(ye.tokens.paren_left)){if(n.value=this._consume(ye.literal_or_ident,"Expected attribute value").toString(),this._check(ye.tokens.comma)){this._advance();do{const i=this._consume(ye.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(ye.tokens.comma))}this._consume(ye.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class Pq extends Pu{constructor(e){super(),e&&this.update(e)}update(e){const r=new Mq().parse(e);this.updateAST(r)}}function Cq(t){var o;const e={attributes:[],bindings:[]};let r;try{r=Rq(t)}catch(c){return Qt.error(c.message)(),e}for(const c of r.uniforms){const s=[];for(const m of((o=c.type)==null?void 0:o.members)||[])s.push({name:m.name,type:zC(m.type)});e.bindings.push({type:"uniform",name:c.name,group:c.group,location:c.binding,members:s})}for(const c of r.textures)e.bindings.push({type:"texture",name:c.name,group:c.group,location:c.binding});for(const c of r.samplers)e.bindings.push({type:"sampler",name:c.name,group:c.group,location:c.binding});const n=r.entry.vertex[0],i=(n==null?void 0:n.inputs.length)||0;for(let c=0;c<i;c++){const s=n.inputs[c];if(s.locationType==="location"){const m=zC(s.type);e.attributes.push({name:s.name,location:Number(s.location),type:m})}}return e}function zC(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function Rq(t){try{return new Pq(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(r+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(r+=e.token.line||""),new Error(r,{cause:e})}}const Iq={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Iq}};const $l=globalThis.mathgl.config;function Oq(t,{precision:e=$l.precision}={}){return t=kq(t),`${parseFloat(t.toPrecision(e))}`}function Lg(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ud(t,e,r){return Nq(t,n=>Math.max(e,Math.min(r,n)))}function j0(t,e,r){return Lg(t)?t.map((n,i)=>j0(n,e[i],r)):r*e+(1-r)*t}function Ky(t,e,r){const n=$l.EPSILON;try{if(t===e)return!0;if(Lg(t)&&Lg(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Ky(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=$l.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{$l.EPSILON=n}}function kq(t){return Math.round(t/$l.EPSILON)*$l.EPSILON}function Dq(t){return t.clone?t.clone():new Array(t.length)}function Nq(t,e,r){if(Lg(t)){const n=t;r=r||Dq(n);for(let i=0;i<r.length&&i<n.length;++i){const o=typeof t=="number"?t:t[i];r[i]=e(o,i,r)}return r}return e(t)}class rF extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+r];return this.check()}toArray(e=[],r=0){for(let n=0;n<this.ELEMENTS;++n)e[r+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Lg(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString($l)}formatString(e){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+Oq(this[n],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Ky(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,n){if(n===void 0)return this.lerp(this,e,r);for(let i=0;i<this.ELEMENTS;++i){const o=e[i],c=typeof r=="number"?r:r[i];this[i]=o+n*(c-o)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),r[n]);return this.check()}add(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if($l.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),r);return this.check()}get elements(){return this}}function Bq(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function Yo(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Aw(t,e,r=""){if($l.debug&&!Bq(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function jC(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Lq extends rF{get x(){return this[0]}set x(e){this[0]=Yo(e)}get y(){return this[1]}set y(e){this[1]=Yo(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];r+=i*i}return Yo(r)}dot(e){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*e[n];return Yo(r)}normalize(){const e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...e){for(const r of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return jC(e>=0&&e<this.ELEMENTS,"index is out of range"),Yo(this[e])}setComponent(e,r){return jC(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}}const v0=1e-6;let Fg=typeof Float32Array<"u"?Float32Array:Array;function Fq(){const t=new Fg(2);return Fg!=Float32Array&&(t[0]=0,t[1]=0),t}function UC(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function zq(t,e){return t[0]=-e[0],t[1]=-e[1],t}function nF(t,e,r,n){const i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}function jq(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(function(){const t=Fq();return function(e,r,n,i,o,c){let s,m;for(r||(r=2),n||(n=0),i?m=Math.min(i*r+n,e.length):m=e.length,s=n;s<m;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,c),e[s]=t[0],e[s+1]=t[1];return e}})();function Uq(t,e,r){const n=e[0],i=e[1],o=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/o,t[1]=(r[1]*n+r[5]*i)/o,t}function iF(t,e,r){const n=e[0],i=e[1],o=e[2],c=r[3]*n+r[7]*i+r[11]*o||1;return t[0]=(r[0]*n+r[4]*i+r[8]*o)/c,t[1]=(r[1]*n+r[5]*i+r[9]*o)/c,t[2]=(r[2]*n+r[6]*i+r[10]*o)/c,t}function $q(t,e,r){const n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function Vq(){const t=new Fg(3);return Fg!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function qq(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Hq(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Wq(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Zq(t,e,r){const n=e[0],i=e[1],o=e[2],c=r[0],s=r[1],m=r[2];return t[0]=i*m-o*s,t[1]=o*c-n*m,t[2]=n*s-i*c,t}function aF(t,e,r){const n=e[0],i=e[1],o=e[2];let c=r[3]*n+r[7]*i+r[11]*o+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/c,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/c,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/c,t}function Xq(t,e,r){const n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function Gq(t,e,r){const n=r[0],i=r[1],o=r[2],c=r[3],s=e[0],m=e[1],v=e[2];let w=i*v-o*m,M=o*s-n*v,I=n*m-i*s,k=i*I-o*M,z=o*w-n*I,V=n*M-i*w;const U=c*2;return w*=U,M*=U,I*=U,k*=2,z*=2,V*=2,t[0]=s+w+k,t[1]=m+M+z,t[2]=v+I+V,t}function Yq(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function Kq(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function Qq(t,e,r,n){const i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function Jq(t,e){const r=t[0],n=t[1],i=t[2],o=e[0],c=e[1],s=e[2],m=Math.sqrt((r*r+n*n+i*i)*(o*o+c*c+s*s)),v=m&&Wq(t,e)/m;return Math.acos(Math.min(Math.max(v,-1),1))}const e9=qq;(function(){const t=Vq();return function(e,r,n,i,o,c){let s,m;for(r||(r=3),n||(n=0),i?m=Math.min(i*r+n,e.length):m=e.length,s=n;s<m;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();const Ew=[0,0,0];let Gb;class Ou extends Lq{static get ZERO(){return Gb||(Gb=new Ou(0,0,0),Object.freeze(Gb)),Gb}constructor(e=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&Lg(e)?this.copy(e):($l.debug&&(Yo(e),Yo(r),Yo(n)),this[0]=e,this[1]=r,this[2]=n)}set(e,r,n){return this[0]=e,this[1]=r,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return $l.debug&&(Yo(e.x),Yo(e.y),Yo(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Yo(e)}angle(e){return Jq(this,e)}cross(e){return Zq(this,this,e),this.check()}rotateX({radians:e,origin:r=Ew}){return Yq(this,this,r,e),this.check()}rotateY({radians:e,origin:r=Ew}){return Kq(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=Ew}){return Qq(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return aF(this,this,e),this.check()}transformAsVector(e){return iF(this,this,e),this.check()}transformByMatrix3(e){return Xq(this,this,e),this.check()}transformByMatrix2(e){return $q(this,this,e),this.check()}transformByQuaternion(e){return Gq(this,this,e),this.check()}}class t9 extends rF{toString(){let e="[";if($l.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,n){return this[r*this.RANK+e]=Yo(n),this}getColumn(e,r=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)r[i]=this[n+i];return r}setColumn(e,r){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=r[i];return this}}function r9(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n9(t,e){if(t===e){const r=e[1],n=e[2],i=e[3],o=e[6],c=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=c,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function oE(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],c=e[4],s=e[5],m=e[6],v=e[7],w=e[8],M=e[9],I=e[10],k=e[11],z=e[12],V=e[13],U=e[14],K=e[15],J=r*s-n*c,Z=r*m-i*c,re=r*v-o*c,W=n*m-i*s,Y=n*v-o*s,ue=i*v-o*m,be=w*V-M*z,Ce=w*U-I*z,Ye=w*K-k*z,Me=M*U-I*V,Ue=M*K-k*V,Qe=I*K-k*U;let Ze=J*Qe-Z*Ue+re*Me+W*Ye-Y*Ce+ue*be;return Ze?(Ze=1/Ze,t[0]=(s*Qe-m*Ue+v*Me)*Ze,t[1]=(i*Ue-n*Qe-o*Me)*Ze,t[2]=(V*ue-U*Y+K*W)*Ze,t[3]=(I*Y-M*ue-k*W)*Ze,t[4]=(m*Ye-c*Qe-v*Ce)*Ze,t[5]=(r*Qe-i*Ye+o*Ce)*Ze,t[6]=(U*re-z*ue-K*Z)*Ze,t[7]=(w*ue-I*re+k*Z)*Ze,t[8]=(c*Ue-s*Ye+v*be)*Ze,t[9]=(n*Ye-r*Ue-o*be)*Ze,t[10]=(z*Y-V*re+K*J)*Ze,t[11]=(M*re-w*Y-k*J)*Ze,t[12]=(s*Ce-c*Me-m*be)*Ze,t[13]=(r*Me-n*Ce+i*be)*Ze,t[14]=(V*Z-z*W-U*J)*Ze,t[15]=(w*W-M*Z+I*J)*Ze,t):null}function i9(t){const e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],c=t[5],s=t[6],m=t[7],v=t[8],w=t[9],M=t[10],I=t[11],k=t[12],z=t[13],V=t[14],U=t[15],K=e*c-r*o,J=e*s-n*o,Z=r*s-n*c,re=v*z-w*k,W=v*V-M*k,Y=w*V-M*z,ue=e*Y-r*W+n*re,be=o*Y-c*W+s*re,Ce=v*Z-w*J+M*K,Ye=k*Z-z*J+V*K;return m*ue-i*be+U*Ce-I*Ye}function zp(t,e,r){const n=e[0],i=e[1],o=e[2],c=e[3],s=e[4],m=e[5],v=e[6],w=e[7],M=e[8],I=e[9],k=e[10],z=e[11],V=e[12],U=e[13],K=e[14],J=e[15];let Z=r[0],re=r[1],W=r[2],Y=r[3];return t[0]=Z*n+re*s+W*M+Y*V,t[1]=Z*i+re*m+W*I+Y*U,t[2]=Z*o+re*v+W*k+Y*K,t[3]=Z*c+re*w+W*z+Y*J,Z=r[4],re=r[5],W=r[6],Y=r[7],t[4]=Z*n+re*s+W*M+Y*V,t[5]=Z*i+re*m+W*I+Y*U,t[6]=Z*o+re*v+W*k+Y*K,t[7]=Z*c+re*w+W*z+Y*J,Z=r[8],re=r[9],W=r[10],Y=r[11],t[8]=Z*n+re*s+W*M+Y*V,t[9]=Z*i+re*m+W*I+Y*U,t[10]=Z*o+re*v+W*k+Y*K,t[11]=Z*c+re*w+W*z+Y*J,Z=r[12],re=r[13],W=r[14],Y=r[15],t[12]=Z*n+re*s+W*M+Y*V,t[13]=Z*i+re*m+W*I+Y*U,t[14]=Z*o+re*v+W*k+Y*K,t[15]=Z*c+re*w+W*z+Y*J,t}function U0(t,e,r){const n=r[0],i=r[1],o=r[2];let c,s,m,v,w,M,I,k,z,V,U,K;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(c=e[0],s=e[1],m=e[2],v=e[3],w=e[4],M=e[5],I=e[6],k=e[7],z=e[8],V=e[9],U=e[10],K=e[11],t[0]=c,t[1]=s,t[2]=m,t[3]=v,t[4]=w,t[5]=M,t[6]=I,t[7]=k,t[8]=z,t[9]=V,t[10]=U,t[11]=K,t[12]=c*n+w*i+z*o+e[12],t[13]=s*n+M*i+V*o+e[13],t[14]=m*n+I*i+U*o+e[14],t[15]=v*n+k*i+K*o+e[15]),t}function mP(t,e,r){const n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a9(t,e,r,n){let i=n[0],o=n[1],c=n[2],s=Math.sqrt(i*i+o*o+c*c),m,v,w,M,I,k,z,V,U,K,J,Z,re,W,Y,ue,be,Ce,Ye,Me,Ue,Qe,Ze,ct;return s<v0?null:(s=1/s,i*=s,o*=s,c*=s,v=Math.sin(r),m=Math.cos(r),w=1-m,M=e[0],I=e[1],k=e[2],z=e[3],V=e[4],U=e[5],K=e[6],J=e[7],Z=e[8],re=e[9],W=e[10],Y=e[11],ue=i*i*w+m,be=o*i*w+c*v,Ce=c*i*w-o*v,Ye=i*o*w-c*v,Me=o*o*w+m,Ue=c*o*w+i*v,Qe=i*c*w+o*v,Ze=o*c*w-i*v,ct=c*c*w+m,t[0]=M*ue+V*be+Z*Ce,t[1]=I*ue+U*be+re*Ce,t[2]=k*ue+K*be+W*Ce,t[3]=z*ue+J*be+Y*Ce,t[4]=M*Ye+V*Me+Z*Ue,t[5]=I*Ye+U*Me+re*Ue,t[6]=k*Ye+K*Me+W*Ue,t[7]=z*Ye+J*Me+Y*Ue,t[8]=M*Qe+V*Ze+Z*ct,t[9]=I*Qe+U*Ze+re*ct,t[10]=k*Qe+K*Ze+W*ct,t[11]=z*Qe+J*Ze+Y*ct,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function sF(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[4],c=e[5],s=e[6],m=e[7],v=e[8],w=e[9],M=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+v*n,t[5]=c*i+w*n,t[6]=s*i+M*n,t[7]=m*i+I*n,t[8]=v*i-o*n,t[9]=w*i-c*n,t[10]=M*i-s*n,t[11]=I*i-m*n,t}function s9(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[0],c=e[1],s=e[2],m=e[3],v=e[8],w=e[9],M=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-v*n,t[1]=c*i-w*n,t[2]=s*i-M*n,t[3]=m*i-I*n,t[8]=o*n+v*i,t[9]=c*n+w*i,t[10]=s*n+M*i,t[11]=m*n+I*i,t}function oF(t,e,r){const n=Math.sin(r),i=Math.cos(r),o=e[0],c=e[1],s=e[2],m=e[3],v=e[4],w=e[5],M=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+v*n,t[1]=c*i+w*n,t[2]=s*i+M*n,t[3]=m*i+I*n,t[4]=v*i-o*n,t[5]=w*i-c*n,t[6]=M*i-s*n,t[7]=I*i-m*n,t}function o9(t,e){const r=e[0],n=e[1],i=e[2],o=e[3],c=r+r,s=n+n,m=i+i,v=r*c,w=n*c,M=n*s,I=i*c,k=i*s,z=i*m,V=o*c,U=o*s,K=o*m;return t[0]=1-M-z,t[1]=w+K,t[2]=I-U,t[3]=0,t[4]=w-K,t[5]=1-v-z,t[6]=k+V,t[7]=0,t[8]=I+U,t[9]=k-V,t[10]=1-v-M,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function l9(t,e,r,n,i,o,c){const s=1/(r-e),m=1/(i-n),v=1/(o-c);return t[0]=o*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*m,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*m,t[10]=(c+o)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*o*2*v,t[15]=0,t}function c9(t,e,r,n,i){const o=1/Math.tan(e/2);if(t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const c=1/(n-i);t[10]=(i+n)*c,t[14]=2*i*n*c}else t[10]=-1,t[14]=-2*n;return t}const u9=c9;function h9(t,e,r,n,i,o,c){const s=1/(e-r),m=1/(n-i),v=1/(o-c);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*m,t[14]=(c+o)*v,t[15]=1,t}const f9=h9;function d9(t,e,r,n){let i,o,c,s,m,v,w,M,I,k;const z=e[0],V=e[1],U=e[2],K=n[0],J=n[1],Z=n[2],re=r[0],W=r[1],Y=r[2];return Math.abs(z-re)<v0&&Math.abs(V-W)<v0&&Math.abs(U-Y)<v0?r9(t):(M=z-re,I=V-W,k=U-Y,i=1/Math.sqrt(M*M+I*I+k*k),M*=i,I*=i,k*=i,o=J*k-Z*I,c=Z*M-K*k,s=K*I-J*M,i=Math.sqrt(o*o+c*c+s*s),i?(i=1/i,o*=i,c*=i,s*=i):(o=0,c=0,s=0),m=I*s-k*c,v=k*o-M*s,w=M*c-I*o,i=Math.sqrt(m*m+v*v+w*w),i?(i=1/i,m*=i,v*=i,w*=i):(m=0,v=0,w=0),t[0]=o,t[1]=m,t[2]=M,t[3]=0,t[4]=c,t[5]=v,t[6]=I,t[7]=0,t[8]=s,t[9]=w,t[10]=k,t[11]=0,t[12]=-(o*z+c*V+s*U),t[13]=-(m*z+v*V+w*U),t[14]=-(M*z+I*V+k*U),t[15]=1,t)}function p9(){const t=new Fg(4);return Fg!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function m9(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Uv(t,e,r){const n=e[0],i=e[1],o=e[2],c=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*c,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*c,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*c,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*c,t}(function(){const t=p9();return function(e,r,n,i,o,c){let s,m;for(r||(r=4),n||(n=0),i?m=Math.min(i*r+n,e.length):m=e.length,s=n;s<m;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}})();var lE;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(lE||(lE={}));const g9=45*Math.PI/180,_9=1,Mw=.1,Pw=500,y9=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ku extends t9{static get IDENTITY(){return b9()}static get ZERO(){return v9()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return lE}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,n,i,o,c,s,m,v,w,M,I,k,z,V,U){return this[0]=e,this[1]=r,this[2]=n,this[3]=i,this[4]=o,this[5]=c,this[6]=s,this[7]=m,this[8]=v,this[9]=w,this[10]=M,this[11]=I,this[12]=k,this[13]=z,this[14]=V,this[15]=U,this.check()}setRowMajor(e,r,n,i,o,c,s,m,v,w,M,I,k,z,V,U){return this[0]=e,this[1]=o,this[2]=v,this[3]=k,this[4]=r,this[5]=c,this[6]=w,this[7]=z,this[8]=n,this[9]=s,this[10]=M,this[11]=V,this[12]=i,this[13]=m,this[14]=I,this[15]=U,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(y9)}fromObject(e){return this.check()}fromQuaternion(e){return o9(this,e),this.check()}frustum(e){const{left:r,right:n,bottom:i,top:o,near:c=Mw,far:s=Pw}=e;return s===1/0?x9(this,r,n,i,o,c):l9(this,r,n,i,o,c,s),this.check()}lookAt(e){const{eye:r,center:n=[0,0,0],up:i=[0,1,0]}=e;return d9(this,r,n,i),this.check()}ortho(e){const{left:r,right:n,bottom:i,top:o,near:c=Mw,far:s=Pw}=e;return f9(this,r,n,i,o,c,s),this.check()}orthographic(e){const{fovy:r=g9,aspect:n=_9,focalDistance:i=1,near:o=Mw,far:c=Pw}=e;$C(r);const s=r/2,m=i*Math.tan(s),v=m*n;return this.ortho({left:-v,right:v,bottom:-m,top:m,near:o,far:c})}perspective(e){const{fovy:r=45*Math.PI/180,aspect:n=1,near:i=.1,far:o=500}=e;return $C(r),u9(this,r,n,i,o),this.check()}determinant(){return i9(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],o=1/n[1],c=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*o,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*o,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];const n=this.getScale(r),i=1/n[0],o=1/n[1],c=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=this[4]*i,e[4]=this[5]*o,e[5]=this[6]*c,e[6]=this[8]*i,e[7]=this[9]*o,e[8]=this[10]*c,e}transpose(){return n9(this,this),this.check()}invert(){return oE(this,this),this.check()}multiplyLeft(e){return zp(this,e,this),this.check()}multiplyRight(e){return zp(this,this,e),this.check()}rotateX(e){return sF(this,this,e),this.check()}rotateY(e){return s9(this,this,e),this.check()}rotateZ(e){return oF(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return a9(this,this,e,r),this.check()}scale(e){return mP(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return U0(this,this,e),this.check()}transform(e,r){return e.length===4?(r=Uv(r||[-0,-0,-0,-0],e,this),Aw(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){const{length:n}=e;let i;switch(n){case 2:i=jq(r||[-0,-0],e,this);break;case 3:i=aF(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Aw(i,e.length),i}transformAsVector(e,r){let n;switch(e.length){case 2:n=Uq(r||[-0,-0],e,this);break;case 3:n=iF(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Aw(n,e.length),n}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,n){return this.identity().translate([e,r,n])}}let Yb,Kb;function v9(){return Yb||(Yb=new ku([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Yb)),Yb}function b9(){return Kb||(Kb=new ku,Object.freeze(Kb)),Kb}function $C(t){if(t>Math.PI*2)throw Error("expected radians")}function x9(t,e,r,n,i,o){const c=2*o/(r-e),s=2*o/(i-n),m=(r+e)/(r-e),v=(i+n)/(i-n),w=-1,M=-1,I=-2*o;return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=m,t[9]=v,t[10]=w,t[11]=M,t[12]=0,t[13]=0,t[14]=I,t[15]=0,t}function lF(t,e=[],r=0){const n=Math.fround(t),i=t-n;return e[r]=n,e[r+1]=i,e}function w9(t){return t-Math.fround(t)}function T9(t){const e=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){const i=r*4+n;lF(t[n*4+r],e,i*2)}return e}const S9=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,A9={name:"fp32",vs:S9},E9=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,M9={ONE:1},P9={name:"fp64arithmetic",vs:E9,defaultUniforms:M9,uniformTypes:{ONE:"f32"},fp64ify:lF,fp64LowPart:w9,fp64ifyMatrix4:T9},C9=[0,1,1,1],R9=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,I9=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,VC={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:C9},vs:R9,fs:I9,getUniforms:O9};function O9(t={},e){const r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;const n=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(t.highlightColor){const n=Array.from(t.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}const qC=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,k9={name:"layer",vs:qC,fs:qC,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},D9=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,cF="#define SMOOTH_EDGE_RADIUS 0.5",N9=`${cF}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,B9=`${cF}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,uF={name:"geometry",source:D9,vs:N9,fs:B9},L9=25;var xa;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(xa||(xa={}));var ka;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(ka||(ka={}));var zr;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(zr||(zr={}));const F9="compute",z9="auto",cE="manipulation",b0="none",uE="pan-x",hE="pan-y";function j9(t){if(t.includes(b0))return b0;const e=t.includes(uE),r=t.includes(hE);return e&&r?b0:e||r?e?uE:hE:t.includes(cE)?cE:z9}class U9{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===F9&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return j9(e.join(" "))}}function $0(t){return t.trim().split(/\s+/g)}function Cw(t,e,r){if(t)for(const n of $0(e))t.addEventListener(n,r,!1)}function Rw(t,e,r){if(t)for(const n of $0(e))t.removeEventListener(n,r,!1)}function HC(t){return(t.ownerDocument||t).defaultView}function $9(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function hF(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,n=0,i=0;for(;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:Math.round(r/e),y:Math.round(n/e)}}function WC(t){const e=[];let r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:hF(e),deltaX:t.deltaX,deltaY:t.deltaY}}function fF(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function ZC(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(r*r+n*n)}function V9(t,e){const r=e.x-t.x,n=e.y-t.y;return Math.atan2(n,r)*180/Math.PI}function XC(t,e){const r=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.atan2(n,r)*180/Math.PI}function dF(t,e){return t===e?ka.None:Math.abs(t)>=Math.abs(e)?t<0?ka.Left:ka.Right:e<0?ka.Up:ka.Down}function q9(t,e){const r=e.center;let n=t.offsetDelta,i=t.prevDelta;const o=t.prevInput;return(e.eventType===xa.Start||(o==null?void 0:o.eventType)===xa.End)&&(i=t.prevDelta={x:(o==null?void 0:o.deltaX)||0,y:(o==null?void 0:o.deltaY)||0},n=t.offsetDelta={x:r.x,y:r.y}),{deltaX:i.x+(r.x-n.x),deltaY:i.y+(r.y-n.y)}}function pF(t,e,r){return{x:e/t||0,y:r/t||0}}function H9(t,e){return ZC(e[0],e[1])/ZC(t[0],t[1])}function W9(t,e){return XC(e[1],e[0])-XC(t[1],t[0])}function Z9(t,e){const r=t.lastInterval||e,n=e.timeStamp-r.timeStamp;let i,o,c,s;if(e.eventType!==xa.Cancel&&(n>L9||r.velocity===void 0)){const m=e.deltaX-r.deltaX,v=e.deltaY-r.deltaY,w=pF(n,m,v);o=w.x,c=w.y,i=Math.abs(w.x)>Math.abs(w.y)?w.x:w.y,s=dF(m,v),t.lastInterval=e}else i=r.velocity,o=r.velocityX,c=r.velocityY,s=r.direction;e.velocity=i,e.velocityX=o,e.velocityY=c,e.direction=s}function X9(t,e){const{session:r}=t,{pointers:n}=e,{length:i}=n;r.firstInput||(r.firstInput=WC(e)),i>1&&!r.firstMultiple?r.firstMultiple=WC(e):i===1&&(r.firstMultiple=!1);const{firstInput:o,firstMultiple:c}=r,s=c?c.center:o.center,m=e.center=hF(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=V9(s,m),e.distance=fF(s,m);const{deltaX:v,deltaY:w}=q9(r,e);e.deltaX=v,e.deltaY=w,e.offsetDirection=dF(e.deltaX,e.deltaY);const M=pF(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=M.x,e.overallVelocityY=M.y,e.overallVelocity=Math.abs(M.x)>Math.abs(M.y)?M.x:M.y,e.scale=c?H9(c.pointers,n):1,e.rotation=c?W9(c.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let I=t.element;return $9(e.srcEvent.target,I)&&(I=e.srcEvent.target),e.target=I,Z9(r,e),e}function G9(t,e,r){const n=r.pointers.length,i=r.changedPointers.length,o=e&xa.Start&&n-i===0,c=e&(xa.End|xa.Cancel)&&n-i===0;r.isFirst=!!o,r.isFinal=!!c,o&&(t.session={}),r.eventType=e;const s=X9(t,r);t.emit("hammer.input",s),t.recognize(s),t.session.prevInput=s}let Y9=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){G9(this.manager,e,r)}init(){Cw(this.element,this.evEl,this.domHandler),Cw(this.target,this.evTarget,this.domHandler),Cw(HC(this.element),this.evWin,this.domHandler)}destroy(){Rw(this.element,this.evEl,this.domHandler),Rw(this.target,this.evTarget,this.domHandler),Rw(HC(this.element),this.evWin,this.domHandler)}};const K9={pointerdown:xa.Start,pointermove:xa.Move,pointerup:xa.End,pointercancel:xa.Cancel,pointerout:xa.Cancel},Q9="pointerdown",J9="pointermove pointerup pointercancel";class e7 extends Y9{constructor(e){super(e),this.evEl=Q9,this.evWin=J9,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:r}=this;let n=!1;const i=K9[e.type],o=e.pointerType,c=o==="touch";let s=r.findIndex(m=>m.pointerId===e.pointerId);i&xa.Start&&(e.buttons||c)?s<0&&(r.push(e),s=r.length-1):i&(xa.End|xa.Cancel)&&(n=!0),!(s<0)&&(r[s]=e,this.callback(i,{pointers:r,changedPointers:[e],eventType:i,pointerType:o,srcEvent:e}),n&&r.splice(s,1))}}const t7=["","webkit","Moz","MS","ms","o"];function r7(t,e){const r=e[0].toUpperCase()+e.slice(1);for(const n of t7){const i=n?n+r:e;if(i in t)return i}}const n7=1,GC=2,YC={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class i7{constructor(e,r){this.options={...YC,...r,cssProps:{...YC.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new e7(this),this.touchAction=new U9(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?GC:n7}recognize(e){const{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:o}=r;(!o||o&&o.state&zr.Recognized)&&(o=r.curRecognizer=null);let c=0;for(;c<i.length;)n=i[c],r.stopped!==GC&&(!o||n===o||n.canRecognizeWith(o))?n.recognize(e):n.reset(),!o&&n.state&(zr.Began|zr.Changed|zr.Ended)&&(o=r.curRecognizer=n),c++}get(e){const{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===e)return r[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const r=typeof e=="string"?this.get(e):e;if(r){const{recognizers:n}=this,i=n.indexOf(r);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;const{handlers:n}=this;for(const i of $0(e))n[i]=n[i]||[],n[i].push(r)}off(e,r){if(!e)return;const{handlers:n}=this;for(const i of $0(e))r?n[i]&&n[i].splice(n[i].indexOf(r),1):delete n[i]}emit(e,r){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=r;i.type=e,i.preventDefault=function(){r.srcEvent.preventDefault()};let o=0;for(;o<n.length;)n[o](i),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:r}=this;if(r){for(const[n,i]of Object.entries(this.options.cssProps)){const o=r7(r.style,n);e?(this.oldCssProps[o]=r.style[o],r.style[o]=i):r.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}}let a7=1;function s7(){return a7++}function KC(t){return t&zr.Cancelled?"cancel":t&zr.Ended?"end":t&zr.Changed?"move":t&zr.Began?"start":""}class mF{constructor(e){this.options=e,this.id=s7(),this.state=zr.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;const{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){const n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:r}=this;r<zr.Ended&&this.manager.emit(this.options.event+KC(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=zr.Ended&&this.manager.emit(this.options.event+KC(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=zr.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(zr.Failed|zr.Possible)))return!1;e++}return!0}recognize(e){const r={...e};if(!this.options.enable){this.reset(),this.state=zr.Failed;return}this.state&(zr.Recognized|zr.Cancelled|zr.Failed)&&(this.state=zr.Possible),this.state=this.process(r),this.state&(zr.Began|zr.Changed|zr.Ended|zr.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}}class gF extends mF{attrTest(e){const r=this.options.pointers;return r===0||e.pointers.length===r}process(e){const{state:r}=this,{eventType:n}=e,i=r&(zr.Began|zr.Changed),o=this.attrTest(e);return i&&(n&xa.Cancel||!o)?r|zr.Cancelled:i||o?n&xa.End?r|zr.Ended:r&zr.Began?r|zr.Changed:zr.Began:zr.Failed}}class QC extends mF{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[cE]}process(e){const{options:r}=this,n=e.pointers.length===r.pointers,i=e.distance<r.threshold,o=e.deltaTime<r.time;if(this.reset(),e.eventType&xa.Start&&this.count===0)return this.failTimeout();if(i&&o&&n){if(e.eventType!==xa.End)return this.failTimeout();const c=this.pTime?e.timeStamp-this.pTime<r.interval:!0,s=!this.pCenter||fF(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!s||!c?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=zr.Recognized,this.tryEmit(this._input)},r.interval),zr.Began):zr.Recognized}return zr.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=zr.Failed},this.options.interval),zr.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===zr.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const o7=["","start","move","end","cancel","up","down","left","right"];class JC extends gF{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ka.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,r=[];return e&ka.Horizontal&&r.push(hE),e&ka.Vertical&&r.push(uE),r}getEventNames(){return o7.map(e=>this.options.event+e)}directionTest(e){const{options:r}=this;let n=!0,{distance:i}=e,{direction:o}=e;const c=e.deltaX,s=e.deltaY;return o&r.direction||(r.direction&ka.Horizontal?(o=c===0?ka.None:c<0?ka.Left:ka.Right,n=c!==this.pX,i=Math.abs(e.deltaX)):(o=s===0?ka.None:s<0?ka.Up:ka.Down,n=s!==this.pY,i=Math.abs(e.deltaY))),e.direction=o,n&&i>r.threshold&&!!(o&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&zr.Began)||!(this.state&zr.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const r=ka[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}}const l7=["","start","move","end","cancel","in","out"];class c7 extends gF{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[b0]}getEventNames(){return l7.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&zr.Began))}emit(e){if(e.scale!==1){const r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}}class h1{constructor(e,r,n){this.element=e,this.callback=r,this.options=n}}const u7=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",h7=u7.indexOf("firefox")!==-1,eR=4.000244140625,f7=40,d7=.25;class p7 extends h1{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let o=i.deltaY;globalThis.WheelEvent&&(h7&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=f7)),o!==0&&o%eR===0&&(o=Math.floor(o/eR)),i.shiftKey&&o&&(o=o*d7),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-o,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}}const tR=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class m7 extends h1{constructor(e,r,n){super(e,r,{enable:!0,...n}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,tR.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){tR.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}}const rR=["keydown","keyup"];class g7 extends h1{constructor(e,r,n){super(e,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const o=i.target||i.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",rR.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){rR.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}}class _7 extends h1{constructor(e,r,n){super(e,r,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}}const nR=1,fE=2,iR=4,y7={pointerdown:nR,pointermove:fE,pointerup:iR,mousedown:nR,mousemove:fE,mouseup:iR},v7=0,b7=1,x7=2,w7=1,T7=2,S7=4;function A7(t){const e=y7[t.srcEvent.type];if(!e)return null;const{buttons:r,button:n}=t.srcEvent;let i=!1,o=!1,c=!1;return e===fE?(i=!!(r&w7),o=!!(r&S7),c=!!(r&T7)):(i=n===v7,o=n===b7,c=n===x7),{leftButton:i,middleButton:o,rightButton:c}}function E7(t,e){const r=t.center;if(!r)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,o=n.height/e.offsetHeight||1,c={x:(r.x-n.left-e.clientLeft)/i,y:(r.y-n.top-e.clientTop)/o};return{center:r,offsetCenter:c}}const M7={srcElement:"root",priority:0};class P7{constructor(e,r){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,n,i=!1,o=!1){const{handlers:c,handlersByElement:s}=this,m={...M7,...n};let v=s.get(m.srcElement);v||(v=[],s.set(m.srcElement,v));const w={type:e,handler:r,srcElement:m.srcElement,priority:m.priority};i&&(w.once=!0),o&&(w.passive=!0),c.push(w),this._active=this._active||!w.passive;let M=v.length-1;for(;M>=0&&!(v[M].priority>=w.priority);)M--;v.splice(M+1,0,w)}remove(e,r){const{handlers:n,handlersByElement:i}=this;for(let o=n.length-1;o>=0;o--){const c=n[o];if(c.type===e&&c.handler===r){n.splice(o,1);const s=i.get(c.srcElement);s.splice(s.indexOf(c),1),s.length===0&&i.delete(c.srcElement)}}this._active=n.some(o=>!o.passive)}_emit(e,r){const n=this.handlersByElement.get(r);if(n){let i=!1;const o=()=>{e.handled=!0},c=()=>{e.handled=!0,i=!0},s=[];for(let m=0;m<n.length;m++){const{type:v,handler:w,once:M}=n[m];if(w({...e,type:v,stopPropagation:o,stopImmediatePropagation:c}),M&&s.push(n[m]),i)break}for(let m=0;m<s.length;m++){const{type:v,handler:w}=s[m];this.remove(v,w)}}}_normalizeEvent(e){const r=this.eventManager.getElement();return{...e,...A7(e),...E7(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}}function C7(t){if("recognizer"in t)return t;let e;const r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){const n=r.shift(),i=r.shift()||{};e=new n(i)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}class R7{constructor(e=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new i7(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:o,requireFailure:c}=C7(n);this.manager.add(i),o&&i.recognizeWith(o),c&&i.requireFailure(c)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new p7(e,this._onOtherEvent,{enable:!1}),this.moveInput=new m7(e,this._onOtherEvent,{enable:!1}),this.keyInput=new g7(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new _7(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,n){this._addEventHandler(e,r,n,!1)}once(e,r,n){this._addEventHandler(e,r,n,!0)}watch(e,r,n){this._addEventHandler(e,r,n,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){var o,c,s,m;const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:r}),n.touchAction.update()),(o=this.wheelInput)==null||o.enableEventType(e,r),(c=this.moveInput)==null||c.enableEventType(e,r),(s=this.keyInput)==null||s.enableEventType(e,r),(m=this.contextmenuInput)==null||m.enableEventType(e,r)}_addEventHandler(e,r,n,i,o){if(typeof e!="string"){n=r;for(const[v,w]of Object.entries(e))this._addEventHandler(v,w,n,i,o);return}const{manager:c,events:s}=this;if(!c)return;let m=s.get(e);if(!m){const v=this._getRecognizerName(e)||e;m=new P7(this,v),s.set(e,m),c&&c.on(e,m.handleEvent)}m.add(e,r,n,i,o),m.isEmpty()||this._toggleRecognizer(m.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(const[o,c]of Object.entries(e))this._removeEventHandler(o,c);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,r),i.isEmpty())){const{recognizerName:o}=i;let c=!1;for(const s of n.values())if(s.recognizerName===o&&!s.isEmpty()){c=!0;break}c||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){var r;return(r=this.manager.recognizers.find(n=>n.getEventNames().includes(e)))==null?void 0:r.options.event}}const An={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(An,"IDENTITY",{get:()=>(oi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const zl={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},zg={common:0,meters:1,pixels:2},dE={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},aR={multipan:[JC,{threshold:10,direction:ka.Vertical,pointers:2}],pinch:[c7,{},null,["multipan"]],pan:[JC,{threshold:1},["pinch"],["multipan"]],dblclick:[QC,{event:"dblclick",taps:2}],click:[QC,{event:"click"},null,["dblclick"]]};function I7(t,e){if(t===e)return!0;if(Array.isArray(t)){const r=t.length;if(!e||e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function $v(t){let e={},r;return n=>{for(const i in n)if(!I7(n[i],e[i])){r=t(n),e=n;break}return r}}const sR=[0,0,0,0],O7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],_F=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],k7=[0,0,0],yF=[0,0,0],D7=$v(L7);function vF(t,e,r=yF){r.length<3&&(r=[r[0],r[1],0]);let n=r,i,o=!0;switch(e===An.LNGLAT_OFFSETS||e===An.METER_OFFSETS?i=r:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case zl.WEB_MERCATOR:(e===An.LNGLAT||e===An.CARTESIAN)&&(i=[0,0,0],o=!1);break;case zl.WEB_MERCATOR_AUTO_OFFSET:e===An.LNGLAT?n=i:e===An.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case zl.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case zl.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:o}}function N7(t,e,r){const{viewMatrixUncentered:n,projectionMatrix:i}=t;let{viewMatrix:o,viewProjectionMatrix:c}=t,s=sR,m=sR,v=t.cameraPosition;const{geospatialOrigin:w,shaderCoordinateOrigin:M,offsetMode:I}=vF(t,e,r);return I&&(m=t.projectPosition(w||M),v=[v[0]-m[0],v[1]-m[1],v[2]-m[2]],m[3]=1,s=Uv([],m,c),o=n||o,c=zp([],i,o),c=zp([],c,O7)),{viewMatrix:o,viewProjectionMatrix:c,projectionCenter:s,originCommon:m,cameraPosCommon:v,shaderCoordinateOrigin:M,geospatialOrigin:w}}function B7({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:n=An.DEFAULT,coordinateOrigin:i=yF,autoWrapLongitude:o=!1}){n===An.DEFAULT&&(n=t.isGeospatial?An.LNGLAT:An.CARTESIAN);const c=D7({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return c.wrapLongitude=o,c.modelMatrix=r||_F,c}function L7({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:o,originCommon:c,cameraPosCommon:s,shaderCoordinateOrigin:m,geospatialOrigin:v}=N7(t,r,n),w=t.getDistanceScales(),M=[t.width*e,t.height*e],I=Uv([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,k={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:m,commonOrigin:c.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:M,devicePixelRatio:e,focalDistance:I,commonUnitsPerMeter:w.unitsPerMeter,commonUnitsPerWorldUnit:w.unitsPerMeter,commonUnitsPerWorldUnit2:k7,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:_F,cameraPosition:s};if(v){const z=t.getDistanceScales(v);switch(r){case An.METER_OFFSETS:k.commonUnitsPerWorldUnit=z.unitsPerMeter,k.commonUnitsPerWorldUnit2=z.unitsPerMeter2;break;case An.LNGLAT:case An.LNGLAT_OFFSETS:t._pseudoMeters||(k.commonUnitsPerMeter=z.unitsPerMeter),k.commonUnitsPerWorldUnit=z.unitsPerDegree,k.commonUnitsPerWorldUnit2=z.unitsPerDegree2;break;case An.CARTESIAN:k.commonUnitsPerWorldUnit=[1,1,z.unitsPerMeter[2]],k.commonUnitsPerWorldUnit2=[0,0,z.unitsPerMeter2[2]];break}}return k}const F7=Object.keys(An).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${An[t]};`).join(""),z7=Object.keys(zl).map(t=>`const PROJECTION_MODE_${t}: i32 = ${zl[t]};`).join(""),j7=Object.keys(zg).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${zg[t]};`).join(""),U7=`${F7}
${z7}
${j7}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,$7=`${U7}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,V7=Object.keys(An).map(t=>`const int COORDINATE_SYSTEM_${t} = ${An[t]};`).join(""),q7=Object.keys(zl).map(t=>`const int PROJECTION_MODE_${t} = ${zl[t]};`).join(""),H7=Object.keys(zg).map(t=>`const int UNIT_${t.toUpperCase()} = ${zg[t]};`).join(""),W7=`${V7}
${q7}
${H7}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,Z7={};function X7(t=Z7){return"viewport"in t?B7(t):{}}const gP={name:"project",dependencies:[A9,uF],source:$7,vs:W7,getUniforms:X7,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},G7=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Y7=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,K7={name:"project32",dependencies:[gP],source:G7,vs:Y7};function Q7(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Cg(t,e){const r=Uv([],e,t);return m9(r,r,1/r[3]),r}function oR(t,e){const r=t%e;return r<0?e+r:r}function pE(t,e,r){return t<e?e:t>r?r:t}function J7(t){return Math.log(t)*Math.LOG2E}const _P=Math.log2||J7;function Hh(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Vc=Math.PI,bF=Vc/4,Vl=Vc/180,mE=180/Vc,jg=512,V0=4003e4,lR=85.051129,eH=1.5;function tH(t){return _P(t)}function q0(t){const[e,r]=t;Hh(Number.isFinite(e)),Hh(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");const n=e*Vl,i=r*Vl,o=jg*(n+Vc)/(2*Vc),c=jg*(Vc+Math.log(Math.tan(bF+i*.5)))/(2*Vc);return[o,c]}function Ug(t){const[e,r]=t,n=e/jg*(2*Vc)-Vc,i=2*(Math.atan(Math.exp(r/jg*(2*Vc)-Vc))-bF);return[n*mE,i*mE]}function rH(t){const{latitude:e}=t;Hh(Number.isFinite(e));const r=Math.cos(e*Vl);return tH(V0*r)-9}function Iw(t){const e=Math.cos(t*Vl);return jg/V0/e}function gE(t){const{latitude:e,longitude:r,highPrecision:n=!1}=t;Hh(Number.isFinite(e)&&Number.isFinite(r));const i=jg,o=Math.cos(e*Vl),c=i/360,s=c/o,m=i/V0/o,v={unitsPerMeter:[m,m,m],metersPerUnit:[1/m,1/m,1/m],unitsPerDegree:[c,s,m],degreesPerUnit:[1/c,1/s,1/m]};if(n){const w=Vl*Math.tan(e*Vl)/o,M=c*w/2,I=i/V0*w,k=I/s*m;v.unitsPerDegree2=[0,M,I],v.unitsPerMeter2=[k,0,k]}return v}function xF(t,e){const[r,n,i]=t,[o,c,s]=e,{unitsPerMeter:m,unitsPerMeter2:v}=gE({longitude:r,latitude:n,highPrecision:!0}),w=q0(t);w[0]+=o*(m[0]+v[0]*c),w[1]+=c*(m[1]+v[1]*c);const M=Ug(w),I=(i||0)+(s||0);return Number.isFinite(i)||Number.isFinite(s)?[M[0],M[1],I]:M}function nH(t){const{height:e,pitch:r,bearing:n,altitude:i,scale:o,center:c}=t,s=Q7();U0(s,s,[0,0,-i]),sF(s,s,-r*Vl),oF(s,s,n*Vl);const m=o/e;return mP(s,s,[m,m,m]),c&&U0(s,s,Hq([],c)),s}function iH(t){const{width:e,height:r,altitude:n,pitch:i=0,offset:o,center:c,scale:s,nearZMultiplier:m=1,farZMultiplier:v=1}=t;let{fovy:w=H0(eH)}=t;n!==void 0&&(w=H0(n));const M=w*Vl,I=i*Vl,k=wF(w);let z=k;c&&(z+=c[2]*s/Math.cos(I)/r);const V=M*(.5+(o?o[1]:0)/r),U=Math.sin(V)*z/Math.sin(pE(Math.PI/2-I-V,.01,Math.PI-.01)),K=Math.sin(I)*U+z,J=z*10,Z=Math.min(K*v,J);return{fov:M,aspect:e/r,focalDistance:k,near:m,far:Z}}function H0(t){return 2*Math.atan(.5/t)*mE}function wF(t){return .5/Math.tan(.5*t*Vl)}function TF(t,e){const[r,n,i=0]=t;return Hh(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(i)),Cg(e,[r,n,i,1])}function yP(t,e,r=0){const[n,i,o]=t;if(Hh(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(o))return Cg(e,[n,i,o,1]);const c=Cg(e,[n,i,0,1]),s=Cg(e,[n,i,1,1]),m=c[2],v=s[2],w=m===v?0:((r||0)-m)/(v-m);return nF([],c,s,w)}function aH(t){const{width:e,height:r,bounds:n,minExtent:i=0,maxZoom:o=24,offset:c=[0,0]}=t,[[s,m],[v,w]]=n,M=sH(t.padding),I=q0([s,pE(w,-85.051129,lR)]),k=q0([v,pE(m,-85.051129,lR)]),z=[Math.max(Math.abs(k[0]-I[0]),i),Math.max(Math.abs(k[1]-I[1]),i)],V=[e-M.left-M.right-Math.abs(c[0])*2,r-M.top-M.bottom-Math.abs(c[1])*2];Hh(V[0]>0&&V[1]>0);const U=V[0]/z[0],K=V[1]/z[1],J=(M.right-M.left)/2/U,Z=(M.top-M.bottom)/2/K,re=[(k[0]+I[0])/2+J,(k[1]+I[1])/2+Z],W=Ug(re),Y=Math.min(o,_P(Math.abs(Math.min(U,K))));return Hh(Number.isFinite(Y)),{longitude:W[0],latitude:W[1],zoom:Y}}function sH(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Hh(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const cR=Math.PI/180;function oH(t,e=0){const{width:r,height:n,unproject:i}=t,o={targetZ:e},c=i([0,n],o),s=i([r,n],o);let m,v;const w=t.fovy?.5*t.fovy*cR:Math.atan(.5/t.altitude),M=(90-t.pitch)*cR;return w>M-.01?(m=uR(t,0,e),v=uR(t,r,e)):(m=i([0,0],o),v=i([r,0],o)),[c,s,v,m]}function uR(t,e,r){const{pixelUnprojectionMatrix:n}=t,i=Cg(n,[e,0,1,1]),o=Cg(n,[e,t.height,1,1]),s=(r*t.distanceScales.unitsPerMeter[2]-i[2])/(o[2]-i[2]),m=nF([],i,o,s),v=Ug(m);return v.push(r),v}const hR=512;function lH(t){const{width:e,height:r,pitch:n=0}=t;let{longitude:i,latitude:o,zoom:c,bearing:s=0}=t;(i<-180||i>180)&&(i=oR(i+180,360)-180),(s<-180||s>180)&&(s=oR(s+180,360)-180);const m=_P(r/hR);if(c<=m)c=m,o=0;else{const v=r/2/Math.pow(2,c),w=Ug([0,v])[1];if(o<w)o=w;else{const M=Ug([0,hR-v])[1];o>M&&(o=M)}}return{width:e,height:r,longitude:i,latitude:o,zoom:c,pitch:n,bearing:s}}const SF=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,cH=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,uH=`
${SF}
${cH}
`,hH=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,fH=`
${SF}
${hH}
`,dH=$v(yH),pH=$v(vH),mH=[0,0,0,1],gH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function _H(t,e){const[r,n,i]=t,o=yP([r,n,i],e);return Number.isFinite(i)?o:[o[0],o[1],0]}function yH({viewport:t,center:e}){return new ku(t.viewProjectionMatrix).invert().transform(e)}function vH({viewport:t,shadowMatrices:e}){const r=[],n=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,o=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(c=>_H(c,n));for(const c of e){const s=c.clone().translate(new Ou(t.center).negate()),m=o.map(w=>s.transform(w)),v=new ku().ortho({left:Math.min(...m.map(w=>w[0])),right:Math.max(...m.map(w=>w[0])),bottom:Math.min(...m.map(w=>w[1])),top:Math.max(...m.map(w=>w[1])),near:Math.min(...m.map(w=>-w[2])),far:Math.max(...m.map(w=>-w[2]))});r.push(v.multiplyRight(c))}return r}function bH(t){const{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=gP.getUniforms(r),i=dH({viewport:r.viewport,center:n.center}),o=[],c=pH({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let m=0;m<t.shadowMatrices.length;m++){const v=c[m],w=v.clone().translate(new Ou(r.viewport.center).negate());n.coordinateSystem===An.LNGLAT&&n.projectionMode===zl.WEB_MERCATOR?(c[m]=w,o[m]=i):(c[m]=v.clone().multiplyRight(gH),o[m]=w.transform(i))}const s={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||mH,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let m=0;m<c.length;m++)s[`viewProjectionMatrix${m}`]=c[m],s[`projectCenter${m}`]=o[m];for(let m=0;m<2;m++)s[`shadow_uShadowMap${m}`]=t.shadowMaps&&t.shadowMaps[m]||t.dummyShadowMap;return s}const fR={name:"shadow",dependencies:[gP],vs:uH,fs:fH,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:bH,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},xH={...VC,defaultUniforms:{...VC.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},wH=[uF],TH=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],SH=[];function AH(t){const e=P0.getDefaultShaderAssembler();for(const n of wH)e.addDefaultModule(n);const r=t==="glsl"?TH:SH;for(const n of r)e.addShaderHook(n);return e}const EH=[255,255,255],MH=1;let PH=0;class CH{constructor(e={}){this.type="ambient";const{color:r=EH}=e,{intensity:n=MH}=e;this.id=e.id||`ambient-${PH++}`,this.color=r,this.intensity=n}}const RH=[255,255,255],IH=1,OH=[0,0,-1];let kH=0;class dR{constructor(e={}){this.type="directional";const{color:r=RH}=e,{intensity:n=IH}=e,{direction:i=OH}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${kH++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new Ou(i).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class DH{constructor(e,r={id:"pass"}){const{id:n}=r;this.id=n,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class vP extends DH{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[r,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,o=e.clearColor??(i?[0,0,0,0]:!1),c=i?1:!1,s=i?0:!1,m=e.colorMask??15,v={viewport:[0,0,r,n]};e.colorMask&&(v.colorMask=m),e.scissorRect&&(v.scissorRect=e.scissorRect);const w=this.device.beginRenderPass({framebuffer:e.target,parameters:v,clearColor:o,clearDepth:c,clearStencil:s});try{return this._drawLayers(w,e)}finally{w.end(),this.device.submit()}}_drawLayers(e,r){const{target:n,shaderModuleProps:i,viewports:o,views:c,onViewportActive:s,clearStack:m=!0}=r;r.pass=r.pass||"unknown",m&&(this._lastRenderIndex=-1);const v=[];for(const w of o){const M=c&&c[w.id];s==null||s(w);const I=this._getDrawLayerParams(w,r),k=w.subViewports||[w];for(const z of k){const V=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:z,view:M,pass:r.pass,layers:r.layers},I);v.push(V)}}return v}_getDrawLayerParams(e,{layers:r,pass:n,isPicking:i=!1,layerFilter:o,cullRect:c,effects:s,shaderModuleProps:m},v=!1){var z;const w=[],M=AF(this._lastRenderIndex+1),I={layer:r[0],viewport:e,isPicking:i,renderPass:n,cullRect:c},k={};for(let V=0;V<r.length;V++){const U=r[V],K=this._shouldDrawLayer(U,I,o,k),J={shouldDrawLayer:K};K&&!v&&(J.shouldDrawLayer=!0,J.layerRenderIndex=M(U,K),J.shaderModuleProps=this._getShaderModuleProps(U,s,n,m),J.layerParameters={...(z=U.context.deck)==null?void 0:z.props.parameters,...this.getLayerParameters(U,V,e)}),w[V]=J}return w}_drawLayersInViewport(e,{layers:r,shaderModuleProps:n,pass:i,target:o,viewport:c,view:s},m){const v=NH(this.device,{shaderModuleProps:n,target:o,viewport:c});if(s&&s.props.clear){const M=s.props.clear===!0?{color:!0,depth:!0}:s.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:v,scissorRect:v},clearColor:M.color?[0,0,0,0]:!1,clearDepth:M.depth?1:!1}).end()}const w={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:v});for(let M=0;M<r.length;M++){const I=r[M],k=m[M],{shouldDrawLayer:z}=k;if(z&&I.props.pickable&&w.pickableCount++,I.isComposite&&w.compositeCount++,I.isDrawable&&k.shouldDrawLayer){const{layerRenderIndex:V,shaderModuleProps:U,layerParameters:K}=k;w.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,V),U.project&&(U.project.viewport=c),I.context.renderPass=e;try{I._drawLayer({renderPass:e,shaderModuleProps:U,uniforms:{layerIndex:V},parameters:K})}catch(J){I.raiseError(J,`drawing ${I} to ${i}`)}}}return w}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,n){return null}getLayerParameters(e,r,n){return e.props.parameters}_shouldDrawLayer(e,r,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(r))return!1;r.layer=c,c=c.parent}if(n){const s=r.layer.id;if(s in i||(i[s]=n(r)),!i[s])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,n,i){var m,v;const o=this.device.canvasContext.cssToDeviceRatio(),c=((m=e.internalState)==null?void 0:m.propsInTransition)||e.props,s={layer:c,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:c.modelMatrix,coordinateSystem:c.coordinateSystem,coordinateOrigin:c.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(const w of r)pR(s,(v=w.getShaderModuleProps)==null?void 0:v.call(w,e,s));return pR(s,this.getShaderModuleProps(e,r,s),i)}}function AF(t=0,e={}){const r={},n=(i,o)=>{const c=i.props._offset,s=i.id,m=i.parent&&i.parent.id;let v;if(m&&!(m in e)&&n(i.parent,!1),m in r){const w=r[m]=r[m]||AF(e[m],e);v=w(i,o),r[s]=w}else Number.isFinite(c)?(v=c+(e[m]||0),r[s]=null):v=t;return o&&v>=t&&(t=v+1),e[s]=v,v};return n}function NH(t,{shaderModuleProps:e,target:r,viewport:n}){var m;const i=((m=e==null?void 0:e.project)==null?void 0:m.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,o]=t.canvasContext.getDrawingBufferSize(),c=r?r.height:o,s=n;return[s.x*i,c-(s.y+s.height)*i,s.width*i,s.height*i]}function pR(t,...e){for(const r of e)if(r)for(const n in r)t[n]?Object.assign(t[n],r[n]):t[n]=r[n];return t}class BH extends vP{constructor(e,r){super(e,r);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],o=i.width*n,c=i.height*n,s=[1,1,1,1];(o!==r.width||c!==r.height)&&r.resize({width:o,height:c}),super.render({...e,clearColor:s,target:r,pass:"shadow"})}getLayerParameters(e,r,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const LH={color:[255,255,255],intensity:1},mR=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],FH=[0,0,0,200/255];class EF{constructor(e={}){this.id="lighting-effect",this.shadowColor=FH,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:r,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(fR),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const r in e){const n=e[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:r,viewports:n,onViewportActive:i,views:o,shaderModuleProps:{shadow:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){const n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(c=>c.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(c=>c.getProjectedLight({layer:e})),pointLights:this.pointLights.map(c=>c.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:n,lighting:i,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(fR))}_calculateMatrices(){const e=[];for(const r of this.directionalLights){const n=new ku().lookAt({eye:new Ou(r.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){const n=new BH(e);this.shadowPasses[r]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:r,directionalLights:n}=this;!e&&r.length===0&&n.length===0&&(this.ambientLight=new CH(LH),this.directionalLights.push(new dR(mR[0]),new dR(mR[1])))}}class zH{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:n=1,type:i,padding:o=0,copy:c=!1,initialize:s=!1,maxCount:m}){const v=i||e&&e.constructor||Float32Array,w=r*n+o;if(ArrayBuffer.isView(e)){if(w<=e.length)return e;if(w*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new v(e.buffer,0,w)}let M=1/0;m&&(M=m*n+o);const I=this._allocate(v,w,s,M);return e&&c?I.set(e):s||I.fill(0,0,4),this._release(e),I}release(e){this._release(e)}_allocate(e,r,n,i){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>i&&(o=i);const c=this._pool,s=e.BYTES_PER_ELEMENT*o,m=c.findIndex(v=>v.byteLength>=s);if(m>=0){const v=new e(c.splice(m,1)[0],0,o);return n&&v.fill(0),v}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const r=this._pool,{buffer:n}=e,{byteLength:i}=n,o=r.findIndex(c=>c.byteLength>=i);o<0?r.push(n):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,n),r.length>this.opts.poolSize&&r.shift()}}const Qy=new zH;function Ry(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jH(t){return[t[12],t[13],t[14]]}function UH(t){return{left:dg(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:dg(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:dg(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:dg(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:dg(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:dg(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const gR=new Ou;function dg(t,e,r,n){gR.set(t,e,r);const i=gR.len();return{distance:n/i,normal:new Ou(-t/i,-e/i,-r/i)}}function $H(t){return t-Math.fround(t)}let gy;function Ow(t,e){const{size:r=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,o=(i-n)/r;gy=Qy.allocate(gy,o,{type:Float32Array,size:r*2});let c=n,s=0;for(;c<i;){for(let m=0;m<r;m++){const v=t[c++];gy[s+m]=v,gy[s+m+r]=$H(v)}s+=r*2}return gy.subarray(0,o*r*2)}function VH(t){let e=null,r=!1;for(const n of t)n&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const qH=Math.PI/180,HH=Ry(),_R=[0,0,0],WH={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function ZH({width:t,height:e,orthographic:r,fovyRadians:n,focalDistance:i,padding:o,near:c,far:s}){const m=t/e,v=r?new ku().orthographic({fovy:n,aspect:m,focalDistance:i,near:c,far:s}):new ku().perspective({fovy:n,aspect:m,near:c,far:s});if(o){const{left:w=0,right:M=0,top:I=0,bottom:k=0}=o,z=ud((w+t-M)/2,0,t)-t/2,V=ud((I+e-k)/2,0,e)-e/2;v[8]-=z*2/t,v[9]+=V*2/e}return v}class Vv{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||WH,this.focalDistance=e.focalDistance||1,this.position=e.position||_R,this.modelMatrix=e.modelMatrix||null;const{longitude:r,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?zl.WEB_MERCATOR:zl.WEB_MERCATOR_AUTO_OFFSET:zl.IDENTITY}equals(e){return e instanceof Vv?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ky(e.projectionMatrix,this.projectionMatrix)&&Ky(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){const n=this.projectPosition(e),i=TF(n,this.pixelProjectionMatrix),[o,c]=i,s=r?c:this.height-c;return e.length===2?[o,s]:[o,s,i[2]]}unproject(e,{topLeft:r=!0,targetZ:n}={}){const[i,o,c]=e,s=r?o:this.height-o,m=n&&n*this.distanceScales.unitsPerMeter[2],v=yP([i,s,c],this.pixelUnprojectionMatrix,m),[w,M,I]=this.unprojectPosition(v);return Number.isFinite(c)?[w,M,I]:Number.isFinite(n)?[w,M,n]:[w,M]}projectPosition(e){const[r,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,i]}unprojectPosition(e){const[r,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,i]}projectFlat(e){if(this.isGeospatial){const r=q0(e);return r[1]=ud(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?Ug(e):e}getBounds(e={}){const r={targetZ:e.z||0},n=this.unproject([0,0],r),i=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),c=this.unproject([this.width,this.height],r);return[Math.min(n[0],i[0],o[0],c[0]),Math.min(n[1],i[1],o[1],c[1]),Math.max(n[0],i[0],o[0],c[0]),Math.max(n[1],i[1],o[1],c[1])]}getDistanceScales(e){return e&&this.isGeospatial?gE({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&r<this.y+this.height&&this.y<r+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,UH(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){const r=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=rH({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||gE({latitude:n,longitude:r}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:o,modelMatrix:c}=e;let s=_R;if(o&&(s=c?new ku(c).transformAsVector(o,[]):o),this.isGeospatial){const m=this.projectPosition([r,n,0]);this.center=new Ou(s).scale(this.distanceScales.unitsPerMeter).add(m)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:r=HH,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:o,fovy:c=75,near:s=.1,far:m=1e3,padding:v=null,focalDistance:w=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new ku().multiplyRight(r).translate(new Ou(this.center).negate()),this.projectionMatrix=n||ZH({width:this.width,height:this.height,orthographic:i,fovyRadians:o||c*qH,focalDistance:w,padding:v,near:s,far:m});const M=Ry();zp(M,M,this.projectionMatrix),zp(M,M,this.viewMatrix),this.viewProjectionMatrix=M,this.viewMatrixInverse=oE([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=jH(this.viewMatrixInverse);const I=Ry(),k=Ry();mP(I,I,[this.width/2,-this.height/2,1]),U0(I,I,[1,-1,0]),zp(k,I,this.viewProjectionMatrix),this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=oE(Ry(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||oi.warn("Pixel project matrix not invertible")()}}Vv.displayName="Viewport";class $g extends Vv{constructor(e={}){const{latitude:r=0,longitude:n=0,zoom:i=0,pitch:o=0,bearing:c=0,nearZMultiplier:s=.1,farZMultiplier:m=1.01,nearZ:v,farZ:w,orthographic:M=!1,projectionMatrix:I,repeat:k=!1,worldOffset:z=0,position:V,padding:U,legacyMeterSizes:K=!1}=e;let{width:J,height:Z,altitude:re=1.5}=e;const W=Math.pow(2,i);J=J||1,Z=Z||1;let Y,ue=null;if(I)re=I[5]/2,Y=H0(re);else{e.fovy?(Y=e.fovy,re=wF(Y)):Y=H0(re);let Ce;if(U){const{top:Ye=0,bottom:Me=0}=U;Ce=[0,ud((Ye+Z-Me)/2,0,Z)-Z/2]}ue=iH({width:J,height:Z,scale:W,center:V&&[0,0,V[2]*Iw(r)],offset:Ce,pitch:o,fovy:Y,nearZMultiplier:s,farZMultiplier:m}),Number.isFinite(v)&&(ue.near=v),Number.isFinite(w)&&(ue.far=w)}let be=nH({height:Z,pitch:o,bearing:c,scale:W,altitude:re});z&&(be=new ku().translate([512*z,0,0]).multiplyLeft(be)),super({...e,width:J,height:Z,viewMatrix:be,longitude:n,latitude:r,zoom:i,...ue,fovy:Y,focalDistance:re}),this.latitude=r,this.longitude=n,this.zoom=i,this.pitch=o,this.bearing=c,this.altitude=re,this.fovy=Y,this.orthographic=M,this._subViewports=k?[]:null,this._pseudoMeters=K,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),r=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=r;i<=n;i++){const o=i?new $g({...this,worldOffset:i}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[r,n]=this.projectFlat(e),i=(e[2]||0)*Iw(e[1]);return[r,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[r,n]=this.unprojectFlat(e),i=(e[2]||0)/Iw(n);return[r,n,i]}addMetersToLngLat(e,r){return xF(e,r)}panByPosition(e,r){const n=yP(r,this.pixelUnprojectionMatrix),i=this.projectFlat(e),o=UC([],i,zq([],n)),c=UC([],this.center,o),[s,m]=this.unprojectFlat(c);return{longitude:s,latitude:m}}getBounds(e={}){const r=oH(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){const{width:n,height:i}=this,{longitude:o,latitude:c,zoom:s}=aH({width:n,height:i,bounds:e,...r});return new $g({width:n,height:i,longitude:o,latitude:c,zoom:s})}}$g.displayName="WebMercatorViewport";const yR=[0,0,0];function kw(t,e,r=!1){const n=e.projectPosition(t);if(r&&e instanceof $g){const[i,o,c=0]=t,s=e.getDistanceScales([i,o]);n[2]=c*s.unitsPerMeter[2]}return n}function XH(t){const{viewport:e,modelMatrix:r,coordinateOrigin:n}=t;let{coordinateSystem:i,fromCoordinateSystem:o,fromCoordinateOrigin:c}=t;return i===An.DEFAULT&&(i=e.isGeospatial?An.LNGLAT:An.CARTESIAN),o===void 0&&(o=i),c===void 0&&(c=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:c}}function MF(t,{viewport:e,modelMatrix:r,coordinateSystem:n,coordinateOrigin:i,offsetMode:o}){let[c,s,m=0]=t;switch(r&&([c,s,m]=Uv([],[c,s,m,1],r)),n){case An.LNGLAT:return kw([c,s,m],e,o);case An.LNGLAT_OFFSETS:return kw([c+i[0],s+i[1],m+(i[2]||0)],e,o);case An.METER_OFFSETS:return kw(xF(i,[c,s,m]),e,o);case An.CARTESIAN:default:return e.isGeospatial?[c+i[0],s+i[1],m+i[2]]:e.projectPosition([c,s,m])}}function GH(t,e){const{viewport:r,coordinateSystem:n,coordinateOrigin:i,modelMatrix:o,fromCoordinateSystem:c,fromCoordinateOrigin:s}=XH(e),{autoOffset:m=!0}=e,{geospatialOrigin:v=yR,shaderCoordinateOrigin:w=yR,offsetMode:M=!1}=m?vF(r,n,i):{},I=MF(t,{viewport:r,modelMatrix:o,coordinateSystem:c,coordinateOrigin:s,offsetMode:M});if(M){const k=r.projectPosition(v||w);e9(I,I,k)}return I}let YH=1,KH=1;class PF{constructor(){de(this,"time",0);de(this,"channels",new Map);de(this,"animations",new Map);de(this,"playing",!1);de(this,"lastEngineTime",-1)}addChannel(e){const{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:o=1}=e,c=YH++,s={time:0,delay:r,duration:n,rate:i,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(c,s),c}removeChannel(e){this.channels.delete(e);for(const[r,n]of this.animations)n.channel===e&&this.detachAnimation(r)}isFinished(e){const r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;const r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);const r=this.channels.values();for(const i of r)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:o,channel:c}=i;o.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){const n=KH++;return this.animations.set(n,{animation:e,channel:r}),e.setTime(this.getTime(r)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){const n=r-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function QH(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function JH(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let eW=0;const tW={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:KA.stats.get(`animation-loop-${eW++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class rW{constructor(e){de(this,"device",null);de(this,"canvas",null);de(this,"props");de(this,"animationProps",null);de(this,"timeline",null);de(this,"stats");de(this,"cpuTime");de(this,"gpuTime");de(this,"frameRate");de(this,"display");de(this,"needsRedraw","initialized");de(this,"_initialized",!1);de(this,"_running",!1);de(this,"_animationFrameId",null);de(this,"_nextFramePromise",null);de(this,"_resolveNextFrame",null);de(this,"_cpuStartTime",0);de(this,"_error",null);if(this.props={...tW,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new l1({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var n,i;if(this.props.onError(e),this._error=Error(),((i=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const o=document.createElement("h1");o.innerHTML=e.message,o.style.position="absolute",o.style.top="20%",o.style.left="10px",o.style.color="black",o.style.backgroundColor="red",document.body.appendChild(o)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=QH(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(JH(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var r;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(r=this.device)==null||r.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var r,n;const e=(n=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:n.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:r,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);const n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){var o,c,s,m;if(!this.device)return{width:1,height:1,aspect:1};const[e,r]=((c=(o=this.device)==null?void 0:o.canvasContext)==null?void 0:c.getPixelSize())||[1,1];let n=1;const i=(m=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:m.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&r>0&&(n=e/r),{width:e,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,r;this.props.autoResizeDrawingBuffer&&((r=(e=this.device)==null?void 0:e.canvasContext)==null||r.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Dw={};function f1(t="id"){Dw[t]=Dw[t]||1;const e=Dw[t]++;return`${t}-${e}`}class vR{constructor(e){de(this,"id");de(this,"userData",{});de(this,"topology");de(this,"bufferLayout",[]);de(this,"vertexCount");de(this,"indices");de(this,"attributes");if(this.id=e.id||f1("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Ti.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const r of Object.values(this.attributes))r.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function nW(t,e){if(e instanceof vR)return e;const r=iW(t,e),{attributes:n,bufferLayout:i}=aW(t,e);return new vR({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:r,attributes:n})}function iW(t,e){if(!e.indices)return;const r=e.indices.value;return t.createBuffer({usage:Ti.INDEX,data:r})}function aW(t,e){const r=[],n={};for(const[o,c]of Object.entries(e.attributes)){let s=o;switch(o){case"POSITION":s="positions";break;case"NORMAL":s="normals";break;case"TEXCOORD_0":s="texCoords";break;case"COLOR_0":s="colors";break}if(c){n[s]=t.createBuffer({data:c.value,id:`${o}-buffer`});const{value:m,size:v,normalized:w}=c;r.push({name:s,format:JV(m,v,w)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:r,vertexCount:i}}const i1=class i1{constructor(e){de(this,"device");de(this,"destroyPolicy");de(this,"_hashCounter",0);de(this,"_hashes",{});de(this,"_renderPipelineCache",{});de(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new i1(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const r={...Ng.defaultProps,...e},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){const i=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._renderPipelineCache[n]={pipeline:i,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const r={...k0.defaultProps,...e},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){const i=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});i.hash=n,this._computePipelineCache[n]={pipeline:i,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const r=e.hash,n=e instanceof k0?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&this.destroyPolicy==="unused"&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const r=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${i}BL${o}`;default:const c=this._getHash(JSON.stringify(e.parameters));return`${r}/${n}V${i}T${e.topology}P${c}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};de(i1,"defaultProps",{...Ng.defaultProps});let _E=i1;const a1=class a1{constructor(e){de(this,"device");de(this,"destroyPolicy");de(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var r;return(r=e._lumaData).defaultShaderFactory||(r.defaultShaderFactory=new a1(e)),e._lumaData.defaultShaderFactory}createShader(e){const r=this._hashShader(e);let n=this._cache[r];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const r=this._hashShader(e),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};de(a1,"defaultProps",{...R0.defaultProps});let yE=a1;function sW(t,e){var i;const r={},n="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[n]:"N/A"}};for(const o of t.attributes)if(o){const c=`${o.location} ${o.name}: ${o.type}`;r[`in ${c}`]={[n]:o.stepMode||"vertex"}}for(const o of t.varyings||[]){const c=`${o.location} ${o.name}`;r[`out ${c}`]={[n]:JSON.stringify(o)}}return r}let Qa=null,Ep=null;function oW(t,{id:e,minimap:r,opaque:n,top:i="0",left:o="0",rgbaScale:c=1}){Qa||(Qa=document.createElement("canvas"),Qa.id=e,Qa.title=e,Qa.style.zIndex="100",Qa.style.position="absolute",Qa.style.top=i,Qa.style.left=o,Qa.style.border="blue 5px solid",Qa.style.transform="scaleY(-1)",document.body.appendChild(Qa),Ep=Qa.getContext("2d")),(Qa.width!==t.width||Qa.height!==t.height)&&(Qa.width=t.width/2,Qa.height=t.height/2,Qa.style.width="400px",Qa.style.height="400px");const s=t.device.readPixelsToArrayWebGL(t),m=Ep==null?void 0:Ep.createImageData(t.width,t.height);if(m){for(let w=0;w<s.length;w+=4)m.data[0+w+0]=s[w+0]*c,m.data[0+w+1]=s[w+1]*c,m.data[0+w+2]=s[w+2]*c,m.data[0+w+3]=n?255:s[w+3]*c;Ep==null||Ep.putImageData(m,0,0)}}function vE(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!vE(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!vE(t[o],e[o],r-1))return!1;return!0}return!1}function lW(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function cW(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function CF(t){return lW(t)||cW(t)}function uW(t){return CF(t)||typeof t=="number"||typeof t=="boolean"}function RF(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];uW(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}class hW{constructor(e,r){de(this,"options",{disableWarnings:!1});de(this,"modules");de(this,"moduleUniforms");de(this,"moduleBindings");Object.assign(this.options,r);const n=aP(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Qt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,o]of Object.entries(e))this._addModule(o),o.name&&i!==o.name&&!this.options.disableWarnings&&Qt.warn(`Module name: ${i} vs ${o.name}`)()}destroy(){}setProps(e){var r;for(const n of Object.keys(e)){const i=n,o=e[i]||{},c=this.modules[i];if(!c){this.options.disableWarnings||Qt.warn(`Module ${n} not found`)();continue}const s=this.moduleUniforms[i],m=this.moduleBindings[i],v=((r=c.getUniforms)==null?void 0:r.call(c,o,s))||o,{uniforms:w,bindings:M}=RF(v);this.moduleUniforms[i]={...s,...w},this.moduleBindings[i]={...m,...M}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){var r;const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[o,c]of Object.entries(i))e[`${n}.${o}`]={type:(r=this.modules[n].uniformTypes)==null?void 0:r[o],value:String(c)};return e}_addModule(e){const r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}}let fW="";async function dW(t,e){const r=new Image;return r.crossOrigin="anonymous",r.src=t.startsWith("http")?t:fW+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}class Nw{constructor(e,r){de(this,"device");de(this,"id");de(this,"texture");de(this,"sampler");de(this,"view");de(this,"ready");de(this,"isReady",!1);de(this,"destroyed",!1);de(this,"resolveReady",()=>{});de(this,"rejectReady",()=>{});this.device=e,this.id=r.id||f1("async-texture"),typeof(r==null?void 0:r.data)=="string"&&r.dimension==="2d"&&(r={...r,data:dW(r.data)}),this.ready=new Promise((n,i)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=i}),this.initAsync(r)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const r=e.data;let n;try{n=await IF(r)}catch(o){this.rejectReady(o)}if(this.destroyed)return;const i={...e,data:n};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}}async function IF(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(IF));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,r=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let o=0;o<n.length;o++)i[n[o]]=r[o];return i}return t}const Mp=2,pW=1e4,s1=class s1{constructor(e,r){de(this,"device");de(this,"id");de(this,"source");de(this,"vs");de(this,"fs");de(this,"pipelineFactory");de(this,"shaderFactory");de(this,"userData",{});de(this,"parameters");de(this,"topology");de(this,"bufferLayout");de(this,"isInstanced");de(this,"instanceCount",0);de(this,"vertexCount");de(this,"indexBuffer",null);de(this,"bufferAttributes",{});de(this,"constantAttributes",{});de(this,"bindings",{});de(this,"uniforms",{});de(this,"vertexArray");de(this,"transformFeedback",null);de(this,"pipeline");de(this,"shaderInputs");de(this,"_uniformStore");de(this,"_attributeInfos",{});de(this,"_gpuGeometry",null);de(this,"_getModuleUniforms");de(this,"props");de(this,"_pipelineNeedsUpdate","newly created");de(this,"_needsRedraw","initializing");de(this,"_destroyed",!1);de(this,"_lastDrawTimestamp",-1);de(this,"_lastLogTime",0);de(this,"_logOpen",!1);de(this,"_drawCount",0);var m,v,w,M;this.props={...s1.defaultProps,...r},r=this.props,this.id=r.id||f1("model"),this.device=e,Object.assign(this.userData,r.userData);const n=Object.fromEntries(((m=this.props.modules)==null?void 0:m.map(I=>[I.name,I]))||[]),i=r.shaderInputs||new hW(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const o=gW(e),c=(((v=this.props.modules)==null?void 0:v.length)>0?this.props.modules:(w=this.shaderInputs)==null?void 0:w.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:I,getUniforms:k}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:c});this.source=I,this._getModuleUniforms=k,(M=this.props).shaderLayout||(M.shaderLayout=Cq(this.source))}else{const{vs:I,fs:k,getUniforms:z}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:c});this.vs=I,this.fs=k,this._getModuleUniforms=z}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||_E.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||yE.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const r=this._areBindingsLoading();if(r)return Qt.info(Mp,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),bE(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:o}=this.vertexArray,c=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:c,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var n;(n=this._gpuGeometry)==null||n.destroy();const r=e&&nW(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");const i=new xw(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const r=new xw(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){vE(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new QV(this.shaderInputs.modules);for(const[r,n]of Object.entries(this.shaderInputs.modules))if(mW(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){const n=(r==null?void 0:r.disableWarnings)??this.props.disableWarnings;e.indices&&Qt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=eq(this.pipeline.shaderLayout,this.bufferLayout);const i=new xw(this.bufferLayout);for(const[o,c]of Object.entries(e)){const s=i.getBufferLayout(o);if(!s){n||Qt.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const m=i.getAttributeNamesForBuffer(s);let v=!1;for(const w of m){const M=this._attributeInfos[w];if(M){const I=this.device.type==="webgpu"?i.getBufferIndex(M.bufferName):M.location;this.vertexArray.setBuffer(I,c),v=!0}}!v&&!n&&Qt.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(const[n,i]of Object.entries(e)){const o=this._attributeInfos[n];o?this.vertexArray.setConstantWebGL(o.location,i):((r==null?void 0:r.disableWarnings)??this.props.disableWarnings)||Qt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){bE(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:r,uniforms:n}=RF(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Nw&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[r,n]of Object.entries(this.bindings))n instanceof Nw?n.isReady&&(e[r]=n.texture):e[r]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const r of Object.values(this.bindings))r instanceof C0?e=Math.max(e,r.texture.updateTimestamp):r instanceof Ti||r instanceof Hi?e=Math.max(e,r.updateTimestamp):r instanceof Nw?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof I0||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const r={...e.attributes};for(const[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Qt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=IL(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_logDrawCallStart(){const e=Qt.level>3?0:pW;Qt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Qt.group(Mp,`>>> DRAWING MODEL ${this.id}`,{collapsed:Qt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=sW(this.pipeline.shaderLayout,this.id);Qt.table(Mp,e)();const r=this.shaderInputs.getDebugTable();for(const[i,o]of Object.entries(this.uniforms))r[i]={value:o};Qt.table(Mp,r)();const n=this._getAttributeDebugTable();Qt.table(Mp,this._attributeInfos)(),Qt.table(Mp,n)(),Qt.groupEnd(Mp)(),this._logOpen=!1}}_logFramebuffer(e){const r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;const n=e.props.framebuffer;n&&oW(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[r,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:r,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,r){const n=DL(r);return(e instanceof Ti?new n(e.debugData):e).toString()}};de(s1,"defaultProps",{...Ng.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:P0.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Jy=s1;function mW(t){return!!(t.uniformTypes&&!bE(t.uniformTypes))}function gW(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function bE(t){for(const e in t)return!1;return!0}const Gy=class Gy{constructor(e,r=Gy.defaultProps){de(this,"device");de(this,"model");de(this,"transformFeedback");if(!Gy.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Jy(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||tV(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var r;return((r=e==null?void 0:e.info)==null?void 0:r.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof Ti)return r.readAsync();const{buffer:n,byteOffset:i=0,byteLength:o=n.byteLength}=r;return n.readAsync(i,o)}};de(Gy,"defaultProps",{...Jy.defaultProps,outputs:void 0,feedbackBuffers:void 0});let ev=Gy;class _W{constructor(e){de(this,"id");de(this,"topology");de(this,"vertexCount");de(this,"indices");de(this,"attributes");de(this,"userData",{});const{attributes:r={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||f1("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[o,c]of Object.entries(r)){const s=ArrayBuffer.isView(c)?{value:c}:c;if(!ArrayBuffer.isView(s.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!s.size&&(s.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=s}else this.attributes[o]=s}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let n=1/0;for(const i of Object.values(e)){const{value:o,size:c,constant:s}=i;!s&&o&&c!==void 0&&c>=1&&(n=Math.min(n,o.length/c))}return n}}const yW={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class OF extends vP{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:o,pickingFBO:c,deviceRect:{x:s,y:m,width:v,height:w},cullRect:M,effects:I,pass:k="picking",pickZ:z,shaderModuleProps:V}){this.pickZ=z;const U=this._resetColorEncoder(z),K=[s,m,v,w],J=super.render({target:c,layers:e,layerFilter:r,views:n,viewports:i,onViewportActive:o,cullRect:M,effects:I==null?void 0:I.filter(re=>re.useInPicking),pass:k,isPicking:!0,shaderModuleProps:V,clearColor:[0,0,0,0],colorMask:15,scissorRect:K});return this._colorEncoderState=null,{decodePickingColor:U&&bW.bind(null,U),stats:J}}shouldDrawLayer(e){const{pickable:r,operation:n}=e.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,n){const i={...e.props.parameters},{pickable:o,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?i.blend=!1:o&&c.includes("draw")&&(Object.assign(i,yW),i.blend=!0,i.blendColor=vW(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function vW(t,e,r){const{byLayer:n,byAlpha:i}=t;let o,c=n.get(e);return c?(c.viewports.push(r),o=c.a):(o=n.size+1,o<=255?(c={a:o,layer:e,viewports:[r]},n.set(e,c),i[o]=c):(oi.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function bW(t,e){const r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}const vg={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},W0=Symbol.for("component"),jp=Symbol.for("propTypes"),Bw=Symbol.for("deprecatedProps"),Rg=Symbol.for("asyncPropDefaults"),Zp=Symbol.for("asyncPropOriginal"),hd=Symbol.for("asyncPropResolved");function kF(t,e=()=>!0){return Array.isArray(t)?DF(t,e,[]):e(t)?[t]:[]}function DF(t,e,r){let n=-1;for(;++n<t.length;){const i=t[n];Array.isArray(i)?DF(i,e,r):e(i)&&r.push(i)}return r}function xW({target:t,source:e,start:r=0,count:n=1}){const i=e.length,o=n*i;let c=0;for(let s=r;c<i;c++)t[s++]=e[c];for(;c<o;)c<o-c?(t.copyWithin(r+c,r,r+c),c*=2):(t.copyWithin(r+c,r,r+o-c),c=o);return t}class wW{constructor(e,r,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=qA(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===n&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class TW{constructor(e){var r;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(r=e.device)==null?void 0:r.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:n=!1,persistent:i=!0}){let o=this._resources[e];o?o.setData(r,n):(o=new wW(e,r,this._context),this._resources[e]=o),o.persistent=i}remove(e){const r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const r=this._consumers[e];if(r){for(const n in r){const i=r[n],o=this._resources[i.resourceId];o&&o.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:n,requestId:i="default"}){const{_resources:o,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const s=o[e];if(this._track(n,i,s,r),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,r,n,i){const o=this._consumers,c=o[e]=o[e]||{};let s=c[r];const m=s&&s.resourceId&&this._resources[s.resourceId];m&&(m.unsubscribe(s),this.prune()),n&&(s?(s.onChange=i,s.resourceId=n.id):s={onChange:i,resourceId:n.id},c[r]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}}const SW="layerManager.setLayers",AW="layerManager.activateViewport";class EW{constructor(e,r){var s;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=m=>{Xs(AW,this,m),m&&(this.context.viewport=m)};const{deck:n,stats:i,viewport:o,timeline:c}=r||{};this.layers=[],this.resourceManager=new TW({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:n,shaderAssembler:AH(((s=e==null?void 0:e.info)==null?void 0:s.shadingLanguage)||"glsl"),defaultShaderModules:[k9],renderPass:void 0,stats:i||new l1({id:"deck.gl"}),viewport:o||new Vv({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new PF,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);r=r||i}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){Xs(SW,this,r,e),this._lastRenderedLayers=e;const n=kF(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:r}=this.context;r.find(n=>n.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:r}=this.context,n=r.findIndex(i=>i.name===e.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,n){n.raiseError(r,`${e} of ${n}`)}_updateLayers(e,r){const n={};for(const c of e)n[c.id]?oi.warn(`Multiple old layers with same id ${c.id}`)():n[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(r,n,i),this._finalizeOldLayers(n);let o=!1;for(const c of i)if(c.hasUniformTransition()){o=`Uniform transition in ${c}`;break}this._needsUpdate=o,this.layers=i}_updateSublayersRecursively(e,r,n){for(const i of e){i.context=this.context;const o=r[i.id];o===null&&oi.warn(`Multiple new layers with same id ${i.id}`)(),r[i.id]=null;let c=null;try{this._debug&&o!==i&&i.validateProps(),o?(this._transferLayerState(o,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),c=i.isComposite?i.getSubLayers():null}catch(s){this._handleError("matching",s,i)}c&&this._updateSublayersRecursively(c,r,n)}}_finalizeOldLayers(e){for(const r in e){const n=e[r];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=vg.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=vg.MATCHED,r!==e&&(e.lifecycle=vg.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=vg.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=vg.FINALIZED}catch(r){this._handleError("finalization",r,e)}}}function qc(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!qc(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!qc(t[o],e[o],r-1))return!1;return!0}return!1}class MW{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){const r=typeof e=="string"?this.getView(e):e,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,r){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let o=n.length-1;o>=0;--o){const c=n[o];if(c.containsPixel(i)){const s=e.slice();return s[0]-=c.x,s[1]-=c.y,c.unproject(s,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=kF(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!qc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):oi.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){const n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var c;return(c=this.getView(e.id))==null?void 0:c.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,r,n,i){const o=e.controller;if(o&&n){const c={...r,...o,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==o.type)&&(i=this._createController(e,c)),i&&i.setProps(c),i}return null}_rebuildViewports(){const{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const o=e[i],c=this.getViewState(o),s=o.makeViewport({viewState:c,width:this.width,height:this.height});let m=r[o.id];const v=!!o.controller;v&&!m&&(n=!0),(n||!v)&&m&&(m.finalize(),m=null),this.controllers[o.id]=this._updateController(o,c,s,m),s&&this._viewports.unshift(s)}for(const i in r){const o=r[i];o&&!this.controllers[i]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((n,i)=>!e[i].equals(r[i]))}}const PW=/([0-9]+\.?[0-9]*)(%|px)/;function ed(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=PW.exec(t);if(e&&e.length>=3){const r=e[2]==="%",n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function td(t,e){return t.relative?Math.round(t.position*e):t.position}class Vg{constructor(e){const{id:r,x:n=0,y:i=0,width:o="100%",height:c="100%",padding:s=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ed(n),this._y=ed(i),this._width=ed(o),this._height=ed(c),this._padding=s&&{left:ed(s.left||0),right:ed(s.right||0),top:ed(s.top||0),bottom:ed(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&qc(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:r});if(!i.height||!i.width)return null;const o=this.getViewportType(n);return new o({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const r={...e};for(const n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return e}getDimensions({width:e,height:r}){const n={x:td(this._x,e),y:td(this._y,r),width:td(this._width,e),height:td(this._height,r)};return this._padding&&(n.padding={left:td(this._padding.left,e),top:td(this._padding.top,r),right:td(this._padding.right,e),bottom:td(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class d1{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var r,n;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)==null||n.call(r,this)}end(){var e,r;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(r=(e=this.settings).onEnd)==null||r.call(e,this))}cancel(){var e,r;this._inProgress&&((r=(e=this.settings).onInterrupt)==null||r.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,r;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:n,settings:i}=this;this._handle=n.addChannel({delay:n.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(r=(e=this.settings).onUpdate)==null||r.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const bR=()=>{},xE={BREAK:1,SNAP_TO_END:2,IGNORE:3},CW=t=>t,RW=xE.BREAK;class IW{constructor(e){this._onTransitionUpdate=r=>{const{time:n,settings:{interpolator:i,startProps:o,endProps:c,duration:s,easing:m}}=r,v=m(n/s),w=i.interpolateProps(o,c,v);this.propsInTransition=this.getControllerState({...this.props,...w}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new d1(e.timeline),this.onViewStateChange=e.onViewStateChange||bR,this.onStateChange=e.onStateChange||bR}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:o,endProps:c}=this.transition.settings;i={...n,...o===xE.SNAP_TO_END?c:this.propsInTransition||n}}this._triggerTransition(i,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:r,transitionInterpolator:n}=e;return(r>0||r==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===xE.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){const n=this.getControllerState(e),i=this.getControllerState(r).shortestPathFrom(n),o=r.transitionInterpolator,c=o.getDuration?o.getDuration(e,r):r.transitionDuration;if(c===0)return;const s=o.initializeProps(e,i);this.propsInTransition={};const m={duration:c,easing:r.transitionEasing||CW,interpolator:o,interruption:r.transitionInterruption||RW,startProps:s.start,endProps:s.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(m),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(r)}}}function Cs(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class OW{constructor(e){const{compare:r,extract:n,required:i}=e;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=i}arePropsEqual(e,r){for(const n of this._propsToCompare)if(!(n in e)||!(n in r)||!Ky(e[n],r[n]))return!1;return!0}initializeProps(e,r){const n={},i={};for(const o of this._propsToExtract)(o in e||o in r)&&(n[o]=e[o],i[o]=r[o]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{const n=e[r];Cs(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}}const kW=["longitude","latitude","zoom","bearing","pitch"],DW=["longitude","latitude","zoom"];class NF extends OW{constructor(e={}){const r=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:kW,required:DW},super(n.transitionProps),this.opts=n}initializeProps(e,r){const n=super.initializeProps(e,r),{makeViewport:i,around:o}=this.opts;if(i&&o){const c=i(e),s=i(r),m=c.unproject(o);n.start.around=o,Object.assign(n.end,{around:s.project(m),aroundPosition:m,width:r.width,height:r.height})}return n}interpolateProps(e,r,n){const i={};for(const o of this._propsToExtract)i[o]=j0(e[o]||0,r[o]||0,n);if(r.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...r,...i});Object.assign(i,o.panByPosition(r.aroundPosition,j0(e.around,r.around,n)))}return i}}const rd={transitionDuration:0},NW=300,Qb=t=>1-(1-t)*(1-t),pg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Pp={};class BW{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new IW({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const r in this._events)this._events[r]&&((e=this.eventManager)==null||e.off(r,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:r,y:n}=this.props,{offsetCenter:i}=e;return[i.x-r,i.y-n]}isPointInBounds(e,r){const{width:n,height:i}=this.props;if(r&&r.handled)return!1;const o=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?NW:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:o=!0,doubleClickZoom:c=!0,touchZoom:s=!0,touchRotate:m=!1,keyboard:v=!0}=e,w=!!this.onViewStateChange;this.toggleEvents(pg.WHEEL,w&&n),this.toggleEvents(pg.PAN,w),this.toggleEvents(pg.PINCH,w&&(s||m)),this.toggleEvents(pg.MULTI_PAN,w&&m),this.toggleEvents(pg.DOUBLE_CLICK,w&&c),this.toggleEvents(pg.KEYBOARD,w&&v),this.scrollZoom=n,this.dragPan=i,this.dragRotate=o,this.doubleClickZoom=c,this.touchZoom=s,this.touchRotate=m,this.keyboard=v}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,r=null,n={}){const i={...e.getViewportProps(),...r},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),o){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(i,rd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const r=this.getCenter(e),n=this.controllerState.pan({pos:r});return this.updateViewport(n,rd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:r}=this;if(this.dragPan&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],o=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Qb},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const r=this.getCenter(e),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,rd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*r/2,n[1]+e.velocityY*r/2],o=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Qb},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let c=2/(1+Math.exp(-Math.abs(o*n)));o<0&&c!==0&&(c=1/c);const s=this.controllerState.zoom({pos:r,scale:c});return this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,rd,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const r=this.getCenter(e);r[0]-=e.deltaX;const n=this.controllerState.rotate({pos:r});return this.updateViewport(n,rd,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*r/2],o=this.controllerState.rotate({pos:i});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Qb},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Pp._startPinchRotation=e.rotation,Pp._lastPinchEvent=e,this.updateViewport(n,rd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);r=r.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;r=r.rotate({deltaAngleX:Pp._startPinchRotation-n})}return this.updateViewport(r,rd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Pp._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:r}=this,{_lastPinchEvent:n}=Pp;if(this.touchZoom&&r&&n&&e.scale!==n.scale){const i=this.getCenter(e);let o=this.controllerState.rotateEnd();const c=Math.log2(e.scale),s=(c-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),m=Math.pow(2,c+s*r/2);o=o.zoom({pos:i,scale:m}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:i}),transitionDuration:r,transitionEasing:Qb},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Pp._startPinchRotation=null,Pp._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const r=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:o,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let m;const v={};switch(e.srcEvent.code){case"Minus":m=r?s.zoomOut(n).zoomOut(n):s.zoomOut(n),v.isZooming=!0;break;case"Equal":m=r?s.zoomIn(n).zoomIn(n):s.zoomIn(n),v.isZooming=!0;break;case"ArrowLeft":r?(m=s.rotateLeft(o),v.isRotating=!0):(m=s.moveLeft(i),v.isPanning=!0);break;case"ArrowRight":r?(m=s.rotateRight(o),v.isRotating=!0):(m=s.moveRight(i),v.isPanning=!0);break;case"ArrowUp":r?(m=s.rotateUp(c),v.isRotating=!0):(m=s.moveUp(i),v.isPanning=!0);break;case"ArrowDown":r?(m=s.rotateDown(c),v.isRotating=!0):(m=s.moveDown(i),v.isPanning=!0);break;default:return!1}return this.updateViewport(m,this._getTransitionProps(),v),!0}_getTransitionProps(e){const{transition:r}=this;return!r||!r.transitionInterpolator?rd:e?{...r,transitionInterpolator:new NF({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}}class LW{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}}const xR=5,FW=1.2;class zW extends LW{constructor(e){const{width:r,height:n,latitude:i,longitude:o,zoom:c,bearing:s=0,pitch:m=0,altitude:v=1.5,position:w=[0,0,0],maxZoom:M=20,minZoom:I=0,maxPitch:k=60,minPitch:z=0,startPanLngLat:V,startZoomLngLat:U,startRotatePos:K,startBearing:J,startPitch:Z,startZoom:re,normalize:W=!0}=e;Cs(Number.isFinite(o)),Cs(Number.isFinite(i)),Cs(Number.isFinite(c)),super({width:r,height:n,latitude:i,longitude:o,zoom:c,bearing:s,pitch:m,altitude:v,maxZoom:M,minZoom:I,maxPitch:k,minPitch:z,normalize:W,position:w},{startPanLngLat:V,startZoomLngLat:U,startRotatePos:K,startBearing:J,startPitch:Z,startZoom:re}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:o,startPitch:c}=this.getState();if(!i||o===void 0||c===void 0)return this;let s;return e?s=this._getNewRotation(e,i,c,o):s={bearing:o+r,pitch:c+n},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:n}){let{startZoom:i,startZoomLngLat:o}=this.getState();if(o||(i=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(e)),!o)return this;const{maxZoom:c,minZoom:s}=this.getViewportProps();let m=i+Math.log2(n);m=ud(m,s,c);const v=this.makeViewport({...this.getViewportProps(),zoom:m});return this._getUpdatedState({zoom:m,...v.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const r=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:o}=n;return Math.abs(i-r.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(o-r.longitude)>180&&(n.longitude=o<0?o+360:o-360),n}applyConstraints(e){const{maxZoom:r,minZoom:n,zoom:i}=e;e.zoom=ud(i,n,r);const{maxPitch:o,minPitch:c,pitch:s}=e;e.pitch=ud(s,c,o);const{normalize:m=!0}=e;return m&&Object.assign(e,lH(e)),e}_zoomFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:e})}_panFromCenter(e){const{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,n,i){const o=e[0]-r[0],c=e[1]-r[1],s=e[1],m=r[1],{width:v,height:w}=this.getViewportProps(),M=o/v;let I=0;c>0?Math.abs(w-m)>xR&&(I=c/(m-w)*FW):c<0&&m>xR&&(I=1-s/m),I=ud(I,-1,1);const{minPitch:k,maxPitch:z}=this.getViewportProps(),V=i+180*M;let U=n;return I>0?U=n+I*(z-n):I<0&&(U=n-I*(k-n)),{pitch:U,bearing:V}}}class jW extends BW{constructor(){super(...arguments),this.ControllerState=zW,this.transition={transitionDuration:300,transitionInterpolator:new NF({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class BF extends Vg{constructor(e={}){super(e)}getViewportType(){return $g}get ControllerType(){return jW}}BF.displayName="MapView";const UW=new EF;function $W(t,e){const r=t.order??1/0,n=e.order??1/0;return r-n}class VW{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const r=this._defaultEffects;if(!r.find(n=>n.id===e.id)){const n=r.findIndex(i=>$W(i,e)>0);n<0?r.push(e):r.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(qc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){const r={};for(const i of this.effects)r[i.id]=i;const n=[];for(const i of e){const o=r[i.id];let c=i;o&&o!==i?o.setProps?(o.setProps(i.props),c=o):o.cleanup(this._context):o||i.setup(this._context),n.push(c),delete r[i.id]}for(const i in r)r[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof EF)||this._resolvedEffects.push(UW),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class qW extends vP{shouldDrawLayer(e){const{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}}const HW="deckRenderer.renderLayers";class WW{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new qW(e),this.pickLayersPass=new OF(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const o=r.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,Xs(HW,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){const{renderBuffers:e}=this;for(const r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(const n of e)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(n=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[i]}))});for(const n of e)n.resize(r)}_postRender(e,r){const{renderBuffers:n}=this,i={...r,inputBuffer:n[0],swapBuffer:n[1]};for(const o of e)if(o.postRender){i.target=o.id===this.lastPostProcessEffect?r.target:void 0;const c=o.postRender(i);i.inputBuffer=c,i.swapBuffer=c===n[0]?n[1]:n[0]}}}const ZW={pickedColor:null,pickedObjectIndex:-1};function XW({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:n,deviceRadius:i,deviceRect:o}){const{x:c,y:s,width:m,height:v}=o;let w=i*i,M=-1,I=0;for(let k=0;k<v;k++){const z=k+s-n,V=z*z;if(V>w)I+=4*m;else for(let U=0;U<m;U++){if(t[I+3]-1>=0){const J=U+c-r,Z=J*J+V;Z<=w&&(w=Z,M=I)}I+=4}}if(M>=0){const k=t.slice(M,M+4),z=e(k);if(z){const V=Math.floor(M/4/m),U=M/4-V*m;return{...z,pickedColor:k,pickedX:c+U,pickedY:s+V}}oi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return ZW}function GW({pickedColors:t,decodePickingColor:e}){const r=new Map;if(t){for(let n=0;n<t.length;n+=4)if(t[n+3]-1>=0){const o=t.slice(n,n+4),c=o.join(",");if(!r.has(c)){const s=e(o);s?r.set(c,{...s,color:o}):oi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function LF({pickInfo:t,viewports:e,pixelRatio:r,x:n,y:i,z:o}){let c=e[0];e.length>1&&(c=KW((t==null?void 0:t.pickedViewports)||e,{x:n,y:i}));let s;if(c){const m=[n-c.x,i-c.y];o!==void 0&&(m[2]=o),s=c.unproject(m)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:s,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function YW(t){const{pickInfo:e,lastPickedInfo:r,mode:n,layers:i}=t,{pickedColor:o,pickedLayer:c,pickedObjectIndex:s}=e,m=c?[c]:[];if(n==="hover"){const M=r.index,I=r.layerId,k=c?c.props.id:null;if(k!==I||s!==M){if(k!==I){const z=i.find(V=>V.props.id===I);z&&m.unshift(z)}r.layerId=k,r.index=s,r.info=null}}const v=LF(t),w=new Map;return w.set(null,v),m.forEach(M=>{let I={...v};M===c&&(I.color=o,I.index=s,I.picked=!0),I=FF({layer:M,info:I,mode:n});const k=I.layer;M===c&&n==="hover"&&(r.info=I),w.set(k.id,I),n==="hover"&&k.updateAutoHighlight(I)}),w}function FF({layer:t,info:e,mode:r}){for(;t&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:n}),t=t.parent}return e}function KW(t,e){for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.containsPixel(e))return n}return t[0]}class QW{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new OF(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:n,viewports:i},o=this.lastPickedInfo.info){const c=o&&o.layer&&o.layer.id,s=o&&o.viewport&&o.viewport.id,m=c?n.find(I=>I.id===c):null,v=s&&i.find(I=>I.id===s)||i[0],w=v&&v.unproject([e-v.x,r-v.y]);return{...o,...{x:e,y:r,viewport:v,coordinate:w,layer:m}}}_resizeBuffer(){var r,n;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(r=this.pickingFBO)==null||r.resize({width:e.width,height:e.height}),(n=this.depthFBO)==null||n.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const r=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:n,x:i,y:o,radius:c=0,depth:s=1,mode:m="query",unproject3D:v,onViewportActive:w,effects:M}){const I=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(e);if(!k||n.length===0)return{result:[],emptyInfo:LF({viewports:n,x:i,y:o,pixelRatio:I})};this._resizeBuffer();const z=this.device.canvasContext.cssToDevicePixels([i,o],!0),V=[z.x+Math.floor(z.width/2),z.y+Math.floor(z.height/2)],U=Math.round(c*I),{width:K,height:J}=this.pickingFBO,Z=this._getPickingRect({deviceX:V[0],deviceY:V[1],deviceRadius:U,deviceWidth:K,deviceHeight:J}),re={x:i-c,y:o-c,width:c*2+1,height:c*2+1};let W;const Y=[],ue=new Set;for(let be=0;be<s;be++){let Ce;if(Z){const Me=this._drawAndSample({layers:k,views:r,viewports:n,onViewportActive:w,deviceRect:Z,cullRect:re,effects:M,pass:`picking:${m}`});Ce=XW({...Me,deviceX:V[0],deviceY:V[1],deviceRadius:U,deviceRect:Z})}else Ce={pickedColor:null,pickedObjectIndex:-1};let Ye;if(Ce.pickedLayer&&v&&this.depthFBO){const{pickedColors:Me}=this._drawAndSample({layers:[Ce.pickedLayer],views:r,viewports:n,onViewportActive:w,deviceRect:{x:Ce.pickedX,y:Ce.pickedY,width:1,height:1},cullRect:re,effects:M,pass:`picking:${m}:z`},!0);Me[3]&&(Ye=Me[0])}Ce.pickedLayer&&be+1<s&&(ue.add(Ce.pickedLayer),Ce.pickedLayer.disablePickingIndex(Ce.pickedObjectIndex)),W=YW({pickInfo:Ce,lastPickedInfo:this.lastPickedInfo,mode:m,layers:k,viewports:n,x:i,y:o,z:Ye,pixelRatio:I});for(const Me of W.values())Me.layer&&Y.push(Me);if(!Ce.pickedColor)break}for(const be of ue)be.restorePickingColors();return{result:Y,emptyInfo:W.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:n,x:i,y:o,width:c=1,height:s=1,mode:m="query",maxObjects:v=null,onViewportActive:w,effects:M}){const I=this._getPickable(e);if(!I||n.length===0)return[];this._resizeBuffer();const k=this.device.canvasContext.cssToDeviceRatio(),z=this.device.canvasContext.cssToDevicePixels([i,o],!0),V=z.x,U=z.y+z.height,K=this.device.canvasContext.cssToDevicePixels([i+c,o+s],!0),J=K.x+K.width,Z=K.y,re={x:V,y:Z,width:J-V,height:U-Z},W=this._drawAndSample({layers:I,views:r,viewports:n,onViewportActive:w,deviceRect:re,cullRect:{x:i,y:o,width:c,height:s},effects:M,pass:`picking:${m}`}),Y=GW(W),ue=new Map,be=[],Ce=Number.isFinite(v);for(let Ye=0;Ye<Y.length&&!(Ce&&be.length>=v);Ye++){const Me=Y[Ye];let Ue={color:Me.pickedColor,layer:null,index:Me.pickedObjectIndex,picked:!0,x:i,y:o,pixelRatio:k};Ue=FF({layer:Me.pickedLayer,info:Ue,mode:m});const Qe=Ue.layer.id;ue.has(Qe)||ue.set(Qe,new Set);const Ze=ue.get(Qe),ct=Ue.object??Ue.index;Ze.has(ct)||(Ze.add(ct),be.push(Ue))}return be}_drawAndSample({layers:e,views:r,viewports:n,onViewportActive:i,deviceRect:o,cullRect:c,effects:s,pass:m},v=!1){const w=v?this.depthFBO:this.pickingFBO,M={layers:e,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:i,pickingFBO:w,deviceRect:o,cullRect:c,effects:s,pass:m,pickZ:v,preRenderStats:{},isPicking:!0};for(const J of s)J.useInPicking&&(M.preRenderStats[J.id]=J.preRender(M));const{decodePickingColor:I}=this.pickLayersPass.render(M),{x:k,y:z,width:V,height:U}=o,K=new(v?Float32Array:Uint8Array)(V*U*4);return this.device.readPixelsToArrayWebGL(w,{sourceX:k,sourceY:z,sourceWidth:V,sourceHeight:U,target:K}),{pickedColors:K,decodePickingColor:I}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:n,deviceWidth:i,deviceHeight:o}){const c=Math.max(0,e-n),s=Math.max(0,r-n),m=Math.min(i,e+n+1)-c,v=Math.min(o,r+n+1)-s;return m<=0||v<=0?null:{x:c,y:s,width:m,height:v}}}const JW={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},eZ="top-left",wR="__root";class tZ{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!qc(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const r={};for(const n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=r[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._remove(i),this._add(n)):n!==i&&(i.setProps(n.props),n=i):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(const n in r){const i=r[n];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:r=null,placement:n=eZ}=e,i=e.onAdd({deck:this.deck,viewId:r});i&&this._getContainer(r,n).append(i),e._element=i}_remove(e){var r;(r=e.onRemove)==null||r.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){var c;const n=e||wR;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(c=this.parentElement)==null||c.append(i),this.containers[n]=i);let o=i.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,JW[r]),i.append(o)),o}_updateContainers(){const e=this.deck.width,r=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,o=n===wR||i,c=this.containers[n];o?(c.style.display="block",c.style.left=`${i?i.x:0}px`,c.style.top=`${i?i.y:0}px`,c.style.width=`${i?i.width:e}px`,c.style.height=`${i?i.height:r}px`):c.style.display="none"}}onRedraw({viewports:e,layers:r}){var i,o;const n=e.reduce((c,s)=>(c[s.id]=s,c),{});for(const c of this.getWidgets()){const{viewId:s}=c;if(s){const m=n[s];m&&(c.onViewportChange&&c.onViewportChange(m),(i=c.onRedraw)==null||i.call(c,{viewports:[m],layers:r}))}else{if(c.onViewportChange)for(const m of e)c.onViewportChange(m);(o=c.onRedraw)==null||o.call(c,{viewports:e,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(e,r){var n,i;for(const o of this.getWidgets()){const{viewId:c}=o;(!c||c===((n=e.viewport)==null?void 0:n.id))&&((i=o.onHover)==null||i.call(o,e,r))}}onEvent(e,r){var i,o;const n=dE[r.type];if(n)for(const c of this.getWidgets()){const{viewId:s}=c;(!s||s===((i=e.viewport)==null?void 0:i.id))&&((o=c[n])==null||o.call(c,e,r))}}}const rZ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};let nZ=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,rZ),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var r;this.isVisible&&e.id===((r=this.lastViewport)==null?void 0:r.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,r,n){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${r}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}};var xg;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(xg||(xg={}));const bP={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ya=(t,e,r)=>e?t.enable(r):t.disable(r),TR=(t,e,r)=>t.hint(r,e),Wo=(t,e,r)=>t.pixelStorei(r,e),SR=(t,e,r)=>{const n=r===36006?36009:36008;return t.bindFramebuffer(n,e)},_y=(t,e,r)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(i,e)};function Lw(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const iZ={3042:ya,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:ya,2885:(t,e)=>t.cullFace(e),2929:ya,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:ya,35723:TR,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var r;return(r=t.bindTransformFeedback)==null?void 0:r.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:SR,36010:SR,34964:_y,36662:_y,36663:_y,35053:_y,35055:_y,2886:(t,e)=>t.frontFace(e),33170:TR,2849:(t,e)=>t.lineWidth(e),32823:ya,32824:"polygonOffset",10752:"polygonOffset",35977:ya,32926:ya,32928:ya,32938:"sampleCoverage",32939:"sampleCoverage",3089:ya,3088:(t,e)=>t.scissor(...e),2960:ya,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:ya,10754:ya,12288:ya,12289:ya,12290:ya,12291:ya,12292:ya,12293:ya,12294:ya,12295:ya,3333:Wo,3317:Wo,37440:Wo,37441:Wo,37443:Wo,3330:Wo,3332:Wo,3331:Wo,3314:Wo,32878:Wo,3316:Wo,3315:Wo,32877:Wo,framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{const r=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Lw(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,n)},stencilFunc:(t,e)=>{e=Lw(e)&&e.length===3?[...e,...e]:e;const[r,n,i,o,c,s]=e;t.stencilFuncSeparate(1028,r,n,i),t.stencilFuncSeparate(1029,o,c,s)},stencilOp:(t,e)=>{e=Lw(e)&&e.length===3?[...e,...e]:e;const[r,n,i,o,c,s]=e;t.stencilOpSeparate(1028,r,n,i),t.stencilOpSeparate(1029,o,c,s)},viewport:(t,e)=>t.viewport(...e)};function qi(t,e,r){return e[t]!==void 0?e[t]:r[t]}const aZ={blendEquation:(t,e,r)=>t.blendEquationSeparate(qi(32777,e,r),qi(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(qi(32969,e,r),qi(32968,e,r),qi(32971,e,r),qi(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(qi(32824,e,r),qi(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(qi(32938,e,r),qi(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,qi(2962,e,r),qi(2967,e,r),qi(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,qi(34816,e,r),qi(36003,e,r),qi(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,qi(2964,e,r),qi(2965,e,r),qi(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,qi(34817,e,r),qi(34818,e,r),qi(34819,e,r))},AR={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?t({[n]:r}):{valueChanged:!0}},blendColor:(t,e,r,n,i)=>t({32773:new Float32Array([e,r,n,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,n,i)=>t({32969:e,32968:r,32971:n,32970:i}),clearColor:(t,e,r,n,i)=>t({3106:new Float32Array([e,r,n,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,n,i)=>t({3107:[e,r,n,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,n,i)=>t({3088:new Int32Array([e,r,n,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,n)=>t({2962:e,2967:r,2963:n,34816:e,36003:r,36004:n}),stencilFuncSeparate:(t,e,r,n,i)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(t,e,r,n)=>t({2964:e,2965:r,2966:n,34817:e,34818:r,34819:n}),stencilOpSeparate:(t,e,r,n,i)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(t,e,r,n,i)=>t({2978:[e,r,n,i]})},Su=(t,e)=>t.isEnabled(e),ER={3042:Su,2884:Su,2929:Su,3024:Su,32823:Su,32926:Su,32928:Su,3089:Su,2960:Su,35977:Su},sZ=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function f_(t,e){if(lZ(e))return;const r={};for(const i in e){const o=Number(i),c=iZ[i];c&&(typeof c=="string"?r[c]=!0:c(t,e[i],o))}const n=t.state&&t.state.cache;if(n)for(const i in r){const o=aZ[i];o(t,e,n)}}function zF(t,e=bP){if(typeof e=="number"){const i=e,o=ER[i];return o?o(t,i):t.getParameter(i)}const r=Array.isArray(e)?e:Object.keys(e),n={};for(const i of r){const o=ER[i];n[i]=o?o(t,Number(i)):t.getParameter(Number(i))}return n}function oZ(t){f_(t,bP)}function lZ(t){for(const e in t)return!1;return!0}function cZ(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&n&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class Up{constructor(e,r){de(this,"gl");de(this,"program",null);de(this,"stateStack",[]);de(this,"enable",!0);de(this,"cache",null);de(this,"log");de(this,"initialized",!1);this.gl=e,this.log=(r==null?void 0:r.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];f_(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?zF(e):Object.assign({},bP),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,hZ(e);for(const n in AR){const i=AR[n];uZ(e,n,i)}MR(e,"getParameter"),MR(e,"isEnabled")}_updateCache(e){let r=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const c=e[o],s=this.cache[o];cZ(c,s)||(r=!0,n=s,i&&!(o in i)&&(i[o]=s),this.cache[o]=c)}return{valueChanged:r,oldValue:n}}}function MR(t,e){const r=t[e].bind(t);t[e]=function(i){if(i===void 0||sZ.has(i))return r(i);const o=Up.get(t);return i in o.cache||(o.cache[i]=r(i)),o.enable?o.cache[i]:r(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function uZ(t,e,r){if(!t[e])return;const n=t[e].bind(t);t[e]=function(...o){const c=Up.get(t),{valueChanged:s,oldValue:m}=r(c._updateCache,...o);return s&&n(...o),m},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function hZ(t){const e=t.useProgram.bind(t);t.useProgram=function(n){const i=Up.get(t);i.program!==n&&(e(n),i.program=n)}}function fZ(t,e,r){let n="";const i={preserveDrawingBuffer:!0,...r};let o=null;if(o||(o=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(n||(n="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!o&&!r.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,o=t.getContext("webgl2",i),o.luma||(o.luma={}),o.luma.softwareRenderer=!0),o||(o=t.getContext("webgl",{}),o&&(o=null,n||(n="Your browser only supports WebGL1"))),!o)throw n||(n="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:c,onContextRestored:s}=e;return t.addEventListener("webglcontextlost",m=>c(m),!1),t.addEventListener("webglcontextrestored",m=>s(m),!1),o.luma||(o.luma={}),o}function qg(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function dZ(t,e){const r=t.getParameter(7936),n=t.getParameter(7937);qg(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,o=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),c=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),s=o||r,m=c||n,v=t.getParameter(7938),w=jF(s,m),M=pZ(s,m),I=mZ(s,m);return{type:"webgl",gpu:w,gpuType:I,gpuBackend:M,vendor:s,renderer:m,version:v,shadingLanguage:"glsl",shadingLanguageVersion:300}}function jF(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function pZ(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function mZ(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(jF(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function UF(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Iy="WEBGL_compressed_texture_s3tc",Oy="WEBGL_compressed_texture_s3tc_srgb",wg="EXT_texture_compression_rgtc",Tg="EXT_texture_compression_bptc",gZ="WEBGL_compressed_texture_etc",_Z="WEBGL_compressed_texture_astc",yZ="WEBGL_compressed_texture_etc1",vZ="WEBGL_compressed_texture_pvrtc",bZ="WEBGL_compressed_texture_atc",PR="EXT_texture_norm16",CR="EXT_render_snorm",xZ="EXT_color_buffer_float",xP={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[CR],"norm16-renderable-webgl":[PR],"snorm16-renderable-webgl":[PR,CR],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Iy,Oy,wg,Tg],"texture-compression-bc5-webgl":[wg],"texture-compression-bc7-webgl":[Tg],"texture-compression-etc2":[gZ],"texture-compression-astc":[_Z],"texture-compression-etc1-webgl":[yZ],"texture-compression-pvrtc-webgl":[vZ],"texture-compression-atc-webgl":[bZ]};function wZ(t){return t in xP}function TZ(t,e,r){return(xP[e]||[]).every(i=>qg(t,i,r))}const wP={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:xZ,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Iy},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Oy},"bc1-rgba-unorm":{gl:33777,x:Iy},"bc1-rgba-unorm-srgb":{gl:35916,x:Oy},"bc2-rgba-unorm":{gl:33778,x:Iy},"bc2-rgba-unorm-srgb":{gl:35918,x:Oy},"bc3-rgba-unorm":{gl:33779,x:Iy},"bc3-rgba-unorm-srgb":{gl:35919,x:Oy},"bc4-r-unorm":{gl:36283,x:wg},"bc4-r-snorm":{gl:36284,x:wg},"bc5-rg-unorm":{gl:36285,x:wg},"bc5-rg-snorm":{gl:36286,x:wg},"bc6h-rgb-ufloat":{gl:36495,x:Tg},"bc6h-rgb-float":{gl:36494,x:Tg},"bc7-rgba-unorm":{gl:36492,x:Tg},"bc7-rgba-unorm-srgb":{gl:36493,x:Tg},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function SZ(t,e,r){let n=e.create;const i=wP[e.format];return(i==null?void 0:i.gl)===void 0&&(n=!1),i!=null&&i.x&&(n=n&&!!qg(t,i.x,r)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function $F(t){var i;const e=wP[t],r=MZ(t),n=sP(t);return{internalFormat:r,format:(e==null?void 0:e.dataFormat)||EZ(n.channels,n.integer,n.normalized,r),type:n.dataType?UF(n.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:n.compressed||!1}}function AZ(t){switch(sP(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function EZ(t,e,r,n){if(n===6408||n===6407)return n;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function MZ(t){const e=wP[t],r=e==null?void 0:e.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}const RR={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class PZ extends _V{constructor(r,n,i){super([],i);de(this,"gl");de(this,"extensions");de(this,"testedFeatures",new Set);this.gl=r,this.extensions=n,qg(r,"EXT_color_buffer_float",n)}*[Symbol.iterator](){const r=this.getFeatures();for(const n of r)this.has(n)&&(yield n);return[]}has(r){var n;return(n=this.disabledFeatures)!=null&&n[r]?!1:(this.testedFeatures.has(r)||(this.testedFeatures.add(r),wZ(r)&&TZ(this.gl,r,this.extensions)&&this.features.add(r),this.getWebGLFeature(r)&&this.features.add(r)),this.features.has(r))}initializeFeatures(){const r=this.getFeatures().filter(n=>n!=="polygon-mode-webgl");for(const n of r)this.has(n)}getFeatures(){return[...Object.keys(RR),...Object.keys(xP)]}getWebGLFeature(r){const n=RR[r];return typeof n=="string"?!!qg(this.gl,n,this.extensions):!!n}}class CZ extends gV{constructor(r){super();de(this,"gl");de(this,"limits",{});this.gl=r}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(r){return this.limits[r]===void 0&&(this.limits[r]=this.gl.getParameter(r)),this.limits[r]||0}}class jy extends O0{constructor(r,n){super(r,n);de(this,"device");de(this,"gl");de(this,"handle");de(this,"colorAttachments",[]);de(this,"depthStencilAttachment",null);const i=n.handle===null;this.device=r,this.gl=r.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(r.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const r=this.gl.bindFramebuffer(36160,this.handle);for(let n=0;n<this.colorAttachments.length;++n){const i=this.colorAttachments[n];if(i){const o=36064+n;this._attachTextureView(o,i)}}if(this.depthStencilAttachment){const n=AZ(this.depthStencilAttachment.props.format);this._attachTextureView(n,this.depthStencilAttachment)}if(this.device.props.debug){const n=this.gl.checkFramebufferStatus(36160);if(n!==36053)throw new Error(`Framebuffer ${IZ(n)}`)}this.gl.bindFramebuffer(36160,r)}_attachTextureView(r,n){const{gl:i}=this.device,{texture:o}=n,c=n.props.baseMipLevel,s=n.props.baseArrayLayer;switch(i.bindTexture(o.glTarget,o.handle),o.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,r,o.handle,c,s);break;case 34067:const m=RZ(s);i.framebufferTexture2D(36160,r,m,o.handle,c);break;case 3553:i.framebufferTexture2D(36160,r,3553,o.handle,c);break;default:throw new Error("Illegal texture type")}i.bindTexture(o.glTarget,null)}}function RZ(t){return t<34069?t+34069:t}function IZ(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class OZ extends QA{constructor(r,n){super(n);de(this,"device");de(this,"format","rgba8unorm");de(this,"depthStencilFormat","depth24plus");de(this,"presentationSize");de(this,"_framebuffer",null);this.device=r,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new jy(this.device,{handle:null}),this._framebuffer}update(){const r=this.getPixelSize();(r[0]!==this.presentationSize[0]||r[1]!==this.presentationSize[1])&&(this.presentationSize=r,this.resize())}resize(r){if(this.device.gl&&this.canvas){const n=this.getDevicePixelRatio(r==null?void 0:r.useDevicePixels);this.setDevicePixelRatio(n,r);return}}commit(){}}async function VF(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),new Promise((i,o)=>{n.onload=i,n.onerror=c=>o(new Error(`Unable to load script '${t}': ${c}`)),r.appendChild(n)})}const kZ=1;let ti=null,IR=!1;const TP={debugSpectorJS:Qt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function DZ(t){if(!globalThis.SPECTOR)try{await VF(t.debugSpectorJSUrl||TP.debugSpectorJSUrl)}catch(e){Qt.warn(String(e))}}function NZ(t){var e;if(t={...TP,...t},!t.debugSpectorJS)return null;if(!ti&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){Qt.probe(kZ,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:r}=globalThis.SPECTOR;ti=new r,globalThis.luma&&(globalThis.luma.spector=ti)}if(!ti)return null;if(IR||(IR=!0,ti.spyCanvases(),ti==null||ti.onCaptureStarted.add(r=>Qt.info("Spector capture started:",r)()),ti==null||ti.onCapture.add(r=>{Qt.info("Spector capture complete:",r)(),ti==null||ti.getResultUI(),ti==null||ti.resultView.display(),ti==null||ti.resultView.addCapture(r)})),t.gl){const r=t.gl,n=r.device;ti==null||ti.startCapture(t.gl,500),r.device=n,new Promise(i=>setTimeout(i,2e3)).then(i=>{Qt.info("Spector capture stopped after 2 seconds")(),ti==null||ti.stopCapture()})}return ti}const BZ="https://unpkg.com/webgl-debug@2.0.1/index.js";function qF(t){return t.luma=t.luma||{},t.luma}async function LZ(){tm()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await VF(BZ))}function FZ(t,e={}){return e.debugWebGL||e.traceWebGL?jZ(t,e):zZ(t)}function zZ(t){const e=qF(t);return e.realContext?e.realContext:t}function jZ(t,e){if(!globalThis.WebGLDebugUtils)return Qt.warn("webgl-debug not loaded")(),t;const r=qF(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...xg,...t});const n=globalThis.WebGLDebugUtils.makeDebugContext(t,UZ.bind(null,e),$Z.bind(null,e));for(const c in xg)!(c in n)&&typeof xg[c]=="number"&&(n[c]=xg[c]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,n);const o=Object.create(i);return r.realContext=t,r.debugContext=o,o.debug=!0,o}function OR(t,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function UZ(t,e,r,n){n=Array.from(n).map(s=>s===void 0?"undefined":s);const i=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),c=`${i} in gl.${r}(${o})`;Qt.error(c)();debugger}function $Z(t,e,r){let n="";Qt.level>=1&&(n=OR(e,r),t.traceWebGL&&Qt.log(1,n)());for(const i of r)if(i===void 0){n=n||OR(e,r);debugger}}const Fw={};function VZ(t="id"){Fw[t]=Fw[t]||1;const e=Fw[t]++;return`${t}-${e}`}class Uy extends Ti{constructor(r,n={}){super(r,n);de(this,"device");de(this,"gl");de(this,"handle");de(this,"glTarget");de(this,"glUsage");de(this,"glIndexType",5123);de(this,"byteLength");de(this,"bytesUsed");this.device=r,this.gl=this.device.gl;const i=typeof n=="object"?n.handle:void 0;this.handle=i||this.gl.createBuffer(),r.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=qZ(this.props.usage),this.glUsage=HZ(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,n.data?this._initWithData(n.data,n.byteOffset,n.byteLength):this._initWithByteLength(n.byteLength||0)}_initWithData(r,n=0,i=r.byteLength+n){const o=this.glTarget;this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.glUsage),this.gl.bufferSubData(o,n,r),this.gl.bindBuffer(o,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(r,n,i),this.trackAllocatedMemory(i)}_initWithByteLength(r){let n=r;r===0&&(n=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(null,0,r),this.trackAllocatedMemory(r),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(r,n=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,n,r),this.gl.bindBuffer(36663,null),this._setDebugData(r,n,r.byteLength)}async readAsync(r=0,n){return this.readSyncWebGL(r,n)}readSyncWebGL(r=0,n){n=n??this.byteLength-r;const i=new Uint8Array(n),o=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,r,i,o,n),this.gl.bindBuffer(36662,null),this._setDebugData(i,r,n),i}}function qZ(t){return t&Ti.INDEX?34963:t&Ti.VERTEX?34962:t&Ti.UNIFORM?35345:34962}function HZ(t){return t&Ti.INDEX||t&Ti.VERTEX?35044:t&Ti.UNIFORM?35048:35044}function WZ(t){const e=t.split(/\r?\n/),r=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[M,I]=i;r.push({message:I.trim(),type:kR(M),lineNum:0,linePos:0});continue}const[o,c,s,...m]=i;let v=parseInt(s,10);isNaN(v)&&(v=0);let w=parseInt(c,10);isNaN(w)&&(w=0),r.push({message:m.join(":").trim(),type:kR(o),lineNum:v,linePos:w})}return r}function kR(t){const e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}class ZZ extends R0{constructor(r,n){super(r,n);de(this,"device");de(this,"handle");switch(this.device=r,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const r=this.device.gl.getShaderInfoLog(this.handle);return r?WZ(r):[]}getTranslatedSource(){const n=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(n==null?void 0:n.getTranslatedShaderSource(this.handle))||null}async _compile(r){r=r.startsWith("#version ")?r:`#version 300 es
${r}`;const{gl:n}=this.device;if(n.shaderSource(this.handle,r),n.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Qt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Qt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const r=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await r(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await r(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function XZ(t,e,r,n){if(QZ(e))return n(t);const i=t;i.pushState();try{return GZ(t,e),f_(i.gl,r),n(t)}finally{i.popState()}}function GZ(t,e){const r=t,{gl:n}=r;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace($p("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,c=$p("provokingVertex",e.provokingVertex,{first:36429,last:36430});o==null||o.provokingVertexWEBGL(c)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,c=$p("polygonMode",e.polygonMode,{fill:6914,line:6913});o==null||o.polygonModeWEBGL(1028,c),o==null||o.polygonModeWEBGL(1029,c)}e.polygonOffsetLine&&n.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(KZ("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(wE("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Qt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,o=wE("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,o,0,i),n.stencilFuncSeparate(1029,o,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=zw("stencilPassOperation",e.stencilPassOperation),o=zw("stencilFailOperation",e.stencilFailOperation),c=zw("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,o,c,i),n.stencilOpSeparate(1029,o,c,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=DR("blendColorOperation",e.blendColorOperation||"add"),o=DR("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,o);const c=Jb("blendColorSrcFactor",e.blendColorSrcFactor||"one"),s=Jb("blendColorDstFactor",e.blendColorDstFactor||"zero"),m=Jb("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),v=Jb("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(c,s,m,v)}}function wE(t,e){return $p(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function zw(t,e){return $p(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function DR(t,e){return $p(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Jb(t,e){return $p(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function YZ(t,e){return`Illegal parameter ${e} for ${t}`}function $p(t,e,r){if(!(e in r))throw new Error(YZ(t,e));return r[e]}function KZ(t,e){return e}function QZ(t){let e=!0;for(const r in t){e=!1;break}return e}function HF(t){const e={};return t.addressModeU&&(e[10242]=jw(t.addressModeU)),t.addressModeV&&(e[10243]=jw(t.addressModeV)),t.addressModeW&&(e[32882]=jw(t.addressModeW)),t.magFilter&&(e[10240]=TE(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=JZ(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=wE("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function jw(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function TE(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function JZ(t,e="none"){if(!e)return TE(t);switch(e){case"none":return TE(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class SE extends I0{constructor(r,n){super(r,n);de(this,"device");de(this,"handle");de(this,"parameters");this.device=r,this.parameters=HF(n),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(r){for(const[n,i]of Object.entries(r)){const o=Number(n);switch(o){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,o,i);break;default:this.device.gl.samplerParameteri(this.handle,o,i);break}}}}class Sg extends C0{constructor(r,n){super(r,{...Hi.defaultProps,...n});de(this,"device");de(this,"gl");de(this,"handle");de(this,"texture");this.device=r,this.gl=this.device.gl,this.handle=null,this.texture=n.texture}}const eX="Failed to deduce GL constant from typed array";function tX(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(eX)}}function rX(t,e){const{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function WF(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function nX(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Z0(t,e,r){if(iX(e))return r(t);const{nocatch:n=!0}=e,i=Up.get(t);i.push(),f_(t,e);let o;if(n)o=r(t),i.pop();else try{o=r(t)}finally{i.pop()}return o}function iX(t){for(const e in t)return!1;return!0}function aX(t,e,r){const{dimension:n,width:i,height:o,depth:c=0}=r,{glInternalFormat:s}=r,m=r.glTarget;switch(n){case"2d-array":case"3d":t.texStorage3D(m,e,s,i,o,c);break;default:t.texStorage2D(m,e,s,i,o)}}function NR(t,e,r,n){const{width:i,height:o}=n,{dimension:c,depth:s=0,mipLevel:m=0}=n,{x:v=0,y:w=0,z:M=0}=n,{glFormat:I,glType:k}=n,z=ZF(n.glTarget,c,s),V=n.flipY?{37440:!0}:{};Z0(t,V,()=>{switch(c){case"2d-array":case"3d":t.bindTexture(z,e),t.texSubImage3D(z,m,v,w,M,i,o,s,I,k,r),t.bindTexture(z,null);break;case"2d":case"cube":t.bindTexture(z,e),t.texSubImage2D(z,m,v,w,i,o,I,k,r),t.bindTexture(z,null);break;default:throw new Error(c)}})}function BR(t,e,r){const{dimension:n,width:i,height:o,depth:c=0,mipLevel:s=0,byteOffset:m=0}=r,{x:v=0,y:w=0,z:M=0}=r,{glFormat:I,glType:k,compressed:z}=r,V=ZF(r.glTarget,n,c);switch(n){case"2d-array":case"3d":z?t.compressedTexSubImage3D(V,s,v,w,M,i,o,c,I,e,m):t.texSubImage3D(V,s,v,w,M,i,o,c,I,k,e,m);break;case"2d":case"cube":z?t.compressedTexSubImage2D(V,s,v,w,i,o,I,e,m):t.texSubImage2D(V,s,v,w,i,o,I,k,e,m);break;default:throw new Error(n)}}function sX(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function ZF(t,e,r){return e==="cube"?34069+r:t}function oX(t,e){var K;const{sourceX:r=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:o=null,sourceWidth:c,sourceHeight:s,sourceDepth:m,sourceFormat:v,sourceType:w}=e||{};const{framebuffer:M,deleteFramebuffer:I}=XF(t),{gl:k,handle:z}=M;c||(c=M.width),s||(s=M.height);const V=(K=M.colorAttachments[i])==null?void 0:K.texture;if(!V)throw new Error(`Invalid framebuffer attachment ${i}`);m=(V==null?void 0:V.depth)||1,v||(v=(V==null?void 0:V.glFormat)||6408),w||(w=(V==null?void 0:V.glType)||5121),o=uX(o,w,v,c,s),w=w||tX(o);const U=k.bindFramebuffer(36160,z);return k.readBuffer(36064+i),k.readPixels(r,n,c,s,v,w,o),k.readBuffer(36064),k.bindFramebuffer(36160,U||null),I&&M.destroy(),o}function lX(t,e){const{target:r,sourceX:n=0,sourceY:i=0,sourceFormat:o=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:s,sourceHeight:m,sourceType:v}=e||{};const{framebuffer:w,deleteFramebuffer:M}=XF(t);s=s||w.width,m=m||w.height;const I=w;v=v||5121;let k=r;if(!k){const V=WF(o),U=nX(v),K=c+s*m*V*U;k=I.device.createBuffer({byteLength:K})}const z=t.device.createCommandEncoder();return z.copyTextureToBuffer({sourceTexture:t,width:s,height:m,origin:[n,i],destinationBuffer:k,byteOffset:c}),z.destroy(),M&&w.destroy(),k}function XF(t){return t instanceof O0?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:cX(t),deleteFramebuffer:!0}}function cX(t,e){const{device:r,width:n,height:i,id:o}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:n,height:i,colorAttachments:[t]})}function uX(t,e,r,n,i,o){if(t)return t;e||(e=5121);const c=rX(e,{clamped:!1}),s=WF(r);return new c(n*i*s)}class $y extends Hi{constructor(r,n){super(r,n);de(this,"device");de(this,"gl");de(this,"handle");de(this,"sampler");de(this,"view");de(this,"mipmaps");de(this,"compressed");de(this,"glTarget");de(this,"glFormat");de(this,"glType");de(this,"glInternalFormat");de(this,"textureUnit",0);const i={...this.props};i.data=n.data,this.device=r,this.gl=this.device.gl,this.glTarget=sX(this.props.dimension);const o=$F(this.props.format);this.glInternalFormat=o.internalFormat,this.glFormat=o.format,this.glType=o.type,this.compressed=o.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(r){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:r.data});let{width:n,height:i}=r;if(!n||!i){const o=Hi.getTextureDataSize(r.data);n=(o==null?void 0:o.width)||1,i=(o==null?void 0:o.height)||1}if(this.width=n,this.height=i,this.depth=r.depth,this.setSampler(r.sampler),this.view=new Sg(this.device,{...this.props,texture:this}),this.bind(),aX(this.gl,this.mipLevels,this),r.data)switch(r.dimension){case"1d":this.setTexture1DData(r.data);break;case"2d":this.setTexture2DData(r.data);break;case"3d":this.setTexture3DData(r.data);break;case"cube":this.setTextureCubeData(r.data);break;case"2d-array":this.setTextureArrayData(r.data);break;case"cube-array":this.setTextureCubeArrayData(r.data);break;default:throw new Error(r.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(r){return new Sg(this.device,{...r,texture:this})}setSampler(r={}){let n;r instanceof SE?(this.sampler=r,n=r.props):(this.sampler=new SE(this.device,r),n=r);const i=HF(n);this._setSamplerParameters(i)}generateMipmap(r){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Qt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(r!=null&&r.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Qt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(r){const n=Hi.getExternalImageSize(r.image),i={...Hi.defaultCopyExternalImageOptions,...n,...r},{image:o,depth:c,mipLevel:s,x:m,y:v,z:w,flipY:M}=i;let{width:I,height:k}=i;const{dimension:z,glTarget:V,glFormat:U,glInternalFormat:K,glType:J}=this;if(I=Math.min(I,this.width-m),k=Math.min(k,this.height-v),r.sourceX||r.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return NR(this.device.gl,this.handle,o,{dimension:z,mipLevel:s,x:m,y:v,z:w,width:I,height:k,depth:c,glFormat:U,glType:J,glTarget:V,flipY:M}),{width:i.width,height:i.height}}setTexture1DData(r){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(r,n=0){this.bind();const i=Hi.normalizeTextureData(r,this);i.length>1&&this.props.mipmaps!==!1&&Qt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let o=0;o<i.length;o++){const c=i[o];this._setMipLevel(n,o,c)}this.unbind()}setTexture3DData(r){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(r)&&(this.bind(),BR(this.device.gl,r,this),this.unbind())}setTextureCubeData(r,n=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Hi.CubeFaces)this.setTextureCubeFaceData(r[i],i)}setTextureArrayData(r){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(r){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(r,n,i=0){Array.isArray(r)&&r.length>1&&this.props.mipmaps!==!1&&Qt.warn(`${this.id} has mipmap and multiple LODs.`)();const o=Hi.CubeFaces.indexOf(n);this.setTexture2DData(r,o)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(r){const{face:n,width:i,height:o,pixels:c,data:s,format:m=6408,type:v=5121}=r,{gl:w}=this,M=c||s;this.bind(),M instanceof Promise?M.then(I=>this.setImageDataForFace(Object.assign({},r,{face:n,data:I,pixels:I}))):this.width||this.height?w.texImage2D(n,0,m,i,o,0,m,v,M):w.texImage2D(n,0,m,m,v,M)}_getImageDataMap(r){for(let n=0;n<Hi.CubeFaces.length;++n){const i=Hi.CubeFaces[n];r[i]&&(r[34069+n]=r[i],delete r[i])}return r}_setSamplerParameters(r){Qt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(r))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[n,i]of Object.entries(r)){const o=Number(n),c=i;switch(o){case 33082:case 33083:this.gl.texParameterf(this.glTarget,o,c);break;case 10241:this.gl.texParameteri(this.glTarget,o,c);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,o,c);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,o,c);break;default:this.gl.texParameteri(this.glTarget,o,c);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(r,n,i,o=this.glTarget){if(Hi.isExternalImage(i)){NR(this.device.gl,this.handle,i,{...this,depth:r,mipLevel:n,glTarget:o,flipY:this.props.flipY});return}if(Hi.isTextureLevelData(i)){BR(this.device.gl,i.data,{...this,depth:r,mipLevel:n,glTarget:o});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(r){const{gl:n}=this;return r!==void 0&&(this.textureUnit=r,n.activeTexture(33984+r)),n.bindTexture(this.glTarget,this.handle),r}unbind(r){const{gl:n}=this;return r!==void 0&&(this.textureUnit=r,n.activeTexture(33984+r)),n.bindTexture(this.glTarget,null),r}}const hX=[1,2,4,8];class fX extends JA{constructor(r,n){var c;super(r,n);de(this,"device");de(this,"glParameters");this.device=r;let i;if(!((c=n==null?void 0:n.parameters)!=null&&c.viewport))if(n!=null&&n.framebuffer){const{width:s,height:m}=n.framebuffer;i=[0,0,s,m]}else{const[s,m]=r.getCanvasContext().getDrawingBufferSize();i=[0,0,s,m]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const o=this.props.framebuffer;if(o!=null&&o.handle)if(this.props.framebuffer){const s=this.props.framebuffer.colorAttachments.map((m,v)=>36064+v);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(r){}popDebugGroup(){}insertDebugMarker(r){}setParameters(r={}){const n={...this.glParameters};n.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(n.depthMask=!this.props.depthReadOnly),n.stencilMask=this.props.stencilReadOnly?0:1,n[35977]=this.props.discard,r.viewport&&(r.viewport.length>=6?(n.viewport=r.viewport.slice(0,4),n.depthRange=[r.viewport[4],r.viewport[5]]):n.viewport=r.viewport),r.scissorRect&&(n.scissorTest=!0,n.scissor=r.scissorRect),r.blendConstant&&(n.blendColor=r.blendConstant),r.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),r[2967]=r.stencilReference),r.colorMask&&(n.colorMask=hX.map(i=>!!(i&r.colorMask))),this.glParameters=n,f_(this.device.gl,n)}beginOcclusionQuery(r){const n=this.props.occlusionQuerySet;n==null||n.beginOcclusionQuery()}endOcclusionQuery(){const r=this.props.occlusionQuerySet;r==null||r.endOcclusionQuery()}clear(){const r={...this.glParameters};let n=0;this.props.clearColors&&this.props.clearColors.forEach((i,o)=>{i&&this.clearColorBuffer(o,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(n|=16384,r.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(n|=256,r.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(n|=1024,r.clearStencil=this.props.clearStencil),n!==0&&Z0(this.device.gl,r,()=>{this.device.gl.clear(n)})}clearColorBuffer(r=0,n=[0,0,0,0]){Z0(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(n.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,r,n);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,r,n);break;case Float32Array:this.device.gl.clearBufferfv(6144,r,n);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function dX(t){return pX.includes(t)}const pX=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],GF={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function YF(t){const e=GF[t];if(!e)throw new Error("uniform");const[r,n,,i]=e;return{format:i,components:n,glType:r}}function mX(t){const e=GF[t];if(!e)throw new Error("attribute");const[,r,,n,i]=e;return{attributeType:n,vertexFormat:i,components:r}}function gX(t,e){const r={attributes:[],bindings:[]};r.attributes=_X(t,e);const n=bX(t,e);for(const s of n){const m=s.uniforms.map(v=>({name:v.name,format:v.format,byteOffset:v.byteOffset,byteStride:v.byteStride,arrayLength:v.arrayLength}));r.bindings.push({type:"uniform",name:s.name,group:0,location:s.location,visibility:(s.vertex?1:0)&(s.fragment?2:0),minBindingSize:s.byteLength,uniforms:m})}const i=vX(t,e);let o=0;for(const s of i)if(dX(s.type)){const{viewDimension:m,sampleType:v}=wX(s.type);r.bindings.push({type:"texture",name:s.name,group:0,location:o,viewDimension:m,sampleType:v}),s.textureUnit=o,o+=1}i.length&&(r.uniforms=i);const c=yX(t,e);return c!=null&&c.length&&(r.varyings=c),r}function _X(t,e){const r=[],n=t.getProgramParameter(e,35721);for(let i=0;i<n;i++){const o=t.getActiveAttrib(e,i);if(!o)throw new Error("activeInfo");const{name:c,type:s}=o,m=t.getAttribLocation(e,c);if(m>=0){const{attributeType:v}=mX(s),w=/instance/i.test(c)?"instance":"vertex";r.push({name:c,location:m,stepMode:w,type:v})}}return r.sort((i,o)=>i.location-o.location),r}function yX(t,e){const r=[],n=t.getProgramParameter(e,35971);for(let i=0;i<n;i++){const o=t.getTransformFeedbackVarying(e,i);if(!o)throw new Error("activeInfo");const{name:c,type:s,size:m}=o,{glType:v,components:w}=YF(s),M={location:i,name:c,type:v,size:m*w};r.push(M)}return r.sort((i,o)=>i.location-o.location),r}function vX(t,e){const r=[],n=t.getProgramParameter(e,35718);for(let i=0;i<n;i++){const o=t.getActiveUniform(e,i);if(!o)throw new Error("activeInfo");const{name:c,size:s,type:m}=o,{name:v,isArray:w}=TX(c);let M=t.getUniformLocation(e,v);const I={location:M,name:v,size:s,type:m,isArray:w};if(r.push(I),I.size>1)for(let k=0;k<I.size;k++){const z=`${v}[${k}]`;M=t.getUniformLocation(e,z);const V={...I,name:z,location:M};r.push(V)}}return r}function bX(t,e){const r=(o,c)=>t.getActiveUniformBlockParameter(e,o,c),n=[],i=t.getProgramParameter(e,35382);for(let o=0;o<i;o++){const c={name:t.getActiveUniformBlockName(e,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},s=r(o,35395)||[],m=t.getActiveUniforms(e,s,35383),v=t.getActiveUniforms(e,s,35384),w=t.getActiveUniforms(e,s,35387),M=t.getActiveUniforms(e,s,35388);for(let I=0;I<c.uniformCount;++I){const k=t.getActiveUniform(e,s[I]);if(!k)throw new Error("activeInfo");c.uniforms.push({name:k.name,format:YF(m[I]).format,type:m[I],arrayLength:v[I],byteOffset:w[I],byteStride:M[I]})}n.push(c)}return n.sort((o,c)=>o.location-c.location),n}const xX={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function wX(t){const e=xX[t];if(!e)throw new Error("sampler");const[r,n]=e;return{viewDimension:r,sampleType:n}}function TX(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function SX(t,e,r,n){const i=t;let o=n;o===!0&&(o=1),o===!1&&(o=0);const c=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,n);case 5126:return t.uniform1fv(e,c);case 35664:return t.uniform2fv(e,c);case 35665:return t.uniform3fv(e,c);case 35666:return t.uniform4fv(e,c);case 5124:return t.uniform1iv(e,c);case 35667:return t.uniform2iv(e,c);case 35668:return t.uniform3iv(e,c);case 35669:return t.uniform4iv(e,c);case 35670:return t.uniform1iv(e,c);case 35671:return t.uniform2iv(e,c);case 35672:return t.uniform3iv(e,c);case 35673:return t.uniform4iv(e,c);case 5125:return i.uniform1uiv(e,c,1);case 36294:return i.uniform2uiv(e,c,2);case 36295:return i.uniform3uiv(e,c,3);case 36296:return i.uniform4uiv(e,c,4);case 35674:return t.uniformMatrix2fv(e,!1,c);case 35675:return t.uniformMatrix3fv(e,!1,c);case 35676:return t.uniformMatrix4fv(e,!1,c);case 35685:return i.uniformMatrix2x3fv(e,!1,c);case 35686:return i.uniformMatrix2x4fv(e,!1,c);case 35687:return i.uniformMatrix3x2fv(e,!1,c);case 35688:return i.uniformMatrix3x4fv(e,!1,c);case 35689:return i.uniformMatrix4x2fv(e,!1,c);case 35690:return i.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function AX(t){return CF(t)!==null||typeof t=="number"||typeof t=="boolean"}function EX(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{const n=t[r];AX(n)?e.uniforms[r]=n:e.bindings[r]=n}),e}function MX(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function PX(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const LR=4;class CX extends Ng{constructor(r,n){super(r,n);de(this,"device");de(this,"handle");de(this,"vs");de(this,"fs");de(this,"introspectedLayout");de(this,"uniforms",{});de(this,"bindings",{});de(this,"varyings",null);de(this,"_uniformCount",0);de(this,"_uniformSetters",{});this.device=r,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=n.vs,this.fs=n.fs;const{varyings:i,bufferMode:o=35981}=n;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,o)),this._linkShaders(),Qt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=gX(this.device.gl,this.handle),Qt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=RX(this.introspectedLayout,n.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(r,n){for(const[i,o]of Object.entries(r)){const c=this.shaderLayout.bindings.find(s=>s.name===i)||this.shaderLayout.bindings.find(s=>s.name===`${i}Uniforms`);if(!c){const s=this.shaderLayout.bindings.map(m=>`"${m.name}"`).join(", ");n!=null&&n.disableWarnings||Qt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${s}`,o)();continue}switch(o||Qt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),c.type){case"uniform":if(!(o instanceof Uy)&&!(o.buffer instanceof Uy))throw new Error("buffer value");break;case"texture":if(!(o instanceof Sg||o instanceof $y||o instanceof jy))throw new Error("texture value");break;case"sampler":Qt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(c.type)}this.bindings[i]=o}}draw(r){var U;const{renderPass:n,parameters:i=this.props.parameters,topology:o=this.props.topology,vertexArray:c,vertexCount:s,instanceCount:m,isInstanced:v=!1,firstVertex:w=0,transformFeedback:M}=r,I=MX(o),k=!!c.indexBuffer,z=(U=c.indexBuffer)==null?void 0:U.glIndexType;if(this.linkStatus!=="success")return Qt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Qt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),c.bindBeforeRender(n),M&&M.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const V=n;return XZ(this.device,i,V.glParameters,()=>{k&&v?this.device.gl.drawElementsInstanced(I,s||0,z,w,m||0):k?this.device.gl.drawElements(I,s||0,z,w):v?this.device.gl.drawArraysInstanced(I,w,s||0,m||0):this.device.gl.drawArrays(I,w,s||0),M&&M.end()}),c.unbindAfterRender(n),!0}setUniformsWebGL(r){const{bindings:n}=EX(r);Object.keys(n).forEach(i=>{Qt.warn(`Unsupported value "${JSON.stringify(n[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,r)}async _linkShaders(){const{gl:r}=this.device;if(r.attachShader(this.handle,this.vs.handle),r.attachShader(this.handle,this.fs.handle),Qt.time(LR,`linkProgram for ${this.id}`)(),r.linkProgram(this.handle),Qt.timeEnd(LR,`linkProgram for ${this.id}`)(),Qt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Qt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Qt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const n=this._getLinkStatus();this._reportLinkStatus(n)}async _reportLinkStatus(r){var n;switch(r){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((n=this.fs)==null?void 0:n.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${r}: ${i}`)}}_getLinkStatus(){const{gl:r}=this.device;return r.getProgramParameter(this.handle,35714)?(r.validateProgram(this.handle),r.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const r=async o=>await new Promise(c=>setTimeout(c,o));if(!this.device.features.has("compilation-status-async-webgl")){await r(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await r(10)}}_areTexturesRenderable(){let r=!0;for(const n of this.shaderLayout.bindings)!this.bindings[n.name]&&!this.bindings[n.name.replace(/Uniforms$/,"")]&&(Qt.warn(`Binding ${n.name} not found in ${this.id}`)(),r=!1);return r}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:r}=this.device;r.useProgram(this.handle);let n=0,i=0;for(const o of this.shaderLayout.bindings){const c=this.bindings[o.name]||this.bindings[o.name.replace(/Uniforms$/,"")];if(!c)throw new Error(`No value for binding ${o.name} in ${this.id}`);switch(o.type){case"uniform":const{name:s}=o,m=r.getUniformBlockIndex(this.handle,s);if(m===4294967295)throw new Error(`Invalid uniform block name ${s}`);r.uniformBlockBinding(this.handle,i,m),c instanceof Uy?r.bindBufferBase(35345,i,c.handle):r.bindBufferRange(35345,i,c.buffer.handle,c.offset||0,c.size||c.buffer.byteLength-c.offset),i+=1;break;case"texture":if(!(c instanceof Sg||c instanceof $y||c instanceof jy))throw new Error("texture");let v;if(c instanceof Sg)v=c.texture;else if(c instanceof $y)v=c;else if(c instanceof jy&&c.colorAttachments[0]instanceof Sg)Qt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),v=c.colorAttachments[0].texture;else throw new Error("No texture");r.activeTexture(33984+n),r.bindTexture(v.glTarget,v.handle),n+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${o.type}' not supported in WebGL`)}}}_applyUniforms(){for(const r of this.shaderLayout.uniforms||[]){const{name:n,location:i,type:o,textureUnit:c}=r,s=this.uniforms[n]??c;s!==void 0&&SX(this.device.gl,i,o,s)}}}function RX(t,e){const r={...t,attributes:t.attributes.map(n=>({...n}))};for(const n of(e==null?void 0:e.attributes)||[]){const i=r.attributes.find(o=>o.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Qt.warn(`shader layout attribute ${n.name} not present in shader`)}return r}class IX extends tE{constructor(r){super(r,{});de(this,"device");de(this,"commands",[]);this.device=r}submitCommands(r=this.commands){for(const n of r)switch(n.name){case"copy-buffer-to-buffer":OX(this.device,n.options);break;case"copy-buffer-to-texture":kX(this.device,n.options);break;case"copy-texture-to-buffer":DX(this.device,n.options);break;case"copy-texture-to-texture":NX(this.device,n.options);break;default:throw new Error(n.name)}}}function OX(t,e){const r=e.sourceBuffer,n=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,n.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function kX(t,e){throw new Error("Not implemented")}function DX(t,e){const{sourceTexture:r,mipLevel:n=0,aspect:i="all",width:o=e.sourceTexture.width,height:c=e.sourceTexture.height,depthOrArrayLayers:s=0,origin:m=[0,0],destinationBuffer:v,byteOffset:w=0,bytesPerRow:M,rowsPerImage:I}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||s!==0||M||I)throw new Error("not implemented");const{framebuffer:k,destroyFramebuffer:z}=KF(r);let V;try{const U=v,K=o||k.width,J=c||k.height,Z=$F(k.colorAttachments[0].texture.props.format),re=Z.format,W=Z.type;t.gl.bindBuffer(35051,U.handle),V=t.gl.bindFramebuffer(36160,k.handle),t.gl.readPixels(m[0],m[1],K,J,re,W,w)}finally{t.gl.bindBuffer(35051,null),V!==void 0&&t.gl.bindFramebuffer(36160,V),z&&k.destroy()}}function NX(t,e){const{sourceTexture:r,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:o=[0,0],destinationTexture:c}=e;let{width:s=e.destinationTexture.width,height:m=e.destinationTexture.height}=e;const{framebuffer:v,destroyFramebuffer:w}=KF(r),[M,I]=i,[k,z,V]=o,U=t.gl.bindFramebuffer(36160,v.handle);let K=null,J;if(c instanceof $y)K=c,s=Number.isFinite(s)?s:K.width,m=Number.isFinite(m)?m:K.height,K.bind(0),J=K.glTarget;else throw new Error("invalid destination");switch(J){case 3553:case 34067:t.gl.copyTexSubImage2D(J,n,k,z,M,I,s,m);break;case 35866:case 32879:t.gl.copyTexSubImage3D(J,n,k,z,V,M,I,s,m);break}K&&K.unbind(),t.gl.bindFramebuffer(36160,U),w&&v.destroy()}function KF(t){if(t instanceof Hi){const{width:e,height:r,id:n}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class BX extends eE{constructor(r,n){super(r,n);de(this,"device");de(this,"commandBuffer");this.device=r,this.commandBuffer=new IX(r)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(r){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:r})}copyBufferToTexture(r){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:r})}copyTextureToBuffer(r){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:r})}copyTextureToTexture(r){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:r})}pushDebugGroup(r){}popDebugGroup(){}insertDebugMarker(r){}resolveQuerySet(r,n,i){}}function LX(t){const{target:e,source:r,start:n=0,count:i=1}=t,o=r.length,c=i*o;let s=0;for(let m=n;s<o;s++)e[m++]=r[s];for(;s<c;)s<c-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+c-s),s=c);return t.target}class SP extends rE{constructor(r,n){super(r,n);de(this,"device");de(this,"handle");de(this,"buffer",null);de(this,"bufferValue",null);this.device=r,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(r){return s5()==="Chrome"}destroy(){var r;super.destroy(),this.buffer&&((r=this.buffer)==null||r.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(r){const n=r;if(n&&n.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,n?n.handle:null),this.indexBuffer=n,this.device.gl.bindVertexArray(null)}setBuffer(r,n){const i=n;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:o,type:c,stride:s,offset:m,normalized:v,integer:w,divisor:M}=this._getAccessor(r);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),w?this.device.gl.vertexAttribIPointer(r,o,c,s,m):this.device.gl.vertexAttribPointer(r,o,c,v,s,m),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(r),this.device.gl.vertexAttribDivisor(r,M||0),this.attributes[r]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(r,n){this._enable(r,!1),this.attributes[r]=n}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let r=0;r<this.maxVertexAttributes;++r){const n=this.attributes[r];ArrayBuffer.isView(n)&&this.device.setConstantAttributeWebGL(r,n)}}_getAccessor(r){const n=this.attributeInfos[r];if(!n)throw new Error(`Unknown attribute location ${r}`);const i=UF(n.bufferDataType);return{size:n.bufferComponents,type:i,stride:n.byteStride,offset:n.byteOffset,normalized:n.normalized,integer:n.integer,divisor:n.stepMode==="instance"?1:0}}_enable(r,n=!0){const o=SP.isConstantAttributeZeroSupported(this.device)||r!==0;(n||o)&&(r=Number(r),this.device.gl.bindVertexArray(this.handle),n?this.device.gl.enableVertexAttribArray(r):this.device.gl.disableVertexAttribArray(r),this.device.gl.bindVertexArray(null))}getConstantBuffer(r,n){const i=FX(n),o=i.byteLength*r,c=i.length*r;if(this.buffer&&o!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${o} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:o}),s=s||!zX(i,this.bufferValue),s){const m=WV(n.constructor,c);LX({target:m,source:i,start:0,count:c}),this.buffer.write(m),this.bufferValue=n}return this.buffer}}function FX(t){return Array.isArray(t)?new Float32Array(t):t}function zX(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}class jX extends nE{constructor(r,n){super(r,n);de(this,"device");de(this,"gl");de(this,"handle");de(this,"layout");de(this,"buffers",{});de(this,"unusedBuffers",{});de(this,"bindOnUse",!0);de(this,"_bound",!1);this.device=r,this.gl=r.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,n.buffers&&this.setBuffers(n.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(r="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(PX(r))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(r){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const n in r)this.setBuffer(n,r[n])})}setBuffer(r,n){const i=this._getVaryingIndex(r),{buffer:o,byteLength:c,byteOffset:s}=this._getBufferRange(n);if(i<0){this.unusedBuffers[r]=o,Qt.warn(`${this.id} unusedBuffers varying buffer ${r}`)();return}this.buffers[i]={buffer:o,byteLength:c,byteOffset:s},this.bindOnUse||this._bindBuffer(i,o,s,c)}getBuffer(r){if(FR(r))return this.buffers[r]||null;const n=this._getVaryingIndex(r);return n>=0?this.buffers[n]:null}bind(r=this.handle){if(typeof r!="function")return this.gl.bindTransformFeedback(36386,r),this;let n;return this._bound?n=r():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,n=r(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),n}unbind(){this.bind(null)}_getBufferRange(r){if(r instanceof Uy)return{buffer:r,byteOffset:0,byteLength:r.byteLength};const{buffer:n,byteOffset:i=0,byteLength:o=r.buffer.byteLength}=r;return{buffer:n,byteOffset:i,byteLength:o}}_getVaryingIndex(r){if(FR(r))return Number(r);for(const n of this.layout.varyings)if(r===n.name)return n.location;return-1}_bindBuffers(){for(const r in this.buffers){const{buffer:n,byteLength:i,byteOffset:o}=this._getBufferRange(this.buffers[r]);this._bindBuffer(Number(r),n,o,i)}}_unbindBuffers(){for(const r in this.buffers)this.gl.bindBufferBase(35982,Number(r),null)}_bindBuffer(r,n,i=0,o){const c=n&&n.handle;!c||o===void 0?this.gl.bindBufferBase(35982,r,c):this.gl.bindBufferRange(35982,r,c,i,o)}}function FR(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class UX extends iE{constructor(r,n){super(r,n);de(this,"device");de(this,"handle");de(this,"target",null);de(this,"_queryPending",!1);de(this,"_pollingPromise",null);if(this.device=r,n.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(r){return this._begin(r!=null&&r.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(r){this._queryPending||(this.target=r,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const r=this.device.gl.getQueryParameter(this.handle,34919);return r&&(this._queryPending=!1),r}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(r=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const c=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>r?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(c)}),this._pollingPromise}}class Ag extends dd{constructor(r){var M,I;super({...r,id:r.id||VZ("webgl-device")});de(this,"type","webgl");de(this,"handle");de(this,"features");de(this,"limits");de(this,"info");de(this,"canvasContext");de(this,"lost");de(this,"_resolveContextLost");de(this,"gl");de(this,"debug",!1);de(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});de(this,"_extensions",{});de(this,"_polyfilled",!1);de(this,"spectorJS");de(this,"renderPass",null);de(this,"_constants");const n=dd._getCanvasContextProps(r);if(!n)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(I=(M=n.canvas)==null?void 0:M.gl)==null?void 0:I.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new OZ(this,n),this.lost=new Promise(k=>{this._resolveContextLost=k});const o={...r.webgl};n.alphaMode==="premultiplied"&&(o.premultipliedAlpha=!0),r.powerPreference!==void 0&&(o.powerPreference=r.powerPreference);const s=this.props._handle||fZ(this.canvasContext.canvas,{onContextLost:k=>{var z;return(z=this._resolveContextLost)==null?void 0:z.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:k=>console.log("WebGL context restored")},o);if(!s)throw new Error("WebGL context creation failed");if(i=s.device,i){if(r._reuseDevices)return Qt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=s,this.gl=s,this.spectorJS=NZ({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=dZ(this.gl,this._extensions),this.limits=new CZ(this.gl),this.features=new PZ(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),n.autoResize!==!1&&this.canvasContext.resize(),new Up(this.gl,{log:(...k)=>Qt.log(1,...k)()}).trackState(this.gl,{copyState:!1});const v=r.debugWebGL||r.debug,w=r.debugWebGL;v&&(this.gl=FZ(this.gl,{debugWebGL:v,traceWebGL:w}),Qt.warn("WebGL debug mode activated. Performance reduced.")(),r.debugWebGL&&(Qt.level=Math.max(Qt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(r){throw new Error("WebGL only supports a single canvas")}createBuffer(r){const n=this._normalizeBufferProps(r);return new Uy(this,n)}createTexture(r){return new $y(this,r)}createExternalTexture(r){throw new Error("createExternalTexture() not implemented")}createSampler(r){return new SE(this,r)}createShader(r){return new ZZ(this,r)}createFramebuffer(r){return new jy(this,r)}createVertexArray(r){return new SP(this,r)}createTransformFeedback(r){return new jX(this,r)}createQuerySet(r){return new UX(this,r)}createRenderPipeline(r){return new CX(this,r)}beginRenderPass(r){return new fX(this,r)}createComputePipeline(r){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(r){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(r={}){return new BX(this,r)}submit(){var r;(r=this.renderPass)==null||r.end(),this.renderPass=null}readPixelsToArrayWebGL(r,n){return oX(r,n)}readPixelsToBufferWebGL(r,n){return lX(r,n)}setParametersWebGL(r){f_(this.gl,r)}getParametersWebGL(r){return zF(this.gl,r)}withParametersWebGL(r,n){return Z0(this.gl,r,n)}resetWebGL(){Qt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),oZ(this.gl)}_getDeviceSpecificTextureFormatCapabilities(r){return SZ(this.gl,r,this._extensions)}loseDevice(){var o;let r=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(r=!0,i.loseContext()),(o=this._resolveContextLost)==null||o.call(this,{reason:"destroyed",message:"Application triggered context loss"}),r}pushState(){Up.get(this.gl).push()}popState(){Up.get(this.gl).pop()}setSpectorMetadata(r,n){r.__SPECTOR_Metadata=n}getGLKey(r,n){const i=Number(r);for(const o in this.gl)if(this.gl[o]===i)return`GL.${o}`;return n!=null&&n.emptyIfUnknown?"":String(r)}getGLKeys(r){const n={emptyIfUnknown:!0};return Object.entries(r).reduce((i,[o,c])=>(i[`${o}:${this.getGLKey(o,n)}`]=`${c}:${this.getGLKey(c,n)}`,i),{})}setConstantAttributeWebGL(r,n){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const o=this._constants[r];switch(o&&HX(o,n)&&Qt.info(1,`setConstantAttributeWebGL(${r}) could have been skipped, value unchanged`)(),this._constants[r]=n,n.constructor){case Float32Array:$X(this,r,n);break;case Int32Array:VX(this,r,n);break;case Uint32Array:qX(this,r,n);break;default:throw new Error("constant")}}getExtension(r){return qg(this.gl,r,this._extensions),this._extensions}}function $X(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break}}function VX(t,e,r){t.gl.vertexAttribI4iv(e,r)}function qX(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function HX(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}const WX={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},ZX=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),XX=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),GX=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function YX(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&KX(i),i}return this.originalGetContext(r,n)}}function KX(t){t.getExtension("EXT_color_buffer_float");const e={...WX,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:ZX(t),OES_vertex_array_object:XX(t),ANGLE_instanced_arrays:GX(t)},r=t.getExtension;t.getExtension=function(i){const o=r.call(t,i);return o||(i in e?e[i]:null)};const n=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=n.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const e0=1;class QX extends wV{constructor(){super();de(this,"type","webgl");dd.defaultProps={...dd.defaultProps,...TP},Ag.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(r){YX(r)}async attach(r){if(r instanceof Ag)return r;if((r==null?void 0:r.device)instanceof dd)return r.device;if(!JX(r))throw new Error("Invalid WebGL2RenderingContext");return new Ag({_handle:r,createCanvasContext:{canvas:r.canvas,autoResize:!1}})}async create(r={}){Qt.groupCollapsed(e0,"WebGLDevice created")();const n=[];(r.debugWebGL||r.debug)&&n.push(LZ()),r.debugSpectorJS&&n.push(DZ(r));const i=await Promise.allSettled(n);for(const s of i)s.status==="rejected"&&Qt.error(`Failed to initialize debug libraries ${s.reason}`)();const o=new Ag(r),c=`${o._reused?"Reusing":"Created"} device with WebGL2 ${o.debug?"debug ":""}context: ${o.info.vendor}, ${o.info.renderer} for canvas: ${o.canvasContext.id}`;return Qt.probe(e0,c)(),Qt.table(e0,o.info)(),Qt.groupEnd(e0)(),o}}function JX(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const zR=new QX;function nd(){}const eG=({isDragging:t})=>t?"grabbing":"grab",QF={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:nd,onWebGLInitialized:nd,onResize:nd,onViewStateChange:nd,onInteractionStateChange:nd,onBeforeRender:nd,onAfterRender:nd,onLoad:nd,onError:t=>oi.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:eG,getTooltip:null,debug:!1,drawPickingColors:!1};class AP{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new l1({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=dE[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const c=this.layerManager.getLayers(),s=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:c,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:m}=s,v=m&&(m[i]||m.props[i]),w=this.props[i];let M=!1;v&&(M=v.call(m,s,n)),M||(w==null||w(s,n),this.widgetManager.onEvent(s,n))},this._onPointerDown=n=>{var c;if(((c=this.device)==null?void 0:c.type)==="webgpu")return;const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...QF,...e},e=this.props,e.viewState&&e.initialViewState&&oi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&oi.error("WebGL1 context not supported.")(),r=zR.attach(e.gl)),r||(r=KA.createDevice({type:"best-available",_reuseDevices:!0,adapters:[zR],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Qy.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,r,n,i,o,c,s,m,v,w;(e=this.animationLoop)==null||e.stop(),(r=this.animationLoop)==null||r.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)==null||n.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(o=this.effectManager)==null||o.finalize(),this.effectManager=null,(c=this.deckRenderer)==null||c.finalize(),this.deckRenderer=null,(s=this.deckPicker)==null||s.finalize(),this.deckPicker=null,(m=this.eventManager)==null||m.destroy(),this.eventManager=null,(v=this.widgetManager)==null||v.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((w=this.canvas.parentElement)==null||w.removeChild(this.canvas),this.canvas=null)}setProps(e){var n;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&oi.removed("onLayerHover","onHover")(),"onLayerClick"in e&&oi.removed("onLayerClick","onClick")(),e.initialViewState&&!qc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(n=this.animationLoop)==null||n.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return r=r||n||i||o||c,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return Cs(this.viewManager),this.viewManager.views}getViewports(e){return Cs(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:r})}_removeResources(e){for(const r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var r;(r=this.layerManager)==null||r.removeDefaultShaderModule(e)}_pick(e,r,n){Cs(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(r).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(r).timeEnd(),o}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),Cs(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:r,height:n}=e;if(r||r===0){const o=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=o}if(n||n===0){const o=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var i,o;const{canvas:e}=this;if(!e)return;const r=e.clientWidth??e.width,n=e.clientHeight??e.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,(i=this.viewManager)==null||i.setProps({width:r,height:n}),(o=this.layerManager)==null||o.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(e,r){const{gl:n,onError:i,useDevicePixels:o}=r;return new rW({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:c=>this._setDevice(c.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new BF({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var r,n,i,o;if(((r=this.device)==null?void 0:r.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:c,emptyInfo:s}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=c.length>0;let m=s,v=!1;for(const w of c)m=w,v=((n=w.layer)==null?void 0:n.onHover(w,e.event))||v;v||((o=(i=this.props).onHover)==null||o.call(i,m,e.event),this.widgetManager.onHover(m,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,o;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const r=new PF;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new R7(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(aR).map(c=>{var k;const[s,m,v,w]=aR[c],M=(k=this.props.eventRecognizerOptions)==null?void 0:k[c],I={...m,...M,event:c};return{recognizer:new s(I),recognizeWith:v,requestFailure:w}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const c in dE)this.eventManager.on(c,this._onEvent);this.viewManager=new MW({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new EW(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new VW({deck:this,device:this.device}),this.deckRenderer=new WW(this.device),this.deckPicker=new QW(this.device),this.widgetManager=new tZ({deck:this,parentElement:(o=this.canvas)==null?void 0:o.parentElement}),this.widgetManager.addDefault(new nZ),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){var c;const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};(c=this.deckRenderer)==null||c.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),oi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();const n=KA.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}AP.defaultProps=QF;AP.VERSION=M$;function tG(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return DL(t)}}const rG=kL;function t0(t,e,r){const n=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function kp(t){return t.stride||t.size*t.bytesPerElement}function nG(t,e){return t.type===e.type&&t.size===e.size&&kp(t)===kp(e)&&(t.offset||0)===(e.offset||0)}function AE(t,e){e.offset&&oi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const r=kp(t),n=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,o=n*r+i*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:r}}function iG(t,e){const r=AE(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}class aG{constructor(e,r,n){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;const i=r.logicalType||r.type,o=i==="float64";let{defaultValue:c}=r;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let s;o?s="float32":!i&&r.isIndexed?s="uint32":s=i||"float32";let m=tG(i||s);this.doublePrecision=o,o&&r.fp64===!1&&(m=Float32Array),this.value=null,this.settings={...r,defaultType:m,defaultValue:c,logicalType:i,type:s,normalized:s.includes("norm"),size:this.size,bytesPerElement:m.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*kp(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Qy.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){const n={};if(this.state.constant){const i=this.value;if(r){const o=AE(this.getAccessor(),r),c=o.offset/i.BYTES_PER_ELEMENT,s=o.size||this.size;n[e]=i.subarray(c,c+s)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,r=null){const n=this.getAccessor(),i=[],o={name:this.id,byteStride:kp(n),attributes:i};if(this.doublePrecision){const c=iG(n,r||{});i.push(t0(e,{...n,...c.high},this.device.type),t0(`${e}64Low`,{...n,...c.low},this.device.type))}else if(r){const c=AE(n,r);i.push(t0(e,{...n,...c},this.device.type))}else i.push(t0(e,n,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const r=Array.from(this.value);e=[r,r]}else{const{value:r,numInstances:n,size:i}=this,o=n*i;if(r&&o&&r.length>=o){const c=new Array(i).fill(1/0),s=new Array(i).fill(-1/0);for(let m=0;m<o;)for(let v=0;v<i;v++){const w=r[m++];w<c[v]&&(c[v]=w),w>s[v]&&(s[v]=w)}e=[c,s]}}return this.state.bounds=e,e}setData(e){const{state:r}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof Ti?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const c=rG(n.value);i.type=i.normalized?c.replace("int","norm"):c}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=kp(i)}if(r.bounds=null,n.constant){let o=n.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(n.buffer){const o=n.buffer;r.externalBuffer=o,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let o=n.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:c}=this;const s=kp(i),m=(i.vertexOffset||0)*s;if(this.doublePrecision&&o instanceof Float64Array&&(o=Ow(o,i)),this.settings.isIndexed){const w=this.settings.defaultType;o.constructor!==w&&(o=new w(o))}const v=o.byteLength+m+s*2;(!c||c.byteLength<v)&&(c=this._createBuffer(v)),c.write(o,m)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const r=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?Ow(r,{size:this.size,startIndex:n,endIndex:i}):r.subarray(n,i),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){const{state:n}=this,i=n.allocatedValue,o=Qy.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;const{byteOffset:c}=this;let{buffer:s}=this;return(!s||s.byteLength<o.byteLength+c)&&(s=this._createBuffer(o.byteLength+c),r&&i&&s.write(i instanceof Float64Array?Ow(i,this):i,c)),n.allocatedValue=o,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=r.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in e)&&oi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,n){const{defaultValue:i,size:o}=this.settings;if(Number.isFinite(e))return r[n]=e,r;if(!e){let c=o;for(;--c>=0;)r[n+c]=i[c];return r}switch(o){case 4:r[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:r[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:r[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:r[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let c=o;for(;--c>=0;)r[n+c]=Number.isFinite(e[c])?e[c]:i[c]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==r[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(r?Ti.INDEX:Ti.VERTEX)|Ti.COPY_DST,indexType:r?n:void 0,byteLength:e}),this._buffer}}const jR=[],UR=[];function sG(t,e=0,r=1/0){let n=jR;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(UR.length=t.length,n=UR):n=jR,(e>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,r),i.index=e-1),{iterable:n,objectInfo:i}}function JF(t){return t&&t[Symbol.asyncIterator]}function oG(t,e){const{size:r,stride:n,offset:i,startIndices:o,nested:c}=e,s=t.BYTES_PER_ELEMENT,m=n?n/s:r,v=i?i/s:0,w=Math.floor((t.length-v)/m);return(M,{index:I,target:k})=>{if(!o){const K=I*m+v;for(let J=0;J<r;J++)k[J]=t[K+J];return k}const z=o[I],V=o[I+1]||w;let U;if(c){U=new Array(V-z);for(let K=z;K<V;K++){const J=K*m+v;k=new Array(r);for(let Z=0;Z<r;Z++)k[Z]=t[J+Z];U[K-z]=k}}else if(m===r)U=t.subarray(z*r+v,V*r+v);else{U=new t.constructor((V-z)*r);let K=0;for(let J=z;J<V;J++){const Z=J*m+v;for(let re=0;re<r;re++)U[K++]=t[Z+re]}}return U}}const lG=[],x0=[[0,1/0]];function cG(t,e){if(t===x0||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const r=[],n=t.length;let i=0;for(let o=0;o<n;o++){const c=t[o];c[1]<e[0]?(r.push(c),i=o+1):c[0]>e[1]?r.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return r.splice(i,0,e),r}const uG={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function e6(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const r=t.type||"interpolation";return{...uG[r],...e,...t,type:r}}class t6 extends aG{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:x0}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!nG(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:r}=this.settings,n=this.settings.transition,i=Array.isArray(r)?e[r.find(o=>e[o])]:e[r];return e6(i,n)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){const{startRow:n=0,endRow:i=1/0}=r;this.state.updateRanges=cG(this.state.updateRanges,[n,i])}else this.state.updateRanges=x0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=lG}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,r.updateRanges!==x0),!0):!1}updateBuffer({numInstances:e,data:r,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:c,noAlloc:s}}=this;let m=!0;if(c){for(const[v,w]of o)c.call(i,this,{data:r,startRow:v,endRow:w,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[v,w]of o){const M=Number.isFinite(v)?this.getVertexOffset(v):0,I=Number.isFinite(w)?this.getVertexOffset(w):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:M,endOffset:I})}this._checkAttributeArray()}else m=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),m}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;Cs(ArrayBuffer.isView(c.value),`invalid ${i.accessor}`);const s=!!c.size&&c.size!==this.size;return n.binaryAccessor=oG(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:r,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(const n in e)Object.assign(r,super.getValue(n,e[n]));return r}getBufferLayout(e){this.state.layoutChanged=!1;const r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!r)return n;for(const o in r){const c=super._getBufferLayout(o,r[o]);n.attributes.push(...c.attributes)}return n}_autoUpdater(e,{data:r,startRow:n,endRow:i,props:o,numInstances:c}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:s,state:m,value:v,size:w,startIndices:M}=e,{accessor:I,transform:k}=s;let z=m.binaryAccessor||(typeof I=="function"?I:o[I]);typeof z!="function"&&(z=()=>z),Cs(typeof z=="function",`accessor "${I}" is not a function`);let V=e.getVertexOffset(n);const{iterable:U,objectInfo:K}=sG(r,n,i);for(const J of U){K.index++;let Z=z(J,K);if(k&&(Z=k.call(this,Z)),M){const re=(K.index<M.length-1?M[K.index+1]:c)-M[K.index];if(Z&&Array.isArray(Z[0])){let W=V;for(const Y of Z)e._normalizeValue(Y,v,W),W+=w}else Z&&Z.length>w?v.set(Z,V):(e._normalizeValue(Z,K.target,0),xW({target:v,source:K.target,start:V,count:re}));V+=re*w}else e._normalizeValue(Z,v,V),V+=w}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Uw(t){const{source:e,target:r,start:n=0,size:i,getData:o}=t,c=t.end||r.length,s=e.length,m=c-n;if(s>m){r.set(e.subarray(0,m),n);return}if(r.set(e,n),!o)return;let v=s;for(;v<m;){const w=o(v,e);for(let M=0;M<i;M++)r[n+v]=w[M]||0,v++}}function hG({source:t,target:e,size:r,getData:n,sourceStartIndices:i,targetStartIndices:o}){if(!i||!o)return Uw({source:t,target:e,size:r,getData:n}),e;let c=0,s=0;const m=n&&((w,M)=>n(w+s,M)),v=Math.min(i.length,o.length);for(let w=1;w<v;w++){const M=i[w]*r,I=o[w]*r;Uw({source:t.subarray(c,M),target:e,start:s,end:I,size:r,getData:m}),c=M,s=I}return s<e.length&&Uw({source:[],target:e,start:s,size:r,getData:m}),e}function fG(t){const{device:e,settings:r,value:n}=t,i=new t6(e,r);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),i}function r6(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function n6(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function i6(t){t.push(t.shift())}function dG(t,e){const{doublePrecision:r,settings:n,value:i,size:o}=t,c=r&&i instanceof Float64Array?2:1;let s=0;const{shaderAttributes:m}=t.settings;if(m)for(const v of Object.values(m))s=Math.max(s,v.vertexOffset??0);return(n.noAlloc?i.length:(e+s)*o)*c}function a6({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r==null||r.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function s6({device:t,buffer:e,attribute:r,fromLength:n,toLength:i,fromStartIndices:o,getData:c=s=>s}){const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,m=r.size*s,v=r.byteOffset,w=r.settings.bytesPerElement<4?v/r.settings.bytesPerElement*4:v,M=r.startIndices,I=o&&M,k=r.isConstant;if(!I&&e&&n>=i)return e;const z=r.value instanceof Float64Array?Float32Array:r.value.constructor,V=k?r.value:new z(r.getBuffer().readSyncWebGL(v,i*z.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!k){const Z=c;c=(re,W)=>r.normalizeConstant(Z(re,W))}const U=k?(Z,re)=>c(V,re):(Z,re)=>c(V.subarray(Z+v,Z+v+m),re),K=e?new Float32Array(e.readSyncWebGL(w,n*4).buffer):new Float32Array(0),J=new Float32Array(i);return hG({source:K,target:J,sourceStartIndices:o,targetStartIndices:M,size:m,getData:U}),(!e||e.byteLength<J.byteLength+w)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:J.byteLength+w,usage:35050})),e.write(J,w),e}class o6{constructor({device:e,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new d1(n),this.attribute=r,this.attributeInTransition=fG(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=dG(this.attribute,r),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class pG extends o6{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="interpolation",this.transform=yG(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:c}=this;i6(o),o[0]=s6({device:this.device,buffer:o[0],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),o[1]=a6({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:s}=this,m=s.model;let v=Math.floor(this.currentLength/c.size);l6(c)&&(v/=2),m.setVertexCount(v),c.isConstant?(m.setAttributes({aFrom:o[0]}),m.setConstantAttributes({aTo:c.value})):m.setAttributes({aFrom:o[0],aTo:c.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:r}=this.settings,{time:n}=this.transition;let i=n/e;r&&(i=r(i));const{model:o}=this.transform,c={time:i};o.shaderInputs.setProps({interpolation:c}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const mG=`uniform interpolationUniforms {
  float time;
} interpolation;
`,$R={name:"interpolation",vs:mG,uniformTypes:{time:"f32"}},gG=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,_G=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function l6(t){return t.doublePrecision&&t.value instanceof Float64Array}function yG(t,e){const r=e.size,n=r6(r),i=n6(r),o=e.getBufferLayout();return l6(e)?new ev(t,{vs:_G,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*r}]}],modules:[P9,$R],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new ev(t,{vs:gG,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:o.attributes[0].format}],modules:[$R],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class vG extends o6{constructor({device:e,attribute:r,timeline:n}){super({device:e,attribute:r,timeline:n}),this.type="spring",this.texture=AG(e),this.framebuffer=EG(e,this.texture),this.transform=SG(e,r)}start(e,r){const n=this.currentLength,i=this.currentStartIndices;super.start(e,r);const{buffers:o,attribute:c}=this;for(let m=0;m<2;m++)o[m]=s6({device:this.device,buffer:o[m],attribute:c,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});o[2]=a6({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?s.setConstantAttributes({aTo:c.value}):s.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:r,framebuffer:n,transition:i}=this,o=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});const c={stiffness:o.stiffness,damping:o.damping};r.model.shaderInputs.setProps({spring:c}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),i6(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const bG=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,xG={name:"spring",vs:bG,uniformTypes:{damping:"f32",stiffness:"f32"}},wG=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,TG=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function SG(t,e){const r=r6(e.size),n=n6(e.size);return new ev(t,{vs:wG,fs:TG,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[xG],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function AG(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function EG(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const MG={interpolation:pG,spring:vG};class PG{constructor(e,{id:r,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:n}){this.numInstances=n||1;for(const i in e){const o=e[i],c=o.getTransitionSetting(r);c&&this._updateAttribute(i,o,c)}for(const i in this.transitions){const o=e[i];(!o||!o.getTransitionSetting(r))&&this._removeTransition(i)}}hasAttribute(e){const r=this.transitions[e];return r&&r.inProgress}getAttributes(){const e={};for(const r in this.transitions){const n=this.transitions[r];n.inProgress&&(e[r]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,n){const i=this.transitions[e];let o=!i||i.type!==n.type;if(o){i&&this._removeTransition(e);const c=MG[n.type];c?this.transitions[e]=new c({attribute:r,timeline:this.timeline,device:this.device}):(oi.error(`unsupported transition type '${n.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const VR="attributeManager.invalidate",CG="attributeManager.updateStart",RG="attributeManager.updateEnd",IG="attribute.updateStart",OG="attribute.allocate",kG="attribute.updateEnd";class DG{constructor(e,{id:r="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=$v(VH),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new PG(e,{id:`${r}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){const n=this._invalidateTrigger(e,r);Xs(VR,this,e,n)}invalidateAll(e){for(const r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);Xs(VR,this,"all")}update({data:e,numInstances:r,startIndices:n=null,transitions:i,props:o={},buffers:c={},context:s={}}){let m=!1;Xs(CG,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const v in this.attributes){const w=this.attributes[v],M=w.settings.accessor;w.startIndices=n,w.numInstances=r,o[v]&&oi.removed(`props.${v}`,`data.attributes.${v}`)(),w.setExternalBuffer(c[v])||w.setBinaryValue(typeof M=="string"?c[M]:void 0,e.startIndices)||typeof M=="string"&&!c[M]&&w.setConstantValue(o[M])||w.needsUpdate()&&(m=!0,this._updateAttribute({attribute:w,numInstances:r,data:e,props:o,context:s})),this.needsRedraw=this.needsRedraw||w.needsRedraw()}m&&Xs(RG,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const r=e.map(n=>{var i;return(i=this.attributes[n])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:r,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const o in r){const c=r[o];c.needsRedraw(e)&&!n.hasAttribute(o)&&(i[o]=c)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(const n in e){const i=e[n],o={...i,id:n,size:i.isIndexed&&1||i.size||1,...r};this.attributes[n]=new t6(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){const{attributes:n,updateTriggers:i}=this,o=i[e];return o&&o.forEach(c=>{const s=n[c];s&&s.setNeedsUpdate(s.id,r)}),o}_updateAttribute(e){const{attribute:r,numInstances:n}=e;if(Xs(IG,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&Xs(OG,r,n),r.updateBuffer(e)&&(this.needsRedraw=!0,Xs(kG,r,n))}}class NG extends d1{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:r,toValue:n,duration:i,easing:o}}=this,c=o(e/i);this._value=j0(r,n,c)}}const qR=1e-5;function HR(t,e,r,n,i){const o=e-t,s=(r-e)*i,m=-o*n;return s+m+o+e}function BG(t,e,r,n,i){if(Array.isArray(r)){const o=[];for(let c=0;c<r.length;c++)o[c]=HR(t[c],e[c],r[c],n,i);return o}return HR(t,e,r,n,i)}function WR(t,e){if(Array.isArray(t)){let r=0;for(let n=0;n<t.length;n++){const i=t[n]-e[n];r+=i*i}return Math.sqrt(r)}return Math.abs(t-e)}class LG extends d1{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:r,damping:n,stiffness:i}=this.settings,{_prevValue:o=e,_currValue:c=e}=this;let s=BG(o,c,r,n,i);const m=WR(s,r),v=WR(s,c);m<qR&&v<qR&&(s=r,this.end()),this._prevValue=c,this._currValue=s}}const FG={interpolation:NG,spring:LG};class zG{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,n,i){const{transitions:o}=this;if(o.has(e)){const m=o.get(e),{value:v=m.settings.fromValue}=m;r=v,this.remove(e)}if(i=e6(i),!i)return;const c=FG[i.type];if(!c){oi.error(`unsupported transition type '${i.type}'`)();return}const s=new c(this.timeline);s.start({...i,fromValue:r,toValue:n}),o.set(e,s)}remove(e){const{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){const e={};for(const[r,n]of this.transitions)n.update(),e[r]=n.value,n.inProgress||this.remove(r);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function jG(t){const e=t[jp];for(const r in e){const n=e[r],{validate:i}=n;if(i&&!i(t[r],n))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function UG(t,e){const r=c6({newProps:t,oldProps:e,propTypes:t[jp],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=VG(t,e);let i=!1;return n||(i=qG(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:HG(t,e),transitionsChanged:$G(t,e)}}function $G(t,e){if(!t.transitions)return!1;const r={},n=t[jp];let i=!1;for(const o in t.transitions){const c=n[o],s=c&&c.type;(s==="number"||s==="color"||s==="array")&&EE(t[o],e[o],c)&&(r[o]=!0,i=!0)}return i?r:!1}function c6({newProps:t,oldProps:e,ignoreProps:r={},propTypes:n={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${i}.${o} added`;const c=EE(t[o],e[o],n[o]);if(c)return`${i}.${o} ${c}`}for(const o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${i}.${o} dropped`;if(!Object.hasOwnProperty.call(t,o)){const c=EE(t[o],e[o],n[o]);if(c)return`${i}.${o} ${c}`}}return!1}function EE(t,e,r){let n=r&&r.equal;return n&&!n(t,e,r)||!n&&(n=t&&e&&t.equals,n&&!n.call(t,e))?"changed deeply":!n&&e!==t?"changed shallowly":null}function VG(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1;const{dataComparator:n,_dataDiff:i}=t;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&i&&(r=i(t.data,e.data)||r),r}function qG(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&ZR(t,e,"all"))return{all:!0};const r={};let n=!1;for(const i in t.updateTriggers)i!=="all"&&ZR(t,e,i)&&(r[i]=!0,n=!0);return n?r:!1}function HG(t,e){if(e===null)return!0;const r=e.extensions,{extensions:n}=t;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function ZR(t,e,r){let n=t.updateTriggers[r];n=n??{};let i=e.updateTriggers[r];return i=i??{},c6({oldProps:i,newProps:n,triggerName:r})}const WG="count(): argument not an object",ZG="count(): argument not a container";function XG(t){if(!YG(t))throw new Error(WG);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(GG(t))return Object.keys(t).length;throw new Error(ZG)}function GG(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function YG(t){return t!==null&&typeof t=="object"}function XR(t,e){if(!e)return t;const r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=r.modules.findIndex(i=>i.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{const n={...t.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];r.inject=n}return r}const KG={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},ME={};function QG(t,e,r,n){if(r instanceof Hi)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let i=null;r.compressed&&(i={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});const o=e.createTexture({...r,sampler:{...KG,...i,...n},mipmaps:!0});return ME[o.id]=t,o}function JG(t,e){!e||!(e instanceof Hi)||ME[e.id]===t&&(e.delete(),delete ME[e.id])}const eY={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||PE(t)&&(t.length===3||t.length===4)},equal(t,e,r){return qc(t,e,1)}},accessor:{validate(t,e){const r=X0(t);return r==="function"||r===X0(e.value)},equal(t,e,r){return typeof e=="function"?!0:qc(t,e,1)}},array:{validate(t,e){return e.optional&&!t||PE(t)},equal(t,e,r){const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?qc(t,e,i):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;const{compare:n}=r,i=Number.isInteger(n)?n:n?1:0;return n?qc(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;const{dataTransform:n}=r.props;return n?n(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{const n=r.context;return!n||!n.device?null:QG(r.id,n.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{JG(r.id,t)}}};function tY(t){const e={},r={},n={};for(const[i,o]of Object.entries(t)){const c=o==null?void 0:o.deprecatedFor;if(c)n[i]=Array.isArray(c)?c:[c];else{const s=rY(i,o);e[i]=s,r[i]=s.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}function rY(t,e){switch(X0(e)){case"object":return yy(t,e);case"array":return yy(t,{type:"array",value:e,compare:!1});case"boolean":return yy(t,{type:"boolean",value:e});case"number":return yy(t,{type:"number",value:e});case"function":return yy(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function yy(t,e){return"type"in e?{name:t,...eY[e.type],...e}:"value"in e?{name:t,type:X0(e.value),...e}:{name:t,type:"object",value:e}}function PE(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function X0(t){return PE(t)?"array":t===null?"null":typeof t}function nY(t,e){let r;for(let o=e.length-1;o>=0;o--){const c=e[o];"extensions"in c&&(r=c.extensions)}const n=CE(t.constructor,r),i=Object.create(n);i[W0]=t,i[Zp]={},i[hd]={};for(let o=0;o<e.length;++o){const c=e[o];for(const s in c)i[s]=c[s]}return Object.freeze(i),i}const iY="_mergedDefaultProps";function CE(t,e){if(!(t instanceof p1.constructor))return{};let r=iY;if(e)for(const i of e){const o=i.constructor;o&&(r+=`:${o.extensionName||o.name}`)}const n=u6(t,r);return n||(t[r]=aY(t,e||[]))}function aY(t,e){if(!t.prototype)return null;const n=Object.getPrototypeOf(t),i=CE(n),o=u6(t,"defaultProps")||{},c=tY(o),s=Object.assign(Object.create(null),i,c.defaultProps),m=Object.assign(Object.create(null),i==null?void 0:i[jp],c.propTypes),v=Object.assign(Object.create(null),i==null?void 0:i[Bw],c.deprecatedProps);for(const w of e){const M=CE(w.constructor);M&&(Object.assign(s,M),Object.assign(m,M[jp]),Object.assign(v,M[Bw]))}return sY(s,t),lY(s,m),oY(s,v),s[jp]=m,s[Bw]=v,e.length===0&&!EP(t,"_propTypes")&&(t._propTypes=m),s}function sY(t,e){const r=uY(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function oY(t,e){for(const r in e)Object.defineProperty(t,r,{enumerable:!1,set(n){const i=`${this.id}: ${r}`;for(const o of e[r])EP(this,o)||(this[o]=n);oi.deprecated(i,e[r].join("/"))()}})}function lY(t,e){const r={},n={};for(const i in e){const o=e[i],{name:c,value:s}=o;o.async&&(r[c]=s,n[c]=cY(c))}t[Rg]=r,t[Zp]={},Object.defineProperties(t,n)}function cY(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||JF(e)?this[Zp][t]=e:this[hd][t]=e},get(){if(this[hd]){if(t in this[hd])return this[hd][t]||this[Rg][t];if(t in this[Zp]){const e=this[W0]&&this[W0].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Rg][t]}}return this[Rg][t]}}}function EP(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function u6(t,e){return EP(t,e)&&t[e]}function uY(t){const e=t.componentName;return e||oi.warn(`${t.name}.componentName not specified`)(),e||t.name}let hY=0;class p1{constructor(...e){this.props=nY(this,e),this.id=this.props.id,this.count=hY++}clone(e){const{props:r}=this,n={};for(const i in r[Rg])i in r[hd]?n[i]=r[hd][i]:i in r[Zp]&&(n[i]=r[Zp][i]);return new this.constructor({...r,...n,...e})}}p1.componentName="Component";p1.defaultProps={};const fY=Object.freeze({});class dY{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||fY}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){const r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(const r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[W0]||this.component;const r=e[hd]||{},n=e[Zp]||e,i=e[Rg]||{};for(const o in r){const c=r[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,c),r[o]=this.getAsyncProp(o)}for(const o in n){const c=n[o];this._createAsyncPropData(o,i[o]),this._updateAsyncProp(o,c)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(JF(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){const n=this.asyncProps[e];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,r,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=r,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(n,o),this._setAsyncPropValue(e,o,i),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let o=[],c=0;for await(const s of r){if(!this.component)return;const{dataTransform:m}=this.component.props;m?o=m(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:c,endRow:o.length}]}),c=o.length,this._setAsyncPropValue(e,o,i)}this._onResolve(e,o)}_postProcessValue(e,r){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){const i=this.component&&this.component.props[jp];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}}class pY extends dY{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){const n=this.layer,i=n==null?void 0:n.props.fetch;return i?i(r,{propName:e,layer:n}):super._fetch(e,r)}_onResolve(e,r){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(r,{propName:e,layer:n})}}_onError(e,r){const n=this.layer;n&&n.raiseError(r,`loading ${e} of ${this.layer}`)}}const mY="layer.changeFlag",gY="layer.initialize",_Y="layer.update",yY="layer.finalize",vY="layer.matched",GR=2**24-1,bY=Object.freeze([]),xY=$v(({oldViewport:t,viewport:e})=>t.equals(e));let kc=new Uint8ClampedArray(0);const wY={data:{type:"data",value:bY,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:n,loadOptions:i,signal:o})=>{const{resourceManager:c}=r.context;i=i||r.getLoadOptions(),n=n||r.props.loaders,o&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:o}});let s=c.contains(t);return!s&&!i&&(c.add({resourceId:t,data:qA(t,n),persistent:!1}),s=!0),s?c.subscribe({resourceId:t,onChange:m=>{var v;return(v=r.internalState)==null?void 0:v.reloadAsyncProp(e,m)},consumerId:r.id,requestId:e}):qA(t,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:An.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};let m1=class extends p1{constructor(){super(...arguments),this.internalState=null,this.lifecycle=vg.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Cs(this.internalState);const r=this.internalState.viewport||this.context.viewport,n=MF(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,o,c]=TF(n,r.pixelProjectionMatrix);return e.length===2?[i,o]:[i,o,c]}unproject(e){return Cs(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){Cs(this.internalState);const n=this.internalState.viewport||this.context.viewport;return GH(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===An.DEFAULT||e===An.LNGLAT||e===An.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){Cs(e instanceof Uint8Array);const[r,n,i]=e;return r+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:XG(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=XR(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const r of this.props.extensions)e=XR(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const r=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&r)if(Array.isArray(n))for(const i of n)r.invalidateAll(i);else r.invalidateAll();if(r){const{props:i}=e,o=this.internalState.hasPickingBuffer,c=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:s,instancePickingColors:m}=r.attributes,v=s||m;v&&(c&&v.constant&&(v.constant=!1,r.invalidate(v.id)),!v.value&&!c&&(v.constant=!0,v.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,r){var n,i,o,c;r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),(i=(n=this.props).onError)!=null&&i.call(n,e)||(c=(o=this.context)==null?void 0:o.onError)==null||c.call(o,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const r=this.internalState.viewport;this.internalState.viewport=e,(!r||!xY({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(const n in e)e[n].layoutChanged()&&(r=!0);for(const n of this.getModels())this._setModelAttributes(n,e,r)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const r=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:r.data,numInstances:n,startIndices:i,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const r=e.update(),n=Object.create(this.props);for(const i in r)Object.defineProperty(n,i,{value:r[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;const n=Math.floor(kc.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>GR&&oi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),kc=Qy.allocate(kc,r,{size:4,copy:!0,maxCount:Math.max(r,GR)});const i=Math.floor(kc.length/4),o=[0,0,0];for(let c=n;c<i;c++)this.encodePickingColor(c,o),kc[c*4+0]=o[0],kc[c*4+1]=o[1],kc[c*4+2]=o[2],kc[c*4+3]=0}e.value=kc.subarray(0,r*4)}_setModelAttributes(e,r,n=!1){var s;if(!Object.keys(r).length)return;if(n){const m=this.getAttributeManager();e.setBufferLayout(m.getBufferLayouts(e)),r=m.getAttributes()}const i=((s=e.userData)==null?void 0:s.excludeAttributes)||{},o={},c={};for(const m in r){if(i[m])continue;const v=r[m].getValue();for(const w in v){const M=v[w];M instanceof Ti?r[m].settings.isIndexed?e.setIndexBuffer(M):o[w]=M:M&&(c[w]=M)}}e.setAttributes(o),e.setConstantAttributes(c)}disablePickingIndex(e){const r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i,c=o&&r.attributes&&r.attributes[o.id];if(c&&c.value){const s=c.value,m=this.encodePickingColor(e);for(let v=0;v<r.length;v++){const w=o.getVertexOffset(v);s[w]===m[0]&&s[w+1]===m[1]&&s[w+2]===m[2]&&this._disablePickingIndex(v)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,i=r||n;if(!i)return;const o=i.getVertexOffset(e),c=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(c-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,n=e||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==kc.buffer&&(n.value=kc.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Cs(!this.internalState),Cs(Number.isFinite(this.props.coordinateSystem)),Xs(gY,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new pY({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(oi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new zG(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Xs(vY,this,this===e);const{state:r,internalState:n}=e;this!==e&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Xs(_Y,this,e),!e)return;const r=this.props,n=this.context,i=this.internalState,o=n.viewport,c=this._updateUniformTransition();i.propsInTransition=c,n.viewport=i.viewport||o,this.props=c;try{const s=this._getUpdateParams(),m=this.getModels();if(n.device)this.updateState(s);else try{this.updateState(s)}catch{}for(const w of this.props.extensions)w.updateState.call(this,s,w);this.setNeedsRedraw(),this._updateAttributes();const v=this.getModels()[0]!==m[0];this._postUpdate(s,v)}finally{n.viewport=o,this.props=r,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Xs(yY,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,c=this.context;this.props=this.internalState.propsInTransition||o;try{r&&this.setShaderModuleProps(r);const{getPolygonOffset:s}=this.props,m=s&&s(n)||[0,0];c.device instanceof Ag&&c.device.setParametersWebGL({polygonOffset:m});for(const v of this.getModels())v.device.type==="webgpu"?v.setParameters({...v.parameters,...i}):v.setParameters(i);if(c.device instanceof Ag)c.device.withParametersWebGL(i,()=>{const v={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:c};for(const w of this.props.extensions)w.draw.call(this,v,w);this.draw(v)});else{const v={renderPass:e,shaderModuleProps:r,uniforms:n,parameters:i,context:c};for(const w of this.props.extensions)w.draw.call(this,v,w);this.draw(v)}}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:r}=this.internalState;for(const i in e)if(e[i]){let o=!1;switch(i){case"dataChanged":const c=e[i],s=r[i];c&&Array.isArray(s)&&(r.dataChanged=Array.isArray(c)?s.concat(c):c,o=!0);default:r[i]||(r[i]=e[i],o=!0)}o&&Xs(mY,this,i,e)}const n=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){var i;const n=UG(e,r);if(n.updateTriggersChanged)for(const o in n.updateTriggersChanged)n.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(n.transitionsChanged)for(const o in n.transitionsChanged)this.internalState.uniformTransitions.add(o,r[o],e[o],(i=e.transitions)==null?void 0:i[o]);return this.setChangeFlags(n)}validateProps(){jG(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(r.highlightColor=n(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new DG(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){const{props:n,oldProps:i}=e,o=this.state.model;o!=null&&o.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:s,highlightColor:m}=n;if(r||i.autoHighlight!==c||i.highlightedObjectIndex!==s||i.highlightColor!==m){const v={};Array.isArray(m)&&(v.highlightColor=m),(r||i.autoHighlight!==c||s!==i.highlightedObjectIndex)&&(v.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:v})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(r=r||i,r)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};m1.defaultProps=wY;m1.layerName="Layer";const YR=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,TY={name:"scatterplot",vs:YR,fs:YR,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},SY=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,AY=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,EY=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,KR=[0,0,0,255],MY={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:KR},getLineColor:{type:"accessor",value:KR},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class MP extends m1{getShaders(){return super.getShaders({vs:SY,fs:AY,source:EY,modules:[K7,xH,TY]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e),e.changeFlags.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:r,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,stroked:c,filled:s,billboard:m,antialiasing:v,lineWidthUnits:w,lineWidthScale:M,lineWidthMinPixels:I,lineWidthMaxPixels:k}=this.props,z={stroked:c,filled:s,billboard:m,antialiasing:v,radiusUnits:zg[r],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:o,lineWidthUnits:zg[w],lineWidthScale:M,lineWidthMinPixels:I,lineWidthMaxPixels:k},V=this.state.model;V.shaderInputs.setProps({scatterplot:z}),V.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Jy(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new _W({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}MP.defaultProps=MY;MP.layerName="ScatterplotLayer";const PY=typeof window<"u"?it.useLayoutEffect:it.useEffect;function G0(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const CY={position:"absolute",zIndex:-1};function h6(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(r=>h6(r,e));if(g1(t)){if(RY(t))return e.style=CY,it.cloneElement(t,e);if(IY(t))return it.cloneElement(t,e)}return t}function g1(t){return t&&typeof t=="object"&&"type"in t||!1}function RY(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function IY(t){const e=t.type;return e&&e.deckGLViewProps}function RE(t){if(typeof t=="function")return it.createElement(Vg,{},t);if(Array.isArray(t))return t.map(RE);if(g1(t)){if(t.type===it.Fragment)return RE(t.props.children);if(G0(t.type,Vg))return t}return t}function OY({children:t,layers:e=[],views:r=null}){const n=[],i=[],o={};return it.Children.forEach(RE(t),c=>{if(g1(c)){const s=c.type;if(G0(s,m1)){const m=kY(s,c.props);i.push(m)}else n.push(c);if(G0(s,Vg)&&s!==Vg&&c.props.id){const m=new s(c.props);o[m.id]=m}}else c&&n.push(c)}),Object.keys(o).length>0&&(Array.isArray(r)?r.forEach(c=>{o[c.id]=c}):r&&(o[r.id]=r),r=Object.values(o)),e=i.length>0?[...i,...e]:e,{layers:e,children:n,views:r}}function kY(t,e){const r={},n=t.defaultProps||{};for(const i in e)n[i]!==e[i]&&(r[i]=e[i]);return new t(r)}const DY=it.createContext();function NY({children:t,deck:e,ContextProvider:r=DY.Provider}){const{viewManager:n}=e||{};if(!n||!n.views.length)return[];const i={},o=n.views[0].id;for(const c of t){let s=o,m=c;g1(c)&&G0(c.type,Vg)&&(s=c.props.id||o,m=c.props.children);const v=n.getViewport(s),w=n.getViewState(s);if(v){w.padding=v.padding;const{x:M,y:I,width:k,height:z}=v;m=h6(m,{x:M,y:I,width:k,height:z,viewport:v,viewState:w}),i[s]||(i[s]={viewport:v,children:[]}),i[s].children.push(m)}}return Object.keys(i).map(c=>{const{viewport:s,children:m}=i[c],{x:v,y:w,width:M,height:I}=s,k={position:"absolute",left:v,top:w,width:M,height:I},z=`view-${c}`,V=it.createElement("div",{key:z,id:z,style:k},...m),U={deck:e,viewport:s,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:J=>{J.viewId=c,e._onViewStateChange(J)},widgets:[]},K=`view-${c}-context`;return it.createElement(r,{key:K,value:U},V)})}const BY={mixBlendMode:null};function LY({width:t,height:e,style:r}){const n={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(r)for(const o in r)o in BY?i[o]=r[o]:n[o]=r[o];return{containerStyle:n,canvasStyle:i}}function FY(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function f6(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function zY(t,e,r){var i,o,c;const n=new e({...r,_customRender:((c=(o=(i=r.deviceProps)==null?void 0:i.adapters)==null?void 0:o[0])==null?void 0:c.type)==="webgpu"?void 0:s=>{t.redrawReason=s;const m=n.getViewports();t.lastRenderedViewports!==m?t.forceUpdate():f6(t)}});return n}function jY(t,e){const[r,n]=it.useState(0),o=it.useRef({control:null,version:r,forceUpdate:()=>n(W=>W+1)}).current,c=it.useRef(null),s=it.useRef(null),m=it.useMemo(()=>OY(t),[t.layers,t.views,t.children]);let v=!0;const w=W=>{var Y;return v&&t.viewState?(o.viewStateUpdateRequested=W,null):(o.viewStateUpdateRequested=null,(Y=t.onViewStateChange)==null?void 0:Y.call(t,W))},M=W=>{var Y;v?o.interactionStateUpdateRequested=W:(o.interactionStateUpdateRequested=null,(Y=t.onInteractionStateChange)==null||Y.call(t,W))},I=it.useMemo(()=>{const W={widgets:[],...t,style:null,width:"100%",height:"100%",parent:c.current,canvas:s.current,layers:m.layers,views:m.views,onViewStateChange:w,onInteractionStateChange:M};return delete W._customRender,o.deck&&o.deck.setProps(W),W},[t]);it.useEffect(()=>{const W=t.Deck||AP;return o.deck=zY(o,W,{...I,parent:c.current,canvas:s.current}),()=>{var Y;return(Y=o.deck)==null?void 0:Y.finalize()}},[]),PY(()=>{f6(o);const{viewStateUpdateRequested:W,interactionStateUpdateRequested:Y}=o;W&&w(W),Y&&M(Y)}),it.useImperativeHandle(e,()=>FY(o),[]);const k=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:z,width:V="100%",height:U="100%",id:K,style:J}=t,{containerStyle:Z,canvasStyle:re}=it.useMemo(()=>LY({width:V,height:U,style:J}),[V,U,J]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===k||o.version!==r){o.lastRenderedViewports=k,o.version=r;const W=NY({children:m.children,deck:o.deck,ContextProvider:z}),Y=it.createElement("canvas",{key:"canvas",id:K||"deckgl-overlay",ref:s,style:re});o.control=it.createElement("div",{id:`${K||"deckgl"}-wrapper`,ref:c,style:Z},[Y,W])}return v=!1,o.control}const UY=it.forwardRef(jY);function d6(t){var e,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(r=d6(t[e]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function pn(){for(var t,e,r=0,n="",i=arguments.length;r<i;r++)(t=arguments[r])&&(e=d6(t))&&(n&&(n+=" "),n+=e);return n}var $w,QR;function go(){if(QR)return $w;QR=1;var t=Array.isArray;return $w=t,$w}var Vw,JR;function p6(){if(JR)return Vw;JR=1;var t=typeof Ub=="object"&&Ub&&Ub.Object===Object&&Ub;return Vw=t,Vw}var qw,eI;function Bu(){if(eI)return qw;eI=1;var t=p6(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return qw=r,qw}var Hw,tI;function qv(){if(tI)return Hw;tI=1;var t=Bu(),e=t.Symbol;return Hw=e,Hw}var Ww,rI;function $Y(){if(rI)return Ww;rI=1;var t=qv(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,i=t?t.toStringTag:void 0;function o(c){var s=r.call(c,i),m=c[i];try{c[i]=void 0;var v=!0}catch{}var w=n.call(c);return v&&(s?c[i]=m:delete c[i]),w}return Ww=o,Ww}var Zw,nI;function VY(){if(nI)return Zw;nI=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return Zw=r,Zw}var Xw,iI;function Kh(){if(iI)return Xw;iI=1;var t=qv(),e=$Y(),r=VY(),n="[object Null]",i="[object Undefined]",o=t?t.toStringTag:void 0;function c(s){return s==null?s===void 0?i:n:o&&o in Object(s)?e(s):r(s)}return Xw=c,Xw}var Gw,aI;function Qh(){if(aI)return Gw;aI=1;function t(e){return e!=null&&typeof e=="object"}return Gw=t,Gw}var Yw,sI;function d_(){if(sI)return Yw;sI=1;var t=Kh(),e=Qh(),r="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&t(i)==r}return Yw=n,Yw}var Kw,oI;function PP(){if(oI)return Kw;oI=1;var t=go(),e=d_(),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(o,c){if(t(o))return!1;var s=typeof o;return s=="number"||s=="symbol"||s=="boolean"||o==null||e(o)?!0:n.test(o)||!r.test(o)||c!=null&&o in Object(c)}return Kw=i,Kw}var Qw,lI;function vd(){if(lI)return Qw;lI=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return Qw=t,Qw}var Jw,cI;function CP(){if(cI)return Jw;cI=1;var t=Kh(),e=vd(),r="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",o="[object Proxy]";function c(s){if(!e(s))return!1;var m=t(s);return m==n||m==i||m==r||m==o}return Jw=c,Jw}var eT,uI;function qY(){if(uI)return eT;uI=1;var t=Bu(),e=t["__core-js_shared__"];return eT=e,eT}var tT,hI;function HY(){if(hI)return tT;hI=1;var t=qY(),e=function(){var n=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function r(n){return!!e&&e in n}return tT=r,tT}var rT,fI;function m6(){if(fI)return rT;fI=1;var t=Function.prototype,e=t.toString;function r(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return rT=r,rT}var nT,dI;function WY(){if(dI)return nT;dI=1;var t=CP(),e=HY(),r=vd(),n=m6(),i=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,c=Function.prototype,s=Object.prototype,m=c.toString,v=s.hasOwnProperty,w=RegExp("^"+m.call(v).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function M(I){if(!r(I)||e(I))return!1;var k=t(I)?w:o;return k.test(n(I))}return nT=M,nT}var iT,pI;function ZY(){if(pI)return iT;pI=1;function t(e,r){return e==null?void 0:e[r]}return iT=t,iT}var aT,mI;function im(){if(mI)return aT;mI=1;var t=WY(),e=ZY();function r(n,i){var o=e(n,i);return t(o)?o:void 0}return aT=r,aT}var sT,gI;function _1(){if(gI)return sT;gI=1;var t=im(),e=t(Object,"create");return sT=e,sT}var oT,_I;function XY(){if(_I)return oT;_I=1;var t=_1();function e(){this.__data__=t?t(null):{},this.size=0}return oT=e,oT}var lT,yI;function GY(){if(yI)return lT;yI=1;function t(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}return lT=t,lT}var cT,vI;function YY(){if(vI)return cT;vI=1;var t=_1(),e="__lodash_hash_undefined__",r=Object.prototype,n=r.hasOwnProperty;function i(o){var c=this.__data__;if(t){var s=c[o];return s===e?void 0:s}return n.call(c,o)?c[o]:void 0}return cT=i,cT}var uT,bI;function KY(){if(bI)return uT;bI=1;var t=_1(),e=Object.prototype,r=e.hasOwnProperty;function n(i){var o=this.__data__;return t?o[i]!==void 0:r.call(o,i)}return uT=n,uT}var hT,xI;function QY(){if(xI)return hT;xI=1;var t=_1(),e="__lodash_hash_undefined__";function r(n,i){var o=this.__data__;return this.size+=this.has(n)?0:1,o[n]=t&&i===void 0?e:i,this}return hT=r,hT}var fT,wI;function JY(){if(wI)return fT;wI=1;var t=XY(),e=GY(),r=YY(),n=KY(),i=QY();function o(c){var s=-1,m=c==null?0:c.length;for(this.clear();++s<m;){var v=c[s];this.set(v[0],v[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=r,o.prototype.has=n,o.prototype.set=i,fT=o,fT}var dT,TI;function eK(){if(TI)return dT;TI=1;function t(){this.__data__=[],this.size=0}return dT=t,dT}var pT,SI;function RP(){if(SI)return pT;SI=1;function t(e,r){return e===r||e!==e&&r!==r}return pT=t,pT}var mT,AI;function y1(){if(AI)return mT;AI=1;var t=RP();function e(r,n){for(var i=r.length;i--;)if(t(r[i][0],n))return i;return-1}return mT=e,mT}var gT,EI;function tK(){if(EI)return gT;EI=1;var t=y1(),e=Array.prototype,r=e.splice;function n(i){var o=this.__data__,c=t(o,i);if(c<0)return!1;var s=o.length-1;return c==s?o.pop():r.call(o,c,1),--this.size,!0}return gT=n,gT}var _T,MI;function rK(){if(MI)return _T;MI=1;var t=y1();function e(r){var n=this.__data__,i=t(n,r);return i<0?void 0:n[i][1]}return _T=e,_T}var yT,PI;function nK(){if(PI)return yT;PI=1;var t=y1();function e(r){return t(this.__data__,r)>-1}return yT=e,yT}var vT,CI;function iK(){if(CI)return vT;CI=1;var t=y1();function e(r,n){var i=this.__data__,o=t(i,r);return o<0?(++this.size,i.push([r,n])):i[o][1]=n,this}return vT=e,vT}var bT,RI;function v1(){if(RI)return bT;RI=1;var t=eK(),e=tK(),r=rK(),n=nK(),i=iK();function o(c){var s=-1,m=c==null?0:c.length;for(this.clear();++s<m;){var v=c[s];this.set(v[0],v[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=r,o.prototype.has=n,o.prototype.set=i,bT=o,bT}var xT,II;function IP(){if(II)return xT;II=1;var t=im(),e=Bu(),r=t(e,"Map");return xT=r,xT}var wT,OI;function aK(){if(OI)return wT;OI=1;var t=JY(),e=v1(),r=IP();function n(){this.size=0,this.__data__={hash:new t,map:new(r||e),string:new t}}return wT=n,wT}var TT,kI;function sK(){if(kI)return TT;kI=1;function t(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}return TT=t,TT}var ST,DI;function b1(){if(DI)return ST;DI=1;var t=sK();function e(r,n){var i=r.__data__;return t(n)?i[typeof n=="string"?"string":"hash"]:i.map}return ST=e,ST}var AT,NI;function oK(){if(NI)return AT;NI=1;var t=b1();function e(r){var n=t(this,r).delete(r);return this.size-=n?1:0,n}return AT=e,AT}var ET,BI;function lK(){if(BI)return ET;BI=1;var t=b1();function e(r){return t(this,r).get(r)}return ET=e,ET}var MT,LI;function cK(){if(LI)return MT;LI=1;var t=b1();function e(r){return t(this,r).has(r)}return MT=e,MT}var PT,FI;function uK(){if(FI)return PT;FI=1;var t=b1();function e(r,n){var i=t(this,r),o=i.size;return i.set(r,n),this.size+=i.size==o?0:1,this}return PT=e,PT}var CT,zI;function OP(){if(zI)return CT;zI=1;var t=aK(),e=oK(),r=lK(),n=cK(),i=uK();function o(c){var s=-1,m=c==null?0:c.length;for(this.clear();++s<m;){var v=c[s];this.set(v[0],v[1])}}return o.prototype.clear=t,o.prototype.delete=e,o.prototype.get=r,o.prototype.has=n,o.prototype.set=i,CT=o,CT}var RT,jI;function g6(){if(jI)return RT;jI=1;var t=OP(),e="Expected a function";function r(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var o=function(){var c=arguments,s=i?i.apply(this,c):c[0],m=o.cache;if(m.has(s))return m.get(s);var v=n.apply(this,c);return o.cache=m.set(s,v)||m,v};return o.cache=new(r.Cache||t),o}return r.Cache=t,RT=r,RT}var IT,UI;function hK(){if(UI)return IT;UI=1;var t=g6(),e=500;function r(n){var i=t(n,function(c){return o.size===e&&o.clear(),c}),o=i.cache;return i}return IT=r,IT}var OT,$I;function fK(){if($I)return OT;$I=1;var t=hK(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,r=/\\(\\)?/g,n=t(function(i){var o=[];return i.charCodeAt(0)===46&&o.push(""),i.replace(e,function(c,s,m,v){o.push(m?v.replace(r,"$1"):s||c)}),o});return OT=n,OT}var kT,VI;function kP(){if(VI)return kT;VI=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,o=Array(i);++n<i;)o[n]=r(e[n],n,e);return o}return kT=t,kT}var DT,qI;function dK(){if(qI)return DT;qI=1;var t=qv(),e=kP(),r=go(),n=d_(),i=t?t.prototype:void 0,o=i?i.toString:void 0;function c(s){if(typeof s=="string")return s;if(r(s))return e(s,c)+"";if(n(s))return o?o.call(s):"";var m=s+"";return m=="0"&&1/s==-1/0?"-0":m}return DT=c,DT}var NT,HI;function _6(){if(HI)return NT;HI=1;var t=dK();function e(r){return r==null?"":t(r)}return NT=e,NT}var BT,WI;function y6(){if(WI)return BT;WI=1;var t=go(),e=PP(),r=fK(),n=_6();function i(o,c){return t(o)?o:e(o,c)?[o]:r(n(o))}return BT=i,BT}var LT,ZI;function x1(){if(ZI)return LT;ZI=1;var t=d_();function e(r){if(typeof r=="string"||t(r))return r;var n=r+"";return n=="0"&&1/r==-1/0?"-0":n}return LT=e,LT}var FT,XI;function DP(){if(XI)return FT;XI=1;var t=y6(),e=x1();function r(n,i){i=t(i,n);for(var o=0,c=i.length;n!=null&&o<c;)n=n[e(i[o++])];return o&&o==c?n:void 0}return FT=r,FT}var zT,GI;function v6(){if(GI)return zT;GI=1;var t=DP();function e(r,n,i){var o=r==null?void 0:t(r,n);return o===void 0?i:o}return zT=e,zT}var pK=v6();const ql=Yn(pK);var jT,YI;function mK(){if(YI)return jT;YI=1;function t(e){return e==null}return jT=t,jT}var gK=mK();const tn=Yn(gK);var UT,KI;function _K(){if(KI)return UT;KI=1;var t=Kh(),e=go(),r=Qh(),n="[object String]";function i(o){return typeof o=="string"||!e(o)&&r(o)&&t(o)==n}return UT=i,UT}var yK=_K();const Xp=Yn(yK);var vK=CP();const Xr=Yn(vK);var bK=vd();const p_=Yn(bK);var $T={exports:{}},Nn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QI;function xK(){if(QI)return Nn;QI=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),c=Symbol.for("react.context"),s=Symbol.for("react.server_context"),m=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),k=Symbol.for("react.offscreen"),z;z=Symbol.for("react.module.reference");function V(U){if(typeof U=="object"&&U!==null){var K=U.$$typeof;switch(K){case t:switch(U=U.type,U){case r:case i:case n:case v:case w:return U;default:switch(U=U&&U.$$typeof,U){case s:case c:case m:case I:case M:case o:return U;default:return K}}case e:return K}}}return Nn.ContextConsumer=c,Nn.ContextProvider=o,Nn.Element=t,Nn.ForwardRef=m,Nn.Fragment=r,Nn.Lazy=I,Nn.Memo=M,Nn.Portal=e,Nn.Profiler=i,Nn.StrictMode=n,Nn.Suspense=v,Nn.SuspenseList=w,Nn.isAsyncMode=function(){return!1},Nn.isConcurrentMode=function(){return!1},Nn.isContextConsumer=function(U){return V(U)===c},Nn.isContextProvider=function(U){return V(U)===o},Nn.isElement=function(U){return typeof U=="object"&&U!==null&&U.$$typeof===t},Nn.isForwardRef=function(U){return V(U)===m},Nn.isFragment=function(U){return V(U)===r},Nn.isLazy=function(U){return V(U)===I},Nn.isMemo=function(U){return V(U)===M},Nn.isPortal=function(U){return V(U)===e},Nn.isProfiler=function(U){return V(U)===i},Nn.isStrictMode=function(U){return V(U)===n},Nn.isSuspense=function(U){return V(U)===v},Nn.isSuspenseList=function(U){return V(U)===w},Nn.isValidElementType=function(U){return typeof U=="string"||typeof U=="function"||U===r||U===i||U===n||U===v||U===w||U===k||typeof U=="object"&&U!==null&&(U.$$typeof===I||U.$$typeof===M||U.$$typeof===o||U.$$typeof===c||U.$$typeof===m||U.$$typeof===z||U.getModuleId!==void 0)},Nn.typeOf=V,Nn}var JI;function wK(){return JI||(JI=1,$T.exports=xK()),$T.exports}var TK=wK(),VT,eO;function b6(){if(eO)return VT;eO=1;var t=Kh(),e=Qh(),r="[object Number]";function n(i){return typeof i=="number"||e(i)&&t(i)==r}return VT=n,VT}var qT,tO;function SK(){if(tO)return qT;tO=1;var t=b6();function e(r){return t(r)&&r!=+r}return qT=e,qT}var AK=SK();const Hv=Yn(AK);var EK=b6();const MK=Yn(EK);var Hc=function(e){return e===0?0:e>0?1:-1},Dp=function(e){return Xp(e)&&e.indexOf("%")===e.length-1},nr=function(e){return MK(e)&&!Hv(e)},Da=function(e){return nr(e)||Xp(e)},PK=0,Wv=function(e){var r=++PK;return"".concat(e||"").concat(r)},Gp=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!nr(e)&&!Xp(e))return n;var o;if(Dp(e)){var c=e.indexOf("%");o=r*parseFloat(e.slice(0,c))/100}else o=+e;return Hv(o)&&(o=n),i&&o>r&&(o=r),o},ld=function(e){if(!e)return null;var r=Object.keys(e);return r&&r.length?e[r[0]]:null},CK=function(e){if(!Array.isArray(e))return!1;for(var r=e.length,n={},i=0;i<r;i++)if(!n[e[i]])n[e[i]]=!0;else return!0;return!1},Uc=function(e,r){return nr(e)&&nr(r)?function(n){return e+n*(r-e)}:function(){return r}};function Y0(t,e,r){return!t||!t.length?null:t.find(function(n){return n&&(typeof e=="function"?e(n):ql(n,e))===r})}var RK=function(e,r){return nr(e)&&nr(r)?e-r:Xp(e)&&Xp(r)?e.localeCompare(r):e instanceof Date&&r instanceof Date?e.getTime()-r.getTime():String(e).localeCompare(String(r))};function Ig(t,e){for(var r in t)if({}.hasOwnProperty.call(t,r)&&(!{}.hasOwnProperty.call(e,r)||t[r]!==e[r]))return!1;for(var n in e)if({}.hasOwnProperty.call(e,n)&&!{}.hasOwnProperty.call(t,n))return!1;return!0}function IE(t){"@babel/helpers - typeof";return IE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},IE(t)}var IK=["viewBox","children"],OK=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],rO=["points","pathLength"],HT={svg:IK,polygon:rO,polyline:rO},NP=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],K0=function(e,r){if(!e||typeof e=="function"||typeof e=="boolean")return null;var n=e;if(it.isValidElement(e)&&(n=e.props),!p_(n))return null;var i={};return Object.keys(n).forEach(function(o){NP.includes(o)&&(i[o]=r||function(c){return n[o](n,c)})}),i},kK=function(e,r,n){return function(i){return e(r,n,i),null}},Q0=function(e,r,n){if(!p_(e)||IE(e)!=="object")return null;var i=null;return Object.keys(e).forEach(function(o){var c=e[o];NP.includes(o)&&typeof c=="function"&&(i||(i={}),i[o]=kK(c,r,n))}),i},DK=["children"],NK=["children"];function nO(t,e){if(t==null)return{};var r=BK(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function BK(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function OE(t){"@babel/helpers - typeof";return OE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},OE(t)}var iO={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},$h=function(e){return typeof e=="string"?e:e?e.displayName||e.name||"Component":""},aO=null,WT=null,BP=function t(e){if(e===aO&&Array.isArray(WT))return WT;var r=[];return it.Children.forEach(e,function(n){tn(n)||(TK.isFragment(n)?r=r.concat(t(n.props.children)):r.push(n))}),WT=r,aO=e,r};function Hl(t,e){var r=[],n=[];return Array.isArray(e)?n=e.map(function(i){return $h(i)}):n=[$h(e)],BP(t).forEach(function(i){var o=ql(i,"type.displayName")||ql(i,"type.name");n.indexOf(o)!==-1&&r.push(i)}),r}function Go(t,e){var r=Hl(t,e);return r&&r[0]}var sO=function(e){if(!e||!e.props)return!1;var r=e.props,n=r.width,i=r.height;return!(!nr(n)||n<=0||!nr(i)||i<=0)},LK=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],FK=function(e){return e&&e.type&&Xp(e.type)&&LK.indexOf(e.type)>=0},zK=function(e){return e&&OE(e)==="object"&&"clipDot"in e},jK=function(e,r,n,i){var o,c=(o=HT==null?void 0:HT[i])!==null&&o!==void 0?o:[];return r.startsWith("data-")||!Xr(e)&&(i&&c.includes(r)||OK.includes(r))||n&&NP.includes(r)},an=function(e,r,n){if(!e||typeof e=="function"||typeof e=="boolean")return null;var i=e;if(it.isValidElement(e)&&(i=e.props),!p_(i))return null;var o={};return Object.keys(i).forEach(function(c){var s;jK((s=i)===null||s===void 0?void 0:s[c],c,r,n)&&(o[c]=i[c])}),o},kE=function t(e,r){if(e===r)return!0;var n=it.Children.count(e);if(n!==it.Children.count(r))return!1;if(n===0)return!0;if(n===1)return oO(Array.isArray(e)?e[0]:e,Array.isArray(r)?r[0]:r);for(var i=0;i<n;i++){var o=e[i],c=r[i];if(Array.isArray(o)||Array.isArray(c)){if(!t(o,c))return!1}else if(!oO(o,c))return!1}return!0},oO=function(e,r){if(tn(e)&&tn(r))return!0;if(!tn(e)&&!tn(r)){var n=e.props||{},i=n.children,o=nO(n,DK),c=r.props||{},s=c.children,m=nO(c,NK);return i&&s?Ig(o,m)&&kE(i,s):!i&&!s?Ig(o,m):!1}return!1},lO=function(e,r){var n=[],i={};return BP(e).forEach(function(o,c){if(FK(o))n.push(o);else if(o){var s=$h(o.type),m=r[s]||{},v=m.handler,w=m.once;if(v&&(!w||!i[s])){var M=v(o,s,c);n.push(M),i[s]=!0}}}),n},UK=function(e){var r=e&&e.type;return r&&iO[r]?iO[r]:null},$K=function(e,r){return BP(r).indexOf(e)},VK=["children","width","height","viewBox","className","style","title","desc"];function DE(){return DE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},DE.apply(this,arguments)}function qK(t,e){if(t==null)return{};var r=HK(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function HK(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function NE(t){var e=t.children,r=t.width,n=t.height,i=t.viewBox,o=t.className,c=t.style,s=t.title,m=t.desc,v=qK(t,VK),w=i||{width:r,height:n,x:0,y:0},M=pn("recharts-surface",o);return He.createElement("svg",DE({},an(v,!0,"svg"),{className:M,width:r,height:n,style:c,viewBox:"".concat(w.x," ").concat(w.y," ").concat(w.width," ").concat(w.height)}),He.createElement("title",null,s),He.createElement("desc",null,m),e)}var WK=["children","className"];function BE(){return BE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},BE.apply(this,arguments)}function ZK(t,e){if(t==null)return{};var r=XK(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function XK(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}var ia=He.forwardRef(function(t,e){var r=t.children,n=t.className,i=ZK(t,WK),o=pn("recharts-layer",n);return He.createElement("g",BE({className:o},an(i,!0),{ref:e}),r)}),Vh=function(e,r){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o]},ZT,cO;function GK(){if(cO)return ZT;cO=1;function t(e,r,n){var i=-1,o=e.length;r<0&&(r=-r>o?0:o+r),n=n>o?o:n,n<0&&(n+=o),o=r>n?0:n-r>>>0,r>>>=0;for(var c=Array(o);++i<o;)c[i]=e[i+r];return c}return ZT=t,ZT}var XT,uO;function YK(){if(uO)return XT;uO=1;var t=GK();function e(r,n,i){var o=r.length;return i=i===void 0?o:i,!n&&i>=o?r:t(r,n,i)}return XT=e,XT}var GT,hO;function x6(){if(hO)return GT;hO=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",i=e+r+n,o="\\ufe0e\\ufe0f",c="\\u200d",s=RegExp("["+c+t+i+o+"]");function m(v){return s.test(v)}return GT=m,GT}var YT,fO;function KK(){if(fO)return YT;fO=1;function t(e){return e.split("")}return YT=t,YT}var KT,dO;function QK(){if(dO)return KT;dO=1;var t="\\ud800-\\udfff",e="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",i=e+r+n,o="\\ufe0e\\ufe0f",c="["+t+"]",s="["+i+"]",m="\\ud83c[\\udffb-\\udfff]",v="(?:"+s+"|"+m+")",w="[^"+t+"]",M="(?:\\ud83c[\\udde6-\\uddff]){2}",I="[\\ud800-\\udbff][\\udc00-\\udfff]",k="\\u200d",z=v+"?",V="["+o+"]?",U="(?:"+k+"(?:"+[w,M,I].join("|")+")"+V+z+")*",K=V+z+U,J="(?:"+[w+s+"?",s,M,I,c].join("|")+")",Z=RegExp(m+"(?="+m+")|"+J+K,"g");function re(W){return W.match(Z)||[]}return KT=re,KT}var QT,pO;function JK(){if(pO)return QT;pO=1;var t=KK(),e=x6(),r=QK();function n(i){return e(i)?r(i):t(i)}return QT=n,QT}var JT,mO;function eQ(){if(mO)return JT;mO=1;var t=YK(),e=x6(),r=JK(),n=_6();function i(o){return function(c){c=n(c);var s=e(c)?r(c):void 0,m=s?s[0]:c.charAt(0),v=s?t(s,1).join(""):c.slice(1);return m[o]()+v}}return JT=i,JT}var e2,gO;function tQ(){if(gO)return e2;gO=1;var t=eQ(),e=t("toUpperCase");return e2=e,e2}var rQ=tQ();const w1=Yn(rQ);function si(t){return function(){return t}}const w6=Math.cos,J0=Math.sin,Wc=Math.sqrt,ex=Math.PI,T1=2*ex,LE=Math.PI,FE=2*LE,Rp=1e-6,nQ=FE-Rp;function T6(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=arguments[e]+t[e]}function iQ(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return T6;const r=10**e;return function(n){this._+=n[0];for(let i=1,o=n.length;i<o;++i)this._+=Math.round(arguments[i]*r)/r+n[i]}}class aQ{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?T6:iQ(e)}moveTo(e,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,r){this._append`L${this._x1=+e},${this._y1=+r}`}quadraticCurveTo(e,r,n,i){this._append`Q${+e},${+r},${this._x1=+n},${this._y1=+i}`}bezierCurveTo(e,r,n,i,o,c){this._append`C${+e},${+r},${+n},${+i},${this._x1=+o},${this._y1=+c}`}arcTo(e,r,n,i,o){if(e=+e,r=+r,n=+n,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let c=this._x1,s=this._y1,m=n-e,v=i-r,w=c-e,M=s-r,I=w*w+M*M;if(this._x1===null)this._append`M${this._x1=e},${this._y1=r}`;else if(I>Rp)if(!(Math.abs(M*m-v*w)>Rp)||!o)this._append`L${this._x1=e},${this._y1=r}`;else{let k=n-c,z=i-s,V=m*m+v*v,U=k*k+z*z,K=Math.sqrt(V),J=Math.sqrt(I),Z=o*Math.tan((LE-Math.acos((V+I-U)/(2*K*J)))/2),re=Z/J,W=Z/K;Math.abs(re-1)>Rp&&this._append`L${e+re*w},${r+re*M}`,this._append`A${o},${o},0,0,${+(M*k>w*z)},${this._x1=e+W*m},${this._y1=r+W*v}`}}arc(e,r,n,i,o,c){if(e=+e,r=+r,n=+n,c=!!c,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(i),m=n*Math.sin(i),v=e+s,w=r+m,M=1^c,I=c?i-o:o-i;this._x1===null?this._append`M${v},${w}`:(Math.abs(this._x1-v)>Rp||Math.abs(this._y1-w)>Rp)&&this._append`L${v},${w}`,n&&(I<0&&(I=I%FE+FE),I>nQ?this._append`A${n},${n},0,1,${M},${e-s},${r-m}A${n},${n},0,1,${M},${this._x1=v},${this._y1=w}`:I>Rp&&this._append`A${n},${n},0,${+(I>=LE)},${M},${this._x1=e+n*Math.cos(o)},${this._y1=r+n*Math.sin(o)}`)}rect(e,r,n,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+r}h${n=+n}v${+i}h${-n}Z`}toString(){return this._}}function LP(t){let e=3;return t.digits=function(r){if(!arguments.length)return e;if(r==null)e=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);e=n}return t},()=>new aQ(e)}function FP(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function S6(t){this._context=t}S6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function S1(t){return new S6(t)}function A6(t){return t[0]}function E6(t){return t[1]}function M6(t,e){var r=si(!0),n=null,i=S1,o=null,c=LP(s);t=typeof t=="function"?t:t===void 0?A6:si(t),e=typeof e=="function"?e:e===void 0?E6:si(e);function s(m){var v,w=(m=FP(m)).length,M,I=!1,k;for(n==null&&(o=i(k=c())),v=0;v<=w;++v)!(v<w&&r(M=m[v],v,m))===I&&((I=!I)?o.lineStart():o.lineEnd()),I&&o.point(+t(M,v,m),+e(M,v,m));if(k)return o=null,k+""||null}return s.x=function(m){return arguments.length?(t=typeof m=="function"?m:si(+m),s):t},s.y=function(m){return arguments.length?(e=typeof m=="function"?m:si(+m),s):e},s.defined=function(m){return arguments.length?(r=typeof m=="function"?m:si(!!m),s):r},s.curve=function(m){return arguments.length?(i=m,n!=null&&(o=i(n)),s):i},s.context=function(m){return arguments.length?(m==null?n=o=null:o=i(n=m),s):n},s}function r0(t,e,r){var n=null,i=si(!0),o=null,c=S1,s=null,m=LP(v);t=typeof t=="function"?t:t===void 0?A6:si(+t),e=typeof e=="function"?e:si(e===void 0?0:+e),r=typeof r=="function"?r:r===void 0?E6:si(+r);function v(M){var I,k,z,V=(M=FP(M)).length,U,K=!1,J,Z=new Array(V),re=new Array(V);for(o==null&&(s=c(J=m())),I=0;I<=V;++I){if(!(I<V&&i(U=M[I],I,M))===K)if(K=!K)k=I,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),z=I-1;z>=k;--z)s.point(Z[z],re[z]);s.lineEnd(),s.areaEnd()}K&&(Z[I]=+t(U,I,M),re[I]=+e(U,I,M),s.point(n?+n(U,I,M):Z[I],r?+r(U,I,M):re[I]))}if(J)return s=null,J+""||null}function w(){return M6().defined(i).curve(c).context(o)}return v.x=function(M){return arguments.length?(t=typeof M=="function"?M:si(+M),n=null,v):t},v.x0=function(M){return arguments.length?(t=typeof M=="function"?M:si(+M),v):t},v.x1=function(M){return arguments.length?(n=M==null?null:typeof M=="function"?M:si(+M),v):n},v.y=function(M){return arguments.length?(e=typeof M=="function"?M:si(+M),r=null,v):e},v.y0=function(M){return arguments.length?(e=typeof M=="function"?M:si(+M),v):e},v.y1=function(M){return arguments.length?(r=M==null?null:typeof M=="function"?M:si(+M),v):r},v.lineX0=v.lineY0=function(){return w().x(t).y(e)},v.lineY1=function(){return w().x(t).y(r)},v.lineX1=function(){return w().x(n).y(e)},v.defined=function(M){return arguments.length?(i=typeof M=="function"?M:si(!!M),v):i},v.curve=function(M){return arguments.length?(c=M,o!=null&&(s=c(o)),v):c},v.context=function(M){return arguments.length?(M==null?o=s=null:s=c(o=M),v):o},v}class P6{constructor(e,r){this._context=e,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,r){switch(e=+e,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(e,r):this._context.moveTo(e,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,r,e,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,e,this._y0,e,r);break}}this._x0=e,this._y0=r}}function sQ(t){return new P6(t,!0)}function oQ(t){return new P6(t,!1)}const zP={draw(t,e){const r=Wc(e/ex);t.moveTo(r,0),t.arc(0,0,r,0,T1)}},lQ={draw(t,e){const r=Wc(e/5)/2;t.moveTo(-3*r,-r),t.lineTo(-r,-r),t.lineTo(-r,-3*r),t.lineTo(r,-3*r),t.lineTo(r,-r),t.lineTo(3*r,-r),t.lineTo(3*r,r),t.lineTo(r,r),t.lineTo(r,3*r),t.lineTo(-r,3*r),t.lineTo(-r,r),t.lineTo(-3*r,r),t.closePath()}},C6=Wc(1/3),cQ=C6*2,uQ={draw(t,e){const r=Wc(e/cQ),n=r*C6;t.moveTo(0,-r),t.lineTo(n,0),t.lineTo(0,r),t.lineTo(-n,0),t.closePath()}},hQ={draw(t,e){const r=Wc(e),n=-r/2;t.rect(n,n,r,r)}},fQ=.8908130915292852,R6=J0(ex/10)/J0(7*ex/10),dQ=J0(T1/10)*R6,pQ=-w6(T1/10)*R6,mQ={draw(t,e){const r=Wc(e*fQ),n=dQ*r,i=pQ*r;t.moveTo(0,-r),t.lineTo(n,i);for(let o=1;o<5;++o){const c=T1*o/5,s=w6(c),m=J0(c);t.lineTo(m*r,-s*r),t.lineTo(s*n-m*i,m*n+s*i)}t.closePath()}},t2=Wc(3),gQ={draw(t,e){const r=-Wc(e/(t2*3));t.moveTo(0,r*2),t.lineTo(-t2*r,-r),t.lineTo(t2*r,-r),t.closePath()}},Ll=-.5,Fl=Wc(3)/2,zE=1/Wc(12),_Q=(zE/2+1)*3,yQ={draw(t,e){const r=Wc(e/_Q),n=r/2,i=r*zE,o=n,c=r*zE+r,s=-o,m=c;t.moveTo(n,i),t.lineTo(o,c),t.lineTo(s,m),t.lineTo(Ll*n-Fl*i,Fl*n+Ll*i),t.lineTo(Ll*o-Fl*c,Fl*o+Ll*c),t.lineTo(Ll*s-Fl*m,Fl*s+Ll*m),t.lineTo(Ll*n+Fl*i,Ll*i-Fl*n),t.lineTo(Ll*o+Fl*c,Ll*c-Fl*o),t.lineTo(Ll*s+Fl*m,Ll*m-Fl*s),t.closePath()}};function vQ(t,e){let r=null,n=LP(i);t=typeof t=="function"?t:si(t||zP),e=typeof e=="function"?e:si(e===void 0?64:+e);function i(){let o;if(r||(r=o=n()),t.apply(this,arguments).draw(r,+e.apply(this,arguments)),o)return r=null,o+""||null}return i.type=function(o){return arguments.length?(t=typeof o=="function"?o:si(o),i):t},i.size=function(o){return arguments.length?(e=typeof o=="function"?o:si(+o),i):e},i.context=function(o){return arguments.length?(r=o??null,i):r},i}function tx(){}function rx(t,e,r){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+r)/6)}function I6(t){this._context=t}I6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:rx(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:rx(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function bQ(t){return new I6(t)}function O6(t){this._context=t}O6.prototype={areaStart:tx,areaEnd:tx,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:rx(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function xQ(t){return new O6(t)}function k6(t){this._context=t}k6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+t)/6,n=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:rx(this,t,e);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function wQ(t){return new k6(t)}function D6(t){this._context=t}D6.prototype={areaStart:tx,areaEnd:tx,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function TQ(t){return new D6(t)}function _O(t){return t<0?-1:1}function yO(t,e,r){var n=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(n||i<0&&-0),c=(r-t._y1)/(i||n<0&&-0),s=(o*i+c*n)/(n+i);return(_O(o)+_O(c))*Math.min(Math.abs(o),Math.abs(c),.5*Math.abs(s))||0}function vO(t,e){var r=t._x1-t._x0;return r?(3*(t._y1-t._y0)/r-e)/2:e}function r2(t,e,r){var n=t._x0,i=t._y0,o=t._x1,c=t._y1,s=(o-n)/3;t._context.bezierCurveTo(n+s,i+s*e,o-s,c-s*r,o,c)}function nx(t){this._context=t}nx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:r2(this,this._t0,vO(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var r=NaN;if(t=+t,e=+e,!(t===this._x1&&e===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,r2(this,vO(this,r=yO(this,t,e)),r);break;default:r2(this,this._t0,r=yO(this,t,e));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=r}}};function N6(t){this._context=new B6(t)}(N6.prototype=Object.create(nx.prototype)).point=function(t,e){nx.prototype.point.call(this,e,t)};function B6(t){this._context=t}B6.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,r,n,i,o){this._context.bezierCurveTo(e,t,n,r,o,i)}};function SQ(t){return new nx(t)}function AQ(t){return new N6(t)}function L6(t){this._context=t}L6.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,r=t.length;if(r)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),r===2)this._context.lineTo(t[1],e[1]);else for(var n=bO(t),i=bO(e),o=0,c=1;c<r;++o,++c)this._context.bezierCurveTo(n[0][o],i[0][o],n[1][o],i[1][o],t[c],e[c]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function bO(t){var e,r=t.length-1,n,i=new Array(r),o=new Array(r),c=new Array(r);for(i[0]=0,o[0]=2,c[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,o[e]=4,c[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,o[r-1]=7,c[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/o[e-1],o[e]-=n,c[e]-=n*c[e-1];for(i[r-1]=c[r-1]/o[r-1],e=r-2;e>=0;--e)i[e]=(c[e]-i[e+1])/o[e];for(o[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-i[e+1];return[i,o]}function EQ(t){return new L6(t)}function A1(t,e){this._context=t,this._t=e}A1.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,e)}break}}this._x=t,this._y=e}};function MQ(t){return new A1(t,.5)}function PQ(t){return new A1(t,0)}function CQ(t){return new A1(t,1)}function Hg(t,e){if((c=t.length)>1)for(var r=1,n,i,o=t[e[0]],c,s=o.length;r<c;++r)for(i=o,o=t[e[r]],n=0;n<s;++n)o[n][1]+=o[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]}function jE(t){for(var e=t.length,r=new Array(e);--e>=0;)r[e]=e;return r}function RQ(t,e){return t[e]}function IQ(t){const e=[];return e.key=t,e}function OQ(){var t=si([]),e=jE,r=Hg,n=RQ;function i(o){var c=Array.from(t.apply(this,arguments),IQ),s,m=c.length,v=-1,w;for(const M of o)for(s=0,++v;s<m;++s)(c[s][v]=[0,+n(M,c[s].key,v,o)]).data=M;for(s=0,w=FP(e(c));s<m;++s)c[w[s]].index=s;return r(c,w),c}return i.keys=function(o){return arguments.length?(t=typeof o=="function"?o:si(Array.from(o)),i):t},i.value=function(o){return arguments.length?(n=typeof o=="function"?o:si(+o),i):n},i.order=function(o){return arguments.length?(e=o==null?jE:typeof o=="function"?o:si(Array.from(o)),i):e},i.offset=function(o){return arguments.length?(r=o??Hg,i):r},i}function kQ(t,e){if((n=t.length)>0){for(var r,n,i=0,o=t[0].length,c;i<o;++i){for(c=r=0;r<n;++r)c+=t[r][i][1]||0;if(c)for(r=0;r<n;++r)t[r][i][1]/=c}Hg(t,e)}}function DQ(t,e){if((i=t.length)>0){for(var r=0,n=t[e[0]],i,o=n.length;r<o;++r){for(var c=0,s=0;c<i;++c)s+=t[c][r][1]||0;n[r][1]+=n[r][0]=-s/2}Hg(t,e)}}function NQ(t,e){if(!(!((c=t.length)>0)||!((o=(i=t[e[0]]).length)>0))){for(var r=0,n=1,i,o,c;n<o;++n){for(var s=0,m=0,v=0;s<c;++s){for(var w=t[e[s]],M=w[n][1]||0,I=w[n-1][1]||0,k=(M-I)/2,z=0;z<s;++z){var V=t[e[z]],U=V[n][1]||0,K=V[n-1][1]||0;k+=U-K}m+=M,v+=k*M}i[n-1][1]+=i[n-1][0]=r,m&&(r-=v/m)}i[n-1][1]+=i[n-1][0]=r,Hg(t,e)}}function tv(t){"@babel/helpers - typeof";return tv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tv(t)}var BQ=["type","size","sizeType"];function UE(){return UE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},UE.apply(this,arguments)}function xO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function wO(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?xO(Object(r),!0).forEach(function(n){LQ(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xO(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function LQ(t,e,r){return e=FQ(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function FQ(t){var e=zQ(t,"string");return tv(e)=="symbol"?e:e+""}function zQ(t,e){if(tv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(tv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function jQ(t,e){if(t==null)return{};var r=UQ(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function UQ(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}var F6={symbolCircle:zP,symbolCross:lQ,symbolDiamond:uQ,symbolSquare:hQ,symbolStar:mQ,symbolTriangle:gQ,symbolWye:yQ},$Q=Math.PI/180,VQ=function(e){var r="symbol".concat(w1(e));return F6[r]||zP},qQ=function(e,r,n){if(r==="area")return e;switch(n){case"cross":return 5*e*e/9;case"diamond":return .5*e*e/Math.sqrt(3);case"square":return e*e;case"star":{var i=18*$Q;return 1.25*e*e*(Math.tan(i)-Math.tan(i*2)*Math.pow(Math.tan(i),2))}case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}},HQ=function(e,r){F6["symbol".concat(w1(e))]=r},jP=function(e){var r=e.type,n=r===void 0?"circle":r,i=e.size,o=i===void 0?64:i,c=e.sizeType,s=c===void 0?"area":c,m=jQ(e,BQ),v=wO(wO({},m),{},{type:n,size:o,sizeType:s}),w=function(){var U=VQ(n),K=vQ().type(U).size(qQ(o,s,n));return K()},M=v.className,I=v.cx,k=v.cy,z=an(v,!0);return I===+I&&k===+k&&o===+o?He.createElement("path",UE({},z,{className:pn("recharts-symbols",M),transform:"translate(".concat(I,", ").concat(k,")"),d:w()})):null};jP.registerSymbol=HQ;function Wg(t){"@babel/helpers - typeof";return Wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wg(t)}function $E(){return $E=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},$E.apply(this,arguments)}function TO(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function WQ(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?TO(Object(r),!0).forEach(function(n){rv(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):TO(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ZQ(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function XQ(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,j6(n.key),n)}}function GQ(t,e,r){return e&&XQ(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function YQ(t,e,r){return e=ix(e),KQ(t,z6()?Reflect.construct(e,r||[],ix(t).constructor):e.apply(t,r))}function KQ(t,e){if(e&&(Wg(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QQ(t)}function QQ(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function z6(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(z6=function(){return!!t})()}function ix(t){return ix=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ix(t)}function JQ(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&VE(t,e)}function VE(t,e){return VE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},VE(t,e)}function rv(t,e,r){return e=j6(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function j6(t){var e=eJ(t,"string");return Wg(e)=="symbol"?e:e+""}function eJ(t,e){if(Wg(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Wg(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Dc=32,UP=function(t){function e(){return ZQ(this,e),YQ(this,e,arguments)}return JQ(e,t),GQ(e,[{key:"renderIcon",value:function(n){var i=this.props.inactiveColor,o=Dc/2,c=Dc/6,s=Dc/3,m=n.inactive?i:n.color;if(n.type==="plainline")return He.createElement("line",{strokeWidth:4,fill:"none",stroke:m,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:o,x2:Dc,y2:o,className:"recharts-legend-icon"});if(n.type==="line")return He.createElement("path",{strokeWidth:4,fill:"none",stroke:m,d:"M0,".concat(o,"h").concat(s,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(2*s,",").concat(o,`
            H`).concat(Dc,"M").concat(2*s,",").concat(o,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(s,",").concat(o),className:"recharts-legend-icon"});if(n.type==="rect")return He.createElement("path",{stroke:"none",fill:m,d:"M0,".concat(Dc/8,"h").concat(Dc,"v").concat(Dc*3/4,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(He.isValidElement(n.legendIcon)){var v=WQ({},n);return delete v.legendIcon,He.cloneElement(n.legendIcon,v)}return He.createElement(jP,{fill:m,cx:o,cy:o,size:Dc,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,i=this.props,o=i.payload,c=i.iconSize,s=i.layout,m=i.formatter,v=i.inactiveColor,w={x:0,y:0,width:Dc,height:Dc},M={display:s==="horizontal"?"inline-block":"block",marginRight:10},I={display:"inline-block",verticalAlign:"middle",marginRight:4};return o.map(function(k,z){var V=k.formatter||m,U=pn(rv(rv({"recharts-legend-item":!0},"legend-item-".concat(z),!0),"inactive",k.inactive));if(k.type==="none")return null;var K=Xr(k.value)?null:k.value;Vh(!Xr(k.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var J=k.inactive?v:k.color;return He.createElement("li",$E({className:U,style:M,key:"legend-item-".concat(z)},Q0(n.props,k,z)),He.createElement(NE,{width:c,height:c,viewBox:w,style:I},n.renderIcon(k)),He.createElement("span",{className:"recharts-legend-item-text",style:{color:J}},V?V(K,k,z):K))})}},{key:"render",value:function(){var n=this.props,i=n.payload,o=n.layout,c=n.align;if(!i||!i.length)return null;var s={padding:0,margin:0,textAlign:o==="horizontal"?c:"left"};return He.createElement("ul",{className:"recharts-default-legend",style:s},this.renderItems())}}])}(it.PureComponent);rv(UP,"displayName","Legend");rv(UP,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var n2,SO;function tJ(){if(SO)return n2;SO=1;var t=v1();function e(){this.__data__=new t,this.size=0}return n2=e,n2}var i2,AO;function rJ(){if(AO)return i2;AO=1;function t(e){var r=this.__data__,n=r.delete(e);return this.size=r.size,n}return i2=t,i2}var a2,EO;function nJ(){if(EO)return a2;EO=1;function t(e){return this.__data__.get(e)}return a2=t,a2}var s2,MO;function iJ(){if(MO)return s2;MO=1;function t(e){return this.__data__.has(e)}return s2=t,s2}var o2,PO;function aJ(){if(PO)return o2;PO=1;var t=v1(),e=IP(),r=OP(),n=200;function i(o,c){var s=this.__data__;if(s instanceof t){var m=s.__data__;if(!e||m.length<n-1)return m.push([o,c]),this.size=++s.size,this;s=this.__data__=new r(m)}return s.set(o,c),this.size=s.size,this}return o2=i,o2}var l2,CO;function U6(){if(CO)return l2;CO=1;var t=v1(),e=tJ(),r=rJ(),n=nJ(),i=iJ(),o=aJ();function c(s){var m=this.__data__=new t(s);this.size=m.size}return c.prototype.clear=e,c.prototype.delete=r,c.prototype.get=n,c.prototype.has=i,c.prototype.set=o,l2=c,l2}var c2,RO;function sJ(){if(RO)return c2;RO=1;var t="__lodash_hash_undefined__";function e(r){return this.__data__.set(r,t),this}return c2=e,c2}var u2,IO;function oJ(){if(IO)return u2;IO=1;function t(e){return this.__data__.has(e)}return u2=t,u2}var h2,OO;function $6(){if(OO)return h2;OO=1;var t=OP(),e=sJ(),r=oJ();function n(i){var o=-1,c=i==null?0:i.length;for(this.__data__=new t;++o<c;)this.add(i[o])}return n.prototype.add=n.prototype.push=e,n.prototype.has=r,h2=n,h2}var f2,kO;function V6(){if(kO)return f2;kO=1;function t(e,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(r(e[n],n,e))return!0;return!1}return f2=t,f2}var d2,DO;function q6(){if(DO)return d2;DO=1;function t(e,r){return e.has(r)}return d2=t,d2}var p2,NO;function H6(){if(NO)return p2;NO=1;var t=$6(),e=V6(),r=q6(),n=1,i=2;function o(c,s,m,v,w,M){var I=m&n,k=c.length,z=s.length;if(k!=z&&!(I&&z>k))return!1;var V=M.get(c),U=M.get(s);if(V&&U)return V==s&&U==c;var K=-1,J=!0,Z=m&i?new t:void 0;for(M.set(c,s),M.set(s,c);++K<k;){var re=c[K],W=s[K];if(v)var Y=I?v(W,re,K,s,c,M):v(re,W,K,c,s,M);if(Y!==void 0){if(Y)continue;J=!1;break}if(Z){if(!e(s,function(ue,be){if(!r(Z,be)&&(re===ue||w(re,ue,m,v,M)))return Z.push(be)})){J=!1;break}}else if(!(re===W||w(re,W,m,v,M))){J=!1;break}}return M.delete(c),M.delete(s),J}return p2=o,p2}var m2,BO;function lJ(){if(BO)return m2;BO=1;var t=Bu(),e=t.Uint8Array;return m2=e,m2}var g2,LO;function cJ(){if(LO)return g2;LO=1;function t(e){var r=-1,n=Array(e.size);return e.forEach(function(i,o){n[++r]=[o,i]}),n}return g2=t,g2}var _2,FO;function $P(){if(FO)return _2;FO=1;function t(e){var r=-1,n=Array(e.size);return e.forEach(function(i){n[++r]=i}),n}return _2=t,_2}var y2,zO;function uJ(){if(zO)return y2;zO=1;var t=qv(),e=lJ(),r=RP(),n=H6(),i=cJ(),o=$P(),c=1,s=2,m="[object Boolean]",v="[object Date]",w="[object Error]",M="[object Map]",I="[object Number]",k="[object RegExp]",z="[object Set]",V="[object String]",U="[object Symbol]",K="[object ArrayBuffer]",J="[object DataView]",Z=t?t.prototype:void 0,re=Z?Z.valueOf:void 0;function W(Y,ue,be,Ce,Ye,Me,Ue){switch(be){case J:if(Y.byteLength!=ue.byteLength||Y.byteOffset!=ue.byteOffset)return!1;Y=Y.buffer,ue=ue.buffer;case K:return!(Y.byteLength!=ue.byteLength||!Me(new e(Y),new e(ue)));case m:case v:case I:return r(+Y,+ue);case w:return Y.name==ue.name&&Y.message==ue.message;case k:case V:return Y==ue+"";case M:var Qe=i;case z:var Ze=Ce&c;if(Qe||(Qe=o),Y.size!=ue.size&&!Ze)return!1;var ct=Ue.get(Y);if(ct)return ct==ue;Ce|=s,Ue.set(Y,ue);var Ie=n(Qe(Y),Qe(ue),Ce,Ye,Me,Ue);return Ue.delete(Y),Ie;case U:if(re)return re.call(Y)==re.call(ue)}return!1}return y2=W,y2}var v2,jO;function W6(){if(jO)return v2;jO=1;function t(e,r){for(var n=-1,i=r.length,o=e.length;++n<i;)e[o+n]=r[n];return e}return v2=t,v2}var b2,UO;function hJ(){if(UO)return b2;UO=1;var t=W6(),e=go();function r(n,i,o){var c=i(n);return e(n)?c:t(c,o(n))}return b2=r,b2}var x2,$O;function fJ(){if($O)return x2;$O=1;function t(e,r){for(var n=-1,i=e==null?0:e.length,o=0,c=[];++n<i;){var s=e[n];r(s,n,e)&&(c[o++]=s)}return c}return x2=t,x2}var w2,VO;function dJ(){if(VO)return w2;VO=1;function t(){return[]}return w2=t,w2}var T2,qO;function pJ(){if(qO)return T2;qO=1;var t=fJ(),e=dJ(),r=Object.prototype,n=r.propertyIsEnumerable,i=Object.getOwnPropertySymbols,o=i?function(c){return c==null?[]:(c=Object(c),t(i(c),function(s){return n.call(c,s)}))}:e;return T2=o,T2}var S2,HO;function mJ(){if(HO)return S2;HO=1;function t(e,r){for(var n=-1,i=Array(e);++n<e;)i[n]=r(n);return i}return S2=t,S2}var A2,WO;function gJ(){if(WO)return A2;WO=1;var t=Kh(),e=Qh(),r="[object Arguments]";function n(i){return e(i)&&t(i)==r}return A2=n,A2}var E2,ZO;function VP(){if(ZO)return E2;ZO=1;var t=gJ(),e=Qh(),r=Object.prototype,n=r.hasOwnProperty,i=r.propertyIsEnumerable,o=t(function(){return arguments}())?t:function(c){return e(c)&&n.call(c,"callee")&&!i.call(c,"callee")};return E2=o,E2}var ky={exports:{}},M2,XO;function _J(){if(XO)return M2;XO=1;function t(){return!1}return M2=t,M2}ky.exports;var GO;function Z6(){return GO||(GO=1,function(t,e){var r=Bu(),n=_J(),i=e&&!e.nodeType&&e,o=i&&!0&&t&&!t.nodeType&&t,c=o&&o.exports===i,s=c?r.Buffer:void 0,m=s?s.isBuffer:void 0,v=m||n;t.exports=v}(ky,ky.exports)),ky.exports}var P2,YO;function qP(){if(YO)return P2;YO=1;var t=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function r(n,i){var o=typeof n;return i=i??t,!!i&&(o=="number"||o!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return P2=r,P2}var C2,KO;function HP(){if(KO)return C2;KO=1;var t=9007199254740991;function e(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=t}return C2=e,C2}var R2,QO;function yJ(){if(QO)return R2;QO=1;var t=Kh(),e=HP(),r=Qh(),n="[object Arguments]",i="[object Array]",o="[object Boolean]",c="[object Date]",s="[object Error]",m="[object Function]",v="[object Map]",w="[object Number]",M="[object Object]",I="[object RegExp]",k="[object Set]",z="[object String]",V="[object WeakMap]",U="[object ArrayBuffer]",K="[object DataView]",J="[object Float32Array]",Z="[object Float64Array]",re="[object Int8Array]",W="[object Int16Array]",Y="[object Int32Array]",ue="[object Uint8Array]",be="[object Uint8ClampedArray]",Ce="[object Uint16Array]",Ye="[object Uint32Array]",Me={};Me[J]=Me[Z]=Me[re]=Me[W]=Me[Y]=Me[ue]=Me[be]=Me[Ce]=Me[Ye]=!0,Me[n]=Me[i]=Me[U]=Me[o]=Me[K]=Me[c]=Me[s]=Me[m]=Me[v]=Me[w]=Me[M]=Me[I]=Me[k]=Me[z]=Me[V]=!1;function Ue(Qe){return r(Qe)&&e(Qe.length)&&!!Me[t(Qe)]}return R2=Ue,R2}var I2,JO;function X6(){if(JO)return I2;JO=1;function t(e){return function(r){return e(r)}}return I2=t,I2}var Dy={exports:{}};Dy.exports;var ek;function vJ(){return ek||(ek=1,function(t,e){var r=p6(),n=e&&!e.nodeType&&e,i=n&&!0&&t&&!t.nodeType&&t,o=i&&i.exports===n,c=o&&r.process,s=function(){try{var m=i&&i.require&&i.require("util").types;return m||c&&c.binding&&c.binding("util")}catch{}}();t.exports=s}(Dy,Dy.exports)),Dy.exports}var O2,tk;function G6(){if(tk)return O2;tk=1;var t=yJ(),e=X6(),r=vJ(),n=r&&r.isTypedArray,i=n?e(n):t;return O2=i,O2}var k2,rk;function bJ(){if(rk)return k2;rk=1;var t=mJ(),e=VP(),r=go(),n=Z6(),i=qP(),o=G6(),c=Object.prototype,s=c.hasOwnProperty;function m(v,w){var M=r(v),I=!M&&e(v),k=!M&&!I&&n(v),z=!M&&!I&&!k&&o(v),V=M||I||k||z,U=V?t(v.length,String):[],K=U.length;for(var J in v)(w||s.call(v,J))&&!(V&&(J=="length"||k&&(J=="offset"||J=="parent")||z&&(J=="buffer"||J=="byteLength"||J=="byteOffset")||i(J,K)))&&U.push(J);return U}return k2=m,k2}var D2,nk;function xJ(){if(nk)return D2;nk=1;var t=Object.prototype;function e(r){var n=r&&r.constructor,i=typeof n=="function"&&n.prototype||t;return r===i}return D2=e,D2}var N2,ik;function Y6(){if(ik)return N2;ik=1;function t(e,r){return function(n){return e(r(n))}}return N2=t,N2}var B2,ak;function wJ(){if(ak)return B2;ak=1;var t=Y6(),e=t(Object.keys,Object);return B2=e,B2}var L2,sk;function TJ(){if(sk)return L2;sk=1;var t=xJ(),e=wJ(),r=Object.prototype,n=r.hasOwnProperty;function i(o){if(!t(o))return e(o);var c=[];for(var s in Object(o))n.call(o,s)&&s!="constructor"&&c.push(s);return c}return L2=i,L2}var F2,ok;function Zv(){if(ok)return F2;ok=1;var t=CP(),e=HP();function r(n){return n!=null&&e(n.length)&&!t(n)}return F2=r,F2}var z2,lk;function E1(){if(lk)return z2;lk=1;var t=bJ(),e=TJ(),r=Zv();function n(i){return r(i)?t(i):e(i)}return z2=n,z2}var j2,ck;function SJ(){if(ck)return j2;ck=1;var t=hJ(),e=pJ(),r=E1();function n(i){return t(i,r,e)}return j2=n,j2}var U2,uk;function AJ(){if(uk)return U2;uk=1;var t=SJ(),e=1,r=Object.prototype,n=r.hasOwnProperty;function i(o,c,s,m,v,w){var M=s&e,I=t(o),k=I.length,z=t(c),V=z.length;if(k!=V&&!M)return!1;for(var U=k;U--;){var K=I[U];if(!(M?K in c:n.call(c,K)))return!1}var J=w.get(o),Z=w.get(c);if(J&&Z)return J==c&&Z==o;var re=!0;w.set(o,c),w.set(c,o);for(var W=M;++U<k;){K=I[U];var Y=o[K],ue=c[K];if(m)var be=M?m(ue,Y,K,c,o,w):m(Y,ue,K,o,c,w);if(!(be===void 0?Y===ue||v(Y,ue,s,m,w):be)){re=!1;break}W||(W=K=="constructor")}if(re&&!W){var Ce=o.constructor,Ye=c.constructor;Ce!=Ye&&"constructor"in o&&"constructor"in c&&!(typeof Ce=="function"&&Ce instanceof Ce&&typeof Ye=="function"&&Ye instanceof Ye)&&(re=!1)}return w.delete(o),w.delete(c),re}return U2=i,U2}var $2,hk;function EJ(){if(hk)return $2;hk=1;var t=im(),e=Bu(),r=t(e,"DataView");return $2=r,$2}var V2,fk;function MJ(){if(fk)return V2;fk=1;var t=im(),e=Bu(),r=t(e,"Promise");return V2=r,V2}var q2,dk;function K6(){if(dk)return q2;dk=1;var t=im(),e=Bu(),r=t(e,"Set");return q2=r,q2}var H2,pk;function PJ(){if(pk)return H2;pk=1;var t=im(),e=Bu(),r=t(e,"WeakMap");return H2=r,H2}var W2,mk;function CJ(){if(mk)return W2;mk=1;var t=EJ(),e=IP(),r=MJ(),n=K6(),i=PJ(),o=Kh(),c=m6(),s="[object Map]",m="[object Object]",v="[object Promise]",w="[object Set]",M="[object WeakMap]",I="[object DataView]",k=c(t),z=c(e),V=c(r),U=c(n),K=c(i),J=o;return(t&&J(new t(new ArrayBuffer(1)))!=I||e&&J(new e)!=s||r&&J(r.resolve())!=v||n&&J(new n)!=w||i&&J(new i)!=M)&&(J=function(Z){var re=o(Z),W=re==m?Z.constructor:void 0,Y=W?c(W):"";if(Y)switch(Y){case k:return I;case z:return s;case V:return v;case U:return w;case K:return M}return re}),W2=J,W2}var Z2,gk;function RJ(){if(gk)return Z2;gk=1;var t=U6(),e=H6(),r=uJ(),n=AJ(),i=CJ(),o=go(),c=Z6(),s=G6(),m=1,v="[object Arguments]",w="[object Array]",M="[object Object]",I=Object.prototype,k=I.hasOwnProperty;function z(V,U,K,J,Z,re){var W=o(V),Y=o(U),ue=W?w:i(V),be=Y?w:i(U);ue=ue==v?M:ue,be=be==v?M:be;var Ce=ue==M,Ye=be==M,Me=ue==be;if(Me&&c(V)){if(!c(U))return!1;W=!0,Ce=!1}if(Me&&!Ce)return re||(re=new t),W||s(V)?e(V,U,K,J,Z,re):r(V,U,ue,K,J,Z,re);if(!(K&m)){var Ue=Ce&&k.call(V,"__wrapped__"),Qe=Ye&&k.call(U,"__wrapped__");if(Ue||Qe){var Ze=Ue?V.value():V,ct=Qe?U.value():U;return re||(re=new t),Z(Ze,ct,K,J,re)}}return Me?(re||(re=new t),n(V,U,K,J,Z,re)):!1}return Z2=z,Z2}var X2,_k;function WP(){if(_k)return X2;_k=1;var t=RJ(),e=Qh();function r(n,i,o,c,s){return n===i?!0:n==null||i==null||!e(n)&&!e(i)?n!==n&&i!==i:t(n,i,o,c,r,s)}return X2=r,X2}var G2,yk;function IJ(){if(yk)return G2;yk=1;var t=U6(),e=WP(),r=1,n=2;function i(o,c,s,m){var v=s.length,w=v,M=!m;if(o==null)return!w;for(o=Object(o);v--;){var I=s[v];if(M&&I[2]?I[1]!==o[I[0]]:!(I[0]in o))return!1}for(;++v<w;){I=s[v];var k=I[0],z=o[k],V=I[1];if(M&&I[2]){if(z===void 0&&!(k in o))return!1}else{var U=new t;if(m)var K=m(z,V,k,o,c,U);if(!(K===void 0?e(V,z,r|n,m,U):K))return!1}}return!0}return G2=i,G2}var Y2,vk;function Q6(){if(vk)return Y2;vk=1;var t=vd();function e(r){return r===r&&!t(r)}return Y2=e,Y2}var K2,bk;function OJ(){if(bk)return K2;bk=1;var t=Q6(),e=E1();function r(n){for(var i=e(n),o=i.length;o--;){var c=i[o],s=n[c];i[o]=[c,s,t(s)]}return i}return K2=r,K2}var Q2,xk;function J6(){if(xk)return Q2;xk=1;function t(e,r){return function(n){return n==null?!1:n[e]===r&&(r!==void 0||e in Object(n))}}return Q2=t,Q2}var J2,wk;function kJ(){if(wk)return J2;wk=1;var t=IJ(),e=OJ(),r=J6();function n(i){var o=e(i);return o.length==1&&o[0][2]?r(o[0][0],o[0][1]):function(c){return c===i||t(c,i,o)}}return J2=n,J2}var eS,Tk;function DJ(){if(Tk)return eS;Tk=1;function t(e,r){return e!=null&&r in Object(e)}return eS=t,eS}var tS,Sk;function NJ(){if(Sk)return tS;Sk=1;var t=y6(),e=VP(),r=go(),n=qP(),i=HP(),o=x1();function c(s,m,v){m=t(m,s);for(var w=-1,M=m.length,I=!1;++w<M;){var k=o(m[w]);if(!(I=s!=null&&v(s,k)))break;s=s[k]}return I||++w!=M?I:(M=s==null?0:s.length,!!M&&i(M)&&n(k,M)&&(r(s)||e(s)))}return tS=c,tS}var rS,Ak;function BJ(){if(Ak)return rS;Ak=1;var t=DJ(),e=NJ();function r(n,i){return n!=null&&e(n,i,t)}return rS=r,rS}var nS,Ek;function LJ(){if(Ek)return nS;Ek=1;var t=WP(),e=v6(),r=BJ(),n=PP(),i=Q6(),o=J6(),c=x1(),s=1,m=2;function v(w,M){return n(w)&&i(M)?o(c(w),M):function(I){var k=e(I,w);return k===void 0&&k===M?r(I,w):t(M,k,s|m)}}return nS=v,nS}var iS,Mk;function m_(){if(Mk)return iS;Mk=1;function t(e){return e}return iS=t,iS}var aS,Pk;function FJ(){if(Pk)return aS;Pk=1;function t(e){return function(r){return r==null?void 0:r[e]}}return aS=t,aS}var sS,Ck;function zJ(){if(Ck)return sS;Ck=1;var t=DP();function e(r){return function(n){return t(n,r)}}return sS=e,sS}var oS,Rk;function jJ(){if(Rk)return oS;Rk=1;var t=FJ(),e=zJ(),r=PP(),n=x1();function i(o){return r(o)?t(n(o)):e(o)}return oS=i,oS}var lS,Ik;function bd(){if(Ik)return lS;Ik=1;var t=kJ(),e=LJ(),r=m_(),n=go(),i=jJ();function o(c){return typeof c=="function"?c:c==null?r:typeof c=="object"?n(c)?e(c[0],c[1]):t(c):i(c)}return lS=o,lS}var cS,Ok;function ez(){if(Ok)return cS;Ok=1;function t(e,r,n,i){for(var o=e.length,c=n+(i?1:-1);i?c--:++c<o;)if(r(e[c],c,e))return c;return-1}return cS=t,cS}var uS,kk;function UJ(){if(kk)return uS;kk=1;function t(e){return e!==e}return uS=t,uS}var hS,Dk;function $J(){if(Dk)return hS;Dk=1;function t(e,r,n){for(var i=n-1,o=e.length;++i<o;)if(e[i]===r)return i;return-1}return hS=t,hS}var fS,Nk;function VJ(){if(Nk)return fS;Nk=1;var t=ez(),e=UJ(),r=$J();function n(i,o,c){return o===o?r(i,o,c):t(i,e,c)}return fS=n,fS}var dS,Bk;function qJ(){if(Bk)return dS;Bk=1;var t=VJ();function e(r,n){var i=r==null?0:r.length;return!!i&&t(r,n,0)>-1}return dS=e,dS}var pS,Lk;function HJ(){if(Lk)return pS;Lk=1;function t(e,r,n){for(var i=-1,o=e==null?0:e.length;++i<o;)if(n(r,e[i]))return!0;return!1}return pS=t,pS}var mS,Fk;function WJ(){if(Fk)return mS;Fk=1;function t(){}return mS=t,mS}var gS,zk;function ZJ(){if(zk)return gS;zk=1;var t=K6(),e=WJ(),r=$P(),n=1/0,i=t&&1/r(new t([,-0]))[1]==n?function(o){return new t(o)}:e;return gS=i,gS}var _S,jk;function XJ(){if(jk)return _S;jk=1;var t=$6(),e=qJ(),r=HJ(),n=q6(),i=ZJ(),o=$P(),c=200;function s(m,v,w){var M=-1,I=e,k=m.length,z=!0,V=[],U=V;if(w)z=!1,I=r;else if(k>=c){var K=v?null:i(m);if(K)return o(K);z=!1,I=n,U=new t}else U=v?[]:V;e:for(;++M<k;){var J=m[M],Z=v?v(J):J;if(J=w||J!==0?J:0,z&&Z===Z){for(var re=U.length;re--;)if(U[re]===Z)continue e;v&&U.push(Z),V.push(J)}else I(U,Z,w)||(U!==V&&U.push(Z),V.push(J))}return V}return _S=s,_S}var yS,Uk;function GJ(){if(Uk)return yS;Uk=1;var t=bd(),e=XJ();function r(n,i){return n&&n.length?e(n,t(i,2)):[]}return yS=r,yS}var YJ=GJ();const $k=Yn(YJ);function tz(t,e,r){return e===!0?$k(t,r):Xr(e)?$k(t,e):t}function Zg(t){"@babel/helpers - typeof";return Zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zg(t)}var KJ=["ref"];function Vk(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Dh(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Vk(Object(r),!0).forEach(function(n){M1(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Vk(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function QJ(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qk(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,nz(n.key),n)}}function JJ(t,e,r){return e&&qk(t.prototype,e),r&&qk(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function eee(t,e,r){return e=ax(e),tee(t,rz()?Reflect.construct(e,r||[],ax(t).constructor):e.apply(t,r))}function tee(t,e){if(e&&(Zg(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ree(t)}function ree(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rz(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rz=function(){return!!t})()}function ax(t){return ax=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ax(t)}function nee(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qE(t,e)}function qE(t,e){return qE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},qE(t,e)}function M1(t,e,r){return e=nz(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nz(t){var e=iee(t,"string");return Zg(e)=="symbol"?e:e+""}function iee(t,e){if(Zg(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Zg(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function aee(t,e){if(t==null)return{};var r=see(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function see(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function oee(t){return t.value}function lee(t,e){if(He.isValidElement(t))return He.cloneElement(t,e);if(typeof t=="function")return He.createElement(t,e);e.ref;var r=aee(e,KJ);return He.createElement(UP,r)}var Hk=1,md=function(t){function e(){var r;QJ(this,e);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return r=eee(this,e,[].concat(i)),M1(r,"lastBoundingBox",{width:-1,height:-1}),r}return nee(e,t),JJ(e,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,i=this.getBBox();i?(Math.abs(i.width-this.lastBoundingBox.width)>Hk||Math.abs(i.height-this.lastBoundingBox.height)>Hk)&&(this.lastBoundingBox.width=i.width,this.lastBoundingBox.height=i.height,n&&n(i)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Dh({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var i=this.props,o=i.layout,c=i.align,s=i.verticalAlign,m=i.margin,v=i.chartWidth,w=i.chartHeight,M,I;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(c==="center"&&o==="vertical"){var k=this.getBBoxSnapshot();M={left:((v||0)-k.width)/2}}else M=c==="right"?{right:m&&m.right||0}:{left:m&&m.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(s==="middle"){var z=this.getBBoxSnapshot();I={top:((w||0)-z.height)/2}}else I=s==="bottom"?{bottom:m&&m.bottom||0}:{top:m&&m.top||0};return Dh(Dh({},M),I)}},{key:"render",value:function(){var n=this,i=this.props,o=i.content,c=i.width,s=i.height,m=i.wrapperStyle,v=i.payloadUniqBy,w=i.payload,M=Dh(Dh({position:"absolute",width:c||"auto",height:s||"auto"},this.getDefaultPosition(m)),m);return He.createElement("div",{className:"recharts-legend-wrapper",style:M,ref:function(k){n.wrapperNode=k}},lee(o,Dh(Dh({},this.props),{},{payload:tz(w,v,oee)})))}}],[{key:"getWithHeight",value:function(n,i){var o=Dh(Dh({},this.defaultProps),n.props),c=o.layout;return c==="vertical"&&nr(n.props.height)?{height:n.props.height}:c==="horizontal"?{width:n.props.width||i}:null}}])}(it.PureComponent);M1(md,"displayName","Legend");M1(md,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var vS,Wk;function cee(){if(Wk)return vS;Wk=1;var t=qv(),e=VP(),r=go(),n=t?t.isConcatSpreadable:void 0;function i(o){return r(o)||e(o)||!!(n&&o&&o[n])}return vS=i,vS}var bS,Zk;function iz(){if(Zk)return bS;Zk=1;var t=W6(),e=cee();function r(n,i,o,c,s){var m=-1,v=n.length;for(o||(o=e),s||(s=[]);++m<v;){var w=n[m];i>0&&o(w)?i>1?r(w,i-1,o,c,s):t(s,w):c||(s[s.length]=w)}return s}return bS=r,bS}var xS,Xk;function uee(){if(Xk)return xS;Xk=1;function t(e){return function(r,n,i){for(var o=-1,c=Object(r),s=i(r),m=s.length;m--;){var v=s[e?m:++o];if(n(c[v],v,c)===!1)break}return r}}return xS=t,xS}var wS,Gk;function hee(){if(Gk)return wS;Gk=1;var t=uee(),e=t();return wS=e,wS}var TS,Yk;function az(){if(Yk)return TS;Yk=1;var t=hee(),e=E1();function r(n,i){return n&&t(n,i,e)}return TS=r,TS}var SS,Kk;function fee(){if(Kk)return SS;Kk=1;var t=Zv();function e(r,n){return function(i,o){if(i==null)return i;if(!t(i))return r(i,o);for(var c=i.length,s=n?c:-1,m=Object(i);(n?s--:++s<c)&&o(m[s],s,m)!==!1;);return i}}return SS=e,SS}var AS,Qk;function ZP(){if(Qk)return AS;Qk=1;var t=az(),e=fee(),r=e(t);return AS=r,AS}var ES,Jk;function sz(){if(Jk)return ES;Jk=1;var t=ZP(),e=Zv();function r(n,i){var o=-1,c=e(n)?Array(n.length):[];return t(n,function(s,m,v){c[++o]=i(s,m,v)}),c}return ES=r,ES}var MS,eD;function dee(){if(eD)return MS;eD=1;function t(e,r){var n=e.length;for(e.sort(r);n--;)e[n]=e[n].value;return e}return MS=t,MS}var PS,tD;function pee(){if(tD)return PS;tD=1;var t=d_();function e(r,n){if(r!==n){var i=r!==void 0,o=r===null,c=r===r,s=t(r),m=n!==void 0,v=n===null,w=n===n,M=t(n);if(!v&&!M&&!s&&r>n||s&&m&&w&&!v&&!M||o&&m&&w||!i&&w||!c)return 1;if(!o&&!s&&!M&&r<n||M&&i&&c&&!o&&!s||v&&i&&c||!m&&c||!w)return-1}return 0}return PS=e,PS}var CS,rD;function mee(){if(rD)return CS;rD=1;var t=pee();function e(r,n,i){for(var o=-1,c=r.criteria,s=n.criteria,m=c.length,v=i.length;++o<m;){var w=t(c[o],s[o]);if(w){if(o>=v)return w;var M=i[o];return w*(M=="desc"?-1:1)}}return r.index-n.index}return CS=e,CS}var RS,nD;function gee(){if(nD)return RS;nD=1;var t=kP(),e=DP(),r=bd(),n=sz(),i=dee(),o=X6(),c=mee(),s=m_(),m=go();function v(w,M,I){M.length?M=t(M,function(V){return m(V)?function(U){return e(U,V.length===1?V[0]:V)}:V}):M=[s];var k=-1;M=t(M,o(r));var z=n(w,function(V,U,K){var J=t(M,function(Z){return Z(V)});return{criteria:J,index:++k,value:V}});return i(z,function(V,U){return c(V,U,I)})}return RS=v,RS}var IS,iD;function _ee(){if(iD)return IS;iD=1;function t(e,r,n){switch(n.length){case 0:return e.call(r);case 1:return e.call(r,n[0]);case 2:return e.call(r,n[0],n[1]);case 3:return e.call(r,n[0],n[1],n[2])}return e.apply(r,n)}return IS=t,IS}var OS,aD;function yee(){if(aD)return OS;aD=1;var t=_ee(),e=Math.max;function r(n,i,o){return i=e(i===void 0?n.length-1:i,0),function(){for(var c=arguments,s=-1,m=e(c.length-i,0),v=Array(m);++s<m;)v[s]=c[i+s];s=-1;for(var w=Array(i+1);++s<i;)w[s]=c[s];return w[i]=o(v),t(n,this,w)}}return OS=r,OS}var kS,sD;function vee(){if(sD)return kS;sD=1;function t(e){return function(){return e}}return kS=t,kS}var DS,oD;function oz(){if(oD)return DS;oD=1;var t=im(),e=function(){try{var r=t(Object,"defineProperty");return r({},"",{}),r}catch{}}();return DS=e,DS}var NS,lD;function bee(){if(lD)return NS;lD=1;var t=vee(),e=oz(),r=m_(),n=e?function(i,o){return e(i,"toString",{configurable:!0,enumerable:!1,value:t(o),writable:!0})}:r;return NS=n,NS}var BS,cD;function xee(){if(cD)return BS;cD=1;var t=800,e=16,r=Date.now;function n(i){var o=0,c=0;return function(){var s=r(),m=e-(s-c);if(c=s,m>0){if(++o>=t)return arguments[0]}else o=0;return i.apply(void 0,arguments)}}return BS=n,BS}var LS,uD;function wee(){if(uD)return LS;uD=1;var t=bee(),e=xee(),r=e(t);return LS=r,LS}var FS,hD;function Tee(){if(hD)return FS;hD=1;var t=m_(),e=yee(),r=wee();function n(i,o){return r(e(i,o,t),i+"")}return FS=n,FS}var zS,fD;function P1(){if(fD)return zS;fD=1;var t=RP(),e=Zv(),r=qP(),n=vd();function i(o,c,s){if(!n(s))return!1;var m=typeof c;return(m=="number"?e(s)&&r(c,s.length):m=="string"&&c in s)?t(s[c],o):!1}return zS=i,zS}var jS,dD;function See(){if(dD)return jS;dD=1;var t=iz(),e=gee(),r=Tee(),n=P1(),i=r(function(o,c){if(o==null)return[];var s=c.length;return s>1&&n(o,c[0],c[1])?c=[]:s>2&&n(c[0],c[1],c[2])&&(c=[c[0]]),e(o,t(c,1),[])});return jS=i,jS}var Aee=See();const XP=Yn(Aee);function nv(t){"@babel/helpers - typeof";return nv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nv(t)}function HE(){return HE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},HE.apply(this,arguments)}function Eee(t,e){return Ree(t)||Cee(t,e)||Pee(t,e)||Mee()}function Mee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pee(t,e){if(t){if(typeof t=="string")return pD(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pD(t,e)}}function pD(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Cee(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function Ree(t){if(Array.isArray(t))return t}function mD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function US(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?mD(Object(r),!0).forEach(function(n){Iee(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Iee(t,e,r){return e=Oee(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oee(t){var e=kee(t,"string");return nv(e)=="symbol"?e:e+""}function kee(t,e){if(nv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(nv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Dee(t){return Array.isArray(t)&&Da(t[0])&&Da(t[1])?t.join(" ~ "):t}var Nee=function(e){var r=e.separator,n=r===void 0?" : ":r,i=e.contentStyle,o=i===void 0?{}:i,c=e.itemStyle,s=c===void 0?{}:c,m=e.labelStyle,v=m===void 0?{}:m,w=e.payload,M=e.formatter,I=e.itemSorter,k=e.wrapperClassName,z=e.labelClassName,V=e.label,U=e.labelFormatter,K=e.accessibilityLayer,J=K===void 0?!1:K,Z=function(){if(w&&w.length){var Ue={padding:0,margin:0},Qe=(I?XP(w,I):w).map(function(Ze,ct){if(Ze.type==="none")return null;var Ie=US({display:"block",paddingTop:4,paddingBottom:4,color:Ze.color||"#000"},s),et=Ze.formatter||M||Dee,ot=Ze.value,Bt=Ze.name,Te=ot,ft=Bt;if(et&&Te!=null&&ft!=null){var vt=et(ot,Bt,Ze,ct,w);if(Array.isArray(vt)){var Ct=Eee(vt,2);Te=Ct[0],ft=Ct[1]}else Te=vt}return He.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(ct),style:Ie},Da(ft)?He.createElement("span",{className:"recharts-tooltip-item-name"},ft):null,Da(ft)?He.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,He.createElement("span",{className:"recharts-tooltip-item-value"},Te),He.createElement("span",{className:"recharts-tooltip-item-unit"},Ze.unit||""))});return He.createElement("ul",{className:"recharts-tooltip-item-list",style:Ue},Qe)}return null},re=US({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},o),W=US({margin:0},v),Y=!tn(V),ue=Y?V:"",be=pn("recharts-default-tooltip",k),Ce=pn("recharts-tooltip-label",z);Y&&U&&w!==void 0&&w!==null&&(ue=U(V,w));var Ye=J?{role:"status","aria-live":"assertive"}:{};return He.createElement("div",HE({className:be,style:re},Ye),He.createElement("p",{className:Ce,style:W},He.isValidElement(ue)?ue:"".concat(ue)),Z())};function iv(t){"@babel/helpers - typeof";return iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},iv(t)}function n0(t,e,r){return e=Bee(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Bee(t){var e=Lee(t,"string");return iv(e)=="symbol"?e:e+""}function Lee(t,e){if(iv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(iv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var vy="recharts-tooltip-wrapper",Fee={visibility:"hidden"};function zee(t){var e=t.coordinate,r=t.translateX,n=t.translateY;return pn(vy,n0(n0(n0(n0({},"".concat(vy,"-right"),nr(r)&&e&&nr(e.x)&&r>=e.x),"".concat(vy,"-left"),nr(r)&&e&&nr(e.x)&&r<e.x),"".concat(vy,"-bottom"),nr(n)&&e&&nr(e.y)&&n>=e.y),"".concat(vy,"-top"),nr(n)&&e&&nr(e.y)&&n<e.y))}function gD(t){var e=t.allowEscapeViewBox,r=t.coordinate,n=t.key,i=t.offsetTopLeft,o=t.position,c=t.reverseDirection,s=t.tooltipDimension,m=t.viewBox,v=t.viewBoxDimension;if(o&&nr(o[n]))return o[n];var w=r[n]-s-i,M=r[n]+i;if(e[n])return c[n]?w:M;if(c[n]){var I=w,k=m[n];return I<k?Math.max(M,m[n]):Math.max(w,m[n])}var z=M+s,V=m[n]+v;return z>V?Math.max(w,m[n]):Math.max(M,m[n])}function jee(t){var e=t.translateX,r=t.translateY,n=t.useTranslate3d;return{transform:n?"translate3d(".concat(e,"px, ").concat(r,"px, 0)"):"translate(".concat(e,"px, ").concat(r,"px)")}}function Uee(t){var e=t.allowEscapeViewBox,r=t.coordinate,n=t.offsetTopLeft,i=t.position,o=t.reverseDirection,c=t.tooltipBox,s=t.useTranslate3d,m=t.viewBox,v,w,M;return c.height>0&&c.width>0&&r?(w=gD({allowEscapeViewBox:e,coordinate:r,key:"x",offsetTopLeft:n,position:i,reverseDirection:o,tooltipDimension:c.width,viewBox:m,viewBoxDimension:m.width}),M=gD({allowEscapeViewBox:e,coordinate:r,key:"y",offsetTopLeft:n,position:i,reverseDirection:o,tooltipDimension:c.height,viewBox:m,viewBoxDimension:m.height}),v=jee({translateX:w,translateY:M,useTranslate3d:s})):v=Fee,{cssProperties:v,cssClasses:zee({translateX:w,translateY:M,coordinate:r})}}function Xg(t){"@babel/helpers - typeof";return Xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xg(t)}function _D(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function yD(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?_D(Object(r),!0).forEach(function(n){ZE(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_D(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function $ee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,cz(n.key),n)}}function qee(t,e,r){return e&&Vee(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Hee(t,e,r){return e=sx(e),Wee(t,lz()?Reflect.construct(e,r||[],sx(t).constructor):e.apply(t,r))}function Wee(t,e){if(e&&(Xg(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zee(t)}function Zee(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lz(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lz=function(){return!!t})()}function sx(t){return sx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},sx(t)}function Xee(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&WE(t,e)}function WE(t,e){return WE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},WE(t,e)}function ZE(t,e,r){return e=cz(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function cz(t){var e=Gee(t,"string");return Xg(e)=="symbol"?e:e+""}function Gee(t,e){if(Xg(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Xg(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var vD=1,Yee=function(t){function e(){var r;$ee(this,e);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return r=Hee(this,e,[].concat(i)),ZE(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),ZE(r,"handleKeyDown",function(c){if(c.key==="Escape"){var s,m,v,w;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(m=r.props.coordinate)===null||m===void 0?void 0:m.x)!==null&&s!==void 0?s:0,y:(v=(w=r.props.coordinate)===null||w===void 0?void 0:w.y)!==null&&v!==void 0?v:0}})}}),r}return Xee(e,t),qee(e,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>vD||Math.abs(n.height-this.state.lastBoundingBox.height)>vD)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,i;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((i=this.props.coordinate)===null||i===void 0?void 0:i.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,i=this.props,o=i.active,c=i.allowEscapeViewBox,s=i.animationDuration,m=i.animationEasing,v=i.children,w=i.coordinate,M=i.hasPayload,I=i.isAnimationActive,k=i.offset,z=i.position,V=i.reverseDirection,U=i.useTranslate3d,K=i.viewBox,J=i.wrapperStyle,Z=Uee({allowEscapeViewBox:c,coordinate:w,offsetTopLeft:k,position:z,reverseDirection:V,tooltipBox:this.state.lastBoundingBox,useTranslate3d:U,viewBox:K}),re=Z.cssClasses,W=Z.cssProperties,Y=yD(yD({transition:I&&o?"transform ".concat(s,"ms ").concat(m):void 0},W),{},{pointerEvents:"none",visibility:!this.state.dismissed&&o&&M?"visible":"hidden",position:"absolute",top:0,left:0},J);return He.createElement("div",{tabIndex:-1,className:re,style:Y,ref:function(be){n.wrapperNode=be}},v)}}])}(it.PureComponent),Kee=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},g_={isSsr:Kee()};function Gg(t){"@babel/helpers - typeof";return Gg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gg(t)}function bD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function xD(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bD(Object(r),!0).forEach(function(n){GP(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Qee(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Jee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,hz(n.key),n)}}function ete(t,e,r){return e&&Jee(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function tte(t,e,r){return e=ox(e),rte(t,uz()?Reflect.construct(e,r||[],ox(t).constructor):e.apply(t,r))}function rte(t,e){if(e&&(Gg(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nte(t)}function nte(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uz(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uz=function(){return!!t})()}function ox(t){return ox=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ox(t)}function ite(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&XE(t,e)}function XE(t,e){return XE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},XE(t,e)}function GP(t,e,r){return e=hz(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function hz(t){var e=ate(t,"string");return Gg(e)=="symbol"?e:e+""}function ate(t,e){if(Gg(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Gg(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function ste(t){return t.dataKey}function ote(t,e){return He.isValidElement(t)?He.cloneElement(t,e):typeof t=="function"?He.createElement(t,e):He.createElement(Nee,e)}var Fc=function(t){function e(){return Qee(this,e),tte(this,e,arguments)}return ite(e,t),ete(e,[{key:"render",value:function(){var n=this,i=this.props,o=i.active,c=i.allowEscapeViewBox,s=i.animationDuration,m=i.animationEasing,v=i.content,w=i.coordinate,M=i.filterNull,I=i.isAnimationActive,k=i.offset,z=i.payload,V=i.payloadUniqBy,U=i.position,K=i.reverseDirection,J=i.useTranslate3d,Z=i.viewBox,re=i.wrapperStyle,W=z??[];M&&W.length&&(W=tz(z.filter(function(ue){return ue.value!=null&&(ue.hide!==!0||n.props.includeHidden)}),V,ste));var Y=W.length>0;return He.createElement(Yee,{allowEscapeViewBox:c,animationDuration:s,animationEasing:m,isAnimationActive:I,active:o,coordinate:w,hasPayload:Y,offset:k,position:U,reverseDirection:K,useTranslate3d:J,viewBox:Z,wrapperStyle:re},ote(v,xD(xD({},this.props),{},{payload:W})))}}])}(it.PureComponent);GP(Fc,"displayName","Tooltip");GP(Fc,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!g_.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var $S,wD;function lte(){if(wD)return $S;wD=1;var t=Bu(),e=function(){return t.Date.now()};return $S=e,$S}var VS,TD;function cte(){if(TD)return VS;TD=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return VS=e,VS}var qS,SD;function ute(){if(SD)return qS;SD=1;var t=cte(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return qS=r,qS}var HS,AD;function fz(){if(AD)return HS;AD=1;var t=ute(),e=vd(),r=d_(),n=NaN,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,s=parseInt;function m(v){if(typeof v=="number")return v;if(r(v))return n;if(e(v)){var w=typeof v.valueOf=="function"?v.valueOf():v;v=e(w)?w+"":w}if(typeof v!="string")return v===0?v:+v;v=t(v);var M=o.test(v);return M||c.test(v)?s(v.slice(2),M?2:8):i.test(v)?n:+v}return HS=m,HS}var WS,ED;function hte(){if(ED)return WS;ED=1;var t=vd(),e=lte(),r=fz(),n="Expected a function",i=Math.max,o=Math.min;function c(s,m,v){var w,M,I,k,z,V,U=0,K=!1,J=!1,Z=!0;if(typeof s!="function")throw new TypeError(n);m=r(m)||0,t(v)&&(K=!!v.leading,J="maxWait"in v,I=J?i(r(v.maxWait)||0,m):I,Z="trailing"in v?!!v.trailing:Z);function re(Qe){var Ze=w,ct=M;return w=M=void 0,U=Qe,k=s.apply(ct,Ze),k}function W(Qe){return U=Qe,z=setTimeout(be,m),K?re(Qe):k}function Y(Qe){var Ze=Qe-V,ct=Qe-U,Ie=m-Ze;return J?o(Ie,I-ct):Ie}function ue(Qe){var Ze=Qe-V,ct=Qe-U;return V===void 0||Ze>=m||Ze<0||J&&ct>=I}function be(){var Qe=e();if(ue(Qe))return Ce(Qe);z=setTimeout(be,Y(Qe))}function Ce(Qe){return z=void 0,Z&&w?re(Qe):(w=M=void 0,k)}function Ye(){z!==void 0&&clearTimeout(z),U=0,w=V=M=z=void 0}function Me(){return z===void 0?k:Ce(e())}function Ue(){var Qe=e(),Ze=ue(Qe);if(w=arguments,M=this,V=Qe,Ze){if(z===void 0)return W(V);if(J)return clearTimeout(z),z=setTimeout(be,m),re(V)}return z===void 0&&(z=setTimeout(be,m)),k}return Ue.cancel=Ye,Ue.flush=Me,Ue}return WS=c,WS}var ZS,MD;function fte(){if(MD)return ZS;MD=1;var t=hte(),e=vd(),r="Expected a function";function n(i,o,c){var s=!0,m=!0;if(typeof i!="function")throw new TypeError(r);return e(c)&&(s="leading"in c?!!c.leading:s,m="trailing"in c?!!c.trailing:m),t(i,o,{leading:s,maxWait:o,trailing:m})}return ZS=n,ZS}var dte=fte();const dz=Yn(dte);function av(t){"@babel/helpers - typeof";return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},av(t)}function PD(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function i0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?PD(Object(r),!0).forEach(function(n){pte(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):PD(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function pte(t,e,r){return e=mte(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mte(t){var e=gte(t,"string");return av(e)=="symbol"?e:e+""}function gte(t,e){if(av(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(av(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _te(t,e){return xte(t)||bte(t,e)||vte(t,e)||yte()}function yte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vte(t,e){if(t){if(typeof t=="string")return CD(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return CD(t,e)}}function CD(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bte(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function xte(t){if(Array.isArray(t))return t}var RD=it.forwardRef(function(t,e){var r=t.aspect,n=t.initialDimension,i=n===void 0?{width:-1,height:-1}:n,o=t.width,c=o===void 0?"100%":o,s=t.height,m=s===void 0?"100%":s,v=t.minWidth,w=v===void 0?0:v,M=t.minHeight,I=t.maxHeight,k=t.children,z=t.debounce,V=z===void 0?0:z,U=t.id,K=t.className,J=t.onResize,Z=t.style,re=Z===void 0?{}:Z,W=it.useRef(null),Y=it.useRef();Y.current=J,it.useImperativeHandle(e,function(){return Object.defineProperty(W.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),W.current},configurable:!0})});var ue=it.useState({containerWidth:i.width,containerHeight:i.height}),be=_te(ue,2),Ce=be[0],Ye=be[1],Me=it.useCallback(function(Qe,Ze){Ye(function(ct){var Ie=Math.round(Qe),et=Math.round(Ze);return ct.containerWidth===Ie&&ct.containerHeight===et?ct:{containerWidth:Ie,containerHeight:et}})},[]);it.useEffect(function(){var Qe=function(Bt){var Te,ft=Bt[0].contentRect,vt=ft.width,Ct=ft.height;Me(vt,Ct),(Te=Y.current)===null||Te===void 0||Te.call(Y,vt,Ct)};V>0&&(Qe=dz(Qe,V,{trailing:!0,leading:!1}));var Ze=new ResizeObserver(Qe),ct=W.current.getBoundingClientRect(),Ie=ct.width,et=ct.height;return Me(Ie,et),Ze.observe(W.current),function(){Ze.disconnect()}},[Me,V]);var Ue=it.useMemo(function(){var Qe=Ce.containerWidth,Ze=Ce.containerHeight;if(Qe<0||Ze<0)return null;Vh(Dp(c)||Dp(m),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,c,m),Vh(!r||r>0,"The aspect(%s) must be greater than zero.",r);var ct=Dp(c)?Qe:c,Ie=Dp(m)?Ze:m;r&&r>0&&(ct?Ie=ct/r:Ie&&(ct=Ie*r),I&&Ie>I&&(Ie=I)),Vh(ct>0||Ie>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,ct,Ie,c,m,w,M,r);var et=!Array.isArray(k)&&$h(k.type).endsWith("Chart");return He.Children.map(k,function(ot){return He.isValidElement(ot)?it.cloneElement(ot,i0({width:ct,height:Ie},et?{style:i0({height:"100%",width:"100%",maxHeight:Ie,maxWidth:ct},ot.props.style)}:{})):ot})},[r,k,m,I,M,w,Ce,c]);return He.createElement("div",{id:U?"".concat(U):void 0,className:pn("recharts-responsive-container",K),style:i0(i0({},re),{},{width:c,height:m,minWidth:w,minHeight:M,maxHeight:I}),ref:W},Ue)}),pz=function(e){return null};pz.displayName="Cell";function sv(t){"@babel/helpers - typeof";return sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sv(t)}function ID(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function GE(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ID(Object(r),!0).forEach(function(n){wte(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ID(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function wte(t,e,r){return e=Tte(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Tte(t){var e=Ste(t,"string");return sv(e)=="symbol"?e:e+""}function Ste(t,e){if(sv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(sv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var mg={widthCache:{},cacheCount:0},Ate=2e3,Ete={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},OD="recharts_measurement_span";function Mte(t){var e=GE({},t);return Object.keys(e).forEach(function(r){e[r]||delete e[r]}),e}var Vy=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e==null||g_.isSsr)return{width:0,height:0};var n=Mte(r),i=JSON.stringify({text:e,copyStyle:n});if(mg.widthCache[i])return mg.widthCache[i];try{var o=document.getElementById(OD);o||(o=document.createElement("span"),o.setAttribute("id",OD),o.setAttribute("aria-hidden","true"),document.body.appendChild(o));var c=GE(GE({},Ete),n);Object.assign(o.style,c),o.textContent="".concat(e);var s=o.getBoundingClientRect(),m={width:s.width,height:s.height};return mg.widthCache[i]=m,++mg.cacheCount>Ate&&(mg.cacheCount=0,mg.widthCache={}),m}catch{return{width:0,height:0}}},Pte=function(e){return{top:e.top+window.scrollY-document.documentElement.clientTop,left:e.left+window.scrollX-document.documentElement.clientLeft}};function ov(t){"@babel/helpers - typeof";return ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ov(t)}function lx(t,e){return Ote(t)||Ite(t,e)||Rte(t,e)||Cte()}function Cte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rte(t,e){if(t){if(typeof t=="string")return kD(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kD(t,e)}}function kD(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ite(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;m=!1}else for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function Ote(t){if(Array.isArray(t))return t}function kte(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function DD(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Nte(n.key),n)}}function Dte(t,e,r){return e&&DD(t.prototype,e),r&&DD(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Nte(t){var e=Bte(t,"string");return ov(e)=="symbol"?e:e+""}function Bte(t,e){if(ov(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(ov(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var ND=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,BD=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Lte=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,Fte=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,mz={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},zte=Object.keys(mz),Eg="NaN";function jte(t,e){return t*mz[e]}var a0=function(){function t(e,r){kte(this,t),this.num=e,this.unit=r,this.num=e,this.unit=r,Number.isNaN(e)&&(this.unit=""),r!==""&&!Lte.test(r)&&(this.num=NaN,this.unit=""),zte.includes(r)&&(this.num=jte(e,r),this.unit="px")}return Dte(t,[{key:"add",value:function(r){return this.unit!==r.unit?new t(NaN,""):new t(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new t(NaN,""):new t(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new t(NaN,""):new t(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new t(NaN,""):new t(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,i=(n=Fte.exec(r))!==null&&n!==void 0?n:[],o=lx(i,3),c=o[1],s=o[2];return new t(parseFloat(c),s??"")}}])}();function gz(t){if(t.includes(Eg))return Eg;for(var e=t;e.includes("*")||e.includes("/");){var r,n=(r=ND.exec(e))!==null&&r!==void 0?r:[],i=lx(n,4),o=i[1],c=i[2],s=i[3],m=a0.parse(o??""),v=a0.parse(s??""),w=c==="*"?m.multiply(v):m.divide(v);if(w.isNaN())return Eg;e=e.replace(ND,w.toString())}for(;e.includes("+")||/.-\d+(?:\.\d+)?/.test(e);){var M,I=(M=BD.exec(e))!==null&&M!==void 0?M:[],k=lx(I,4),z=k[1],V=k[2],U=k[3],K=a0.parse(z??""),J=a0.parse(U??""),Z=V==="+"?K.add(J):K.subtract(J);if(Z.isNaN())return Eg;e=e.replace(BD,Z.toString())}return e}var LD=/\(([^()]*)\)/;function Ute(t){for(var e=t;e.includes("(");){var r=LD.exec(e),n=lx(r,2),i=n[1];e=e.replace(LD,gz(i))}return e}function $te(t){var e=t.replace(/\s+/g,"");return e=Ute(e),e=gz(e),e}function Vte(t){try{return $te(t)}catch{return Eg}}function XS(t){var e=Vte(t.slice(5,-1));return e===Eg?"":e}var qte=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],Hte=["dx","dy","angle","className","breakAll"];function YE(){return YE=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},YE.apply(this,arguments)}function FD(t,e){if(t==null)return{};var r=Wte(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Wte(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function zD(t,e){return Yte(t)||Gte(t,e)||Xte(t,e)||Zte()}function Zte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xte(t,e){if(t){if(typeof t=="string")return jD(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jD(t,e)}}function jD(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Gte(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e===0){if(Object(r)!==r)return;m=!1}else for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function Yte(t){if(Array.isArray(t))return t}var _z=/[ \f\n\r\t\v\u2028\u2029]+/,yz=function(e){var r=e.children,n=e.breakAll,i=e.style;try{var o=[];tn(r)||(n?o=r.toString().split(""):o=r.toString().split(_z));var c=o.map(function(m){return{word:m,width:Vy(m,i).width}}),s=n?0:Vy(" ",i).width;return{wordsWithComputedWidth:c,spaceWidth:s}}catch{return null}},Kte=function(e,r,n,i,o){var c=e.maxLines,s=e.children,m=e.style,v=e.breakAll,w=nr(c),M=s,I=function(){var ct=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return ct.reduce(function(Ie,et){var ot=et.word,Bt=et.width,Te=Ie[Ie.length-1];if(Te&&(i==null||o||Te.width+Bt+n<Number(i)))Te.words.push(ot),Te.width+=Bt+n;else{var ft={words:[ot],width:Bt};Ie.push(ft)}return Ie},[])},k=I(r),z=function(ct){return ct.reduce(function(Ie,et){return Ie.width>et.width?Ie:et})};if(!w)return k;for(var V="…",U=function(ct){var Ie=M.slice(0,ct),et=yz({breakAll:v,style:m,children:Ie+V}).wordsWithComputedWidth,ot=I(et),Bt=ot.length>c||z(ot).width>Number(i);return[Bt,ot]},K=0,J=M.length-1,Z=0,re;K<=J&&Z<=M.length-1;){var W=Math.floor((K+J)/2),Y=W-1,ue=U(Y),be=zD(ue,2),Ce=be[0],Ye=be[1],Me=U(W),Ue=zD(Me,1),Qe=Ue[0];if(!Ce&&!Qe&&(K=W+1),Ce&&Qe&&(J=W-1),!Ce&&Qe){re=Ye;break}Z++}return re||k},UD=function(e){var r=tn(e)?[]:e.toString().split(_z);return[{words:r}]},Qte=function(e){var r=e.width,n=e.scaleToFit,i=e.children,o=e.style,c=e.breakAll,s=e.maxLines;if((r||n)&&!g_.isSsr){var m,v,w=yz({breakAll:c,children:i,style:o});if(w){var M=w.wordsWithComputedWidth,I=w.spaceWidth;m=M,v=I}else return UD(i);return Kte({breakAll:c,children:i,maxLines:s,style:o},m,v,r,n)}return UD(i)},$D="#808080",cx=function(e){var r=e.x,n=r===void 0?0:r,i=e.y,o=i===void 0?0:i,c=e.lineHeight,s=c===void 0?"1em":c,m=e.capHeight,v=m===void 0?"0.71em":m,w=e.scaleToFit,M=w===void 0?!1:w,I=e.textAnchor,k=I===void 0?"start":I,z=e.verticalAnchor,V=z===void 0?"end":z,U=e.fill,K=U===void 0?$D:U,J=FD(e,qte),Z=it.useMemo(function(){return Qte({breakAll:J.breakAll,children:J.children,maxLines:J.maxLines,scaleToFit:M,style:J.style,width:J.width})},[J.breakAll,J.children,J.maxLines,M,J.style,J.width]),re=J.dx,W=J.dy,Y=J.angle,ue=J.className,be=J.breakAll,Ce=FD(J,Hte);if(!Da(n)||!Da(o))return null;var Ye=n+(nr(re)?re:0),Me=o+(nr(W)?W:0),Ue;switch(V){case"start":Ue=XS("calc(".concat(v,")"));break;case"middle":Ue=XS("calc(".concat((Z.length-1)/2," * -").concat(s," + (").concat(v," / 2))"));break;default:Ue=XS("calc(".concat(Z.length-1," * -").concat(s,")"));break}var Qe=[];if(M){var Ze=Z[0].width,ct=J.width;Qe.push("scale(".concat((nr(ct)?ct/Ze:1)/Ze,")"))}return Y&&Qe.push("rotate(".concat(Y,", ").concat(Ye,", ").concat(Me,")")),Qe.length&&(Ce.transform=Qe.join(" ")),He.createElement("text",YE({},an(Ce,!0),{x:Ye,y:Me,className:pn("recharts-text",ue),textAnchor:k,fill:K.includes("url")?$D:K}),Z.map(function(Ie,et){var ot=Ie.words.join(be?"":" ");return He.createElement("tspan",{x:Ye,dy:et===0?Ue:s,key:"".concat(ot,"-").concat(et)},ot)}))};function gd(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Jte(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function YP(t){let e,r,n;t.length!==2?(e=gd,r=(s,m)=>gd(t(s),m),n=(s,m)=>t(s)-m):(e=t===gd||t===Jte?t:ere,r=t,n=t);function i(s,m,v=0,w=s.length){if(v<w){if(e(m,m)!==0)return w;do{const M=v+w>>>1;r(s[M],m)<0?v=M+1:w=M}while(v<w)}return v}function o(s,m,v=0,w=s.length){if(v<w){if(e(m,m)!==0)return w;do{const M=v+w>>>1;r(s[M],m)<=0?v=M+1:w=M}while(v<w)}return v}function c(s,m,v=0,w=s.length){const M=i(s,m,v,w-1);return M>v&&n(s[M-1],m)>-n(s[M],m)?M-1:M}return{left:i,center:c,right:o}}function ere(){return 0}function vz(t){return t===null?NaN:+t}function*tre(t,e){for(let r of t)r!=null&&(r=+r)>=r&&(yield r)}const rre=YP(gd),Xv=rre.right;YP(vz).center;class VD extends Map{constructor(e,r=are){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),e!=null)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(qD(this,e))}has(e){return super.has(qD(this,e))}set(e,r){return super.set(nre(this,e),r)}delete(e){return super.delete(ire(this,e))}}function qD({_intern:t,_key:e},r){const n=e(r);return t.has(n)?t.get(n):r}function nre({_intern:t,_key:e},r){const n=e(r);return t.has(n)?t.get(n):(t.set(n,r),r)}function ire({_intern:t,_key:e},r){const n=e(r);return t.has(n)&&(r=t.get(n),t.delete(n)),r}function are(t){return t!==null&&typeof t=="object"?t.valueOf():t}function sre(t=gd){if(t===gd)return bz;if(typeof t!="function")throw new TypeError("compare is not a function");return(e,r)=>{const n=t(e,r);return n||n===0?n:(t(r,r)===0)-(t(e,e)===0)}}function bz(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const ore=Math.sqrt(50),lre=Math.sqrt(10),cre=Math.sqrt(2);function ux(t,e,r){const n=(e-t)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),c=o>=ore?10:o>=lre?5:o>=cre?2:1;let s,m,v;return i<0?(v=Math.pow(10,-i)/c,s=Math.round(t*v),m=Math.round(e*v),s/v<t&&++s,m/v>e&&--m,v=-v):(v=Math.pow(10,i)*c,s=Math.round(t/v),m=Math.round(e/v),s*v<t&&++s,m*v>e&&--m),m<s&&.5<=r&&r<2?ux(t,e,r*2):[s,m,v]}function KE(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];const n=e<t,[i,o,c]=n?ux(e,t,r):ux(t,e,r);if(!(o>=i))return[];const s=o-i+1,m=new Array(s);if(n)if(c<0)for(let v=0;v<s;++v)m[v]=(o-v)/-c;else for(let v=0;v<s;++v)m[v]=(o-v)*c;else if(c<0)for(let v=0;v<s;++v)m[v]=(i+v)/-c;else for(let v=0;v<s;++v)m[v]=(i+v)*c;return m}function QE(t,e,r){return e=+e,t=+t,r=+r,ux(t,e,r)[2]}function JE(t,e,r){e=+e,t=+t,r=+r;const n=e<t,i=n?QE(e,t,r):QE(t,e,r);return(n?-1:1)*(i<0?1/-i:i)}function HD(t,e){let r;for(const n of t)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function WD(t,e){let r;for(const n of t)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function xz(t,e,r=0,n=1/0,i){if(e=Math.floor(e),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(t.length-1,n)),!(r<=e&&e<=n))return t;for(i=i===void 0?bz:sre(i);n>r;){if(n-r>600){const m=n-r+1,v=e-r+1,w=Math.log(m),M=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*M*(m-M)/m)*(v-m/2<0?-1:1),k=Math.max(r,Math.floor(e-v*M/m+I)),z=Math.min(n,Math.floor(e+(m-v)*M/m+I));xz(t,e,k,z,i)}const o=t[e];let c=r,s=n;for(by(t,r,e),i(t[n],o)>0&&by(t,r,n);c<s;){for(by(t,c,s),++c,--s;i(t[c],o)<0;)++c;for(;i(t[s],o)>0;)--s}i(t[r],o)===0?by(t,r,s):(++s,by(t,s,n)),s<=e&&(r=s+1),e<=s&&(n=s-1)}return t}function by(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function ure(t,e,r){if(t=Float64Array.from(tre(t)),!(!(n=t.length)||isNaN(e=+e))){if(e<=0||n<2)return WD(t);if(e>=1)return HD(t);var n,i=(n-1)*e,o=Math.floor(i),c=HD(xz(t,o).subarray(0,o+1)),s=WD(t.subarray(o+1));return c+(s-c)*(i-o)}}function hre(t,e,r=vz){if(!(!(n=t.length)||isNaN(e=+e))){if(e<=0||n<2)return+r(t[0],0,t);if(e>=1)return+r(t[n-1],n-1,t);var n,i=(n-1)*e,o=Math.floor(i),c=+r(t[o],o,t),s=+r(t[o+1],o+1,t);return c+(s-c)*(i-o)}}function fre(t,e,r){t=+t,e=+e,r=(i=arguments.length)<2?(e=t,t=0,1):i<3?1:+r;for(var n=-1,i=Math.max(0,Math.ceil((e-t)/r))|0,o=new Array(i);++n<i;)o[n]=t+n*r;return o}function Gl(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Jh(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}const eM=Symbol("implicit");function KP(){var t=new VD,e=[],r=[],n=eM;function i(o){let c=t.get(o);if(c===void 0){if(n!==eM)return n;t.set(o,c=e.push(o)-1)}return r[c%r.length]}return i.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new VD;for(const c of o)t.has(c)||t.set(c,e.push(c)-1);return i},i.range=function(o){return arguments.length?(r=Array.from(o),i):r.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return KP(e,r).unknown(n)},Gl.apply(i,arguments),i}function lv(){var t=KP().unknown(void 0),e=t.domain,r=t.range,n=0,i=1,o,c,s=!1,m=0,v=0,w=.5;delete t.unknown;function M(){var I=e().length,k=i<n,z=k?i:n,V=k?n:i;o=(V-z)/Math.max(1,I-m+v*2),s&&(o=Math.floor(o)),z+=(V-z-o*(I-m))*w,c=o*(1-m),s&&(z=Math.round(z),c=Math.round(c));var U=fre(I).map(function(K){return z+o*K});return r(k?U.reverse():U)}return t.domain=function(I){return arguments.length?(e(I),M()):e()},t.range=function(I){return arguments.length?([n,i]=I,n=+n,i=+i,M()):[n,i]},t.rangeRound=function(I){return[n,i]=I,n=+n,i=+i,s=!0,M()},t.bandwidth=function(){return c},t.step=function(){return o},t.round=function(I){return arguments.length?(s=!!I,M()):s},t.padding=function(I){return arguments.length?(m=Math.min(1,v=+I),M()):m},t.paddingInner=function(I){return arguments.length?(m=Math.min(1,I),M()):m},t.paddingOuter=function(I){return arguments.length?(v=+I,M()):v},t.align=function(I){return arguments.length?(w=Math.max(0,Math.min(1,I)),M()):w},t.copy=function(){return lv(e(),[n,i]).round(s).paddingInner(m).paddingOuter(v).align(w)},Gl.apply(M(),arguments)}function wz(t){var e=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return wz(e())},t}function qy(){return wz(lv.apply(null,arguments).paddingInner(1))}function QP(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Tz(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function Gv(){}var cv=.7,hx=1/cv,Og="\\s*([+-]?\\d+)\\s*",uv="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ru="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dre=/^#([0-9a-f]{3,8})$/,pre=new RegExp(`^rgb\\(${Og},${Og},${Og}\\)$`),mre=new RegExp(`^rgb\\(${Ru},${Ru},${Ru}\\)$`),gre=new RegExp(`^rgba\\(${Og},${Og},${Og},${uv}\\)$`),_re=new RegExp(`^rgba\\(${Ru},${Ru},${Ru},${uv}\\)$`),yre=new RegExp(`^hsl\\(${uv},${Ru},${Ru}\\)$`),vre=new RegExp(`^hsla\\(${uv},${Ru},${Ru},${uv}\\)$`),ZD={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};QP(Gv,hv,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:XD,formatHex:XD,formatHex8:bre,formatHsl:xre,formatRgb:GD,toString:GD});function XD(){return this.rgb().formatHex()}function bre(){return this.rgb().formatHex8()}function xre(){return Sz(this).formatHsl()}function GD(){return this.rgb().formatRgb()}function hv(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=dre.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?YD(e):r===3?new mo(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?s0(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?s0(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=pre.exec(t))?new mo(e[1],e[2],e[3],1):(e=mre.exec(t))?new mo(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=gre.exec(t))?s0(e[1],e[2],e[3],e[4]):(e=_re.exec(t))?s0(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=yre.exec(t))?JD(e[1],e[2]/100,e[3]/100,1):(e=vre.exec(t))?JD(e[1],e[2]/100,e[3]/100,e[4]):ZD.hasOwnProperty(t)?YD(ZD[t]):t==="transparent"?new mo(NaN,NaN,NaN,0):null}function YD(t){return new mo(t>>16&255,t>>8&255,t&255,1)}function s0(t,e,r,n){return n<=0&&(t=e=r=NaN),new mo(t,e,r,n)}function wre(t){return t instanceof Gv||(t=hv(t)),t?(t=t.rgb(),new mo(t.r,t.g,t.b,t.opacity)):new mo}function tM(t,e,r,n){return arguments.length===1?wre(t):new mo(t,e,r,n??1)}function mo(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}QP(mo,tM,Tz(Gv,{brighter(t){return t=t==null?hx:Math.pow(hx,t),new mo(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?cv:Math.pow(cv,t),new mo(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new mo(Vp(this.r),Vp(this.g),Vp(this.b),fx(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:KD,formatHex:KD,formatHex8:Tre,formatRgb:QD,toString:QD}));function KD(){return`#${Np(this.r)}${Np(this.g)}${Np(this.b)}`}function Tre(){return`#${Np(this.r)}${Np(this.g)}${Np(this.b)}${Np((isNaN(this.opacity)?1:this.opacity)*255)}`}function QD(){const t=fx(this.opacity);return`${t===1?"rgb(":"rgba("}${Vp(this.r)}, ${Vp(this.g)}, ${Vp(this.b)}${t===1?")":`, ${t})`}`}function fx(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Vp(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Np(t){return t=Vp(t),(t<16?"0":"")+t.toString(16)}function JD(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new $c(t,e,r,n)}function Sz(t){if(t instanceof $c)return new $c(t.h,t.s,t.l,t.opacity);if(t instanceof Gv||(t=hv(t)),!t)return new $c;if(t instanceof $c)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(e,r,n),o=Math.max(e,r,n),c=NaN,s=o-i,m=(o+i)/2;return s?(e===o?c=(r-n)/s+(r<n)*6:r===o?c=(n-e)/s+2:c=(e-r)/s+4,s/=m<.5?o+i:2-o-i,c*=60):s=m>0&&m<1?0:c,new $c(c,s,m,t.opacity)}function Sre(t,e,r,n){return arguments.length===1?Sz(t):new $c(t,e,r,n??1)}function $c(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}QP($c,Sre,Tz(Gv,{brighter(t){return t=t==null?hx:Math.pow(hx,t),new $c(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?cv:Math.pow(cv,t),new $c(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,i=2*r-n;return new mo(GS(t>=240?t-240:t+120,i,n),GS(t,i,n),GS(t<120?t+240:t-120,i,n),this.opacity)},clamp(){return new $c(e4(this.h),o0(this.s),o0(this.l),fx(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=fx(this.opacity);return`${t===1?"hsl(":"hsla("}${e4(this.h)}, ${o0(this.s)*100}%, ${o0(this.l)*100}%${t===1?")":`, ${t})`}`}}));function e4(t){return t=(t||0)%360,t<0?t+360:t}function o0(t){return Math.max(0,Math.min(1,t||0))}function GS(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const JP=t=>()=>t;function Are(t,e){return function(r){return t+r*e}}function Ere(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function Mre(t){return(t=+t)==1?Az:function(e,r){return r-e?Ere(e,r,t):JP(isNaN(e)?r:e)}}function Az(t,e){var r=e-t;return r?Are(t,r):JP(isNaN(t)?e:t)}const t4=function t(e){var r=Mre(e);function n(i,o){var c=r((i=tM(i)).r,(o=tM(o)).r),s=r(i.g,o.g),m=r(i.b,o.b),v=Az(i.opacity,o.opacity);return function(w){return i.r=c(w),i.g=s(w),i.b=m(w),i.opacity=v(w),i+""}}return n.gamma=t,n}(1);function Pre(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=t[i]*(1-o)+e[i]*o;return n}}function Cre(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Rre(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,i=new Array(n),o=new Array(r),c;for(c=0;c<n;++c)i[c]=__(t[c],e[c]);for(;c<r;++c)o[c]=e[c];return function(s){for(c=0;c<n;++c)o[c]=i[c](s);return o}}function Ire(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function dx(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function Ore(t,e){var r={},n={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?r[i]=__(t[i],e[i]):n[i]=e[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var rM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,YS=new RegExp(rM.source,"g");function kre(t){return function(){return t}}function Dre(t){return function(e){return t(e)+""}}function Nre(t,e){var r=rM.lastIndex=YS.lastIndex=0,n,i,o,c=-1,s=[],m=[];for(t=t+"",e=e+"";(n=rM.exec(t))&&(i=YS.exec(e));)(o=i.index)>r&&(o=e.slice(r,o),s[c]?s[c]+=o:s[++c]=o),(n=n[0])===(i=i[0])?s[c]?s[c]+=i:s[++c]=i:(s[++c]=null,m.push({i:c,x:dx(n,i)})),r=YS.lastIndex;return r<e.length&&(o=e.slice(r),s[c]?s[c]+=o:s[++c]=o),s.length<2?m[0]?Dre(m[0].x):kre(e):(e=m.length,function(v){for(var w=0,M;w<e;++w)s[(M=m[w]).i]=M.x(v);return s.join("")})}function __(t,e){var r=typeof e,n;return e==null||r==="boolean"?JP(e):(r==="number"?dx:r==="string"?(n=hv(e))?(e=n,t4):Nre:e instanceof hv?t4:e instanceof Date?Ire:Cre(e)?Pre:Array.isArray(e)?Rre:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Ore:dx)(t,e)}function e3(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function Bre(t,e){e===void 0&&(e=t,t=__);for(var r=0,n=e.length-1,i=e[0],o=new Array(n<0?0:n);r<n;)o[r]=t(i,i=e[++r]);return function(c){var s=Math.max(0,Math.min(n-1,Math.floor(c*=n)));return o[s](c-s)}}function Lre(t){return function(){return t}}function px(t){return+t}var r4=[0,1];function Gs(t){return t}function nM(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:Lre(isNaN(e)?NaN:.5)}function Fre(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function zre(t,e,r){var n=t[0],i=t[1],o=e[0],c=e[1];return i<n?(n=nM(i,n),o=r(c,o)):(n=nM(n,i),o=r(o,c)),function(s){return o(n(s))}}function jre(t,e,r){var n=Math.min(t.length,e.length)-1,i=new Array(n),o=new Array(n),c=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++c<n;)i[c]=nM(t[c],t[c+1]),o[c]=r(e[c],e[c+1]);return function(s){var m=Xv(t,s,1,n)-1;return o[m](i[m](s))}}function Yv(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function C1(){var t=r4,e=r4,r=__,n,i,o,c=Gs,s,m,v;function w(){var I=Math.min(t.length,e.length);return c!==Gs&&(c=Fre(t[0],t[I-1])),s=I>2?jre:zre,m=v=null,M}function M(I){return I==null||isNaN(I=+I)?o:(m||(m=s(t.map(n),e,r)))(n(c(I)))}return M.invert=function(I){return c(i((v||(v=s(e,t.map(n),dx)))(I)))},M.domain=function(I){return arguments.length?(t=Array.from(I,px),w()):t.slice()},M.range=function(I){return arguments.length?(e=Array.from(I),w()):e.slice()},M.rangeRound=function(I){return e=Array.from(I),r=e3,w()},M.clamp=function(I){return arguments.length?(c=I?!0:Gs,w()):c!==Gs},M.interpolate=function(I){return arguments.length?(r=I,w()):r},M.unknown=function(I){return arguments.length?(o=I,M):o},function(I,k){return n=I,i=k,w()}}function t3(){return C1()(Gs,Gs)}function Ure(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function mx(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function Yg(t){return t=mx(Math.abs(t)),t?t[1]:NaN}function $re(t,e){return function(r,n){for(var i=r.length,o=[],c=0,s=t[0],m=0;i>0&&s>0&&(m+s+1>n&&(s=Math.max(1,n-m)),o.push(r.substring(i-=s,i+s)),!((m+=s+1)>n));)s=t[c=(c+1)%t.length];return o.reverse().join(e)}}function Vre(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var qre=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function fv(t){if(!(e=qre.exec(t)))throw new Error("invalid format: "+t);var e;return new r3({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}fv.prototype=r3.prototype;function r3(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}r3.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Hre(t){e:for(var e=t.length,r=1,n=-1,i;r<e;++r)switch(t[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(i+1):t}var Ez;function Wre(t,e){var r=mx(t,e);if(!r)return t+"";var n=r[0],i=r[1],o=i-(Ez=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,c=n.length;return o===c?n:o>c?n+new Array(o-c+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+mx(t,Math.max(0,e+o-1))[0]}function n4(t,e){var r=mx(t,e);if(!r)return t+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const i4={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Ure,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>n4(t*100,e),r:n4,s:Wre,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function a4(t){return t}var s4=Array.prototype.map,o4=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Zre(t){var e=t.grouping===void 0||t.thousands===void 0?a4:$re(s4.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?a4:Vre(s4.call(t.numerals,String)),c=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",m=t.nan===void 0?"NaN":t.nan+"";function v(M){M=fv(M);var I=M.fill,k=M.align,z=M.sign,V=M.symbol,U=M.zero,K=M.width,J=M.comma,Z=M.precision,re=M.trim,W=M.type;W==="n"?(J=!0,W="g"):i4[W]||(Z===void 0&&(Z=12),re=!0,W="g"),(U||I==="0"&&k==="=")&&(U=!0,I="0",k="=");var Y=V==="$"?r:V==="#"&&/[boxX]/.test(W)?"0"+W.toLowerCase():"",ue=V==="$"?n:/[%p]/.test(W)?c:"",be=i4[W],Ce=/[defgprs%]/.test(W);Z=Z===void 0?6:/[gprs]/.test(W)?Math.max(1,Math.min(21,Z)):Math.max(0,Math.min(20,Z));function Ye(Me){var Ue=Y,Qe=ue,Ze,ct,Ie;if(W==="c")Qe=be(Me)+Qe,Me="";else{Me=+Me;var et=Me<0||1/Me<0;if(Me=isNaN(Me)?m:be(Math.abs(Me),Z),re&&(Me=Hre(Me)),et&&+Me==0&&z!=="+"&&(et=!1),Ue=(et?z==="("?z:s:z==="-"||z==="("?"":z)+Ue,Qe=(W==="s"?o4[8+Ez/3]:"")+Qe+(et&&z==="("?")":""),Ce){for(Ze=-1,ct=Me.length;++Ze<ct;)if(Ie=Me.charCodeAt(Ze),48>Ie||Ie>57){Qe=(Ie===46?i+Me.slice(Ze+1):Me.slice(Ze))+Qe,Me=Me.slice(0,Ze);break}}}J&&!U&&(Me=e(Me,1/0));var ot=Ue.length+Me.length+Qe.length,Bt=ot<K?new Array(K-ot+1).join(I):"";switch(J&&U&&(Me=e(Bt+Me,Bt.length?K-Qe.length:1/0),Bt=""),k){case"<":Me=Ue+Me+Qe+Bt;break;case"=":Me=Ue+Bt+Me+Qe;break;case"^":Me=Bt.slice(0,ot=Bt.length>>1)+Ue+Me+Qe+Bt.slice(ot);break;default:Me=Bt+Ue+Me+Qe;break}return o(Me)}return Ye.toString=function(){return M+""},Ye}function w(M,I){var k=v((M=fv(M),M.type="f",M)),z=Math.max(-8,Math.min(8,Math.floor(Yg(I)/3)))*3,V=Math.pow(10,-z),U=o4[8+z/3];return function(K){return k(V*K)+U}}return{format:v,formatPrefix:w}}var l0,n3,Mz;Xre({thousands:",",grouping:[3],currency:["$",""]});function Xre(t){return l0=Zre(t),n3=l0.format,Mz=l0.formatPrefix,l0}function Gre(t){return Math.max(0,-Yg(Math.abs(t)))}function Yre(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Yg(e)/3)))*3-Yg(Math.abs(t)))}function Kre(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Yg(e)-Yg(t))+1}function Pz(t,e,r,n){var i=JE(t,e,r),o;switch(n=fv(n??",f"),n.type){case"s":{var c=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(o=Yre(i,c))&&(n.precision=o),Mz(n,c)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=Kre(i,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=Gre(i))&&(n.precision=o-(n.type==="%")*2);break}}return n3(n)}function xd(t){var e=t.domain;return t.ticks=function(r){var n=e();return KE(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var i=e();return Pz(i[0],i[i.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),i=0,o=n.length-1,c=n[i],s=n[o],m,v,w=10;for(s<c&&(v=c,c=s,s=v,v=i,i=o,o=v);w-- >0;){if(v=QE(c,s,r),v===m)return n[i]=c,n[o]=s,e(n);if(v>0)c=Math.floor(c/v)*v,s=Math.ceil(s/v)*v;else if(v<0)c=Math.ceil(c*v)/v,s=Math.floor(s*v)/v;else break;m=v}return t},t}function gx(){var t=t3();return t.copy=function(){return Yv(t,gx())},Gl.apply(t,arguments),xd(t)}function Cz(t){var e;function r(n){return n==null||isNaN(n=+n)?e:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(t=Array.from(n,px),r):t.slice()},r.unknown=function(n){return arguments.length?(e=n,r):e},r.copy=function(){return Cz(t).unknown(e)},t=arguments.length?Array.from(t,px):[0,1],xd(r)}function Rz(t,e){t=t.slice();var r=0,n=t.length-1,i=t[r],o=t[n],c;return o<i&&(c=r,r=n,n=c,c=i,i=o,o=c),t[r]=e.floor(i),t[n]=e.ceil(o),t}function l4(t){return Math.log(t)}function c4(t){return Math.exp(t)}function Qre(t){return-Math.log(-t)}function Jre(t){return-Math.exp(-t)}function ene(t){return isFinite(t)?+("1e"+t):t<0?0:t}function tne(t){return t===10?ene:t===Math.E?Math.exp:e=>Math.pow(t,e)}function rne(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function u4(t){return(e,r)=>-t(-e,r)}function i3(t){const e=t(l4,c4),r=e.domain;let n=10,i,o;function c(){return i=rne(n),o=tne(n),r()[0]<0?(i=u4(i),o=u4(o),t(Qre,Jre)):t(l4,c4),e}return e.base=function(s){return arguments.length?(n=+s,c()):n},e.domain=function(s){return arguments.length?(r(s),c()):r()},e.ticks=s=>{const m=r();let v=m[0],w=m[m.length-1];const M=w<v;M&&([v,w]=[w,v]);let I=i(v),k=i(w),z,V;const U=s==null?10:+s;let K=[];if(!(n%1)&&k-I<U){if(I=Math.floor(I),k=Math.ceil(k),v>0){for(;I<=k;++I)for(z=1;z<n;++z)if(V=I<0?z/o(-I):z*o(I),!(V<v)){if(V>w)break;K.push(V)}}else for(;I<=k;++I)for(z=n-1;z>=1;--z)if(V=I>0?z/o(-I):z*o(I),!(V<v)){if(V>w)break;K.push(V)}K.length*2<U&&(K=KE(v,w,U))}else K=KE(I,k,Math.min(k-I,U)).map(o);return M?K.reverse():K},e.tickFormat=(s,m)=>{if(s==null&&(s=10),m==null&&(m=n===10?"s":","),typeof m!="function"&&(!(n%1)&&(m=fv(m)).precision==null&&(m.trim=!0),m=n3(m)),s===1/0)return m;const v=Math.max(1,n*s/e.ticks().length);return w=>{let M=w/o(Math.round(i(w)));return M*n<n-.5&&(M*=n),M<=v?m(w):""}},e.nice=()=>r(Rz(r(),{floor:s=>o(Math.floor(i(s))),ceil:s=>o(Math.ceil(i(s)))})),e}function Iz(){const t=i3(C1()).domain([1,10]);return t.copy=()=>Yv(t,Iz()).base(t.base()),Gl.apply(t,arguments),t}function h4(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function f4(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function a3(t){var e=1,r=t(h4(e),f4(e));return r.constant=function(n){return arguments.length?t(h4(e=+n),f4(e)):e},xd(r)}function Oz(){var t=a3(C1());return t.copy=function(){return Yv(t,Oz()).constant(t.constant())},Gl.apply(t,arguments)}function d4(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function nne(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function ine(t){return t<0?-t*t:t*t}function s3(t){var e=t(Gs,Gs),r=1;function n(){return r===1?t(Gs,Gs):r===.5?t(nne,ine):t(d4(r),d4(1/r))}return e.exponent=function(i){return arguments.length?(r=+i,n()):r},xd(e)}function o3(){var t=s3(C1());return t.copy=function(){return Yv(t,o3()).exponent(t.exponent())},Gl.apply(t,arguments),t}function ane(){return o3.apply(null,arguments).exponent(.5)}function p4(t){return Math.sign(t)*t*t}function sne(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function kz(){var t=t3(),e=[0,1],r=!1,n;function i(o){var c=sne(t(o));return isNaN(c)?n:r?Math.round(c):c}return i.invert=function(o){return t.invert(p4(o))},i.domain=function(o){return arguments.length?(t.domain(o),i):t.domain()},i.range=function(o){return arguments.length?(t.range((e=Array.from(o,px)).map(p4)),i):e.slice()},i.rangeRound=function(o){return i.range(o).round(!0)},i.round=function(o){return arguments.length?(r=!!o,i):r},i.clamp=function(o){return arguments.length?(t.clamp(o),i):t.clamp()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return kz(t.domain(),e).round(r).clamp(t.clamp()).unknown(n)},Gl.apply(i,arguments),xd(i)}function Dz(){var t=[],e=[],r=[],n;function i(){var c=0,s=Math.max(1,e.length);for(r=new Array(s-1);++c<s;)r[c-1]=hre(t,c/s);return o}function o(c){return c==null||isNaN(c=+c)?n:e[Xv(r,c)]}return o.invertExtent=function(c){var s=e.indexOf(c);return s<0?[NaN,NaN]:[s>0?r[s-1]:t[0],s<r.length?r[s]:t[t.length-1]]},o.domain=function(c){if(!arguments.length)return t.slice();t=[];for(let s of c)s!=null&&!isNaN(s=+s)&&t.push(s);return t.sort(gd),i()},o.range=function(c){return arguments.length?(e=Array.from(c),i()):e.slice()},o.unknown=function(c){return arguments.length?(n=c,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Dz().domain(t).range(e).unknown(n)},Gl.apply(o,arguments)}function Nz(){var t=0,e=1,r=1,n=[.5],i=[0,1],o;function c(m){return m!=null&&m<=m?i[Xv(n,m,0,r)]:o}function s(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*e-(m-r)*t)/(r+1);return c}return c.domain=function(m){return arguments.length?([t,e]=m,t=+t,e=+e,s()):[t,e]},c.range=function(m){return arguments.length?(r=(i=Array.from(m)).length-1,s()):i.slice()},c.invertExtent=function(m){var v=i.indexOf(m);return v<0?[NaN,NaN]:v<1?[t,n[0]]:v>=r?[n[r-1],e]:[n[v-1],n[v]]},c.unknown=function(m){return arguments.length&&(o=m),c},c.thresholds=function(){return n.slice()},c.copy=function(){return Nz().domain([t,e]).range(i).unknown(o)},Gl.apply(xd(c),arguments)}function Bz(){var t=[.5],e=[0,1],r,n=1;function i(o){return o!=null&&o<=o?e[Xv(t,o,0,n)]:r}return i.domain=function(o){return arguments.length?(t=Array.from(o),n=Math.min(t.length,e.length-1),i):t.slice()},i.range=function(o){return arguments.length?(e=Array.from(o),n=Math.min(t.length,e.length-1),i):e.slice()},i.invertExtent=function(o){var c=e.indexOf(o);return[t[c-1],t[c]]},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Bz().domain(t).range(e).unknown(r)},Gl.apply(i,arguments)}const KS=new Date,QS=new Date;function Na(t,e,r,n){function i(o){return t(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=o=>(t(o=new Date(+o)),o),i.ceil=o=>(t(o=new Date(o-1)),e(o,1),t(o),o),i.round=o=>{const c=i(o),s=i.ceil(o);return o-c<s-o?c:s},i.offset=(o,c)=>(e(o=new Date(+o),c==null?1:Math.floor(c)),o),i.range=(o,c,s)=>{const m=[];if(o=i.ceil(o),s=s==null?1:Math.floor(s),!(o<c)||!(s>0))return m;let v;do m.push(v=new Date(+o)),e(o,s),t(o);while(v<o&&o<c);return m},i.filter=o=>Na(c=>{if(c>=c)for(;t(c),!o(c);)c.setTime(c-1)},(c,s)=>{if(c>=c)if(s<0)for(;++s<=0;)for(;e(c,-1),!o(c););else for(;--s>=0;)for(;e(c,1),!o(c););}),r&&(i.count=(o,c)=>(KS.setTime(+o),QS.setTime(+c),t(KS),t(QS),Math.floor(r(KS,QS))),i.every=o=>(o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?c=>n(c)%o===0:c=>i.count(0,c)%o===0):i)),i}const _x=Na(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);_x.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Na(e=>{e.setTime(Math.floor(e/t)*t)},(e,r)=>{e.setTime(+e+r*t)},(e,r)=>(r-e)/t):_x);_x.range;const zh=1e3,jl=zh*60,jh=jl*60,Wh=jh*24,l3=Wh*7,m4=Wh*30,JS=Wh*365,Bp=Na(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*zh)},(t,e)=>(e-t)/zh,t=>t.getUTCSeconds());Bp.range;const c3=Na(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*zh)},(t,e)=>{t.setTime(+t+e*jl)},(t,e)=>(e-t)/jl,t=>t.getMinutes());c3.range;const u3=Na(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*jl)},(t,e)=>(e-t)/jl,t=>t.getUTCMinutes());u3.range;const h3=Na(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*zh-t.getMinutes()*jl)},(t,e)=>{t.setTime(+t+e*jh)},(t,e)=>(e-t)/jh,t=>t.getHours());h3.range;const f3=Na(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*jh)},(t,e)=>(e-t)/jh,t=>t.getUTCHours());f3.range;const Kv=Na(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*jl)/Wh,t=>t.getDate()-1);Kv.range;const R1=Na(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Wh,t=>t.getUTCDate()-1);R1.range;const Lz=Na(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Wh,t=>Math.floor(t/Wh));Lz.range;function am(t){return Na(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,r)=>{e.setDate(e.getDate()+r*7)},(e,r)=>(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*jl)/l3)}const I1=am(0),yx=am(1),one=am(2),lne=am(3),Kg=am(4),cne=am(5),une=am(6);I1.range;yx.range;one.range;lne.range;Kg.range;cne.range;une.range;function sm(t){return Na(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCDate(e.getUTCDate()+r*7)},(e,r)=>(r-e)/l3)}const O1=sm(0),vx=sm(1),hne=sm(2),fne=sm(3),Qg=sm(4),dne=sm(5),pne=sm(6);O1.range;vx.range;hne.range;fne.range;Qg.range;dne.range;pne.range;const d3=Na(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());d3.range;const p3=Na(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());p3.range;const Zh=Na(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());Zh.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Na(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,r)=>{e.setFullYear(e.getFullYear()+r*t)});Zh.range;const Xh=Na(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());Xh.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Na(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,r)=>{e.setUTCFullYear(e.getUTCFullYear()+r*t)});Xh.range;function Fz(t,e,r,n,i,o){const c=[[Bp,1,zh],[Bp,5,5*zh],[Bp,15,15*zh],[Bp,30,30*zh],[o,1,jl],[o,5,5*jl],[o,15,15*jl],[o,30,30*jl],[i,1,jh],[i,3,3*jh],[i,6,6*jh],[i,12,12*jh],[n,1,Wh],[n,2,2*Wh],[r,1,l3],[e,1,m4],[e,3,3*m4],[t,1,JS]];function s(v,w,M){const I=w<v;I&&([v,w]=[w,v]);const k=M&&typeof M.range=="function"?M:m(v,w,M),z=k?k.range(v,+w+1):[];return I?z.reverse():z}function m(v,w,M){const I=Math.abs(w-v)/M,k=YP(([,,U])=>U).right(c,I);if(k===c.length)return t.every(JE(v/JS,w/JS,M));if(k===0)return _x.every(Math.max(JE(v,w,M),1));const[z,V]=c[I/c[k-1][2]<c[k][2]/I?k-1:k];return z.every(V)}return[s,m]}const[mne,gne]=Fz(Xh,p3,O1,Lz,f3,u3),[_ne,yne]=Fz(Zh,d3,I1,Kv,h3,c3);function eA(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function tA(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function xy(t,e,r){return{y:t,m:e,d:r,H:0,M:0,S:0,L:0}}function vne(t){var e=t.dateTime,r=t.date,n=t.time,i=t.periods,o=t.days,c=t.shortDays,s=t.months,m=t.shortMonths,v=wy(i),w=Ty(i),M=wy(o),I=Ty(o),k=wy(c),z=Ty(c),V=wy(s),U=Ty(s),K=wy(m),J=Ty(m),Z={a:et,A:ot,b:Bt,B:Te,c:null,d:x4,e:x4,f:$ne,g:Qne,G:eie,H:zne,I:jne,j:Une,L:zz,m:Vne,M:qne,p:ft,q:vt,Q:S4,s:A4,S:Hne,u:Wne,U:Zne,V:Xne,w:Gne,W:Yne,x:null,X:null,y:Kne,Y:Jne,Z:tie,"%":T4},re={a:Ct,A:Yt,b:Ge,B:Pt,c:null,d:w4,e:w4,f:aie,g:mie,G:_ie,H:rie,I:nie,j:iie,L:Uz,m:sie,M:oie,p:tr,q:Ft,Q:S4,s:A4,S:lie,u:cie,U:uie,V:hie,w:fie,W:die,x:null,X:null,y:pie,Y:gie,Z:yie,"%":T4},W={a:Ye,A:Me,b:Ue,B:Qe,c:Ze,d:v4,e:v4,f:Nne,g:y4,G:_4,H:b4,I:b4,j:Ine,L:Dne,m:Rne,M:One,p:Ce,q:Cne,Q:Lne,s:Fne,S:kne,u:Sne,U:Ane,V:Ene,w:Tne,W:Mne,x:ct,X:Ie,y:y4,Y:_4,Z:Pne,"%":Bne};Z.x=Y(r,Z),Z.X=Y(n,Z),Z.c=Y(e,Z),re.x=Y(r,re),re.X=Y(n,re),re.c=Y(e,re);function Y(zt,Gt){return function(Zt){var mt=[],hr=-1,Vt=0,ar=zt.length,rr,fr,En;for(Zt instanceof Date||(Zt=new Date(+Zt));++hr<ar;)zt.charCodeAt(hr)===37&&(mt.push(zt.slice(Vt,hr)),(fr=g4[rr=zt.charAt(++hr)])!=null?rr=zt.charAt(++hr):fr=rr==="e"?" ":"0",(En=Gt[rr])&&(rr=En(Zt,fr)),mt.push(rr),Vt=hr+1);return mt.push(zt.slice(Vt,hr)),mt.join("")}}function ue(zt,Gt){return function(Zt){var mt=xy(1900,void 0,1),hr=be(mt,zt,Zt+="",0),Vt,ar;if(hr!=Zt.length)return null;if("Q"in mt)return new Date(mt.Q);if("s"in mt)return new Date(mt.s*1e3+("L"in mt?mt.L:0));if(Gt&&!("Z"in mt)&&(mt.Z=0),"p"in mt&&(mt.H=mt.H%12+mt.p*12),mt.m===void 0&&(mt.m="q"in mt?mt.q:0),"V"in mt){if(mt.V<1||mt.V>53)return null;"w"in mt||(mt.w=1),"Z"in mt?(Vt=tA(xy(mt.y,0,1)),ar=Vt.getUTCDay(),Vt=ar>4||ar===0?vx.ceil(Vt):vx(Vt),Vt=R1.offset(Vt,(mt.V-1)*7),mt.y=Vt.getUTCFullYear(),mt.m=Vt.getUTCMonth(),mt.d=Vt.getUTCDate()+(mt.w+6)%7):(Vt=eA(xy(mt.y,0,1)),ar=Vt.getDay(),Vt=ar>4||ar===0?yx.ceil(Vt):yx(Vt),Vt=Kv.offset(Vt,(mt.V-1)*7),mt.y=Vt.getFullYear(),mt.m=Vt.getMonth(),mt.d=Vt.getDate()+(mt.w+6)%7)}else("W"in mt||"U"in mt)&&("w"in mt||(mt.w="u"in mt?mt.u%7:"W"in mt?1:0),ar="Z"in mt?tA(xy(mt.y,0,1)).getUTCDay():eA(xy(mt.y,0,1)).getDay(),mt.m=0,mt.d="W"in mt?(mt.w+6)%7+mt.W*7-(ar+5)%7:mt.w+mt.U*7-(ar+6)%7);return"Z"in mt?(mt.H+=mt.Z/100|0,mt.M+=mt.Z%100,tA(mt)):eA(mt)}}function be(zt,Gt,Zt,mt){for(var hr=0,Vt=Gt.length,ar=Zt.length,rr,fr;hr<Vt;){if(mt>=ar)return-1;if(rr=Gt.charCodeAt(hr++),rr===37){if(rr=Gt.charAt(hr++),fr=W[rr in g4?Gt.charAt(hr++):rr],!fr||(mt=fr(zt,Zt,mt))<0)return-1}else if(rr!=Zt.charCodeAt(mt++))return-1}return mt}function Ce(zt,Gt,Zt){var mt=v.exec(Gt.slice(Zt));return mt?(zt.p=w.get(mt[0].toLowerCase()),Zt+mt[0].length):-1}function Ye(zt,Gt,Zt){var mt=k.exec(Gt.slice(Zt));return mt?(zt.w=z.get(mt[0].toLowerCase()),Zt+mt[0].length):-1}function Me(zt,Gt,Zt){var mt=M.exec(Gt.slice(Zt));return mt?(zt.w=I.get(mt[0].toLowerCase()),Zt+mt[0].length):-1}function Ue(zt,Gt,Zt){var mt=K.exec(Gt.slice(Zt));return mt?(zt.m=J.get(mt[0].toLowerCase()),Zt+mt[0].length):-1}function Qe(zt,Gt,Zt){var mt=V.exec(Gt.slice(Zt));return mt?(zt.m=U.get(mt[0].toLowerCase()),Zt+mt[0].length):-1}function Ze(zt,Gt,Zt){return be(zt,e,Gt,Zt)}function ct(zt,Gt,Zt){return be(zt,r,Gt,Zt)}function Ie(zt,Gt,Zt){return be(zt,n,Gt,Zt)}function et(zt){return c[zt.getDay()]}function ot(zt){return o[zt.getDay()]}function Bt(zt){return m[zt.getMonth()]}function Te(zt){return s[zt.getMonth()]}function ft(zt){return i[+(zt.getHours()>=12)]}function vt(zt){return 1+~~(zt.getMonth()/3)}function Ct(zt){return c[zt.getUTCDay()]}function Yt(zt){return o[zt.getUTCDay()]}function Ge(zt){return m[zt.getUTCMonth()]}function Pt(zt){return s[zt.getUTCMonth()]}function tr(zt){return i[+(zt.getUTCHours()>=12)]}function Ft(zt){return 1+~~(zt.getUTCMonth()/3)}return{format:function(zt){var Gt=Y(zt+="",Z);return Gt.toString=function(){return zt},Gt},parse:function(zt){var Gt=ue(zt+="",!1);return Gt.toString=function(){return zt},Gt},utcFormat:function(zt){var Gt=Y(zt+="",re);return Gt.toString=function(){return zt},Gt},utcParse:function(zt){var Gt=ue(zt+="",!0);return Gt.toString=function(){return zt},Gt}}}var g4={"-":"",_:" ",0:"0"},es=/^\s*\d+/,bne=/^%/,xne=/[\\^$*+?|[\]().{}]/g;function mn(t,e,r){var n=t<0?"-":"",i=(n?-t:t)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(e)+i:i)}function wne(t){return t.replace(xne,"\\$&")}function wy(t){return new RegExp("^(?:"+t.map(wne).join("|")+")","i")}function Ty(t){return new Map(t.map((e,r)=>[e.toLowerCase(),r]))}function Tne(t,e,r){var n=es.exec(e.slice(r,r+1));return n?(t.w=+n[0],r+n[0].length):-1}function Sne(t,e,r){var n=es.exec(e.slice(r,r+1));return n?(t.u=+n[0],r+n[0].length):-1}function Ane(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.U=+n[0],r+n[0].length):-1}function Ene(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.V=+n[0],r+n[0].length):-1}function Mne(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.W=+n[0],r+n[0].length):-1}function _4(t,e,r){var n=es.exec(e.slice(r,r+4));return n?(t.y=+n[0],r+n[0].length):-1}function y4(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function Pne(t,e,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(r,r+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function Cne(t,e,r){var n=es.exec(e.slice(r,r+1));return n?(t.q=n[0]*3-3,r+n[0].length):-1}function Rne(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.m=n[0]-1,r+n[0].length):-1}function v4(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.d=+n[0],r+n[0].length):-1}function Ine(t,e,r){var n=es.exec(e.slice(r,r+3));return n?(t.m=0,t.d=+n[0],r+n[0].length):-1}function b4(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.H=+n[0],r+n[0].length):-1}function One(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.M=+n[0],r+n[0].length):-1}function kne(t,e,r){var n=es.exec(e.slice(r,r+2));return n?(t.S=+n[0],r+n[0].length):-1}function Dne(t,e,r){var n=es.exec(e.slice(r,r+3));return n?(t.L=+n[0],r+n[0].length):-1}function Nne(t,e,r){var n=es.exec(e.slice(r,r+6));return n?(t.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Bne(t,e,r){var n=bne.exec(e.slice(r,r+1));return n?r+n[0].length:-1}function Lne(t,e,r){var n=es.exec(e.slice(r));return n?(t.Q=+n[0],r+n[0].length):-1}function Fne(t,e,r){var n=es.exec(e.slice(r));return n?(t.s=+n[0],r+n[0].length):-1}function x4(t,e){return mn(t.getDate(),e,2)}function zne(t,e){return mn(t.getHours(),e,2)}function jne(t,e){return mn(t.getHours()%12||12,e,2)}function Une(t,e){return mn(1+Kv.count(Zh(t),t),e,3)}function zz(t,e){return mn(t.getMilliseconds(),e,3)}function $ne(t,e){return zz(t,e)+"000"}function Vne(t,e){return mn(t.getMonth()+1,e,2)}function qne(t,e){return mn(t.getMinutes(),e,2)}function Hne(t,e){return mn(t.getSeconds(),e,2)}function Wne(t){var e=t.getDay();return e===0?7:e}function Zne(t,e){return mn(I1.count(Zh(t)-1,t),e,2)}function jz(t){var e=t.getDay();return e>=4||e===0?Kg(t):Kg.ceil(t)}function Xne(t,e){return t=jz(t),mn(Kg.count(Zh(t),t)+(Zh(t).getDay()===4),e,2)}function Gne(t){return t.getDay()}function Yne(t,e){return mn(yx.count(Zh(t)-1,t),e,2)}function Kne(t,e){return mn(t.getFullYear()%100,e,2)}function Qne(t,e){return t=jz(t),mn(t.getFullYear()%100,e,2)}function Jne(t,e){return mn(t.getFullYear()%1e4,e,4)}function eie(t,e){var r=t.getDay();return t=r>=4||r===0?Kg(t):Kg.ceil(t),mn(t.getFullYear()%1e4,e,4)}function tie(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+mn(e/60|0,"0",2)+mn(e%60,"0",2)}function w4(t,e){return mn(t.getUTCDate(),e,2)}function rie(t,e){return mn(t.getUTCHours(),e,2)}function nie(t,e){return mn(t.getUTCHours()%12||12,e,2)}function iie(t,e){return mn(1+R1.count(Xh(t),t),e,3)}function Uz(t,e){return mn(t.getUTCMilliseconds(),e,3)}function aie(t,e){return Uz(t,e)+"000"}function sie(t,e){return mn(t.getUTCMonth()+1,e,2)}function oie(t,e){return mn(t.getUTCMinutes(),e,2)}function lie(t,e){return mn(t.getUTCSeconds(),e,2)}function cie(t){var e=t.getUTCDay();return e===0?7:e}function uie(t,e){return mn(O1.count(Xh(t)-1,t),e,2)}function $z(t){var e=t.getUTCDay();return e>=4||e===0?Qg(t):Qg.ceil(t)}function hie(t,e){return t=$z(t),mn(Qg.count(Xh(t),t)+(Xh(t).getUTCDay()===4),e,2)}function fie(t){return t.getUTCDay()}function die(t,e){return mn(vx.count(Xh(t)-1,t),e,2)}function pie(t,e){return mn(t.getUTCFullYear()%100,e,2)}function mie(t,e){return t=$z(t),mn(t.getUTCFullYear()%100,e,2)}function gie(t,e){return mn(t.getUTCFullYear()%1e4,e,4)}function _ie(t,e){var r=t.getUTCDay();return t=r>=4||r===0?Qg(t):Qg.ceil(t),mn(t.getUTCFullYear()%1e4,e,4)}function yie(){return"+0000"}function T4(){return"%"}function S4(t){return+t}function A4(t){return Math.floor(+t/1e3)}var gg,Vz,qz;vie({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function vie(t){return gg=vne(t),Vz=gg.format,gg.parse,qz=gg.utcFormat,gg.utcParse,gg}function bie(t){return new Date(t)}function xie(t){return t instanceof Date?+t:+new Date(+t)}function m3(t,e,r,n,i,o,c,s,m,v){var w=t3(),M=w.invert,I=w.domain,k=v(".%L"),z=v(":%S"),V=v("%I:%M"),U=v("%I %p"),K=v("%a %d"),J=v("%b %d"),Z=v("%B"),re=v("%Y");function W(Y){return(m(Y)<Y?k:s(Y)<Y?z:c(Y)<Y?V:o(Y)<Y?U:n(Y)<Y?i(Y)<Y?K:J:r(Y)<Y?Z:re)(Y)}return w.invert=function(Y){return new Date(M(Y))},w.domain=function(Y){return arguments.length?I(Array.from(Y,xie)):I().map(bie)},w.ticks=function(Y){var ue=I();return t(ue[0],ue[ue.length-1],Y??10)},w.tickFormat=function(Y,ue){return ue==null?W:v(ue)},w.nice=function(Y){var ue=I();return(!Y||typeof Y.range!="function")&&(Y=e(ue[0],ue[ue.length-1],Y??10)),Y?I(Rz(ue,Y)):w},w.copy=function(){return Yv(w,m3(t,e,r,n,i,o,c,s,m,v))},w}function wie(){return Gl.apply(m3(_ne,yne,Zh,d3,I1,Kv,h3,c3,Bp,Vz).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Tie(){return Gl.apply(m3(mne,gne,Xh,p3,O1,R1,f3,u3,Bp,qz).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function k1(){var t=0,e=1,r,n,i,o,c=Gs,s=!1,m;function v(M){return M==null||isNaN(M=+M)?m:c(i===0?.5:(M=(o(M)-r)*i,s?Math.max(0,Math.min(1,M)):M))}v.domain=function(M){return arguments.length?([t,e]=M,r=o(t=+t),n=o(e=+e),i=r===n?0:1/(n-r),v):[t,e]},v.clamp=function(M){return arguments.length?(s=!!M,v):s},v.interpolator=function(M){return arguments.length?(c=M,v):c};function w(M){return function(I){var k,z;return arguments.length?([k,z]=I,c=M(k,z),v):[c(0),c(1)]}}return v.range=w(__),v.rangeRound=w(e3),v.unknown=function(M){return arguments.length?(m=M,v):m},function(M){return o=M,r=M(t),n=M(e),i=r===n?0:1/(n-r),v}}function wd(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Hz(){var t=xd(k1()(Gs));return t.copy=function(){return wd(t,Hz())},Jh.apply(t,arguments)}function Wz(){var t=i3(k1()).domain([1,10]);return t.copy=function(){return wd(t,Wz()).base(t.base())},Jh.apply(t,arguments)}function Zz(){var t=a3(k1());return t.copy=function(){return wd(t,Zz()).constant(t.constant())},Jh.apply(t,arguments)}function g3(){var t=s3(k1());return t.copy=function(){return wd(t,g3()).exponent(t.exponent())},Jh.apply(t,arguments)}function Sie(){return g3.apply(null,arguments).exponent(.5)}function Xz(){var t=[],e=Gs;function r(n){if(n!=null&&!isNaN(n=+n))return e((Xv(t,n,1)-1)/(t.length-1))}return r.domain=function(n){if(!arguments.length)return t.slice();t=[];for(let i of n)i!=null&&!isNaN(i=+i)&&t.push(i);return t.sort(gd),r},r.interpolator=function(n){return arguments.length?(e=n,r):e},r.range=function(){return t.map((n,i)=>e(i/(t.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(i,o)=>ure(t,o/n))},r.copy=function(){return Xz(e).domain(t)},Jh.apply(r,arguments)}function D1(){var t=0,e=.5,r=1,n=1,i,o,c,s,m,v=Gs,w,M=!1,I;function k(V){return isNaN(V=+V)?I:(V=.5+((V=+w(V))-o)*(n*V<n*o?s:m),v(M?Math.max(0,Math.min(1,V)):V))}k.domain=function(V){return arguments.length?([t,e,r]=V,i=w(t=+t),o=w(e=+e),c=w(r=+r),s=i===o?0:.5/(o-i),m=o===c?0:.5/(c-o),n=o<i?-1:1,k):[t,e,r]},k.clamp=function(V){return arguments.length?(M=!!V,k):M},k.interpolator=function(V){return arguments.length?(v=V,k):v};function z(V){return function(U){var K,J,Z;return arguments.length?([K,J,Z]=U,v=Bre(V,[K,J,Z]),k):[v(0),v(.5),v(1)]}}return k.range=z(__),k.rangeRound=z(e3),k.unknown=function(V){return arguments.length?(I=V,k):I},function(V){return w=V,i=V(t),o=V(e),c=V(r),s=i===o?0:.5/(o-i),m=o===c?0:.5/(c-o),n=o<i?-1:1,k}}function Gz(){var t=xd(D1()(Gs));return t.copy=function(){return wd(t,Gz())},Jh.apply(t,arguments)}function Yz(){var t=i3(D1()).domain([.1,1,10]);return t.copy=function(){return wd(t,Yz()).base(t.base())},Jh.apply(t,arguments)}function Kz(){var t=a3(D1());return t.copy=function(){return wd(t,Kz()).constant(t.constant())},Jh.apply(t,arguments)}function _3(){var t=s3(D1());return t.copy=function(){return wd(t,_3()).exponent(t.exponent())},Jh.apply(t,arguments)}function Aie(){return _3.apply(null,arguments).exponent(.5)}const E4=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:lv,scaleDiverging:Gz,scaleDivergingLog:Yz,scaleDivergingPow:_3,scaleDivergingSqrt:Aie,scaleDivergingSymlog:Kz,scaleIdentity:Cz,scaleImplicit:eM,scaleLinear:gx,scaleLog:Iz,scaleOrdinal:KP,scalePoint:qy,scalePow:o3,scaleQuantile:Dz,scaleQuantize:Nz,scaleRadial:kz,scaleSequential:Hz,scaleSequentialLog:Wz,scaleSequentialPow:g3,scaleSequentialQuantile:Xz,scaleSequentialSqrt:Sie,scaleSequentialSymlog:Zz,scaleSqrt:ane,scaleSymlog:Oz,scaleThreshold:Bz,scaleTime:wie,scaleUtc:Tie,tickFormat:Pz},Symbol.toStringTag,{value:"Module"}));var rA,M4;function Qz(){if(M4)return rA;M4=1;var t=d_();function e(r,n,i){for(var o=-1,c=r.length;++o<c;){var s=r[o],m=n(s);if(m!=null&&(v===void 0?m===m&&!t(m):i(m,v)))var v=m,w=s}return w}return rA=e,rA}var nA,P4;function Eie(){if(P4)return nA;P4=1;function t(e,r){return e>r}return nA=t,nA}var iA,C4;function Mie(){if(C4)return iA;C4=1;var t=Qz(),e=Eie(),r=m_();function n(i){return i&&i.length?t(i,r,e):void 0}return iA=n,iA}var Pie=Mie();const N1=Yn(Pie);var aA,R4;function Cie(){if(R4)return aA;R4=1;function t(e,r){return e<r}return aA=t,aA}var sA,I4;function Rie(){if(I4)return sA;I4=1;var t=Qz(),e=Cie(),r=m_();function n(i){return i&&i.length?t(i,r,e):void 0}return sA=n,sA}var Iie=Rie();const B1=Yn(Iie);var oA,O4;function Oie(){if(O4)return oA;O4=1;var t=kP(),e=bd(),r=sz(),n=go();function i(o,c){var s=n(o)?t:r;return s(o,e(c,3))}return oA=i,oA}var lA,k4;function kie(){if(k4)return lA;k4=1;var t=iz(),e=Oie();function r(n,i){return t(e(n,i),1)}return lA=r,lA}var Die=kie();const Nie=Yn(Die);var cA,D4;function Bie(){if(D4)return cA;D4=1;var t=WP();function e(r,n){return t(r,n)}return cA=e,cA}var Lie=Bie();const L1=Yn(Lie);var y_=1e9,Fie={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},v3,Si=!0,Zl="[DecimalError] ",qp=Zl+"Invalid argument: ",y3=Zl+"Exponent out of range: ",v_=Math.floor,Ip=Math.pow,zie=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Qo,Ja=1e7,pi=7,Jz=9007199254740991,bx=v_(Jz/pi),gr={};gr.absoluteValue=gr.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};gr.comparedTo=gr.cmp=function(t){var e,r,n,i,o=this;if(t=new o.constructor(t),o.s!==t.s)return o.s||-t.s;if(o.e!==t.e)return o.e>t.e^o.s<0?1:-1;for(n=o.d.length,i=t.d.length,e=0,r=n<i?n:i;e<r;++e)if(o.d[e]!==t.d[e])return o.d[e]>t.d[e]^o.s<0?1:-1;return n===i?0:n>i^o.s<0?1:-1};gr.decimalPlaces=gr.dp=function(){var t=this,e=t.d.length-1,r=(e-t.e)*pi;if(e=t.d[e],e)for(;e%10==0;e/=10)r--;return r<0?0:r};gr.dividedBy=gr.div=function(t){return qh(this,new this.constructor(t))};gr.dividedToIntegerBy=gr.idiv=function(t){var e=this,r=e.constructor;return ri(qh(e,new r(t),0,1),r.precision)};gr.equals=gr.eq=function(t){return!this.cmp(t)};gr.exponent=function(){return wa(this)};gr.greaterThan=gr.gt=function(t){return this.cmp(t)>0};gr.greaterThanOrEqualTo=gr.gte=function(t){return this.cmp(t)>=0};gr.isInteger=gr.isint=function(){return this.e>this.d.length-2};gr.isNegative=gr.isneg=function(){return this.s<0};gr.isPositive=gr.ispos=function(){return this.s>0};gr.isZero=function(){return this.s===0};gr.lessThan=gr.lt=function(t){return this.cmp(t)<0};gr.lessThanOrEqualTo=gr.lte=function(t){return this.cmp(t)<1};gr.logarithm=gr.log=function(t){var e,r=this,n=r.constructor,i=n.precision,o=i+5;if(t===void 0)t=new n(10);else if(t=new n(t),t.s<1||t.eq(Qo))throw Error(Zl+"NaN");if(r.s<1)throw Error(Zl+(r.s?"NaN":"-Infinity"));return r.eq(Qo)?new n(0):(Si=!1,e=qh(dv(r,o),dv(t,o),o),Si=!0,ri(e,i))};gr.minus=gr.sub=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?rj(e,t):ej(e,(t.s=-t.s,t))};gr.modulo=gr.mod=function(t){var e,r=this,n=r.constructor,i=n.precision;if(t=new n(t),!t.s)throw Error(Zl+"NaN");return r.s?(Si=!1,e=qh(r,t,0,1).times(t),Si=!0,r.minus(e)):ri(new n(r),i)};gr.naturalExponential=gr.exp=function(){return tj(this)};gr.naturalLogarithm=gr.ln=function(){return dv(this)};gr.negated=gr.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};gr.plus=gr.add=function(t){var e=this;return t=new e.constructor(t),e.s==t.s?ej(e,t):rj(e,(t.s=-t.s,t))};gr.precision=gr.sd=function(t){var e,r,n,i=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(qp+t);if(e=wa(i)+1,n=i.d.length-1,r=n*pi+1,n=i.d[n],n){for(;n%10==0;n/=10)r--;for(n=i.d[0];n>=10;n/=10)r++}return t&&e>r?e:r};gr.squareRoot=gr.sqrt=function(){var t,e,r,n,i,o,c,s=this,m=s.constructor;if(s.s<1){if(!s.s)return new m(0);throw Error(Zl+"NaN")}for(t=wa(s),Si=!1,i=Math.sqrt(+s),i==0||i==1/0?(e=Cu(s.d),(e.length+t)%2==0&&(e+="0"),i=Math.sqrt(e),t=v_((t+1)/2)-(t<0||t%2),i==1/0?e="5e"+t:(e=i.toExponential(),e=e.slice(0,e.indexOf("e")+1)+t),n=new m(e)):n=new m(i.toString()),r=m.precision,i=c=r+3;;)if(o=n,n=o.plus(qh(s,o,c+2)).times(.5),Cu(o.d).slice(0,c)===(e=Cu(n.d)).slice(0,c)){if(e=e.slice(c-3,c+1),i==c&&e=="4999"){if(ri(o,r+1,0),o.times(o).eq(s)){n=o;break}}else if(e!="9999")break;c+=4}return Si=!0,ri(n,r)};gr.times=gr.mul=function(t){var e,r,n,i,o,c,s,m,v,w=this,M=w.constructor,I=w.d,k=(t=new M(t)).d;if(!w.s||!t.s)return new M(0);for(t.s*=w.s,r=w.e+t.e,m=I.length,v=k.length,m<v&&(o=I,I=k,k=o,c=m,m=v,v=c),o=[],c=m+v,n=c;n--;)o.push(0);for(n=v;--n>=0;){for(e=0,i=m+n;i>n;)s=o[i]+k[n]*I[i-n-1]+e,o[i--]=s%Ja|0,e=s/Ja|0;o[i]=(o[i]+e)%Ja|0}for(;!o[--c];)o.pop();return e?++r:o.shift(),t.d=o,t.e=r,Si?ri(t,M.precision):t};gr.toDecimalPlaces=gr.todp=function(t,e){var r=this,n=r.constructor;return r=new n(r),t===void 0?r:(Du(t,0,y_),e===void 0?e=n.rounding:Du(e,0,8),ri(r,t+wa(r)+1,e))};gr.toExponential=function(t,e){var r,n=this,i=n.constructor;return t===void 0?r=Yp(n,!0):(Du(t,0,y_),e===void 0?e=i.rounding:Du(e,0,8),n=ri(new i(n),t+1,e),r=Yp(n,!0,t+1)),r};gr.toFixed=function(t,e){var r,n,i=this,o=i.constructor;return t===void 0?Yp(i):(Du(t,0,y_),e===void 0?e=o.rounding:Du(e,0,8),n=ri(new o(i),t+wa(i)+1,e),r=Yp(n.abs(),!1,t+wa(n)+1),i.isneg()&&!i.isZero()?"-"+r:r)};gr.toInteger=gr.toint=function(){var t=this,e=t.constructor;return ri(new e(t),wa(t)+1,e.rounding)};gr.toNumber=function(){return+this};gr.toPower=gr.pow=function(t){var e,r,n,i,o,c,s=this,m=s.constructor,v=12,w=+(t=new m(t));if(!t.s)return new m(Qo);if(s=new m(s),!s.s){if(t.s<1)throw Error(Zl+"Infinity");return s}if(s.eq(Qo))return s;if(n=m.precision,t.eq(Qo))return ri(s,n);if(e=t.e,r=t.d.length-1,c=e>=r,o=s.s,c){if((r=w<0?-w:w)<=Jz){for(i=new m(Qo),e=Math.ceil(n/pi+4),Si=!1;r%2&&(i=i.times(s),B4(i.d,e)),r=v_(r/2),r!==0;)s=s.times(s),B4(s.d,e);return Si=!0,t.s<0?new m(Qo).div(i):ri(i,n)}}else if(o<0)throw Error(Zl+"NaN");return o=o<0&&t.d[Math.max(e,r)]&1?-1:1,s.s=1,Si=!1,i=t.times(dv(s,n+v)),Si=!0,i=tj(i),i.s=o,i};gr.toPrecision=function(t,e){var r,n,i=this,o=i.constructor;return t===void 0?(r=wa(i),n=Yp(i,r<=o.toExpNeg||r>=o.toExpPos)):(Du(t,1,y_),e===void 0?e=o.rounding:Du(e,0,8),i=ri(new o(i),t,e),r=wa(i),n=Yp(i,t<=r||r<=o.toExpNeg,t)),n};gr.toSignificantDigits=gr.tosd=function(t,e){var r=this,n=r.constructor;return t===void 0?(t=n.precision,e=n.rounding):(Du(t,1,y_),e===void 0?e=n.rounding:Du(e,0,8)),ri(new n(r),t,e)};gr.toString=gr.valueOf=gr.val=gr.toJSON=gr[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,e=wa(t),r=t.constructor;return Yp(t,e<=r.toExpNeg||e>=r.toExpPos)};function ej(t,e){var r,n,i,o,c,s,m,v,w=t.constructor,M=w.precision;if(!t.s||!e.s)return e.s||(e=new w(t)),Si?ri(e,M):e;if(m=t.d,v=e.d,c=t.e,i=e.e,m=m.slice(),o=c-i,o){for(o<0?(n=m,o=-o,s=v.length):(n=v,i=c,s=m.length),c=Math.ceil(M/pi),s=c>s?c+1:s+1,o>s&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(s=m.length,o=v.length,s-o<0&&(o=s,n=v,v=m,m=n),r=0;o;)r=(m[--o]=m[o]+v[o]+r)/Ja|0,m[o]%=Ja;for(r&&(m.unshift(r),++i),s=m.length;m[--s]==0;)m.pop();return e.d=m,e.e=i,Si?ri(e,M):e}function Du(t,e,r){if(t!==~~t||t<e||t>r)throw Error(qp+t)}function Cu(t){var e,r,n,i=t.length-1,o="",c=t[0];if(i>0){for(o+=c,e=1;e<i;e++)n=t[e]+"",r=pi-n.length,r&&(o+=ad(r)),o+=n;c=t[e],n=c+"",r=pi-n.length,r&&(o+=ad(r))}else if(c===0)return"0";for(;c%10===0;)c/=10;return o+c}var qh=function(){function t(n,i){var o,c=0,s=n.length;for(n=n.slice();s--;)o=n[s]*i+c,n[s]=o%Ja|0,c=o/Ja|0;return c&&n.unshift(c),n}function e(n,i,o,c){var s,m;if(o!=c)m=o>c?1:-1;else for(s=m=0;s<o;s++)if(n[s]!=i[s]){m=n[s]>i[s]?1:-1;break}return m}function r(n,i,o){for(var c=0;o--;)n[o]-=c,c=n[o]<i[o]?1:0,n[o]=c*Ja+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,c){var s,m,v,w,M,I,k,z,V,U,K,J,Z,re,W,Y,ue,be,Ce=n.constructor,Ye=n.s==i.s?1:-1,Me=n.d,Ue=i.d;if(!n.s)return new Ce(n);if(!i.s)throw Error(Zl+"Division by zero");for(m=n.e-i.e,ue=Ue.length,W=Me.length,k=new Ce(Ye),z=k.d=[],v=0;Ue[v]==(Me[v]||0);)++v;if(Ue[v]>(Me[v]||0)&&--m,o==null?J=o=Ce.precision:c?J=o+(wa(n)-wa(i))+1:J=o,J<0)return new Ce(0);if(J=J/pi+2|0,v=0,ue==1)for(w=0,Ue=Ue[0],J++;(v<W||w)&&J--;v++)Z=w*Ja+(Me[v]||0),z[v]=Z/Ue|0,w=Z%Ue|0;else{for(w=Ja/(Ue[0]+1)|0,w>1&&(Ue=t(Ue,w),Me=t(Me,w),ue=Ue.length,W=Me.length),re=ue,V=Me.slice(0,ue),U=V.length;U<ue;)V[U++]=0;be=Ue.slice(),be.unshift(0),Y=Ue[0],Ue[1]>=Ja/2&&++Y;do w=0,s=e(Ue,V,ue,U),s<0?(K=V[0],ue!=U&&(K=K*Ja+(V[1]||0)),w=K/Y|0,w>1?(w>=Ja&&(w=Ja-1),M=t(Ue,w),I=M.length,U=V.length,s=e(M,V,I,U),s==1&&(w--,r(M,ue<I?be:Ue,I))):(w==0&&(s=w=1),M=Ue.slice()),I=M.length,I<U&&M.unshift(0),r(V,M,U),s==-1&&(U=V.length,s=e(Ue,V,ue,U),s<1&&(w++,r(V,ue<U?be:Ue,U))),U=V.length):s===0&&(w++,V=[0]),z[v++]=w,s&&V[0]?V[U++]=Me[re]||0:(V=[Me[re]],U=1);while((re++<W||V[0]!==void 0)&&J--)}return z[0]||z.shift(),k.e=m,ri(k,c?o+wa(k)+1:o)}}();function tj(t,e){var r,n,i,o,c,s,m=0,v=0,w=t.constructor,M=w.precision;if(wa(t)>16)throw Error(y3+wa(t));if(!t.s)return new w(Qo);for(Si=!1,s=M,c=new w(.03125);t.abs().gte(.1);)t=t.times(c),v+=5;for(n=Math.log(Ip(2,v))/Math.LN10*2+5|0,s+=n,r=i=o=new w(Qo),w.precision=s;;){if(i=ri(i.times(t),s),r=r.times(++m),c=o.plus(qh(i,r,s)),Cu(c.d).slice(0,s)===Cu(o.d).slice(0,s)){for(;v--;)o=ri(o.times(o),s);return w.precision=M,e==null?(Si=!0,ri(o,M)):o}o=c}}function wa(t){for(var e=t.e*pi,r=t.d[0];r>=10;r/=10)e++;return e}function uA(t,e,r){if(e>t.LN10.sd())throw Si=!0,r&&(t.precision=r),Error(Zl+"LN10 precision limit exceeded");return ri(new t(t.LN10),e)}function ad(t){for(var e="";t--;)e+="0";return e}function dv(t,e){var r,n,i,o,c,s,m,v,w,M=1,I=10,k=t,z=k.d,V=k.constructor,U=V.precision;if(k.s<1)throw Error(Zl+(k.s?"NaN":"-Infinity"));if(k.eq(Qo))return new V(0);if(e==null?(Si=!1,v=U):v=e,k.eq(10))return e==null&&(Si=!0),uA(V,v);if(v+=I,V.precision=v,r=Cu(z),n=r.charAt(0),o=wa(k),Math.abs(o)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)k=k.times(t),r=Cu(k.d),n=r.charAt(0),M++;o=wa(k),n>1?(k=new V("0."+r),o++):k=new V(n+"."+r.slice(1))}else return m=uA(V,v+2,U).times(o+""),k=dv(new V(n+"."+r.slice(1)),v-I).plus(m),V.precision=U,e==null?(Si=!0,ri(k,U)):k;for(s=c=k=qh(k.minus(Qo),k.plus(Qo),v),w=ri(k.times(k),v),i=3;;){if(c=ri(c.times(w),v),m=s.plus(qh(c,new V(i),v)),Cu(m.d).slice(0,v)===Cu(s.d).slice(0,v))return s=s.times(2),o!==0&&(s=s.plus(uA(V,v+2,U).times(o+""))),s=qh(s,new V(M),v),V.precision=U,e==null?(Si=!0,ri(s,U)):s;s=m,i+=2}}function N4(t,e){var r,n,i;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),n=0;e.charCodeAt(n)===48;)++n;for(i=e.length;e.charCodeAt(i-1)===48;)--i;if(e=e.slice(n,i),e){if(i-=n,r=r-n-1,t.e=v_(r/pi),t.d=[],n=(r+1)%pi,r<0&&(n+=pi),n<i){for(n&&t.d.push(+e.slice(0,n)),i-=pi;n<i;)t.d.push(+e.slice(n,n+=pi));e=e.slice(n),n=pi-e.length}else n-=i;for(;n--;)e+="0";if(t.d.push(+e),Si&&(t.e>bx||t.e<-bx))throw Error(y3+r)}else t.s=0,t.e=0,t.d=[0];return t}function ri(t,e,r){var n,i,o,c,s,m,v,w,M=t.d;for(c=1,o=M[0];o>=10;o/=10)c++;if(n=e-c,n<0)n+=pi,i=e,v=M[w=0];else{if(w=Math.ceil((n+1)/pi),o=M.length,w>=o)return t;for(v=o=M[w],c=1;o>=10;o/=10)c++;n%=pi,i=n-pi+c}if(r!==void 0&&(o=Ip(10,c-i-1),s=v/o%10|0,m=e<0||M[w+1]!==void 0||v%o,m=r<4?(s||m)&&(r==0||r==(t.s<0?3:2)):s>5||s==5&&(r==4||m||r==6&&(n>0?i>0?v/Ip(10,c-i):0:M[w-1])%10&1||r==(t.s<0?8:7))),e<1||!M[0])return m?(o=wa(t),M.length=1,e=e-o-1,M[0]=Ip(10,(pi-e%pi)%pi),t.e=v_(-e/pi)||0):(M.length=1,M[0]=t.e=t.s=0),t;if(n==0?(M.length=w,o=1,w--):(M.length=w+1,o=Ip(10,pi-n),M[w]=i>0?(v/Ip(10,c-i)%Ip(10,i)|0)*o:0),m)for(;;)if(w==0){(M[0]+=o)==Ja&&(M[0]=1,++t.e);break}else{if(M[w]+=o,M[w]!=Ja)break;M[w--]=0,o=1}for(n=M.length;M[--n]===0;)M.pop();if(Si&&(t.e>bx||t.e<-bx))throw Error(y3+wa(t));return t}function rj(t,e){var r,n,i,o,c,s,m,v,w,M,I=t.constructor,k=I.precision;if(!t.s||!e.s)return e.s?e.s=-e.s:e=new I(t),Si?ri(e,k):e;if(m=t.d,M=e.d,n=e.e,v=t.e,m=m.slice(),c=v-n,c){for(w=c<0,w?(r=m,c=-c,s=M.length):(r=M,n=v,s=m.length),i=Math.max(Math.ceil(k/pi),s)+2,c>i&&(c=i,r.length=1),r.reverse(),i=c;i--;)r.push(0);r.reverse()}else{for(i=m.length,s=M.length,w=i<s,w&&(s=i),i=0;i<s;i++)if(m[i]!=M[i]){w=m[i]<M[i];break}c=0}for(w&&(r=m,m=M,M=r,e.s=-e.s),s=m.length,i=M.length-s;i>0;--i)m[s++]=0;for(i=M.length;i>c;){if(m[--i]<M[i]){for(o=i;o&&m[--o]===0;)m[o]=Ja-1;--m[o],m[i]+=Ja}m[i]-=M[i]}for(;m[--s]===0;)m.pop();for(;m[0]===0;m.shift())--n;return m[0]?(e.d=m,e.e=n,Si?ri(e,k):e):new I(0)}function Yp(t,e,r){var n,i=wa(t),o=Cu(t.d),c=o.length;return e?(r&&(n=r-c)>0?o=o.charAt(0)+"."+o.slice(1)+ad(n):c>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i<0?"e":"e+")+i):i<0?(o="0."+ad(-i-1)+o,r&&(n=r-c)>0&&(o+=ad(n))):i>=c?(o+=ad(i+1-c),r&&(n=r-i-1)>0&&(o=o+"."+ad(n))):((n=i+1)<c&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-c)>0&&(i+1===c&&(o+="."),o+=ad(n))),t.s<0?"-"+o:o}function B4(t,e){if(t.length>e)return t.length=e,!0}function nj(t){var e,r,n;function i(o){var c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,o instanceof i){c.s=o.s,c.e=o.e,c.d=(o=o.d)?o.slice():o;return}if(typeof o=="number"){if(o*0!==0)throw Error(qp+o);if(o>0)c.s=1;else if(o<0)o=-o,c.s=-1;else{c.s=0,c.e=0,c.d=[0];return}if(o===~~o&&o<1e7){c.e=0,c.d=[o];return}return N4(c,o.toString())}else if(typeof o!="string")throw Error(qp+o);if(o.charCodeAt(0)===45?(o=o.slice(1),c.s=-1):c.s=1,zie.test(o))N4(c,o);else throw Error(qp+o)}if(i.prototype=gr,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.clone=nj,i.config=i.set=jie,t===void 0&&(t={}),t)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],e=0;e<n.length;)t.hasOwnProperty(r=n[e++])||(t[r]=this[r]);return i.config(t),i}function jie(t){if(!t||typeof t!="object")throw Error(Zl+"Object expected");var e,r,n,i=["precision",1,y_,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(e=0;e<i.length;e+=3)if((n=t[r=i[e]])!==void 0)if(v_(n)===n&&n>=i[e+1]&&n<=i[e+2])this[r]=n;else throw Error(qp+r+": "+n);if((n=t[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(qp+r+": "+n);return this}var v3=nj(Fie);Qo=new v3(1);const Xn=v3;function Uie(t){return Hie(t)||qie(t)||Vie(t)||$ie()}function $ie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vie(t,e){if(t){if(typeof t=="string")return iM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return iM(t,e)}}function qie(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function Hie(t){if(Array.isArray(t))return iM(t)}function iM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Wie=function(e){return e},ij={},aj=function(e){return e===ij},L4=function(e){return function r(){return arguments.length===0||arguments.length===1&&aj(arguments.length<=0?void 0:arguments[0])?r:e.apply(void 0,arguments)}},Zie=function t(e,r){return e===1?r:L4(function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];var c=i.filter(function(s){return s!==ij}).length;return c>=e?r.apply(void 0,i):t(e-c,L4(function(){for(var s=arguments.length,m=new Array(s),v=0;v<s;v++)m[v]=arguments[v];var w=i.map(function(M){return aj(M)?m.shift():M});return r.apply(void 0,Uie(w).concat(m))}))})},F1=function(e){return Zie(e.length,e)},aM=function(e,r){for(var n=[],i=e;i<r;++i)n[i-e]=i;return n},Xie=F1(function(t,e){return Array.isArray(e)?e.map(t):Object.keys(e).map(function(r){return e[r]}).map(t)}),Gie=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!r.length)return Wie;var i=r.reverse(),o=i[0],c=i.slice(1);return function(){return c.reduce(function(s,m){return m(s)},o.apply(void 0,arguments))}},sM=function(e){return Array.isArray(e)?e.reverse():e.split("").reverse.join("")},sj=function(e){var r=null,n=null;return function(){for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return r&&o.every(function(s,m){return s===r[m]})||(r=o,n=e.apply(void 0,o)),n}};function Yie(t){var e;return t===0?e=1:e=Math.floor(new Xn(t).abs().log(10).toNumber())+1,e}function Kie(t,e,r){for(var n=new Xn(t),i=0,o=[];n.lt(e)&&i<1e5;)o.push(n.toNumber()),n=n.add(r),i++;return o}var Qie=F1(function(t,e,r){var n=+t,i=+e;return n+r*(i-n)}),Jie=F1(function(t,e,r){var n=e-+t;return n=n||1/0,(r-t)/n}),eae=F1(function(t,e,r){var n=e-+t;return n=n||1/0,Math.max(0,Math.min(1,(r-t)/n))});const z1={rangeStep:Kie,getDigitCount:Yie,interpolateNumber:Qie,uninterpolateNumber:Jie,uninterpolateTruncation:eae};function oM(t){return nae(t)||rae(t)||oj(t)||tae()}function tae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rae(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function nae(t){if(Array.isArray(t))return lM(t)}function pv(t,e){return sae(t)||aae(t,e)||oj(t,e)||iae()}function iae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oj(t,e){if(t){if(typeof t=="string")return lM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lM(t,e)}}function lM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function aae(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var r=[],n=!0,i=!1,o=void 0;try{for(var c=t[Symbol.iterator](),s;!(n=(s=c.next()).done)&&(r.push(s.value),!(e&&r.length===e));n=!0);}catch(m){i=!0,o=m}finally{try{!n&&c.return!=null&&c.return()}finally{if(i)throw o}}return r}}function sae(t){if(Array.isArray(t))return t}function lj(t){var e=pv(t,2),r=e[0],n=e[1],i=r,o=n;return r>n&&(i=n,o=r),[i,o]}function cj(t,e,r){if(t.lte(0))return new Xn(0);var n=z1.getDigitCount(t.toNumber()),i=new Xn(10).pow(n),o=t.div(i),c=n!==1?.05:.1,s=new Xn(Math.ceil(o.div(c).toNumber())).add(r).mul(c),m=s.mul(i);return e?m:new Xn(Math.ceil(m))}function oae(t,e,r){var n=1,i=new Xn(t);if(!i.isint()&&r){var o=Math.abs(t);o<1?(n=new Xn(10).pow(z1.getDigitCount(t)-1),i=new Xn(Math.floor(i.div(n).toNumber())).mul(n)):o>1&&(i=new Xn(Math.floor(t)))}else t===0?i=new Xn(Math.floor((e-1)/2)):r||(i=new Xn(Math.floor(t)));var c=Math.floor((e-1)/2),s=Gie(Xie(function(m){return i.add(new Xn(m-c).mul(n)).toNumber()}),aM);return s(0,e)}function uj(t,e,r,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((e-t)/(r-1)))return{step:new Xn(0),tickMin:new Xn(0),tickMax:new Xn(0)};var o=cj(new Xn(e).sub(t).div(r-1),n,i),c;t<=0&&e>=0?c=new Xn(0):(c=new Xn(t).add(e).div(2),c=c.sub(new Xn(c).mod(o)));var s=Math.ceil(c.sub(t).div(o).toNumber()),m=Math.ceil(new Xn(e).sub(c).div(o).toNumber()),v=s+m+1;return v>r?uj(t,e,r,n,i+1):(v<r&&(m=e>0?m+(r-v):m,s=e>0?s:s+(r-v)),{step:o,tickMin:c.sub(new Xn(s).mul(o)),tickMax:c.add(new Xn(m).mul(o))})}function lae(t){var e=pv(t,2),r=e[0],n=e[1],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,c=Math.max(i,2),s=lj([r,n]),m=pv(s,2),v=m[0],w=m[1];if(v===-1/0||w===1/0){var M=w===1/0?[v].concat(oM(aM(0,i-1).map(function(){return 1/0}))):[].concat(oM(aM(0,i-1).map(function(){return-1/0})),[w]);return r>n?sM(M):M}if(v===w)return oae(v,i,o);var I=uj(v,w,c,o),k=I.step,z=I.tickMin,V=I.tickMax,U=z1.rangeStep(z,V.add(new Xn(.1).mul(k)),k);return r>n?sM(U):U}function cae(t,e){var r=pv(t,2),n=r[0],i=r[1],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,c=lj([n,i]),s=pv(c,2),m=s[0],v=s[1];if(m===-1/0||v===1/0)return[n,i];if(m===v)return[m];var w=Math.max(e,2),M=cj(new Xn(v).sub(m).div(w-1),o,0),I=[].concat(oM(z1.rangeStep(new Xn(m),new Xn(v).sub(new Xn(.99).mul(M)),M)),[v]);return n>i?sM(I):I}var uae=sj(lae),hae=sj(cae),fae="Invariant failed";function Kp(t,e){throw new Error(fae)}var dae=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Jg(t){"@babel/helpers - typeof";return Jg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jg(t)}function xx(){return xx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},xx.apply(this,arguments)}function pae(t,e){return yae(t)||_ae(t,e)||gae(t,e)||mae()}function mae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gae(t,e){if(t){if(typeof t=="string")return F4(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return F4(t,e)}}function F4(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _ae(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function yae(t){if(Array.isArray(t))return t}function vae(t,e){if(t==null)return{};var r=bae(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function bae(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function xae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wae(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dj(n.key),n)}}function Tae(t,e,r){return e&&wae(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Sae(t,e,r){return e=wx(e),Aae(t,hj()?Reflect.construct(e,r||[],wx(t).constructor):e.apply(t,r))}function Aae(t,e){if(e&&(Jg(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Eae(t)}function Eae(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hj=function(){return!!t})()}function wx(t){return wx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wx(t)}function Mae(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cM(t,e)}function cM(t,e){return cM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},cM(t,e)}function fj(t,e,r){return e=dj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function dj(t){var e=Pae(t,"string");return Jg(e)=="symbol"?e:e+""}function Pae(t,e){if(Jg(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Jg(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Qv=function(t){function e(){return xae(this,e),Sae(this,e,arguments)}return Mae(e,t),Tae(e,[{key:"render",value:function(){var n=this.props,i=n.offset,o=n.layout,c=n.width,s=n.dataKey,m=n.data,v=n.dataPointFormatter,w=n.xAxis,M=n.yAxis,I=vae(n,dae),k=an(I,!1);this.props.direction==="x"&&w.type!=="number"&&Kp();var z=m.map(function(V){var U=v(V,s),K=U.x,J=U.y,Z=U.value,re=U.errorVal;if(!re)return null;var W=[],Y,ue;if(Array.isArray(re)){var be=pae(re,2);Y=be[0],ue=be[1]}else Y=ue=re;if(o==="vertical"){var Ce=w.scale,Ye=J+i,Me=Ye+c,Ue=Ye-c,Qe=Ce(Z-Y),Ze=Ce(Z+ue);W.push({x1:Ze,y1:Me,x2:Ze,y2:Ue}),W.push({x1:Qe,y1:Ye,x2:Ze,y2:Ye}),W.push({x1:Qe,y1:Me,x2:Qe,y2:Ue})}else if(o==="horizontal"){var ct=M.scale,Ie=K+i,et=Ie-c,ot=Ie+c,Bt=ct(Z-Y),Te=ct(Z+ue);W.push({x1:et,y1:Te,x2:ot,y2:Te}),W.push({x1:Ie,y1:Bt,x2:Ie,y2:Te}),W.push({x1:et,y1:Bt,x2:ot,y2:Bt})}return He.createElement(ia,xx({className:"recharts-errorBar",key:"bar-".concat(W.map(function(ft){return"".concat(ft.x1,"-").concat(ft.x2,"-").concat(ft.y1,"-").concat(ft.y2)}))},k),W.map(function(ft){return He.createElement("line",xx({},ft,{key:"line-".concat(ft.x1,"-").concat(ft.x2,"-").concat(ft.y1,"-").concat(ft.y2)}))}))});return He.createElement(ia,{className:"recharts-errorBars"},z)}}])}(He.Component);fj(Qv,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});fj(Qv,"displayName","ErrorBar");function mv(t){"@babel/helpers - typeof";return mv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mv(t)}function z4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Cp(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?z4(Object(r),!0).forEach(function(n){Cae(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):z4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Cae(t,e,r){return e=Rae(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rae(t){var e=Iae(t,"string");return mv(e)=="symbol"?e:e+""}function Iae(t,e){if(mv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(mv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var pj=function(e){var r=e.children,n=e.formattedGraphicalItems,i=e.legendWidth,o=e.legendContent,c=Go(r,md);if(!c)return null;var s=md.defaultProps,m=s!==void 0?Cp(Cp({},s),c.props):{},v;return c.props&&c.props.payload?v=c.props&&c.props.payload:o==="children"?v=(n||[]).reduce(function(w,M){var I=M.item,k=M.props,z=k.sectors||k.data||[];return w.concat(z.map(function(V){return{type:c.props.iconType||I.props.legendType,value:V.name,color:V.fill,payload:V}}))},[]):v=(n||[]).map(function(w){var M=w.item,I=M.type.defaultProps,k=I!==void 0?Cp(Cp({},I),M.props):{},z=k.dataKey,V=k.name,U=k.legendType,K=k.hide;return{inactive:K,dataKey:z,type:m.iconType||U||"square",color:b3(M),value:V||z,payload:k}}),Cp(Cp(Cp({},m),md.getWithHeight(c,i)),{},{payload:v,item:c})};function gv(t){"@babel/helpers - typeof";return gv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gv(t)}function j4(t){return Nae(t)||Dae(t)||kae(t)||Oae()}function Oae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kae(t,e){if(t){if(typeof t=="string")return uM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uM(t,e)}}function Dae(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Nae(t){if(Array.isArray(t))return uM(t)}function uM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function U4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Zi(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?U4(Object(r),!0).forEach(function(n){kg(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):U4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function kg(t,e,r){return e=Bae(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Bae(t){var e=Lae(t,"string");return gv(e)=="symbol"?e:e+""}function Lae(t,e){if(gv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(gv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Jo(t,e,r){return tn(t)||tn(e)?r:Da(e)?ql(t,e,r):Xr(e)?e(t):r}function Hy(t,e,r,n){var i=Nie(t,function(s){return Jo(s,e)});if(r==="number"){var o=i.filter(function(s){return nr(s)||parseFloat(s)});return o.length?[B1(o),N1(o)]:[1/0,-1/0]}var c=n?i.filter(function(s){return!tn(s)}):i;return c.map(function(s){return Da(s)||s instanceof Date?s:""})}var Fae=function(e){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,c=-1,s=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(s<=1)return 0;if(o&&o.axisType==="angleAxis"&&Math.abs(Math.abs(o.range[1]-o.range[0])-360)<=1e-6)for(var m=o.range,v=0;v<s;v++){var w=v>0?i[v-1].coordinate:i[s-1].coordinate,M=i[v].coordinate,I=v>=s-1?i[0].coordinate:i[v+1].coordinate,k=void 0;if(Hc(M-w)!==Hc(I-M)){var z=[];if(Hc(I-M)===Hc(m[1]-m[0])){k=I;var V=M+m[1]-m[0];z[0]=Math.min(V,(V+w)/2),z[1]=Math.max(V,(V+w)/2)}else{k=w;var U=I+m[1]-m[0];z[0]=Math.min(M,(U+M)/2),z[1]=Math.max(M,(U+M)/2)}var K=[Math.min(M,(k+M)/2),Math.max(M,(k+M)/2)];if(e>K[0]&&e<=K[1]||e>=z[0]&&e<=z[1]){c=i[v].index;break}}else{var J=Math.min(w,I),Z=Math.max(w,I);if(e>(J+M)/2&&e<=(Z+M)/2){c=i[v].index;break}}}else for(var re=0;re<s;re++)if(re===0&&e<=(n[re].coordinate+n[re+1].coordinate)/2||re>0&&re<s-1&&e>(n[re].coordinate+n[re-1].coordinate)/2&&e<=(n[re].coordinate+n[re+1].coordinate)/2||re===s-1&&e>(n[re].coordinate+n[re-1].coordinate)/2){c=n[re].index;break}return c},b3=function(e){var r,n=e,i=n.type.displayName,o=(r=e.type)!==null&&r!==void 0&&r.defaultProps?Zi(Zi({},e.type.defaultProps),e.props):e.props,c=o.stroke,s=o.fill,m;switch(i){case"Line":m=c;break;case"Area":case"Radar":m=c&&c!=="none"?c:s;break;default:m=s;break}return m},zae=function(e){var r=e.barSize,n=e.totalSize,i=e.stackGroups,o=i===void 0?{}:i;if(!o)return{};for(var c={},s=Object.keys(o),m=0,v=s.length;m<v;m++)for(var w=o[s[m]].stackGroups,M=Object.keys(w),I=0,k=M.length;I<k;I++){var z=w[M[I]],V=z.items,U=z.cateAxisId,K=V.filter(function(ue){return $h(ue.type).indexOf("Bar")>=0});if(K&&K.length){var J=K[0].type.defaultProps,Z=J!==void 0?Zi(Zi({},J),K[0].props):K[0].props,re=Z.barSize,W=Z[U];c[W]||(c[W]=[]);var Y=tn(re)?r:re;c[W].push({item:K[0],stackList:K.slice(1),barSize:tn(Y)?void 0:Gp(Y,n,0)})}}return c},jae=function(e){var r=e.barGap,n=e.barCategoryGap,i=e.bandSize,o=e.sizeList,c=o===void 0?[]:o,s=e.maxBarSize,m=c.length;if(m<1)return null;var v=Gp(r,i,0,!0),w,M=[];if(c[0].barSize===+c[0].barSize){var I=!1,k=i/m,z=c.reduce(function(re,W){return re+W.barSize||0},0);z+=(m-1)*v,z>=i&&(z-=(m-1)*v,v=0),z>=i&&k>0&&(I=!0,k*=.9,z=m*k);var V=(i-z)/2>>0,U={offset:V-v,size:0};w=c.reduce(function(re,W){var Y={item:W.item,position:{offset:U.offset+U.size+v,size:I?k:W.barSize}},ue=[].concat(j4(re),[Y]);return U=ue[ue.length-1].position,W.stackList&&W.stackList.length&&W.stackList.forEach(function(be){ue.push({item:be,position:U})}),ue},M)}else{var K=Gp(n,i,0,!0);i-2*K-(m-1)*v<=0&&(v=0);var J=(i-2*K-(m-1)*v)/m;J>1&&(J>>=0);var Z=s===+s?Math.min(J,s):J;w=c.reduce(function(re,W,Y){var ue=[].concat(j4(re),[{item:W.item,position:{offset:K+(J+v)*Y+(J-Z)/2,size:Z}}]);return W.stackList&&W.stackList.length&&W.stackList.forEach(function(be){ue.push({item:be,position:ue[ue.length-1].position})}),ue},M)}return w},Uae=function(e,r,n,i){var o=n.children,c=n.width,s=n.margin,m=c-(s.left||0)-(s.right||0),v=pj({children:o,legendWidth:m});if(v){var w=i||{},M=w.width,I=w.height,k=v.align,z=v.verticalAlign,V=v.layout;if((V==="vertical"||V==="horizontal"&&z==="middle")&&k!=="center"&&nr(e[k]))return Zi(Zi({},e),{},kg({},k,e[k]+(M||0)));if((V==="horizontal"||V==="vertical"&&k==="center")&&z!=="middle"&&nr(e[z]))return Zi(Zi({},e),{},kg({},z,e[z]+(I||0)))}return e},$ae=function(e,r,n){return tn(r)?!0:e==="horizontal"?r==="yAxis":e==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},mj=function(e,r,n,i,o){var c=r.props.children,s=Hl(c,Qv).filter(function(v){return $ae(i,o,v.props.direction)});if(s&&s.length){var m=s.map(function(v){return v.props.dataKey});return e.reduce(function(v,w){var M=Jo(w,n);if(tn(M))return v;var I=Array.isArray(M)?[B1(M),N1(M)]:[M,M],k=m.reduce(function(z,V){var U=Jo(w,V,0),K=I[0]-Math.abs(Array.isArray(U)?U[0]:U),J=I[1]+Math.abs(Array.isArray(U)?U[1]:U);return[Math.min(K,z[0]),Math.max(J,z[1])]},[1/0,-1/0]);return[Math.min(k[0],v[0]),Math.max(k[1],v[1])]},[1/0,-1/0])}return null},Vae=function(e,r,n,i,o){var c=r.map(function(s){return mj(e,s,n,o,i)}).filter(function(s){return!tn(s)});return c&&c.length?c.reduce(function(s,m){return[Math.min(s[0],m[0]),Math.max(s[1],m[1])]},[1/0,-1/0]):null},gj=function(e,r,n,i,o){var c=r.map(function(m){var v=m.props.dataKey;return n==="number"&&v&&mj(e,m,v,i)||Hy(e,v,n,o)});if(n==="number")return c.reduce(function(m,v){return[Math.min(m[0],v[0]),Math.max(m[1],v[1])]},[1/0,-1/0]);var s={};return c.reduce(function(m,v){for(var w=0,M=v.length;w<M;w++)s[v[w]]||(s[v[w]]=!0,m.push(v[w]));return m},[])},_j=function(e,r){return e==="horizontal"&&r==="xAxis"||e==="vertical"&&r==="yAxis"||e==="centric"&&r==="angleAxis"||e==="radial"&&r==="radiusAxis"},yj=function(e,r,n,i){if(i)return e.map(function(m){return m.coordinate});var o,c,s=e.map(function(m){return m.coordinate===r&&(o=!0),m.coordinate===n&&(c=!0),m.coordinate});return o||s.push(r),c||s.push(n),s},Uh=function(e,r,n){if(!e)return null;var i=e.scale,o=e.duplicateDomain,c=e.type,s=e.range,m=e.realScaleType==="scaleBand"?i.bandwidth()/2:2,v=(r||n)&&c==="category"&&i.bandwidth?i.bandwidth()/m:0;if(v=e.axisType==="angleAxis"&&(s==null?void 0:s.length)>=2?Hc(s[0]-s[1])*2*v:v,r&&(e.ticks||e.niceTicks)){var w=(e.ticks||e.niceTicks).map(function(M){var I=o?o.indexOf(M):M;return{coordinate:i(I)+v,value:M,offset:v}});return w.filter(function(M){return!Hv(M.coordinate)})}return e.isCategorical&&e.categoricalDomain?e.categoricalDomain.map(function(M,I){return{coordinate:i(M)+v,value:M,index:I,offset:v}}):i.ticks&&!n?i.ticks(e.tickCount).map(function(M){return{coordinate:i(M)+v,value:M,offset:v}}):i.domain().map(function(M,I){return{coordinate:i(M)+v,value:o?o[M]:M,index:I,offset:v}})},hA=new WeakMap,c0=function(e,r){if(typeof r!="function")return e;hA.has(e)||hA.set(e,new WeakMap);var n=hA.get(e);if(n.has(r))return n.get(r);var i=function(){e.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,i),i},qae=function(e,r,n){var i=e.scale,o=e.type,c=e.layout,s=e.axisType;if(i==="auto")return c==="radial"&&s==="radiusAxis"?{scale:lv(),realScaleType:"band"}:c==="radial"&&s==="angleAxis"?{scale:gx(),realScaleType:"linear"}:o==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:qy(),realScaleType:"point"}:o==="category"?{scale:lv(),realScaleType:"band"}:{scale:gx(),realScaleType:"linear"};if(Xp(i)){var m="scale".concat(w1(i));return{scale:(E4[m]||qy)(),realScaleType:E4[m]?m:"point"}}return Xr(i)?{scale:i}:{scale:qy(),realScaleType:"point"}},$4=1e-4,Hae=function(e){var r=e.domain();if(!(!r||r.length<=2)){var n=r.length,i=e.range(),o=Math.min(i[0],i[1])-$4,c=Math.max(i[0],i[1])+$4,s=e(r[0]),m=e(r[n-1]);(s<o||s>c||m<o||m>c)&&e.domain([r[0],r[n-1]])}},Wae=function(e,r){if(!e)return null;for(var n=0,i=e.length;n<i;n++)if(e[n].item===r)return e[n].position;return null},Zae=function(e,r){if(!r||r.length!==2||!nr(r[0])||!nr(r[1]))return e;var n=Math.min(r[0],r[1]),i=Math.max(r[0],r[1]),o=[e[0],e[1]];return(!nr(e[0])||e[0]<n)&&(o[0]=n),(!nr(e[1])||e[1]>i)&&(o[1]=i),o[0]>i&&(o[0]=i),o[1]<n&&(o[1]=n),o},Xae=function(e){var r=e.length;if(!(r<=0))for(var n=0,i=e[0].length;n<i;++n)for(var o=0,c=0,s=0;s<r;++s){var m=Hv(e[s][n][1])?e[s][n][0]:e[s][n][1];m>=0?(e[s][n][0]=o,e[s][n][1]=o+m,o=e[s][n][1]):(e[s][n][0]=c,e[s][n][1]=c+m,c=e[s][n][1])}},Gae=function(e){var r=e.length;if(!(r<=0))for(var n=0,i=e[0].length;n<i;++n)for(var o=0,c=0;c<r;++c){var s=Hv(e[c][n][1])?e[c][n][0]:e[c][n][1];s>=0?(e[c][n][0]=o,e[c][n][1]=o+s,o=e[c][n][1]):(e[c][n][0]=0,e[c][n][1]=0)}},Yae={sign:Xae,expand:kQ,none:Hg,silhouette:DQ,wiggle:NQ,positive:Gae},Kae=function(e,r,n){var i=r.map(function(s){return s.props.dataKey}),o=Yae[n],c=OQ().keys(i).value(function(s,m){return+Jo(s,m,0)}).order(jE).offset(o);return c(e)},Qae=function(e,r,n,i,o,c){if(!e)return null;var s=c?r.reverse():r,m={},v=s.reduce(function(M,I){var k,z=(k=I.type)!==null&&k!==void 0&&k.defaultProps?Zi(Zi({},I.type.defaultProps),I.props):I.props,V=z.stackId,U=z.hide;if(U)return M;var K=z[n],J=M[K]||{hasStack:!1,stackGroups:{}};if(Da(V)){var Z=J.stackGroups[V]||{numericAxisId:n,cateAxisId:i,items:[]};Z.items.push(I),J.hasStack=!0,J.stackGroups[V]=Z}else J.stackGroups[Wv("_stackId_")]={numericAxisId:n,cateAxisId:i,items:[I]};return Zi(Zi({},M),{},kg({},K,J))},m),w={};return Object.keys(v).reduce(function(M,I){var k=v[I];if(k.hasStack){var z={};k.stackGroups=Object.keys(k.stackGroups).reduce(function(V,U){var K=k.stackGroups[U];return Zi(Zi({},V),{},kg({},U,{numericAxisId:n,cateAxisId:i,items:K.items,stackedData:Kae(e,K.items,o)}))},z)}return Zi(Zi({},M),{},kg({},I,k))},w)},Jae=function(e,r){var n=r.realScaleType,i=r.type,o=r.tickCount,c=r.originalDomain,s=r.allowDecimals,m=n||r.scale;if(m!=="auto"&&m!=="linear")return null;if(o&&i==="number"&&c&&(c[0]==="auto"||c[1]==="auto")){var v=e.domain();if(!v.length)return null;var w=uae(v,o,s);return e.domain([B1(w),N1(w)]),{niceTicks:w}}if(o&&i==="number"){var M=e.domain(),I=hae(M,o,s);return{niceTicks:I}}return null};function V4(t){var e=t.axis,r=t.ticks,n=t.bandSize,i=t.entry,o=t.index,c=t.dataKey;if(e.type==="category"){if(!e.allowDuplicatedCategory&&e.dataKey&&!tn(i[e.dataKey])){var s=Y0(r,"value",i[e.dataKey]);if(s)return s.coordinate+n/2}return r[o]?r[o].coordinate+n/2:null}var m=Jo(i,tn(c)?e.dataKey:c);return tn(m)?null:e.scale(m)}var q4=function(e){var r=e.axis,n=e.ticks,i=e.offset,o=e.bandSize,c=e.entry,s=e.index;if(r.type==="category")return n[s]?n[s].coordinate+i:null;var m=Jo(c,r.dataKey,r.domain[s]);return tn(m)?null:r.scale(m)-o/2+i},ese=function(e){var r=e.numericAxis,n=r.scale.domain();if(r.type==="number"){var i=Math.min(n[0],n[1]),o=Math.max(n[0],n[1]);return i<=0&&o>=0?0:o<0?o:i}return n[0]},tse=function(e,r){var n,i=(n=e.type)!==null&&n!==void 0&&n.defaultProps?Zi(Zi({},e.type.defaultProps),e.props):e.props,o=i.stackId;if(Da(o)){var c=r[o];if(c){var s=c.items.indexOf(e);return s>=0?c.stackedData[s]:null}}return null},rse=function(e){return e.reduce(function(r,n){return[B1(n.concat([r[0]]).filter(nr)),N1(n.concat([r[1]]).filter(nr))]},[1/0,-1/0])},vj=function(e,r,n){return Object.keys(e).reduce(function(i,o){var c=e[o],s=c.stackedData,m=s.reduce(function(v,w){var M=rse(w.slice(r,n+1));return[Math.min(v[0],M[0]),Math.max(v[1],M[1])]},[1/0,-1/0]);return[Math.min(m[0],i[0]),Math.max(m[1],i[1])]},[1/0,-1/0]).map(function(i){return i===1/0||i===-1/0?0:i})},H4=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,W4=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,hM=function(e,r,n){if(Xr(e))return e(r,n);if(!Array.isArray(e))return r;var i=[];if(nr(e[0]))i[0]=n?e[0]:Math.min(e[0],r[0]);else if(H4.test(e[0])){var o=+H4.exec(e[0])[1];i[0]=r[0]-o}else Xr(e[0])?i[0]=e[0](r[0]):i[0]=r[0];if(nr(e[1]))i[1]=n?e[1]:Math.max(e[1],r[1]);else if(W4.test(e[1])){var c=+W4.exec(e[1])[1];i[1]=r[1]+c}else Xr(e[1])?i[1]=e[1](r[1]):i[1]=r[1];return i},Tx=function(e,r,n){if(e&&e.scale&&e.scale.bandwidth){var i=e.scale.bandwidth();if(!n||i>0)return i}if(e&&r&&r.length>=2){for(var o=XP(r,function(M){return M.coordinate}),c=1/0,s=1,m=o.length;s<m;s++){var v=o[s],w=o[s-1];c=Math.min((v.coordinate||0)-(w.coordinate||0),c)}return c===1/0?0:c}return n?void 0:0},Z4=function(e,r,n){return!e||!e.length||L1(e,ql(n,"type.defaultProps.domain"))?r:e},bj=function(e,r){var n=e.type.defaultProps?Zi(Zi({},e.type.defaultProps),e.props):e.props,i=n.dataKey,o=n.name,c=n.unit,s=n.formatter,m=n.tooltipType,v=n.chartType,w=n.hide;return Zi(Zi({},an(e,!1)),{},{dataKey:i,unit:c,formatter:s,name:o||i,color:b3(e),value:Jo(r,i),type:m,payload:r,chartType:v,hide:w})};function _v(t){"@babel/helpers - typeof";return _v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_v(t)}function X4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function G4(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?X4(Object(r),!0).forEach(function(n){nse(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):X4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function nse(t,e,r){return e=ise(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ise(t){var e=ase(t,"string");return _v(e)=="symbol"?e:e+""}function ase(t,e){if(_v(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(_v(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Sx=Math.PI/180,sse=function(e){return e*180/Math.PI},ps=function(e,r,n,i){return{x:e+Math.cos(-Sx*i)*n,y:r+Math.sin(-Sx*i)*n}},ose=function(e,r){var n=e.x,i=e.y,o=r.x,c=r.y;return Math.sqrt(Math.pow(n-o,2)+Math.pow(i-c,2))},lse=function(e,r){var n=e.x,i=e.y,o=r.cx,c=r.cy,s=ose({x:n,y:i},{x:o,y:c});if(s<=0)return{radius:s};var m=(n-o)/s,v=Math.acos(m);return i>c&&(v=2*Math.PI-v),{radius:s,angle:sse(v),angleInRadian:v}},cse=function(e){var r=e.startAngle,n=e.endAngle,i=Math.floor(r/360),o=Math.floor(n/360),c=Math.min(i,o);return{startAngle:r-c*360,endAngle:n-c*360}},use=function(e,r){var n=r.startAngle,i=r.endAngle,o=Math.floor(n/360),c=Math.floor(i/360),s=Math.min(o,c);return e+s*360},Y4=function(e,r){var n=e.x,i=e.y,o=lse({x:n,y:i},r),c=o.radius,s=o.angle,m=r.innerRadius,v=r.outerRadius;if(c<m||c>v)return!1;if(c===0)return!0;var w=cse(r),M=w.startAngle,I=w.endAngle,k=s,z;if(M<=I){for(;k>I;)k-=360;for(;k<M;)k+=360;z=k>=M&&k<=I}else{for(;k>M;)k-=360;for(;k<I;)k+=360;z=k>=I&&k<=M}return z?G4(G4({},r),{},{radius:c,angle:use(k,r)}):null};function yv(t){"@babel/helpers - typeof";return yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yv(t)}var hse=["offset"];function fse(t){return gse(t)||mse(t)||pse(t)||dse()}function dse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pse(t,e){if(t){if(typeof t=="string")return fM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fM(t,e)}}function mse(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function gse(t){if(Array.isArray(t))return fM(t)}function fM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _se(t,e){if(t==null)return{};var r=yse(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function yse(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function K4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ia(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?K4(Object(r),!0).forEach(function(n){vse(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):K4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function vse(t,e,r){return e=bse(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function bse(t){var e=xse(t,"string");return yv(e)=="symbol"?e:e+""}function xse(t,e){if(yv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(yv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vv(){return vv=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},vv.apply(this,arguments)}var wse=function(e){var r=e.value,n=e.formatter,i=tn(e.children)?r:e.children;return Xr(n)?n(i):i},Tse=function(e,r){var n=Hc(r-e),i=Math.min(Math.abs(r-e),360);return n*i},Sse=function(e,r,n){var i=e.position,o=e.viewBox,c=e.offset,s=e.className,m=o,v=m.cx,w=m.cy,M=m.innerRadius,I=m.outerRadius,k=m.startAngle,z=m.endAngle,V=m.clockWise,U=(M+I)/2,K=Tse(k,z),J=K>=0?1:-1,Z,re;i==="insideStart"?(Z=k+J*c,re=V):i==="insideEnd"?(Z=z-J*c,re=!V):i==="end"&&(Z=z+J*c,re=V),re=K<=0?re:!re;var W=ps(v,w,U,Z),Y=ps(v,w,U,Z+(re?1:-1)*359),ue="M".concat(W.x,",").concat(W.y,`
    A`).concat(U,",").concat(U,",0,1,").concat(re?0:1,`,
    `).concat(Y.x,",").concat(Y.y),be=tn(e.id)?Wv("recharts-radial-line-"):e.id;return He.createElement("text",vv({},n,{dominantBaseline:"central",className:pn("recharts-radial-bar-label",s)}),He.createElement("defs",null,He.createElement("path",{id:be,d:ue})),He.createElement("textPath",{xlinkHref:"#".concat(be)},r))},Ase=function(e){var r=e.viewBox,n=e.offset,i=e.position,o=r,c=o.cx,s=o.cy,m=o.innerRadius,v=o.outerRadius,w=o.startAngle,M=o.endAngle,I=(w+M)/2;if(i==="outside"){var k=ps(c,s,v+n,I),z=k.x,V=k.y;return{x:z,y:V,textAnchor:z>=c?"start":"end",verticalAnchor:"middle"}}if(i==="center")return{x:c,y:s,textAnchor:"middle",verticalAnchor:"middle"};if(i==="centerTop")return{x:c,y:s,textAnchor:"middle",verticalAnchor:"start"};if(i==="centerBottom")return{x:c,y:s,textAnchor:"middle",verticalAnchor:"end"};var U=(m+v)/2,K=ps(c,s,U,I),J=K.x,Z=K.y;return{x:J,y:Z,textAnchor:"middle",verticalAnchor:"middle"}},Ese=function(e){var r=e.viewBox,n=e.parentViewBox,i=e.offset,o=e.position,c=r,s=c.x,m=c.y,v=c.width,w=c.height,M=w>=0?1:-1,I=M*i,k=M>0?"end":"start",z=M>0?"start":"end",V=v>=0?1:-1,U=V*i,K=V>0?"end":"start",J=V>0?"start":"end";if(o==="top"){var Z={x:s+v/2,y:m-M*i,textAnchor:"middle",verticalAnchor:k};return Ia(Ia({},Z),n?{height:Math.max(m-n.y,0),width:v}:{})}if(o==="bottom"){var re={x:s+v/2,y:m+w+I,textAnchor:"middle",verticalAnchor:z};return Ia(Ia({},re),n?{height:Math.max(n.y+n.height-(m+w),0),width:v}:{})}if(o==="left"){var W={x:s-U,y:m+w/2,textAnchor:K,verticalAnchor:"middle"};return Ia(Ia({},W),n?{width:Math.max(W.x-n.x,0),height:w}:{})}if(o==="right"){var Y={x:s+v+U,y:m+w/2,textAnchor:J,verticalAnchor:"middle"};return Ia(Ia({},Y),n?{width:Math.max(n.x+n.width-Y.x,0),height:w}:{})}var ue=n?{width:v,height:w}:{};return o==="insideLeft"?Ia({x:s+U,y:m+w/2,textAnchor:J,verticalAnchor:"middle"},ue):o==="insideRight"?Ia({x:s+v-U,y:m+w/2,textAnchor:K,verticalAnchor:"middle"},ue):o==="insideTop"?Ia({x:s+v/2,y:m+I,textAnchor:"middle",verticalAnchor:z},ue):o==="insideBottom"?Ia({x:s+v/2,y:m+w-I,textAnchor:"middle",verticalAnchor:k},ue):o==="insideTopLeft"?Ia({x:s+U,y:m+I,textAnchor:J,verticalAnchor:z},ue):o==="insideTopRight"?Ia({x:s+v-U,y:m+I,textAnchor:K,verticalAnchor:z},ue):o==="insideBottomLeft"?Ia({x:s+U,y:m+w-I,textAnchor:J,verticalAnchor:k},ue):o==="insideBottomRight"?Ia({x:s+v-U,y:m+w-I,textAnchor:K,verticalAnchor:k},ue):p_(o)&&(nr(o.x)||Dp(o.x))&&(nr(o.y)||Dp(o.y))?Ia({x:s+Gp(o.x,v),y:m+Gp(o.y,w),textAnchor:"end",verticalAnchor:"end"},ue):Ia({x:s+v/2,y:m+w/2,textAnchor:"middle",verticalAnchor:"middle"},ue)},Mse=function(e){return"cx"in e&&nr(e.cx)};function Rs(t){var e=t.offset,r=e===void 0?5:e,n=_se(t,hse),i=Ia({offset:r},n),o=i.viewBox,c=i.position,s=i.value,m=i.children,v=i.content,w=i.className,M=w===void 0?"":w,I=i.textBreakAll;if(!o||tn(s)&&tn(m)&&!it.isValidElement(v)&&!Xr(v))return null;if(it.isValidElement(v))return it.cloneElement(v,i);var k;if(Xr(v)){if(k=it.createElement(v,i),it.isValidElement(k))return k}else k=wse(i);var z=Mse(o),V=an(i,!0);if(z&&(c==="insideStart"||c==="insideEnd"||c==="end"))return Sse(i,k,V);var U=z?Ase(i):Ese(i);return He.createElement(cx,vv({className:pn("recharts-label",M)},V,U,{breakAll:I}),k)}Rs.displayName="Label";var xj=function(e){var r=e.cx,n=e.cy,i=e.angle,o=e.startAngle,c=e.endAngle,s=e.r,m=e.radius,v=e.innerRadius,w=e.outerRadius,M=e.x,I=e.y,k=e.top,z=e.left,V=e.width,U=e.height,K=e.clockWise,J=e.labelViewBox;if(J)return J;if(nr(V)&&nr(U)){if(nr(M)&&nr(I))return{x:M,y:I,width:V,height:U};if(nr(k)&&nr(z))return{x:k,y:z,width:V,height:U}}return nr(M)&&nr(I)?{x:M,y:I,width:0,height:0}:nr(r)&&nr(n)?{cx:r,cy:n,startAngle:o||i||0,endAngle:c||i||0,innerRadius:v||0,outerRadius:w||m||s||0,clockWise:K}:e.viewBox?e.viewBox:{}},Pse=function(e,r){return e?e===!0?He.createElement(Rs,{key:"label-implicit",viewBox:r}):Da(e)?He.createElement(Rs,{key:"label-implicit",viewBox:r,value:e}):it.isValidElement(e)?e.type===Rs?it.cloneElement(e,{key:"label-implicit",viewBox:r}):He.createElement(Rs,{key:"label-implicit",content:e,viewBox:r}):Xr(e)?He.createElement(Rs,{key:"label-implicit",content:e,viewBox:r}):p_(e)?He.createElement(Rs,vv({viewBox:r},e,{key:"label-implicit"})):null:null},Cse=function(e,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&n&&!e.label)return null;var i=e.children,o=xj(e),c=Hl(i,Rs).map(function(m,v){return it.cloneElement(m,{viewBox:r||o,key:"label-".concat(v)})});if(!n)return c;var s=Pse(e.label,r||o);return[s].concat(fse(c))};Rs.parseViewBox=xj;Rs.renderCallByParent=Cse;var fA,Q4;function Rse(){if(Q4)return fA;Q4=1;function t(e){var r=e==null?0:e.length;return r?e[r-1]:void 0}return fA=t,fA}var Ise=Rse();const Ose=Yn(Ise);function bv(t){"@babel/helpers - typeof";return bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bv(t)}var kse=["valueAccessor"],Dse=["data","dataKey","clockWise","id","textBreakAll"];function Nse(t){return zse(t)||Fse(t)||Lse(t)||Bse()}function Bse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lse(t,e){if(t){if(typeof t=="string")return dM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dM(t,e)}}function Fse(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function zse(t){if(Array.isArray(t))return dM(t)}function dM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ax(){return Ax=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Ax.apply(this,arguments)}function J4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function eN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?J4(Object(r),!0).forEach(function(n){jse(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):J4(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function jse(t,e,r){return e=Use(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Use(t){var e=$se(t,"string");return bv(e)=="symbol"?e:e+""}function $se(t,e){if(bv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(bv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function tN(t,e){if(t==null)return{};var r=Vse(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Vse(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}var qse=function(e){return Array.isArray(e.value)?Ose(e.value):e.value};function _d(t){var e=t.valueAccessor,r=e===void 0?qse:e,n=tN(t,kse),i=n.data,o=n.dataKey,c=n.clockWise,s=n.id,m=n.textBreakAll,v=tN(n,Dse);return!i||!i.length?null:He.createElement(ia,{className:"recharts-label-list"},i.map(function(w,M){var I=tn(o)?r(w,M):Jo(w&&w.payload,o),k=tn(s)?{}:{id:"".concat(s,"-").concat(M)};return He.createElement(Rs,Ax({},an(w,!0),v,k,{parentViewBox:w.parentViewBox,value:I,textBreakAll:m,viewBox:Rs.parseViewBox(tn(c)?w:eN(eN({},w),{},{clockWise:c})),key:"label-".concat(M),index:M}))}))}_d.displayName="LabelList";function Hse(t,e){return t?t===!0?He.createElement(_d,{key:"labelList-implicit",data:e}):He.isValidElement(t)||Xr(t)?He.createElement(_d,{key:"labelList-implicit",data:e,content:t}):p_(t)?He.createElement(_d,Ax({data:e},t,{key:"labelList-implicit"})):null:null}function Wse(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&r&&!t.label)return null;var n=t.children,i=Hl(n,_d).map(function(c,s){return it.cloneElement(c,{data:e,key:"labelList-".concat(s)})});if(!r)return i;var o=Hse(t.label,e);return[o].concat(Nse(i))}_d.renderCallByParent=Wse;function xv(t){"@babel/helpers - typeof";return xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xv(t)}function pM(){return pM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},pM.apply(this,arguments)}function rN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function nN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?rN(Object(r),!0).forEach(function(n){Zse(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):rN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Zse(t,e,r){return e=Xse(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Xse(t){var e=Gse(t,"string");return xv(e)=="symbol"?e:e+""}function Gse(t,e){if(xv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(xv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Yse=function(e,r){var n=Hc(r-e),i=Math.min(Math.abs(r-e),359.999);return n*i},u0=function(e){var r=e.cx,n=e.cy,i=e.radius,o=e.angle,c=e.sign,s=e.isExternal,m=e.cornerRadius,v=e.cornerIsExternal,w=m*(s?1:-1)+i,M=Math.asin(m/w)/Sx,I=v?o:o+c*M,k=ps(r,n,w,I),z=ps(r,n,i,I),V=v?o-c*M:o,U=ps(r,n,w*Math.cos(M*Sx),V);return{center:k,circleTangency:z,lineTangency:U,theta:M}},wj=function(e){var r=e.cx,n=e.cy,i=e.innerRadius,o=e.outerRadius,c=e.startAngle,s=e.endAngle,m=Yse(c,s),v=c+m,w=ps(r,n,o,c),M=ps(r,n,o,v),I="M ".concat(w.x,",").concat(w.y,`
    A `).concat(o,",").concat(o,`,0,
    `).concat(+(Math.abs(m)>180),",").concat(+(c>v),`,
    `).concat(M.x,",").concat(M.y,`
  `);if(i>0){var k=ps(r,n,i,c),z=ps(r,n,i,v);I+="L ".concat(z.x,",").concat(z.y,`
            A `).concat(i,",").concat(i,`,0,
            `).concat(+(Math.abs(m)>180),",").concat(+(c<=v),`,
            `).concat(k.x,",").concat(k.y," Z")}else I+="L ".concat(r,",").concat(n," Z");return I},Kse=function(e){var r=e.cx,n=e.cy,i=e.innerRadius,o=e.outerRadius,c=e.cornerRadius,s=e.forceCornerRadius,m=e.cornerIsExternal,v=e.startAngle,w=e.endAngle,M=Hc(w-v),I=u0({cx:r,cy:n,radius:o,angle:v,sign:M,cornerRadius:c,cornerIsExternal:m}),k=I.circleTangency,z=I.lineTangency,V=I.theta,U=u0({cx:r,cy:n,radius:o,angle:w,sign:-M,cornerRadius:c,cornerIsExternal:m}),K=U.circleTangency,J=U.lineTangency,Z=U.theta,re=m?Math.abs(v-w):Math.abs(v-w)-V-Z;if(re<0)return s?"M ".concat(z.x,",").concat(z.y,`
        a`).concat(c,",").concat(c,",0,0,1,").concat(c*2,`,0
        a`).concat(c,",").concat(c,",0,0,1,").concat(-c*2,`,0
      `):wj({cx:r,cy:n,innerRadius:i,outerRadius:o,startAngle:v,endAngle:w});var W="M ".concat(z.x,",").concat(z.y,`
    A`).concat(c,",").concat(c,",0,0,").concat(+(M<0),",").concat(k.x,",").concat(k.y,`
    A`).concat(o,",").concat(o,",0,").concat(+(re>180),",").concat(+(M<0),",").concat(K.x,",").concat(K.y,`
    A`).concat(c,",").concat(c,",0,0,").concat(+(M<0),",").concat(J.x,",").concat(J.y,`
  `);if(i>0){var Y=u0({cx:r,cy:n,radius:i,angle:v,sign:M,isExternal:!0,cornerRadius:c,cornerIsExternal:m}),ue=Y.circleTangency,be=Y.lineTangency,Ce=Y.theta,Ye=u0({cx:r,cy:n,radius:i,angle:w,sign:-M,isExternal:!0,cornerRadius:c,cornerIsExternal:m}),Me=Ye.circleTangency,Ue=Ye.lineTangency,Qe=Ye.theta,Ze=m?Math.abs(v-w):Math.abs(v-w)-Ce-Qe;if(Ze<0&&c===0)return"".concat(W,"L").concat(r,",").concat(n,"Z");W+="L".concat(Ue.x,",").concat(Ue.y,`
      A`).concat(c,",").concat(c,",0,0,").concat(+(M<0),",").concat(Me.x,",").concat(Me.y,`
      A`).concat(i,",").concat(i,",0,").concat(+(Ze>180),",").concat(+(M>0),",").concat(ue.x,",").concat(ue.y,`
      A`).concat(c,",").concat(c,",0,0,").concat(+(M<0),",").concat(be.x,",").concat(be.y,"Z")}else W+="L".concat(r,",").concat(n,"Z");return W},Qse={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Tj=function(e){var r=nN(nN({},Qse),e),n=r.cx,i=r.cy,o=r.innerRadius,c=r.outerRadius,s=r.cornerRadius,m=r.forceCornerRadius,v=r.cornerIsExternal,w=r.startAngle,M=r.endAngle,I=r.className;if(c<o||w===M)return null;var k=pn("recharts-sector",I),z=c-o,V=Gp(s,z,0,!0),U;return V>0&&Math.abs(w-M)<360?U=Kse({cx:n,cy:i,innerRadius:o,outerRadius:c,cornerRadius:Math.min(V,z/2),forceCornerRadius:m,cornerIsExternal:v,startAngle:w,endAngle:M}):U=wj({cx:n,cy:i,innerRadius:o,outerRadius:c,startAngle:w,endAngle:M}),He.createElement("path",pM({},an(r,!0),{className:k,d:U,role:"img"}))};function wv(t){"@babel/helpers - typeof";return wv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wv(t)}function mM(){return mM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},mM.apply(this,arguments)}function iN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function aN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?iN(Object(r),!0).forEach(function(n){Jse(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):iN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Jse(t,e,r){return e=eoe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function eoe(t){var e=toe(t,"string");return wv(e)=="symbol"?e:e+""}function toe(t,e){if(wv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(wv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var sN={curveBasisClosed:xQ,curveBasisOpen:wQ,curveBasis:bQ,curveBumpX:sQ,curveBumpY:oQ,curveLinearClosed:TQ,curveLinear:S1,curveMonotoneX:SQ,curveMonotoneY:AQ,curveNatural:EQ,curveStep:MQ,curveStepAfter:CQ,curveStepBefore:PQ},h0=function(e){return e.x===+e.x&&e.y===+e.y},Sy=function(e){return e.x},Ay=function(e){return e.y},roe=function(e,r){if(Xr(e))return e;var n="curve".concat(w1(e));return(n==="curveMonotone"||n==="curveBump")&&r?sN["".concat(n).concat(r==="vertical"?"Y":"X")]:sN[n]||S1},noe=function(e){var r=e.type,n=r===void 0?"linear":r,i=e.points,o=i===void 0?[]:i,c=e.baseLine,s=e.layout,m=e.connectNulls,v=m===void 0?!1:m,w=roe(n,s),M=v?o.filter(function(V){return h0(V)}):o,I;if(Array.isArray(c)){var k=v?c.filter(function(V){return h0(V)}):c,z=M.map(function(V,U){return aN(aN({},V),{},{base:k[U]})});return s==="vertical"?I=r0().y(Ay).x1(Sy).x0(function(V){return V.base.x}):I=r0().x(Sy).y1(Ay).y0(function(V){return V.base.y}),I.defined(h0).curve(w),I(z)}return s==="vertical"&&nr(c)?I=r0().y(Ay).x1(Sy).x0(c):nr(c)?I=r0().x(Sy).y1(Ay).y0(c):I=M6().x(Sy).y(Ay),I.defined(h0).curve(w),I(M)},gM=function(e){var r=e.className,n=e.points,i=e.path,o=e.pathRef;if((!n||!n.length)&&!i)return null;var c=n&&n.length?noe(e):i;return He.createElement("path",mM({},an(e,!1),K0(e),{className:pn("recharts-curve",r),d:c,ref:o}))},dA={exports:{}},pA,oN;function ioe(){if(oN)return pA;oN=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return pA=t,pA}var mA,lN;function aoe(){if(lN)return mA;lN=1;var t=ioe();function e(){}function r(){}return r.resetWarningCache=e,mA=function(){function n(c,s,m,v,w,M){if(M!==t){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}n.isRequired=n;function i(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:r,resetWarningCache:e};return o.PropTypes=o,o},mA}var cN;function soe(){return cN||(cN=1,dA.exports=aoe()()),dA.exports}var ooe=soe();const Bn=Yn(ooe);var loe=Object.getOwnPropertyNames,coe=Object.getOwnPropertySymbols,uoe=Object.prototype.hasOwnProperty;function uN(t,e){return function(n,i,o){return t(n,i,o)&&e(n,i,o)}}function f0(t){return function(r,n,i){if(!r||!n||typeof r!="object"||typeof n!="object")return t(r,n,i);var o=i.cache,c=o.get(r),s=o.get(n);if(c&&s)return c===n&&s===r;o.set(r,n),o.set(n,r);var m=t(r,n,i);return o.delete(r),o.delete(n),m}}function hN(t){return loe(t).concat(coe(t))}var hoe=Object.hasOwn||function(t,e){return uoe.call(t,e)};function om(t,e){return t===e||!t&&!e&&t!==t&&e!==e}var foe="__v",doe="__o",poe="_owner",fN=Object.getOwnPropertyDescriptor,dN=Object.keys;function moe(t,e,r){var n=t.length;if(e.length!==n)return!1;for(;n-- >0;)if(!r.equals(t[n],e[n],n,n,t,e,r))return!1;return!0}function goe(t,e){return om(t.getTime(),e.getTime())}function _oe(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function yoe(t,e){return t===e}function pN(t,e,r){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var i=new Array(n),o=t.entries(),c,s,m=0;(c=o.next())&&!c.done;){for(var v=e.entries(),w=!1,M=0;(s=v.next())&&!s.done;){if(i[M]){M++;continue}var I=c.value,k=s.value;if(r.equals(I[0],k[0],m,M,t,e,r)&&r.equals(I[1],k[1],I[0],k[0],t,e,r)){w=i[M]=!0;break}M++}if(!w)return!1;m++}return!0}var voe=om;function boe(t,e,r){var n=dN(t),i=n.length;if(dN(e).length!==i)return!1;for(;i-- >0;)if(!Sj(t,e,r,n[i]))return!1;return!0}function Ey(t,e,r){var n=hN(t),i=n.length;if(hN(e).length!==i)return!1;for(var o,c,s;i-- >0;)if(o=n[i],!Sj(t,e,r,o)||(c=fN(t,o),s=fN(e,o),(c||s)&&(!c||!s||c.configurable!==s.configurable||c.enumerable!==s.enumerable||c.writable!==s.writable)))return!1;return!0}function xoe(t,e){return om(t.valueOf(),e.valueOf())}function woe(t,e){return t.source===e.source&&t.flags===e.flags}function mN(t,e,r){var n=t.size;if(n!==e.size)return!1;if(!n)return!0;for(var i=new Array(n),o=t.values(),c,s;(c=o.next())&&!c.done;){for(var m=e.values(),v=!1,w=0;(s=m.next())&&!s.done;){if(!i[w]&&r.equals(c.value,s.value,c.value,s.value,t,e,r)){v=i[w]=!0;break}w++}if(!v)return!1}return!0}function Toe(t,e){var r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(t[r]!==e[r])return!1;return!0}function Soe(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function Sj(t,e,r,n){return(n===poe||n===doe||n===foe)&&(t.$$typeof||e.$$typeof)?!0:hoe(e,n)&&r.equals(t[n],e[n],n,n,t,e,r)}var Aoe="[object Arguments]",Eoe="[object Boolean]",Moe="[object Date]",Poe="[object Error]",Coe="[object Map]",Roe="[object Number]",Ioe="[object Object]",Ooe="[object RegExp]",koe="[object Set]",Doe="[object String]",Noe="[object URL]",Boe=Array.isArray,gN=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,_N=Object.assign,Loe=Object.prototype.toString.call.bind(Object.prototype.toString);function Foe(t){var e=t.areArraysEqual,r=t.areDatesEqual,n=t.areErrorsEqual,i=t.areFunctionsEqual,o=t.areMapsEqual,c=t.areNumbersEqual,s=t.areObjectsEqual,m=t.arePrimitiveWrappersEqual,v=t.areRegExpsEqual,w=t.areSetsEqual,M=t.areTypedArraysEqual,I=t.areUrlsEqual;return function(z,V,U){if(z===V)return!0;if(z==null||V==null)return!1;var K=typeof z;if(K!==typeof V)return!1;if(K!=="object")return K==="number"?c(z,V,U):K==="function"?i(z,V,U):!1;var J=z.constructor;if(J!==V.constructor)return!1;if(J===Object)return s(z,V,U);if(Boe(z))return e(z,V,U);if(gN!=null&&gN(z))return M(z,V,U);if(J===Date)return r(z,V,U);if(J===RegExp)return v(z,V,U);if(J===Map)return o(z,V,U);if(J===Set)return w(z,V,U);var Z=Loe(z);return Z===Moe?r(z,V,U):Z===Ooe?v(z,V,U):Z===Coe?o(z,V,U):Z===koe?w(z,V,U):Z===Ioe?typeof z.then!="function"&&typeof V.then!="function"&&s(z,V,U):Z===Noe?I(z,V,U):Z===Poe?n(z,V,U):Z===Aoe?s(z,V,U):Z===Eoe||Z===Roe||Z===Doe?m(z,V,U):!1}}function zoe(t){var e=t.circular,r=t.createCustomConfig,n=t.strict,i={areArraysEqual:n?Ey:moe,areDatesEqual:goe,areErrorsEqual:_oe,areFunctionsEqual:yoe,areMapsEqual:n?uN(pN,Ey):pN,areNumbersEqual:voe,areObjectsEqual:n?Ey:boe,arePrimitiveWrappersEqual:xoe,areRegExpsEqual:woe,areSetsEqual:n?uN(mN,Ey):mN,areTypedArraysEqual:n?Ey:Toe,areUrlsEqual:Soe};if(r&&(i=_N({},i,r(i))),e){var o=f0(i.areArraysEqual),c=f0(i.areMapsEqual),s=f0(i.areObjectsEqual),m=f0(i.areSetsEqual);i=_N({},i,{areArraysEqual:o,areMapsEqual:c,areObjectsEqual:s,areSetsEqual:m})}return i}function joe(t){return function(e,r,n,i,o,c,s){return t(e,r,s)}}function Uoe(t){var e=t.circular,r=t.comparator,n=t.createState,i=t.equals,o=t.strict;if(n)return function(m,v){var w=n(),M=w.cache,I=M===void 0?e?new WeakMap:void 0:M,k=w.meta;return r(m,v,{cache:I,equals:i,meta:k,strict:o})};if(e)return function(m,v){return r(m,v,{cache:new WeakMap,equals:i,meta:void 0,strict:o})};var c={cache:void 0,equals:i,meta:void 0,strict:o};return function(m,v){return r(m,v,c)}}var $oe=Td();Td({strict:!0});Td({circular:!0});Td({circular:!0,strict:!0});Td({createInternalComparator:function(){return om}});Td({strict:!0,createInternalComparator:function(){return om}});Td({circular:!0,createInternalComparator:function(){return om}});Td({circular:!0,createInternalComparator:function(){return om},strict:!0});function Td(t){t===void 0&&(t={});var e=t.circular,r=e===void 0?!1:e,n=t.createInternalComparator,i=t.createState,o=t.strict,c=o===void 0?!1:o,s=zoe(t),m=Foe(s),v=n?n(m):joe(m);return Uoe({circular:r,comparator:m,createState:i,equals:v,strict:c})}function Voe(t){typeof requestAnimationFrame<"u"&&requestAnimationFrame(t)}function yN(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function i(o){r<0&&(r=o),o-r>e?(t(o),r=-1):Voe(i)};requestAnimationFrame(n)}function _M(t){"@babel/helpers - typeof";return _M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_M(t)}function qoe(t){return Xoe(t)||Zoe(t)||Woe(t)||Hoe()}function Hoe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Woe(t,e){if(t){if(typeof t=="string")return vN(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vN(t,e)}}function vN(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Zoe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Xoe(t){if(Array.isArray(t))return t}function Goe(){var t={},e=function(){return null},r=!1,n=function i(o){if(!r){if(Array.isArray(o)){if(!o.length)return;var c=o,s=qoe(c),m=s[0],v=s.slice(1);if(typeof m=="number"){yN(i.bind(null,v),m);return}i(m),yN(i.bind(null,v));return}_M(o)==="object"&&(t=o,e(t)),typeof o=="function"&&o()}};return{stop:function(){r=!0},start:function(o){r=!1,n(o)},subscribe:function(o){return e=o,function(){e=function(){return null}}}}}function Tv(t){"@babel/helpers - typeof";return Tv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tv(t)}function bN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function xN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bN(Object(r),!0).forEach(function(n){Aj(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Aj(t,e,r){return e=Yoe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Yoe(t){var e=Koe(t,"string");return Tv(e)==="symbol"?e:String(e)}function Koe(t,e){if(Tv(t)!=="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Tv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Qoe=function(e,r){return[Object.keys(e),Object.keys(r)].reduce(function(n,i){return n.filter(function(o){return i.includes(o)})})},Joe=function(e){return e},ele=function(e){return e.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Wy=function(e,r){return Object.keys(r).reduce(function(n,i){return xN(xN({},n),{},Aj({},i,e(i,r[i])))},{})},wN=function(e,r,n){return e.map(function(i){return"".concat(ele(i)," ").concat(r,"ms ").concat(n)}).join(",")};function tle(t,e){return ile(t)||nle(t,e)||Ej(t,e)||rle()}function rle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nle(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function ile(t){if(Array.isArray(t))return t}function ale(t){return lle(t)||ole(t)||Ej(t)||sle()}function sle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ej(t,e){if(t){if(typeof t=="string")return yM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yM(t,e)}}function ole(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function lle(t){if(Array.isArray(t))return yM(t)}function yM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ex=1e-4,Mj=function(e,r){return[0,3*e,3*r-6*e,3*e-3*r+1]},Pj=function(e,r){return e.map(function(n,i){return n*Math.pow(r,i)}).reduce(function(n,i){return n+i})},TN=function(e,r){return function(n){var i=Mj(e,r);return Pj(i,n)}},cle=function(e,r){return function(n){var i=Mj(e,r),o=[].concat(ale(i.map(function(c,s){return c*s}).slice(1)),[0]);return Pj(o,n)}},SN=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0],o=r[1],c=r[2],s=r[3];if(r.length===1)switch(r[0]){case"linear":i=0,o=0,c=1,s=1;break;case"ease":i=.25,o=.1,c=.25,s=1;break;case"ease-in":i=.42,o=0,c=1,s=1;break;case"ease-out":i=.42,o=0,c=.58,s=1;break;case"ease-in-out":i=0,o=0,c=.58,s=1;break;default:{var m=r[0].split("(");if(m[0]==="cubic-bezier"&&m[1].split(")")[0].split(",").length===4){var v=m[1].split(")")[0].split(",").map(function(U){return parseFloat(U)}),w=tle(v,4);i=w[0],o=w[1],c=w[2],s=w[3]}}}var M=TN(i,c),I=TN(o,s),k=cle(i,c),z=function(K){return K>1?1:K<0?0:K},V=function(K){for(var J=K>1?1:K,Z=J,re=0;re<8;++re){var W=M(Z)-J,Y=k(Z);if(Math.abs(W-J)<Ex||Y<Ex)return I(Z);Z=z(Z-W/Y)}return I(Z)};return V.isStepper=!1,V},ule=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.stiff,n=r===void 0?100:r,i=e.damping,o=i===void 0?8:i,c=e.dt,s=c===void 0?17:c,m=function(w,M,I){var k=-(w-M)*n,z=I*o,V=I+(k-z)*s/1e3,U=I*s/1e3+w;return Math.abs(U-M)<Ex&&Math.abs(V)<Ex?[M,0]:[U,V]};return m.isStepper=!0,m.dt=s,m},hle=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var i=r[0];if(typeof i=="string")switch(i){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return SN(i);case"spring":return ule();default:if(i.split("(")[0]==="cubic-bezier")return SN(i)}return typeof i=="function"?i:null};function Sv(t){"@babel/helpers - typeof";return Sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sv(t)}function AN(t){return ple(t)||dle(t)||Cj(t)||fle()}function fle(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dle(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function ple(t){if(Array.isArray(t))return bM(t)}function EN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ds(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?EN(Object(r),!0).forEach(function(n){vM(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):EN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function vM(t,e,r){return e=mle(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mle(t){var e=gle(t,"string");return Sv(e)==="symbol"?e:String(e)}function gle(t,e){if(Sv(t)!=="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Sv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _le(t,e){return ble(t)||vle(t,e)||Cj(t,e)||yle()}function yle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cj(t,e){if(t){if(typeof t=="string")return bM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bM(t,e)}}function bM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function vle(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function ble(t){if(Array.isArray(t))return t}var Mx=function(e,r,n){return e+(r-e)*n},xM=function(e){var r=e.from,n=e.to;return r!==n},xle=function t(e,r,n){var i=Wy(function(o,c){if(xM(c)){var s=e(c.from,c.to,c.velocity),m=_le(s,2),v=m[0],w=m[1];return ds(ds({},c),{},{from:v,velocity:w})}return c},r);return n<1?Wy(function(o,c){return xM(c)?ds(ds({},c),{},{velocity:Mx(c.velocity,i[o].velocity,n),from:Mx(c.from,i[o].from,n)}):c},r):t(e,i,n-1)};const wle=function(t,e,r,n,i){var o=Qoe(t,e),c=o.reduce(function(U,K){return ds(ds({},U),{},vM({},K,[t[K],e[K]]))},{}),s=o.reduce(function(U,K){return ds(ds({},U),{},vM({},K,{from:t[K],velocity:0,to:e[K]}))},{}),m=-1,v,w,M=function(){return null},I=function(){return Wy(function(K,J){return J.from},s)},k=function(){return!Object.values(s).filter(xM).length},z=function(K){v||(v=K);var J=K-v,Z=J/r.dt;s=xle(r,s,Z),i(ds(ds(ds({},t),e),I())),v=K,k()||(m=requestAnimationFrame(M))},V=function(K){w||(w=K);var J=(K-w)/n,Z=Wy(function(W,Y){return Mx.apply(void 0,AN(Y).concat([r(J)]))},c);if(i(ds(ds(ds({},t),e),Z)),J<1)m=requestAnimationFrame(M);else{var re=Wy(function(W,Y){return Mx.apply(void 0,AN(Y).concat([r(1)]))},c);i(ds(ds(ds({},t),e),re))}};return M=r.isStepper?z:V,function(){return requestAnimationFrame(M),function(){cancelAnimationFrame(m)}}};function e_(t){"@babel/helpers - typeof";return e_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e_(t)}var Tle=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function Sle(t,e){if(t==null)return{};var r=Ale(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Ale(t,e){if(t==null)return{};var r={},n=Object.keys(t),i,o;for(o=0;o<n.length;o++)i=n[o],!(e.indexOf(i)>=0)&&(r[i]=t[i]);return r}function gA(t){return Cle(t)||Ple(t)||Mle(t)||Ele()}function Ele(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mle(t,e){if(t){if(typeof t=="string")return wM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wM(t,e)}}function Ple(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Cle(t){if(Array.isArray(t))return wM(t)}function wM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function MN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Nc(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?MN(Object(r),!0).forEach(function(n){Ny(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):MN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ny(t,e,r){return e=Rj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rle(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ile(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rj(n.key),n)}}function Ole(t,e,r){return e&&Ile(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Rj(t){var e=kle(t,"string");return e_(e)==="symbol"?e:String(e)}function kle(t,e){if(e_(t)!=="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(e_(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Dle(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&TM(t,e)}function TM(t,e){return TM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},TM(t,e)}function Nle(t){var e=Ble();return function(){var n=Px(t),i;if(e){var o=Px(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return SM(this,i)}}function SM(t,e){if(e&&(e_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return AM(t)}function AM(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ble(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Px(t){return Px=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Px(t)}var Gh=function(t){Dle(r,t);var e=Nle(r);function r(n,i){var o;Rle(this,r),o=e.call(this,n,i);var c=o.props,s=c.isActive,m=c.attributeName,v=c.from,w=c.to,M=c.steps,I=c.children,k=c.duration;if(o.handleStyleChange=o.handleStyleChange.bind(AM(o)),o.changeStyle=o.changeStyle.bind(AM(o)),!s||k<=0)return o.state={style:{}},typeof I=="function"&&(o.state={style:w}),SM(o);if(M&&M.length)o.state={style:M[0].style};else if(v){if(typeof I=="function")return o.state={style:v},SM(o);o.state={style:m?Ny({},m,v):v}}else o.state={style:{}};return o}return Ole(r,[{key:"componentDidMount",value:function(){var i=this.props,o=i.isActive,c=i.canBegin;this.mounted=!0,!(!o||!c)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(i){var o=this.props,c=o.isActive,s=o.canBegin,m=o.attributeName,v=o.shouldReAnimate,w=o.to,M=o.from,I=this.state.style;if(s){if(!c){var k={style:m?Ny({},m,w):w};this.state&&I&&(m&&I[m]!==w||!m&&I!==w)&&this.setState(k);return}if(!($oe(i.to,w)&&i.canBegin&&i.isActive)){var z=!i.canBegin||!i.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var V=z||v?M:i.to;if(this.state&&I){var U={style:m?Ny({},m,V):V};(m&&I[m]!==V||!m&&I!==V)&&this.setState(U)}this.runAnimation(Nc(Nc({},this.props),{},{from:V,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var i=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),i&&i()}},{key:"handleStyleChange",value:function(i){this.changeStyle(i)}},{key:"changeStyle",value:function(i){this.mounted&&this.setState({style:i})}},{key:"runJSAnimation",value:function(i){var o=this,c=i.from,s=i.to,m=i.duration,v=i.easing,w=i.begin,M=i.onAnimationEnd,I=i.onAnimationStart,k=wle(c,s,hle(v),m,this.changeStyle),z=function(){o.stopJSAnimation=k()};this.manager.start([I,w,z,m,M])}},{key:"runStepAnimation",value:function(i){var o=this,c=i.steps,s=i.begin,m=i.onAnimationStart,v=c[0],w=v.style,M=v.duration,I=M===void 0?0:M,k=function(V,U,K){if(K===0)return V;var J=U.duration,Z=U.easing,re=Z===void 0?"ease":Z,W=U.style,Y=U.properties,ue=U.onAnimationEnd,be=K>0?c[K-1]:U,Ce=Y||Object.keys(W);if(typeof re=="function"||re==="spring")return[].concat(gA(V),[o.runJSAnimation.bind(o,{from:be.style,to:W,duration:J,easing:re}),J]);var Ye=wN(Ce,J,re),Me=Nc(Nc(Nc({},be.style),W),{},{transition:Ye});return[].concat(gA(V),[Me,J,ue]).filter(Joe)};return this.manager.start([m].concat(gA(c.reduce(k,[w,Math.max(I,s)])),[i.onAnimationEnd]))}},{key:"runAnimation",value:function(i){this.manager||(this.manager=Goe());var o=i.begin,c=i.duration,s=i.attributeName,m=i.to,v=i.easing,w=i.onAnimationStart,M=i.onAnimationEnd,I=i.steps,k=i.children,z=this.manager;if(this.unSubscribe=z.subscribe(this.handleStyleChange),typeof v=="function"||typeof k=="function"||v==="spring"){this.runJSAnimation(i);return}if(I.length>1){this.runStepAnimation(i);return}var V=s?Ny({},s,m):m,U=wN(Object.keys(V),c,v);z.start([w,o,Nc(Nc({},V),{},{transition:U}),c,M])}},{key:"render",value:function(){var i=this.props,o=i.children;i.begin;var c=i.duration;i.attributeName,i.easing;var s=i.isActive;i.steps,i.from,i.to,i.canBegin,i.onAnimationEnd,i.shouldReAnimate,i.onAnimationReStart;var m=Sle(i,Tle),v=it.Children.count(o),w=this.state.style;if(typeof o=="function")return o(w);if(!s||v===0||c<=0)return o;var M=function(k){var z=k.props,V=z.style,U=V===void 0?{}:V,K=z.className,J=it.cloneElement(k,Nc(Nc({},m),{},{style:Nc(Nc({},U),w),className:K}));return J};return v===1?M(it.Children.only(o)):He.createElement("div",null,it.Children.map(o,function(I){return M(I)}))}}]),r}(it.PureComponent);Gh.displayName="Animate";Gh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Gh.propTypes={from:Bn.oneOfType([Bn.object,Bn.string]),to:Bn.oneOfType([Bn.object,Bn.string]),attributeName:Bn.string,duration:Bn.number,begin:Bn.number,easing:Bn.oneOfType([Bn.string,Bn.func]),steps:Bn.arrayOf(Bn.shape({duration:Bn.number.isRequired,style:Bn.object.isRequired,easing:Bn.oneOfType([Bn.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Bn.func]),properties:Bn.arrayOf("string"),onAnimationEnd:Bn.func})),children:Bn.oneOfType([Bn.node,Bn.func]),isActive:Bn.bool,canBegin:Bn.bool,onAnimationEnd:Bn.func,shouldReAnimate:Bn.bool,onAnimationStart:Bn.func,onAnimationReStart:Bn.func};function Av(t){"@babel/helpers - typeof";return Av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Av(t)}function Cx(){return Cx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Cx.apply(this,arguments)}function Lle(t,e){return Ule(t)||jle(t,e)||zle(t,e)||Fle()}function Fle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zle(t,e){if(t){if(typeof t=="string")return PN(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PN(t,e)}}function PN(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function jle(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function Ule(t){if(Array.isArray(t))return t}function CN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function RN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?CN(Object(r),!0).forEach(function(n){$le(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function $le(t,e,r){return e=Vle(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Vle(t){var e=qle(t,"string");return Av(e)=="symbol"?e:e+""}function qle(t,e){if(Av(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Av(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var IN=function(e,r,n,i,o){var c=Math.min(Math.abs(n)/2,Math.abs(i)/2),s=i>=0?1:-1,m=n>=0?1:-1,v=i>=0&&n>=0||i<0&&n<0?1:0,w;if(c>0&&o instanceof Array){for(var M=[0,0,0,0],I=0,k=4;I<k;I++)M[I]=o[I]>c?c:o[I];w="M".concat(e,",").concat(r+s*M[0]),M[0]>0&&(w+="A ".concat(M[0],",").concat(M[0],",0,0,").concat(v,",").concat(e+m*M[0],",").concat(r)),w+="L ".concat(e+n-m*M[1],",").concat(r),M[1]>0&&(w+="A ".concat(M[1],",").concat(M[1],",0,0,").concat(v,`,
        `).concat(e+n,",").concat(r+s*M[1])),w+="L ".concat(e+n,",").concat(r+i-s*M[2]),M[2]>0&&(w+="A ".concat(M[2],",").concat(M[2],",0,0,").concat(v,`,
        `).concat(e+n-m*M[2],",").concat(r+i)),w+="L ".concat(e+m*M[3],",").concat(r+i),M[3]>0&&(w+="A ".concat(M[3],",").concat(M[3],",0,0,").concat(v,`,
        `).concat(e,",").concat(r+i-s*M[3])),w+="Z"}else if(c>0&&o===+o&&o>0){var z=Math.min(c,o);w="M ".concat(e,",").concat(r+s*z,`
            A `).concat(z,",").concat(z,",0,0,").concat(v,",").concat(e+m*z,",").concat(r,`
            L `).concat(e+n-m*z,",").concat(r,`
            A `).concat(z,",").concat(z,",0,0,").concat(v,",").concat(e+n,",").concat(r+s*z,`
            L `).concat(e+n,",").concat(r+i-s*z,`
            A `).concat(z,",").concat(z,",0,0,").concat(v,",").concat(e+n-m*z,",").concat(r+i,`
            L `).concat(e+m*z,",").concat(r+i,`
            A `).concat(z,",").concat(z,",0,0,").concat(v,",").concat(e,",").concat(r+i-s*z," Z")}else w="M ".concat(e,",").concat(r," h ").concat(n," v ").concat(i," h ").concat(-n," Z");return w},Hle=function(e,r){if(!e||!r)return!1;var n=e.x,i=e.y,o=r.x,c=r.y,s=r.width,m=r.height;if(Math.abs(s)>0&&Math.abs(m)>0){var v=Math.min(o,o+s),w=Math.max(o,o+s),M=Math.min(c,c+m),I=Math.max(c,c+m);return n>=v&&n<=w&&i>=M&&i<=I}return!1},Wle={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},x3=function(e){var r=RN(RN({},Wle),e),n=it.useRef(),i=it.useState(-1),o=Lle(i,2),c=o[0],s=o[1];it.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var re=n.current.getTotalLength();re&&s(re)}catch{}},[]);var m=r.x,v=r.y,w=r.width,M=r.height,I=r.radius,k=r.className,z=r.animationEasing,V=r.animationDuration,U=r.animationBegin,K=r.isAnimationActive,J=r.isUpdateAnimationActive;if(m!==+m||v!==+v||w!==+w||M!==+M||w===0||M===0)return null;var Z=pn("recharts-rectangle",k);return J?He.createElement(Gh,{canBegin:c>0,from:{width:w,height:M,x:m,y:v},to:{width:w,height:M,x:m,y:v},duration:V,animationEasing:z,isActive:J},function(re){var W=re.width,Y=re.height,ue=re.x,be=re.y;return He.createElement(Gh,{canBegin:c>0,from:"0px ".concat(c===-1?1:c,"px"),to:"".concat(c,"px 0px"),attributeName:"strokeDasharray",begin:U,duration:V,isActive:K,easing:z},He.createElement("path",Cx({},an(r,!0),{className:Z,d:IN(ue,be,W,Y,I),ref:n})))}):He.createElement("path",Cx({},an(r,!0),{className:Z,d:IN(m,v,w,M,I)}))};function EM(){return EM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},EM.apply(this,arguments)}var w3=function(e){var r=e.cx,n=e.cy,i=e.r,o=e.className,c=pn("recharts-dot",o);return r===+r&&n===+n&&i===+i?He.createElement("circle",EM({},an(e,!1),K0(e),{className:c,cx:r,cy:n,r:i})):null};function Ev(t){"@babel/helpers - typeof";return Ev=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ev(t)}var Zle=["x","y","top","left","width","height","className"];function MM(){return MM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},MM.apply(this,arguments)}function ON(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Xle(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ON(Object(r),!0).forEach(function(n){Gle(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ON(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Gle(t,e,r){return e=Yle(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Yle(t){var e=Kle(t,"string");return Ev(e)=="symbol"?e:e+""}function Kle(t,e){if(Ev(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Ev(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Qle(t,e){if(t==null)return{};var r=Jle(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Jle(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}var ece=function(e,r,n,i,o,c){return"M".concat(e,",").concat(o,"v").concat(i,"M").concat(c,",").concat(r,"h").concat(n)},tce=function(e){var r=e.x,n=r===void 0?0:r,i=e.y,o=i===void 0?0:i,c=e.top,s=c===void 0?0:c,m=e.left,v=m===void 0?0:m,w=e.width,M=w===void 0?0:w,I=e.height,k=I===void 0?0:I,z=e.className,V=Qle(e,Zle),U=Xle({x:n,y:o,top:s,left:v,width:M,height:k},V);return!nr(n)||!nr(o)||!nr(M)||!nr(k)||!nr(s)||!nr(v)?null:He.createElement("path",MM({},an(U,!0),{className:pn("recharts-cross",z),d:ece(n,o,M,k,s,v)}))},_A,kN;function rce(){if(kN)return _A;kN=1;var t=Y6(),e=t(Object.getPrototypeOf,Object);return _A=e,_A}var yA,DN;function nce(){if(DN)return yA;DN=1;var t=Kh(),e=rce(),r=Qh(),n="[object Object]",i=Function.prototype,o=Object.prototype,c=i.toString,s=o.hasOwnProperty,m=c.call(Object);function v(w){if(!r(w)||t(w)!=n)return!1;var M=e(w);if(M===null)return!0;var I=s.call(M,"constructor")&&M.constructor;return typeof I=="function"&&I instanceof I&&c.call(I)==m}return yA=v,yA}var ice=nce();const ace=Yn(ice);var vA,NN;function sce(){if(NN)return vA;NN=1;var t=Kh(),e=Qh(),r="[object Boolean]";function n(i){return i===!0||i===!1||e(i)&&t(i)==r}return vA=n,vA}var oce=sce();const lce=Yn(oce);function Mv(t){"@babel/helpers - typeof";return Mv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mv(t)}function Rx(){return Rx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Rx.apply(this,arguments)}function cce(t,e){return dce(t)||fce(t,e)||hce(t,e)||uce()}function uce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hce(t,e){if(t){if(typeof t=="string")return BN(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return BN(t,e)}}function BN(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function fce(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function dce(t){if(Array.isArray(t))return t}function LN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function FN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?LN(Object(r),!0).forEach(function(n){pce(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):LN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function pce(t,e,r){return e=mce(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function mce(t){var e=gce(t,"string");return Mv(e)=="symbol"?e:e+""}function gce(t,e){if(Mv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Mv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var zN=function(e,r,n,i,o){var c=n-i,s;return s="M ".concat(e,",").concat(r),s+="L ".concat(e+n,",").concat(r),s+="L ".concat(e+n-c/2,",").concat(r+o),s+="L ".concat(e+n-c/2-i,",").concat(r+o),s+="L ".concat(e,",").concat(r," Z"),s},_ce={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},yce=function(e){var r=FN(FN({},_ce),e),n=it.useRef(),i=it.useState(-1),o=cce(i,2),c=o[0],s=o[1];it.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var Z=n.current.getTotalLength();Z&&s(Z)}catch{}},[]);var m=r.x,v=r.y,w=r.upperWidth,M=r.lowerWidth,I=r.height,k=r.className,z=r.animationEasing,V=r.animationDuration,U=r.animationBegin,K=r.isUpdateAnimationActive;if(m!==+m||v!==+v||w!==+w||M!==+M||I!==+I||w===0&&M===0||I===0)return null;var J=pn("recharts-trapezoid",k);return K?He.createElement(Gh,{canBegin:c>0,from:{upperWidth:0,lowerWidth:0,height:I,x:m,y:v},to:{upperWidth:w,lowerWidth:M,height:I,x:m,y:v},duration:V,animationEasing:z,isActive:K},function(Z){var re=Z.upperWidth,W=Z.lowerWidth,Y=Z.height,ue=Z.x,be=Z.y;return He.createElement(Gh,{canBegin:c>0,from:"0px ".concat(c===-1?1:c,"px"),to:"".concat(c,"px 0px"),attributeName:"strokeDasharray",begin:U,duration:V,easing:z},He.createElement("path",Rx({},an(r,!0),{className:J,d:zN(ue,be,re,W,Y),ref:n})))}):He.createElement("g",null,He.createElement("path",Rx({},an(r,!0),{className:J,d:zN(m,v,w,M,I)})))},vce=["option","shapeType","propTransformer","activeClassName","isActive"];function Pv(t){"@babel/helpers - typeof";return Pv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pv(t)}function bce(t,e){if(t==null)return{};var r=xce(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function xce(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function jN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ix(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?jN(Object(r),!0).forEach(function(n){wce(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):jN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function wce(t,e,r){return e=Tce(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Tce(t){var e=Sce(t,"string");return Pv(e)=="symbol"?e:e+""}function Sce(t,e){if(Pv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Pv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ace(t,e){return Ix(Ix({},e),t)}function Ece(t,e){return t==="symbols"}function UN(t){var e=t.shapeType,r=t.elementProps;switch(e){case"rectangle":return He.createElement(x3,r);case"trapezoid":return He.createElement(yce,r);case"sector":return He.createElement(Tj,r);case"symbols":if(Ece(e))return He.createElement(jP,r);break;default:return null}}function Mce(t){return it.isValidElement(t)?t.props:t}function Pce(t){var e=t.option,r=t.shapeType,n=t.propTransformer,i=n===void 0?Ace:n,o=t.activeClassName,c=o===void 0?"recharts-active-shape":o,s=t.isActive,m=bce(t,vce),v;if(it.isValidElement(e))v=it.cloneElement(e,Ix(Ix({},m),Mce(e)));else if(Xr(e))v=e(m);else if(ace(e)&&!lce(e)){var w=i(e,m);v=He.createElement(UN,{shapeType:r,elementProps:w})}else{var M=m;v=He.createElement(UN,{shapeType:r,elementProps:M})}return s?He.createElement(ia,{className:c},v):v}function j1(t,e){return e!=null&&"trapezoids"in t.props}function U1(t,e){return e!=null&&"sectors"in t.props}function Cv(t,e){return e!=null&&"points"in t.props}function Cce(t,e){var r,n,i=t.x===(e==null||(r=e.labelViewBox)===null||r===void 0?void 0:r.x)||t.x===e.x,o=t.y===(e==null||(n=e.labelViewBox)===null||n===void 0?void 0:n.y)||t.y===e.y;return i&&o}function Rce(t,e){var r=t.endAngle===e.endAngle,n=t.startAngle===e.startAngle;return r&&n}function Ice(t,e){var r=t.x===e.x,n=t.y===e.y,i=t.z===e.z;return r&&n&&i}function Oce(t,e){var r;return j1(t,e)?r=Cce:U1(t,e)?r=Rce:Cv(t,e)&&(r=Ice),r}function kce(t,e){var r;return j1(t,e)?r="trapezoids":U1(t,e)?r="sectors":Cv(t,e)&&(r="points"),r}function Dce(t,e){if(j1(t,e)){var r;return(r=e.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(U1(t,e)){var n;return(n=e.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return Cv(t,e)?e.payload:{}}function Nce(t){var e=t.activeTooltipItem,r=t.graphicalItem,n=t.itemData,i=kce(r,e),o=Dce(r,e),c=n.filter(function(m,v){var w=L1(o,m),M=r.props[i].filter(function(z){var V=Oce(r,e);return V(z,e)}),I=r.props[i].indexOf(M[M.length-1]),k=v===I;return w&&k}),s=n.indexOf(c[c.length-1]);return s}var bA,$N;function Bce(){if($N)return bA;$N=1;var t=Math.ceil,e=Math.max;function r(n,i,o,c){for(var s=-1,m=e(t((i-n)/(o||1)),0),v=Array(m);m--;)v[c?m:++s]=n,n+=o;return v}return bA=r,bA}var xA,VN;function Ij(){if(VN)return xA;VN=1;var t=fz(),e=1/0,r=17976931348623157e292;function n(i){if(!i)return i===0?i:0;if(i=t(i),i===e||i===-1/0){var o=i<0?-1:1;return o*r}return i===i?i:0}return xA=n,xA}var wA,qN;function Lce(){if(qN)return wA;qN=1;var t=Bce(),e=P1(),r=Ij();function n(i){return function(o,c,s){return s&&typeof s!="number"&&e(o,c,s)&&(c=s=void 0),o=r(o),c===void 0?(c=o,o=0):c=r(c),s=s===void 0?o<c?1:-1:r(s),t(o,c,s,i)}}return wA=n,wA}var TA,HN;function Fce(){if(HN)return TA;HN=1;var t=Lce(),e=t();return TA=e,TA}var zce=Fce();const Ox=Yn(zce);function Rv(t){"@babel/helpers - typeof";return Rv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rv(t)}function WN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ZN(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?WN(Object(r),!0).forEach(function(n){Oj(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):WN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Oj(t,e,r){return e=jce(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jce(t){var e=Uce(t,"string");return Rv(e)=="symbol"?e:e+""}function Uce(t,e){if(Rv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Rv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $ce=["Webkit","Moz","O","ms"],Vce=function(e,r){var n=e.replace(/(\w)/,function(o){return o.toUpperCase()}),i=$ce.reduce(function(o,c){return ZN(ZN({},o),{},Oj({},c+n,r))},{});return i[e]=r,i};function t_(t){"@babel/helpers - typeof";return t_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t_(t)}function kx(){return kx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},kx.apply(this,arguments)}function XN(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function SA(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?XN(Object(r),!0).forEach(function(n){Xo(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):XN(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function qce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function GN(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dj(n.key),n)}}function Hce(t,e,r){return e&&GN(t.prototype,e),r&&GN(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Wce(t,e,r){return e=Dx(e),Zce(t,kj()?Reflect.construct(e,r||[],Dx(t).constructor):e.apply(t,r))}function Zce(t,e){if(e&&(t_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xce(t)}function Xce(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kj=function(){return!!t})()}function Dx(t){return Dx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Dx(t)}function Gce(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&PM(t,e)}function PM(t,e){return PM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},PM(t,e)}function Xo(t,e,r){return e=Dj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dj(t){var e=Yce(t,"string");return t_(e)=="symbol"?e:e+""}function Yce(t,e){if(t_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(t_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Kce=function(e){var r=e.data,n=e.startIndex,i=e.endIndex,o=e.x,c=e.width,s=e.travellerWidth;if(!r||!r.length)return{};var m=r.length,v=qy().domain(Ox(0,m)).range([o,o+c-s]),w=v.domain().map(function(M){return v(M)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:v(n),endX:v(i),scale:v,scaleValues:w}},YN=function(e){return e.changedTouches&&!!e.changedTouches.length},Qp=function(t){function e(r){var n;return qce(this,e),n=Wce(this,e,[r]),Xo(n,"handleDrag",function(i){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(i):n.state.isSlideMoving&&n.handleSlideDrag(i)}),Xo(n,"handleTouchMove",function(i){i.changedTouches!=null&&i.changedTouches.length>0&&n.handleDrag(i.changedTouches[0])}),Xo(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var i=n.props,o=i.endIndex,c=i.onDragEnd,s=i.startIndex;c==null||c({endIndex:o,startIndex:s})}),n.detachDragEndListener()}),Xo(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Xo(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Xo(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Xo(n,"handleSlideDragStart",function(i){var o=YN(i)?i.changedTouches[0]:i;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:o.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return Gce(e,t),Hce(e,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var i=n.startX,o=n.endX,c=this.state.scaleValues,s=this.props,m=s.gap,v=s.data,w=v.length-1,M=Math.min(i,o),I=Math.max(i,o),k=e.getIndexInRange(c,M),z=e.getIndexInRange(c,I);return{startIndex:k-k%m,endIndex:z===w?w:z-z%m}}},{key:"getTextOfTick",value:function(n){var i=this.props,o=i.data,c=i.tickFormatter,s=i.dataKey,m=Jo(o[n],s,n);return Xr(c)?c(m,n):m}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var i=this.state,o=i.slideMoveStartX,c=i.startX,s=i.endX,m=this.props,v=m.x,w=m.width,M=m.travellerWidth,I=m.startIndex,k=m.endIndex,z=m.onChange,V=n.pageX-o;V>0?V=Math.min(V,v+w-M-s,v+w-M-c):V<0&&(V=Math.max(V,v-c,v-s));var U=this.getIndex({startX:c+V,endX:s+V});(U.startIndex!==I||U.endIndex!==k)&&z&&z(U),this.setState({startX:c+V,endX:s+V,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,i){var o=YN(i)?i.changedTouches[0]:i;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:o.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var i=this.state,o=i.brushMoveStartX,c=i.movingTravellerId,s=i.endX,m=i.startX,v=this.state[c],w=this.props,M=w.x,I=w.width,k=w.travellerWidth,z=w.onChange,V=w.gap,U=w.data,K={startX:this.state.startX,endX:this.state.endX},J=n.pageX-o;J>0?J=Math.min(J,M+I-k-v):J<0&&(J=Math.max(J,M-v)),K[c]=v+J;var Z=this.getIndex(K),re=Z.startIndex,W=Z.endIndex,Y=function(){var be=U.length-1;return c==="startX"&&(s>m?re%V===0:W%V===0)||s<m&&W===be||c==="endX"&&(s>m?W%V===0:re%V===0)||s>m&&W===be};this.setState(Xo(Xo({},c,v+J),"brushMoveStartX",n.pageX),function(){z&&Y()&&z(Z)})}},{key:"handleTravellerMoveKeyboard",value:function(n,i){var o=this,c=this.state,s=c.scaleValues,m=c.startX,v=c.endX,w=this.state[i],M=s.indexOf(w);if(M!==-1){var I=M+n;if(!(I===-1||I>=s.length)){var k=s[I];i==="startX"&&k>=v||i==="endX"&&k<=m||this.setState(Xo({},i,k),function(){o.props.onChange(o.getIndex({startX:o.state.startX,endX:o.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,i=n.x,o=n.y,c=n.width,s=n.height,m=n.fill,v=n.stroke;return He.createElement("rect",{stroke:v,fill:m,x:i,y:o,width:c,height:s})}},{key:"renderPanorama",value:function(){var n=this.props,i=n.x,o=n.y,c=n.width,s=n.height,m=n.data,v=n.children,w=n.padding,M=it.Children.only(v);return M?He.cloneElement(M,{x:i,y:o,width:c,height:s,margin:w,compact:!0,data:m}):null}},{key:"renderTravellerLayer",value:function(n,i){var o,c,s=this,m=this.props,v=m.y,w=m.travellerWidth,M=m.height,I=m.traveller,k=m.ariaLabel,z=m.data,V=m.startIndex,U=m.endIndex,K=Math.max(n,this.props.x),J=SA(SA({},an(this.props,!1)),{},{x:K,y:v,width:w,height:M}),Z=k||"Min value: ".concat((o=z[V])===null||o===void 0?void 0:o.name,", Max value: ").concat((c=z[U])===null||c===void 0?void 0:c.name);return He.createElement(ia,{tabIndex:0,role:"slider","aria-label":Z,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[i],onTouchStart:this.travellerDragStartHandlers[i],onKeyDown:function(W){["ArrowLeft","ArrowRight"].includes(W.key)&&(W.preventDefault(),W.stopPropagation(),s.handleTravellerMoveKeyboard(W.key==="ArrowRight"?1:-1,i))},onFocus:function(){s.setState({isTravellerFocused:!0})},onBlur:function(){s.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},e.renderTraveller(I,J))}},{key:"renderSlide",value:function(n,i){var o=this.props,c=o.y,s=o.height,m=o.stroke,v=o.travellerWidth,w=Math.min(n,i)+v,M=Math.max(Math.abs(i-n)-v,0);return He.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:m,fillOpacity:.2,x:w,y:c,width:M,height:s})}},{key:"renderText",value:function(){var n=this.props,i=n.startIndex,o=n.endIndex,c=n.y,s=n.height,m=n.travellerWidth,v=n.stroke,w=this.state,M=w.startX,I=w.endX,k=5,z={pointerEvents:"none",fill:v};return He.createElement(ia,{className:"recharts-brush-texts"},He.createElement(cx,kx({textAnchor:"end",verticalAnchor:"middle",x:Math.min(M,I)-k,y:c+s/2},z),this.getTextOfTick(i)),He.createElement(cx,kx({textAnchor:"start",verticalAnchor:"middle",x:Math.max(M,I)+m+k,y:c+s/2},z),this.getTextOfTick(o)))}},{key:"render",value:function(){var n=this.props,i=n.data,o=n.className,c=n.children,s=n.x,m=n.y,v=n.width,w=n.height,M=n.alwaysShowText,I=this.state,k=I.startX,z=I.endX,V=I.isTextActive,U=I.isSlideMoving,K=I.isTravellerMoving,J=I.isTravellerFocused;if(!i||!i.length||!nr(s)||!nr(m)||!nr(v)||!nr(w)||v<=0||w<=0)return null;var Z=pn("recharts-brush",o),re=He.Children.count(c)===1,W=Vce("userSelect","none");return He.createElement(ia,{className:Z,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:W},this.renderBackground(),re&&this.renderPanorama(),this.renderSlide(k,z),this.renderTravellerLayer(k,"startX"),this.renderTravellerLayer(z,"endX"),(V||U||K||J||M)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var i=n.x,o=n.y,c=n.width,s=n.height,m=n.stroke,v=Math.floor(o+s/2)-1;return He.createElement(He.Fragment,null,He.createElement("rect",{x:i,y:o,width:c,height:s,fill:m,stroke:"none"}),He.createElement("line",{x1:i+1,y1:v,x2:i+c-1,y2:v,fill:"none",stroke:"#fff"}),He.createElement("line",{x1:i+1,y1:v+2,x2:i+c-1,y2:v+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,i){var o;return He.isValidElement(n)?o=He.cloneElement(n,i):Xr(n)?o=n(i):o=e.renderDefaultTraveller(i),o}},{key:"getDerivedStateFromProps",value:function(n,i){var o=n.data,c=n.width,s=n.x,m=n.travellerWidth,v=n.updateId,w=n.startIndex,M=n.endIndex;if(o!==i.prevData||v!==i.prevUpdateId)return SA({prevData:o,prevTravellerWidth:m,prevUpdateId:v,prevX:s,prevWidth:c},o&&o.length?Kce({data:o,width:c,x:s,travellerWidth:m,startIndex:w,endIndex:M}):{scale:null,scaleValues:null});if(i.scale&&(c!==i.prevWidth||s!==i.prevX||m!==i.prevTravellerWidth)){i.scale.range([s,s+c-m]);var I=i.scale.domain().map(function(k){return i.scale(k)});return{prevData:o,prevTravellerWidth:m,prevUpdateId:v,prevX:s,prevWidth:c,startX:i.scale(n.startIndex),endX:i.scale(n.endIndex),scaleValues:I}}return null}},{key:"getIndexInRange",value:function(n,i){for(var o=n.length,c=0,s=o-1;s-c>1;){var m=Math.floor((c+s)/2);n[m]>i?s=m:c=m}return i>=n[s]?s:c}}])}(it.PureComponent);Xo(Qp,"displayName","Brush");Xo(Qp,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var AA,KN;function Qce(){if(KN)return AA;KN=1;var t=ZP();function e(r,n){var i;return t(r,function(o,c,s){return i=n(o,c,s),!i}),!!i}return AA=e,AA}var EA,QN;function Jce(){if(QN)return EA;QN=1;var t=V6(),e=bd(),r=Qce(),n=go(),i=P1();function o(c,s,m){var v=n(c)?t:r;return m&&i(c,s,m)&&(s=void 0),v(c,e(s,3))}return EA=o,EA}var eue=Jce();const tue=Yn(eue);var Iu=function(e,r){var n=e.alwaysShow,i=e.ifOverflow;return n&&(i="extendDomain"),i===r},MA,JN;function rue(){if(JN)return MA;JN=1;var t=oz();function e(r,n,i){n=="__proto__"&&t?t(r,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):r[n]=i}return MA=e,MA}var PA,eB;function nue(){if(eB)return PA;eB=1;var t=rue(),e=az(),r=bd();function n(i,o){var c={};return o=r(o,3),e(i,function(s,m,v){t(c,m,o(s,m,v))}),c}return PA=n,PA}var iue=nue();const aue=Yn(iue);var CA,tB;function sue(){if(tB)return CA;tB=1;function t(e,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(!r(e[n],n,e))return!1;return!0}return CA=t,CA}var RA,rB;function oue(){if(rB)return RA;rB=1;var t=ZP();function e(r,n){var i=!0;return t(r,function(o,c,s){return i=!!n(o,c,s),i}),i}return RA=e,RA}var IA,nB;function lue(){if(nB)return IA;nB=1;var t=sue(),e=oue(),r=bd(),n=go(),i=P1();function o(c,s,m){var v=n(c)?t:e;return m&&i(c,s,m)&&(s=void 0),v(c,r(s,3))}return IA=o,IA}var cue=lue();const Nj=Yn(cue);var uue=["x","y"];function Iv(t){"@babel/helpers - typeof";return Iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Iv(t)}function CM(){return CM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},CM.apply(this,arguments)}function iB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function My(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?iB(Object(r),!0).forEach(function(n){hue(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):iB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function hue(t,e,r){return e=fue(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fue(t){var e=due(t,"string");return Iv(e)=="symbol"?e:e+""}function due(t,e){if(Iv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Iv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function pue(t,e){if(t==null)return{};var r=mue(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function mue(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function gue(t,e){var r=t.x,n=t.y,i=pue(t,uue),o="".concat(r),c=parseInt(o,10),s="".concat(n),m=parseInt(s,10),v="".concat(e.height||i.height),w=parseInt(v,10),M="".concat(e.width||i.width),I=parseInt(M,10);return My(My(My(My(My({},e),i),c?{x:c}:{}),m?{y:m}:{}),{},{height:w,width:I,name:e.name,radius:e.radius})}function aB(t){return He.createElement(Pce,CM({shapeType:"rectangle",propTransformer:gue,activeClassName:"recharts-active-bar"},t))}var _ue=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,i){if(typeof e=="number")return e;var o=typeof n=="number";return o?e(n,i):(o||Kp(),r)}},yue=["value","background"],Bj;function r_(t){"@babel/helpers - typeof";return r_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r_(t)}function vue(t,e){if(t==null)return{};var r=bue(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function bue(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function Nx(){return Nx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Nx.apply(this,arguments)}function sB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function va(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?sB(Object(r),!0).forEach(function(n){fd(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):sB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function xue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function oB(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fj(n.key),n)}}function wue(t,e,r){return e&&oB(t.prototype,e),r&&oB(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tue(t,e,r){return e=Bx(e),Sue(t,Lj()?Reflect.construct(e,r||[],Bx(t).constructor):e.apply(t,r))}function Sue(t,e){if(e&&(r_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Aue(t)}function Aue(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Lj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lj=function(){return!!t})()}function Bx(t){return Bx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Bx(t)}function Eue(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&RM(t,e)}function RM(t,e){return RM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},RM(t,e)}function fd(t,e,r){return e=Fj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Fj(t){var e=Mue(t,"string");return r_(e)=="symbol"?e:e+""}function Mue(t,e){if(r_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(r_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Jv=function(t){function e(){var r;xue(this,e);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return r=Tue(this,e,[].concat(i)),fd(r,"state",{isAnimationFinished:!1}),fd(r,"id",Wv("recharts-bar-")),fd(r,"handleAnimationEnd",function(){var c=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),c&&c()}),fd(r,"handleAnimationStart",function(){var c=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),c&&c()}),r}return Eue(e,t),wue(e,[{key:"renderRectanglesStatically",value:function(n){var i=this,o=this.props,c=o.shape,s=o.dataKey,m=o.activeIndex,v=o.activeBar,w=an(this.props,!1);return n&&n.map(function(M,I){var k=I===m,z=k?v:c,V=va(va(va({},w),M),{},{isActive:k,option:z,index:I,dataKey:s,onAnimationStart:i.handleAnimationStart,onAnimationEnd:i.handleAnimationEnd});return He.createElement(ia,Nx({className:"recharts-bar-rectangle"},Q0(i.props,M,I),{key:"rectangle-".concat(M==null?void 0:M.x,"-").concat(M==null?void 0:M.y,"-").concat(M==null?void 0:M.value,"-").concat(I)}),He.createElement(aB,V))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,i=this.props,o=i.data,c=i.layout,s=i.isAnimationActive,m=i.animationBegin,v=i.animationDuration,w=i.animationEasing,M=i.animationId,I=this.state.prevData;return He.createElement(Gh,{begin:m,duration:v,isActive:s,easing:w,from:{t:0},to:{t:1},key:"bar-".concat(M),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(k){var z=k.t,V=o.map(function(U,K){var J=I&&I[K];if(J){var Z=Uc(J.x,U.x),re=Uc(J.y,U.y),W=Uc(J.width,U.width),Y=Uc(J.height,U.height);return va(va({},U),{},{x:Z(z),y:re(z),width:W(z),height:Y(z)})}if(c==="horizontal"){var ue=Uc(0,U.height),be=ue(z);return va(va({},U),{},{y:U.y+U.height-be,height:be})}var Ce=Uc(0,U.width),Ye=Ce(z);return va(va({},U),{},{width:Ye})});return He.createElement(ia,null,n.renderRectanglesStatically(V))})}},{key:"renderRectangles",value:function(){var n=this.props,i=n.data,o=n.isAnimationActive,c=this.state.prevData;return o&&i&&i.length&&(!c||!L1(c,i))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(i)}},{key:"renderBackground",value:function(){var n=this,i=this.props,o=i.data,c=i.dataKey,s=i.activeIndex,m=an(this.props.background,!1);return o.map(function(v,w){v.value;var M=v.background,I=vue(v,yue);if(!M)return null;var k=va(va(va(va(va({},I),{},{fill:"#eee"},M),m),Q0(n.props,v,w)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:c,index:w,className:"recharts-bar-background-rectangle"});return He.createElement(aB,Nx({key:"background-bar-".concat(w),option:n.props.background,isActive:w===s},k))})}},{key:"renderErrorBar",value:function(n,i){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,c=o.data,s=o.xAxis,m=o.yAxis,v=o.layout,w=o.children,M=Hl(w,Qv);if(!M)return null;var I=v==="vertical"?c[0].height/2:c[0].width/2,k=function(U,K){var J=Array.isArray(U.value)?U.value[1]:U.value;return{x:U.x,y:U.y,value:J,errorVal:Jo(U,K)}},z={clipPath:n?"url(#clipPath-".concat(i,")"):null};return He.createElement(ia,z,M.map(function(V){return He.cloneElement(V,{key:"error-bar-".concat(i,"-").concat(V.props.dataKey),data:c,xAxis:s,yAxis:m,layout:v,offset:I,dataPointFormatter:k})}))}},{key:"render",value:function(){var n=this.props,i=n.hide,o=n.data,c=n.className,s=n.xAxis,m=n.yAxis,v=n.left,w=n.top,M=n.width,I=n.height,k=n.isAnimationActive,z=n.background,V=n.id;if(i||!o||!o.length)return null;var U=this.state.isAnimationFinished,K=pn("recharts-bar",c),J=s&&s.allowDataOverflow,Z=m&&m.allowDataOverflow,re=J||Z,W=tn(V)?this.id:V;return He.createElement(ia,{className:K},J||Z?He.createElement("defs",null,He.createElement("clipPath",{id:"clipPath-".concat(W)},He.createElement("rect",{x:J?v:v-M/2,y:Z?w:w-I/2,width:J?M:M*2,height:Z?I:I*2}))):null,He.createElement(ia,{className:"recharts-bar-rectangles",clipPath:re?"url(#clipPath-".concat(W,")"):null},z?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(re,W),(!k||U)&&_d.renderCallByParent(this.props,o))}}],[{key:"getDerivedStateFromProps",value:function(n,i){return n.animationId!==i.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:i.curData}:n.data!==i.curData?{curData:n.data}:null}}])}(it.PureComponent);Bj=Jv;fd(Jv,"displayName","Bar");fd(Jv,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!g_.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});fd(Jv,"getComposedData",function(t){var e=t.props,r=t.item,n=t.barPosition,i=t.bandSize,o=t.xAxis,c=t.yAxis,s=t.xAxisTicks,m=t.yAxisTicks,v=t.stackedData,w=t.dataStartIndex,M=t.displayedData,I=t.offset,k=Wae(n,r);if(!k)return null;var z=e.layout,V=r.type.defaultProps,U=V!==void 0?va(va({},V),r.props):r.props,K=U.dataKey,J=U.children,Z=U.minPointSize,re=z==="horizontal"?c:o,W=v?re.scale.domain():null,Y=ese({numericAxis:re}),ue=Hl(J,pz),be=M.map(function(Ce,Ye){var Me,Ue,Qe,Ze,ct,Ie;v?Me=Zae(v[w+Ye],W):(Me=Jo(Ce,K),Array.isArray(Me)||(Me=[Y,Me]));var et=_ue(Z,Bj.defaultProps.minPointSize)(Me[1],Ye);if(z==="horizontal"){var ot,Bt=[c.scale(Me[0]),c.scale(Me[1])],Te=Bt[0],ft=Bt[1];Ue=q4({axis:o,ticks:s,bandSize:i,offset:k.offset,entry:Ce,index:Ye}),Qe=(ot=ft??Te)!==null&&ot!==void 0?ot:void 0,Ze=k.size;var vt=Te-ft;if(ct=Number.isNaN(vt)?0:vt,Ie={x:Ue,y:c.y,width:Ze,height:c.height},Math.abs(et)>0&&Math.abs(ct)<Math.abs(et)){var Ct=Hc(ct||et)*(Math.abs(et)-Math.abs(ct));Qe-=Ct,ct+=Ct}}else{var Yt=[o.scale(Me[0]),o.scale(Me[1])],Ge=Yt[0],Pt=Yt[1];if(Ue=Ge,Qe=q4({axis:c,ticks:m,bandSize:i,offset:k.offset,entry:Ce,index:Ye}),Ze=Pt-Ge,ct=k.size,Ie={x:o.x,y:Qe,width:o.width,height:ct},Math.abs(et)>0&&Math.abs(Ze)<Math.abs(et)){var tr=Hc(Ze||et)*(Math.abs(et)-Math.abs(Ze));Ze+=tr}}return va(va(va({},Ce),{},{x:Ue,y:Qe,width:Ze,height:ct,value:v?Me:Me[1],payload:Ce,background:Ie},ue&&ue[Ye]&&ue[Ye].props),{},{tooltipPayload:[bj(r,Ce)],tooltipPosition:{x:Ue+Ze/2,y:Qe+ct/2}})});return va({data:be,layout:z},I)});function Ov(t){"@babel/helpers - typeof";return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ov(t)}function Pue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lB(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zj(n.key),n)}}function Cue(t,e,r){return e&&lB(t.prototype,e),r&&lB(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function cB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function zc(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cB(Object(r),!0).forEach(function(n){$1(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function $1(t,e,r){return e=zj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function zj(t){var e=Rue(t,"string");return Ov(e)=="symbol"?e:e+""}function Rue(t,e){if(Ov(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Ov(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Iue=function(e,r,n,i,o){var c=e.width,s=e.height,m=e.layout,v=e.children,w=Object.keys(r),M={left:n.left,leftMirror:n.left,right:c-n.right,rightMirror:c-n.right,top:n.top,topMirror:n.top,bottom:s-n.bottom,bottomMirror:s-n.bottom},I=!!Go(v,Jv);return w.reduce(function(k,z){var V=r[z],U=V.orientation,K=V.domain,J=V.padding,Z=J===void 0?{}:J,re=V.mirror,W=V.reversed,Y="".concat(U).concat(re?"Mirror":""),ue,be,Ce,Ye,Me;if(V.type==="number"&&(V.padding==="gap"||V.padding==="no-gap")){var Ue=K[1]-K[0],Qe=1/0,Ze=V.categoricalDomain.sort(RK);if(Ze.forEach(function(Yt,Ge){Ge>0&&(Qe=Math.min((Yt||0)-(Ze[Ge-1]||0),Qe))}),Number.isFinite(Qe)){var ct=Qe/Ue,Ie=V.layout==="vertical"?n.height:n.width;if(V.padding==="gap"&&(ue=ct*Ie/2),V.padding==="no-gap"){var et=Gp(e.barCategoryGap,ct*Ie),ot=ct*Ie/2;ue=ot-et-(ot-et)/Ie*et}}}i==="xAxis"?be=[n.left+(Z.left||0)+(ue||0),n.left+n.width-(Z.right||0)-(ue||0)]:i==="yAxis"?be=m==="horizontal"?[n.top+n.height-(Z.bottom||0),n.top+(Z.top||0)]:[n.top+(Z.top||0)+(ue||0),n.top+n.height-(Z.bottom||0)-(ue||0)]:be=V.range,W&&(be=[be[1],be[0]]);var Bt=qae(V,o,I),Te=Bt.scale,ft=Bt.realScaleType;Te.domain(K).range(be),Hae(Te);var vt=Jae(Te,zc(zc({},V),{},{realScaleType:ft}));i==="xAxis"?(Me=U==="top"&&!re||U==="bottom"&&re,Ce=n.left,Ye=M[Y]-Me*V.height):i==="yAxis"&&(Me=U==="left"&&!re||U==="right"&&re,Ce=M[Y]-Me*V.width,Ye=n.top);var Ct=zc(zc(zc({},V),vt),{},{realScaleType:ft,x:Ce,y:Ye,scale:Te,width:i==="xAxis"?n.width:V.width,height:i==="yAxis"?n.height:V.height});return Ct.bandSize=Tx(Ct,vt),!V.hide&&i==="xAxis"?M[Y]+=(Me?-1:1)*Ct.height:V.hide||(M[Y]+=(Me?-1:1)*Ct.width),zc(zc({},k),{},$1({},z,Ct))},{})},jj=function(e,r){var n=e.x,i=e.y,o=r.x,c=r.y;return{x:Math.min(n,o),y:Math.min(i,c),width:Math.abs(o-n),height:Math.abs(c-i)}},Oue=function(e){var r=e.x1,n=e.y1,i=e.x2,o=e.y2;return jj({x:r,y:n},{x:i,y:o})},Uj=function(){function t(e){Pue(this,t),this.scale=e}return Cue(t,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.bandAware,o=n.position;if(r!==void 0){if(o)switch(o){case"start":return this.scale(r);case"middle":{var c=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+c}case"end":{var s=this.bandwidth?this.bandwidth():0;return this.scale(r)+s}default:return this.scale(r)}if(i){var m=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+m}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),i=n[0],o=n[n.length-1];return i<=o?r>=i&&r<=o:r>=o&&r<=i}}],[{key:"create",value:function(r){return new t(r)}}])}();$1(Uj,"EPS",1e-4);var T3=function(e){var r=Object.keys(e).reduce(function(n,i){return zc(zc({},n),{},$1({},i,Uj.create(e[i])))},{});return zc(zc({},r),{},{apply:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=o.bandAware,s=o.position;return aue(i,function(m,v){return r[v].apply(m,{bandAware:c,position:s})})},isInRange:function(i){return Nj(i,function(o,c){return r[c].isInRange(o)})}})};function kue(t){return(t%180+180)%180}var Due=function(e){var r=e.width,n=e.height,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=kue(i),c=o*Math.PI/180,s=Math.atan(n/r),m=c>s&&c<Math.PI-s?n/Math.sin(c):r/Math.cos(c);return Math.abs(m)},OA,uB;function Nue(){if(uB)return OA;uB=1;var t=bd(),e=Zv(),r=E1();function n(i){return function(o,c,s){var m=Object(o);if(!e(o)){var v=t(c,3);o=r(o),c=function(M){return v(m[M],M,m)}}var w=i(o,c,s);return w>-1?m[v?o[w]:w]:void 0}}return OA=n,OA}var kA,hB;function Bue(){if(hB)return kA;hB=1;var t=Ij();function e(r){var n=t(r),i=n%1;return n===n?i?n-i:n:0}return kA=e,kA}var DA,fB;function Lue(){if(fB)return DA;fB=1;var t=ez(),e=bd(),r=Bue(),n=Math.max;function i(o,c,s){var m=o==null?0:o.length;if(!m)return-1;var v=s==null?0:r(s);return v<0&&(v=n(m+v,0)),t(o,e(c,3),v)}return DA=i,DA}var NA,dB;function Fue(){if(dB)return NA;dB=1;var t=Nue(),e=Lue(),r=t(e);return NA=r,NA}var zue=Fue();const jue=Yn(zue);var Uue=g6();const $ue=Yn(Uue);var Vue=$ue(function(t){return{x:t.left,y:t.top,width:t.width,height:t.height}},function(t){return["l",t.left,"t",t.top,"w",t.width,"h",t.height].join("")}),S3=it.createContext(void 0),A3=it.createContext(void 0),$j=it.createContext(void 0),Vj=it.createContext({}),qj=it.createContext(void 0),Hj=it.createContext(0),Wj=it.createContext(0),pB=function(e){var r=e.state,n=r.xAxisMap,i=r.yAxisMap,o=r.offset,c=e.clipPathId,s=e.children,m=e.width,v=e.height,w=Vue(o);return He.createElement(S3.Provider,{value:n},He.createElement(A3.Provider,{value:i},He.createElement(Vj.Provider,{value:o},He.createElement($j.Provider,{value:w},He.createElement(qj.Provider,{value:c},He.createElement(Hj.Provider,{value:v},He.createElement(Wj.Provider,{value:m},s)))))))},que=function(){return it.useContext(qj)},Zj=function(e){var r=it.useContext(S3);r==null&&Kp();var n=r[e];return n==null&&Kp(),n},Hue=function(){var e=it.useContext(S3);return ld(e)},Wue=function(){var e=it.useContext(A3),r=jue(e,function(n){return Nj(n.domain,Number.isFinite)});return r||ld(e)},Xj=function(e){var r=it.useContext(A3);r==null&&Kp();var n=r[e];return n==null&&Kp(),n},Zue=function(){var e=it.useContext($j);return e},Xue=function(){return it.useContext(Vj)},E3=function(){return it.useContext(Wj)},M3=function(){return it.useContext(Hj)};function n_(t){"@babel/helpers - typeof";return n_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n_(t)}function Gue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Yue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Yj(n.key),n)}}function Kue(t,e,r){return e&&Yue(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Que(t,e,r){return e=Lx(e),Jue(t,Gj()?Reflect.construct(e,r||[],Lx(t).constructor):e.apply(t,r))}function Jue(t,e){if(e&&(n_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ehe(t)}function ehe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Gj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Gj=function(){return!!t})()}function Lx(t){return Lx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Lx(t)}function the(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&IM(t,e)}function IM(t,e){return IM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},IM(t,e)}function mB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function gB(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?mB(Object(r),!0).forEach(function(n){P3(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):mB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function P3(t,e,r){return e=Yj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Yj(t){var e=rhe(t,"string");return n_(e)=="symbol"?e:e+""}function rhe(t,e){if(n_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(n_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function nhe(t,e){return ohe(t)||she(t,e)||ahe(t,e)||ihe()}function ihe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ahe(t,e){if(t){if(typeof t=="string")return _B(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _B(t,e)}}function _B(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function she(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function ohe(t){if(Array.isArray(t))return t}function OM(){return OM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},OM.apply(this,arguments)}var lhe=function(e,r){var n;return He.isValidElement(e)?n=He.cloneElement(e,r):Xr(e)?n=e(r):n=He.createElement("line",OM({},r,{className:"recharts-reference-line-line"})),n},che=function(e,r,n,i,o,c,s,m,v){var w=o.x,M=o.y,I=o.width,k=o.height;if(n){var z=v.y,V=e.y.apply(z,{position:c});if(Iu(v,"discard")&&!e.y.isInRange(V))return null;var U=[{x:w+I,y:V},{x:w,y:V}];return m==="left"?U.reverse():U}if(r){var K=v.x,J=e.x.apply(K,{position:c});if(Iu(v,"discard")&&!e.x.isInRange(J))return null;var Z=[{x:J,y:M+k},{x:J,y:M}];return s==="top"?Z.reverse():Z}if(i){var re=v.segment,W=re.map(function(Y){return e.apply(Y,{position:c})});return Iu(v,"discard")&&tue(W,function(Y){return!e.isInRange(Y)})?null:W}return null};function uhe(t){var e=t.x,r=t.y,n=t.segment,i=t.xAxisId,o=t.yAxisId,c=t.shape,s=t.className,m=t.alwaysShow,v=que(),w=Zj(i),M=Xj(o),I=Zue();if(!v||!I)return null;Vh(m===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var k=T3({x:w.scale,y:M.scale}),z=Da(e),V=Da(r),U=n&&n.length===2,K=che(k,z,V,U,I,t.position,w.orientation,M.orientation,t);if(!K)return null;var J=nhe(K,2),Z=J[0],re=Z.x,W=Z.y,Y=J[1],ue=Y.x,be=Y.y,Ce=Iu(t,"hidden")?"url(#".concat(v,")"):void 0,Ye=gB(gB({clipPath:Ce},an(t,!0)),{},{x1:re,y1:W,x2:ue,y2:be});return He.createElement(ia,{className:pn("recharts-reference-line",s)},lhe(c,Ye),Rs.renderCallByParent(t,Oue({x1:re,y1:W,x2:ue,y2:be})))}var C3=function(t){function e(){return Gue(this,e),Que(this,e,arguments)}return the(e,t),Kue(e,[{key:"render",value:function(){return He.createElement(uhe,this.props)}}])}(He.Component);P3(C3,"displayName","ReferenceLine");P3(C3,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function kM(){return kM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},kM.apply(this,arguments)}function i_(t){"@babel/helpers - typeof";return i_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i_(t)}function yB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function vB(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?yB(Object(r),!0).forEach(function(n){V1(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function hhe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fhe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qj(n.key),n)}}function dhe(t,e,r){return e&&fhe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function phe(t,e,r){return e=Fx(e),mhe(t,Kj()?Reflect.construct(e,r||[],Fx(t).constructor):e.apply(t,r))}function mhe(t,e){if(e&&(i_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ghe(t)}function ghe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Kj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Kj=function(){return!!t})()}function Fx(t){return Fx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Fx(t)}function _he(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&DM(t,e)}function DM(t,e){return DM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},DM(t,e)}function V1(t,e,r){return e=Qj(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qj(t){var e=yhe(t,"string");return i_(e)=="symbol"?e:e+""}function yhe(t,e){if(i_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(i_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var vhe=function(e){var r=e.x,n=e.y,i=e.xAxis,o=e.yAxis,c=T3({x:i.scale,y:o.scale}),s=c.apply({x:r,y:n},{bandAware:!0});return Iu(e,"discard")&&!c.isInRange(s)?null:s},q1=function(t){function e(){return hhe(this,e),phe(this,e,arguments)}return _he(e,t),dhe(e,[{key:"render",value:function(){var n=this.props,i=n.x,o=n.y,c=n.r,s=n.alwaysShow,m=n.clipPathId,v=Da(i),w=Da(o);if(Vh(s===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!v||!w)return null;var M=vhe(this.props);if(!M)return null;var I=M.x,k=M.y,z=this.props,V=z.shape,U=z.className,K=Iu(this.props,"hidden")?"url(#".concat(m,")"):void 0,J=vB(vB({clipPath:K},an(this.props,!0)),{},{cx:I,cy:k});return He.createElement(ia,{className:pn("recharts-reference-dot",U)},e.renderDot(V,J),Rs.renderCallByParent(this.props,{x:I-c,y:k-c,width:2*c,height:2*c}))}}])}(He.Component);V1(q1,"displayName","ReferenceDot");V1(q1,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});V1(q1,"renderDot",function(t,e){var r;return He.isValidElement(t)?r=He.cloneElement(t,e):Xr(t)?r=t(e):r=He.createElement(w3,kM({},e,{cx:e.cx,cy:e.cy,className:"recharts-reference-dot-dot"})),r});function NM(){return NM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},NM.apply(this,arguments)}function a_(t){"@babel/helpers - typeof";return a_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a_(t)}function bB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function xB(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?bB(Object(r),!0).forEach(function(n){H1(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function bhe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xhe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,eU(n.key),n)}}function whe(t,e,r){return e&&xhe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function The(t,e,r){return e=zx(e),She(t,Jj()?Reflect.construct(e,r||[],zx(t).constructor):e.apply(t,r))}function She(t,e){if(e&&(a_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ahe(t)}function Ahe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jj(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Jj=function(){return!!t})()}function zx(t){return zx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zx(t)}function Ehe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&BM(t,e)}function BM(t,e){return BM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},BM(t,e)}function H1(t,e,r){return e=eU(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function eU(t){var e=Mhe(t,"string");return a_(e)=="symbol"?e:e+""}function Mhe(t,e){if(a_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(a_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Phe=function(e,r,n,i,o){var c=o.x1,s=o.x2,m=o.y1,v=o.y2,w=o.xAxis,M=o.yAxis;if(!w||!M)return null;var I=T3({x:w.scale,y:M.scale}),k={x:e?I.x.apply(c,{position:"start"}):I.x.rangeMin,y:n?I.y.apply(m,{position:"start"}):I.y.rangeMin},z={x:r?I.x.apply(s,{position:"end"}):I.x.rangeMax,y:i?I.y.apply(v,{position:"end"}):I.y.rangeMax};return Iu(o,"discard")&&(!I.isInRange(k)||!I.isInRange(z))?null:jj(k,z)},eb=function(t){function e(){return bhe(this,e),The(this,e,arguments)}return Ehe(e,t),whe(e,[{key:"render",value:function(){var n=this.props,i=n.x1,o=n.x2,c=n.y1,s=n.y2,m=n.className,v=n.alwaysShow,w=n.clipPathId;Vh(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var M=Da(i),I=Da(o),k=Da(c),z=Da(s),V=this.props.shape;if(!M&&!I&&!k&&!z&&!V)return null;var U=Phe(M,I,k,z,this.props);if(!U&&!V)return null;var K=Iu(this.props,"hidden")?"url(#".concat(w,")"):void 0;return He.createElement(ia,{className:pn("recharts-reference-area",m)},e.renderRect(V,xB(xB({clipPath:K},an(this.props,!0)),U)),Rs.renderCallByParent(this.props,U))}}])}(He.Component);H1(eb,"displayName","ReferenceArea");H1(eb,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});H1(eb,"renderRect",function(t,e){var r;return He.isValidElement(t)?r=He.cloneElement(t,e):Xr(t)?r=t(e):r=He.createElement(x3,NM({},e,{className:"recharts-reference-area-rect"})),r});function tU(t,e,r){if(e<1)return[];if(e===1&&r===void 0)return t;for(var n=[],i=0;i<t.length;i+=e)n.push(t[i]);return n}function Che(t,e,r){var n={width:t.width+e.width,height:t.height+e.height};return Due(n,r)}function Rhe(t,e,r){var n=r==="width",i=t.x,o=t.y,c=t.width,s=t.height;return e===1?{start:n?i:o,end:n?i+c:o+s}:{start:n?i+c:o+s,end:n?i:o}}function jx(t,e,r,n,i){if(t*e<t*n||t*e>t*i)return!1;var o=r();return t*(e-t*o/2-n)>=0&&t*(e+t*o/2-i)<=0}function Ihe(t,e){return tU(t,e+1)}function Ohe(t,e,r,n,i){for(var o=(n||[]).slice(),c=e.start,s=e.end,m=0,v=1,w=c,M=function(){var z=n==null?void 0:n[m];if(z===void 0)return{v:tU(n,v)};var V=m,U,K=function(){return U===void 0&&(U=r(z,V)),U},J=z.coordinate,Z=m===0||jx(t,J,K,w,s);Z||(m=0,w=c,v+=1),Z&&(w=J+t*(K()/2+i),m+=v)},I;v<=o.length;)if(I=M(),I)return I.v;return[]}function kv(t){"@babel/helpers - typeof";return kv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kv(t)}function wB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Ps(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?wB(Object(r),!0).forEach(function(n){khe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function khe(t,e,r){return e=Dhe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Dhe(t){var e=Nhe(t,"string");return kv(e)=="symbol"?e:e+""}function Nhe(t,e){if(kv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(kv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Bhe(t,e,r,n,i){for(var o=(n||[]).slice(),c=o.length,s=e.start,m=e.end,v=function(I){var k=o[I],z,V=function(){return z===void 0&&(z=r(k,I)),z};if(I===c-1){var U=t*(k.coordinate+t*V()/2-m);o[I]=k=Ps(Ps({},k),{},{tickCoord:U>0?k.coordinate-U*t:k.coordinate})}else o[I]=k=Ps(Ps({},k),{},{tickCoord:k.coordinate});var K=jx(t,k.tickCoord,V,s,m);K&&(m=k.tickCoord-t*(V()/2+i),o[I]=Ps(Ps({},k),{},{isShow:!0}))},w=c-1;w>=0;w--)v(w);return o}function Lhe(t,e,r,n,i,o){var c=(n||[]).slice(),s=c.length,m=e.start,v=e.end;if(o){var w=n[s-1],M=r(w,s-1),I=t*(w.coordinate+t*M/2-v);c[s-1]=w=Ps(Ps({},w),{},{tickCoord:I>0?w.coordinate-I*t:w.coordinate});var k=jx(t,w.tickCoord,function(){return M},m,v);k&&(v=w.tickCoord-t*(M/2+i),c[s-1]=Ps(Ps({},w),{},{isShow:!0}))}for(var z=o?s-1:s,V=function(J){var Z=c[J],re,W=function(){return re===void 0&&(re=r(Z,J)),re};if(J===0){var Y=t*(Z.coordinate-t*W()/2-m);c[J]=Z=Ps(Ps({},Z),{},{tickCoord:Y<0?Z.coordinate-Y*t:Z.coordinate})}else c[J]=Z=Ps(Ps({},Z),{},{tickCoord:Z.coordinate});var ue=jx(t,Z.tickCoord,W,m,v);ue&&(m=Z.tickCoord+t*(W()/2+i),c[J]=Ps(Ps({},Z),{},{isShow:!0}))},U=0;U<z;U++)V(U);return c}function R3(t,e,r){var n=t.tick,i=t.ticks,o=t.viewBox,c=t.minTickGap,s=t.orientation,m=t.interval,v=t.tickFormatter,w=t.unit,M=t.angle;if(!i||!i.length||!n)return[];if(nr(m)||g_.isSsr)return Ihe(i,typeof m=="number"&&nr(m)?m:0);var I=[],k=s==="top"||s==="bottom"?"width":"height",z=w&&k==="width"?Vy(w,{fontSize:e,letterSpacing:r}):{width:0,height:0},V=function(Z,re){var W=Xr(v)?v(Z.value,re):Z.value;return k==="width"?Che(Vy(W,{fontSize:e,letterSpacing:r}),z,M):Vy(W,{fontSize:e,letterSpacing:r})[k]},U=i.length>=2?Hc(i[1].coordinate-i[0].coordinate):1,K=Rhe(o,U,k);return m==="equidistantPreserveStart"?Ohe(U,K,V,i,c):(m==="preserveStart"||m==="preserveStartEnd"?I=Lhe(U,K,V,i,c,m==="preserveStartEnd"):I=Bhe(U,K,V,i,c),I.filter(function(J){return J.isShow}))}var Fhe=["viewBox"],zhe=["viewBox"],jhe=["ticks"];function s_(t){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s_(t)}function Mg(){return Mg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Mg.apply(this,arguments)}function TB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Zs(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?TB(Object(r),!0).forEach(function(n){I3(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):TB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function BA(t,e){if(t==null)return{};var r=Uhe(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function Uhe(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function $he(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function SB(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,nU(n.key),n)}}function Vhe(t,e,r){return e&&SB(t.prototype,e),r&&SB(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function qhe(t,e,r){return e=Ux(e),Hhe(t,rU()?Reflect.construct(e,r||[],Ux(t).constructor):e.apply(t,r))}function Hhe(t,e){if(e&&(s_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Whe(t)}function Whe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function rU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(rU=function(){return!!t})()}function Ux(t){return Ux=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ux(t)}function Zhe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&LM(t,e)}function LM(t,e){return LM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},LM(t,e)}function I3(t,e,r){return e=nU(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nU(t){var e=Xhe(t,"string");return s_(e)=="symbol"?e:e+""}function Xhe(t,e){if(s_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(s_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var b_=function(t){function e(r){var n;return $he(this,e),n=qhe(this,e,[r]),n.state={fontSize:"",letterSpacing:""},n}return Zhe(e,t),Vhe(e,[{key:"shouldComponentUpdate",value:function(n,i){var o=n.viewBox,c=BA(n,Fhe),s=this.props,m=s.viewBox,v=BA(s,zhe);return!Ig(o,m)||!Ig(c,v)||!Ig(i,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var i=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];i&&this.setState({fontSize:window.getComputedStyle(i).fontSize,letterSpacing:window.getComputedStyle(i).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var i=this.props,o=i.x,c=i.y,s=i.width,m=i.height,v=i.orientation,w=i.tickSize,M=i.mirror,I=i.tickMargin,k,z,V,U,K,J,Z=M?-1:1,re=n.tickSize||w,W=nr(n.tickCoord)?n.tickCoord:n.coordinate;switch(v){case"top":k=z=n.coordinate,U=c+ +!M*m,V=U-Z*re,J=V-Z*I,K=W;break;case"left":V=U=n.coordinate,z=o+ +!M*s,k=z-Z*re,K=k-Z*I,J=W;break;case"right":V=U=n.coordinate,z=o+ +M*s,k=z+Z*re,K=k+Z*I,J=W;break;default:k=z=n.coordinate,U=c+ +M*m,V=U+Z*re,J=V+Z*I,K=W;break}return{line:{x1:k,y1:V,x2:z,y2:U},tick:{x:K,y:J}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,i=n.orientation,o=n.mirror,c;switch(i){case"left":c=o?"start":"end";break;case"right":c=o?"end":"start";break;default:c="middle";break}return c}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,i=n.orientation,o=n.mirror,c="end";switch(i){case"left":case"right":c="middle";break;case"top":c=o?"start":"end";break;default:c=o?"end":"start";break}return c}},{key:"renderAxisLine",value:function(){var n=this.props,i=n.x,o=n.y,c=n.width,s=n.height,m=n.orientation,v=n.mirror,w=n.axisLine,M=Zs(Zs(Zs({},an(this.props,!1)),an(w,!1)),{},{fill:"none"});if(m==="top"||m==="bottom"){var I=+(m==="top"&&!v||m==="bottom"&&v);M=Zs(Zs({},M),{},{x1:i,y1:o+I*s,x2:i+c,y2:o+I*s})}else{var k=+(m==="left"&&!v||m==="right"&&v);M=Zs(Zs({},M),{},{x1:i+k*c,y1:o,x2:i+k*c,y2:o+s})}return He.createElement("line",Mg({},M,{className:pn("recharts-cartesian-axis-line",ql(w,"className"))}))}},{key:"renderTicks",value:function(n,i,o){var c=this,s=this.props,m=s.tickLine,v=s.stroke,w=s.tick,M=s.tickFormatter,I=s.unit,k=R3(Zs(Zs({},this.props),{},{ticks:n}),i,o),z=this.getTickTextAnchor(),V=this.getTickVerticalAnchor(),U=an(this.props,!1),K=an(w,!1),J=Zs(Zs({},U),{},{fill:"none"},an(m,!1)),Z=k.map(function(re,W){var Y=c.getTickLineCoord(re),ue=Y.line,be=Y.tick,Ce=Zs(Zs(Zs(Zs({textAnchor:z,verticalAnchor:V},U),{},{stroke:"none",fill:v},K),be),{},{index:W,payload:re,visibleTicksCount:k.length,tickFormatter:M});return He.createElement(ia,Mg({className:"recharts-cartesian-axis-tick",key:"tick-".concat(re.value,"-").concat(re.coordinate,"-").concat(re.tickCoord)},Q0(c.props,re,W)),m&&He.createElement("line",Mg({},J,ue,{className:pn("recharts-cartesian-axis-tick-line",ql(m,"className"))})),w&&e.renderTickItem(w,Ce,"".concat(Xr(M)?M(re.value,W):re.value).concat(I||"")))});return He.createElement("g",{className:"recharts-cartesian-axis-ticks"},Z)}},{key:"render",value:function(){var n=this,i=this.props,o=i.axisLine,c=i.width,s=i.height,m=i.ticksGenerator,v=i.className,w=i.hide;if(w)return null;var M=this.props,I=M.ticks,k=BA(M,jhe),z=I;return Xr(m)&&(z=I&&I.length>0?m(this.props):m(k)),c<=0||s<=0||!z||!z.length?null:He.createElement(ia,{className:pn("recharts-cartesian-axis",v),ref:function(U){n.layerReference=U}},o&&this.renderAxisLine(),this.renderTicks(z,this.state.fontSize,this.state.letterSpacing),Rs.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,i,o){var c;return He.isValidElement(n)?c=He.cloneElement(n,i):Xr(n)?c=n(i):c=He.createElement(cx,Mg({},i,{className:"recharts-cartesian-axis-tick-value"}),o),c}}])}(it.Component);I3(b_,"displayName","CartesianAxis");I3(b_,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Ghe=["x1","y1","x2","y2","key"],Yhe=["offset"];function Jp(t){"@babel/helpers - typeof";return Jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jp(t)}function AB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Is(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?AB(Object(r),!0).forEach(function(n){Khe(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):AB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Khe(t,e,r){return e=Qhe(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qhe(t){var e=Jhe(t,"string");return Jp(e)=="symbol"?e:e+""}function Jhe(t,e){if(Jp(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Jp(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Lp(){return Lp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Lp.apply(this,arguments)}function EB(t,e){if(t==null)return{};var r=efe(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function efe(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}var tfe=function(e){var r=e.fill;if(!r||r==="none")return null;var n=e.fillOpacity,i=e.x,o=e.y,c=e.width,s=e.height,m=e.ry;return He.createElement("rect",{x:i,y:o,ry:m,width:c,height:s,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function iU(t,e){var r;if(He.isValidElement(t))r=He.cloneElement(t,e);else if(Xr(t))r=t(e);else{var n=e.x1,i=e.y1,o=e.x2,c=e.y2,s=e.key,m=EB(e,Ghe),v=an(m,!1);v.offset;var w=EB(v,Yhe);r=He.createElement("line",Lp({},w,{x1:n,y1:i,x2:o,y2:c,fill:"none",key:s}))}return r}function rfe(t){var e=t.x,r=t.width,n=t.horizontal,i=n===void 0?!0:n,o=t.horizontalPoints;if(!i||!o||!o.length)return null;var c=o.map(function(s,m){var v=Is(Is({},t),{},{x1:e,y1:s,x2:e+r,y2:s,key:"line-".concat(m),index:m});return iU(i,v)});return He.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function nfe(t){var e=t.y,r=t.height,n=t.vertical,i=n===void 0?!0:n,o=t.verticalPoints;if(!i||!o||!o.length)return null;var c=o.map(function(s,m){var v=Is(Is({},t),{},{x1:s,y1:e,x2:s,y2:e+r,key:"line-".concat(m),index:m});return iU(i,v)});return He.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function ife(t){var e=t.horizontalFill,r=t.fillOpacity,n=t.x,i=t.y,o=t.width,c=t.height,s=t.horizontalPoints,m=t.horizontal,v=m===void 0?!0:m;if(!v||!e||!e.length)return null;var w=s.map(function(I){return Math.round(I+i-i)}).sort(function(I,k){return I-k});i!==w[0]&&w.unshift(0);var M=w.map(function(I,k){var z=!w[k+1],V=z?i+c-I:w[k+1]-I;if(V<=0)return null;var U=k%e.length;return He.createElement("rect",{key:"react-".concat(k),y:I,x:n,height:V,width:o,stroke:"none",fill:e[U],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return He.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},M)}function afe(t){var e=t.vertical,r=e===void 0?!0:e,n=t.verticalFill,i=t.fillOpacity,o=t.x,c=t.y,s=t.width,m=t.height,v=t.verticalPoints;if(!r||!n||!n.length)return null;var w=v.map(function(I){return Math.round(I+o-o)}).sort(function(I,k){return I-k});o!==w[0]&&w.unshift(0);var M=w.map(function(I,k){var z=!w[k+1],V=z?o+s-I:w[k+1]-I;if(V<=0)return null;var U=k%n.length;return He.createElement("rect",{key:"react-".concat(k),x:I,y:c,width:V,height:m,stroke:"none",fill:n[U],fillOpacity:i,className:"recharts-cartesian-grid-bg"})});return He.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},M)}var sfe=function(e,r){var n=e.xAxis,i=e.width,o=e.height,c=e.offset;return yj(R3(Is(Is(Is({},b_.defaultProps),n),{},{ticks:Uh(n,!0),viewBox:{x:0,y:0,width:i,height:o}})),c.left,c.left+c.width,r)},ofe=function(e,r){var n=e.yAxis,i=e.width,o=e.height,c=e.offset;return yj(R3(Is(Is(Is({},b_.defaultProps),n),{},{ticks:Uh(n,!0),viewBox:{x:0,y:0,width:i,height:o}})),c.top,c.top+c.height,r)},_g={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function FM(t){var e,r,n,i,o,c,s=E3(),m=M3(),v=Xue(),w=Is(Is({},t),{},{stroke:(e=t.stroke)!==null&&e!==void 0?e:_g.stroke,fill:(r=t.fill)!==null&&r!==void 0?r:_g.fill,horizontal:(n=t.horizontal)!==null&&n!==void 0?n:_g.horizontal,horizontalFill:(i=t.horizontalFill)!==null&&i!==void 0?i:_g.horizontalFill,vertical:(o=t.vertical)!==null&&o!==void 0?o:_g.vertical,verticalFill:(c=t.verticalFill)!==null&&c!==void 0?c:_g.verticalFill,x:nr(t.x)?t.x:v.left,y:nr(t.y)?t.y:v.top,width:nr(t.width)?t.width:v.width,height:nr(t.height)?t.height:v.height}),M=w.x,I=w.y,k=w.width,z=w.height,V=w.syncWithTicks,U=w.horizontalValues,K=w.verticalValues,J=Hue(),Z=Wue();if(!nr(k)||k<=0||!nr(z)||z<=0||!nr(M)||M!==+M||!nr(I)||I!==+I)return null;var re=w.verticalCoordinatesGenerator||sfe,W=w.horizontalCoordinatesGenerator||ofe,Y=w.horizontalPoints,ue=w.verticalPoints;if((!Y||!Y.length)&&Xr(W)){var be=U&&U.length,Ce=W({yAxis:Z?Is(Is({},Z),{},{ticks:be?U:Z.ticks}):void 0,width:s,height:m,offset:v},be?!0:V);Vh(Array.isArray(Ce),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Jp(Ce),"]")),Array.isArray(Ce)&&(Y=Ce)}if((!ue||!ue.length)&&Xr(re)){var Ye=K&&K.length,Me=re({xAxis:J?Is(Is({},J),{},{ticks:Ye?K:J.ticks}):void 0,width:s,height:m,offset:v},Ye?!0:V);Vh(Array.isArray(Me),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Jp(Me),"]")),Array.isArray(Me)&&(ue=Me)}return He.createElement("g",{className:"recharts-cartesian-grid"},He.createElement(tfe,{fill:w.fill,fillOpacity:w.fillOpacity,x:w.x,y:w.y,width:w.width,height:w.height,ry:w.ry}),He.createElement(rfe,Lp({},w,{offset:v,horizontalPoints:Y,xAxis:J,yAxis:Z})),He.createElement(nfe,Lp({},w,{offset:v,verticalPoints:ue,xAxis:J,yAxis:Z})),He.createElement(ife,Lp({},w,{horizontalPoints:Y})),He.createElement(afe,Lp({},w,{verticalPoints:ue})))}FM.displayName="CartesianGrid";var lfe=["type","layout","connectNulls","ref"],cfe=["key"];function o_(t){"@babel/helpers - typeof";return o_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o_(t)}function MB(t,e){if(t==null)return{};var r=ufe(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function ufe(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function Zy(){return Zy=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Zy.apply(this,arguments)}function PB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function Zo(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?PB(Object(r),!0).forEach(function(n){jc(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):PB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function yg(t){return pfe(t)||dfe(t)||ffe(t)||hfe()}function hfe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ffe(t,e){if(t){if(typeof t=="string")return zM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zM(t,e)}}function dfe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function pfe(t){if(Array.isArray(t))return zM(t)}function zM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function mfe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function CB(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,sU(n.key),n)}}function gfe(t,e,r){return e&&CB(t.prototype,e),r&&CB(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _fe(t,e,r){return e=$x(e),yfe(t,aU()?Reflect.construct(e,r||[],$x(t).constructor):e.apply(t,r))}function yfe(t,e){if(e&&(o_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vfe(t)}function vfe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function aU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(aU=function(){return!!t})()}function $x(t){return $x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$x(t)}function bfe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jM(t,e)}function jM(t,e){return jM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},jM(t,e)}function jc(t,e,r){return e=sU(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function sU(t){var e=xfe(t,"string");return o_(e)=="symbol"?e:e+""}function xfe(t,e){if(o_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(o_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Fh=function(t){function e(){var r;mfe(this,e);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return r=_fe(this,e,[].concat(i)),jc(r,"state",{isAnimationFinished:!0,totalLength:0}),jc(r,"generateSimpleStrokeDasharray",function(c,s){return"".concat(s,"px ").concat(c-s,"px")}),jc(r,"getStrokeDasharray",function(c,s,m){var v=m.reduce(function(K,J){return K+J});if(!v)return r.generateSimpleStrokeDasharray(s,c);for(var w=Math.floor(c/v),M=c%v,I=s-c,k=[],z=0,V=0;z<m.length;V+=m[z],++z)if(V+m[z]>M){k=[].concat(yg(m.slice(0,z)),[M-V]);break}var U=k.length%2===0?[0,I]:[I];return[].concat(yg(e.repeat(m,w)),yg(k),U).map(function(K){return"".concat(K,"px")}).join(", ")}),jc(r,"id",Wv("recharts-line-")),jc(r,"pathRef",function(c){r.mainCurve=c}),jc(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),jc(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return bfe(e,t),gfe(e,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,i){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var o=this.props,c=o.points,s=o.xAxis,m=o.yAxis,v=o.layout,w=o.children,M=Hl(w,Qv);if(!M)return null;var I=function(V,U){return{x:V.x,y:V.y,value:V.value,errorVal:Jo(V.payload,U)}},k={clipPath:n?"url(#clipPath-".concat(i,")"):null};return He.createElement(ia,k,M.map(function(z){return He.cloneElement(z,{key:"bar-".concat(z.props.dataKey),data:c,xAxis:s,yAxis:m,layout:v,dataPointFormatter:I})}))}},{key:"renderDots",value:function(n,i,o){var c=this.props.isAnimationActive;if(c&&!this.state.isAnimationFinished)return null;var s=this.props,m=s.dot,v=s.points,w=s.dataKey,M=an(this.props,!1),I=an(m,!0),k=v.map(function(V,U){var K=Zo(Zo(Zo({key:"dot-".concat(U),r:3},M),I),{},{index:U,cx:V.x,cy:V.y,value:V.value,dataKey:w,payload:V.payload,points:v});return e.renderDotItem(m,K)}),z={clipPath:n?"url(#clipPath-".concat(i?"":"dots-").concat(o,")"):null};return He.createElement(ia,Zy({className:"recharts-line-dots",key:"dots"},z),k)}},{key:"renderCurveStatically",value:function(n,i,o,c){var s=this.props,m=s.type,v=s.layout,w=s.connectNulls;s.ref;var M=MB(s,lfe),I=Zo(Zo(Zo({},an(M,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:i?"url(#clipPath-".concat(o,")"):null,points:n},c),{},{type:m,layout:v,connectNulls:w});return He.createElement(gM,Zy({},I,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,i){var o=this,c=this.props,s=c.points,m=c.strokeDasharray,v=c.isAnimationActive,w=c.animationBegin,M=c.animationDuration,I=c.animationEasing,k=c.animationId,z=c.animateNewValues,V=c.width,U=c.height,K=this.state,J=K.prevPoints,Z=K.totalLength;return He.createElement(Gh,{begin:w,duration:M,isActive:v,easing:I,from:{t:0},to:{t:1},key:"line-".concat(k),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(re){var W=re.t;if(J){var Y=J.length/s.length,ue=s.map(function(Ue,Qe){var Ze=Math.floor(Qe*Y);if(J[Ze]){var ct=J[Ze],Ie=Uc(ct.x,Ue.x),et=Uc(ct.y,Ue.y);return Zo(Zo({},Ue),{},{x:Ie(W),y:et(W)})}if(z){var ot=Uc(V*2,Ue.x),Bt=Uc(U/2,Ue.y);return Zo(Zo({},Ue),{},{x:ot(W),y:Bt(W)})}return Zo(Zo({},Ue),{},{x:Ue.x,y:Ue.y})});return o.renderCurveStatically(ue,n,i)}var be=Uc(0,Z),Ce=be(W),Ye;if(m){var Me="".concat(m).split(/[,\s]+/gim).map(function(Ue){return parseFloat(Ue)});Ye=o.getStrokeDasharray(Ce,Z,Me)}else Ye=o.generateSimpleStrokeDasharray(Z,Ce);return o.renderCurveStatically(s,n,i,{strokeDasharray:Ye})})}},{key:"renderCurve",value:function(n,i){var o=this.props,c=o.points,s=o.isAnimationActive,m=this.state,v=m.prevPoints,w=m.totalLength;return s&&c&&c.length&&(!v&&w>0||!L1(v,c))?this.renderCurveWithAnimation(n,i):this.renderCurveStatically(c,n,i)}},{key:"render",value:function(){var n,i=this.props,o=i.hide,c=i.dot,s=i.points,m=i.className,v=i.xAxis,w=i.yAxis,M=i.top,I=i.left,k=i.width,z=i.height,V=i.isAnimationActive,U=i.id;if(o||!s||!s.length)return null;var K=this.state.isAnimationFinished,J=s.length===1,Z=pn("recharts-line",m),re=v&&v.allowDataOverflow,W=w&&w.allowDataOverflow,Y=re||W,ue=tn(U)?this.id:U,be=(n=an(c,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},Ce=be.r,Ye=Ce===void 0?3:Ce,Me=be.strokeWidth,Ue=Me===void 0?2:Me,Qe=zK(c)?c:{},Ze=Qe.clipDot,ct=Ze===void 0?!0:Ze,Ie=Ye*2+Ue;return He.createElement(ia,{className:Z},re||W?He.createElement("defs",null,He.createElement("clipPath",{id:"clipPath-".concat(ue)},He.createElement("rect",{x:re?I:I-k/2,y:W?M:M-z/2,width:re?k:k*2,height:W?z:z*2})),!ct&&He.createElement("clipPath",{id:"clipPath-dots-".concat(ue)},He.createElement("rect",{x:I-Ie/2,y:M-Ie/2,width:k+Ie,height:z+Ie}))):null,!J&&this.renderCurve(Y,ue),this.renderErrorBar(Y,ue),(J||c)&&this.renderDots(Y,ct,ue),(!V||K)&&_d.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,i){return n.animationId!==i.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:i.curPoints}:n.points!==i.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,i){for(var o=n.length%2!==0?[].concat(yg(n),[0]):n,c=[],s=0;s<i;++s)c=[].concat(yg(c),yg(o));return c}},{key:"renderDotItem",value:function(n,i){var o;if(He.isValidElement(n))o=He.cloneElement(n,i);else if(Xr(n))o=n(i);else{var c=i.key,s=MB(i,cfe),m=pn("recharts-line-dot",typeof n!="boolean"?n.className:"");o=He.createElement(w3,Zy({key:c},s,{className:m}))}return o}}])}(it.PureComponent);jc(Fh,"displayName","Line");jc(Fh,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!g_.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});jc(Fh,"getComposedData",function(t){var e=t.props,r=t.xAxis,n=t.yAxis,i=t.xAxisTicks,o=t.yAxisTicks,c=t.dataKey,s=t.bandSize,m=t.displayedData,v=t.offset,w=e.layout,M=m.map(function(I,k){var z=Jo(I,c);return w==="horizontal"?{x:V4({axis:r,ticks:i,bandSize:s,entry:I,index:k}),y:tn(z)?null:n.scale(z),value:z,payload:I}:{x:tn(z)?null:r.scale(z),y:V4({axis:n,ticks:o,bandSize:s,entry:I,index:k}),value:z,payload:I}});return Zo({points:M,layout:w},v)});function l_(t){"@babel/helpers - typeof";return l_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l_(t)}function wfe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tfe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,cU(n.key),n)}}function Sfe(t,e,r){return e&&Tfe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Afe(t,e,r){return e=Vx(e),Efe(t,oU()?Reflect.construct(e,r||[],Vx(t).constructor):e.apply(t,r))}function Efe(t,e){if(e&&(l_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Mfe(t)}function Mfe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oU=function(){return!!t})()}function Vx(t){return Vx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vx(t)}function Pfe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&UM(t,e)}function UM(t,e){return UM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},UM(t,e)}function lU(t,e,r){return e=cU(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function cU(t){var e=Cfe(t,"string");return l_(e)=="symbol"?e:e+""}function Cfe(t,e){if(l_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(l_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function $M(){return $M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},$M.apply(this,arguments)}function Rfe(t){var e=t.xAxisId,r=E3(),n=M3(),i=Zj(e);return i==null?null:He.createElement(b_,$M({},i,{className:pn("recharts-".concat(i.axisType," ").concat(i.axisType),i.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(c){return Uh(c,!0)}}))}var Dv=function(t){function e(){return wfe(this,e),Afe(this,e,arguments)}return Pfe(e,t),Sfe(e,[{key:"render",value:function(){return He.createElement(Rfe,this.props)}}])}(He.Component);lU(Dv,"displayName","XAxis");lU(Dv,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function c_(t){"@babel/helpers - typeof";return c_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c_(t)}function Ife(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ofe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,fU(n.key),n)}}function kfe(t,e,r){return e&&Ofe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function Dfe(t,e,r){return e=qx(e),Nfe(t,uU()?Reflect.construct(e,r||[],qx(t).constructor):e.apply(t,r))}function Nfe(t,e){if(e&&(c_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Bfe(t)}function Bfe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uU=function(){return!!t})()}function qx(t){return qx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qx(t)}function Lfe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&VM(t,e)}function VM(t,e){return VM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},VM(t,e)}function hU(t,e,r){return e=fU(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fU(t){var e=Ffe(t,"string");return c_(e)=="symbol"?e:e+""}function Ffe(t,e){if(c_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(c_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function qM(){return qM=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},qM.apply(this,arguments)}var zfe=function(e){var r=e.yAxisId,n=E3(),i=M3(),o=Xj(r);return o==null?null:He.createElement(b_,qM({},o,{className:pn("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:n,height:i},ticksGenerator:function(s){return Uh(s,!0)}}))},Nv=function(t){function e(){return Ife(this,e),Dfe(this,e,arguments)}return Lfe(e,t),kfe(e,[{key:"render",value:function(){return He.createElement(zfe,this.props)}}])}(He.Component);hU(Nv,"displayName","YAxis");hU(Nv,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function RB(t){return Vfe(t)||$fe(t)||Ufe(t)||jfe()}function jfe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ufe(t,e){if(t){if(typeof t=="string")return HM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return HM(t,e)}}function $fe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Vfe(t){if(Array.isArray(t))return HM(t)}function HM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var WM=function(e,r,n,i,o){var c=Hl(e,C3),s=Hl(e,q1),m=[].concat(RB(c),RB(s)),v=Hl(e,eb),w="".concat(i,"Id"),M=i[0],I=r;if(m.length&&(I=m.reduce(function(V,U){if(U.props[w]===n&&Iu(U.props,"extendDomain")&&nr(U.props[M])){var K=U.props[M];return[Math.min(V[0],K),Math.max(V[1],K)]}return V},I)),v.length){var k="".concat(M,"1"),z="".concat(M,"2");I=v.reduce(function(V,U){if(U.props[w]===n&&Iu(U.props,"extendDomain")&&nr(U.props[k])&&nr(U.props[z])){var K=U.props[k],J=U.props[z];return[Math.min(V[0],K,J),Math.max(V[1],K,J)]}return V},I)}return o&&o.length&&(I=o.reduce(function(V,U){return nr(U)?[Math.min(V[0],U),Math.max(V[1],U)]:V},I)),I},LA={exports:{}},IB;function qfe(){return IB||(IB=1,function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(m,v,w){this.fn=m,this.context=v,this.once=w||!1}function o(m,v,w,M,I){if(typeof w!="function")throw new TypeError("The listener must be a function");var k=new i(w,M||m,I),z=r?r+v:v;return m._events[z]?m._events[z].fn?m._events[z]=[m._events[z],k]:m._events[z].push(k):(m._events[z]=k,m._eventsCount++),m}function c(m,v){--m._eventsCount===0?m._events=new n:delete m._events[v]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var v=[],w,M;if(this._eventsCount===0)return v;for(M in w=this._events)e.call(w,M)&&v.push(r?M.slice(1):M);return Object.getOwnPropertySymbols?v.concat(Object.getOwnPropertySymbols(w)):v},s.prototype.listeners=function(v){var w=r?r+v:v,M=this._events[w];if(!M)return[];if(M.fn)return[M.fn];for(var I=0,k=M.length,z=new Array(k);I<k;I++)z[I]=M[I].fn;return z},s.prototype.listenerCount=function(v){var w=r?r+v:v,M=this._events[w];return M?M.fn?1:M.length:0},s.prototype.emit=function(v,w,M,I,k,z){var V=r?r+v:v;if(!this._events[V])return!1;var U=this._events[V],K=arguments.length,J,Z;if(U.fn){switch(U.once&&this.removeListener(v,U.fn,void 0,!0),K){case 1:return U.fn.call(U.context),!0;case 2:return U.fn.call(U.context,w),!0;case 3:return U.fn.call(U.context,w,M),!0;case 4:return U.fn.call(U.context,w,M,I),!0;case 5:return U.fn.call(U.context,w,M,I,k),!0;case 6:return U.fn.call(U.context,w,M,I,k,z),!0}for(Z=1,J=new Array(K-1);Z<K;Z++)J[Z-1]=arguments[Z];U.fn.apply(U.context,J)}else{var re=U.length,W;for(Z=0;Z<re;Z++)switch(U[Z].once&&this.removeListener(v,U[Z].fn,void 0,!0),K){case 1:U[Z].fn.call(U[Z].context);break;case 2:U[Z].fn.call(U[Z].context,w);break;case 3:U[Z].fn.call(U[Z].context,w,M);break;case 4:U[Z].fn.call(U[Z].context,w,M,I);break;default:if(!J)for(W=1,J=new Array(K-1);W<K;W++)J[W-1]=arguments[W];U[Z].fn.apply(U[Z].context,J)}}return!0},s.prototype.on=function(v,w,M){return o(this,v,w,M,!1)},s.prototype.once=function(v,w,M){return o(this,v,w,M,!0)},s.prototype.removeListener=function(v,w,M,I){var k=r?r+v:v;if(!this._events[k])return this;if(!w)return c(this,k),this;var z=this._events[k];if(z.fn)z.fn===w&&(!I||z.once)&&(!M||z.context===M)&&c(this,k);else{for(var V=0,U=[],K=z.length;V<K;V++)(z[V].fn!==w||I&&!z[V].once||M&&z[V].context!==M)&&U.push(z[V]);U.length?this._events[k]=U.length===1?U[0]:U:c(this,k)}return this},s.prototype.removeAllListeners=function(v){var w;return v?(w=r?r+v:v,this._events[w]&&c(this,w)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,t.exports=s}(LA)),LA.exports}var Hfe=qfe();const Wfe=Yn(Hfe);var FA=new Wfe,zA="recharts.syncMouseEvents";function Bv(t){"@babel/helpers - typeof";return Bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bv(t)}function Zfe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Xfe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dU(n.key),n)}}function Gfe(t,e,r){return e&&Xfe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function jA(t,e,r){return e=dU(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function dU(t){var e=Yfe(t,"string");return Bv(e)=="symbol"?e:e+""}function Yfe(t,e){if(Bv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Bv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Kfe=function(){function t(){Zfe(this,t),jA(this,"activeIndex",0),jA(this,"coordinateList",[]),jA(this,"layout","horizontal")}return Gfe(t,[{key:"setDetails",value:function(r){var n,i=r.coordinateList,o=i===void 0?null:i,c=r.container,s=c===void 0?null:c,m=r.layout,v=m===void 0?null:m,w=r.offset,M=w===void 0?null:w,I=r.mouseHandlerCallback,k=I===void 0?null:I;this.coordinateList=(n=o??this.coordinateList)!==null&&n!==void 0?n:[],this.container=s??this.container,this.layout=v??this.layout,this.offset=M??this.offset,this.mouseHandlerCallback=k??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var i=this.container.getBoundingClientRect(),o=i.x,c=i.y,s=i.height,m=this.coordinateList[this.activeIndex].coordinate,v=((r=window)===null||r===void 0?void 0:r.scrollX)||0,w=((n=window)===null||n===void 0?void 0:n.scrollY)||0,M=o+m+v,I=c+this.offset.top+s/2+w;this.mouseHandlerCallback({pageX:M,pageY:I})}}}])}();function Qfe(t,e,r){if(r==="number"&&e===!0&&Array.isArray(t)){var n=t==null?void 0:t[0],i=t==null?void 0:t[1];if(n&&i&&nr(n)&&nr(i))return!0}return!1}function Jfe(t,e,r,n){var i=n/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?e.x-i:r.left+.5,y:t==="horizontal"?r.top+.5:e.y-i,width:t==="horizontal"?n:r.width-1,height:t==="horizontal"?r.height-1:n}}function pU(t){var e=t.cx,r=t.cy,n=t.radius,i=t.startAngle,o=t.endAngle,c=ps(e,r,n,i),s=ps(e,r,n,o);return{points:[c,s],cx:e,cy:r,radius:n,startAngle:i,endAngle:o}}function ede(t,e,r){var n,i,o,c;if(t==="horizontal")n=e.x,o=n,i=r.top,c=r.top+r.height;else if(t==="vertical")i=e.y,c=i,n=r.left,o=r.left+r.width;else if(e.cx!=null&&e.cy!=null)if(t==="centric"){var s=e.cx,m=e.cy,v=e.innerRadius,w=e.outerRadius,M=e.angle,I=ps(s,m,v,M),k=ps(s,m,w,M);n=I.x,i=I.y,o=k.x,c=k.y}else return pU(e);return[{x:n,y:i},{x:o,y:c}]}function Lv(t){"@babel/helpers - typeof";return Lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lv(t)}function OB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function d0(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?OB(Object(r),!0).forEach(function(n){tde(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):OB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function tde(t,e,r){return e=rde(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function rde(t){var e=nde(t,"string");return Lv(e)=="symbol"?e:e+""}function nde(t,e){if(Lv(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Lv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ide(t){var e,r,n=t.element,i=t.tooltipEventType,o=t.isActive,c=t.activeCoordinate,s=t.activePayload,m=t.offset,v=t.activeTooltipIndex,w=t.tooltipAxisBandSize,M=t.layout,I=t.chartName,k=(e=n.props.cursor)!==null&&e!==void 0?e:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!k||!o||!c||I!=="ScatterChart"&&i!=="axis")return null;var z,V=gM;if(I==="ScatterChart")z=c,V=tce;else if(I==="BarChart")z=Jfe(M,c,m,w),V=x3;else if(M==="radial"){var U=pU(c),K=U.cx,J=U.cy,Z=U.radius,re=U.startAngle,W=U.endAngle;z={cx:K,cy:J,startAngle:re,endAngle:W,innerRadius:Z,outerRadius:Z},V=Tj}else z={points:ede(M,c,m)},V=gM;var Y=d0(d0(d0(d0({stroke:"#ccc",pointerEvents:"none"},m),z),an(k,!1)),{},{payload:s,payloadIndex:v,className:pn("recharts-tooltip-cursor",k.className)});return it.isValidElement(k)?it.cloneElement(k,Y):it.createElement(V,Y)}var ade=["item"],sde=["children","className","width","height","style","compact","title","desc"];function u_(t){"@babel/helpers - typeof";return u_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u_(t)}function Pg(){return Pg=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},Pg.apply(this,arguments)}function kB(t,e){return cde(t)||lde(t,e)||gU(t,e)||ode()}function ode(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lde(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var n,i,o,c,s=[],m=!0,v=!1;try{if(o=(r=r.call(t)).next,e!==0)for(;!(m=(n=o.call(r)).done)&&(s.push(n.value),s.length!==e);m=!0);}catch(w){v=!0,i=w}finally{try{if(!m&&r.return!=null&&(c=r.return(),Object(c)!==c))return}finally{if(v)throw i}}return s}}function cde(t){if(Array.isArray(t))return t}function DB(t,e){if(t==null)return{};var r=ude(t,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function ude(t,e){if(t==null)return{};var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;r[n]=t[n]}return r}function hde(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fde(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_U(n.key),n)}}function dde(t,e,r){return e&&fde(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function pde(t,e,r){return e=Hx(e),mde(t,mU()?Reflect.construct(e,r||[],Hx(t).constructor):e.apply(t,r))}function mde(t,e){if(e&&(u_(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gde(t)}function gde(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mU=function(){return!!t})()}function Hx(t){return Hx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Hx(t)}function _de(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ZM(t,e)}function ZM(t,e){return ZM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},ZM(t,e)}function h_(t){return bde(t)||vde(t)||gU(t)||yde()}function yde(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gU(t,e){if(t){if(typeof t=="string")return XM(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return XM(t,e)}}function vde(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function bde(t){if(Array.isArray(t))return XM(t)}function XM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function NB(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function kt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?NB(Object(r),!0).forEach(function(n){Cr(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):NB(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Cr(t,e,r){return e=_U(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _U(t){var e=xde(t,"string");return u_(e)=="symbol"?e:e+""}function xde(t,e){if(u_(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(u_(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var wde={xAxis:["bottom","top"],yAxis:["left","right"]},Tde={width:"100%",height:"100%"},yU={x:0,y:0};function p0(t){return t}var Sde=function(e,r){return r==="horizontal"?e.x:r==="vertical"?e.y:r==="centric"?e.angle:e.radius},Ade=function(e,r,n,i){var o=r.find(function(w){return w&&w.index===n});if(o){if(e==="horizontal")return{x:o.coordinate,y:i.y};if(e==="vertical")return{x:i.x,y:o.coordinate};if(e==="centric"){var c=o.coordinate,s=i.radius;return kt(kt(kt({},i),ps(i.cx,i.cy,s,c)),{},{angle:c,radius:s})}var m=o.coordinate,v=i.angle;return kt(kt(kt({},i),ps(i.cx,i.cy,m,v)),{},{angle:v,radius:m})}return yU},W1=function(e,r){var n=r.graphicalItems,i=r.dataStartIndex,o=r.dataEndIndex,c=(n??[]).reduce(function(s,m){var v=m.props.data;return v&&v.length?[].concat(h_(s),h_(v)):s},[]);return c.length>0?c:e&&e.length&&nr(i)&&nr(o)?e.slice(i,o+1):[]};function vU(t){return t==="number"?[0,"auto"]:void 0}var GM=function(e,r,n,i){var o=e.graphicalItems,c=e.tooltipAxis,s=W1(r,e);return n<0||!o||!o.length||n>=s.length?null:o.reduce(function(m,v){var w,M=(w=v.props.data)!==null&&w!==void 0?w:r;M&&e.dataStartIndex+e.dataEndIndex!==0&&e.dataEndIndex-e.dataStartIndex>=n&&(M=M.slice(e.dataStartIndex,e.dataEndIndex+1));var I;if(c.dataKey&&!c.allowDuplicatedCategory){var k=M===void 0?s:M;I=Y0(k,c.dataKey,i)}else I=M&&M[n]||s[n];return I?[].concat(h_(m),[bj(v,I)]):m},[])},BB=function(e,r,n,i){var o=i||{x:e.chartX,y:e.chartY},c=Sde(o,n),s=e.orderedTooltipTicks,m=e.tooltipAxis,v=e.tooltipTicks,w=Fae(c,s,v,m);if(w>=0&&v){var M=v[w]&&v[w].value,I=GM(e,r,w,M),k=Ade(n,s,w,o);return{activeTooltipIndex:w,activeLabel:M,activePayload:I,activeCoordinate:k}}return null},Ede=function(e,r){var n=r.axes,i=r.graphicalItems,o=r.axisType,c=r.axisIdKey,s=r.stackGroups,m=r.dataStartIndex,v=r.dataEndIndex,w=e.layout,M=e.children,I=e.stackOffset,k=_j(w,o);return n.reduce(function(z,V){var U,K=V.type.defaultProps!==void 0?kt(kt({},V.type.defaultProps),V.props):V.props,J=K.type,Z=K.dataKey,re=K.allowDataOverflow,W=K.allowDuplicatedCategory,Y=K.scale,ue=K.ticks,be=K.includeHidden,Ce=K[c];if(z[Ce])return z;var Ye=W1(e.data,{graphicalItems:i.filter(function(vt){var Ct,Yt=c in vt.props?vt.props[c]:(Ct=vt.type.defaultProps)===null||Ct===void 0?void 0:Ct[c];return Yt===Ce}),dataStartIndex:m,dataEndIndex:v}),Me=Ye.length,Ue,Qe,Ze;Qfe(K.domain,re,J)&&(Ue=hM(K.domain,null,re),k&&(J==="number"||Y!=="auto")&&(Ze=Hy(Ye,Z,"category")));var ct=vU(J);if(!Ue||Ue.length===0){var Ie,et=(Ie=K.domain)!==null&&Ie!==void 0?Ie:ct;if(Z){if(Ue=Hy(Ye,Z,J),J==="category"&&k){var ot=CK(Ue);W&&ot?(Qe=Ue,Ue=Ox(0,Me)):W||(Ue=Z4(et,Ue,V).reduce(function(vt,Ct){return vt.indexOf(Ct)>=0?vt:[].concat(h_(vt),[Ct])},[]))}else if(J==="category")W?Ue=Ue.filter(function(vt){return vt!==""&&!tn(vt)}):Ue=Z4(et,Ue,V).reduce(function(vt,Ct){return vt.indexOf(Ct)>=0||Ct===""||tn(Ct)?vt:[].concat(h_(vt),[Ct])},[]);else if(J==="number"){var Bt=Vae(Ye,i.filter(function(vt){var Ct,Yt,Ge=c in vt.props?vt.props[c]:(Ct=vt.type.defaultProps)===null||Ct===void 0?void 0:Ct[c],Pt="hide"in vt.props?vt.props.hide:(Yt=vt.type.defaultProps)===null||Yt===void 0?void 0:Yt.hide;return Ge===Ce&&(be||!Pt)}),Z,o,w);Bt&&(Ue=Bt)}k&&(J==="number"||Y!=="auto")&&(Ze=Hy(Ye,Z,"category"))}else k?Ue=Ox(0,Me):s&&s[Ce]&&s[Ce].hasStack&&J==="number"?Ue=I==="expand"?[0,1]:vj(s[Ce].stackGroups,m,v):Ue=gj(Ye,i.filter(function(vt){var Ct=c in vt.props?vt.props[c]:vt.type.defaultProps[c],Yt="hide"in vt.props?vt.props.hide:vt.type.defaultProps.hide;return Ct===Ce&&(be||!Yt)}),J,w,!0);if(J==="number")Ue=WM(M,Ue,Ce,o,ue),et&&(Ue=hM(et,Ue,re));else if(J==="category"&&et){var Te=et,ft=Ue.every(function(vt){return Te.indexOf(vt)>=0});ft&&(Ue=Te)}}return kt(kt({},z),{},Cr({},Ce,kt(kt({},K),{},{axisType:o,domain:Ue,categoricalDomain:Ze,duplicateDomain:Qe,originalDomain:(U=K.domain)!==null&&U!==void 0?U:ct,isCategorical:k,layout:w})))},{})},Mde=function(e,r){var n=r.graphicalItems,i=r.Axis,o=r.axisType,c=r.axisIdKey,s=r.stackGroups,m=r.dataStartIndex,v=r.dataEndIndex,w=e.layout,M=e.children,I=W1(e.data,{graphicalItems:n,dataStartIndex:m,dataEndIndex:v}),k=I.length,z=_j(w,o),V=-1;return n.reduce(function(U,K){var J=K.type.defaultProps!==void 0?kt(kt({},K.type.defaultProps),K.props):K.props,Z=J[c],re=vU("number");if(!U[Z]){V++;var W;return z?W=Ox(0,k):s&&s[Z]&&s[Z].hasStack?(W=vj(s[Z].stackGroups,m,v),W=WM(M,W,Z,o)):(W=hM(re,gj(I,n.filter(function(Y){var ue,be,Ce=c in Y.props?Y.props[c]:(ue=Y.type.defaultProps)===null||ue===void 0?void 0:ue[c],Ye="hide"in Y.props?Y.props.hide:(be=Y.type.defaultProps)===null||be===void 0?void 0:be.hide;return Ce===Z&&!Ye}),"number",w),i.defaultProps.allowDataOverflow),W=WM(M,W,Z,o)),kt(kt({},U),{},Cr({},Z,kt(kt({axisType:o},i.defaultProps),{},{hide:!0,orientation:ql(wde,"".concat(o,".").concat(V%2),null),domain:W,originalDomain:re,isCategorical:z,layout:w})))}return U},{})},Pde=function(e,r){var n=r.axisType,i=n===void 0?"xAxis":n,o=r.AxisComp,c=r.graphicalItems,s=r.stackGroups,m=r.dataStartIndex,v=r.dataEndIndex,w=e.children,M="".concat(i,"Id"),I=Hl(w,o),k={};return I&&I.length?k=Ede(e,{axes:I,graphicalItems:c,axisType:i,axisIdKey:M,stackGroups:s,dataStartIndex:m,dataEndIndex:v}):c&&c.length&&(k=Mde(e,{Axis:o,graphicalItems:c,axisType:i,axisIdKey:M,stackGroups:s,dataStartIndex:m,dataEndIndex:v})),k},Cde=function(e){var r=ld(e),n=Uh(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:XP(n,function(i){return i.coordinate}),tooltipAxis:r,tooltipAxisBandSize:Tx(r,n)}},LB=function(e){var r=e.children,n=e.defaultShowTooltip,i=Go(r,Qp),o=0,c=0;return e.data&&e.data.length!==0&&(c=e.data.length-1),i&&i.props&&(i.props.startIndex>=0&&(o=i.props.startIndex),i.props.endIndex>=0&&(c=i.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:o,dataEndIndex:c,activeTooltipIndex:-1,isTooltipActive:!!n}},Rde=function(e){return!e||!e.length?!1:e.some(function(r){var n=$h(r&&r.type);return n&&n.indexOf("Bar")>=0})},FB=function(e){return e==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:e==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:e==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Ide=function(e,r){var n=e.props,i=e.graphicalItems,o=e.xAxisMap,c=o===void 0?{}:o,s=e.yAxisMap,m=s===void 0?{}:s,v=n.width,w=n.height,M=n.children,I=n.margin||{},k=Go(M,Qp),z=Go(M,md),V=Object.keys(m).reduce(function(W,Y){var ue=m[Y],be=ue.orientation;return!ue.mirror&&!ue.hide?kt(kt({},W),{},Cr({},be,W[be]+ue.width)):W},{left:I.left||0,right:I.right||0}),U=Object.keys(c).reduce(function(W,Y){var ue=c[Y],be=ue.orientation;return!ue.mirror&&!ue.hide?kt(kt({},W),{},Cr({},be,ql(W,"".concat(be))+ue.height)):W},{top:I.top||0,bottom:I.bottom||0}),K=kt(kt({},U),V),J=K.bottom;k&&(K.bottom+=k.props.height||Qp.defaultProps.height),z&&r&&(K=Uae(K,i,n,r));var Z=v-K.left-K.right,re=w-K.top-K.bottom;return kt(kt({brushBottom:J},K),{},{width:Math.max(Z,0),height:Math.max(re,0)})},Ode=function(e,r){if(r==="xAxis")return e[r].width;if(r==="yAxis")return e[r].height},kde=function(e){var r=e.chartName,n=e.GraphicalChild,i=e.defaultTooltipEventType,o=i===void 0?"axis":i,c=e.validateTooltipEventTypes,s=c===void 0?["axis"]:c,m=e.axisComponents,v=e.legendContent,w=e.formatAxisMap,M=e.defaultProps,I=function(K,J){var Z=J.graphicalItems,re=J.stackGroups,W=J.offset,Y=J.updateId,ue=J.dataStartIndex,be=J.dataEndIndex,Ce=K.barSize,Ye=K.layout,Me=K.barGap,Ue=K.barCategoryGap,Qe=K.maxBarSize,Ze=FB(Ye),ct=Ze.numericAxisName,Ie=Ze.cateAxisName,et=Rde(Z),ot=[];return Z.forEach(function(Bt,Te){var ft=W1(K.data,{graphicalItems:[Bt],dataStartIndex:ue,dataEndIndex:be}),vt=Bt.type.defaultProps!==void 0?kt(kt({},Bt.type.defaultProps),Bt.props):Bt.props,Ct=vt.dataKey,Yt=vt.maxBarSize,Ge=vt["".concat(ct,"Id")],Pt=vt["".concat(Ie,"Id")],tr={},Ft=m.reduce(function(Kn,Ei){var Mi=J["".concat(Ei.axisType,"Map")],el=vt["".concat(Ei.axisType,"Id")];Mi&&Mi[el]||Ei.axisType==="zAxis"||Kp();var _o=Mi[el];return kt(kt({},Kn),{},Cr(Cr({},Ei.axisType,_o),"".concat(Ei.axisType,"Ticks"),Uh(_o)))},tr),zt=Ft[Ie],Gt=Ft["".concat(Ie,"Ticks")],Zt=re&&re[Ge]&&re[Ge].hasStack&&tse(Bt,re[Ge].stackGroups),mt=$h(Bt.type).indexOf("Bar")>=0,hr=Tx(zt,Gt),Vt=[],ar=et&&zae({barSize:Ce,stackGroups:re,totalSize:Ode(Ft,Ie)});if(mt){var rr,fr,En=tn(Yt)?Qe:Yt,aa=(rr=(fr=Tx(zt,Gt,!0))!==null&&fr!==void 0?fr:En)!==null&&rr!==void 0?rr:0;Vt=jae({barGap:Me,barCategoryGap:Ue,bandSize:aa!==hr?aa:hr,sizeList:ar[Pt],maxBarSize:En}),aa!==hr&&(Vt=Vt.map(function(Kn){return kt(kt({},Kn),{},{position:kt(kt({},Kn.position),{},{offset:Kn.position.offset-aa/2})})}))}var li=Bt&&Bt.type&&Bt.type.getComposedData;li&&ot.push({props:kt(kt({},li(kt(kt({},Ft),{},{displayedData:ft,props:K,dataKey:Ct,item:Bt,bandSize:hr,barPosition:Vt,offset:W,stackedData:Zt,layout:Ye,dataStartIndex:ue,dataEndIndex:be}))),{},Cr(Cr(Cr({key:Bt.key||"item-".concat(Te)},ct,Ft[ct]),Ie,Ft[Ie]),"animationId",Y)),childIndex:$K(Bt,K.children),item:Bt})}),ot},k=function(K,J){var Z=K.props,re=K.dataStartIndex,W=K.dataEndIndex,Y=K.updateId;if(!sO({props:Z}))return null;var ue=Z.children,be=Z.layout,Ce=Z.stackOffset,Ye=Z.data,Me=Z.reverseStackOrder,Ue=FB(be),Qe=Ue.numericAxisName,Ze=Ue.cateAxisName,ct=Hl(ue,n),Ie=Qae(Ye,ct,"".concat(Qe,"Id"),"".concat(Ze,"Id"),Ce,Me),et=m.reduce(function(vt,Ct){var Yt="".concat(Ct.axisType,"Map");return kt(kt({},vt),{},Cr({},Yt,Pde(Z,kt(kt({},Ct),{},{graphicalItems:ct,stackGroups:Ct.axisType===Qe&&Ie,dataStartIndex:re,dataEndIndex:W}))))},{}),ot=Ide(kt(kt({},et),{},{props:Z,graphicalItems:ct}),J==null?void 0:J.legendBBox);Object.keys(et).forEach(function(vt){et[vt]=w(Z,et[vt],ot,vt.replace("Map",""),r)});var Bt=et["".concat(Ze,"Map")],Te=Cde(Bt),ft=I(Z,kt(kt({},et),{},{dataStartIndex:re,dataEndIndex:W,updateId:Y,graphicalItems:ct,stackGroups:Ie,offset:ot}));return kt(kt({formattedGraphicalItems:ft,graphicalItems:ct,offset:ot,stackGroups:Ie},Te),et)},z=function(U){function K(J){var Z,re,W;return hde(this,K),W=pde(this,K,[J]),Cr(W,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Cr(W,"accessibilityManager",new Kfe),Cr(W,"handleLegendBBoxUpdate",function(Y){if(Y){var ue=W.state,be=ue.dataStartIndex,Ce=ue.dataEndIndex,Ye=ue.updateId;W.setState(kt({legendBBox:Y},k({props:W.props,dataStartIndex:be,dataEndIndex:Ce,updateId:Ye},kt(kt({},W.state),{},{legendBBox:Y}))))}}),Cr(W,"handleReceiveSyncEvent",function(Y,ue,be){if(W.props.syncId===Y){if(be===W.eventEmitterSymbol&&typeof W.props.syncMethod!="function")return;W.applySyncEvent(ue)}}),Cr(W,"handleBrushChange",function(Y){var ue=Y.startIndex,be=Y.endIndex;if(ue!==W.state.dataStartIndex||be!==W.state.dataEndIndex){var Ce=W.state.updateId;W.setState(function(){return kt({dataStartIndex:ue,dataEndIndex:be},k({props:W.props,dataStartIndex:ue,dataEndIndex:be,updateId:Ce},W.state))}),W.triggerSyncEvent({dataStartIndex:ue,dataEndIndex:be})}}),Cr(W,"handleMouseEnter",function(Y){var ue=W.getMouseInfo(Y);if(ue){var be=kt(kt({},ue),{},{isTooltipActive:!0});W.setState(be),W.triggerSyncEvent(be);var Ce=W.props.onMouseEnter;Xr(Ce)&&Ce(be,Y)}}),Cr(W,"triggeredAfterMouseMove",function(Y){var ue=W.getMouseInfo(Y),be=ue?kt(kt({},ue),{},{isTooltipActive:!0}):{isTooltipActive:!1};W.setState(be),W.triggerSyncEvent(be);var Ce=W.props.onMouseMove;Xr(Ce)&&Ce(be,Y)}),Cr(W,"handleItemMouseEnter",function(Y){W.setState(function(){return{isTooltipActive:!0,activeItem:Y,activePayload:Y.tooltipPayload,activeCoordinate:Y.tooltipPosition||{x:Y.cx,y:Y.cy}}})}),Cr(W,"handleItemMouseLeave",function(){W.setState(function(){return{isTooltipActive:!1}})}),Cr(W,"handleMouseMove",function(Y){Y.persist(),W.throttleTriggeredAfterMouseMove(Y)}),Cr(W,"handleMouseLeave",function(Y){W.throttleTriggeredAfterMouseMove.cancel();var ue={isTooltipActive:!1};W.setState(ue),W.triggerSyncEvent(ue);var be=W.props.onMouseLeave;Xr(be)&&be(ue,Y)}),Cr(W,"handleOuterEvent",function(Y){var ue=UK(Y),be=ql(W.props,"".concat(ue));if(ue&&Xr(be)){var Ce,Ye;/.*touch.*/i.test(ue)?Ye=W.getMouseInfo(Y.changedTouches[0]):Ye=W.getMouseInfo(Y),be((Ce=Ye)!==null&&Ce!==void 0?Ce:{},Y)}}),Cr(W,"handleClick",function(Y){var ue=W.getMouseInfo(Y);if(ue){var be=kt(kt({},ue),{},{isTooltipActive:!0});W.setState(be),W.triggerSyncEvent(be);var Ce=W.props.onClick;Xr(Ce)&&Ce(be,Y)}}),Cr(W,"handleMouseDown",function(Y){var ue=W.props.onMouseDown;if(Xr(ue)){var be=W.getMouseInfo(Y);ue(be,Y)}}),Cr(W,"handleMouseUp",function(Y){var ue=W.props.onMouseUp;if(Xr(ue)){var be=W.getMouseInfo(Y);ue(be,Y)}}),Cr(W,"handleTouchMove",function(Y){Y.changedTouches!=null&&Y.changedTouches.length>0&&W.throttleTriggeredAfterMouseMove(Y.changedTouches[0])}),Cr(W,"handleTouchStart",function(Y){Y.changedTouches!=null&&Y.changedTouches.length>0&&W.handleMouseDown(Y.changedTouches[0])}),Cr(W,"handleTouchEnd",function(Y){Y.changedTouches!=null&&Y.changedTouches.length>0&&W.handleMouseUp(Y.changedTouches[0])}),Cr(W,"handleDoubleClick",function(Y){var ue=W.props.onDoubleClick;if(Xr(ue)){var be=W.getMouseInfo(Y);ue(be,Y)}}),Cr(W,"handleContextMenu",function(Y){var ue=W.props.onContextMenu;if(Xr(ue)){var be=W.getMouseInfo(Y);ue(be,Y)}}),Cr(W,"triggerSyncEvent",function(Y){W.props.syncId!==void 0&&FA.emit(zA,W.props.syncId,Y,W.eventEmitterSymbol)}),Cr(W,"applySyncEvent",function(Y){var ue=W.props,be=ue.layout,Ce=ue.syncMethod,Ye=W.state.updateId,Me=Y.dataStartIndex,Ue=Y.dataEndIndex;if(Y.dataStartIndex!==void 0||Y.dataEndIndex!==void 0)W.setState(kt({dataStartIndex:Me,dataEndIndex:Ue},k({props:W.props,dataStartIndex:Me,dataEndIndex:Ue,updateId:Ye},W.state)));else if(Y.activeTooltipIndex!==void 0){var Qe=Y.chartX,Ze=Y.chartY,ct=Y.activeTooltipIndex,Ie=W.state,et=Ie.offset,ot=Ie.tooltipTicks;if(!et)return;if(typeof Ce=="function")ct=Ce(ot,Y);else if(Ce==="value"){ct=-1;for(var Bt=0;Bt<ot.length;Bt++)if(ot[Bt].value===Y.activeLabel){ct=Bt;break}}var Te=kt(kt({},et),{},{x:et.left,y:et.top}),ft=Math.min(Qe,Te.x+Te.width),vt=Math.min(Ze,Te.y+Te.height),Ct=ot[ct]&&ot[ct].value,Yt=GM(W.state,W.props.data,ct),Ge=ot[ct]?{x:be==="horizontal"?ot[ct].coordinate:ft,y:be==="horizontal"?vt:ot[ct].coordinate}:yU;W.setState(kt(kt({},Y),{},{activeLabel:Ct,activeCoordinate:Ge,activePayload:Yt,activeTooltipIndex:ct}))}else W.setState(Y)}),Cr(W,"renderCursor",function(Y){var ue,be=W.state,Ce=be.isTooltipActive,Ye=be.activeCoordinate,Me=be.activePayload,Ue=be.offset,Qe=be.activeTooltipIndex,Ze=be.tooltipAxisBandSize,ct=W.getTooltipEventType(),Ie=(ue=Y.props.active)!==null&&ue!==void 0?ue:Ce,et=W.props.layout,ot=Y.key||"_recharts-cursor";return He.createElement(ide,{key:ot,activeCoordinate:Ye,activePayload:Me,activeTooltipIndex:Qe,chartName:r,element:Y,isActive:Ie,layout:et,offset:Ue,tooltipAxisBandSize:Ze,tooltipEventType:ct})}),Cr(W,"renderPolarAxis",function(Y,ue,be){var Ce=ql(Y,"type.axisType"),Ye=ql(W.state,"".concat(Ce,"Map")),Me=Y.type.defaultProps,Ue=Me!==void 0?kt(kt({},Me),Y.props):Y.props,Qe=Ye&&Ye[Ue["".concat(Ce,"Id")]];return it.cloneElement(Y,kt(kt({},Qe),{},{className:pn(Ce,Qe.className),key:Y.key||"".concat(ue,"-").concat(be),ticks:Uh(Qe,!0)}))}),Cr(W,"renderPolarGrid",function(Y){var ue=Y.props,be=ue.radialLines,Ce=ue.polarAngles,Ye=ue.polarRadius,Me=W.state,Ue=Me.radiusAxisMap,Qe=Me.angleAxisMap,Ze=ld(Ue),ct=ld(Qe),Ie=ct.cx,et=ct.cy,ot=ct.innerRadius,Bt=ct.outerRadius;return it.cloneElement(Y,{polarAngles:Array.isArray(Ce)?Ce:Uh(ct,!0).map(function(Te){return Te.coordinate}),polarRadius:Array.isArray(Ye)?Ye:Uh(Ze,!0).map(function(Te){return Te.coordinate}),cx:Ie,cy:et,innerRadius:ot,outerRadius:Bt,key:Y.key||"polar-grid",radialLines:be})}),Cr(W,"renderLegend",function(){var Y=W.state.formattedGraphicalItems,ue=W.props,be=ue.children,Ce=ue.width,Ye=ue.height,Me=W.props.margin||{},Ue=Ce-(Me.left||0)-(Me.right||0),Qe=pj({children:be,formattedGraphicalItems:Y,legendWidth:Ue,legendContent:v});if(!Qe)return null;var Ze=Qe.item,ct=DB(Qe,ade);return it.cloneElement(Ze,kt(kt({},ct),{},{chartWidth:Ce,chartHeight:Ye,margin:Me,onBBoxUpdate:W.handleLegendBBoxUpdate}))}),Cr(W,"renderTooltip",function(){var Y,ue=W.props,be=ue.children,Ce=ue.accessibilityLayer,Ye=Go(be,Fc);if(!Ye)return null;var Me=W.state,Ue=Me.isTooltipActive,Qe=Me.activeCoordinate,Ze=Me.activePayload,ct=Me.activeLabel,Ie=Me.offset,et=(Y=Ye.props.active)!==null&&Y!==void 0?Y:Ue;return it.cloneElement(Ye,{viewBox:kt(kt({},Ie),{},{x:Ie.left,y:Ie.top}),active:et,label:ct,payload:et?Ze:[],coordinate:Qe,accessibilityLayer:Ce})}),Cr(W,"renderBrush",function(Y){var ue=W.props,be=ue.margin,Ce=ue.data,Ye=W.state,Me=Ye.offset,Ue=Ye.dataStartIndex,Qe=Ye.dataEndIndex,Ze=Ye.updateId;return it.cloneElement(Y,{key:Y.key||"_recharts-brush",onChange:c0(W.handleBrushChange,Y.props.onChange),data:Ce,x:nr(Y.props.x)?Y.props.x:Me.left,y:nr(Y.props.y)?Y.props.y:Me.top+Me.height+Me.brushBottom-(be.bottom||0),width:nr(Y.props.width)?Y.props.width:Me.width,startIndex:Ue,endIndex:Qe,updateId:"brush-".concat(Ze)})}),Cr(W,"renderReferenceElement",function(Y,ue,be){if(!Y)return null;var Ce=W,Ye=Ce.clipPathId,Me=W.state,Ue=Me.xAxisMap,Qe=Me.yAxisMap,Ze=Me.offset,ct=Y.type.defaultProps||{},Ie=Y.props,et=Ie.xAxisId,ot=et===void 0?ct.xAxisId:et,Bt=Ie.yAxisId,Te=Bt===void 0?ct.yAxisId:Bt;return it.cloneElement(Y,{key:Y.key||"".concat(ue,"-").concat(be),xAxis:Ue[ot],yAxis:Qe[Te],viewBox:{x:Ze.left,y:Ze.top,width:Ze.width,height:Ze.height},clipPathId:Ye})}),Cr(W,"renderActivePoints",function(Y){var ue=Y.item,be=Y.activePoint,Ce=Y.basePoint,Ye=Y.childIndex,Me=Y.isRange,Ue=[],Qe=ue.props.key,Ze=ue.item.type.defaultProps!==void 0?kt(kt({},ue.item.type.defaultProps),ue.item.props):ue.item.props,ct=Ze.activeDot,Ie=Ze.dataKey,et=kt(kt({index:Ye,dataKey:Ie,cx:be.x,cy:be.y,r:4,fill:b3(ue.item),strokeWidth:2,stroke:"#fff",payload:be.payload,value:be.value},an(ct,!1)),K0(ct));return Ue.push(K.renderActiveDot(ct,et,"".concat(Qe,"-activePoint-").concat(Ye))),Ce?Ue.push(K.renderActiveDot(ct,kt(kt({},et),{},{cx:Ce.x,cy:Ce.y}),"".concat(Qe,"-basePoint-").concat(Ye))):Me&&Ue.push(null),Ue}),Cr(W,"renderGraphicChild",function(Y,ue,be){var Ce=W.filterFormatItem(Y,ue,be);if(!Ce)return null;var Ye=W.getTooltipEventType(),Me=W.state,Ue=Me.isTooltipActive,Qe=Me.tooltipAxis,Ze=Me.activeTooltipIndex,ct=Me.activeLabel,Ie=W.props.children,et=Go(Ie,Fc),ot=Ce.props,Bt=ot.points,Te=ot.isRange,ft=ot.baseLine,vt=Ce.item.type.defaultProps!==void 0?kt(kt({},Ce.item.type.defaultProps),Ce.item.props):Ce.item.props,Ct=vt.activeDot,Yt=vt.hide,Ge=vt.activeBar,Pt=vt.activeShape,tr=!!(!Yt&&Ue&&et&&(Ct||Ge||Pt)),Ft={};Ye!=="axis"&&et&&et.props.trigger==="click"?Ft={onClick:c0(W.handleItemMouseEnter,Y.props.onClick)}:Ye!=="axis"&&(Ft={onMouseLeave:c0(W.handleItemMouseLeave,Y.props.onMouseLeave),onMouseEnter:c0(W.handleItemMouseEnter,Y.props.onMouseEnter)});var zt=it.cloneElement(Y,kt(kt({},Ce.props),Ft));function Gt(Ei){return typeof Qe.dataKey=="function"?Qe.dataKey(Ei.payload):null}if(tr)if(Ze>=0){var Zt,mt;if(Qe.dataKey&&!Qe.allowDuplicatedCategory){var hr=typeof Qe.dataKey=="function"?Gt:"payload.".concat(Qe.dataKey.toString());Zt=Y0(Bt,hr,ct),mt=Te&&ft&&Y0(ft,hr,ct)}else Zt=Bt==null?void 0:Bt[Ze],mt=Te&&ft&&ft[Ze];if(Pt||Ge){var Vt=Y.props.activeIndex!==void 0?Y.props.activeIndex:Ze;return[it.cloneElement(Y,kt(kt(kt({},Ce.props),Ft),{},{activeIndex:Vt})),null,null]}if(!tn(Zt))return[zt].concat(h_(W.renderActivePoints({item:Ce,activePoint:Zt,basePoint:mt,childIndex:Ze,isRange:Te})))}else{var ar,rr=(ar=W.getItemByXY(W.state.activeCoordinate))!==null&&ar!==void 0?ar:{graphicalItem:zt},fr=rr.graphicalItem,En=fr.item,aa=En===void 0?Y:En,li=fr.childIndex,Kn=kt(kt(kt({},Ce.props),Ft),{},{activeIndex:li});return[it.cloneElement(aa,Kn),null,null]}return Te?[zt,null,null]:[zt,null]}),Cr(W,"renderCustomized",function(Y,ue,be){return it.cloneElement(Y,kt(kt({key:"recharts-customized-".concat(be)},W.props),W.state))}),Cr(W,"renderMap",{CartesianGrid:{handler:p0,once:!0},ReferenceArea:{handler:W.renderReferenceElement},ReferenceLine:{handler:p0},ReferenceDot:{handler:W.renderReferenceElement},XAxis:{handler:p0},YAxis:{handler:p0},Brush:{handler:W.renderBrush,once:!0},Bar:{handler:W.renderGraphicChild},Line:{handler:W.renderGraphicChild},Area:{handler:W.renderGraphicChild},Radar:{handler:W.renderGraphicChild},RadialBar:{handler:W.renderGraphicChild},Scatter:{handler:W.renderGraphicChild},Pie:{handler:W.renderGraphicChild},Funnel:{handler:W.renderGraphicChild},Tooltip:{handler:W.renderCursor,once:!0},PolarGrid:{handler:W.renderPolarGrid,once:!0},PolarAngleAxis:{handler:W.renderPolarAxis},PolarRadiusAxis:{handler:W.renderPolarAxis},Customized:{handler:W.renderCustomized}}),W.clipPathId="".concat((Z=J.id)!==null&&Z!==void 0?Z:Wv("recharts"),"-clip"),W.throttleTriggeredAfterMouseMove=dz(W.triggeredAfterMouseMove,(re=J.throttleDelay)!==null&&re!==void 0?re:1e3/60),W.state={},W}return _de(K,U),dde(K,[{key:"componentDidMount",value:function(){var Z,re;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(Z=this.props.margin.left)!==null&&Z!==void 0?Z:0,top:(re=this.props.margin.top)!==null&&re!==void 0?re:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var Z=this.props,re=Z.children,W=Z.data,Y=Z.height,ue=Z.layout,be=Go(re,Fc);if(be){var Ce=be.props.defaultIndex;if(!(typeof Ce!="number"||Ce<0||Ce>this.state.tooltipTicks.length-1)){var Ye=this.state.tooltipTicks[Ce]&&this.state.tooltipTicks[Ce].value,Me=GM(this.state,W,Ce,Ye),Ue=this.state.tooltipTicks[Ce].coordinate,Qe=(this.state.offset.top+Y)/2,Ze=ue==="horizontal",ct=Ze?{x:Ue,y:Qe}:{y:Ue,x:Qe},Ie=this.state.formattedGraphicalItems.find(function(ot){var Bt=ot.item;return Bt.type.name==="Scatter"});Ie&&(ct=kt(kt({},ct),Ie.props.points[Ce].tooltipPosition),Me=Ie.props.points[Ce].tooltipPayload);var et={activeTooltipIndex:Ce,isTooltipActive:!0,activeLabel:Ye,activePayload:Me,activeCoordinate:ct};this.setState(et),this.renderCursor(be),this.accessibilityManager.setIndex(Ce)}}}},{key:"getSnapshotBeforeUpdate",value:function(Z,re){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==re.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==Z.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==Z.margin){var W,Y;this.accessibilityManager.setDetails({offset:{left:(W=this.props.margin.left)!==null&&W!==void 0?W:0,top:(Y=this.props.margin.top)!==null&&Y!==void 0?Y:0}})}return null}},{key:"componentDidUpdate",value:function(Z){kE([Go(Z.children,Fc)],[Go(this.props.children,Fc)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var Z=Go(this.props.children,Fc);if(Z&&typeof Z.props.shared=="boolean"){var re=Z.props.shared?"axis":"item";return s.indexOf(re)>=0?re:o}return o}},{key:"getMouseInfo",value:function(Z){if(!this.container)return null;var re=this.container,W=re.getBoundingClientRect(),Y=Pte(W),ue={chartX:Math.round(Z.pageX-Y.left),chartY:Math.round(Z.pageY-Y.top)},be=W.width/re.offsetWidth||1,Ce=this.inRange(ue.chartX,ue.chartY,be);if(!Ce)return null;var Ye=this.state,Me=Ye.xAxisMap,Ue=Ye.yAxisMap,Qe=this.getTooltipEventType(),Ze=BB(this.state,this.props.data,this.props.layout,Ce);if(Qe!=="axis"&&Me&&Ue){var ct=ld(Me).scale,Ie=ld(Ue).scale,et=ct&&ct.invert?ct.invert(ue.chartX):null,ot=Ie&&Ie.invert?Ie.invert(ue.chartY):null;return kt(kt({},ue),{},{xValue:et,yValue:ot},Ze)}return Ze?kt(kt({},ue),Ze):null}},{key:"inRange",value:function(Z,re){var W=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Y=this.props.layout,ue=Z/W,be=re/W;if(Y==="horizontal"||Y==="vertical"){var Ce=this.state.offset,Ye=ue>=Ce.left&&ue<=Ce.left+Ce.width&&be>=Ce.top&&be<=Ce.top+Ce.height;return Ye?{x:ue,y:be}:null}var Me=this.state,Ue=Me.angleAxisMap,Qe=Me.radiusAxisMap;if(Ue&&Qe){var Ze=ld(Ue);return Y4({x:ue,y:be},Ze)}return null}},{key:"parseEventsOfWrapper",value:function(){var Z=this.props.children,re=this.getTooltipEventType(),W=Go(Z,Fc),Y={};W&&re==="axis"&&(W.props.trigger==="click"?Y={onClick:this.handleClick}:Y={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ue=K0(this.props,this.handleOuterEvent);return kt(kt({},ue),Y)}},{key:"addListener",value:function(){FA.on(zA,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){FA.removeListener(zA,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(Z,re,W){for(var Y=this.state.formattedGraphicalItems,ue=0,be=Y.length;ue<be;ue++){var Ce=Y[ue];if(Ce.item===Z||Ce.props.key===Z.key||re===$h(Ce.item.type)&&W===Ce.childIndex)return Ce}return null}},{key:"renderClipPath",value:function(){var Z=this.clipPathId,re=this.state.offset,W=re.left,Y=re.top,ue=re.height,be=re.width;return He.createElement("defs",null,He.createElement("clipPath",{id:Z},He.createElement("rect",{x:W,y:Y,height:ue,width:be})))}},{key:"getXScales",value:function(){var Z=this.state.xAxisMap;return Z?Object.entries(Z).reduce(function(re,W){var Y=kB(W,2),ue=Y[0],be=Y[1];return kt(kt({},re),{},Cr({},ue,be.scale))},{}):null}},{key:"getYScales",value:function(){var Z=this.state.yAxisMap;return Z?Object.entries(Z).reduce(function(re,W){var Y=kB(W,2),ue=Y[0],be=Y[1];return kt(kt({},re),{},Cr({},ue,be.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(Z){var re;return(re=this.state.xAxisMap)===null||re===void 0||(re=re[Z])===null||re===void 0?void 0:re.scale}},{key:"getYScaleByAxisId",value:function(Z){var re;return(re=this.state.yAxisMap)===null||re===void 0||(re=re[Z])===null||re===void 0?void 0:re.scale}},{key:"getItemByXY",value:function(Z){var re=this.state,W=re.formattedGraphicalItems,Y=re.activeItem;if(W&&W.length)for(var ue=0,be=W.length;ue<be;ue++){var Ce=W[ue],Ye=Ce.props,Me=Ce.item,Ue=Me.type.defaultProps!==void 0?kt(kt({},Me.type.defaultProps),Me.props):Me.props,Qe=$h(Me.type);if(Qe==="Bar"){var Ze=(Ye.data||[]).find(function(ot){return Hle(Z,ot)});if(Ze)return{graphicalItem:Ce,payload:Ze}}else if(Qe==="RadialBar"){var ct=(Ye.data||[]).find(function(ot){return Y4(Z,ot)});if(ct)return{graphicalItem:Ce,payload:ct}}else if(j1(Ce,Y)||U1(Ce,Y)||Cv(Ce,Y)){var Ie=Nce({graphicalItem:Ce,activeTooltipItem:Y,itemData:Ue.data}),et=Ue.activeIndex===void 0?Ie:Ue.activeIndex;return{graphicalItem:kt(kt({},Ce),{},{childIndex:et}),payload:Cv(Ce,Y)?Ue.data[Ie]:Ce.props.data[Ie]}}}return null}},{key:"render",value:function(){var Z=this;if(!sO(this))return null;var re=this.props,W=re.children,Y=re.className,ue=re.width,be=re.height,Ce=re.style,Ye=re.compact,Me=re.title,Ue=re.desc,Qe=DB(re,sde),Ze=an(Qe,!1);if(Ye)return He.createElement(pB,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},He.createElement(NE,Pg({},Ze,{width:ue,height:be,title:Me,desc:Ue}),this.renderClipPath(),lO(W,this.renderMap)));if(this.props.accessibilityLayer){var ct,Ie;Ze.tabIndex=(ct=this.props.tabIndex)!==null&&ct!==void 0?ct:0,Ze.role=(Ie=this.props.role)!==null&&Ie!==void 0?Ie:"application",Ze.onKeyDown=function(ot){Z.accessibilityManager.keyboardEvent(ot)},Ze.onFocus=function(){Z.accessibilityManager.focus()}}var et=this.parseEventsOfWrapper();return He.createElement(pB,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},He.createElement("div",Pg({className:pn("recharts-wrapper",Y),style:kt({position:"relative",cursor:"default",width:ue,height:be},Ce)},et,{ref:function(Bt){Z.container=Bt}}),He.createElement(NE,Pg({},Ze,{width:ue,height:be,title:Me,desc:Ue,style:Tde}),this.renderClipPath(),lO(W,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(it.Component);Cr(z,"displayName",r),Cr(z,"defaultProps",kt({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},M)),Cr(z,"getDerivedStateFromProps",function(U,K){var J=U.dataKey,Z=U.data,re=U.children,W=U.width,Y=U.height,ue=U.layout,be=U.stackOffset,Ce=U.margin,Ye=K.dataStartIndex,Me=K.dataEndIndex;if(K.updateId===void 0){var Ue=LB(U);return kt(kt(kt({},Ue),{},{updateId:0},k(kt(kt({props:U},Ue),{},{updateId:0}),K)),{},{prevDataKey:J,prevData:Z,prevWidth:W,prevHeight:Y,prevLayout:ue,prevStackOffset:be,prevMargin:Ce,prevChildren:re})}if(J!==K.prevDataKey||Z!==K.prevData||W!==K.prevWidth||Y!==K.prevHeight||ue!==K.prevLayout||be!==K.prevStackOffset||!Ig(Ce,K.prevMargin)){var Qe=LB(U),Ze={chartX:K.chartX,chartY:K.chartY,isTooltipActive:K.isTooltipActive},ct=kt(kt({},BB(K,Z,ue)),{},{updateId:K.updateId+1}),Ie=kt(kt(kt({},Qe),Ze),ct);return kt(kt(kt({},Ie),k(kt({props:U},Ie),K)),{},{prevDataKey:J,prevData:Z,prevWidth:W,prevHeight:Y,prevLayout:ue,prevStackOffset:be,prevMargin:Ce,prevChildren:re})}if(!kE(re,K.prevChildren)){var et,ot,Bt,Te,ft=Go(re,Qp),vt=ft&&(et=(ot=ft.props)===null||ot===void 0?void 0:ot.startIndex)!==null&&et!==void 0?et:Ye,Ct=ft&&(Bt=(Te=ft.props)===null||Te===void 0?void 0:Te.endIndex)!==null&&Bt!==void 0?Bt:Me,Yt=vt!==Ye||Ct!==Me,Ge=!tn(Z),Pt=Ge&&!Yt?K.updateId:K.updateId+1;return kt(kt({updateId:Pt},k(kt(kt({props:U},K),{},{updateId:Pt,dataStartIndex:vt,dataEndIndex:Ct}),K)),{},{prevChildren:re,dataStartIndex:vt,dataEndIndex:Ct})}return null}),Cr(z,"renderActiveDot",function(U,K,J){var Z;return it.isValidElement(U)?Z=it.cloneElement(U,K):Xr(U)?Z=U(K):Z=He.createElement(w3,K),He.createElement(ia,{className:"recharts-active-dot",key:J},Z)});var V=it.forwardRef(function(K,J){return He.createElement(z,Pg({},K,{ref:J}))});return V.displayName=z.displayName,V},zB=kde({chartName:"LineChart",GraphicalChild:Fh,axisComponents:[{axisType:"xAxis",AxisComp:Dv},{axisType:"yAxis",AxisComp:Nv}],formatAxisMap:Iue});function Dde(){const[t,e]=it.useState(!1),[r,n]=it.useState("statistics"),[i,o]=it.useState(null),c=[{name:"Western Australia",bounds:{minLat:-35,maxLat:-13,minLng:112,maxLng:129}},{name:"Northern Territory",bounds:{minLat:-26,maxLat:-10,minLng:129,maxLng:138}},{name:"South Australia",bounds:{minLat:-38,maxLat:-26,minLng:129,maxLng:141}},{name:"Queensland",bounds:{minLat:-29,maxLat:-10,minLng:138,maxLng:154}},{name:"New South Wales",bounds:{minLat:-37,maxLat:-28,minLng:141,maxLng:153}},{name:"Victoria",bounds:{minLat:-39,maxLat:-34,minLng:141,maxLng:150}},{name:"Tasmania",bounds:{minLat:-44,maxLat:-39,minLng:144,maxLng:149}},{name:"Australian Capital Territory",bounds:{minLat:-35.92,maxLat:-35.1,minLng:148.76,maxLng:149.4}}],s=c.map(Ge=>Ge.name),[m,v]=it.useState([]),[w,M]=it.useState("map"),[I,k]=it.useState(null),[z,V]=it.useState(c[0].name),[U,K]=it.useState(c[1].name),[J,Z]=it.useState(0),[re,W]=it.useState([]),[Y,ue]=it.useState([]),[be,Ce]=it.useState({startIndex:0,endIndex:void 0}),Ye=["https://media.australian.museum/media/dd/images/Lathamus-discolor.074ed02.width-1200.453e763.jpg","https://www.featherbase.info/static/images/speciesimages/001826_full.JPG","https://media.australian.museum/media/dd/images/deborod_some_rights_reserved_CC_BY-NC.90db761.width-1600.8af8c7e.jpg","https://media.australian.museum/media/dd/images/deborod_some_rights_reserved_CC_BY-NC_1.65494.width-1600.a3c924c.jpg"];it.useEffect(()=>{const Ge=setInterval(()=>{Z(Pt=>(Pt+1)%Ye.length)},4e3);return()=>clearInterval(Ge)},[Ye.length]),it.useEffect(()=>{fetch("https://eco-migration-app.onrender.com/api/occurrences").then(Ge=>Ge.json()).then(Ge=>{const Pt=Ge.map(Ft=>{let zt=Ft.stateProvince||"Unknown";if(zt==="Unknown"){const Gt=parseFloat(Ft.decimalLatitude),Zt=parseFloat(Ft.decimalLongitude);for(const mt of c)if(Gt>=mt.bounds.minLat&&Gt<=mt.bounds.maxLat&&Zt>=mt.bounds.minLng&&Zt<=mt.bounds.maxLng){zt=mt.name;break}}return Ft.year||Ft.eventDate&&new Date(Ft.eventDate).getFullYear(),{...Ft,stateProvince:zt,year:Ft.year}});v(Pt);const tr=[...new Set(Pt.filter(Ft=>Ft.species).map(Ft=>Ft.species))];W(tr),tr.length>0&&k(tr[0]),Ue(Pt),console.log("Enriched data:",Pt)}).catch(Ge=>{console.error("Error fetching data:",Ge);const Pt=Me();v(Pt),Ue(Pt)})},[]);const Me=()=>{const Ge=[],Pt=["Kangaroo","Koala","Wombat","Platypus"],tr=new Date().getFullYear();for(const Ft of c)for(const zt of Pt)for(let Gt=tr-4;Gt<=tr;Gt++){const Zt=(Ft.bounds.minLat+Ft.bounds.maxLat)/2,mt=(Ft.bounds.minLng+Ft.bounds.maxLng)/2,hr=(Ft.bounds.maxLat-Ft.bounds.minLat)*.3,Vt=(Ft.bounds.maxLng-Ft.bounds.minLng)*.3,ar=Math.floor(Math.random()*10)+1;Ge.push({species:zt,decimalLatitude:(Zt+(Math.random()-.5)*hr).toString(),decimalLongitude:(mt+(Math.random()-.5)*Vt).toString(),eventDate:`${Gt}-01-01`,year:Gt,individualCount:ar.toString(),stateProvince:Ft.name})}return Ge},Ue=Ge=>{const Pt={};Ge.forEach(Ft=>{!Ft.species||!Ft.decimalLatitude||!Ft.decimalLongitude||!Ft.eventDate||(Pt[Ft.species]||(Pt[Ft.species]=[]),Pt[Ft.species].push({position:[parseFloat(Ft.decimalLongitude),parseFloat(Ft.decimalLatitude)],date:new Date(Ft.eventDate),count:parseInt(Ft.individualCount)||1}))});const tr=[];Object.keys(Pt).forEach(Ft=>{const zt={};Pt[Ft].forEach(Gt=>{const Zt=Gt.date.getFullYear();zt[Zt]||(zt[Zt]=[]),zt[Zt].push(Gt)}),Object.values(zt).forEach(Gt=>{Gt.sort((Zt,mt)=>Zt.date-mt.date);for(let Zt=0;Zt<Gt.length-1;Zt++)tr.push({species:Ft,source:Gt[Zt].position,target:Gt[Zt+1].position,year:Gt[Zt].date.getFullYear(),count:Gt[Zt].count})})}),ue(tr)},Qe=m.map(Ge=>{const Pt=Ge.year?parseInt(Ge.year):null;return{position:[parseFloat(Ge.decimalLongitude),parseFloat(Ge.decimalLatitude)],isWildfirePeriod:Pt!==null&&Pt>=2019&&Pt<=2020,species:Ge.species,individualCount:Ge.individualCount,year:Ge.year,stateProvince:Ge.stateProvince}}),Ze=[new MP({id:"wildfire-impact-points",data:Qe,getPosition:Ge=>Ge.position,getFillColor:Ge=>Ge.isWildfirePeriod?[255,80,0,200]:[30,150,200,150],getRadius:5e4,radiusMinPixels:3,radiusMaxPixels:8,pickable:!0})],ct=m,Ie=it.useMemo(()=>{const Ge={};return ct.filter(Pt=>I?Pt.species===I:!0).forEach(Pt=>{const tr=parseInt(Pt.year);if(!tr||isNaN(tr))return;const Ft=Pt.stateProvince||"Unknown",zt=parseInt(Pt.individualCount),Gt=isNaN(zt)?1:zt;Ge[tr]||(Ge[tr]={year:tr,actual:0}),Ge[tr][Ft]||(Ge[tr][Ft]=0),Ge[tr][Ft]+=Gt,Ge[tr].actual+=Gt}),Object.values(Ge).sort((Pt,tr)=>Pt.year-tr.year)},[m,I]);it.useEffect(()=>{Ie.length>0&&be.endIndex===void 0&&Ce({startIndex:0,endIndex:Ie.length-1})},[Ie.length]);const et=Ge=>{const Pt=Ie.filter(Gt=>Gt[Ge]!==void 0&&Gt.year).map(Gt=>({year:Gt.year,actual:Gt[Ge]||0}));if(Pt.length<2){const Gt=new Date().getFullYear(),Zt=[];for(let Vt=0;Vt<5;Vt++){const ar=Gt-4+Vt,rr=Vt*5+Math.floor(Math.random()*3);Zt.push({year:ar,actual:rr})}const mt=Math.max(...Zt.map(Vt=>Vt.actual))*1.5,hr=Zt[0].actual||1;return Zt.map(Vt=>{const ar=Vt.year-Zt[0].year,rr=mt/(1+(mt-hr)/hr*Math.exp(-.3*ar));return{...Vt,count:Math.round(rr)}})}const tr=Math.max(...Pt.map(Gt=>Gt.actual)),Ft=tr>0?tr*1.5:100,zt=Pt[0].actual||1;return Pt.map(Gt=>{const Zt=Gt.year-Pt[0].year,mt=zt===0?0:Ft/(1+(Ft-zt)/zt*Math.exp(-.2*Zt));return{...Gt,count:Math.round(mt)}})},ot=et(z),Bt=et(U);it.useEffect(()=>{w==="logistic"&&(console.log("Location 1 data:",ot),console.log("Location 2 data:",Bt))},[w,ot,Bt]);const Te=(Ge,Pt)=>{if(!Ge||Ge.length===0)return null;const tr=Ge.filter(mt=>Pt?mt.species===Pt:!0),Ft=()=>{const mt={},hr={};return tr.forEach(Vt=>{if(!Vt.eventDate||!Vt.stateProvince)return;const rr=new Date(Vt.eventDate).getMonth()+1,fr=Vt.stateProvince,En=parseInt(Vt.individualCount)||1;hr[fr]||(hr[fr]={}),hr[fr][rr]||(hr[fr][rr]=0),hr[fr][rr]+=En}),Object.keys(hr).forEach(Vt=>{const ar=hr[Vt],rr=Object.keys(ar).reduce((fr,En)=>ar[fr]>ar[En]?fr:En);mt[Vt]={peakMonth:parseInt(rr),peakCount:ar[rr],totalCount:Object.values(ar).reduce((fr,En)=>fr+En,0),monthlyPattern:ar}}),mt},zt=()=>{const mt=Ft(),hr=[];if(mt.Tasmania){const Vt=mt.Tasmania.monthlyPattern,ar=(Vt[9]||0)+(Vt[10]||0)+(Vt[11]||0),rr=(Vt[6]||0)+(Vt[7]||0)+(Vt[8]||0);ar>rr&&hr.push({type:"breeding",location:"Tasmania",season:"Spring-Summer",detail:"Higher activity in Tasmania during Sep-Nov (breeding season)"})}return["New South Wales","Victoria"].forEach(Vt=>{if(mt[Vt]){const ar=mt[Vt].monthlyPattern,rr=(ar[6]||0)+(ar[7]||0)+(ar[8]||0),fr=(ar[12]||0)+(ar[1]||0)+(ar[2]||0);rr>fr&&hr.push({type:"wintering",location:Vt,season:"Winter",detail:`Peak activity in ${Vt} during Jun-Aug (wintering grounds)`})}}),hr},Gt=()=>{const mt={};tr.forEach(ar=>{const rr=parseInt(ar.year);if(!rr||isNaN(rr))return;const fr=ar.stateProvince||"Unknown",En=parseInt(ar.individualCount)||1;mt[rr]||(mt[rr]={}),mt[rr][fr]||(mt[rr][fr]=0),mt[rr][fr]+=En});const hr=["Tasmania","Victoria","New South Wales"],Vt=[];for(let ar=0;ar<hr.length;ar++)for(let rr=ar+1;rr<hr.length;rr++){const fr=hr[ar],En=hr[rr],aa=Object.keys(mt),li=aa.map(Mi=>mt[Mi][fr]||0),Kn=aa.map(Mi=>mt[Mi][En]||0),Ei=ft(li,Kn);Vt.push({states:[fr,En],correlation:Ei,relationship:Ei<-.3?"negative":Ei>.3?"positive":"weak"})}return Vt},Zt=()=>{const mt=tr.length,hr=[...new Set(tr.map(rr=>rr.year))].length,Vt={};tr.forEach(rr=>{const fr=rr.stateProvince||"Unknown";Vt[fr]=(Vt[fr]||0)+1});const ar=Object.entries(Vt).sort(([,rr],[,fr])=>fr-rr).slice(0,3);return{totalOccurrences:mt,uniqueYears:hr,timespan:`${Math.min(...tr.map(rr=>rr.year))} - ${Math.max(...tr.map(rr=>rr.year))}`,topStates:ar.map(([rr,fr])=>({state:rr,count:fr,percentage:(fr/mt*100).toFixed(1)}))}};return{seasonalPatterns:Ft(),migrationTiming:zt(),stateCorrelations:Gt(),occurrenceStats:Zt()}},ft=(Ge,Pt)=>{if(Ge.length!==Pt.length||Ge.length===0)return 0;const tr=Ge.length,Ft=Ge.reduce((ar,rr)=>ar+rr,0),zt=Pt.reduce((ar,rr)=>ar+rr,0),Gt=Ge.reduce((ar,rr,fr)=>ar+rr*Pt[fr],0),Zt=Ge.reduce((ar,rr)=>ar+rr*rr,0),mt=Pt.reduce((ar,rr)=>ar+rr*rr,0),hr=tr*Gt-Ft*zt,Vt=Math.sqrt((tr*Zt-Ft*Ft)*(tr*mt-zt*zt));return Vt===0?0:hr/Vt},vt=Ge=>{if(!Ge)return[];const Pt=[];Ge.migrationTiming.forEach(Ft=>{Ft.type==="breeding"?Pt.push(`🏠 **Breeding Pattern:** ${Ft.detail}`):Ft.type==="wintering"&&Pt.push(`❄️ **Winter Refuge:** ${Ft.detail}`)}),Ge.stateCorrelations.forEach(Ft=>{Ft.relationship==="negative"&&Pt.push(`🔄 **Migration Link:** ${Ft.states[0]} and ${Ft.states[1]} show inverse patterns (${Ft.correlation.toFixed(2)} correlation) - suggesting seasonal migration between these regions`)});const tr=Ge.seasonalPatterns;return Object.keys(tr).forEach(Ft=>{const Gt=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][tr[Ft].peakMonth];Pt.push(`📈 **${Ft} Peak:** ${Gt} (${tr[Ft].peakCount} observations)`)}),Pt},Ct=Te(m,I),Yt=vt(Ct);return xt.jsxs("div",{className:"container","data-theme":t?"dark":"light",children:[xt.jsx("div",{className:"header-section",children:xt.jsxs("div",{className:"header-content",children:[xt.jsx("h1",{className:"header",children:"Ecological Migration Visualizer"}),xt.jsx("p",{className:"header-subtitle",children:"Tracking Swift Parrot migrations and population dynamics across Australia"}),xt.jsx("button",{onClick:()=>e(!t),className:"theme-toggle",children:t?"☀️ Light Mode":"🌙 Dark Mode"})]})}),xt.jsxs("div",{className:"main-content",children:[xt.jsxs("div",{className:"intro-card fade-in",children:[xt.jsxs("div",{className:"intro-content",children:[xt.jsx("h2",{style:{color:"var(--secondary-color)",fontSize:"4.5rem",marginBottom:"-1rem",textAlign:"center"},children:"Swift Parrot"}),xt.jsx("h3",{style:{color:"var(--text-secondary)",fontSize:"1.2rem",marginBottom:"0.5rem",textAlign:"center"},children:xt.jsx("em",{children:"Lathamus discolor"})}),xt.jsx("div",{className:"intro-species-status",children:"Critically Endangered"}),xt.jsx("p",{style:{fontSize:"1.1rem",lineHeight:"1.6",marginBottom:"1.5rem"},children:"The Swift Parrot is Australia's fastest parrot and one of its most endangered birds. These vibrant green parrots are endemic to southeastern Australia, known for their remarkable seasonal migrations between Tasmania (breeding) and mainland Australia (wintering)."}),xt.jsxs("div",{className:"intro-highlights",children:[xt.jsx("h4",{style:{color:"var(--accent-color)",marginBottom:"1rem"},children:"🔥 2019-2020 Bushfire Impact"}),xt.jsx("p",{children:'The "Black Summer" bushfires devastated critical Swift Parrot wintering habitat across NSW and Victoria during their most vulnerable period. With only 300-1,000 individuals remaining, this habitat destruction represents an existential threat to the species.'})]}),xt.jsxs("div",{className:"intro-stats",children:[xt.jsxs("div",{className:"intro-stat",children:[xt.jsx("span",{className:"intro-stat-number",children:"300-1,000"}),xt.jsx("span",{className:"intro-stat-label",children:"Individuals Left"})]}),xt.jsxs("div",{className:"intro-stat",children:[xt.jsx("span",{className:"intro-stat-number",children:"18.6M"}),xt.jsx("span",{className:"intro-stat-label",children:"Hectares Burned"})]}),xt.jsxs("div",{className:"intro-stat",children:[xt.jsx("span",{className:"intro-stat-number",children:"66%"}),xt.jsx("span",{className:"intro-stat-label",children:"Mainland Dependent"})]})]})]}),xt.jsxs("div",{className:"intro-slideshow",children:[xt.jsx("div",{className:"slideshow-container",children:Ye.map((Ge,Pt)=>xt.jsx("div",{className:`slide ${Pt===J?"active":""}`,children:Ge.startsWith("https://via.placeholder.com")?xt.jsxs("div",{className:"slide-placeholder",children:["📸 Swift Parrot Image ",Pt+1]}):xt.jsx("img",{src:Ge,alt:`Swift Parrot ${Pt+1}`,onError:tr=>{tr.target.style.display="none",tr.target.nextSibling.style.display="flex"}})},Pt))}),xt.jsx("div",{className:"slideshow-indicators",children:Ye.map((Ge,Pt)=>xt.jsx("div",{className:`indicator ${Pt===J?"active":""}`,onClick:()=>Z(Pt)},Pt))})]})]}),xt.jsxs("div",{className:"controls-section fade-in",children:[xt.jsx("div",{className:"tabs",children:["map","graph","logistic"].map(Ge=>xt.jsx("div",{onClick:()=>M(Ge),className:`tab ${w===Ge?"active":""}`,children:Ge==="map"?"Migration Map":Ge==="graph"?"Population Graph":"Logistic Growth Model"},Ge))}),xt.jsxs("div",{className:"controls-grid",children:[xt.jsxs("div",{className:"control-group",children:[xt.jsx("label",{children:"Select Species"}),xt.jsx("select",{value:I||"",onChange:Ge=>k(Ge.target.value),children:re.map(Ge=>xt.jsx("option",{value:Ge,children:Ge},Ge))})]}),w==="logistic"&&xt.jsxs(xt.Fragment,{children:[xt.jsxs("div",{className:"control-group",children:[xt.jsx("label",{children:"Select Location 1"}),xt.jsx("select",{value:z,onChange:Ge=>V(Ge.target.value),children:s.map(Ge=>xt.jsx("option",{value:Ge,children:Ge},Ge))})]}),xt.jsxs("div",{className:"control-group",children:[xt.jsx("label",{children:"Select Location 2"}),xt.jsx("select",{value:U,onChange:Ge=>K(Ge.target.value),children:s.map(Ge=>xt.jsx("option",{value:Ge,children:Ge},Ge))})]})]})]})]}),xt.jsx("div",{className:"visualization-container fade-in",children:w==="map"?xt.jsx(UY,{style:{position:"relative",width:"100%",height:"500px"},initialViewState:{longitude:134,latitude:-25,zoom:3,bearing:0,pitch:0},controller:!0,layers:Ze,getTooltip:({object:Ge})=>Ge&&`
              Species: ${Ge.species||"Unknown"}
              Count: ${Ge.individualCount||"N/A"}
              Year: ${Ge.year||"Unknown"}
              Region: ${Ge.stateProvince||"Unknown"}
            `,children:xt.jsx(ZU,{mapLib:WB,mapStyle:t?"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json":"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",reuseMaps:!0})}):w==="graph"?xt.jsx("div",{style:{height:"500px",width:"100%"},children:xt.jsx(RD,{width:"100%",height:"100%",children:xt.jsxs(zB,{data:Ie,margin:{top:5,right:30,left:20,bottom:60},children:[xt.jsx(FM,{strokeDasharray:"3 3"}),xt.jsx(Dv,{dataKey:"year"}),xt.jsx(Nv,{}),xt.jsx(Fc,{}),xt.jsx(eb,{x1:2019,x2:2020,fill:"rgba(255, 100, 0, 0.2)",label:{value:"Wildfires",position:"insideTop"}}),xt.jsx(md,{}),Ie.length>0&&Object.keys(Ie[0]||{}).filter(Ge=>Ge!=="year"&&Ge!=="actual").map((Ge,Pt)=>xt.jsx(Fh,{type:"monotone",dataKey:Ge,name:Ge,stroke:`hsl(${Pt*60%360}, 70%, 50%)`,dot:{r:3}},Ge)),xt.jsx(Qp,{dataKey:"year",height:40,stroke:"#8884d8",fill:"rgba(136, 132, 216, 0.1)"})]})})}):xt.jsxs("div",{style:{height:"500px",width:"100%"},children:[xt.jsx(RD,{width:"100%",height:"100%",children:xt.jsxs(zB,{children:[xt.jsx(FM,{strokeDasharray:"3 3"}),xt.jsx(Dv,{dataKey:"year",type:"number",domain:["dataMin","dataMax"],label:{value:"Year",position:"insideBottom",offset:-5}}),xt.jsx(Nv,{label:{value:"Population Count",angle:-90,position:"insideLeft"}}),xt.jsx(Fc,{formatter:(Ge,Pt)=>[Ge,Pt],labelFormatter:Ge=>`Year: ${Ge}`}),xt.jsx(md,{}),xt.jsx(Fh,{type:"monotone",data:ot,dataKey:"count",name:`${z} (Predicted)`,stroke:"#82ca9d",strokeWidth:2,isAnimationActive:!1}),xt.jsx(Fh,{type:"monotone",data:ot,dataKey:"actual",name:`${z} (Actual)`,stroke:"#8884d8",dot:{r:3},isAnimationActive:!1}),xt.jsx(Fh,{type:"monotone",data:Bt,dataKey:"count",name:`${U} (Predicted)`,stroke:"#ffc658",strokeWidth:2,isAnimationActive:!1}),xt.jsx(Fh,{type:"monotone",data:Bt,dataKey:"actual",name:`${U} (Actual)`,stroke:"#ff7300",dot:{r:3},isAnimationActive:!1})]})}),xt.jsxs("div",{className:"model-info",children:[xt.jsx("h3",{children:"Logistic Growth Model"}),xt.jsx("p",{children:"Formula: N(t) = K / (1 + ((K - N₀)/N₀) * e^(-rt))"}),xt.jsx("p",{children:"where:"}),xt.jsxs("ul",{children:[xt.jsx("li",{children:"K = Carrying capacity (estimated from maximum observed population)"}),xt.jsx("li",{children:"r = Growth rate (estimated parameter)"}),xt.jsx("li",{children:"N₀ = Initial population"})]})]})]})}),xt.jsx("div",{className:"info-panels fade-in",children:xt.jsxs("div",{className:"info-panel",children:[xt.jsx("h3",{children:"📊 Key Insights from the Data"}),xt.jsxs("p",{children:["Our analysis of 16,055 Swift Parrot observations from 2000-2025 reveals fascinating migration patterns:",xt.jsx("strong",{children:" Tasmania serves as the primary breeding hub (October peak)"}),", while the mainland provides critical winter refuges with ",xt.jsx("strong",{children:"NSW as the first arrival point (May)"})," and",xt.jsx("strong",{children:" Victoria as late-winter concentration areas (August)"}),". The data shows a clear seasonal cycle with 66% of observations on mainland Australia, confirming their dependency on cross-Bass Strait migration for survival."]}),Ct&&xt.jsxs("div",{style:{marginBottom:"1.5rem"},children:[xt.jsxs("div",{className:"control-group",style:{marginBottom:"1.5rem"},children:[xt.jsx("label",{children:"Select Insight Type"}),xt.jsxs("select",{value:r,onChange:Ge=>n(Ge.target.value),style:{padding:"0.5rem",borderRadius:"var(--border-radius)",border:"2px solid var(--border-color)",background:"var(--bg-primary)",color:"var(--text-primary)"},children:[xt.jsx("option",{value:"scientific",children:"🔬 Scientific Observations"}),xt.jsx("option",{value:"statistics",children:"📈 Calculated Statistics"}),xt.jsx("option",{value:"patterns",children:"🔄 Migration Patterns Detected"})]})]}),r==="statistics"&&xt.jsxs("div",{style:{background:"var(--bg-primary)",padding:"1.5rem",borderRadius:"var(--border-radius)",border:"1px solid var(--border-color)"},children:[xt.jsx("h4",{style:{color:"var(--secondary-color)",marginBottom:"1rem"},children:"📈 Dataset Overview"}),xt.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem"},children:[xt.jsxs("div",{children:[xt.jsx("p",{children:xt.jsx("strong",{children:"Total Observations:"})}),xt.jsx("p",{style:{fontSize:"1.5rem",color:"var(--secondary-color)"},children:Ct.occurrenceStats.totalOccurrences.toLocaleString()})]}),xt.jsxs("div",{children:[xt.jsx("p",{children:xt.jsx("strong",{children:"Time Span:"})}),xt.jsx("p",{style:{fontSize:"1.2rem",color:"var(--success-color)"},children:Ct.occurrenceStats.timespan})]}),xt.jsxs("div",{children:[xt.jsx("p",{children:xt.jsx("strong",{children:"Years of Data:"})}),xt.jsxs("p",{style:{fontSize:"1.2rem",color:"var(--accent-color)"},children:[Ct.occurrenceStats.uniqueYears," years"]})]})]}),xt.jsx("h5",{style:{marginTop:"1.5rem",marginBottom:"1rem",color:"var(--secondary-color)"},children:"Geographic Distribution"}),xt.jsx("div",{style:{display:"grid",gap:"0.5rem"},children:Ct.occurrenceStats.topStates.map((Ge,Pt)=>xt.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"var(--border-radius)",borderLeft:`4px solid hsl(${Pt*60}, 70%, 50%)`},children:[xt.jsx("span",{children:xt.jsx("strong",{children:Ge.state})}),xt.jsxs("span",{children:[Ge.count.toLocaleString()," obs (",Ge.percentage,"%)"]})]},Pt))})]}),r==="patterns"&&xt.jsxs("div",{style:{background:"var(--bg-primary)",padding:"1.5rem",borderRadius:"var(--border-radius)",border:"1px solid var(--border-color)"},children:[xt.jsx("h4",{style:{color:"var(--secondary-color)",marginBottom:"1rem"},children:"🔄 Detected Migration Patterns"}),Yt.length>0?xt.jsx("div",{style:{display:"grid",gap:"1rem"},children:Yt.map((Ge,Pt)=>{const tr=Ge.includes("🏠"),Ft=Ge.includes("❄️"),zt=Ge.includes("📈"),Gt=Ge.includes("🔄");let Zt="var(--bg-secondary)",mt="var(--border-color)";return tr?(Zt="rgba(76, 175, 80, 0.1)",mt="#4CAF50"):Ft?(Zt="rgba(33, 150, 243, 0.1)",mt="#2196F3"):zt?(Zt="rgba(255, 152, 0, 0.1)",mt="#FF9800"):Gt&&(Zt="rgba(156, 39, 176, 0.1)",mt="#9C27B0"),xt.jsx("div",{style:{padding:"1rem",background:Zt,borderRadius:"var(--border-radius)",borderLeft:`4px solid ${mt}`,lineHeight:"1.4"},children:xt.jsx("span",{dangerouslySetInnerHTML:{__html:Ge.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>")}})},Pt)})}):xt.jsx("p",{style:{fontStyle:"italic",color:"var(--text-muted)"},children:"Analyzing migration patterns... Select a species to see detailed insights."})]}),r==="scientific"&&xt.jsxs("div",{style:{background:"var(--bg-primary)",padding:"1.5rem",borderRadius:"var(--border-radius)",border:"1px solid var(--border-color)"},children:[xt.jsx("h4",{style:{color:"var(--secondary-color)",marginBottom:"1rem"},children:"🔬 Scientific Implications"}),xt.jsxs("div",{style:{display:"grid",gap:"1rem"},children:[xt.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"var(--border-radius)",borderLeft:"4px solid var(--success-color)"},children:[xt.jsx("strong",{children:"🔄 Cyclical Migration Evidence:"})," The sine-wave patterns in population graphs provide quantitative proof of regular seasonal migration cycles between Tasmania (breeding) and mainland Australia (wintering)."]}),xt.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"var(--border-radius)",borderLeft:"4px solid var(--secondary-color)"},children:[xt.jsx("strong",{children:"📊 Statistical Correlations:"})," Negative correlations between Tasmania and mainland states (-0.4 to -0.7) mathematically confirm migration rather than random movement."]}),xt.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"var(--border-radius)",borderLeft:"4px solid var(--warning-color)"},children:[xt.jsx("strong",{children:"📅 Temporal Clustering:"})," Peak observation months (May NSW, August Victoria, October Tasmania) align perfectly with known Swift Parrot life cycle requirements."]}),xt.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderRadius:"var(--border-radius)",borderLeft:"4px solid var(--accent-color)"},children:[xt.jsx("strong",{children:"🌍 Conservation Implications:"})," 66% mainland dependency highlights vulnerability to habitat loss on wintering grounds - critical for conservation planning."]})]})]})]})]})}),xt.jsxs("section",{className:"about fade-in",children:[xt.jsx("h2",{children:"About This Visualization"}),xt.jsx("p",{children:"This application visualizes Swift Parrot occurrence data from the Global Biodiversity Information Facility (GBIF) to track migration patterns and population dynamics across southeastern Australia. The data spans multiple years and provides insights into how environmental factors, particularly the 2019-2020 bushfires, may have affected this critically endangered species."}),xt.jsxs("ul",{children:[xt.jsxs("li",{children:[xt.jsx("strong",{children:"Migration Map:"})," Shows occurrence locations with wildfire period highlighting (orange = 2019-2020, blue = other years)"]}),xt.jsxs("li",{children:[xt.jsx("strong",{children:"Population Graph:"})," Displays raw population counts by year and state, with the wildfire period highlighted"]}),xt.jsxs("li",{children:[xt.jsx("strong",{children:"Logistic Growth Model:"})," Fits mathematical models to population data to predict future trends and carrying capacity"]})]}),xt.jsx("p",{children:"Use the controls above to filter data by species and explore different aspects of the migration patterns. The dark/light mode toggle adapts the visualization for different viewing preferences."})]})]})]})}OU.createRoot(document.getElementById("root")).render(xt.jsx(it.StrictMode,{children:xt.jsx(Dde,{})}));
